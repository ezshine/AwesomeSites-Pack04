/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[6],[,,,,,,,,function(e,t,n){"use strict";n.d(t,"c",(function(){return L})),n.d(t,"b",(function(){return C})),n.d(t,"a",(function(){return k}));n(10),n(30),n(23),n(63),n(27),n(64);var r=n(12),o=n(2),l=n(3),c=n(4),h=n(5),d=n(1),f=(n(76),n(17),n(56),n(15),n(72),n(73),n(89),n(92),n(96),n(74),function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e,data){if(void 0!==this._listeners){var t=this._listeners[e];if(void 0!==t)for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,data)}}}]),e}()),m=n(78);function v(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length<2||"object"!==Object(m.a)(t[0]))throw new Error("Function expects object, method, method etc.");for(var r=t.shift(),o=t,i=0,l=o.length;i<l;i++){var c=o[i];r[c]=r[c].bind(r)}}n(197),n(70),n(113);var _=function(path){return new RegExp("^(?:[a-z]+:)?//","i").test(path)};function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var S=function(e){Object(c.a)(n,e);var t=w(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this))._progress=0,e._resourcesToPreload=[],e._preloadedResources=0,e._bindAll(),e}return Object(l.a)(n,[{key:"add",value:function(e){for(var t=e.resources,r=e.namespace,o=e.preload,i=0;i<t.length;i++){var l=t[i];r&&(l.namespace&&console.warn('Resource Loader: resource namespace "'.concat(l.namespace,'" will override the original name space for resource "').concat(l.name,'"')),l.namespace=r),void 0!==o&&void 0===l.preload&&(l.preload=o),void 0===l.preload&&(l.preload=n.preloadByDefault),n.resources.push(l)}return n.resources}},{key:"preload",value:function(){var e=[],t=n.resources.filter((function(e){return e.preload}));this._preloadStartHandler(t);for(var i=0,r=t.length;i<r;i++){var o=n.loadResource(t[i]);e.push(o),o.then(this._preloadProgressHandler)}return Promise.all(e).catch(this._preloadErrorHandler).then(this._preloadCompleteHandler)}},{key:"destroy",value:function(){n.cache=[],n.loaders={},n.resources=[],this._progress=null,this._resourcesToPreload=null,this._preloadedResources=null}},{key:"_bindAll",value:function(){v(this,"_preloadCompleteHandler","_preloadProgressHandler","_preloadErrorHandler")}},{key:"_preloadStartHandler",value:function(e){this._resourcesToPreload=e,this.dispatchEvent("start",this._resourcesToPreload)}},{key:"_preloadProgressHandler",value:function(e){this._preloadedResources++,this._progress=this._preloadedResources/this._resourcesToPreload.length,this.dispatchEvent("progress",this._progress)}},{key:"_preloadCompleteHandler",value:function(e){this.dispatchEvent("complete",e)}},{key:"_preloadErrorHandler",value:function(){console.error("Resource Loader : Something went wrong while preloading resources")}}],[{key:"load",value:function(e){return this.loadResourceByName(e.name,e.path)}},{key:"get",value:function(e){return this.getResourceByName(e).data}},{key:"registerLoader",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.loaders[t]=new e(x({type:t},n))}},{key:"getLoader",value:function(e){if(!this.loaders[e])throw new Error('Resource Loader: No loader is available for type "'.concat(e,'"'));return this.loaders[e]}},{key:"registerWorker",value:function(e){this.worker=e}},{key:"loadResourceByName",value:function(e,path){var t=this;return new Promise((function(n,r){for(var i=0,o=t.cache.length;i<o;i++)if(t.cache[i].path===path)return void n(t.cache[i].data);for(var l=null,c=0;c<t.resources.length;c++)t.resources[c].name===e&&(l=t.resources[c]);l||r(new Error("Resource Loader: Resource with name '".concat(e,"' was not found"))),t.loadResource(l).then((function(){n(l.data)})).catch((function(){r(new Error('Resource Loader : failing to get the resource "'.concat(e,'"')))}))}))}},{key:"getResourceByName",value:function(e){for(var i=0,t=this.cache.length;i<t;i++)if(this.cache[i].name===e)return this.cache[i];throw new Error("Resource Loader: Resource with name '".concat(e,"' was not found"))}},{key:"loadResource",value:function(e){var t=this;if(!e.name)throw new Error("Resource name should be defined");var n=this.loaders[e.type];if(!n)throw new Error('Resource Loader: No loader is available for type "'.concat(e.type,'"'));if(!e.path)throw new Error('Resource Loader: Could not find resource path for "'.concat(e.name,'"'));var path=this.resolvePath(e.path),r=n.load({path:path,name:e.name,type:e.type,basePath:this.basePath,options:e.options});return r.then((function(n){e.data=n;for(var i=0,r=t.cache.length;i<r;i++)if(t.cache[i].name===e.name)return;t.cache.push(e)})),r}},{key:"resolvePath",value:function(path){return _(path)?path:"".concat(this.basePath).concat(path)}},{key:"isResourceAdded",value:function(e){for(var i=0;i<n.resources.length;i++)if(n.resources[i].type===e.type&&(n.resources[i].name===e.name||n.resources[i].path===e.path))return!0}}]),n}(f);S.resources=[],S.cache=[],S.basePath="",S.loaders={},S.worker=null,S.preloadByDefault=!1;var C=S;n(88);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var L=function(e){Object(c.a)(n,e);var t=O(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o.a)(this,n),(e=t.call(this))._progress=0,e._preloadedResources=0,e._isComplete=!1,e._name=r.name,e._namespace=r.namespace,e._resources=e._setupResources(),e._bindAll(),e}return Object(l.a)(n,[{key:"resources",get:function(){return this._resources}},{key:"isComplete",get:function(){return this._isComplete}},{key:"get",value:function(e){for(var i=0;i<this._resources.length;i++)if(this._resources[i].name===e)return this._resources[i].data;console.error('Resource manager "'.concat(this._namespace,'" : Couln\'t find resource with name "').concat(e,'"'))}},{key:"add",value:function(e){Array.isArray(e)?this._addMultiple(e):this._isResourceAdded(e)?console.warn('Resource manager "'.concat(this._namespace,'" : Resource with same name or path has already been added for "').concat(e.name,'"')):(this._resources.push(e),C.resources.push(e))}},{key:"addByName",value:function(e){if(Array.isArray(e))this._addByNames(e);else{for(var t=null,i=0;i<C.resources.length;i++){var n=C.resources[i];if(e===n.name){if(!this._isResourceAdded(n))return this._resources.push(n),void(t=n);console.warn('Resource manager "'.concat(this._namespace,'" : Resource with name "').concat(n.name,'" has already been added')),t=void 0}}null===t&&console.warn('Resource manager "'.concat(this._namespace,'" : Could not find any resource with name "').concat(e,'"'))}}},{key:"load",value:function(){var e=[];this._preloadStartHandler();for(var i=0;i<this._resources.length;i++){var t=this._resources[i],n=C.load(t);n.then(this._preloadProgressHandler),n.catch(this._preloadErrorHandler),e.push(n)}return Promise.all(e).then(this._preloadCompleteHandler)}},{key:"destroy",value:function(){this._progress=null,this._preloadedResources=null,this._name=null,this._namespace=null,this._resources=null}},{key:"_setupResources",value:function(){for(var e=[],i=0;i<C.resources.length;i++){var t=C.resources[i];(t.preload||t.namespace===this._namespace&&void 0!==t.namespace)&&e.push(t)}return e}},{key:"_addMultiple",value:function(e){for(var i=0;i<e.length;i++){var t=e[i];if(this._isResourceAdded(t))return void console.warn('Resource manager "'.concat(this._namespace,'" : Resource with same name or path has already been added for "').concat(t.name,'"'));this._resources.push(t),C.resources.push(t)}}},{key:"_addByNames",value:function(e){for(var i=0;i<C.resources.length;i++){var t=C.resources[i];if(e.includes(t.name))if(this._isResourceAdded(t)){console.warn('Resource manager "'.concat(this._namespace,'" : Resource with same name or path has already been added for "').concat(t.name,'"'));var n=e.indexOf(t.name);e.splice(n,1)}else{this._resources.push(t);var r=e.indexOf(t.name);e.splice(r,1)}}e.length>0&&console.warn('Resource manager "'.concat(this._namespace,'" : Could not find any resource with following name(s) : ').concat(e.join(", ")))}},{key:"_bindAll",value:function(){v(this,"_preloadCompleteHandler","_preloadErrorHandler","_preloadProgressHandler")}},{key:"_preloadStartHandler",value:function(){this.dispatchEvent("start",null)}},{key:"_preloadProgressHandler",value:function(e){this._preloadedResources++,this._progress=this._preloadedResources/this._resources.length,this.dispatchEvent("progress",this._progress)}},{key:"_preloadCompleteHandler",value:function(e){this._isComplete=!0,this.dispatchEvent("complete",e)}},{key:"_preloadErrorHandler",value:function(){console.error("Resource manager ".concat(this._namespace," : something went wrong while preloading resources"))}},{key:"_isResourceAdded",value:function(e){for(var i=0;i<this._resources.length;i++)if(this._resources[i].type===e.type&&(this._resources[i].name===e.name||this._resources[i].path===e.path))return!0}}]),n}(f),k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.type=t.type}return Object(l.a)(e,[{key:"worker",get:function(){return C.worker}},{key:"load",value:function(e){return new Promise}}]),e}();t.d=C},function(e,t,n){"use strict";n(10);var r=n(2),o=n(3),l=n(4),c=n(5),h=n(1),d=(n(15),n(72),n(73),n(146),n(70),n(169),n(107));function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}d.a,new URLSearchParams(window.location.search);t.a=null},,function(e,t,n){"use strict";n.d(t,"a",(function(){return component}));var r=n(28),o=n(4),l=n(5),c=n(1),h=n(2),d=n(3);n(96),n(74),n(17),n(76),n(27),n(10);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var o=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var m=new(function(){function e(){Object(h.a)(this,e),this.data={},this.listeners={},this.fireAtStart={},this.instances=[]}return Object(d.a)(e,[{key:"on",value:function(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}},{key:"off",value:function(e,t){e in this.listeners!=!1&&this.listeners[e].splice(this.listeners[e].indexOf(t),1)}},{key:"register",value:function(e){for(var t in this.instances.push(e),this.fireAtStart)this.fireMethod(e,t)}},{key:"unregister",value:function(e){var t=this.instances.indexOf(e);t>-1&&this.instances.splice(t,1)}},{key:"nameToMethod",value:function(e){return"on".concat(e.charAt(0).toUpperCase()+e.slice(1))}},{key:"fireMethod",value:function(e,t){var n=e[this.nameToMethod(t)];"function"==typeof n&&n.call(e,this.data[t])}},{key:"trigger",value:function(e){var t=this,n=e.name,r=e.fireAtStart,o=void 0!==r&&r,l=e.log,c=void 0!==l&&l,data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.data[n]=data,o&&(this.fireAtStart[n]=!0),c&&console.log("üë®‚Äçüè´ ".concat(n," ‚Äì ").concat(data)),n in this.listeners)for(var i=0;i<this.listeners[n].length;i++)this.listeners[n][i].call(this,data);this.instances.forEach((function(e){return t.fireMethod(e,n)}))}}]),e}()),component=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function e(){Object(h.a)(this,e)};return function(e){Object(o.a)(n,e);var t=f(n);function n(){var e,o;Object(h.a)(this,n);for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];return(o=t.call.apply(t,[this].concat(c)))._args=c,o.init&&(e=o).init.apply(e,c),m.register(Object(r.a)(o)),o}return Object(d.a)(n,[{key:"destroy",value:function(){m.unregister(this)}}]),n}(e)};t.b=m},,,function(e,t,n){"use strict";n.d(t,"k",(function(){return y})),n.d(t,"m",(function(){return x})),n.d(t,"l",(function(){return w})),n.d(t,"e",(function(){return S})),n.d(t,"b",(function(){return C})),n.d(t,"s",(function(){return O})),n.d(t,"g",(function(){return L})),n.d(t,"h",(function(){return k})),n.d(t,"d",(function(){return M})),n.d(t,"r",(function(){return T})),n.d(t,"j",(function(){return P})),n.d(t,"t",(function(){return D})),n.d(t,"o",(function(){return E})),n.d(t,"q",(function(){return I})),n.d(t,"f",(function(){return j})),n.d(t,"c",(function(){return F})),n.d(t,"i",(function(){return B})),n.d(t,"p",(function(){return U})),n.d(t,"a",(function(){return $})),n.d(t,"v",(function(){return Y})),n.d(t,"n",(function(){return X})),n.d(t,"u",(function(){return K}));n(90),n(23),n(99),n(100),n(63),n(27),n(64);var r=n(78),o=n(26),l=n(12),c=n(24),h=(n(112),n(56),n(192),n(15),n(17),n(76),n(18),n(30),n(72),n(73),n(74),n(70),n(110),n(232),n(169),n(197),n(113),n(88),n(85),n(89),n(92),n(16)),d=n(91);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function y(e){h.a.config.errorHandler&&h.a.config.errorHandler(e)}function x(e){return e.then((function(e){return e.default||e}))}function w(e){return e.$options&&"function"==typeof e.$options.fetch&&!e.$options.fetch.length}function S(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.$children||[],o=v(r);try{for(o.s();!(t=o.n()).done;){var l=t.value;l.$fetch?n.push(l):l.$children&&S(l,n)}}catch(e){o.e(e)}finally{o.f()}return n}function C(e,t){if(t||!e.options.__hasNuxtData){var n=e.options._originDataFn||e.options.data||function(){return{}};e.options._originDataFn=n,e.options.data=function(){var data=n.call(this,this);return this.$ssrContext&&(t=this.$ssrContext.asyncData[e.cid]),m(m({},data),t)},e.options.__hasNuxtData=!0,e._Ctor&&e._Ctor.options&&(e._Ctor.options.data=e.options.data)}}function O(e){return e.options&&e._Ctor===e||(e.options?(e._Ctor=e,e.extendOptions=e.options):(e=h.a.extend(e))._Ctor=e,!e.options.name&&e.options.__file&&(e.options.name=e.options.__file)),e}function L(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"components";return Array.prototype.concat.apply([],e.matched.map((function(e,r){return Object.keys(e[n]).map((function(o){return t&&t.push(r),e[n][o]}))})))}function k(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return L(e,t,"instances")}function M(e,t){return Array.prototype.concat.apply([],e.matched.map((function(e,n){return Object.keys(e.components).reduce((function(r,o){return e.components[o]?r.push(t(e.components[o],e.instances[o],e,o,n)):delete e.components[o],r}),[])})))}function T(e,t){return Promise.all(M(e,function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(n,r,o,l){var c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof n||n.options){e.next=11;break}return e.prev=1,e.next=4,n();case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0&&"ChunkLoadError"===e.t0.name&&"undefined"!=typeof window&&window.sessionStorage&&(c=Date.now(),(!(h=parseInt(window.sessionStorage.getItem("nuxt-reload")))||h+6e4<c)&&(window.sessionStorage.setItem("nuxt-reload",c),window.location.reload(!0))),e.t0;case 11:return o.components[l]=n=O(n),e.abrupt("return","function"==typeof t?t(n,r,o,l):n);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r,o){return e.apply(this,arguments)}}()))}function P(e){return R.apply(this,arguments)}function R(){return(R=Object(o.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,T(t);case 4:return e.abrupt("return",m(m({},t),{},{meta:L(t).map((function(e,n){return m(m({},e.options.meta),(t.matched[n]||{}).meta)}))}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){return A.apply(this,arguments)}function A(){return(A=Object(o.a)(regeneratorRuntime.mark((function e(t,n){var o,l,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.context||(t.context={isStatic:!1,isDev:!1,isHMR:!1,app:t,store:t.store,payload:n.payload,error:n.error,base:t.router.options.base,env:{}},n.req&&(t.context.req=n.req),n.res&&(t.context.res=n.res),n.ssrContext&&(t.context.ssrContext=n.ssrContext),t.context.redirect=function(e,path,n){if(e){t.context._redirected=!0;var o=Object(r.a)(path);if("number"==typeof e||"undefined"!==o&&"object"!==o||(n=path||{},path=e,o=Object(r.a)(path),e=302),"object"===o&&(path=t.router.resolve(path).route.fullPath),!/(^[.]{1,2}\/)|(^\/(?!\/))/.test(path))throw path=Object(d.e)(path,n),window.location.replace(path),new Error("ERR_REDIRECT");t.context.next({path:path,query:n,status:e})}},t.context.nuxtState=window.__NUXT__),e.next=3,Promise.all([P(n.route),P(n.from)]);case 3:o=e.sent,l=Object(c.a)(o,2),h=l[0],f=l[1],n.route&&(t.context.route=h),n.from&&(t.context.from=f),t.context.next=n.next,t.context._redirected=!1,t.context._errored=!1,t.context.isHMR=!1,t.context.params=t.context.route.params||{},t.context.query=t.context.route.query||{};case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return!e.length||t._redirected||t._errored?Promise.resolve():I(e[0],t).then((function(){return E(e.slice(1),t)}))}function I(e,t){var n;return(n=2===e.length?new Promise((function(n){e(t,(function(e,data){e&&t.error(e),n(data=data||{})}))})):e(t))&&n instanceof Promise&&"function"==typeof n.then?n:Promise.resolve(n)}function j(base,e){if("hash"===e)return window.location.hash.replace(/^#\//,"");base=decodeURI(base).slice(0,-1);var path=decodeURI(window.location.pathname);base&&path.startsWith(base)&&(path=path.slice(base.length));var t=(path||"/")+window.location.search+window.location.hash;return Object(d.d)(t)}function F(e,t){return function(e,t){for(var n=new Array(e.length),i=0;i<e.length;i++)"object"===Object(r.a)(e[i])&&(n[i]=new RegExp("^(?:"+e[i].pattern+")$",W(t)));return function(t,r){for(var path="",data=t||{},o=(r||{}).pretty?z:encodeURIComponent,l=0;l<e.length;l++){var c=e[l];if("string"!=typeof c){var h=data[c.name||"pathMatch"],d=void 0;if(null==h){if(c.optional){c.partial&&(path+=c.prefix);continue}throw new TypeError('Expected "'+c.name+'" to be defined')}if(Array.isArray(h)){if(!c.repeat)throw new TypeError('Expected "'+c.name+'" to not repeat, but received `'+JSON.stringify(h)+"`");if(0===h.length){if(c.optional)continue;throw new TypeError('Expected "'+c.name+'" to not be empty')}for(var f=0;f<h.length;f++){if(d=o(h[f]),!n[l].test(d))throw new TypeError('Expected all "'+c.name+'" to match "'+c.pattern+'", but received `'+JSON.stringify(d)+"`");path+=(0===f?c.prefix:c.delimiter)+d}}else{if(d=c.asterisk?G(h):o(h),!n[l].test(d))throw new TypeError('Expected "'+c.name+'" to match "'+c.pattern+'", but received "'+d+'"');path+=c.prefix+d}}else path+=c}return path}}(function(e,t){var n,r=[],o=0,l=0,path="",c=t&&t.delimiter||"/";for(;null!=(n=N.exec(e));){var h=n[0],d=n[1],f=n.index;if(path+=e.slice(l,f),l=f+h.length,d)path+=d[1];else{var m=e[l],v=n[2],_=n[3],y=n[4],x=n[5],w=n[6],S=n[7];path&&(r.push(path),path="");var C=null!=v&&null!=m&&m!==v,O="+"===w||"*"===w,L="?"===w||"*"===w,k=n[2]||c,pattern=y||x;r.push({name:_||o++,prefix:v||"",delimiter:k,optional:L,repeat:O,partial:C,asterisk:Boolean(S),pattern:pattern?V(pattern):S?".*":"[^"+H(k)+"]+?"})}}l<e.length&&(path+=e.substr(l));path&&r.push(path);return r}(e,t),t)}function B(e,t){var n={},r=m(m({},e),t);for(var o in r)String(e[o])!==String(t[o])&&(n[o]=!0);return n}function U(e){var t;if(e.message||"string"==typeof e)t=e.message||e;else try{t=JSON.stringify(e,null,2)}catch(n){t="[".concat(e.constructor.name,"]")}return m(m({},e),{},{message:t,statusCode:e.statusCode||e.status||e.response&&e.response.status||500})}window.onNuxtReadyCbs=[],window.onNuxtReady=function(e){window.onNuxtReadyCbs.push(e)};var N=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function z(e,t){var n=t?/[?#]/g:/[/?#]/g;return encodeURI(e).replace(n,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function G(e){return z(e,!0)}function H(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function V(e){return e.replace(/([=!:$/()])/g,"\\$1")}function W(e){return e&&e.sensitive?"":"i"}function $(e,t,n){e.$options[t]||(e.$options[t]=[]),e.$options[t].includes(n)||e.$options[t].push(n)}var Y=d.c,X=(d.g,d.b);function K(e){try{window.history.scrollRestoration=e}catch(e){}}},,,,,,,,,,,function(e,t,n){"use strict";function r(e,t,n){return e*(1-n)+t*n}t.a={clamp:function(e,t,n){return Math.min(Math.max(e,t),n)},lerp:r,hermite:function(e,t,n){return r(e,t,n*n*(3-2*n))},distance:function(e,t){var a=e.x-t.x,b=e.y-t.y;return Math.sqrt(a*a+b*b)},angle:function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},randomArbitrary:function(e,t){return Math.random()*(t-e)+e},randomInt:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}}},,,,function(e,t,n){"use strict";var r,o,l=n(2),c=n(3),h=(n(15),n(7)),d=n(140),f=n.n(d);void 0!==document.hidden?(r="hidden",o="visibilitychange"):void 0!==document.msHidden?(r="msHidden",o="msvisibilitychange"):void 0!==document.webkitHidden&&(r="webkitHidden",o="webkitvisibilitychange");var m=function(){function e(){Object(l.a)(this,e),this._tracks={},this._previousLandscapeTrack=null,this._currentLandscapeTrack=null,this._currentLandscapeEffect=null,this._currentLandscapeTransition=null,this._landscapeVolume=0,this._mainTrack=null,this._mainVolume=0,this._isMuted=!1,this._bindAll(),this._lowPassFrequency=1e3,this._lowPass=this._createLowPass(),this._setupEventListeners()}return Object(c.a)(e,[{key:"lowPassFrequency",get:function(){return this._lowPassFrequency},set:function(e){this._lowPassFrequency=e,this._lowPass.frequency=this._lowPassFrequency}},{key:"load",value:function(e,path){var t=this;return new Promise((function(n){var r=new f.a.Sound(path,(function(){t.add(e,r),n(r)}))}))}},{key:"add",value:function(e,track){this._tracks[e]=track}},{key:"playLandscapeTrack",value:function(e){var t,track=this._tracks[e];track!==this._currentLandscapeTrack&&(null===(t=this._currentLandscapeTrack)||void 0===t||t.pause(),this._previousLandscapeTrack=this._currentLandscapeTrack,this._currentLandscapeTrack=track,this._currentLandscapeTrack.loop=!0,this._currentLandscapeTrack.volume=this._landscapeVolume,this._currentLandscapeTrack.attack=.5,this._currentLandscapeTrack.release=2,this._currentLandscapeTrack.play())}},{key:"playLandscapeEffect",value:function(e){var t;null===(t=this._currentLandscapeEffect)||void 0===t||t.pause(),this._currentLandscapeEffect=this._tracks[e],this._currentLandscapeEffect.volume=this._landscapeVolume,this._currentLandscapeEffect.release=2,this._currentLandscapeEffect.stop(),this._currentLandscapeEffect.play()}},{key:"playLandscapeTransition",value:function(e){var t;null===(t=this._currentLandscapeTransition)||void 0===t||t.pause(),this._currentLandscapeTransition=this._tracks[e],this._currentLandscapeTransition.volume=this._landscapeVolume,this._currentLandscapeTransition.release=2,this._currentLandscapeTransition.stop(),this._currentLandscapeTransition.play()}},{key:"muteLandscape",value:function(){this._landscapeVolume=0,this._currentLandscapeTrack&&h.a.to(this._currentLandscapeTrack,{duration:1,volume:0}),this._currentLandscapeEffect&&h.a.to(this._currentLandscapeEffect,{duration:1,volume:0})}},{key:"unmuteLandscape",value:function(){this._landscapeVolume=1,this._currentLandscapeTrack&&h.a.to(this._currentLandscapeTrack,{duration:2.5,volume:1,ease:"sine.in"}),this._currentLandscapeEffect&&h.a.to(this._currentLandscapeEffect,{duration:2.5,volume:1,ease:"sine.in"})}},{key:"playMainTrack",value:function(){this._mainTrack=this._tracks["audio-main"],this._mainTrack.loop=!0,this._mainTrack.volume=this._mainVolume,this._mainTrack.attack=.5,this._mainTrack.release=2,this._mainTrack.stop(),this._mainTrack.play(),this._mainTrack.addEffect(this._lowPass)}},{key:"muteMain",value:function(){this._mainVolume=0,this._mainTrack&&h.a.to(this._mainTrack,{duration:1,volume:0})}},{key:"unmuteMain",value:function(){this._mainVolume=1,this._mainTrack&&h.a.to(this._mainTrack,{duration:1,volume:1})}},{key:"stop",value:function(){this._current&&this._current.pause()}},{key:"playEffect",value:function(e){var track=this._tracks[e];track.volume=1,track.release=2,track.stop(),track.play()}},{key:"stopEffect",value:function(e){this._tracks[e].stop()}},{key:"toggleMute",value:function(){return this._isMuted?this.unmute():this.mute(),this._isMuted}},{key:"mute",value:function(){this._isMuted||(this._isMuted=!0,h.a.to(f.a,{duration:1,volume:0}))}},{key:"unmute",value:function(){this._isMuted&&(this._isMuted=!1,h.a.to(f.a,{duration:1,volume:1}))}},{key:"_createLowPass",value:function(){return new f.a.Effects.LowPassFilter({frequency:this._lowPassFrequency,peak:1})}},{key:"_bindAll",value:function(){this._visibilityChangeHandler=this._visibilityChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){document.addEventListener(o,this._visibilityChangeHandler,!1)}},{key:"_visibilityChangeHandler",value:function(){var e,t,n,o;this._isMuted||(document[r]?(null===(e=this._mainTrack)||void 0===e||e.pause(),null===(t=this._currentLandscapeTrack)||void 0===t||t.pause(),f.a.volume=0):(f.a.volume=1,null===(n=this._mainTrack)||void 0===n||n.play(),null===(o=this._currentLandscapeTrack)||void 0===o||o.play()))}}]),e}();t.a=new m},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(10);var r=n(2),o=n(3),l=n(4),c=n(5),h=n(1),d=(n(109),n(107));function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(l.a)(n,e);var t=f(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this))._width=null,e._height=null,e._viewportWidth=null,e._viewportHeight=null,e._ghostElement=e._createGhostElement(),e._bindHandlers(),e._setupEventListeners(),e._updateDimensions(),e._updateViewportDimensions(),e._updateCSSHeightVariable(),e}return Object(o.a)(n,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"viewportWidth",get:function(){return this._viewportWidth}},{key:"viewportHeight",get:function(){return this._viewportHeight}},{key:"triggerResize",value:function(){this._debounce()}},{key:"_bindHandlers",value:function(){this._windowResizeHandler=this._windowResizeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){window.addEventListener(this._getResizeEvent(),this._windowResizeHandler)}},{key:"_getResizeEvent",value:function(){return"onorientationchange"in window?"orientationchange":"resize"}},{key:"_createGhostElement",value:function(){var element=document.createElement("div");return element.style.width="100%",element.style.height="100vh",element.style.position="absolute",element.style.top=0,element.style.left=0,element.style.pointerEvents="none",element}},{key:"_updateDimensions",value:function(){document.body.appendChild(this._ghostElement),this._width=this._ghostElement.offsetWidth,this._height=this._ghostElement.offsetHeight,document.body.removeChild(this._ghostElement)}},{key:"_updateViewportDimensions",value:function(){this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight}},{key:"_updateCSSHeightVariable",value:function(){document.documentElement.style.setProperty("--vh","".concat(.01*this._viewportHeight,"px"))}},{key:"_dispatchResizeEvent",value:function(){this.dispatchEvent("resize",{width:this._width,height:this._height})}},{key:"_debounce",value:function(){var e=this;this._debounceTimeout&&clearTimeout(this._debounceTimeout),this._debounceTimeout=setTimeout((function(){e._updateDimensions(),e._updateViewportDimensions(),e._updateCSSHeightVariable(),e._dispatchResizeEvent()}),250)}},{key:"_windowResizeHandler",value:function(){this._debounce()}}]),n}(d.a);t.a=new m},,,,function(e,t,n){"use strict";t.a={dpr:function(){return Math.min(window.devicePixelRatio,2)},isTouch:function(){return"ontouchstart"in window}}},,,,,,,,,,function(e,t,n){"use strict";var r=n(2),o=n(3),l=(n(70),n(110),n(55)),c=n(79),h=function(){function e(){Object(r.a)(this,e),this._active=null,this._bindHandlers(),this._setupEventListeners(),this._resize()}return Object(o.a)(e,[{key:"destroy",value:function(){this._removeEventListeners()}},{key:"current",get:function(){return this._active}},{key:"active",value:function(){for(var i=0,e=arguments.length;i<e;i++)if(arguments[i]===this._active)return!0;return!1}},{key:"rem",value:function(e){return e/(parseInt(c.viewportWidthSmall)/100)/100*parseFloat("medium"===this._active?c.fontSizeMedium:c.fontSizeSmall)*l.a.width}},{key:"reml",value:function(e){return e/(parseInt(c.viewportWidthLarge)/100)/100*parseFloat(c.fontSizeLarge)*l.a.width}},{key:"_bindHandlers",value:function(){this._resizeHandler=this._resizeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){l.a.addEventListener("resize",this._resizeHandler)}},{key:"_removeEventListeners",value:function(){l.a.removeEventListener("resize",this._resizeHandler)}},{key:"_getNameFromDocumentElement",value:function(){return window.getComputedStyle(document.documentElement,":before").content.replace(/"/g,"")}},{key:"_resize",value:function(){this._active=this._getNameFromDocumentElement()}},{key:"_resizeHandler",value:function(){this._resize()}}]),e}();t.a=new h},,,,,,function(e,t,n){"use strict";n(10);var r=n(2),o=n(3),l=n(4),c=n(5),h=n(1),d=n(11),f=n(0),m=n(9);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var _=function(e){Object(l.a)(n,e);var t=v(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(){this._positionZ=0,this._speed=8,this._dummyMain=new f.Object3D,this._dummyRollContainer=new f.Object3D,this._dummyPositionContainer=new f.Object3D,this._dummyIdleContainer=new f.Object3D,this._dummyScrollContainer=new f.Object3D,this.near=.1,this.far=1e3,this.matrixAutoUpdate=!1}},{key:"setup",value:function(){this._debug=this._createDebug()}},{key:"destroy",value:function(){}},{key:"positionZ",get:function(){return this._positionZ}},{key:"copySettings",value:function(e){this.fov=e.fov,this.updateProjectionMatrix()}},{key:"copyRotation",value:function(e){this.matrix.identity(),this._dummyMain.quaternion.copy(e._main.quaternion),this._dummyMain.updateMatrix(),this.applyMatrix4(this._dummyMain.matrix),this._dummyScrollContainer.rotation.copy(e._scrollContainer.rotation),this._dummyScrollContainer.position.copy(e._scrollContainer.position),this._dummyScrollContainer.updateMatrix(),this.applyMatrix4(this._dummyScrollContainer.matrix),this._dummyPositionContainer.position.copy(e._positionContainer.position),this._dummyPositionContainer.updateMatrix(),this.applyMatrix4(this._dummyPositionContainer.matrix),this._dummyIdleContainer.rotation.copy(e._idleContainer.rotation),this._dummyIdleContainer.updateMatrix(),this.applyMatrix4(this._dummyIdleContainer.matrix),this._dummyRollContainer.position.z=this._positionZ,this._dummyRollContainer.position.y=e._introHeightOffset,this._dummyRollContainer.rotation.copy(e._rollContainer.rotation),this._dummyRollContainer.updateMatrix(),this.applyMatrix4(this._dummyRollContainer.matrix),this.updateMatrix()}},{key:"onUpdate",value:function(e){var t=e.delta;this._positionZ-=20*t*this._speed}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this.aspect=t/n,this.updateProjectionMatrix()}},{key:"_createDebug",value:function(){var e=this;if(m.a&&!this._debug){var t=m.a.addGroup("Line camera",{container:"Main"});return t.add(this,"_speed",{label:"speed"}),t.add(this,"fov",{onChange:function(){e.updateProjectionMatrix()}}),t}}}]),n}(Object(d.a)(f.PerspectiveCamera));t.a=new _},,,,function(e,t,n){var content=n(422);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("ddd5c960",content,!0,{sourceMap:!1})},,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"LANDSCAPE_TRANSITION_IN",(function(){return r})),n.d(t,"LANDSCAPE_TRANSITION_OUT",(function(){return o})),n.d(t,"LANDSCAPE_TRANSITION_NONE",(function(){return l})),n.d(t,"THE_END_SHOW",(function(){return c})),n.d(t,"THE_END_HIDE",(function(){return h})),n.d(t,"THE_END_NONE",(function(){return d}));var r="LANDSCAPE_TRANSITION_IN",o="LANDSCAPE_TRANSITION_OUT",l="LANDSCAPE_TRANSITION_NONE",c="THE_END_SHOW",h="THE_END_HIDE",d="THE_END_NONE"},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";t.a={}},function(e,t,n){"use strict";var r=n(2),o=n(3),l=n(348),c=n.n(l),h=function(){function e(){Object(r.a)(this,e),this._browser=c.a.getParser(window.navigator.userAgent)}return Object(o.a)(e,[{key:"isFirefox",value:function(){return this._browser.isBrowser("Firefox")}},{key:"isSafari",value:function(){return this._browser.isBrowser("Safari")}},{key:"isEdge",value:function(){return this._browser.isBrowser("Microsoft Edge")}},{key:"isInternetExplorer",value:function(){return this._browser.isBrowser("Internet explorer")}},{key:"getClassName",value:function(){switch(this._browser.getBrowserName()){case"Firefox":return"firefox";case"Chrome":return"chrome";case"Safari":return"safari";case"Internet Explorer":return"ie"}}},{key:"isValidBrowser",value:function(){return this._browser.satisfies({windows:{"internet explorer":">10"},macos:{safari:">10.1"},mobile:{safari:">=9","android browser":">3.10"}})}}]),e}();t.a=new h},,function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(2),o=n(3),l=(n(89),n(92),n(96),n(74),function(){function e(){Object(r.a)(this,e)}return Object(o.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e,data){if(void 0!==this._listeners){var t=this._listeners[e];if(void 0!==t)for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,data)}}}]),e}())},,,,,,,,function(e,t,n){"use strict";t.a={computed:{lang:function(){return this.$i18n.locale},localeCopy:function(){return this.$t("data")}}}},,,,,,,,,,,function(e,t,n){"use strict";var r=n(114),o=(n(76),n(0)),l=(n(10),n(2)),c=n(3),h=n(6),d=n(4),f=n(5),m=n(1),v=(n(17),n(18),n(7)),_=n(11),y=n(8),x=n(9),w=n(29),S=(n(109),n(346)),C=n(210),O=n.n(C),L=n(25),k=n(175);var M={shuffle:function(a){for(var i=a.length-1;i>0;i--){var e=Math.floor(Math.random()*(i+1)),t=[a[e],a[i]];a[i]=t[0],a[e]=t[1]}return a}},T=n(107),P=n(59),R=n(149);function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var A=function(e){Object(d.a)(n,e);var t=D(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){this._deltaTime=0,this._position={previous:{x:0,y:0},current:{x:0,y:0}},this._dragManager=new R.a({el:window,handleScroll:!1}),this._bindHandlers(),this._setupEventListeners()}},{key:"destroy",value:function(){this._removeEventListeners()}},{key:"velocity",get:function(){var e=this._calcVelocity(this._position.current.x,this._position.previous.x),t=this._calcVelocity(this._position.current.y,this._position.previous.y);return Math.sqrt(e*e+t*t)}},{key:"velocityX",get:function(){return this._calcVelocity(this._position.current.x,this._position.previous.x)}},{key:"velocityY",get:function(){return this._calcVelocity(this._position.current.y,this._position.previous.y)}},{key:"update",value:function(e){this._deltaTime=e,this._position.previous.x=this._position.current.x,this._position.previous.y=this._position.current.y}},{key:"_bindHandlers",value:function(){this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._dragHandler=this._dragHandler.bind(this)}},{key:"_setupEventListeners",value:function(){P.a.isTouch()?this._dragManager.addEventListener("drag",this._dragHandler):window.addEventListener("mousemove",this._mouseMoveHandler)}},{key:"_removeEventListeners",value:function(){P.a.isTouch()?this._dragManager.dispose():window.removeEventListener("mousemove",this._mouseMoveHandler)}},{key:"_calcVelocity",value:function(e,t){if(e===t)return 0;var n=(e-t)/this._deltaTime*10;return isFinite(n)?n:0}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n}},{key:"_mouseMoveHandler",value:function(e){this._position.current.x=e.clientX/this._width*2-1,this._position.current.y=-e.clientY/this._height*2+1}},{key:"_dragHandler",value:function(e){this._position.current.x=e.position.x/this._width*2-1,this._position.current.y=-e.position.y/this._height*2+1}}]),n}(Object(_.a)()),E=n(69);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var j=-.25*Math.PI,F=function(e){Object(d.a)(n,e);var t=I(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._root=e.root,this._renderer=e.renderer,this._scene=e.scene,this._debugContainer=e.debugContainer,this._near=e.near,this._far=e.far,this._fov=e.fov||(E.a.active("small")?110:80),this._dollyHeight=e.dollyHeight||0,this._dollyStartPosition=e.dollyStartPosition||0,this._dollyEndPosition=e.dollyEndPosition||1e3,this._dollySpeed=e.dollySpeed||4,this._pathPoints=e.path,this._pathEnd=e.pathEnd||.8,this._triggerChangeEvent=void 0===e.triggerChangeEvent||e.triggerChangeEvent,this._menuPositions=e.menuPositions||[],this._heightOffset=e.heightOffset||0,this._enableIdleAnimation=void 0!==e.enableIdleAnimation&&e.enableIdleAnimation,this._settings={active:"",yaw:{angle:36,damping:.05},pitch:{angle:36,damping:.05},roll:{speedModifier:-.006,rotationDamping:.08,damping:.08},idle:{angle:2,speed:.1,damping:.5},position:{xRange:-5,xDamping:.08,yRange:-3,yDamping:.08},touchSensibility:3},this._isEnabled=!1,this._pathProgress=0,this._isDollyMovementActive=!1,this._isDollyCompleteEventTriggered=!1,this._active=null,this._rollRotation=0,this._lockMainCamera=!1,this._root.nuxtRoot.$store.getters["context/isProduction"]&&(this._lockMainCamera=!1),this._scrollProgress=0,this._rotationOffset=0,this._introHeightOffset=0,this._mouseVelocity=new A,this._cameraEuler=new o.Euler(0,0,0,"YXZ"),this._mousePosition=new o.Vector2,this._dragStartPosition=new o.Vector2,this._dragCurrentPosition=new o.Vector2,this._dragPosition=new o.Vector2,this._simplex=new O.a("mardi8"),this._menuOrder=[],this._debugger=this._createDebugger(),this._rollContainer=this._createRollContainer(),this._idleContainer=this._createIdleContainer(),this._positionContainer=this._createPositionContainer(),this._main=this._createMain(),this._scrollContainer=this._createScrollContainer(),this._debug=this._createDebug(),this._debugControls=this._createDebugControls(),this._menuContainer=this._createMenuContainer(),this._menu=this._createMenu(),this._path=this._createPath(this._pathPoints),this._activateMain(),this._activateDebug(),this._bindHandlers(),this._setupEventListeners(),document.body.addEventListener("touchmove",(function(e){e.preventDefault()}))}},{key:"destroy",value:function(){this._removeEventListeners(),this._mouseVelocity.destroy()}},{key:"active",get:function(){return this._active}},{key:"main",get:function(){return this._main}},{key:"debug",get:function(){return this._debug}},{key:"menu",get:function(){return this._menu}},{key:"debugControls",get:function(){return this._debugControls}},{key:"isLocked",get:function(){return this._lockMainCamera}},{key:"dollyHeight",get:function(){return this._dollyHeight}},{key:"position",get:function(){return this._rollContainer.position}},{key:"scrollProgress",get:function(){return this._scrollProgress},set:function(e){this._scrollProgress=e}},{key:"dollyStartPosition",get:function(){return this._dollyStartPosition}},{key:"dollyEndPosition",get:function(){return this._dollyEndPosition}},{key:"dollySpeed",get:function(){return this._dollySpeed}},{key:"pathPoints",get:function(){return this._pathPoints}},{key:"rollContainer",get:function(){return this._rollContainer}},{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"playIntro",value:function(){var e=new v.a.timeline;return e.fromTo(this,{_introHeightOffset:300},{duration:6,_introHeightOffset:0,ease:"power2.inOut"},0),e.fromTo(this,{_rotationOffset:-.1*Math.PI},{duration:6,_rotationOffset:0,ease:"power2.inOut"},0),e}},{key:"startDolly",value:function(){this._isDollyMovementActive=!0}},{key:"stopDolly",value:function(){this._isDollyMovementActive=!1}},{key:"activateMain",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&this.startDolly(),setTimeout((function(){e._activateMain()}),16)}},{key:"activateDebug",value:function(){this._activateDebug()}},{key:"getNextMenuIndex",value:function(){return this._getNextMenuIndex()}},{key:"activateMenu",value:function(e){this.stopDolly(),this._updateMenuPosition(e),this._activateMenu()}},{key:"reset",value:function(){this._pathProgress=this._dollyStartPosition,this._rollContainer.position.z=this._dollyStartPosition,this._isDollyCompleteEventTriggered=!1,this._scrollProgress=0}},{key:"copyData",value:function(e){this._rollContainer.position.copy(e._rollContainer.position),this._positionContainer.position.copy(e._positionContainer.position),this._cameraEuler.copy(e._cameraEuler),this._main.quaternion.setFromEuler(this._cameraEuler),this._rollContainer.rotation.z=e._rollContainer.rotation.z,this._rollContainer.rotation.copy(e._rollContainer.rotation),this._idleContainer.rotation.copy(e._idleContainer.rotation),this._scrollContainer.position.copy(e._scrollContainer.position)}},{key:"_bindHandlers",value:function(){this._wheelHandler=this._wheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this),this._dragstartHandler=this._dragstartHandler.bind(this),this._dragHandler=this._dragHandler.bind(this),this._dragendHandler=this._dragendHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._dragManager=new R.a({el:window,handleScroll:!1}),this._dragManager.addEventListener("dragstart",this._dragstartHandler),this._dragManager.addEventListener("drag",this._dragHandler),this._dragManager.addEventListener("dragend",this._dragendHandler),this._renderer.domElement.addEventListener("wheel",this._wheelHandler),window.addEventListener("mousemove",this._mouseMoveHandler),this._root.nuxtRoot.$store.getters["context/isDevelopment"]&&window.addEventListener("keydown",this._keyDownHandler)}},{key:"_removeEventListeners",value:function(){this._dragManager.dispose(),this._renderer.domElement.removeEventListener("wheel",this._wheelHandler),window.removeEventListener("mousemove",this._mouseMoveHandler),this._root.nuxtRoot.$store.getters["context/isDevelopment"]&&window.removeEventListener("keydown",this._keyDownHandler)}},{key:"_createMain",value:function(){var e=new o.PerspectiveCamera(this._fov,1,this._near,this._far);if(this._debugger){var t=this._debugger.addGroup("Main camera");t.add(e,"fov",{min:0,max:170,onChange:function(){e.updateProjectionMatrix()}}),t.add(e,"near",{stepSize:1,onChange:function(){e.updateProjectionMatrix()}}),t.add(e,"far",{stepSize:1,onChange:function(){e.updateProjectionMatrix()}}),t.add(e.position,"z",{label:"depth",stepSize:.5,listen:!0}),t.add(this,"_heightOffset",{label:"height",stepSize:1})}return e}},{key:"_createMainHelper",value:function(){var e=new o.CameraHelper(this._main);return e.visible=!1,this._scene.add(e),e}},{key:"_createRollContainer",value:function(){var e=new o.Object3D;return e.position.y=this._dollyHeight,e.position.z=this._dollyStartPosition,this._scene.add(e),e}},{key:"_createIdleContainer",value:function(){var e=new o.Object3D;return this._rollContainer.add(e),e}},{key:"_createPositionContainer",value:function(){var e=new o.Object3D;return this._idleContainer.add(e),e}},{key:"_createScrollContainer",value:function(){var e=new o.Object3D;if(e.add(this._main),this._positionContainer.add(e),this._debugger){var t=this._debugger.addGroup("Scroll"),n=t.addGroup("Rotation");n.add(e.rotation,"x"),n.add(e.rotation,"y"),n.add(e.rotation,"z"),t.add(e,"position",{stepSize:1}),t.add(this,"_scrollProgress",{label:"progress",min:0,max:1})}return e}},{key:"_createDebug",value:function(){var e=new o.PerspectiveCamera(this._fov,1,this._near,this._far),t=JSON.parse(localStorage.getItem("camera-debug-position"));if(t?(e.position.x=t.x,e.position.y=t.y,e.position.z=t.z):(e.position.y=100,e.position.z=1e3),this._debugger){var n=this._debugger.addGroup("Debug camera");n.add(e.rotation,"x"),n.add(e.rotation,"y"),n.add(e.rotation,"z")}return e}},{key:"_createDebugControls",value:function(){var e=new S.a(this._debug,this._renderer.domElement);e.screenSpacePanning=!0,e.enabled=!1;var t=JSON.parse(localStorage.getItem("camera-debug-target"));return t&&(e.target.x=t.x,e.target.y=t.y,e.target.z=t.z),e.update(),e}},{key:"_createMenuContainer",value:function(){var e=new o.Object3D;return this._scene.add(e),e}},{key:"_createMenu",value:function(){var e=this,t=new o.PerspectiveCamera(this._fov,1,this._near,this._far);if(this._debugger){for(var n={options:0,lookAt:new o.Vector3},r=[],i=0,l=this._menuPositions.length;i<l;i++)r.push(i);var c=this._debugger.addGroup("Menu");c.add(n,"options",{options:r,onChange:function(){e._updateMenuPosition(n.options),e._activateMenu()}}),c.add(t,"position",{stepSize:1,listen:!0}),c.add(n.lookAt,"x",{stepSize:1,listen:!0,label:"target x",onChange:function(){t.lookAt(n.lookAt)}}),c.add(n.lookAt,"y",{stepSize:1,listen:!0,label:"target y",onChange:function(){t.lookAt(n.lookAt)}}),c.add(n.lookAt,"z",{stepSize:1,listen:!0,label:"target z",onChange:function(){t.lookAt(n.lookAt)}})}return this._menuContainer.add(t),t}},{key:"_createPath",value:function(path){if(path){for(var e,t=[],i=0,n=path.length;i<n;i++)e=path[i],t.push(new o.Vector3(e[0],e[1],e[2]));return new o.CatmullRomCurve3(t)}}},{key:"_createPathHelper",value:function(){if(this._path){var e=this._path.getPoints(50),t=(new o.BufferGeometry).setFromPoints(e),n=new o.LineBasicMaterial({color:16711680}),r=new o.Line(t,n);return this._scene.add(r),r}}},{key:"_activateMain",value:function(){this._active=this._main,this._mainHelper&&(this._mainHelper.visible=!1),this._pathHelper&&(this._pathHelper.visible=!1),this._debugControls&&(this._debugControls.enabled=!1),this._settings.active="main",this._triggerBiddeloChangeEvent("main")}},{key:"_activateDebug",value:function(){this._active=this._debug,this._mainHelper&&(this._mainHelper.visible=!0),this._pathHelper&&(this._pathHelper.visible=!0),this._debugControls&&(this._debugControls.enabled=!0),this._settings.active="debug",this._triggerBiddeloChangeEvent("debug")}},{key:"_activateMenu",value:function(){this._active=this._menu,this._settings.active="menu",this._triggerBiddeloChangeEvent("menu")}},{key:"_getNextMenuIndex",value:function(){if(0===this._menuOrder.length){for(var i=0,e=this._menuPositions.length;i<e;i++)this._menuOrder.push(i);this._menuOrder=M.shuffle(this._menuOrder),this._menuOrder[0]===this._listMenuIndex&&this._menuOrder.push(this._menuOrder.shift())}return this._menuOrder.shift()}},{key:"_updateMenuPosition",value:function(e){this._listMenuIndex=e;var data=this._menuPositions[e];return this._menuContainer.position.set(0,0,0),this._menuContainer.rotation.set(0,0,0),this._menu.position.set(0,0,0),this._menu.rotation.set(0,0,0),this._menuContainer.position.copy(data.position),data.rotation?(this._menuContainer.lookAt(data.target),this._menuContainer.rotation.copy(data.rotation)):this._menu.lookAt(data.target),e}},{key:"_triggerBiddeloChangeEvent",value:function(e){this._triggerChangeEvent}},{key:"_triggerDollyCompleteEvent",value:function(){this._isDollyCompleteEventTriggered||(this._isDollyCompleteEventTriggered=!0,this.dispatchEvent("dolly:complete"))}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._isEnabled&&(this._isDollyMovementActive&&(this._path?(this._pathProgress+=1.5*this._dollySpeed,this._pathProgress>this._pathEnd&&this._triggerDollyCompleteEvent()):(this._rollContainer.position.z-=1.5*this._dollySpeed,this._rollContainer.position.z<=this._dollyEndPosition&&this._triggerDollyCompleteEvent())),this._path&&this._pathProgress<=1&&(this._rollContainer.position.copy(this._path.getPointAt(this._pathProgress)),this._rollContainer.position.y+=this._introHeightOffset+this._heightOffset),this._lockMainCamera||(this._positionContainer.position.x=L.a.lerp(this._positionContainer.position.x,this._mousePosition.x*this._settings.position.xRange,this._settings.position.xDamping)*(1-this._scrollProgress),this._positionContainer.position.y=L.a.lerp(this._positionContainer.position.y,this._mousePosition.y*this._settings.position.yRange,this._settings.position.yDamping)*(1-this._scrollProgress),this._cameraEuler.setFromQuaternion(this._main.quaternion),this._cameraEuler.y=L.a.lerp(this._cameraEuler.y,this._mousePosition.x*k.a.degreesToRadians(-this._settings.yaw.angle),this._settings.yaw.damping)*(1-this._scrollProgress),this._cameraEuler.x=L.a.lerp(this._cameraEuler.x,this._mousePosition.y*k.a.degreesToRadians(this._settings.pitch.angle),this._settings.pitch.damping)*(1-this._scrollProgress),this._main.quaternion.setFromEuler(this._cameraEuler),this._rollRotation=L.a.lerp(this._rollRotation,this._mouseVelocity.velocityX*this._settings.roll.speedModifier,this._settings.roll.rotationDamping)*(1-this._scrollProgress),this._rollContainer.rotation.z=L.a.lerp(this._rollContainer.rotation.z,this._rollRotation,this._settings.roll.damping),this._idleContainer.rotation.z=L.a.lerp(this._idleContainer.rotation.z,this._simplex.noise2D(time*this._settings.idle.speed,time*this._settings.idle.speed)*k.a.degreesToRadians(this._settings.idle.angle),this._settings.idle.damping)*(1-this._scrollProgress),this._mouseVelocity.update(t)),this._scrollContainer.rotation.x=j*this._scrollProgress+this._rotationOffset,this._scrollContainer.position.y=50*this._scrollProgress)}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeMain(),this._resizeDebug(),this._resizeMenu()}},{key:"_resizeMain",value:function(){this._main.aspect=this._width/this._height,this._main.updateProjectionMatrix()}},{key:"_resizeDebug",value:function(){this._debug.aspect=this._width/this._height,this._debug.updateProjectionMatrix()}},{key:"_resizeMenu",value:function(){this._menu.aspect=this._width/this._height,this._menu.updateProjectionMatrix()}},{key:"_wheelHandler",value:function(e){if(this._isEnabled&&this._active===this._main)if(this._path){var t=1e-4*e.deltaY;this._pathProgress-=t,this._pathProgress=k.a.clamp(this._pathProgress,0,1)}else{var n=.5*e.deltaY;this._rollContainer.position.z+=n}}},{key:"_mouseMoveHandler",value:function(e){P.a.isTouch()||(this._mousePosition.x=e.clientX/this._width*2-1,this._mousePosition.y=-e.clientY/this._height*2+1)}},{key:"_keyDownHandler",value:function(e){76===e.keyCode&&(this._lockMainCamera=!this._lockMainCamera),32===e.keyCode&&(this._isDollyMovementActive=!this._isDollyMovementActive)}},{key:"_dragstartHandler",value:function(e){var t;P.a.isTouch()&&(this._dragStartPosition.x=e.position.x,this._dragStartPosition.y=e.position.y,null===(t=this._timelineDragend)||void 0===t||t.kill())}},{key:"_dragHandler",value:function(e){if(P.a.isTouch()){this._dragCurrentPosition.x=e.position.x,this._dragCurrentPosition.y=e.position.y;var t=Math.min(this._dragStartPosition.distanceTo(this._dragCurrentPosition),150),n=Math.atan2(this._dragStartPosition.y-this._dragCurrentPosition.y,this._dragStartPosition.x-this._dragCurrentPosition.x);this._dragPosition.x=-t*Math.cos(n),this._dragPosition.y=t*Math.sin(n),this._mousePosition.x=this._dragPosition.x/(this._width/this._settings.touchSensibility),this._mousePosition.y=this._dragPosition.y/(this._width/this._settings.touchSensibility)}}},{key:"_dragendHandler",value:function(){P.a.isTouch()&&(this._timelineDragend=new v.a.timeline,this._timelineDragend.to(this._dragPosition,{duration:1,x:0,y:0,ease:"power2.out"},0),this._timelineDragend.to(this._mousePosition,{duration:1,x:0,y:0,ease:"power2.out"},0))}},{key:"_createDebugger",value:function(){var e=this;if(x.a&&this._debugContainer){var t=x.a.addGroup("Camera",{container:this._debugContainer});t.add(this._settings,"active",{options:["main","debug","menu"],listen:!0,onChange:function(){switch(e._settings.active){case"main":e._activateMain();break;case"debug":e._activateDebug();break;case"menu":e._updateMenuPosition(0),e._activateMenu()}}}),t.addButton("Save debug position",{onClick:function(){localStorage.setItem("camera-debug-position",JSON.stringify(e._debug.position)),localStorage.setItem("camera-debug-target",JSON.stringify(e._debugControls.target))}}),t.addButton("Reset debug position",{onClick:function(){localStorage.removeItem("camera-debug-position"),localStorage.removeItem("camera-debug-target")}}),t.addButton("Log debug position",{onClick:function(){console.log(e._debug),console.log(e._debug.target),console.log("\n                    {\n                        position: new Vector3(".concat(e._debug.position.x,", ").concat(e._debug.position.y,", ").concat(e._debug.position.z,"),\n                        rotation: new Euler(").concat(e._debug.rotation.x,", ").concat(e._debug.rotation.y,", ").concat(e._debug.rotation.z,"),\n                        target: new Vector3(").concat(e._debugControls.target.x,", ").concat(e._debugControls.target.y,", ").concat(e._debugControls.target.z,"),\n                    },\n                "))}});var n=t.addGroup("Dolly");n.add(this,"_dollySpeed",{label:"speed",stepSize:1e-4}),n.add(this._settings,"touchSensibility",{stepSize:.01,min:0,max:10});var r=t.addGroup("Position");r.add(this._settings.position,"xRange"),r.add(this._settings.position,"xDamping",{min:0,max:1}),r.add(this._settings.position,"yRange"),r.add(this._settings.position,"yDamping",{min:0,max:1});var o=t.addGroup("Rotation"),l=o.addGroup("Yaw");l.add(this._settings.yaw,"angle",{stepSize:1}),l.add(this._settings.yaw,"damping");var c=o.addGroup("Pitch");c.add(this._settings.pitch,"angle",{stepSize:1}),c.add(this._settings.pitch,"damping");var h=o.addGroup("Roll");h.add(this._settings.roll,"speedModifier",{stepSize:.001}),h.add(this._settings.roll,"rotationDamping",{stepSize:.001}),h.add(this._settings.roll,"damping",{stepSize:.001});var d=o.addGroup("Idle");return d.add(this._settings.idle,"angle",{stepSize:.1}),d.add(this._settings.idle,"speed",{stepSize:.01}),d.add(this._settings.idle,"damping",{stepSize:.01,min:0,max:1}),t}}}]),n}(Object(_.a)(T.a)),B=n(75);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var N="TYPE_LINEAR",z="TYPE_EXP",G="TYPE_EXP2",H="TYPE_GROUND",V="TYPE_COMBINED",W=function(e){Object(d.a)(n,e);var t=U(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this))._visible=!0,e._type=r.type||N,e._color=r.color,e._density=r.density||0,e._height=r.height||0,e._globalStrength=r.globalStrength||0,e._near=r.near||0,e._far=r.far||0,e._animation=r.animation||!1,e._animationScale=r.animationScale||1,e._animationSpeed=r.animationSpeed||0,e._animationDepth=r.animationDepth||0,e._sun=null,e._sides=r.sides||!1,e._sideNear=r.sideNear||0,e._sideFar=r.sideFar||0,e._ravineLight=r.ravineLight||!1,e._ravineLightColor=r.ravineLightColor||null,e._ravineLightPosition=r.ravineLightPosition||null,e._ravineLightMaxDistance=r.ravineLightMaxDistance,e._ravineLightDecay=r.ravineLightDecay,e._ravineLightIntensity=r.ravineLightIntensity,e._envMap=r.envMap,e}return Object(c.a)(n,[{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this._triggerChangeEvent()}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._triggerChangeEvent()}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._triggerChangeEvent()}},{key:"density",get:function(){return this._density},set:function(e){this._density=e,this._triggerChangeEvent()}},{key:"height",get:function(){return this._height},set:function(e){this._height=e,this._triggerChangeEvent()}},{key:"globalStrength",get:function(){return this._globalStrength},set:function(e){this._globalStrength=e,this._triggerChangeEvent()}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._triggerChangeEvent()}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._triggerChangeEvent()}},{key:"animation",get:function(){return this._animation},set:function(e){this._animation=e,this._triggerChangeEvent()}},{key:"animationScale",get:function(){return this._animationScale},set:function(e){this._animationScale=e,this._triggerChangeEvent()}},{key:"animationSpeed",get:function(){return this._animationSpeed},set:function(e){this._animationSpeed=e,this._triggerChangeEvent()}},{key:"animationDepth",get:function(){return this._animationDepth},set:function(e){this._animationDepth=e,this._triggerChangeEvent()}},{key:"sun",get:function(){return this._sun}},{key:"sides",get:function(){return this._sides},set:function(e){this._sides=e,this._triggerChangeEvent()}},{key:"sideNear",get:function(){return this._sideNear},set:function(e){this._sideNear=e,this._triggerChangeEvent()}},{key:"sideFar",get:function(){return this._sideFar},set:function(e){this._sideFar=e,this._triggerChangeEvent()}},{key:"ravineLight",get:function(){return this._ravineLight},set:function(e){this._ravineLight=e,this._triggerChangeEvent()}},{key:"ravineLightColor",get:function(){return this._ravineLightColor},set:function(e){this._ravineLightColor=e,this._triggerChangeEvent()}},{key:"ravineLightPosition",get:function(){return this._ravineLightPosition},set:function(e){this._ravineLightPosition=e,this._triggerChangeEvent()}},{key:"ravineLightMaxDistance",get:function(){return this._ravineLightMaxDistance},set:function(e){this._ravineLightMaxDistance=e,this._triggerChangeEvent()}},{key:"ravineLightDecay",get:function(){return this._ravineLightDecay},set:function(e){this._ravineLightDecay=e,this._triggerChangeEvent()}},{key:"ravineLightIntensity",get:function(){return this._ravineLightIntensity},set:function(e){this._ravineLightIntensity=e,this._triggerChangeEvent()}},{key:"envMap",get:function(){return this._envMap},set:function(e){this._envMap=e,this._triggerChangeEvent()}},{key:"addSun",value:function(e){var t=this;this._sun=e,this._triggerChangeEvent(),this._sun.addEventListener("change",(function(){return t._triggerChangeEvent()}))}},{key:"clone",value:function(){var e=new this.constructor;return e.visible=this.visible,e.type=this.type,e.color=this.color.clone(),e.density=this.density,e.height=this.height,e.globalStrength=this.globalStrength,e.near=this.near,e.far=this.far,e.animation=this.animation,e.animationScale=this.animationScale,e.animationSpeed=this.animationSpeed,e.animationDepth=this.animationDepth,e.sides=this.sides,e.sideNear=this.sideNear,e.sideFar=this.sideFar,e}},{key:"_triggerChangeEvent",value:function(){this.dispatchEvent("change",this)}}]),n}(T.a),$=(n(30),{forest:{type:"image",items:[{type:"image",name:"envmap/forest/px",path:"/webgl/scenes/shared/envmaps/forest/px.png"},{type:"image",name:"envmap/forest/nx",path:"/webgl/scenes/shared/envmaps/forest/nx.png"},{type:"image",name:"envmap/forest/py",path:"/webgl/scenes/shared/envmaps/forest/py.png"},{type:"image",name:"envmap/forest/ny",path:"/webgl/scenes/shared/envmaps/forest/ny.png"},{type:"image",name:"envmap/forest/pz",path:"/webgl/scenes/shared/envmaps/forest/pz.png"},{type:"image",name:"envmap/forest/nz",path:"/webgl/scenes/shared/envmaps/forest/nz.png"}]},"rocky-desert":{type:"hdr",items:[{type:"hdr",name:"envmap/rocky-desert/px",path:"/webgl/scenes/shared/envmaps/rocky-desert/px.hdr"},{type:"hdr",name:"envmap/rocky-desert/nx",path:"/webgl/scenes/shared/envmaps/rocky-desert/nx.hdr"},{type:"hdr",name:"envmap/rocky-desert/py",path:"/webgl/scenes/shared/envmaps/rocky-desert/py.hdr"},{type:"hdr",name:"envmap/rocky-desert/ny",path:"/webgl/scenes/shared/envmaps/rocky-desert/ny.hdr"},{type:"hdr",name:"envmap/rocky-desert/pz",path:"/webgl/scenes/shared/envmaps/rocky-desert/pz.hdr"},{type:"hdr",name:"envmap/rocky-desert/nz",path:"/webgl/scenes/shared/envmaps/rocky-desert/nz.hdr"}]},"night-sky":{type:"cubemap",items:[{type:"basis",name:"envmap/night-sky/cubemap",path:"/webgl/scenes/shared/envmaps/night-sky/cubemap.basis"}]},mars:{type:"hdr",items:[{type:"hdr",name:"envmap/mars/px",path:"/webgl/scenes/shared/envmaps/mars/px.hdr"},{type:"hdr",name:"envmap/mars/nx",path:"/webgl/scenes/shared/envmaps/mars/nx.hdr"},{type:"hdr",name:"envmap/mars/py",path:"/webgl/scenes/shared/envmaps/mars/py.hdr"},{type:"hdr",name:"envmap/mars/ny",path:"/webgl/scenes/shared/envmaps/mars/ny.hdr"},{type:"hdr",name:"envmap/mars/pz",path:"/webgl/scenes/shared/envmaps/mars/pz.hdr"},{type:"hdr",name:"envmap/mars/nz",path:"/webgl/scenes/shared/envmaps/mars/nz.hdr"}]},"sun-set":{type:"hdr",items:[{type:"hdr",name:"envmap/sun-set/px",path:"/webgl/scenes/shared/envmaps/sun-set/px.hdr"},{type:"hdr",name:"envmap/sun-set/nx",path:"/webgl/scenes/shared/envmaps/sun-set/nx.hdr"},{type:"hdr",name:"envmap/sun-set/py",path:"/webgl/scenes/shared/envmaps/sun-set/py.hdr"},{type:"hdr",name:"envmap/sun-set/ny",path:"/webgl/scenes/shared/envmaps/sun-set/ny.hdr"},{type:"hdr",name:"envmap/sun-set/pz",path:"/webgl/scenes/shared/envmaps/sun-set/pz.hdr"},{type:"hdr",name:"envmap/sun-set/nz",path:"/webgl/scenes/shared/envmaps/sun-set/nz.hdr"}]},"golden-hour":{type:"cubemap",items:[{type:"basis",name:"envmap/golden-hour/cubemap",path:"/webgl/scenes/shared/envmaps/golden-hour/cubemap.basis"}]},ocean:{type:"image",items:[{type:"image",name:"envmap/ocean/px",path:"/webgl/scenes/shared/envmaps/ocean/px.png"},{type:"image",name:"envmap/ocean/nx",path:"/webgl/scenes/shared/envmaps/ocean/nx.png"},{type:"image",name:"envmap/ocean/py",path:"/webgl/scenes/shared/envmaps/ocean/py.png"},{type:"image",name:"envmap/ocean/ny",path:"/webgl/scenes/shared/envmaps/ocean/ny.png"},{type:"image",name:"envmap/ocean/pz",path:"/webgl/scenes/shared/envmaps/ocean/pz.png"},{type:"image",name:"envmap/ocean/nz",path:"/webgl/scenes/shared/envmaps/ocean/nz.png"}]}});function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var X=function(e){Object(d.a)(n,e);var t=Y(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._renderer=e.renderer,this._active=e.name,this._debugContainer=e.debugContainer,this._renderTarget=null,this._debug=this._createDebug(),this._resourceManager=new y.c,this._pmremGenerator=this._createPmremGenerator(),this._cubeTexture=this._createCubeTexture(e.name),this._generateMap(e.name)}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._renderTarget&&this._renderTarget.dispose(),this._cubeTexture&&this._cubeTexture.dispose()}},{key:"texture",get:function(){return this._renderTarget.texture}},{key:"cubeTexture",get:function(){return this._cubeTexture}},{key:"_createPmremGenerator",value:function(){var e=new o.PMREMGenerator(this._renderer);return e.compileCubemapShader(),e}},{key:"_generateMap",value:function(e){this._active=e,this._cubeTexture=this._createCubeTexture(e),this._renderTarget=this._createRenderTarget(this._cubeTexture),this.dispatchEvent("change",{map:this._renderTarget.texture,cubeTexture:this._cubeTexture})}},{key:"_createCubeTexture",value:function(e){if("cubemap"===$[e].type){var t=y.b.get($[e].items[0].name);return t.encoding=o.sRGBEncoding,t}var n=this._getImages(e),r=new o.CubeTexture(n);return r.encoding=o.sRGBEncoding,r.format=o.RGBAFormat,r.minFilter=o.LinearFilter,r.magFilter=o.LinearFilter,r.generateMipmaps=!1,r.needsUpdate=!0,r}},{key:"_getImages",value:function(e){for(var t=$[e].items,n=[],i=0,r=t.length;i<r;i++)if("image"===t[i].type){var o=y.b.get(t[i].name);n.push(o)}else n.push(y.b.get(t[i].name));return n}},{key:"_createRenderTarget",value:function(e){return this._pmremGenerator.fromCubemap(e)}},{key:"_changeMap",value:function(e){for(var t,n=this,r="envmap/".concat(e,"/px"),o=y.b.resources,l=!1,i=0,c=o.length;i<c;i++)(t=o[i]).name===r&&t.data&&(l=!0);l?this._generateMap(e):(this._resourceManager.add($[e].items),this._resourceManager.load().then((function(){n._generateMap(e)})))}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t={selected:this._active},n=x.a.addGroup("Env map",{container:this._debugContainer});return n.add(t,"selected",{label:"active",options:Object.keys($),onChange:function(){e._changeMap(t.selected)}}),n}}}]),n}(Object(_.a)(T.a));n(85);function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Q=function(e){Object(d.a)(n,e);var t=K(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.fog,c=r.vertexShader,h=r.fragmentShader,d=r.uniforms,f=r.side,m=r.depthTest,v=void 0===m||m,_=r.depthWrite,y=void 0===_||_,x=r.blending,w=r.transparent,S=r.polygonOffset,C=r.polygonOffsetFactor,O=r.wireframe;return Object(l.a)(this,n),(e=t.call(this)).fog=o,c&&(e.vertexShader=c),h&&(e.fragmentShader=h),e.defines.DISTANCE="",e.uniforms=d||{},e.uniforms.fogTime={value:0},f&&(e.side=f),void 0!==v&&(e.depthTest=v),void 0!==y&&(e.depthWrite=y),void 0!==x&&(e.blending=x),void 0!==w&&(e.transparent=w),void 0!==S&&(e.polygonOffset=S),void 0!==C&&(e.polygonOffsetFactor=C),void 0!==O&&(e.wireframe=O),e._bindHandlers(),e._setupEventListeners(),e.uniforms.fogActive={value:!1},e.fog&&(e._updateDefines(e.fog),e._updateUniforms(e.fog)),e}return Object(c.a)(n,[{key:"destroy",value:function(){this._removeEventListeners()}},{key:"enableFog",value:function(){this.uniforms.fogActive.value=!0}},{key:"disableFog",value:function(){this.uniforms.fogActive.value=!1}},{key:"_bindHandlers",value:function(){this._fogChangeHandler=this._fogChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this.fog&&this.fog.addEventListener("change",this._fogChangeHandler)}},{key:"_removeEventListeners",value:function(){this.fog&&this.fog.removeEventListener("change",this._fogChangeHandler)}},{key:"_updateDefines",value:function(e){if(delete this.defines.USE_CUSTOM_FOG,delete this.defines.FOG_LINEAR,delete this.defines.FOG_EXP,delete this.defines.FOG_EXP2,delete this.defines.FOG_GROUND,delete this.defines.FOG_COMBINED,delete this.defines.FOG_ANIMATE,delete this.defines.FOG_USE_SUN,delete this.defines.FOG_SIDES,delete this.defines.FOG_RAVINE_LIGHT,e&&e.visible){switch(this.defines.USE_CUSTOM_FOG="",e.type){case N:this.defines.FOG_LINEAR="";break;case z:this.defines.FOG_EXP="";break;case G:this.defines.FOG_EXP2="";break;case H:this.defines.FOG_GROUND="";break;case V:this.defines.FOG_COMBINED=""}e.animation&&(this.defines.FOG_ANIMATE=""),e.sun&&(this.defines.FOG_USE_SUN=""),e.sides&&(this.defines.FOG_SIDES=""),e.ravineLight&&(this.defines.FOG_RAVINE_LIGHT="")}this.needsUpdate=!0}},{key:"_updateUniforms",value:function(e){this.uniforms.fogActive={value:e.visible},this.uniforms.fogColor={value:e.color},this.uniforms.fogDensity={value:e.density},this.uniforms.fogHeight={value:e.height},this.uniforms.fogGlobalStrength={value:e.globalStrength},this.uniforms.fogNear={value:e.near},this.uniforms.fogFar={value:e.far},e.animation&&(this.uniforms.fogAnimationScale={value:e.animationScale},this.uniforms.fogAnimationSpeed={value:e.animationSpeed},this.uniforms.fogAnimationDepth={value:e.animationDepth}),e.sun&&(this.uniforms.sunPosition={value:e.sun.position},this.uniforms.sunColor={value:e.sun.color},this.uniforms.sunStrength={value:e.sun.strength}),e.sides&&(this.uniforms.fogSideNear={value:e.sideNear},this.uniforms.fogSideFar={value:e.sideFar}),e.ravineLight&&(this.uniforms.ravineLightColor={value:e.ravineLightColor},this.uniforms.ravineLightPosition={value:e.ravineLightPosition},this.uniforms.ravineLightMaxDistance={value:e.ravineLightMaxDistance},this.uniforms.ravineLightDecay={value:e.ravineLightDecay},this.uniforms.ravineLightIntensity={value:e.ravineLightIntensity})}},{key:"onUpdate",value:function(e){var time=e.time;this.uniforms.fogTime&&(this.uniforms.fogTime.value=time)}},{key:"_fogChangeHandler",value:function(e){this._updateDefines(e),this._updateUniforms(e)}}]),n}(Object(_.a)(o.ShaderMaterial)),Z="#define GLSLIFY 1\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#ifdef USE_TRANSMISSION\n\n    varying vec4 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n        vNormal = normalize( transformedNormal );\n\n        #ifdef USE_TANGENT\n\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n        #endif\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    #ifdef USE_TRANSMISSION\n\n        vWorldPosition = worldPosition;\n\n    #endif\n}\n",J="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform vec2 uNormalMapRepeat;\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n    return mix(1.0 - 2.0 * (1.0 - base) * (1.0 - blend), 2.0 * base * blend, step(base, vec3(0.5)));\n}\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n\n    #ifdef OBJECTSPACE_NORMALMAP\n        normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n        #ifdef FLIP_SIDED\n            normal = - normal;\n        #endif\n        #ifdef DOUBLE_SIDED\n            normal = normal * faceDirection;\n        #endif\n        normal = normalize( normalMatrix * normal );\n    #elif defined( TANGENTSPACE_NORMALMAP )\n        vec3 mapN = texture2D( normalMap, vUv * uNormalMapRepeat ).xyz * 2.0 - 1.0;\n        mapN.xy *= normalScale;\n        #ifdef USE_TANGENT\n            normal = normalize( vTBN * mapN );\n        #else\n            normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n        #endif\n    #elif defined( USE_BUMPMAP )\n        normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n    #endif\n\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var te=function(e){Object(d.a)(n,e);var t=ee(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{emissive:{value:new o.Color(0)},roughness:{value:void 0===r.roughness?1:r.roughness},metalness:{value:void 0===r.metalness?0:r.metalness}},{uNormalMapRepeat:{value:void 0===r.normalMapRepeat?new o.Vector2(1,1):r.normalMapRepeat}}]),e.name=r.name||null,r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.normalMap=r.normalMap,e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap]),e.roughnessMap=r.roughnessMap),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),r.envMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.envmap]),e.envMap=r.envMap),e.map&&(e.uniforms.map.value=r.map),e.normalMap&&(e.uniforms.normalMap.value=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),e.roughnessMap&&(e.uniforms.roughnessMap.value=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.envMap&&(e.uniforms.envMap.value=r.envMap,e.uniforms.envMapIntensity={value:void 0===r.envMapIntensity?1:r.envMapIntensity}),e.lights=!0,e.vertexShader=Z,e.fragmentShader=J,e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"repeat",value:function(e,t){var n=this.map;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix))}}]),n}(Q);var ne="#define GLSLIFY 1\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#ifdef USE_TRANSMISSION\n\n    varying vec4 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n        vNormal = normalize( transformedNormal );\n\n        #ifdef USE_TANGENT\n\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n        #endif\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    #ifdef USE_TRANSMISSION\n\n        vWorldPosition = worldPosition;\n\n    #endif\n}\n",ie="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ae=function(e){Object(d.a)(n,e);var t=re(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{emissive:{value:new o.Color(0)},roughness:{value:void 0===r.roughness?1:r.roughness},metalness:{value:void 0===r.metalness?0:r.metalness}}]),e.name=r.name||null,r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap])),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),r.aoMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.aomap]),e.aoMap=r.aoMap),e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.envmap]),e.envMap=r.envMap,e.uniforms.envMapIntensity={value:void 0===r.envMapIntensity?1:r.envMapIntensity},e.map&&(e.uniforms.map.value=r.map),r.normalMap&&(e.normalMap=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),r.roughnessMap&&(e.roughnessMap=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.aoMap&&(e.uniforms.aoMap.value=r.aoMap),e.envMap&&(e.uniforms.envMap.value=r.envMap),e.lights=!0,e.vertexShader=ne,e.fragmentShader=ie,e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"map",get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"roughnessMap",get:function(){return this.uniforms.roughnessMap?this.uniforms.roughnessMap.value:null},set:function(e){this.roughnessMap||(this.uniforms=o.UniformsUtils.merge([this.uniforms,o.UniformsLib.roughnessmap])),this.uniforms.roughnessMap.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalMap",get:function(){return this.uniforms.normalMap?this.uniforms.normalMap.value:null},set:function(e){this.normalMap||(this.uniforms=o.UniformsUtils.merge([this.uniforms,o.UniformsLib.normalmap]),this.defines.TANGENTSPACE_NORMALMAP=""),this.uniforms.normalMap.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"envMap",get:function(){return this.uniforms.envMap.value},set:function(e){this.uniforms.envMap.value=e}},{key:"envMapIntensity",get:function(){return this.uniforms.envMapIntensity.value},set:function(e){this.uniforms.envMapIntensity.value=e}},{key:"repeat",value:function(e,t){var n=new o.Texture;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix),this.uniforms.uv2Transform.value.copy(n.matrix))}}]),n}(Q);function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var se=function(e){Object(d.a)(n,e);var t=oe(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._envMap=e.envMap,this._postProcessing=e.postProcessing,this._debug=this._createDebug(),this._gltf=y.b.get("rocky-desert/model"),this._chuncks=this._createChuncks(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyChuncks()}},{key:"_bindHandlers",value:function(){this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListeners",value:function(){this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createChuncks",value:function(){var e=this._gltf.scene.getObjectByName("terrain").children,t=[],n=y.b.get("rocky-desert/terrain/normal");n.wrapS=o.RepeatWrapping,n.wrapT=o.RepeatWrapping;for(var r,map,l=new o.Vector2(12.2,20.6),c=new o.Vector2(.6,-.6),i=0,h=e.length;i<h;i++)(r=e[i].clone()).material,map=y.b.get("rocky-desert/terrain/chunck-".concat(i+1,"-albedo")),r.material=new te({fog:this._fog,color:new o.Color(11630905),map:map,normalMap:n,normalMapRepeat:l,roughness:.76,metalness:.58}),r.material.normalScale=c,r.updateMatrix(),r.matrixAutoUpdate=!1,t.push(r),this.add(r);if(this._debug){var d={color:t[0].material.color};this._debug.addGroup("Material").add(d,"color")}return t}},{key:"_destroyChuncks",value:function(){for(var e,i=0,t=this._chuncks.length;i<t;i++)(e=this._chuncks[i]).material.map.dispose(),e.material.normalMap.dispose(),e.material.dispose(),e.geometry.dispose();this._chuncks=null}},{key:"_envMapChangeHandler",value:function(e){e.map}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("Terrain",{container:"Rocky desert"});return e.add(this,"visible"),e}}}]),n}(Object(_.a)(o.Object3D));function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(_.a)(o.Object3D);var ue=n(28),ce=(n(181),"#define GLSLIFY 1\n// Uniforms\nuniform mat4 uTextureMatrix;\n\n// Varyings\nvarying vec4 vMirrorCoord;\nvarying vec4 vWorldPosition;\n\n// Includes\n#include <common>\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    // Position\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Varyings\n    vMirrorCoord = modelMatrix * vec4(position, 1.0);\n    vWorldPosition = vMirrorCoord.xyzw;\n    vMirrorCoord = uTextureMatrix * vMirrorCoord;\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n"),he="#define GLSLIFY 1\n// Uniforms\nuniform sampler2D uMirrorSampler;\nuniform sampler2D uNormalSampler;\nuniform float uTime;\nuniform float uSize;\nuniform float uDistortionScale;\nuniform vec3 uSunColor;\nuniform vec3 uSunDirection;\nuniform vec3 uEye;\nuniform vec3 uWaterColor;\nuniform float uBrightness;\n// uniform float uRoughnessStrength;\nuniform float uSunShiny;\nuniform float uSunSpecular;\nuniform float uSunDiffuse;\nuniform vec3 uGlowColor;\nuniform float uGlowStrength;\nuniform vec2 uResolution;\n\n// Varyings\nvarying vec4 vMirrorCoord;\nvarying vec4 vWorldPosition;\n\n// Includes\n#include <common>\n#include <custom_fog_pars_fragment>\n\nvec4 getNoise( vec2 uv ) {\n    vec2 uv0 = ( uv / 103.0 ) + vec2(uTime / 17.0, uTime / 29.0);\n    vec2 uv1 = uv / 107.0-vec2( uTime / -19.0, uTime / 31.0 );\n    vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( uTime / 101.0, uTime / 97.0 );\n    vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( uTime / 109.0, uTime / -113.0 );\n    vec4 noise = texture2D( uNormalSampler, uv0 ) +\n        texture2D( uNormalSampler, uv1 ) +\n        texture2D( uNormalSampler, uv2 ) +\n        texture2D( uNormalSampler, uv3 );\n    return noise * 0.5 - 1.0;\n}\n\nvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n    vec3 reflection = normalize( reflect( -uSunDirection, surfaceNormal ) );\n    float direction = max( 0.0, dot( eyeDirection, reflection ) );\n    specularColor += pow( direction, shiny ) * uSunColor * spec;\n    diffuseColor += max( dot( uSunDirection, surfaceNormal ), 0.0 ) * uSunColor * diffuse;\n}\n\n// https://stackoverflow.com/questions/13501081/efficient-bicubic-filtering-code-in-glsl\nvec4 cubic(float v){\n    vec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\n    vec4 s = n * n * n;\n    float x = s.x;\n    float y = s.y - 4.0 * s.x;\n    float z = s.z - 4.0 * s.y + 6.0 * s.x;\n    float w = 6.0 - x - y - z;\n    return vec4(x, y, z, w) * (1.0 / 6.0);\n}\n\nvec4 textureBicubic(sampler2D sampler, vec2 texCoords, vec2 textureResolution){\n    vec2 texSize = textureResolution;\n    vec2 invTexSize = 1.0 / texSize;\n\n    texCoords = texCoords * texSize - 0.5;\n\n    vec2 fxy = fract(texCoords);\n    texCoords -= fxy;\n\n    vec4 xcubic = cubic(fxy.x);\n    vec4 ycubic = cubic(fxy.y);\n\n    vec4 c = texCoords.xxyy + vec2 (-0.5, +1.5).xyxy;\n\n    vec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\n    vec4 offset = c + vec4 (xcubic.yw, ycubic.yw) / s;\n\n    offset *= invTexSize.xxyy;\n\n    vec4 sample0 = texture2D(sampler, offset.xz);\n    vec4 sample1 = texture2D(sampler, offset.yz);\n    vec4 sample2 = texture2D(sampler, offset.xw);\n    vec4 sample3 = texture2D(sampler, offset.yw);\n\n    float sx = s.x / (s.x + s.y);\n    float sy = s.z / (s.z + s.w);\n\n    return mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n\nvoid main() {\n    // Sun light\n    vec3 diffuseLight = vec3(0.0);\n    vec3 specularLight = vec3(0.0);\n    vec3 worldToEye = uEye - vWorldPosition.xyz;\n    vec3 eyeDirection = normalize(worldToEye);\n    vec4 noise = getNoise(vWorldPosition.xz * uSize);\n    vec3 surfaceNormal = normalize(noise.xzy * vec3( 1.5, 1, 1.5 ));\n    sunLight(surfaceNormal, eyeDirection, uSunShiny, uSunSpecular, uSunDiffuse, diffuseLight, specularLight);\n    vec3 specularColor = (diffuseLight + specularLight) * uSunColor;\n\n    // Distortion\n    float dist = length(worldToEye);\n    vec2 distortion = surfaceNormal.xz * (0.001 + 1.0 / dist) * uDistortionScale;\n\n    vec2 reflectionUv = vMirrorCoord.xy / vMirrorCoord.w + distortion;\n    vec4 color = textureBicubic(uMirrorSampler, reflectionUv, uResolution);\n\n    // Water color\n    color.rgb *= uWaterColor;\n\n    // Brightness\n    color.rgb += uBrightness;\n\n    color.rgb = mix(color.rgb, uGlowColor, uGlowStrength);\n\n    // Output\n    gl_FragColor = color + vec4(specularColor, 1.0) * 0.4;\n\n    // Includes\n    #include <tonemapping_fragment>\n    #include <custom_fog_fragment>\n}\n";function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var fe=function(e){Object(d.a)(n,e);var t=de(n);function n(e){var r,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(l.a)(this,n),r=t.call(this,e);var h=Object(ue.a)(r),d=void 0!==c.textureWidth?c.textureWidth:512,f=void 0!==c.textureHeight?c.textureHeight:512,m=void 0!==c.clipBias?c.clipBias:0,v=void 0!==c.waterNormals?c.waterNormals:null,_=void 0!==c.sunDirection?c.sunDirection:new o.Vector3(.70707,.70707,0),y=new o.Color(void 0!==c.sunColor?c.sunColor:16777215),x=new o.Color(void 0!==c.waterColor?c.waterColor:8355711),w=void 0!==c.eye?c.eye:new o.Vector3(0,0,0),S=void 0!==c.distortionScale?c.distortionScale:20,C=void 0!==c.side?c.side:o.FrontSide,O=void 0!==c.fog&&c.fog,L=void 0!==c.size&&c.size,k=new o.Color(void 0!==c.glowColor?c.glowColor:8355711),M=new o.Plane,T=new o.Vector3,P=new o.Vector3,R=new o.Vector3,D=new o.Matrix4,A=new o.Vector3(0,0,-1),E=new o.Vector4,view=new o.Vector3,I=new o.Vector3,q=new o.Vector4,j=new o.Matrix4,F=new o.PerspectiveCamera,B={minFilter:o.LinearMipmapLinearFilter,magFilter:o.LinearFilter,format:o.RGBFormat,stencilBuffer:!1,generateMipmaps:!0},U=new o.WebGLRenderTarget(d,f,B);r.renderTarget=U,o.MathUtils.isPowerOfTwo(d)&&o.MathUtils.isPowerOfTwo(f)||(U.texture.generateMipmaps=!1);var N={uniforms:o.UniformsUtils.merge([o.UniformsLib.fog,{uNormalSampler:{value:null},uMirrorSampler:{value:null},uTime:{value:0},uSize:{value:L},uDistortionScale:{value:7},uTextureMatrix:{value:new o.Matrix4},uSunColor:{value:new o.Color(8355711)},uSunDirection:{value:new o.Vector3(.70707,.70707,0)},uEye:{value:new o.Vector3},uWaterColor:{value:new o.Color(5592405)},uRoughnessStrength:{value:.37},uSunShiny:{value:326},uSunSpecular:{value:.09},uSunDiffuse:{value:0},uBrightness:{value:.002},uGlowColor:{value:null},uGlowStrength:{value:0},uResolution:{value:new o.Vector2(d,f)}}]),vertexShader:ce,fragmentShader:he},z=new o.ShaderMaterial({fragmentShader:N.fragmentShader,vertexShader:N.vertexShader,uniforms:o.UniformsUtils.clone(N.uniforms),lights:!1,side:C,fog:O,extensions:{shaderTextureLOD:!0}});return z.uniforms.uMirrorSampler.value=U.texture,z.uniforms.uTextureMatrix.value=j,z.uniforms.uNormalSampler.value=v,z.uniforms.uSunColor.value=y,z.uniforms.uWaterColor.value=x,z.uniforms.uSunDirection.value=_,z.uniforms.uDistortionScale.value=S,z.uniforms.uGlowColor.value=k,z.uniforms.uEye.value=w,h.material=z,h.fog=O,z.defines.DISTANCE="",z.uniforms.fogTime={value:0},r.bindHandlers(),r.setupEventListeners(),r.updateDefines(O),r.updateUniforms(O),h.onBeforeRender=function(e,t,n){if(!(this.userData.originalVisibilityState||(P.setFromMatrixPosition(h.matrixWorld),R.setFromMatrixPosition(n.matrixWorld),D.extractRotation(h.matrixWorld),T.set(0,1,0),T.applyMatrix4(D),view.subVectors(P,R),view.dot(T)>0))){view.reflect(T).negate(),view.add(P),D.extractRotation(n.matrixWorld),A.set(0,0,-1),A.applyMatrix4(D),A.add(R),I.subVectors(P,A),I.reflect(T).negate(),I.add(P),F.position.copy(view),F.up.set(0,1,0),F.up.applyMatrix4(D),F.up.reflect(T),F.lookAt(I),F.far=n.far,F.updateMatrixWorld(),F.projectionMatrix.copy(n.projectionMatrix),j.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),j.multiply(F.projectionMatrix),j.multiply(F.matrixWorldInverse),M.setFromNormalAndCoplanarPoint(T,P),M.applyMatrix4(F.matrixWorldInverse),E.set(M.normal.x,M.normal.y,M.normal.z,M.constant);var r=F.projectionMatrix;q.x=(Math.sign(E.x)+r.elements[8])/r.elements[0],q.y=(Math.sign(E.y)+r.elements[9])/r.elements[5],q.z=-1,q.w=(1+r.elements[10])/r.elements[14],E.multiplyScalar(2/E.dot(q)),r.elements[2]=E.x,r.elements[6]=E.y,r.elements[10]=E.z+1-m,r.elements[14]=E.w,w.setFromMatrixPosition(n.matrixWorld);var o=e.getRenderTarget(),l=e.xr.enabled,c=e.shadowMap.autoUpdate;h.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(U),e.state.buffers.depth.setMask(!0),t.traverse((function(object){"Mesh"!==object.type&&"Points"!==object.type||(object.material&&object.material.fog&&"function"==typeof object.material.disableFog&&object.material.disableFog(),object.userData&&object.visible&&!1===object.userData.renderReflection&&(object.visible=!1,object.userData.invisibleForReflection=!0))})),!1===e.autoClear&&e.clear(),e.render(t,F),t.traverse((function(object){"Mesh"!==object.type&&"Points"!==object.type||object.material&&object.material.fog&&"function"==typeof object.material.enableFog&&object.material.enableFog(),object.userData&&object.userData.invisibleForReflection&&(object.visible=!0,object.userData.invisibleForReflection=!1)})),h.visible=!0,e.xr.enabled=l,e.shadowMap.autoUpdate=c,e.setRenderTarget(o);var d=n.viewport;void 0!==d&&e.state.viewport(d)}},r}return Object(c.a)(n,[{key:"destroy",value:function(){this.renderTarget.dispose(),this.material.dispose(),this.geometry.dispose()}},{key:"bindHandlers",value:function(){this.fogChangeHandler=this.fogChangeHandler.bind(this)}},{key:"setupEventListeners",value:function(){this.fog&&this.fog.addEventListener("change",this.fogChangeHandler)}},{key:"removeEventListeners",value:function(){this.fog&&this.fog.removeEventListener("change",this.fogChangeHandler)}},{key:"updateDefines",value:function(e){if(delete this.material.defines.USE_CUSTOM_FOG,delete this.material.defines.FOG_LINEAR,delete this.material.defines.FOG_EXP,delete this.material.defines.FOG_EXP2,delete this.material.defines.FOG_GROUND,delete this.material.defines.FOG_COMBINED,delete this.material.defines.FOG_ANIMATE,delete this.material.defines.FOG_USE_SUN,delete this.material.defines.DISTANCE,e&&e.visible){switch(this.material.defines.USE_CUSTOM_FOG="",this.material.defines.DISTANCE="",e.type){case N:this.material.defines.FOG_LINEAR="";break;case z:this.material.defines.FOG_EXP="";break;case G:this.material.defines.FOG_EXP2="";break;case H:this.material.defines.FOG_GROUND="";break;case V:this.material.defines.FOG_COMBINED=""}e.animation&&(this.material.defines.FOG_ANIMATE=""),e.sun&&(this.material.defines.FOG_USE_SUN="")}this.material.needsUpdate=!0}},{key:"updateUniforms",value:function(e){this.material.uniforms.fogActive={value:e.visible},this.material.uniforms.fogColor={value:e.color},this.material.uniforms.fogDensity={value:e.density},this.material.uniforms.fogHeight={value:e.height},this.material.uniforms.fogGlobalStrength={value:e.globalStrength},this.material.uniforms.fogNear={value:e.near},this.material.uniforms.fogFar={value:e.far},e.animation&&(this.material.uniforms.fogAnimationScale={value:e.animationScale},this.material.uniforms.fogAnimationSpeed={value:e.animationSpeed},this.material.uniforms.fogAnimationDepth={value:e.animationDepth}),e.sun&&(this.material.uniforms.sunPosition={value:e.sun.position},this.material.uniforms.uSunColor={value:e.sun.color},this.material.uniforms.sunStrength={value:e.sun.strength})}},{key:"fogChangeHandler",value:function(e){this.updateDefines(e),this.updateUniforms(e)}}]),n}(o.Mesh);function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var pe=function(e){Object(d.a)(n,e);var t=me(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._envMap=e.envMap,this._sunPosition=new o.Vector3(.25,.08,-1),this._debug=this._createDebug(),this._gltf=y.b.get("rocky-desert/model"),this._mesh=this._createMesh(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._mesh.destroy()}},{key:"mesh",get:function(){return this._mesh}},{key:"_createMesh",value:function(){var e=this._gltf.scene.getObjectByName("river").clone(),t=e.geometry,n=y.b.get("water-normal-map");n.wrapS=n.wrapT=o.RepeatWrapping;var r=new fe(t,{fog:this._fog,textureWidth:512,textureHeight:512,waterNormals:n,sunDirection:this._sunPosition,sunColor:14665078,waterColor:7952441,distortionScale:2.84,size:60,glowColor:7952441});r.position.copy(e.position),r.updateMatrix(),r.matrixAutoUpdate=!1,r.userData.renderBloom=!0;var l=new o.MeshBasicMaterial({color:7356196,transparent:!0,opacity:0});if(r.userData.bloomMaterial=l,this._debug){var c={textureSize:512},h=this._debug.addGroup("Water");h.add(c,"textureSize",{options:[128,256,512,1024,2048],onChange:function(){var e=parseInt(c.textureSize);r.renderTarget.setSize(e,e),r.uniforms.uResolution.value.x=e,r.uniforms.uResolution.value.y=e}}),h.add(r.material.uniforms.uSunDirection,"value",{label:"sunDirection"}),h.add(r.material.uniforms.uSunColor,"value",{label:"sunColor"}),h.add(r.material.uniforms.uWaterColor,"value",{label:"waterColor"}),h.add(r.material.uniforms.uDistortionScale,"value",{label:"distortionScale"}),h.add(r.material.uniforms.uSize,"value",{label:"size"}),h.add(r.material.uniforms.uBrightness,"value",{label:"brightness",stepSize:.001}),h.add(r.material.uniforms.uRoughnessStrength,"value",{label:"roughness"}),h.add(r.material.uniforms.uGlowColor,"value",{label:"glow color"}),h.add(r.material.uniforms.uGlowStrength,"value",{label:"glow strength"}),h.addGroup("Bloom material").add(l,"color");var d=h.addGroup("Sun");d.add(r.material.uniforms.uSunShiny,"value",{label:"shiny",stepSize:1}),d.add(r.material.uniforms.uSunSpecular,"value",{label:"specular"}),d.add(r.material.uniforms.uSunDiffuse,"value",{label:"diffuse"})}return this.add(r),r}},{key:"onUpdate",value:function(e){e.time}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("River",{container:"Rocky desert"});return e.add(this,"visible"),e}}}]),n}(Object(_.a)(o.Object3D));n(31),n(15),n(67),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54);function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ve=function(e){Object(d.a)(n,e);var t=ge(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,{uTime:{value:0},uColor:{value:new o.Color(e.color)},uEmissiveMap:{value:null},uLineInterval:{value:e.lineInterval},uEmissiveAlpha:{value:0}}]),r.uniforms.uEmissiveMap.value=e.emissiveMap,r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n    vPosition = position;\n\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n\n    // Output\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\n// Uniforms\nuniform sampler2D uEmissiveMap;\nuniform vec3 uColor;\nuniform float uTime;\nuniform float uLineInterval;\nuniform float uEmissiveAlpha;\n\n// Includes\n#include <custom_fog_pars_fragment>\n\nfloat random(vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n}\n\nvoid main() {\n    // Sample\n    vec4 mapSample = texture2D(uEmissiveMap, vUv);\n\n    // Time\n    float direction = vUv.x > 0.5 ? 0.0 : 1.0;\n\n    float y = vUv.y * 1000.0;\n    float timeOffset = random(vec2(direction, floor(y * uLineInterval) / uLineInterval)) * 100.;\n    float delay = random(vec2(0.0, floor(y * uLineInterval) / uLineInterval)) * 1.0;\n    float time = mod(uTime + timeOffset, 1.2 + delay);\n\n    // Strength\n    float strength = smoothstep(0.94 - mapSample.r, 1.0 - mapSample.r, time);\n    strength *= smoothstep(1.5 - mapSample.r, 1.0 - mapSample.r, time);\n    strength *= 1.0 - max(0.0, time - 1.0) * 5.0;\n    if (mapSample.r < 0.01) strength = 0.0;\n    strength = max(0.0, strength);\n\n    float justTheTip = smoothstep(0.94 - mapSample.r, 1.0 - mapSample.r, time);\n    justTheTip *= smoothstep(1.2 - mapSample.r, 1.0 - mapSample.r, time);\n\n    strength += justTheTip * 1.8;\n    strength *= mapSample.g;\n    strength += mapSample.b;\n\n    #if defined(USE_CUSTOM_FOG)\n\n        vec3 fogRayDirection = normalize(vFogWorldPosition - cameraPosition);\n        vec3 fogColor = fogColor;\n\n        #if defined(FOG_EXP)\n            float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n        #elif defined(FOG_EXP2)\n            float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n        #elif defined(FOG_LINEAR)\n            float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n        #elif defined(FOG_GROUND)\n            float fogGroundDepth = distance(vFogWorldPosition, cameraPosition);\n\n            // float fogFactor = clamp(exp((-cameraPosition.y*fogHeight)*fogDensity) * (1.0-exp(-fogGroundDepth*fogRayDirection.y*fogHeight*fogDensity))/(fogRayDirection.y*fogHeight), 0.0, 1.0);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vFogWorldPosition * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n        #elif defined(FOG_COMBINED)\n            float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n            float fogGroundDepth = distance(vFogWorldPosition, cameraPosition);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vFogWorldPosition * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n            float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n        #endif\n\n        #if defined(FOG_USE_SUN)\n            vec3 sunDirection = normalize(sunPosition - cameraPosition);\n            float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n            fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n        #endif\n\n        #if defined(FOG_RAVINE_LIGHT)\n            float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vFogWorldPosition.y, 0.0));\n            float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n            fogColor = mix(fogColor, ravineLightColor, ravineLightStrength);\n        #endif\n\n        #if defined(FOG_SIDES)\n            fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vFogWorldPosition.x));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n        #endif\n\n        strength *= 1.0 - (fogFactor * fogActive);\n\n    #endif\n\n    // Color\n    vec3 color = uColor * strength * uEmissiveAlpha;\n\n    // Output\n    gl_FragColor = vec4(color, 1.0);\n}\n",r}return n}(Q);function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ye=function(e){Object(d.a)(n,e);var t=_e(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,{uTime:{value:e.timeOffset||0},uColor:{value:new o.Color(e.color)},uOpacity:{value:0}}]),r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n\n    // Output\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform vec3 uColor;\nuniform float uTime;\nuniform float uOpacity;\n\n// Partials\nfloat cubicPulse(float c, float w, float x) {\n    x = abs(x - c);\n    if(x > w) return 0.0;\n    x /= w;\n    return 1.0 - x * x * (3.0 - 2.0 * x);\n}\n\n// Includes\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    // Pulse\n    float cubicOffset = -0.5 + (1.0 - mod(uTime * 0.5, 1.1)) * 1.5;\n    vec3 color = uColor * (0.6 + cubicPulse(cubicOffset, 0.3, vUv.y) * 0.7);\n    float alpha = 1.0;\n\n    #if defined(USE_CUSTOM_FOG)\n\n        vec3 fogRayDirection = normalize(vFogWorldPosition - cameraPosition);\n        vec3 fogColor = fogColor;\n\n        #if defined(FOG_EXP)\n            float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n        #elif defined(FOG_EXP2)\n            float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n        #elif defined(FOG_LINEAR)\n            float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n        #elif defined(FOG_GROUND)\n            float fogGroundDepth = distance(vFogWorldPosition, cameraPosition);\n\n            // float fogFactor = clamp(exp((-cameraPosition.y*fogHeight)*fogDensity) * (1.0-exp(-fogGroundDepth*fogRayDirection.y*fogHeight*fogDensity))/(fogRayDirection.y*fogHeight), 0.0, 1.0);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vFogWorldPosition * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n        #elif defined(FOG_COMBINED)\n            float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n            float fogGroundDepth = distance(vFogWorldPosition, cameraPosition);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vFogWorldPosition * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n            float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n        #endif\n\n        #if defined(FOG_USE_SUN)\n            vec3 sunDirection = normalize(sunPosition - cameraPosition);\n            float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n            fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n        #endif\n\n        #if defined(FOG_RAVINE_LIGHT)\n            float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vFogWorldPosition.y, 0.0));\n            float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n            fogColor = mix(fogColor, ravineLightColor, ravineLightStrength);\n        #endif\n\n        #if defined(FOG_SIDES)\n            fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vFogWorldPosition.x));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n        #endif\n\n        alpha *= 1.0 - (fogFactor * fogActive);\n\n    #endif\n\n    // Output\n    gl_FragColor = vec4(color, alpha * uOpacity);\n}\n",r}return n}(Q);function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var xe=function(e){Object(d.a)(n,e);var t=be(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,{uTime:{value:e.timeOffset||0},uColor:{value:new o.Color(e.color)},uOpacity:{value:0}}]),r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// https://www.geeks3d.com/20140807/billboarding-vertex-shader-glsl/\nmat4 cylindricalBillboarding(mat4 matrix) {\n    matrix[0][0] = 1.0;\n    matrix[0][1] = 0.0;\n    matrix[0][2] = 0.0;\n    matrix[2][0] = 0.0;\n    matrix[2][1] = 0.0;\n    matrix[2][2] = 1.0;\n    return matrix;\n}\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    // Billboarding\n    mat4 mvMatrix = cylindricalBillboarding(modelViewMatrix);\n\n    // Output\n    gl_Position = projectionMatrix * mvMatrix * vec4(position, 1.0);\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform vec3 uColor;\nuniform float uTime;\nuniform float uOpacity;\n\n// Partials\nfloat cubicPulse(float c, float w, float x) {\n    x = abs(x - c);\n    if(x > w) return 0.0;\n    x /= w;\n    return 1.0 - x * x * (3.0 - 2.0 * x);\n}\n\nvoid main() {\n    // Alpha\n    float pulseOffset = mod(vUv.y - uTime, 1.1);\n    float alpha = 0.1;\n    alpha += cubicPulse(0.5, 0.4, pulseOffset) * 0.5;\n    alpha *= cubicPulse(0.5, 0.3, vUv.x);\n    alpha *= 0.5;\n    alpha *= smoothstep(0.0, 0.5, 1.0 - vUv.y);\n\n    // Color\n    vec4 color = vec4(uColor, alpha * uOpacity);\n\n    // Output\n    gl_FragColor = color;\n}\n",r}return n}(Q);function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Se=function(e){Object(d.a)(n,e);var t=we(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._color=new o.Color(e.color),this._geometry=e.geometry,this._material=e.material,this._bloomMaterial=e.bloomMaterial,this._edgesGeometry=e.edgesGeometry,this._edgesSpeed=e.edgesSpeed,this._beamSpeed=e.beamSpeed,this._timeOffset=1e3*Math.random(),this._mesh=this._createMesh(),this._edges=this._createEdges(),this._beam=this._createBeam()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh(),this._destroyEdges(),this._destroyBeam()}},{key:"edgesSpeed",get:function(){return this._edgesSpeed},set:function(e){this._edgesSpeed=e}},{key:"beamSpeed",get:function(){return this._beamSpeed},set:function(e){this._beamSpeed=e}},{key:"edgesColor",get:function(){return this._edges.material.uniforms.uColor.value},set:function(e){this._edges.material.uniforms.uColor.value=e}},{key:"mesh",get:function(){return this._mesh}},{key:"edges",get:function(){return this._edges}},{key:"beam",get:function(){return this._beam}},{key:"_createMesh",value:function(){var e=new o.Mesh(this._geometry,this._material);return e.userData.bloomMaterial=this._bloomMaterial,e.userData.renderBloom=!1,e.matrixAutoUpdate=!1,this.add(e),e}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_createEdges",value:function(){var e=new ye({fog:this._fog,color:this._color,transparent:!0,timeOffset:this._timeOffset,depthWrite:!1}),t=new o.Mesh(this._edgesGeometry,e);return t.userData.renderBloom=!0,t.matrixAutoUpdate=!1,this.add(t),t}},{key:"_destroyEdges",value:function(){this._edges.material.dispose(),this._edges.geometry.dispose(),this._edges=null}},{key:"_createBeam",value:function(){var e=new o.PlaneBufferGeometry(40,2e3),t=new xe({fog:this._fog,color:this._color,transparent:!0,timeOffset:this._timeOffset,depthWrite:!1}),n=new o.Mesh(e,t);return n.position.y=1170,n.userData.renderBloom=!0,n.updateMatrix(),n.matrixAutoUpdate=!1,this.add(n),n}},{key:"_destroyBeam",value:function(){this._beam.material.dispose(),this._beam.geometry.dispose(),this._beam=null}},{key:"update",value:function(e){var t=e.delta;this._edges.material.uniforms.uTime.value+=t*this._edgesSpeed,this._beam.material.uniforms.uTime.value+=t*this._beamSpeed}}]),n}(Object(_.a)(o.Object3D)),Ce="#define GLSLIFY 1\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#ifdef USE_TRANSMISSION\n\n    varying vec4 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n        vNormal = normalize( transformedNormal );\n\n        #ifdef USE_TANGENT\n\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n        #endif\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    #ifdef USE_TRANSMISSION\n\n        vWorldPosition = worldPosition;\n\n    #endif\n}\n",Oe="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n// #include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform sampler2D emissiveMap;\nuniform float uTime;\nuniform float uLineInterval;\nuniform float uEmissiveAlpha;\n\nfloat random(vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n}\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = vec3(0.0);\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    // #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #ifdef USE_AOMAP\n\n        // reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n        float ambientOcclusion = ( texture2D( aoMap, vUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n        reflectedLight.indirectDiffuse *= ambientOcclusion;\n\n        #if defined( USE_ENVMAP ) && defined( STANDARD )\n\n            float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n            reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n        #endif\n\n    #endif\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    // Custom emissive\n    vec4 emissiveSample = texture2D(emissiveMap, vUv2);\n\n    // Time\n    float direction = vUv2.x > 0.5 ? 0.0 : 1.0;\n\n    float y = vUv2.y * 1000.0;\n    float timeOffset = random(vec2(direction, floor(y * uLineInterval) / uLineInterval)) * 100.;\n    float delay = random(vec2(0.0, floor(y * uLineInterval) / uLineInterval)) * 1.0;\n    float time = mod(uTime + timeOffset, 1.2 + delay);\n\n    // Strength\n    float emissiveStrength = smoothstep(0.94 - emissiveSample.r, 1.0 - emissiveSample.r, time);\n    emissiveStrength *= smoothstep(1.5 - emissiveSample.r, 1.0 - emissiveSample.r, time);\n    emissiveStrength *= 1.0 - max(0.0, time - 1.0) * 5.0;\n    if (emissiveSample.r < 0.01) emissiveStrength = 0.0;\n    emissiveStrength = max(0.0, emissiveStrength);\n\n    float justTheTip = smoothstep(0.94 - emissiveSample.r, 1.0 - emissiveSample.r, time);\n    justTheTip *= smoothstep(1.2 - emissiveSample.r, 1.0 - emissiveSample.r, time);\n\n    emissiveStrength += justTheTip * 1.8;\n    emissiveStrength *= emissiveSample.g;\n    emissiveStrength += emissiveSample.b;\n\n    gl_FragColor.rgb += vec3(emissiveStrength * emissive) * uEmissiveAlpha;\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ke=function(e){Object(d.a)(n,e);var t=Le(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{emissive:{value:new o.Color(0)},roughness:{value:void 0===r.roughness?1:r.roughness},metalness:{value:void 0===r.metalness?0:r.metalness}},{uLineInterval:{value:r.lineInterval},uTime:{value:0},uEmissiveAlpha:{value:0}}]),e.name=r.name||null,r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.emissive&&(e.uniforms.emissive.value=new o.Color(r.emissive||16777215)),r.map&&(e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.normalMap=r.normalMap,e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap]),e.roughnessMap=r.roughnessMap),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),r.aoMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.aomap]),e.aoMap=r.aoMap),r.emissiveMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.emissivemap]),e.emissiveMap=r.emissiveMap),e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.envmap]),e.uniforms.envMap.value=r.envMap,e.uniforms.envMapIntensity={value:void 0===r.envMapIntensity?1:r.envMapIntensity},e.envMap=r.envMap,e.map&&(e.uniforms.map.value=r.map),e.normalMap&&(e.uniforms.normalMap.value=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),e.roughnessMap&&(e.uniforms.roughnessMap.value=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.aoMap&&(e.uniforms.aoMap.value=r.aoMap),e.emissiveMap&&(e.uniforms.emissiveMap.value=r.emissiveMap),e.lights=!0,e.vertexShader=Ce,e.fragmentShader=Oe,e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"envMap",get:function(){return this.uniforms.envMap.value},set:function(e){this.uniforms.envMap.value=e}},{key:"envMapIntensity",get:function(){return this.uniforms.envMapIntensity.value},set:function(e){this.uniforms.envMapIntensity.value=e}},{key:"emissiveMap",get:function(){return this.uniforms.emissiveMap.value},set:function(e){this.uniforms.emissiveMap.value=e}},{key:"repeat",value:function(e,t){var n=new o.Texture;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix))}}]),n}(Q);function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Te=function(e){Object(d.a)(n,e);var t=Me(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._envMap=e.envMap,this._lineSpeed=.25,this._edgesSpeed=1,this._beamSpeed=.3,this._lineInterval=.1,this._isActive=!0,this._emissiveColor=new o.Color(16758113),this._debug=this._createDebug(),this._gltf=y.b.get("rocky-desert/model"),this._emissiveMap=this._createEmissiveMap(),this._material=this._createMaterial(),this._bloomMaterial=this._createBloomMaterial(),this._pyramids=this._createPyramids(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyPyramids()}},{key:"showGlow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isActive=!0;for(var t=new v.a.timeline,i=0,n=this._pyramids.children.length;i<n;i++)t.set(this._pyramids.children[i].mesh.userData,{renderBloom:!0},0),t.to(this._pyramids.children[i].edges.material.uniforms.uOpacity,{duration:1,value:1,ease:"sine.inOut"},0),t.to(this._pyramids.children[i].beam.material.uniforms.uOpacity,{duration:1,value:1,ease:"sine.inOut"},0);return t.to(this._material.uniforms.uEmissiveAlpha,{duration:1,value:1,ease:"sine.inOut"},0),t.to(this._bloomMaterial.uniforms.uEmissiveAlpha,{duration:1,value:1,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"hideGlow",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new v.a.timeline({onComplete:function(){e._isActive=!1}});n.to(this._material.uniforms.uEmissiveAlpha,{duration:1,value:0,ease:"sine.inOut"},0),n.to(this._bloomMaterial.uniforms.uEmissiveAlpha,{duration:1,value:0,ease:"sine.inOut"},0);for(var i=0,r=this._pyramids.children.length;i<r;i++)n.to(this._pyramids.children[i].edges.material.uniforms.uOpacity,{duration:1,value:0,ease:"sine.inOut"},0),n.to(this._pyramids.children[i].beam.material.uniforms.uOpacity,{duration:1,value:0,ease:"sine.inOut"},0),n.set(this._pyramids.children[i].mesh.userData,{renderBloom:!1},1.01);return t&&n.timeScale(10),n}},{key:"enable",value:function(){if(this._isActive){this._material.uniforms.uEmissiveAlpha.value=1,this._bloomMaterial.uniforms.uEmissiveAlpha.value=1;for(var i=0,e=this._pyramids.children.length;i<e;i++)this._pyramids.children[i].edges.material.uniforms.uOpacity.value=1,this._pyramids.children[i].beam.material.uniforms.uOpacity.value=1,this._pyramids.children[i].mesh.userData.renderBloom=!0}}},{key:"disable",value:function(){if(this._isActive){this._material.uniforms.uEmissiveAlpha.value=0,this._bloomMaterial.uniforms.uEmissiveAlpha.value=0;for(var i=0,e=this._pyramids.children.length;i<e;i++)this._pyramids.children[i].edges.material.uniforms.uOpacity.value=0,this._pyramids.children[i].beam.material.uniforms.uOpacity.value=0,this._pyramids.children[i].mesh.userData.renderBloom=!1}}},{key:"resetGlow",value:function(){this._material.uniforms.uEmissiveAlpha.value=0,this._bloomMaterial.uniforms.uEmissiveAlpha.value=0;for(var i=0,e=this._pyramids.children.length;i<e;i++)this._pyramids.children[i].edges.material.uniforms.uOpacity.value=0,this._pyramids.children[i].beam.material.uniforms.uOpacity.value=0,this._pyramids.children[i].mesh.userData.renderBloom=!1}},{key:"_bindHandlers",value:function(){this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListeners",value:function(){this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createEmissiveMap",value:function(){return y.b.get("rocky-desert/pyramid/emissive-map")}},{key:"_createMaterial",value:function(){var e=y.b.get("rocky-desert/pyramid/normal-map");e.wrapS=e.wrapT=o.RepeatWrapping;var t=y.b.get("rocky-desert/pyramid/ao-map");t.wrapS=t.wrapT=o.RepeatWrapping;var n=new o.Vector2(3.448,3.448),r=new o.Vector2(1,-1),l=new ke({fog:this._fog,color:9531470,emissive:this._emissiveColor,envMap:this._envMap.texture,roughness:.8,normalMap:e,aoMap:t,emissiveMap:this._emissiveMap,lineInterval:this._lineInterval});return l.repeat(n.x,n.y),l.normalScale=r,l}},{key:"_createBloomMaterial",value:function(){return new ve({fog:this._fog,emissiveMap:this._emissiveMap,color:this._emissiveColor,lineInterval:this._lineInterval})}},{key:"_createPyramids",value:function(){var e=this,t=new o.Group;t.matrixAutoUpdate=!1;var n=this._gltf.scene.getObjectByName("pyramids").clone().children,r=n[0].geometry,l=new o.BufferAttribute(new Float32Array,2);l.copy(r.attributes.uv),r.setAttribute("uv2",l);for(var c,h=this._gltf.scene.getObjectByName("pyramid-edges").clone().geometry,i=n.length-1;i>=0;i--){c=n[i];var d=new Se({fog:this._fog,color:this._emissiveColor,geometry:r,material:this._material,bloomMaterial:this._bloomMaterial,edgesGeometry:h,edgesSpeed:this._edgesSpeed,beamSpeed:this._beamSpeed});d.position.copy(c.position),d.rotation.copy(c.rotation),d.scale.copy(c.scale),d.updateMatrix(),d.matrixAutoUpdate=!1,t.add(d)}return this.add(t),this._debug&&this._debug.add(this,"_emissiveColor",{label:"emissive color",onChange:function(){e._material.emissive=e._emissiveColor,e._bloomMaterial.uniforms.uColor.value=e._emissiveColor;for(var n=0,r=t.children.length;n<r;n++)t.children[n].edgesColor=e._emissiveColor}}),t}},{key:"_destroyPyramids",value:function(){for(var i=0,e=this._pyramids.children.length;i<e;i++)this._pyramids.children[i].destroy();this._emissiveMap.dispose(),this._material.envMap.dispose(),this._material.dispose(),this._material=null,this._bloomMaterial.dispose()}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._material.uniforms.uTime.value+=t*this._lineSpeed,this._bloomMaterial.uniforms.uTime.value=this._material.uniforms.uTime.value,this._updatePyramids({time:time,delta:t})}},{key:"_updatePyramids",value:function(e){for(var time=e.time,t=e.delta,i=0,n=this._pyramids.children.length;i<n;i++)this._pyramids.children[i].update({time:time,delta:t})}},{key:"_envMapChangeHandler",value:function(e){var map=e.map;this._material.envMap=map}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Pyramids",{container:"Rocky desert"});return t.add(this,"visible"),t.add(this,"_lineSpeed",{label:"line speed"}),t.add(this,"_lineInterval",{label:"line interval",min:0,onChange:function(){e._material.uniforms.uLineInterval.value=e._lineInterval,e._bloomMaterial.uniforms.uLineInterval.value=e._lineInterval}}),t.add(this,"_edgesSpeed",{label:"edges speed",min:0,onChange:function(){for(var i=0,t=e._pyramids.children.length;i<t;i++)e._pyramids.children[i].edgesSpeed=e._edgesSpeed}}),t.add(this,"_beamSpeed",{label:"beam speed",min:0,onChange:function(){for(var i=0,t=e._pyramids.children.length;i<t;i++)e._pyramids.children[i].beamSpeed=e._beamSpeed}}),t}}}]),n}(Object(_.a)(o.Object3D)),Pe="#define GLSLIFY 1\n#ifdef USE_ENVMAP\n\n    #ifdef ENV_WORLDPOS\n\n        vec3 cameraToFrag;\n\n        if ( isOrthographic ) {\n\n            cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n        } else {\n\n            cameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n        }\n\n        // Transforming Normal Vectors with the Inverse Transformation\n        vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n        #ifdef ENVMAP_MODE_REFLECTION\n\n            vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n        #else\n\n            vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n        #endif\n\n    #else\n\n        vec3 reflectVec = vReflect;\n\n    #endif\n\n    #ifdef ENVMAP_TYPE_CUBE\n\n        vec3 envMapUv = (uEnvMapRotation * vec4( flipEnvMap * reflectVec.x, reflectVec.yz, 0.0 )).xyz;\n        vec4 envColor = textureCube( envMap, envMapUv );\n\n    #elif defined( ENVMAP_TYPE_CUBE_UV )\n\n        vec4 envColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    #else\n\n        vec4 envColor = vec4( 0.0 );\n\n    #endif\n\n    #ifndef ENVMAP_TYPE_CUBE_UV\n\n        envColor = envMapTexelToLinear( envColor );\n\n    #endif\n\n    #ifdef ENVMAP_BLENDING_MULTIPLY\n\n        outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n    #elif defined( ENVMAP_BLENDING_MIX )\n\n        outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n    #elif defined( ENVMAP_BLENDING_ADD )\n\n        outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n    #endif\n\n#endif\n",Re="#define GLSLIFY 1\nuniform mat4 uEnvMapRotation;";function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ae=function(e){Object(d.a)(n,e);var t=De(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._envMap=e.envMap,this._sun=e.sun||null,this._rotation=e.rotation||new o.Euler(0,0,0),this._debugContainer=e.debugContainer,this._strength=e.strength||1,this._debug=this._createDebug(),this._mesh=this._createMesh(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListener(),this._destroyMesh()}},{key:"_bindHandlers",value:function(){this._sunChangeHandler=this._sunChangeHandler.bind(this),this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._sun&&this._sun.addEventListener("change",this._sunChangeHandler),this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListener",value:function(){this._sun&&this._sun.removeEventListener("change",this._sunChangeHandler),this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createMesh",value:function(){var e=o.UniformsUtils.merge([o.ShaderLib.cube.uniforms,{uEnvMapRotation:{value:(new o.Matrix4).makeRotationFromEuler(this._rotation)},uStrength:{value:this._strength}}]),t=new o.BoxBufferGeometry(1,1,1),n=new Q({vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec3 vWorldDirection;\n\n// Includes\n#include <common>\n\nvoid main() {\n    // World direction\n    vWorldDirection = transformDirection(position, modelMatrix);\n\n    // Includes\n    #include <begin_vertex>\n    #include <project_vertex>\n\n    // Output\n    gl_Position.z = gl_Position.w;\n}\n",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec3 vWorldDirection;\n\n// Uniforms\nuniform float uStrength;\n\n// Includes\n#include <custom_envmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n    // Envmap\n    vec3 vReflect = vWorldDirection;\n    #include <custom_envmap_fragment>\n\n    // Output\n    gl_FragColor = envColor * uStrength;\n\n    // Includes\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n}\n",uniforms:e,side:o.BackSide,depthWrite:!1});n.uniforms.envMap.value=this._envMap.cubeTexture;var r=new o.Mesh(t,n);return r.frustumCulled=!1,r.geometry.deleteAttribute("normal"),r.geometry.deleteAttribute("uv"),r.userData.renderBloom=!1,r.userData.renderReflection=!0,r.matrixAutoUpdate=!1,r.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(r.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),this.add(r),this._debug&&this._debug.add(n.uniforms.uStrength,"value",{label:"strength"}),r}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_updateSunUniforms",value:function(){this._mesh.material.uniforms.uSunSize.value=this._sun.size,this._mesh.material.uniforms.uSunStrength.value=this._sun.strength,this._mesh.material.uniforms.uSunColor.value=this._sun.color,this._mesh.material.uniforms.uSunPosition.value=this._sun.position}},{key:"_sunChangeHandler",value:function(){this._updateSunUniforms()}},{key:"_envMapChangeHandler",value:function(e){var t=e.cubeTexture;this._mesh.material.uniforms.envMap.value=t}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Skybox",{container:this._debugContainer});t.add(this,"visible");var n=t.addGroup("Rotation");return n.add(this._rotation,"x",{onChange:function(){e._mesh.material.uniforms.uEnvMapRotation.value.makeRotationFromEuler(e._rotation)}}),n.add(this._rotation,"y",{onChange:function(){e._mesh.material.uniforms.uEnvMapRotation.value.makeRotationFromEuler(e._rotation)}}),n.add(this._rotation,"z",{onChange:function(){e._mesh.material.uniforms.uEnvMapRotation.value.makeRotationFromEuler(e._rotation)}}),t}}}]),n}(Object(_.a)(o.Object3D));o.ShaderChunk.custom_envmap_fragment=Pe,o.ShaderChunk.custom_envmap_pars_fragment=Re;n(88);var Ee=n(347),Ie="#define GLSLIFY 1\n// Attributes\nattribute float wingDistance;\nattribute vec3 color;\nattribute float timeOffset;\n\n// Uniforms\nuniform float uFlapFrequency;\nuniform float uWingsGlideFrequency;\nuniform float uWingsFlapAmplitude;\nuniform float uWingsGlideAmplitude;\nuniform float uTailFlapAmplitude;\nuniform float uTailGlideAmplitude;\nuniform float uLineOffsetRadius;\nuniform float uFloatFrequency;\nuniform float uFloatAmplitude;\nuniform float uTime;\n\nvoid main() {\n    // Transformed\n    vec3 transformed = position;\n\n    // Time\n    float time = uTime + timeOffset;\n\n    // Glide interval\n    float glideInterval = 1.0 - clamp(sin(time), 0.0, 1.0);\n\n    // Wings\n    float wingDistance = color.r;\n    float wingsFlapOffset = sin(time * uFlapFrequency - wingDistance) * uWingsFlapAmplitude * wingDistance;\n    float wingsGlideOffset = sin(time * uWingsGlideFrequency - wingDistance) * uWingsGlideAmplitude * wingDistance;\n    transformed.y += mix(wingsFlapOffset, wingsGlideOffset, glideInterval);\n\n    // Tail\n    float tailDistance = -color.g;\n    float tailFlapOffset = sin(time * uFlapFrequency - tailDistance) * uTailFlapAmplitude * tailDistance;\n    float tailGlideOffset = sin(time * uFlapFrequency - tailDistance) * uTailGlideAmplitude * tailDistance;\n    transformed.y += mix(tailFlapOffset, tailGlideOffset, glideInterval);\n\n    // Float\n    transformed.y += sin(time * uFlapFrequency * uFloatFrequency + 0.25) * uFloatAmplitude;\n\n    // Line offset\n    transformed.x += sin(time * 0.1) * uLineOffsetRadius;\n    transformed.y += cos(time * 0.15) * uLineOffsetRadius;\n\n    // Output\n    vec4 modelPosition = modelMatrix * vec4(transformed, 1.0);\n    modelPosition = instanceMatrix * modelPosition;\n    gl_Position = projectionMatrix * viewMatrix * modelPosition;\n}\n",je="#define GLSLIFY 1\nvoid main() {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n";function Fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Be=function(e){Object(d.a)(n,e);var t=Fe(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,{diffuse:{value:r.color},emissive:{value:new o.Color(0)}},{uFlapFrequency:{value:15},uWingsGlideFrequency:{value:15},uWingsFlapAmplitude:{value:70},uWingsGlideAmplitude:{value:2},uTailFlapAmplitude:{value:7},uTailGlideAmplitude:{value:2},uLineOffsetRadius:{value:1e3},uFloatFrequency:{value:.1},uFloatAmplitude:{value:10},uTime:{value:null}}]),e.vertexShader=Ie,e.fragmentShader=je,e}return n}(Q);function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ne=function(e){Object(d.a)(n,e);var t=Ue(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._name=e.name,this._renderer=e.renderer,this._camera=e.camera,this._points=e.points,this._speed=e.speed,this._scale=e.scale||1,this._debugContainer=e.debugContainer,this._time=0,this._debugControlsVisible=!1,this._debug=this._createDebug(),this._curve=this._createCurve(),this._mesh=this._createMesh(),this._raycaster=new o.Raycaster,this._onDownPosition=new o.Vector2,this._onUpPosition=new o.Vector2,this._pointer=new o.Vector2,this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"_bindHandlers",value:function(){this._transformControlsDraggingChangedHandler=this._transformControlsDraggingChangedHandler.bind(this),this._transformControlsObjectChangedHandler=this._transformControlsObjectChangedHandler.bind(this),this._pointerDownHandler=this._pointerDownHandler.bind(this),this._pointerUpHandler=this._pointerUpHandler.bind(this),this._pointerMoveHandler=this._pointerMoveHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._transformControls&&(this._transformControls.addEventListener("dragging-changed",this._transformControlsDraggingChangedHandler),this._transformControls.addEventListener("objectChange",this._transformControlsObjectChangedHandler)),document.addEventListener("pointerdown",this._pointerDownHandler),document.addEventListener("pointerup",this._pointerUpHandler),document.addEventListener("pointermove",this._pointerMoveHandler)}},{key:"_removeEventListeners",value:function(){this._transformControls&&(this._transformControls.removeEventListener("dragging-changed",this._transformControlsDraggingChangedHandler),this._transformControls.removeEventListener("objectChange",this._transformControlsObjectChangedHandler)),document.removeEventListener("pointerdown",this._pointerDownHandler),document.removeEventListener("pointerup",this._pointerUpHandler),document.removeEventListener("pointermove",this._pointerMoveHandler)}},{key:"_createCurve",value:function(){return new o.CatmullRomCurve3(this._points)}},{key:"_createMesh",value:function(){for(var e=y.b.get("bird").scene.getObjectByName("bird"),t=new Float32Array(20),i=0;i<20;i++)t[i]=100*Math.random();e.geometry.setAttribute("timeOffset",new o.InstancedBufferAttribute(t,1,!1));var n=new Be({color:new o.Color(2171169),side:o.DoubleSide,transparent:!0,wireframe:!1}),r=new o.InstancedMesh(e.geometry,n,20);r.position.y=150,r.scale.multiplyScalar(.07*this._scale),r.userData.renderReflection=!0,r.userData.renderBloom=!1,this.add(r);for(var l=new o.Object3D,c=0;c<20;c++){var h=50*(2*Math.random()-1);l.position.set(0,0,h),l.updateMatrix(),r.setMatrixAt(c,l.matrix)}return this._debug&&(this._debug.add(n.uniforms.diffuse,"value",{label:"color"}),this._debug.add(n.uniforms.uFlapFrequency,"value",{label:"uFlapFrequency"}),this._debug.add(n.uniforms.uWingsGlideFrequency,"value",{label:"uWingsGlideFrequency"}),this._debug.add(n.uniforms.uWingsFlapAmplitude,"value",{label:"uWingsFlapAmplitude"}),this._debug.add(n.uniforms.uWingsGlideAmplitude,"value",{label:"uWingsGlideAmplitude"}),this._debug.add(n.uniforms.uTailFlapAmplitude,"value",{label:"uTailFlapAmplitude"}),this._debug.add(n.uniforms.uTailGlideAmplitude,"value",{label:"uTailGlideAmplitude"}),this._debug.add(n.uniforms.uLineOffsetRadius,"value",{label:"uLineOffsetRadius",stepSize:1}),this._debug.add(n.uniforms.uFloatFrequency,"value",{label:"uFloatFrequency"}),this._debug.add(n.uniforms.uFloatAmplitude,"value",{label:"uFloatAmplitude"})),r}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_updateCurve",value:function(){for(var e=[],i=0,t=this._controlPoints.children.length;i<t;i++)e.push(this._controlPoints.children[i].position);this._points=e,this._curve=new o.CatmullRomCurve3(this._points);var n=this._curve.getPoints(1e3),r=(new o.BufferGeometry).setFromPoints(n);this._curveMesh.geometry.attributes.position.array=r.attributes.position.array,this._curveMesh.geometry.attributes.position.needsUpdate=!0}},{key:"_createCurveMesh",value:function(){var e=this._curve.getPoints(1e3),t=(new o.BufferGeometry).setFromPoints(e),n=new o.LineBasicMaterial({color:255}),r=new o.Line(t,n);return r.visible=this._debugControlsVisible,r.matrixAutoUpdate=!1,this.add(r),r}},{key:"_createTransformControls",value:function(){var e=new Ee.a(this._camera.active,this._renderer.domElement);return this.add(e),e}},{key:"_createControlPoints",value:function(){for(var e=new o.BoxBufferGeometry(10,10,10),t=new o.MeshBasicMaterial({color:16711680}),n=new o.Group,i=0,r=this._points.length;i<r;i++){var l=this._points[i],object=new o.Mesh(e,t);object.userData.renderBloom=!1,object.userData.renderReflection=!1,object.userData.renderRefraction=!1,object.position.copy(l),n.add(object)}return n.visible=this._debugControlsVisible,this.add(n),n}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup(this._name,{container:this._debugContainer}),n={controls:this._debugControlsVisible};return t.add(this,"visible"),t.add(n,"controls",{onChange:function(){e._controlPoints.visible=n.controls,e._curveMesh.visible=n.controls}}),t.addButton("Log points",{onClick:function(){for(var t=[],i=0;i<e._points.length;i++){var p=e._points[i];t.push("new Vector3(".concat(p.x,", ").concat(p.y,", ").concat(p.z,"),"))}console.log(t.join("\n"));var code=t.join("\n\t");prompt("copy and paste code",code)}}),t.add(this,"_speed",{label:"speed"}),t}}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._mesh.material.uniforms.uTime.value=time,this._time+=t*this._speed;var u=this._time%1,n=this._curve.getPointAt(u);this._mesh.position.copy(n);var r=Math.min(1,u+.01),o=this._curve.getPointAt(r);this._mesh.lookAt(o)}},{key:"_transformControlsDraggingChangedHandler",value:function(e){this._camera.debugControls.enabled=!e.value}},{key:"_transformControlsObjectChangedHandler",value:function(){this._updateCurve()}},{key:"_pointerDownHandler",value:function(e){this._onDownPosition.x=e.clientX,this._onDownPosition.y=e.clientY}},{key:"_pointerUpHandler",value:function(e){this._onUpPosition.x=e.clientX,this._onUpPosition.y=e.clientY,this._transformControls&&0===this._onDownPosition.distanceTo(this._onUpPosition)&&this._transformControls.detach()}},{key:"_pointerMoveHandler",value:function(e){if(this._pointer.x=e.clientX/window.innerWidth*2-1,this._pointer.y=-e.clientY/window.innerHeight*2+1,this._controlPoints.visible){this._raycaster.setFromCamera(this._pointer,this._camera.active);var t=this._raycaster.intersectObjects(this._controlPoints.children);if(t.length>0){var object=t[0].object;object!==this._transformControls.object&&this._transformControls.attach(object)}}}}]),n}(Object(_.a)(o.Object3D)),ze="#define GLSLIFY 1\n// Attributes\nattribute float index;\n\n// Uniforms\nuniform float uTime;\nuniform float uWindTurbulenceFrequency;\nuniform float uWindTurbulenceAmplitude;\nuniform float uSize;\nuniform float uMaxDepth;\nuniform vec4 uShaftBoundingBox;\n\n// Varyings\nvarying float vInShaft;\nvarying float vInstanceId;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\n// Partials\n// https://www.shadertoy.com/view/4djSRW\nfloat random(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * 443.8975);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat signPoints(vec3 p1, vec3 p2, vec3 p3) {\n    return (p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y);\n}\n\nbool pointInTriangle(vec3 pt, vec3 v1, vec3 v2, vec3 v3) {\n    float d1, d2, d3;\n    bool has_neg, has_pos;\n\n    d1 = signPoints(pt, v1, v2);\n    d2 = signPoints(pt, v2, v3);\n    d3 = signPoints(pt, v3, v1);\n\n    has_neg = (d1 < 0.0) || (d2 < 0.0) || (d3 < 0.0);\n    has_pos = (d1 > 0.0) || (d2 > 0.0) || (d3 > 0.0);\n\n    return !(has_neg && has_pos);\n}\n\nvoid main() {\n    // Position\n    vec3 newPosition = position;\n    newPosition.x += sin(uTime * uWindTurbulenceFrequency + position.y) * uWindTurbulenceAmplitude;\n    newPosition.y += cos(uTime * uWindTurbulenceFrequency + position.x) * uWindTurbulenceAmplitude;\n    newPosition.z += cos(uTime * uWindTurbulenceFrequency + position.z) * uWindTurbulenceAmplitude;\n\n    // Output\n    vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Size\n    gl_PointSize = uSize * (0.5 + 0.5 * random(position.xy));\n    gl_PointSize *= 1.0 - clamp(-mvPosition.z / uMaxDepth, 0.0, 1.0);\n    if (gl_PointSize < 0.1) gl_Position = vec4(0.0);\n\n    // Shaft\n    vInShaft = newPosition.z > uShaftBoundingBox.z &&\n               newPosition.z < uShaftBoundingBox.w &&\n               pointInTriangle(newPosition, vec3(uShaftBoundingBox.x, 0.0, uShaftBoundingBox.z), vec3(0.0, uShaftBoundingBox.y, uShaftBoundingBox.z), vec3(0.0, 0.0, uShaftBoundingBox.z)) ? 1.0 : 0.0;\n\n    // Instance ID\n    vInstanceId = index;\n\n    // Custom fog\n    #include <custom_fog_vertex>\n}\n",Ge="#define GLSLIFY 1\n// Uniforms\nuniform float uTime;\nuniform sampler2D uTexture;\nuniform vec3 uColor;\nuniform float uBrightness;\nuniform float uShaftBrightness;\n\n// Varyings\nvarying float vInShaft;\nvarying float vInstanceId;\n\n// Includes\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    // Color\n    vec4 textureSample = texture2D(uTexture, gl_PointCoord.xy);\n    gl_FragColor = vec4(textureSample.r * uColor, textureSample.a);\n\n    // Alpha\n    gl_FragColor.a *= uBrightness + vInShaft * uShaftBrightness;\n    gl_FragColor.a *= (1.0 + sin(uTime * 0.2 + vInstanceId)) * 0.5;\n\n    // Custom fog\n    #include <custom_fog_fragment>\n}\n";function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ve=function(e){Object(d.a)(n,e);var t=He(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,{uTime:{value:0},uTexture:{value:null},uColor:{value:r.color},uMaxDepth:{value:r.maxDepth},uWindTurbulenceFrequency:{value:r.windTurbulenceFrequency},uWindTurbulenceAmplitude:{value:r.windTurbulenceAmplitude},uSize:{value:r.size},uBrightness:{value:r.brightness},uShaftBrightness:{value:2},uShaftBoundingBox:{value:new o.Vector4(-253,198,1402,1599)}}]),e.uniforms.uTexture.value=r.texture,e.type="DustMaterial",e.vertexShader=ze,e.fragmentShader=Ge,e}return n}(Q);function We(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var $e=function(e){Object(d.a)(n,e);var t=We(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog,n=e.amount,r=e.maxWidth,l=e.maxHeight,c=e.maxDepth,h=e.brightness,d=e.windTurbulenceFrequency,f=e.windTurbulenceAmplitude,m=e.size,v=e.color;e.debug;this._fog=t,this._amount=n||500,this._maxWidth=r,this._maxHeight=l,this._maxDepth=c,this._brightness=h||.33,this._windTurbulenceFrequency=d||.04,this._windTurbulenceAmplitude=f||11.84,this._size=m||5.12,this._color=v||new o.Color(4255209),this._windSpeed=10,this._points=this._createPoints(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._points.material.uniforms.uTexture.value.dispose(),this._points.material.dispose(),this._points.geometry.dispose(),this._points=null}},{key:"_createPoints",value:function(){for(var e=[],t=new Float32Array(this._amount),i=0;i<this._amount;i++){var n=.5*-this._maxWidth+Math.random()*this._maxWidth,r=.5*-this._maxHeight+Math.random()*this._maxHeight,l=Math.random()*this._maxDepth;e.push(n,r,l),t[i]=i}var c=new o.BufferGeometry;c.setAttribute("position",new o.Float32BufferAttribute(e,3)),c.setAttribute("index",new o.BufferAttribute(t,1));var h=y.b.get("dust-particle");h.needsUpdate=!0;var d=P.a.dpr()>1?1.5:1,f=new Ve({fog:this._fog,texture:h,brightness:this._brightness,windTurbulenceFrequency:this._windTurbulenceFrequency,windTurbulenceAmplitude:this._windTurbulenceAmplitude,size:this._size/d,color:this._color,transparent:!0,depthWrite:!1,maxDepth:.12*this._maxDepth,blending:o.AdditiveBlending}),m=new o.Points(c,f);if(m.position.z=-this._maxDepth,m.userData.renderBloom=!1,m.userData.renderReflection=!1,m.updateMatrix(),m.matrixAutoUpdate=!1,this.add(m),x.a){var v=x.a.addGroup("Dust",{container:"Rocky desert"});v.add(this,"visible"),v.add(f.uniforms.uTexture,"value",{label:"texture"}),v.add(f.uniforms.uColor,"value",{label:"color"}),v.add(f.uniforms.uSize,"value",{label:"size"}),v.add(f.uniforms.uWindTurbulenceFrequency,"value",{label:"wind frequency"}),v.add(f.uniforms.uWindTurbulenceAmplitude,"value",{label:"wind amplitude"}),v.add(this,"_windSpeed",{label:"wind speed"}),v.add(this,"position",{stepSize:1,listen:!0}),v.add(f.uniforms.uBrightness,"value",{label:"brightness"}),v.add(f.uniforms.uShaftBrightness,"value",{label:"shaft brightness"})}return m}},{key:"update",value:function(e){var t=e.delta;this._points.material.uniforms.uTime.value+=t*this._windSpeed}}]),n}(Object(_.a)(o.Object3D));function qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ye={name:"Rocky desert",class:function(e){Object(d.a)(n,e);var t=qe(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.config;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._config=l,this._isActive=!1,this._isFirstShow=!0,this._components=null,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera(),this._fog=this._createFog(),this._envMap=this._createEnvMap(),this._components=this._createComponents(),this._lights=this._createLights(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){var e;Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyComponents(),null===(e=this._envMap)||void 0===e||e.destroy()}},{key:"camera",get:function(){return this._camera}},{key:"config",get:function(){return this._config}},{key:"activeStateIndex",get:function(){return this._activeStateIndex}},{key:"prepare",value:function(e,t){this._postProcessing.loadSettings(this.name),t.loadRenderSettings(this._config.renderer),this._renderer.compile(this,this._camera.main),this._renderer.render(this,this._camera.main),this._postProcessing.render(this,this.camera.active),this._renderer.setClearColor(0),this._renderer.clear(),e()}},{key:"show",value:function(e){var t=this,n=e.instant,r=e.playIntro;this._resourceManager.load().then((function(){var e;t._isActive=!0,t._activeStateIndex=0,t._isState0Active=!0,t._isState1Active=!1,t._isState2Active=!1,t._camera.activateMain(),t._camera.reset(),n||(t._camera.enable(),t._root.nuxtRoot.$store.getters["context/isProduction"]&&t._camera.startDolly()),null===(e=t._timelineHide)||void 0===e||e.kill(),t._timelineShow=new v.a.timeline,t._timelineShow.call((function(){return t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionIn")}),null,0),t._timelineShow.call((function(){return t._postProcessing.passes.lineRender.changeColor(new o.Color(t._config.lines.color))}),null,0),r?(t._timelineShow.call((function(){return w.a.playLandscapeTrack(t._config.audio.background)}),null,.5),t._timelineShow.fromTo(t._postProcessing.passes.transition,{progress:1},{duration:5,progress:0,ease:"sine.inOut"},0),t._timelineShow.add(t._postProcessing.passes.lineRender.lines.show(),.5),t._timelineShow.add(t._camera.playIntro(),1),t._timelineShow.fromTo(t._renderer,{toneMappingExposure:0},{duration:5,toneMappingExposure:t._config.renderer.toneMappingExposure,ease:"sine.inOut"},3),t._timelineShow.call((function(){return t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionNone")}),null,6),t._timelineShow.add(t._postProcessing.passes.godrays.show(),5)):(t._timelineShow.call((function(){return w.a.playLandscapeTrack(t._config.audio.background)}),null,0),t._timelineShow.fromTo(t._postProcessing.passes.transition,{progress:1},{duration:3,progress:0,ease:"sine.inOut"},0),t._timelineShow.call((function(){return t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionNone")}),null,3),n||t._timelineShow.add(t._postProcessing.passes.godrays.show(),0)),v.a.delayedCall(5,(function(){t._root.landscapeManager.loadResourcesNextScene()}))}))}},{key:"hide",value:function(e){var t,n,r=this,o=e.onCompleteCallback,l=(e.hideLines,e.instant);return null===(t=this._timelineShow)||void 0===t||t.kill(),null===(n=this._timelineHide)||void 0===n||n.kill(),this._timelineHide=new v.a.timeline({onComplete:function(){r._isActive=!1,r._camera.stopDolly(),l||(r._camera.disable(),r._camera.reset()),r._resetStates(),"function"==typeof o&&o()}}),l||(this._timelineHide.call((function(){return r._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionOut")}),null,0),this._timelineHide.to(this._postProcessing.passes.transition,{duration:3,progress:1,ease:"sine.inOut"},0)),this._timelineHide}},{key:"setState",value:function(e){switch(this._postProcessing.passes.final.spawnScan(this._camera.position,{alphaDuration:1,alphaDelay:1}),this._postProcessing.passes.transition.changeLUT(e),this._postProcessing.passes.lineRender.lines.spin(),this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}if(this._activeStateIndex!==e)switch(this._activeStateIndex=e,this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}}},{key:"_bindHandlers",value:function(){this._cameraDollyCompleteHandler=this._cameraDollyCompleteHandler.bind(this),this._menuOpenHandler=this._menuOpenHandler.bind(this),this._menuClosedHandler=this._menuClosedHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._camera.addEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.addEventListener("menu:open",this._menuOpenHandler),this.addEventListener("menu:closed",this._menuClosedHandler)}},{key:"_removeEventListeners",value:function(){this._camera.removeEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.removeEventListener("menu:open",this._menuOpenHandler),this.removeEventListener("menu:closed",this._menuClosedHandler)}},{key:"_createResourceManager",value:function(){return new y.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new F({root:this._root,renderer:this._renderer,scene:this,debugContainer:"Rocky desert",near:20,far:1e4,dollyHeight:8.3,dollyStartPosition:0,dollySpeed:25e-5,path:this._config.cameraPath,pathEnd:.8,menuPositions:this._config.menuCameraPositions});return e.activateMain(),B.a.copySettings(e.main),e}},{key:"_createFog",value:function(){var e=new W({type:H,color:new o.Color(7693635),globalStrength:-.0399999999999999,near:-1661,far:7790,density:.05490000000000038,height:.015,sides:!1,sideNear:0,sideFar:100,ravineLight:!1,ravineLightColor:new o.Color(11567453),ravineLightPosition:new o.Vector3(0,-194,0),ravineLightMaxDistance:243,ravineLightDecay:1.45,ravineLightIntensity:0,envMap:this._envMap});if(e.visible=!0,x.a){var t=x.a.addGroup("Fog",{container:"Rocky desert"});t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"sides"),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:.001}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:1});var r=t.addGroup("Ground");r.add(e,"density",{stepSize:1e-4}),r.add(e,"height",{stepSize:.001});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:1e-4});var c=t.addGroup("Sides");c.add(e,"sideNear",{stepSize:1}),c.add(e,"sideFar",{stepSize:1});var h=t.addGroup("Ravine");h.add(e,"ravineLight",{label:"visible"}),h.add(e,"ravineLightColor"),h.add(e,"ravineLightPosition",{label:"position",stepSize:1}),h.add(e,"ravineLightMaxDistance",{label:"distance",stepSize:1}),h.add(e,"ravineLightDecay",{label:"decay"}),h.add(e,"ravineLightIntensity",{label:"intensity"})}return e}},{key:"_createEnvMap",value:function(){return new X({renderer:this._renderer,name:this._config.renderer.envMap,debugContainer:"Rocky desert"})}},{key:"_createLights",value:function(){var e,t={};if(x.a&&(e=x.a.addGroup("Lights",{container:"Rocky desert"})),t.directional=new o.DirectionalLight(13471319,.23),t.directional.visible=!0,t.directional.position.x=219,t.directional.position.y=340,t.directional.userData.originalPositionZ=t.directional.position.z=-4133,t.directional.castShadow=!1,t.directional.shadow.mapSize.width=1024,t.directional.shadow.mapSize.height=1024,t.directional.shadow.camera.near=0,t.directional.shadow.camera.far=5e3,t.directional.shadow.camera.left=-2e3,t.directional.shadow.camera.bottom=-2e3,t.directional.shadow.camera.right=2e3,t.directional.shadow.camera.top=2e3,t.directional.target.position.x=219,t.directional.target.position.y=154,t.directional.userData.originalTargetZ=t.directional.target.position.z=-1129,t.directional.updateMatrix(),t.directional.matrixAutoUpdate=!1,this.add(t.directional.target),this.add(t.directional),e){var n=function(){t.directional.shadow.mapSize.width=parseInt(l.mapSize),t.directional.shadow.mapSize.height=parseInt(l.mapSize),t.directional.shadow.camera.updateProjectionMatrix(),t.directional.shadow.map&&t.directional.shadow.map.dispose(),t.directional.shadow.map=null,t.directional.shadow.needsUpdate=!0},r=e.addGroup("Directional");r.add(t.directional,"visible"),r.add(t.directional,"color"),r.add(t.directional,"intensity"),r.add(t.directional,"position",{stepSize:1}),r.add(t.directional.target,"position",{label:"target",stepSize:1});var l={mapSize:1024},c=r.addGroup("Shadow");c.add(t.directional,"castShadow"),c.add(l,"mapSize",{options:[128,256,512,1024,2048,4096],onChange:n}),c.add(t.directional.shadow.camera,"near",{stepSize:1,onChange:n}),c.add(t.directional.shadow.camera,"far",{stepSize:1,onChange:n})}return t}},{key:"_restart",value:function(){var e=this,t=new v.a.timeline;t.to(this._postProcessing.passes.transition,{duration:4,progress:1,ease:"sine.inOut"},0),t.call((function(){e._camera.reset(),e._camera.startDolly()}),null,4),t.to(this._postProcessing.passes.transition,{duration:4,progress:0,ease:"sine.inOut"},4)}},{key:"_createComponents",value:function(){var e={};return e.skybox=this._createSkyboxComponent(),e.terrain=this._createTerrainComponent(),e.river=this._createRiverComponent(),e.pyramids=this._createPyramidsComponent(),e.birds=this._createBirdsComponent(),e.dust=this._createDustComponent(),e}},{key:"_addAssetsToComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].addAssets&&this._components[e].addAssets()}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_createSkyboxComponent",value:function(){var component=new Ae({envMap:this._envMap,rotation:new o.Euler(0,0,0),debugContainer:"Rocky desert"});return this.add(component),component}},{key:"_createTerrainComponent",value:function(){var component=new se({fog:this._fog,envMap:this._envMap,postProcessing:this._postProcessing});return this.add(component),component}},{key:"_createRiverComponent",value:function(){var component=new pe({fog:this._fog});return this.add(component),component}},{key:"_createPyramidsComponent",value:function(){var component=new Te({fog:this._fog,envMap:this._envMap});return this.add(component),component}},{key:"_createBirdsComponent",value:function(){for(var e,component,t=[],i=0,n=this._config.birds.length;i<n;i++)e=this._config.birds[i],component=new Ne({name:e.name,fog:this._fog,renderer:this._renderer,camera:this._camera,points:e.points,speed:e.speed,scale:.5,debugContainer:"Rocky desert"}),t.push(component),this.add(component);return t}},{key:"_createDustComponent",value:function(){var component=new $e({fog:this._fog,amount:1e4,maxWidth:2e3,maxHeight:500,maxDepth:1e4,size:4.13,color:new o.Color(16750111),brightness:1.85});return component.position.set(500,260,55),this.add(component),component}},{key:"_toggleState0",value:function(){var e;this._isState0Active=!this._isState0Active,null===(e=this._timelineState0)||void 0===e||e.kill(),this._timelineState0=new v.a.timeline,this._isState0Active?this._timelineState0.add(this._postProcessing.passes.godrays.show(),.5):this._timelineState0.add(this._postProcessing.passes.godrays.hide(),1.5)}},{key:"_toggleState1",value:function(){var e;this._isState1Active=!this._isState1Active,null===(e=this._timelineState1)||void 0===e||e.kill(),this._timelineState1=new v.a.timeline,this._isState1Active?this._timelineState1.add(this._components.pyramids.showGlow(),1):this._timelineState1.add(this._components.pyramids.hideGlow(),1)}},{key:"_toggleState2",value:function(){var e;this._isState2Active=!this._isState2Active,null===(e=this._timelineState2)||void 0===e||e.kill(),this._timelineState2=new v.a.timeline,this._isState2Active?(this._timelineState2.set(this._components.river.mesh.userData,{renderBloom:!0},.25),this._timelineState2.to(this._components.river.mesh.userData.bloomMaterial,{duration:1.5,opacity:1,ease:"sine.inOut"},.25)):(this._timelineState2.to(this._components.river.mesh.userData.bloomMaterial,{duration:1.5,opacity:0,ease:"sine.inOut"},1),this._timelineState2.set(this._components.river.mesh.userData,{renderBloom:null},2.5))}},{key:"_resetStates",value:function(){this._postProcessing.passes.godrays.reset(),this._components.pyramids.resetGlow(),this._components.river.mesh.userData.renderBloom=!1,this._components.river.mesh.material.uniforms.uGlowStrength.value=0}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&(this._updateCamera({time:time,delta:t}),this._updateComponents({time:time,delta:t}),this._updateBirds({time:time,delta:t}))}},{key:"_updateCamera",value:function(e){var time=e.time,t=e.delta;this._camera.update({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"_updateBirds",value:function(e){var time=e.time,t=e.delta;if(this._components&&this._components.birds)for(var i=0,n=this._components.birds.length;i<n;i++)this._components.birds[i].update({time:time,delta:t})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n}},{key:"_cameraDollyCompleteHandler",value:function(){this._root.nuxtRoot.$store.getters["home/isScrollTriggered"]?this._restart():this.dispatchEvent({type:"complete"})}},{key:"_menuOpenHandler",value:function(){this._postProcessing.passes.godrays.disable(),this._components.pyramids.disable(),this._isState2Active&&(this._components.river.mesh.userData.renderBloom=!1,this._components.river.mesh.material.uniforms.uGlowStrength.value=0)}},{key:"_menuClosedHandler",value:function(e){"index"===e.message.route&&(this._postProcessing.passes.godrays.enable(),this._components.pyramids.enable(),this._isState2Active&&(this._components.river.mesh.userData.renderBloom=!0,this._components.river.mesh.material.uniforms.uGlowStrength.value=.22))}},{key:"onCameraChange",value:function(e){e.type}}]),n}(Object(_.a)(o.Scene)),renderer:{clearColor:"#000000",envMap:"golden-hour",toneMapping:o.ReinhardToneMapping,toneMappingExposure:2.83,outputEncoding:o.LinearEncoding},postProcessing:{fogBloom:{enabled:!0,strength:1.09,radius:1},ssms:{depthOffset:0},bloom:{enabled:!0,strength:1.18,radius:.63},godrays:{enabled:!0},final:{enabled:!0,lut:"lut/rocky-desert"}},lines:{color:16753487},audio:{background:"audio-landscape-rocky-desert",transition:"audio-transition-rocky-desert"},resources:{preload:{development:!0,production:!0},items:[{type:"ktx",name:"rocky-desert/terrain/chunck-1-albedo",path:"/webgl/scenes/rocky-desert/terrain/chunck-1-albedo.ktx2"},{type:"ktx",name:"rocky-desert/terrain/chunck-2-albedo",path:"/webgl/scenes/rocky-desert/terrain/chunck-2-albedo.ktx2"},{type:"ktx",name:"rocky-desert/terrain/chunck-3-albedo",path:"/webgl/scenes/rocky-desert/terrain/chunck-3-albedo.ktx2"},{type:"ktx",name:"rocky-desert/terrain/chunck-4-albedo",path:"/webgl/scenes/rocky-desert/terrain/chunck-4-albedo.ktx2"},{type:"ktx",name:"rocky-desert/terrain/normal",path:"/webgl/scenes/rocky-desert/terrain/normal.ktx2"},{type:"ktx",name:"rocky-desert/pyramid/normal-map",path:"/webgl/scenes/rocky-desert/pyramid/normal-map.ktx2"},{type:"ktx",name:"rocky-desert/pyramid/ao-map",path:"/webgl/scenes/rocky-desert/pyramid/ao-map.ktx2"},{type:"ktx",name:"rocky-desert/pyramid/emissive-map",path:"/webgl/scenes/rocky-desert/pyramid/emissive-map.ktx2"}]},cameraPath:[[-24.76565933227539,153.741455078125,-17.35784149169922],[568.670166015625,147.79115295410156,-2765.88037109375],[347.59698486328125,153.741455078125,-4486.48828125],[331.9803466796875,153.741455078125,-6664.078125],[233.74270629882812,153.741455078125,-8876.5234375]],menuCameraPositions:[{position:new o.Vector3(400.66887121817405,40.13001368054324,-9276.344873988417),rotation:new o.Euler(3.116458912427644,3.176198544324333e-10,-3.1415926535818084),target:new o.Vector3(400.66887000686603,135.97256416889107,-5463.845667609479),transitionProgress:.32,lutIndex:0},{position:new o.Vector3(2486.805430459688,220.851548099651,-6854.900988766123),rotation:new o.Euler(-.6820088519517646,.9241116334431506,.06000000000000065),target:new o.Vector3(1833.517415461388,-90.05374068710674,-7237.794324391013),transitionProgress:.2,lutIndex:0},{position:new o.Vector3(-712.3927591050958,225.22298367334542,-3021.1453280203045),rotation:new o.Euler(-.1572025041476466,-.6646445530945514,-.09745623124008324),target:new o.Vector3(2031.1136825753845,-322.9216547191286,-6479.244293848679),transitionProgress:.32,lutIndex:0}],birds:[{name:"Birds #1",speed:.02,points:[new o.Vector3(-1497.4534912109375,452.9333801269531,-7753.97314453125),new o.Vector3(-1263.5657958984375,444.0717468261719,-6319.6181640625),new o.Vector3(-707.5581665039062,455.8616638183594,-4385.70703125),new o.Vector3(2388.671142578125,459.5003356933594,-6480.650390625),new o.Vector3(47.896728515625,314.7121276855469,-8597.0263671875)]}]};Ye.resources.items=[].concat(Object(r.a)(Ye.resources.items),Object(r.a)($[Ye.renderer.envMap].items));var Xe=Ye,Ke=n(105),Qe=(n(96),function(){function e(t,n){Object(l.a)(this,e),this._limit=t,this._constructor=n,this._arrayObjects=new Array(this._limit),this._size=0}return Object(c.a)(e,[{key:"size",get:function(){return this._size}},{key:"obtain",value:function(e){var t;return this._size>0?(this._size--,t=this._arrayObjects[this._size],this._arrayObjects[this._size]=null,t):new this._constructor(e)}},{key:"recycle",value:function(e){if(!(e instanceof this._constructor))throw new Error("Trying to recycle the wrong object for pool.");this._size<this._limit&&("function"==typeof e.recycle&&e.recycle(),this._arrayObjects[this._size]=e,this._size++)}}]),e}());function Ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Je=function(e){Object(d.a)(n,e);var t=Ze(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.renderer;this._renderer=t,this._spawnTime=0,this._stars=[],this._objectPool=new Qe(100,tt),this._mesh=this._createStars()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyStars()}},{key:"_createStars",value:function(){for(var e=[],i=0;i<100;i++)e.push(1);var t=new o.BoxBufferGeometry(1,1,1);t.translate(.5,0,0);var n=new o.InstancedBufferAttribute(new Float32Array(e),1);n.setUsage(o.DynamicDrawUsage),t.setAttribute("instanceLife",n);var r=new o.ShaderMaterial({vertexShader:"#define GLSLIFY 1\n// Attributes\nattribute float instanceLife;\n\n// Varyings\nvarying float vLife;\n\nvoid main() {\n    // Varyings\n    vLife = instanceLife;\n\n    // Output\n    mat4 mvMatrix = modelViewMatrix * instanceMatrix;\n    gl_Position = projectionMatrix * mvMatrix * vec4(position, 1.0);\n    gl_Position.z = gl_Position.w;\n}\n",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying float vLife;\n\n// Uniforms\nuniform float uOpacity;\n\nvoid main() {\n    // Alpha\n    float alpha = vLife * uOpacity;\n\n    // Output\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 0.4 * alpha);\n}\n",transparent:!0,blending:o.AdditiveBlending,uniforms:{uOpacity:{value:1}}}),l=new o.InstancedMesh(t,r,100);return l.instanceMatrix.setUsage(o.DynamicDrawUsage),l.frustumCulled=!1,l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},this.add(l),l}},{key:"_destroyStars",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"update",value:function(e){var t,time=e.time;this._spawnTime++,this._spawnTime%1==0&&this._spawn();for(var i=this._stars.length-1;i>=0;i--)(t=this._stars[i]).update(time),this._mesh.setMatrixAt(i,t.matrix),this._mesh.geometry.attributes.instanceLife.setX(i,t.life),t.life<0&&(t.hide(),this._objectPool.recycle(t),this._stars.splice(this._stars.indexOf(t),1));this._mesh.geometry.attributes.instanceLife.needsUpdate=!0,this._mesh.instanceMatrix.needsUpdate=!0}},{key:"_spawn",value:function(){var e=this._objectPool.obtain();e.reset(),this._stars.push(e)}}]),n}(Object(_.a)(o.Object3D)),et=500,tt=function(e){Object(d.a)(n,e);var t=Ze(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this))._life=null,e._mass=null,e._velocity=null,e}return Object(c.a)(n,[{key:"life",get:function(){return this._life}},{key:"update",value:function(){this._life-=this._dieSpeed,this.position.add(this._velocity),this.updateMatrix(),this.scale.x=150*(1-this._life)}},{key:"hide",value:function(){this.scale.x=0,this.scale.y=0}},{key:"reset",value:function(){this._life=1,this._dieSpeed=.01,this._side=2,this._direction=2*Math.PI*Math.random(),this.scale.x=0,this.scale.y=1;0===this._side||1===this._side?(this.position.x=Math.random()>.5?et:-500,this.position.y=(2*Math.random()-1)*et,this.position.z=(2*Math.random()-1)*et,this.rotation.x=0,this.rotation.y=.5*Math.PI,this.rotation.z=this._direction+.5*Math.PI,this._velocity=new o.Vector3,this._velocity.y=3*Math.cos(this._direction),this._velocity.z=3*Math.sin(this._direction)):2===this._side||3===this._side?(this.position.x=(2*Math.random()-1)*et*3,this.position.y=et,this.position.z=(2*Math.random()-1)*et*3,this.rotation.x=.5*Math.PI,this.rotation.y=0,this.rotation.z=this._direction,this._velocity=new o.Vector3,this._velocity.x+=3*Math.cos(this._direction),this._velocity.z+=3*Math.sin(this._direction)):4!==this._side&&5!==this._side||(this.position.x=(2*Math.random()-1)*et,this.position.y=(2*Math.random()-1)*et,this.position.z=Math.random()>.5?et:-500,this.rotation.x=0,this.rotation.y=0,this.rotation.z=this._direction,this._velocity=new o.Vector3,this._velocity.x+=3*Math.cos(this._direction),this._velocity.y+=3*Math.sin(this._direction))}}]),n}(o.Object3D),nt="#define GLSLIFY 1\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <skinbase_vertex>\n    #ifdef USE_ENVMAP\n        #include <beginnormal_vertex>\n        #include <morphnormal_vertex>\n        #include <skinnormal_vertex>\n        #include <defaultnormal_vertex>\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <worldpos_vertex>\n    #include <clipping_planes_vertex>\n    #include <envmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",it="#define GLSLIFY 1\nuniform float uTime;\nuniform float uMapScale;\nuniform vec3 uColor;\nuniform vec2 uScale;\n\nuniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    #include <logdepthbuf_fragment>\n\n    #ifdef USE_MAP\n        vec2 uv = vUv;\n        uv *= uScale;\n        uv.y += uTime;\n        vec4 texelColor = vec4(uColor, texture2D(map, uv).r);\n        texelColor = mapTexelToLinear( texelColor );\n        diffuseColor *= texelColor;\n    #endif\n\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <specularmap_fragment>\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    #ifdef USE_LIGHTMAP\n        vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n        reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n    #else\n        reflectedLight.indirectDiffuse += vec3( 1.0 );\n    #endif\n    #include <aomap_fragment>\n    reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n    vec3 outgoingLight = reflectedLight.indirectDiffuse;\n    #include <envmap_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    // #include <tonemapping_fragment>\n    // #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n    float alpha = 1.0 - length((vUv - vec2(0.5, 0.5)) * 50.);\n    gl_FragColor.a *= alpha;\n}\n";function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ot=function(e){Object(d.a)(n,e);var t=at(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{uTime:{value:null},uMapScale:{value:3},uColor:{value:r.color},uScale:{value:r.scale}}]),r.map&&(e.uniforms.map.value=r.map,e.map=r.map),e.uniforms.opacity.value=r.opacity,e.vertexShader=nt,e.fragmentShader=it,e}return n}(Q);function st(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var lt=function(e){Object(d.a)(n,e);var t=st(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){this._speed=.13,this._debug=this._createDebug(),this._fog=this._createFog(),this._mesh=this._createMesh()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"addAssets",value:function(){var e=y.b.get("ocean/clouds-map");e.wrapS=e.wrapT=o.MirroredRepeatWrapping,this._mesh.material.uniforms.map.value=e}},{key:"_createMesh",value:function(){var e=new o.Texture;e.encoding=o.sRGBEncoding;var t=new o.PlaneBufferGeometry(1e8,1e8),n=new ot({side:o.BackSide,opacity:1.6,transparent:!0,map:e,color:new o.Color(7368816),scale:new o.Vector2(227,225),depthWrite:!1}),r=new o.Mesh(t,n);return r.position.y=1e4,r.rotation.x=-.5*Math.PI,r.userData.renderReflection=!0,this.add(r),this._debug&&(this._debug.add(this,"visible"),this._debug.add(this,"_speed",{label:"speed"}),this._debug.add(n.uniforms.opacity,"value",{label:"opacity"}),this._debug.add(n.uniforms.uColor,"value",{label:"color"}),this._debug.add(n.uniforms.uScale,"value",{label:"scale",stepSize:1}),this._debug.add(n.uniforms.map,"value",{label:"texture"}),this._debug.add(r.position,"y",{label:"height",stepSize:1})),r}},{key:"_destroyMesh",value:function(){this._mesh.material.map.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_createFog",value:function(){var e=new W({type:N,color:new o.Color(2697513),globalStrength:0,near:0,far:1e5});if(this._debug){var t=this._debug.addGroup("Fog");t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:.001}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:1});var r=t.addGroup("Ground");r.add(e,"density"),r.add(e,"height",{stepSize:.001});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:1e-4})}return e}},{key:"update",value:function(e){var t=e.delta;this._mesh.material.uniforms.uTime.value+=t*this._speed}},{key:"_createDebug",value:function(){if(x.a)return x.a.addGroup("Clouds2",{container:"Ocean"})}}]),n}(Object(_.a)(o.Object3D)),ut=n(104);function ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ht=function(e){Object(d.a)(n,e);var t=ct(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=e.size,r=e.strength,o=e.inclination,l=e.azimuth,c=e.glowSize;this._color=t,this._size=n,this._strength=r,this._inclination=o||-.3,this._azimuth=l||3.3,this._glowSize=c||1,this._mesh=this._createMesh(),this._debugger=this._createDebugger(),this._updatePosition(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"color",get:function(){return this._color}},{key:"size",get:function(){return this._size}},{key:"strength",get:function(){return this._strength}},{key:"glowSize",get:function(){return this._glowSize}},{key:"mesh",get:function(){return this._mesh}},{key:"addAssets",value:function(){}},{key:"_createMesh",value:function(){var map=ut.a["ocean/moon-map-png"],e=new o.ShaderMaterial({vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uTexture;\nuniform vec3 uColor;\nuniform float uBrightness;\nuniform float uOpacity;\n\nvoid main() {\n    vec4 color = texture2D(uTexture, vUv);\n    color.rgb *= uColor;\n    color.rgb *= uBrightness;\n\n    gl_FragColor = color;\n    gl_FragColor.a *= uOpacity;\n}\n",uniforms:{uColor:{value:this._color},uBrightness:{value:1},uTexture:{value:map},uOpacity:{value:1}},transparent:!0}),t=new o.PlaneGeometry(10,10),n=new o.Mesh(t,e);return n.visible=!0,n.scale.set(this._size,this._size,1),n.frustumCulled=!1,this.add(n),n}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_updatePosition",value:function(){var e=new o.Vector3(0,0,1e6),t=new o.Quaternion;t.setFromAxisAngle(new o.Vector3(1,0,0),this._inclination),e.applyQuaternion(t);var n=new o.Quaternion;n.setFromAxisAngle(new o.Vector3(0,1,0),this._azimuth),e.applyQuaternion(n),this._mesh.position.copy(e),this._mesh.lookAt(0,0,0),this._mesh.updateMatrix(),this._mesh.matrixAutoUpdate=!1,this._triggerChangeEvent()}},{key:"_triggerChangeEvent",value:function(){this.dispatchEvent({type:"change"})}},{key:"_createDebugger",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Moon",{container:"Ocean"});return t.add(this,"visible"),t.add(this,"_color",{label:"color",onChange:function(){e._mesh.material.color=e._color,e._triggerChangeEvent()}}),t.add(this,"_size",{label:"size",stepSize:1,onChange:function(){e._mesh.scale.set(e._size,e._size,1)}}),t.add(this,"_strength",{label:"strength",onChange:function(){e._triggerChangeEvent()}}),t.add(this,"_glowSize",{label:"glowSize",stepSize:1,onChange:function(){e._triggerChangeEvent()}}),t.add(this,"_inclination",{label:"inclination",stepSize:.001,onChange:function(){e._updatePosition()}}),t.add(this,"_azimuth",{label:"azimuth",stepSize:.001,onChange:function(){e._updatePosition()}}),t}}}]),n}(Object(_.a)(o.Object3D));function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var mt=function(e){Object(d.a)(n,e);var t=ft(n);function n(e,r){var c;Object(l.a)(this,n),c=t.call(this,e,r);var h=Object(ue.a)(c),d=((r=r||{}).renderer,void 0!==r.textureWidth?r.textureWidth:512),f=void 0!==r.textureHeight?r.textureHeight:512,m=void 0!==r.clipBias?r.clipBias:0,v=void 0!==r.alpha?r.alpha:1,time=void 0!==r.time?r.time:0,_=void 0!==r.waterNormals?r.waterNormals:null,y=void 0!==r.waterMask?r.waterMask:null,x=void 0!==r.sunDirection?r.sunDirection:new o.Vector3(.70707,.70707,0),w=new o.Color(void 0!==r.sunColor?r.sunColor:16777215),S=new o.Color(void 0!==r.waterColor?r.waterColor:8355711),C=void 0!==r.eye?r.eye:new o.Vector3(0,0,0),O=void 0!==r.distortionScale?r.distortionScale:20,L=void 0!==r.side?r.side:o.FrontSide,k=void 0!==r.fog&&r.fog,M=void 0!==r.sunShiny&&r.sunShiny,T=void 0!==r.sunSpec&&r.sunSpec,P=void 0!==r.sunDiffuse&&r.sunDiffuse,R=void 0!==r.waterDepthTransitionSize&&r.waterDepthTransitionSize,D=void 0!==r.waterDepthColor?r.waterDepthColor:new o.Vector3(0,0,0),A=void 0!==r.waterDepthMax&&r.waterDepthMax,E=void 0!==r.waterMaskColor?r.waterMaskColor:new o.Vector3(0,0,0),I=void 0!==r.waterMaskSize&&r.waterMaskSize,j=void 0!==r.waterMaskStrength&&r.waterMaskStrength,F=void 0!==r.reflectanceRf0&&r.reflectanceRf0,B=void 0!==r.surfaceNormalModifier&&r.surfaceNormalModifier,U=void 0!==r.waterDepthStrength?r.waterDepthStrength:1,N=void 0!==r.foamColor?r.foamColor:null,z=void 0!==r.foamStrength?r.foamStrength:null,G=void 0!==r.foamFalloff?r.foamFalloff:null,H=void 0!==r.outputEncoding?r.outputEncoding:null,V=new o.Plane,W=(new o.Plane,new o.Vector3),$=new o.Vector3,Y=new o.Vector3,X=new o.Matrix4,K=new o.Vector3(0,0,-1),Q=new o.Vector4,view=(new o.Vector4,new o.Vector3),Z=new o.Vector3,q=new o.Vector4,J=new o.Matrix4,ee=new o.PerspectiveCamera,te=(new o.PerspectiveCamera,{minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBFormat,encoding:H}),ne=new o.WebGLRenderTarget(d,f,te);h.reflectionRenderTarget=ne;var ie={minFilter:o.NearestFilter,magFilter:o.NearestFilter,format:o.RGBFormat,encoding:H},re=new o.WebGLRenderTarget(0,0,ie);re.depthBuffer=!0,re.depthTexture=new o.DepthTexture,h.refractionRenderTarget=re,o.MathUtils.isPowerOfTwo(d)&&o.MathUtils.isPowerOfTwo(f)||(ne.texture.generateMipmaps=!1,re.texture.generateMipmaps=!1);var ae={uniforms:o.UniformsUtils.merge([o.UniformsLib.fog,{normalSampler:{value:null},waterMaskSampler:{value:null},mirrorSampler:{value:null},refractionSampler:{value:null},depthSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new o.Matrix4},sunColor:{value:new o.Color(8355711)},sunDirection:{value:new o.Vector3(.70707,.70707,0)},eye:{value:new o.Vector3},waterColor:{value:new o.Color(5592405)},sunShiny:{value:M},sunSpec:{value:T},sunDiffuse:{value:P},waterDepthTransitionSize:{value:R},waterDepthColor:{value:D},waterDepthMax:{value:A},waterDepthStrength:{value:U},cameraNear:{value:0},cameraFar:{value:0},waterMaskColor:{value:E},waterMaskSize:{value:I},waterMaskStrength:{value:j},reflectanceRf0:{value:F},surfaceNormalModifier:{value:B},foamColor:{value:N},foamStrength:{value:z},foamFalloff:{value:G}}]),vertexShader:"#define GLSLIFY 1\nuniform mat4 textureMatrix;\n\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\n\n#include <common>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n    mirrorCoord = modelMatrix * vec4( position, 1.0 );\n    worldPosition = mirrorCoord.xyzw;\n    mirrorCoord = textureMatrix * mirrorCoord;\n    vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <beginnormal_vertex>\n    #include <defaultnormal_vertex>\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n    #include <shadowmap_vertex>\n}\n",fragmentShader:"#define GLSLIFY 1\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\n\nuniform sampler2D mirrorSampler;\nuniform sampler2D refractionSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D normalSampler;\nuniform sampler2D waterMaskSampler;\n\nuniform float alpha;\nuniform float time;\nuniform float size;\nuniform float distortionScale;\nuniform vec3 sunColor;\nuniform vec3 sunDirection;\nuniform vec3 eye;\nuniform vec3 waterColor;\nuniform float sunShiny;\nuniform float sunSpec;\nuniform float sunDiffuse;\nuniform float waterDepthTransitionSize;\nuniform vec3 waterDepthColor;\nuniform float waterDepthStrength;\nuniform float waterDepthMax;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec3 waterMaskColor;\nuniform float waterMaskSize;\nuniform float waterMaskStrength;\nuniform float reflectanceRf0;\nuniform vec3 surfaceNormalModifier;\nuniform vec3 foamColor;\nuniform float foamStrength;\nuniform float foamFalloff;\n\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvec4 getNoise( vec2 uv ) {\n    vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n    vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n    vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n    vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n    vec4 noise = texture2D( normalSampler, uv0 ) +\n        texture2D( normalSampler, uv1 ) +\n        texture2D( normalSampler, uv2 ) +\n        texture2D( normalSampler, uv3 );\n    return noise * 0.5 - 1.0;\n}\n\nvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n    vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n    float direction = max( 0.0, dot( eyeDirection, reflection ) );\n    specularColor += pow( direction, shiny ) * sunColor * spec;\n    diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n}\n\nvoid main() {\n    #include <logdepthbuf_fragment>\n\n    // Lighting\n    vec4 noise = getNoise(worldPosition.xz * size);\n    vec3 surfaceNormal = normalize(noise.xzy * surfaceNormalModifier);\n\n    vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n    vec3 specularLight = vec3(0.0, 0.0, 0.0);\n\n    vec3 worldToEye = eye - worldPosition.xyz;\n    vec3 eyeDirection = normalize(worldToEye);\n    sunLight(surfaceNormal, eyeDirection, sunShiny, sunSpec, sunDiffuse, diffuseLight, specularLight);\n\n    // Distortion\n    vec2 distortion = surfaceNormal.xz * (0.001 + 1.0 / length(worldToEye)) * distortionScale;\n\n    // Normalized device space\n    vec2 ndc = mirrorCoord.xy / mirrorCoord.w;\n\n    // Absorbtion\n    float depth = texture2D(depthSampler, vec2(1.0 - ndc.x, ndc.y) - distortion).r;\n    float floorDistance = 2.0 * cameraNear * cameraFar / (cameraFar + cameraNear - (2.0 * depth - 1.0) * (cameraFar - cameraNear));\n    float waterDistance = 2.0 * cameraNear * cameraFar / (cameraFar + cameraNear - (2.0 * gl_FragCoord.z - 1.0) * (cameraFar - cameraNear));\n    float waterDepth = min(floorDistance - waterDistance, waterDepthMax);\n\n    // Mask\n    // float waterMaskDisplacement = snoise2(vec2(time + worldPosition.xz * 0.0005)) * 0.02;\n    float waterMask = texture2D(waterMaskSampler, worldPosition.xz * 0.001 * waterMaskSize).r;\n    vec3 absorbtionColor = mix(waterDepthColor, waterMaskColor, waterMask * waterMaskStrength);\n    vec3 absorbtion = min((waterDepth / waterDepthTransitionSize) * absorbtionColor, vec3(1.0));\n\n    // Refraction\n    vec4 refractionSample = texture2D(refractionSampler, vec2(1.0 - ndc.x, ndc.y) - distortion);\n    vec3 refractionColor = mix(vec3(refractionSample) * 0.5, sunColor, absorbtion);\n\n    // Reflectance\n    float theta = max(dot(eyeDirection, surfaceNormal), 0.0);\n    float rf0 = reflectanceRf0;\n    float reflectance = rf0 + (1.0 - rf0) * pow((1.0 - theta), 5.0);\n\n    // Scatter\n    vec3 scatter = (dot(surfaceNormal, eyeDirection)) * waterColor;\n\n    // Reflection\n    vec3 reflectionSample = vec3(texture2D(mirrorSampler, ndc + distortion));\n\n    // vec3 refractionOutput = (scatter + (refractionColor * diffuseLight)) * 0.3;\n    vec3 refractionOutput = (scatter + refractionColor)  * waterDepthStrength;\n    vec3 reflectionOutput = reflectionSample * 0.9 + specularLight;\n    vec3 albedo = mix(refractionOutput, reflectionOutput, reflectance);\n\n    gl_FragColor = vec4(albedo, alpha);\n\n    // Foam\n    float foamFactor = clamp((floorDistance - waterDistance) / foamFalloff, 0.0, 1.0);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, foamColor, (1.0 - foamFactor) * foamStrength);\n}\n"},oe=new o.ShaderMaterial({fragmentShader:ae.fragmentShader,vertexShader:ae.vertexShader,uniforms:o.UniformsUtils.clone(ae.uniforms),transparent:!1,side:L});return oe.type="OceanWaterMaterial",oe.depthWrite=!0,oe.depthTest=!0,oe.uniforms.mirrorSampler.value=ne.texture,oe.uniforms.refractionSampler.value=re.texture,oe.uniforms.textureMatrix.value=J,oe.uniforms.alpha.value=v,oe.uniforms.time.value=time,oe.uniforms.normalSampler.value=_,oe.uniforms.waterMaskSampler.value=y,oe.uniforms.sunColor.value=w,oe.uniforms.waterColor.value=S,oe.uniforms.sunDirection.value=x,oe.uniforms.distortionScale.value=O,oe.uniforms.waterDepthTransitionSize.value=R,oe.uniforms.waterDepthColor.value=D,oe.uniforms.waterDepthMax.value=A,oe.uniforms.waterDepthStrength.value=U,oe.uniforms.eye.value=C,h.material=oe,h.clipBias=m,h.fog=k,oe.defines.DISTANCE="",oe.uniforms.fogTime={value:0},c.bindHandlers(),c.setupEventListeners(),c.updateDefines(k),c.updateUniforms(k),h.onBeforeRender=function(e,t,n){if($.setFromMatrixPosition(h.matrixWorld),Y.setFromMatrixPosition(n.matrixWorld),X.extractRotation(h.matrixWorld),W.set(0,0,1),W.applyMatrix4(X),view.subVectors($,Y),!(view.dot(W)>0)){view.reflect(W).negate(),view.add($),X.extractRotation(n.matrixWorld),K.set(0,0,-1),K.applyMatrix4(X),K.add(Y),Z.subVectors($,K),Z.reflect(W).negate(),Z.add($),ee.position.copy(view),ee.up.set(0,1,0),ee.up.applyMatrix4(X),ee.up.reflect(W),ee.lookAt(Z),ee.far=n.far,ee.updateMatrixWorld(),ee.projectionMatrix.copy(n.projectionMatrix),J.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),J.multiply(ee.projectionMatrix),J.multiply(ee.matrixWorldInverse),V.setFromNormalAndCoplanarPoint(W,$),V.applyMatrix4(ee.matrixWorldInverse),Q.set(V.normal.x,V.normal.y,V.normal.z,V.constant);var r=ee.projectionMatrix;q.x=(Math.sign(Q.x)+r.elements[8])/r.elements[0],q.y=(Math.sign(Q.y)+r.elements[9])/r.elements[5],q.z=-1,q.w=(1+r.elements[10])/r.elements[14],Q.multiplyScalar(2/Q.dot(q)),r.elements[2]=Q.x,r.elements[6]=Q.y,r.elements[10]=Q.z+1-h.clipBias,r.elements[14]=Q.w,C.setFromMatrixPosition(n.matrixWorld),h.material.uniforms.cameraNear.value=n.near,h.material.uniforms.cameraFar.value=n.far;var o=e.getRenderTarget(),l=e.xr.enabled,c=e.shadowMap.autoUpdate;h.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(ne),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),t.traverse((function(object){"Mesh"!==object.type&&"SkinnedMesh"!==object.type||(object.material&&object.material.fog&&"function"==typeof object.material.disableFog&&object.material.disableFog(),object.userData&&object.userData.renderReflection||object.visible&&(object.visible=!1,object.userData.invisibleForReflection=!0))})),e.render(t,ee),t.traverse((function(object){object.material&&object.material.fog&&"function"==typeof object.material.enableFog&&object.material.enableFog(),object.userData&&object.userData.invisibleForReflection&&(object.visible=!0,object.userData.invisibleForReflection=!1)}));var d=e.getClearAlpha();e.setRenderTarget(re),e.setClearAlpha(0),!1===e.autoClear&&e.clear(),t.traverse((function(object){"Mesh"!==object.type&&"SkinnedMesh"!==object.type||(object.userData&&object.userData.renderRefraction?(object.userData.originalVisibilityState=object.visible,object.visible=!0):object.visible&&(object.visible=!1,object.userData.invisibleForRefraction=!0))})),e.render(t,n),h.material.uniforms.depthSampler.value=re.depthTexture,t.traverse((function(object){object.userData&&(object.userData.renderRefraction&&(object.visible=object.userData.originalVisibilityState),object.userData.invisibleForRefraction&&(object.visible=!0,object.userData.invisibleForRefraction=!1))})),e.setClearAlpha(d),h.visible=!0,e.xr.enabled=l,e.shadowMap.autoUpdate=c,e.setRenderTarget(o);var f=n.viewport;void 0!==f&&e.state.viewport(f)}},c}return Object(c.a)(n,[{key:"destroy",value:function(){this.reflectionRenderTarget.dispose(),this.refractionRenderTarget.dispose(),this.material.dispose(),this.geometry.dispose()}},{key:"bindHandlers",value:function(){this.fogChangeHandler=this.fogChangeHandler.bind(this)}},{key:"setupEventListeners",value:function(){this.fog&&this.fog.addEventListener("change",this.fogChangeHandler)}},{key:"removeEventListeners",value:function(){this.fog&&this.fog.removeEventListener("change",this.fogChangeHandler)}},{key:"updateDefines",value:function(e){if(delete this.material.defines.USE_CUSTOM_FOG,delete this.material.defines.FOG_LINEAR,delete this.material.defines.FOG_EXP,delete this.material.defines.FOG_EXP2,delete this.material.defines.FOG_GROUND,delete this.material.defines.FOG_COMBINED,delete this.material.defines.FOG_ANIMATE,delete this.material.defines.FOG_USE_SUN,delete this.material.defines.DISTANCE,e&&e.visible){switch(this.material.defines.USE_CUSTOM_FOG="",this.material.defines.DISTANCE="",e.type){case N:this.material.defines.FOG_LINEAR="";break;case z:this.material.defines.FOG_EXP="";break;case G:this.material.defines.FOG_EXP2="";break;case H:this.material.defines.FOG_GROUND="";break;case V:this.material.defines.FOG_COMBINED=""}e.animation&&(this.material.defines.FOG_ANIMATE=""),e.sun&&(this.material.defines.FOG_USE_SUN="")}this.material.needsUpdate=!0}},{key:"updateUniforms",value:function(e){this.material.uniforms.fogColor={value:e.color},this.material.uniforms.fogDensity={value:e.density},this.material.uniforms.fogHeight={value:e.height},this.material.uniforms.fogGlobalStrength={value:e.globalStrength},this.material.uniforms.fogNear={value:e.near},this.material.uniforms.fogFar={value:e.far},e.animation&&(this.material.uniforms.fogAnimationScale={value:e.animationScale},this.material.uniforms.fogAnimationSpeed={value:e.animationSpeed},this.material.uniforms.fogAnimationDepth={value:e.animationDepth}),e.sun&&(this.material.uniforms.sunPosition={value:e.sun.position},this.material.uniforms.sunColor={value:e.sun.color},this.material.uniforms.sunStrength={value:e.sun.strength})}},{key:"fogChangeHandler",value:function(e){this.updateDefines(e),this.updateUniforms(e)}},{key:"resize",value:function(e){var t=e.width,n=e.height,r=e.renderScale,o=t*r,l=n*r;this.refractionRenderTarget.setSize(o,l)}}]),n}(o.Mesh);function pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var gt=function(e){Object(d.a)(n,e);var t=pt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.fog,r=e.moon,o=e.windSpeed,l=e.renderer,c=e.sceneRenderer,h=e.camera,d=e.outputEncoding;this._root=t,this._fog=n,this._moon=r,this._windSpeed=o,this._renderer=l,this._sceneRenderer=c,this._camera=h,this._outputEncoding=d,this._mesh=this._createMesh(),this._updateMoonVariables(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._mesh.destroy()}},{key:"mesh",get:function(){return this._mesh}},{key:"windSpeed",get:function(){return this._windSpeed},set:function(e){this._windSpeed=e}},{key:"addAssets",value:function(){var e=y.b.get("water-normal-map");e.wrapS=e.wrapT=o.RepeatWrapping,this._mesh.material.uniforms.normalSampler.value=e;var t=y.b.get("ocean/clouds-map");t.wrapS=t.wrapT=o.MirroredRepeatWrapping,this._mesh.material.uniforms.waterMaskSampler.value=t}},{key:"_bindHandlers",value:function(){this._moonChangeHandler=this._moonChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._moon.addEventListener("change",this._moonChangeHandler)}},{key:"_removeEventListeners",value:function(){this._moon.removeEventListener("change",this._moonChangeHandler)}},{key:"_createMesh",value:function(){var e=new o.Texture,t=new o.Texture,n=new o.PlaneBufferGeometry(1e5,1e5),r=new mt(n,{renderer:this._renderer,textureWidth:1024,textureHeight:1024,waterNormals:e,waterMask:t,alpha:1,sunDirection:null,sunColor:null,waterColor:new o.Color(7695),distortionScale:30,fog:this._fog,sunShiny:371,sunSpec:2.25,sunDiffuse:.5,waterDepthColor:new o.Color(1542043),waterDepthTransitionSize:2281,waterDepthMax:4060,waterMaskColor:new o.Color(0),waterMaskSize:.5,waterMaskStrength:1,reflectanceRf0:0,surfaceNormalModifier:new o.Vector3(.86,2.32,1.5),waterDepthStrength:.08,foamColor:new o.Color(9211020),foamStrength:.684,foamFalloff:308,outputEncoding:this._outputEncoding});return r.material.uniforms.size.value=8.32,r.position.z=0,r.position.y=0,r.rotation.x=-.5*Math.PI,r.userData.renderBloom=!1,r.updateMatrix(),r.matrixAutoUpdate=!1,this.add(r),r}},{key:"_updateMoonVariables",value:function(){var e=(new o.Vector3).copy(this._moon.mesh.position).normalize();this._mesh.material.uniforms.sunDirection.value=e,this._moonDirectionHelper&&this._moonDirectionHelper.setDirection(e),this._mesh.material.uniforms.sunColor.value=this._moon.color}},{key:"_createMoonDirectionHelper",value:function(){var e=new o.Vector3(0,0,0),t=new o.ArrowHelper(this._moonDirection,e,100,16776960,50,50);return t.position.y=100,this.add(t),t}},{key:"update",value:function(e){var t=e.delta;this._mesh.material.uniforms.time.value+=t*this._windSpeed,this._mesh.material.uniforms.cameraNear.value=this._camera.active.near,this._mesh.material.uniforms.cameraFar.value=this._camera.active.far}},{key:"onResize",value:function(e){var t=e.width,n=e.height,r=e.renderScale;this._mesh.resize({width:t,height:n,renderScale:r})}},{key:"_moonChangeHandler",value:function(){this._updateMoonVariables()}}]),n}(Object(_.a)(o.Object3D));function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var _t=function(e){Object(d.a)(n,e);var t=vt(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common,{uColor:{value:new o.Color(e.color)},uRimWidth:{value:4.02},uRimStrength:{value:.11},uOpacity:{value:0}}]),r.type="LightConeMaterial",r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vWorldNormal;\nvarying vec3 vViewVector;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n    vWorldNormal = normalize(normalMatrix * normal);\n    vViewVector = normalize(vec3(modelViewMatrix * vec4(position, 1.0)));\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vWorldNormal;\nvarying vec3 vViewVector;\n\n// Uniforms\nuniform vec3 uColor;\nuniform float uOpacity;\nuniform float uRimWidth;\nuniform float uRimStrength;\n\nvoid main() {\n    // Color\n    vec4 color = vec4(uColor, 1.0);\n\n    // Alpha\n    float rim = pow(abs(dot(vViewVector, vWorldNormal)), uRimWidth) * uRimStrength;\n    color.a = vUv.y * rim * uOpacity;\n\n    // Output\n    gl_FragColor = color;\n    // gl_FragColor = vec4(1.0, 1.0, 1.0, 0.1);\n\n    // Includes\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.uColor.value},set:function(e){this.uniforms.uColor.value=e}}]),n}(Q);function yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var bt=function(e){Object(d.a)(n,e);var t=yt(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common,{diffuse:{value:new o.Color(e.color)},opacity:{value:0}}]),e.billboarding&&("spherical"===e.billboarding&&(r.defines.USE_SPHERICAL_BILLBOARDING=""),"cylindrical"===e.billboarding&&(r.defines.USE_CYLINDRICAL_BILLBOARDING="")),r.vertexShader="#define GLSLIFY 1\nvarying vec2 vUv;\n\n// https://www.geeks3d.com/20140807/billboarding-vertex-shader-glsl/\nmat4 cylindricalBillboarding(mat4 matrix) {\n    matrix[0][0] = 1.0;\n    matrix[0][1] = 0.0;\n    matrix[0][2] = 0.0;\n    matrix[2][0] = 0.0;\n    matrix[2][1] = 0.0;\n    matrix[2][2] = 1.0;\n    return matrix;\n}\n\n// https://www.geeks3d.com/20140807/billboarding-vertex-shader-glsl/\nmat4 sphericalBillboarding(mat4 matrix) {\n    matrix[0][0] = 1.0;\n    matrix[0][1] = 0.0;\n    matrix[0][2] = 0.0;\n    matrix[1][0] = 0.0;\n    matrix[1][1] = 1.0;\n    matrix[1][2] = 0.0;\n    matrix[2][0] = 0.0;\n    matrix[2][1] = 0.0;\n    matrix[2][2] = 1.0;\n    return matrix;\n}\n\nvoid main() {\n    vUv = uv;\n\n    float scale = 2.;\n\n    mat4 mvMatrix = modelViewMatrix;\n\n    #ifdef USE_CYLINDRICAL_BILLBOARDING\n        mvMatrix = cylindricalBillboarding(mvMatrix);\n    #endif\n\n    #ifdef USE_SPHERICAL_BILLBOARDING\n        mvMatrix = sphericalBillboarding(mvMatrix);\n    #endif\n\n    gl_Position = projectionMatrix * mvMatrix * vec4(position, 1.0);\n}\n",r.fragmentShader="#define GLSLIFY 1\nvarying vec2 vUv;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\nvoid main() {\n    vec2 uv = vUv;\n    vec2 center = 2.0 * uv - 1.0;\n    vec4 color = vec4(0.09 / length(center));\n    color.rgb *= diffuse;\n    color.a *= smoothstep(0.9, 0.7, length(center));\n    gl_FragColor = color;\n    gl_FragColor.a *= opacity;\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}}]),n}(Q);function xt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var wt=function(e){Object(d.a)(n,e);var t=xt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._envMap=e.envMap,this._gltf=y.b.get("ocean/model"),this._debug=this._createDebug(),this._lighthouse=this._createLighthouse(),this._island=this._createIsland(),this._lightBulb=this._createLightBulb(),this._coneLight=this._createConeLight(),this.position.y=-30,this.updateMatrix(),this.matrixAutoUpdate=!1,this._bindHandlers(),this._setupEventListeners()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh(),this._removeEventListeners()}},{key:"addAssets",value:function(){var e=y.b.get("ocean/lighthouse/albedo-map");this._lighthouse.material.map=e,this._lighthouse.material.map.encoding=o.LinearEncoding;var t=y.b.get("ocean/island/normal-map");this._island.material.normalMap=t;var n=y.b.get("ocean/island/albedo-map");this._island.material.map=n}},{key:"_bindHandlers",value:function(){this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListeners",value:function(){this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createLighthouse",value:function(){var e=this._gltf.scene.getObjectByName("lighthouse").clone(),map=new o.Texture;if(map.encoding=o.LinearEncoding,e.material=new ae({fog:this._fog,map:map,envMap:this._envMap.texture}),e.userData.renderReflection=!0,e.castShadow=!0,e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),this._debug){var t=this._debug.addGroup("Lighthouse");t.add(e,"visible"),t.add(e.material,"color"),t.add(e.material,"roughness",{min:0,max:1}),t.add(e.material,"metalness",{min:0,max:1}),t.add(e.material,"envMapIntensity",{min:0})}return e}},{key:"_createIsland",value:function(){var e=this._gltf.scene.getObjectByName("island").clone(),map=(e.material,new o.Texture);if(map.encoding=o.sRGBEncoding,e.material=new ae({fog:this._fog,map:map,normalMap:new o.Texture}),e.material.normalScale=new o.Vector2(1,-1),e.material.envMap=this._envMap.texture,e.material.roughness=.54,e.material.metalness=0,e.color=new o.Color(9679646),e.userData.renderBloom=!1,e.userData.renderRefraction=!0,e.userData.renderReflection=!0,e.castShadow=!0,e.receiveShadow=!0,e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),this._debug){var t=this._debug.addGroup("Island");t.add(e,"visible"),t.add(e.material,"color"),t.add(e.material,"roughness",{min:0,max:1}),t.add(e.material,"metalness",{min:0,max:1}),t.add(e.material,"envMapIntensity",{min:0})}return e}},{key:"_destroyMesh",value:function(){this._lighthouse.material.map.dispose(),this._lighthouse.material.dispose(),this._lighthouse.geometry.dispose(),this._lighthouse=null}},{key:"_createLightBulb",value:function(){var e=new o.PlaneBufferGeometry(300,300),t=new bt({color:16777215,transparent:!0,depthTest:.5,depthWrite:!1,side:o.DoubleSide}),n=new o.Mesh(e,t);return n.rotation.y=.5*Math.PI,n.position.x=3809,n.position.y=808,n.position.z=54,this.add(n),n}},{key:"_createConeLight",value:function(){var e=new o.Group;e.position.x=3809,e.position.y=808,e.position.z=54,this.add(e);var t=1e4,n=new o.CylinderBufferGeometry(15,750,t,64,32,!0),r=new _t({color:10724259,transparent:!0,side:o.DoubleSide,depthWrite:!1}),l=new o.Mesh(n,r);l.position.x=5e3,l.rotation.z=.5*Math.PI,l.userData.renderBloom=!0,l.renderOrder=1e3,l.updateMatrix(),l.matrixAutoUpdate=!1,e.add(l);var c=new o.Mesh(n,r);if(c.position.x=-5e3,c.rotation.z=.5*Math.PI,c.rotation.y=Math.PI,c.userData.renderBloom=!0,c.renderOrder=1e3,c.updateMatrix(),c.matrixAutoUpdate=!1,e.add(c),this._debug){var h=this._debug.addGroup("Cone light");h.add(e,"visible"),h.add(e.position,"x",{stepSize:1}),h.add(e.position,"y",{stepSize:1}),h.add(e.position,"z",{stepSize:1}),h.add(r,"color"),h.add(r.uniforms.uRimWidth,"value",{label:"rimWidth"}),h.add(r.uniforms.uRimStrength,"value",{label:"rimStrength"}),h.add(r.uniforms.uOpacity,"value",{label:"opacity"})}return e}},{key:"_destroyConeLight",value:function(){var e=this._coneLight.children[0];e.material.dispose(),e.geometry.dispose()}},{key:"update",value:function(){this._coneLight&&(this._coneLight.rotation.y+=.01),this._lightBulb&&(this._lightBulb.rotation.y+=.01)}},{key:"_envMapChangeHandler",value:function(e){var map=e.map;this._lighthouse.material.envMap=map,this._island.material.envMap=map}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("Lighthouse",{container:"Ocean"});return e.add(this,"visible"),e.add(this,"position",{stepSize:1}),e}}}]),n}(Object(_.a)(o.Object3D)),St=n(174),Ct="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute vec3 instancePosition;\nattribute float instanceScale;\nattribute float swimSpeed;\nattribute float whaleIndex;\nuniform float time;\n\n// #ifdef USE_SKINNING\n//     precision highp sampler2D;\n//     uniform mat4 bindMatrix;\n//     uniform mat4 bindMatrixInverse;\n//     uniform sampler2D boneTexture;\n//     uniform int boneTextureSize;\n//     mat4 getBoneMatrix( const in float i ) {\n//         float j = i * 4.0;\n//         float x = mod( j, float( boneTextureSize ) );\n//         float y = floor( j / float( boneTextureSize ) );\n//         float dx = 1.0 / float( boneTextureSize );\n//         float dy = 1.0 / float( boneTextureSize );\n//         y = dy * ( y + 0.5 );\n\n//         float offset = (1.0 / float(boneTextureSize)) * whaleIndex;\n\n//         vec4 v1 = texture2D( boneTexture, vec2(offset + dx * ( x + 0.5 ), y ) );\n//         vec4 v2 = texture2D( boneTexture, vec2(offset + dx * ( x + 1.5 ), y ) );\n//         vec4 v3 = texture2D( boneTexture, vec2(offset + dx * ( x + 2.5 ), y ) );\n//         vec4 v4 = texture2D( boneTexture, vec2(offset + dx * ( x + 3.5 ), y ) );\n//         // vec4 v1 = vec4(0.0);\n//         // vec4 v2 = vec4(0.0);\n//         // vec4 v3 = vec4(0.0);\n//         // vec4 v4 = vec4(0.0);\n//         mat4 bone = mat4( v1, v2, v3, v4 );\n//         return bone;\n//     }\n// #endif\n\n#ifdef USE_SKINNING\n    #ifdef WEBGL2\n        precision highp sampler2DArray;\n        uniform sampler2DArray boneTexture;\n    #else\n        precision highp sampler2D;\n#define GLSLIFY 1\n\n        uniform sampler2D boneTexture;\n    #endif\n\n    uniform mat4 bindMatrix;\n    uniform mat4 bindMatrixInverse;\n\n    uniform int boneTextureSize;\n    mat4 getBoneMatrix( const in float i ) {\n        float j = i * 4.0;\n        float x = mod( j, float( boneTextureSize ) );\n        float y = floor( j / float( boneTextureSize ) );\n        float dx = 1.0 / float( boneTextureSize );\n        float dy = 1.0 / float( boneTextureSize );\n        y = dy * ( y + 0.5 );\n\n        #ifdef WEBGL2\n            vec4 v1 = texture( boneTexture, vec3( dx * ( x + 0.5 ), y, gl_InstanceID ) );\n            vec4 v2 = texture( boneTexture, vec3( dx * ( x + 1.5 ), y, gl_InstanceID ) );\n            vec4 v3 = texture( boneTexture, vec3( dx * ( x + 2.5 ), y, gl_InstanceID ) );\n            vec4 v4 = texture( boneTexture, vec3( dx * ( x + 3.5 ), y, gl_InstanceID ) );\n        #else\n            vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y) );\n            vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y) );\n            vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y) );\n            vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y) );\n        #endif\n\n        mat4 bone = mat4( v1, v2, v3, v4 );\n        return bone;\n    }\n#endif\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n        #ifdef USE_TANGENT\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        #endif\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n\n    transformed = (transformed + instancePosition) * instanceScale;\n    // transformed += vec3(0.0, 0.0, -time * swimSpeed);\n\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",Ot="#define GLSLIFY 1\n#define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n    #include <transmission_fragment>\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function Lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var kt=function(e){Object(d.a)(n,e);var t=Lt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).lights=!0,e.skinning=!0,e.map=r.map,e.webgl2=r.webgl2,e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,o.UniformsLib.map,{roughness:{value:1},metalness:{value:0},map:{value:r.map},time:{value:0}}]),e.defines.STANDARD="",e.webgl2&&(e.defines.WEBGL2=""),e.vertexShader=Ct,e.fragmentShader=Ot,e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"time",get:function(){return this.uniforms.time.value},set:function(e){this.uniforms.time.value=e}}]),n}(Q);function Mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Tt=function(e){Object(d.a)(n,e);var t=Mt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog;(this._fog=t,this._webgl2=St.a.isWebGL2Available(),this._gltf=y.b.get("ocean/model"),this._placeholders=this._getPlaceholders(),this._offsetMatrix=new o.Matrix4,this._mesh=this._createMesh(),this._mixers=this._createMixers(),x.a)&&x.a.addGroup("Whales",{container:"Ocean"}).add(this,"visible");this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"addAssets",value:function(){var e=y.b.get("ocean/whale/color-map");this._mesh.material.uniforms.map.value=e}},{key:"_getPlaceholders",value:function(){return this._gltf.scene.getObjectByName("whales-placeholders").children}},{key:"_createMesh",value:function(){var map=new o.Texture;map.encoding=o.sRGBEncoding;for(var e,t=this._gltf.scene.getObjectByName("whale-model"),n=t.geometry,r=new kt({fog:this._fog,map:map,webgl2:this._webgl2}),l=this._placeholders.length,c=[],h=[],d=[],f=[],i=0,m=this._placeholders.length;i<m;i++)e=this._placeholders[i],c.push(e.position.x),c.push(e.position.y),c.push(e.position.z),h.push(2+.5*Math.random()),d.push(.5+.5*Math.random()),f[i]=i;var v=new o.InstancedBufferGeometry;v.instanceCount=l,v.setAttribute("position",n.getAttribute("position")),v.setAttribute("normal",n.getAttribute("normal")),v.setAttribute("uv",n.getAttribute("uv")),v.setAttribute("skinIndex",n.getAttribute("skinIndex")),v.setAttribute("skinWeight",n.getAttribute("skinWeight")),v.setIndex(n.getIndex()),v.setAttribute("instancePosition",new o.InstancedBufferAttribute(new Float32Array(c),3)),v.setAttribute("instanceScale",new o.InstancedBufferAttribute(new Float32Array(h),1)),v.setAttribute("swimSpeed",new o.InstancedBufferAttribute(new Float32Array(d),1)),v.setAttribute("whaleIndex",new o.InstancedBufferAttribute(new Float32Array(f),1));var _=t.skeleton,y=_.bones,x=Math.sqrt(4*y.length);x=o.MathUtils.ceilPowerOfTwo(x),x=Math.max(x,4);var w=new Float32Array(x*x*4*l);w.set(_.boneMatrices);var S=new o.DataTexture2DArray(w,x,x,l);(S=this._webgl2?new o.DataTexture2DArray(w,x,x,l):new o.DataTexture(w,x,x)).format=o.RGBAFormat,S.type=o.FloatType,S.needsUpdate=!0,_.boneMatrices=w,_.boneTexture=S,_.boneTextureSize=x,_.update=function(){};for(var C=t.parent.clone();C.children.length>0;)C.remove(C.children[0]);var O=new o.SkinnedMesh(v,r);return O.bind(_,t.matrixWorld),O.add(t.parent.children[0]),O.visible=!1,O.frustumCulled=!1,O.updateMatrix(),O.matrixAutoUpdate=!1,O.userData.renderRefraction=!0,O.userData.renderBloom=!1,C.add(O),this.add(C),O}},{key:"_destroyMesh",value:function(){this._mesh.material.map.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_createMixers",value:function(){for(var e=[],i=0,t=this._placeholders.length;i<t;i++){var n=new o.AnimationMixer(this._mesh),r=this._gltf.animations,l=o.AnimationUtils.subclip(r[0],"swim",0,310),c=n.clipAction(l);c.clampWhenFinished=!0,c.play(),n.update(10*Math.random()),e.push(n)}return e}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._mesh.material.time=50*time;for(var n=this._mesh.skeleton,r=n.bones,o=n.boneInverses,l=n.boneMatrices,c=n.boneTexture,i=0,h=this._mixers.length;i<h;i++){if(this._mixers[i].update(t),this._mesh.parent.updateMatrixWorld(),this._webgl2)for(var d=0,f=r.length;d<f;d++)this._offsetMatrix.multiplyMatrices(r[d].matrixWorld,o[d]),this._offsetMatrix.toArray(l,16*d+i*c.image.width*c.image.height*4);else for(var m=0,v=r.length;m<v;m++)this._offsetMatrix.multiplyMatrices(r[m].matrixWorld,o[m]),this._offsetMatrix.toArray(l,16*m);c.needsUpdate=!0}}}]),n}(Object(_.a)(o.Object3D)),Pt="#define GLSLIFY 1\nattribute float instanceAlpha;\nvarying float vInstanceAlpha;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <skinbase_vertex>\n    #ifdef USE_ENVMAP\n        #include <beginnormal_vertex>\n        #include <morphnormal_vertex>\n        #include <skinnormal_vertex>\n        #include <defaultnormal_vertex>\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <worldpos_vertex>\n    #include <clipping_planes_vertex>\n    #include <envmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    vInstanceAlpha = instanceAlpha;\n}",Rt="#define GLSLIFY 1\nvarying float vInstanceAlpha;\n\nuniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <specularmap_fragment>\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    #ifdef USE_LIGHTMAP\n        vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n        reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n    #else\n        reflectedLight.indirectDiffuse += vec3( 1.0 );\n    #endif\n    #include <aomap_fragment>\n    reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n    vec3 outgoingLight = reflectedLight.indirectDiffuse;\n    #include <envmap_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n    gl_FragColor.a *= vInstanceAlpha;\n}\n";function Dt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var At=function(e){Object(d.a)(n,e);var t=Dt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,{diffuse:{value:new o.Color(r.color)}}]),r.map&&(e.uniforms.map.value=r.map,e.map=r.map),e.type="WakeMaterial",e.vertexShader=Pt,e.fragmentShader=Rt,e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}}]),n}(Q);function Et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var It=1e5,jt=function(e){Object(d.a)(n,e);var t=Et(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog,n=e.positions,r=e.modifiers;this._fog=t,this._positions=n,this._modifiers=r,this._size=10,this._spawnTime=0,this._particles=[],this._objectPool=new Qe(It,Ft),this._mesh=this._createMesh()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"addAssets",value:function(){var e=y.b.get("ocean/sailboat/wake-map");this._mesh.material.uniforms.map.value=e}},{key:"update",value:function(e){var t,time=e.time;this._spawnTime++,this._spawnTime%10==0&&this._spawn(time);for(var i=this._particles.length-1;i>=0;i--)(t=this._particles[i]).update(time),this._mesh.setMatrixAt(i,t.matrix),this._mesh.geometry.attributes.instanceAlpha.setX(i,t.alpha),t.isDead&&(this._objectPool.recycle(t),this._particles.splice(this._particles.indexOf(t),1));this._mesh.geometry.attributes.instanceAlpha.needsUpdate=!0,this._mesh.instanceMatrix.needsUpdate=!0}},{key:"_createMesh",value:function(){for(var e=[],i=0;i<It;i++)e.push(0);var t=new o.PlaneBufferGeometry(this._size,this._size),n=new o.InstancedBufferAttribute(new Float32Array(e),1);n.setUsage(o.DynamicDrawUsage),t.setAttribute("instanceAlpha",n);var r=new At({fog:this._fog,transparent:!0,map:new o.Texture,depthWrite:!1,blending:o.AdditiveBlending,polygonOffset:!0,polygonOffsetFactor:-2}),l=new o.InstancedMesh(t,r,It);return l.instanceMatrix.setUsage(o.DynamicDrawUsage),this.add(l),l}},{key:"_destroyMesh",value:function(){this._mesh.material.map.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_spawn",value:function(time){for(var e,t,n,r,l,c,h,i=0,d=this._positions.length;i<d;i++)e=this._objectPool.obtain(),t=this._modifiers[3*i+1],(n=new o.Vector3(Math.sin(t),0,Math.cos(t))).multiplyScalar(5e-4),h=this._positions[i],r=time*this._modifiers[3*i+2],l=h[0]+Math.sin(t)*-r,c=h[1]+Math.cos(t)*-r,e.reset({position:new o.Vector3(l,0,c),alpha:.01+.09*Math.random(),wind:n,speed:this._modifiers[3*i+2]}),this._particles.push(e)}}]),n}(Object(_.a)(o.Object3D)),Ft=function(e){Object(d.a)(n,e);var t=Et(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this))._alphaOrigin=null,e._alpha=null,e._location=null,e._acceleration=null,e._velocity=null,e._wind=null,e._life=null,e._isDead=!1,e}return Object(c.a)(n,[{key:"isDead",get:function(){return this._isDead}},{key:"alpha",get:function(){return this._alpha}},{key:"reset",value:function(e){var t=e.position,n=e.alpha,r=e.wind,l=(e.angle,e.speed);this._alphaOrigin=n,this._location=t,this._acceleration=new o.Vector3(0,0,0),this._velocity=new o.Vector3(0,0,0),this._wind=r,this._speed=l,this._life=1,this._isDead=!1,this.rotation.z=2*Math.PI*Math.random(),this.rotation.x=-.5*Math.PI}},{key:"applyForce",value:function(e){var t=e.clone();this._acceleration.add(t)}},{key:"update",value:function(time){this._life-=.002,this._alpha=this._alphaOrigin*this._life,this.applyForce(this._wind),this._velocity.add(this._acceleration),this._location.add(this._velocity),this._acceleration.multiplyScalar(0),this.position.copy(this._location);var e=1+2*(1-this._life);this.scale.set(e,e,e),this.updateMatrix(),this._life<0&&(this._isDead=!0)}}]),n}(o.Object3D);function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ut=function(e){Object(d.a)(n,e);var t=Bt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.position,n=e.timeOffset,r=e.angle,o=e.speed,l=e.color,c=e.intensity,h=e.distance,d=e.offset,f=e.size;this._position=t,this._timeOffset=n,this._angle=r,this._speed=o,this._color=l,this._intensity=c,this._distance=h,this._offset=d,this._size=f,this._lightMesh=this._createMesh(),this.rotation.y=this._angle}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyLightMesh()}},{key:"update",value:function(e){var time=e.time,t=time*-this._speed;this.position.x=this._position[0]+t*Math.sin(this._angle),this.position.z=this._position[1]+t*Math.cos(this._angle),this.position.y=Math.sin(time+this._timeOffset),this.rotation.z=-.05*Math.sin(time+this._timeOffset)}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._light.color=this._color,this._lightMesh.material.color=this._color}},{key:"intensity",get:function(){return this._intensity},set:function(e){this._intensity=e,this._light.intensity=this._intensity}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e}},{key:"offset",get:function(){return this._offset}},{key:"offsetX",get:function(){return this._offset.x},set:function(e){this._offset.x=e,this._lightMesh.position.copy(this._offset)}},{key:"offsetY",get:function(){return this._offset.y},set:function(e){this._offset.y=e,this._lightMesh.position.copy(this._offset)}},{key:"offsetZ",get:function(){return this._offset.z},set:function(e){this._offset.z=e,this._lightMesh.position.copy(this._offset)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e;var t=new o.PlaneBufferGeometry(this._size,this._size);this._lightMesh.geometry=t}},{key:"mesh",get:function(){return this._lightMesh}},{key:"_createMesh",value:function(){var e=new o.PlaneBufferGeometry(this._size,this._size),t=(new o.Matrix4).makeTranslation(0,0,1);e.applyMatrix4(t);var n=new bt({color:this._color,transparent:!0,blending:o.AdditiveBlending,depthWrite:!1,depthTest:!0,billboarding:"spherical"});n.uniforms.opacity.value=0;var r=new o.Mesh(e,n);return r.position.set(this._offset.x,this._offset.y,this._offset.z),r.updateMatrix(),r.matrixAutoUpdate=!1,this.add(r),r}},{key:"_destroyLightMesh",value:function(){this._lightMesh.material.dispose(),this._lightMesh.geometry.dispose(),this._lightMesh=null}}]),n}(Object(_.a)(o.Object3D)),Nt="#define GLSLIFY 1\nattribute vec3 modifiers;\n\nuniform float uTime;\nuniform float uWindFrequency;\nuniform float uWindAmplitude;\nuniform float uWindSpeed;\n\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nmat3 rotation3dY(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\tc, 0.0, -s,\n\t\t0.0, 1.0, 0.0,\n\t\ts, 0.0, c\n\t);\n}\n\nmat3 rotation3dZ(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\tc, s, 0.0,\n\t\t-s, c, 0.0,\n\t\t0.0, 0.0, 1.0\n\t);\n}\n\nfloat cubicPulse(float c, float w, float x) {\n    x = abs(x - c);\n    if(x > w) return 0.0;\n    x /= w;\n    return 1.0 - x * x * (3.0 - 2.0 * x);\n}\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n        #ifdef USE_TANGENT\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        #endif\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    float x = sin(transformed.z * uWindFrequency + uTime * uWindSpeed) * uWindAmplitude;\n    x *= cubicPulse(0.5, 0.5, uv.y);\n    transformed = transformed + vec3(x, 0.0, 0.0);\n\n    transformed *= rotation3dZ(sin(uTime + modifiers.x) * 0.05);\n    float moveSpeed = uTime * modifiers.z;\n    transformed += vec3(0.0, sin(uTime + modifiers.x) * 0.2, -moveSpeed);\n\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",zt="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n\n    /**\n    * This is a template that can be used to light a material, it uses pluggable\n    * RenderEquations (RE)for specific lighting scenarios.\n    *\n    * Instructions for use:\n    * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n    * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n    * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n    *\n    * TODO:\n    * - Add area light support.\n    * - Add sphere light support.\n    * - Add diffuse light probe (irradiance cubemap) support.\n    */\n\n    GeometricContext geometry;\n\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    #ifdef CLEARCOAT\n\n        geometry.clearcoatNormal = clearcoatNormal;\n\n    #endif\n\n    IncidentLight directLight;\n\n    // #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n    //     PointLight pointLight;\n    //     #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n    //     PointLightShadow pointLightShadow;\n    //     #endif\n\n    //     #pragma unroll_loop_start\n    //     for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n    //         pointLight = pointLights[ i ];\n\n    //         getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n    //         #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n    //         pointLightShadow = pointLightShadows[ i ];\n    //         directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n    //         #endif\n\n    //         RE_Direct( directLight, geometry, material, reflectedLight );\n\n    //     }\n    //     #pragma unroll_loop_end\n\n    // #endif\n\n    #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        SpotLight spotLight;\n        #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n        SpotLightShadow spotLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n            spotLight = spotLights[ i ];\n\n            getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n            spotLightShadow = spotLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n        DirectionalLight directionalLight;\n        #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n        DirectionalLightShadow directionalLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n            directionalLight = directionalLights[ i ];\n\n            getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n            directionalLightShadow = directionalLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n        RectAreaLight rectAreaLight;\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n            rectAreaLight = rectAreaLights[ i ];\n            RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if defined( RE_IndirectDiffuse )\n\n        vec3 iblIrradiance = vec3( 0.0 );\n\n        vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n        irradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n        #if ( NUM_HEMI_LIGHTS > 0 )\n\n            #pragma unroll_loop_start\n            for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n                irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n            }\n            #pragma unroll_loop_end\n\n        #endif\n\n    #endif\n\n    #if defined( RE_IndirectSpecular )\n\n        vec3 radiance = vec3( 0.0 );\n        vec3 clearcoatRadiance = vec3( 0.0 );\n\n    #endif\n\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function Gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ht=function(e){Object(d.a)(n,e);var t=Gt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{diffuse:{value:new o.Color(r.color)},emissive:{value:new o.Color(0)},roughness:{value:r.roughness},metalness:{value:r.metalness}},{uTime:{value:0},uWindFrequency:{value:.2},uWindAmplitude:{value:1},uWindSpeed:{value:1.65}}]),e.type="SpinnakerMaterial",e.lights=!0,e.vertexShader=Nt,e.fragmentShader=zt,e.extensions={derivatives:!0},e}return n}(Q),Vt="#define GLSLIFY 1\nattribute vec3 modifiers;\n\nuniform float uTime;\n\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nmat3 rotation3dY(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\tc, 0.0, -s,\n\t\t0.0, 1.0, 0.0,\n\t\ts, 0.0, c\n\t);\n}\n\nmat3 rotation3dZ(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\tc, s, 0.0,\n\t\t-s, c, 0.0,\n\t\t0.0, 0.0, 1.0\n\t);\n}\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n        #ifdef USE_TANGENT\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        #endif\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    transformed *= rotation3dZ(sin(uTime + modifiers.x) * 0.05);\n    float moveSpeed = uTime * modifiers.z;\n    transformed += vec3(0.0, sin(uTime + modifiers.x) * 0.2, -moveSpeed);\n\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",Wt="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n\n    /**\n    * This is a template that can be used to light a material, it uses pluggable\n    * RenderEquations (RE)for specific lighting scenarios.\n    *\n    * Instructions for use:\n    * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n    * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n    * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n    *\n    * TODO:\n    * - Add area light support.\n    * - Add sphere light support.\n    * - Add diffuse light probe (irradiance cubemap) support.\n    */\n\n    GeometricContext geometry;\n\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    #ifdef CLEARCOAT\n\n        geometry.clearcoatNormal = clearcoatNormal;\n\n    #endif\n\n    IncidentLight directLight;\n\n    // #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n    //     PointLight pointLight;\n    //     #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n    //     PointLightShadow pointLightShadow;\n    //     #endif\n\n    //     #pragma unroll_loop_start\n    //     for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n    //         pointLight = pointLights[ i ];\n\n    //         getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n    //         #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n    //         pointLightShadow = pointLightShadows[ i ];\n    //         directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n    //         #endif\n\n    //         RE_Direct( directLight, geometry, material, reflectedLight );\n\n    //     }\n    //     #pragma unroll_loop_end\n\n    // #endif\n\n    #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        SpotLight spotLight;\n        #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n        SpotLightShadow spotLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n            spotLight = spotLights[ i ];\n\n            getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n            spotLightShadow = spotLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n        DirectionalLight directionalLight;\n        #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n        DirectionalLightShadow directionalLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n            directionalLight = directionalLights[ i ];\n\n            getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n            directionalLightShadow = directionalLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n        RectAreaLight rectAreaLight;\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n            rectAreaLight = rectAreaLights[ i ];\n            RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if defined( RE_IndirectDiffuse )\n\n        vec3 iblIrradiance = vec3( 0.0 );\n\n        vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n        irradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n        #if ( NUM_HEMI_LIGHTS > 0 )\n\n            #pragma unroll_loop_start\n            for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n                irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n            }\n            #pragma unroll_loop_end\n\n        #endif\n\n    #endif\n\n    #if defined( RE_IndirectSpecular )\n\n        vec3 radiance = vec3( 0.0 );\n        vec3 clearcoatRadiance = vec3( 0.0 );\n\n    #endif\n\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n}\n";function $t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var qt=function(e){Object(d.a)(n,e);var t=$t(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{diffuse:{value:new o.Color(r.color||16777215)},emissive:{value:new o.Color(0)},roughness:{value:r.roughness},metalness:{value:r.metalness}},{uTime:{value:0}}]),e.type="BoatMaterial",e.lights=!0,e.vertexShader=Vt,e.fragmentShader=Wt,e.extensions={derivatives:!0},e}return n}(Q);function Yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Xt=function(e){Object(d.a)(n,e);var t=Yt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog;this._fog=t,this._scale=1.5,this._windSpeed=.005,this._materialColor=new o.Color(16777215),this._materialRoughness=1,this._materialMetalness=.2,this._debug=this._createDebug(),this._positions=this._createPositions(),this._modifiers=this._createModifiers(),this._gltf=y.b.get("ocean/model"),this._boats=this._createBoats(),this._spinnakers=this._createSpinnakers(),this._lights=this._createLights(),this.position.z=2e3,this.updateMatrix(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyBoats(),this._destroySpinnakers(),this._destroyLights()}},{key:"addAssets",value:function(){this._wake&&"function"==typeof this._wake.addAssets&&this._wake.addAssets()}},{key:"showLights",value:function(){for(var e,t=new v.a.timeline,i=0,n=this._lights.length;i<n;i++)e=this._lights[i],t.to(e.mesh.material.uniforms.opacity,{duration:1,value:1,ease:"sine.inOut"},.05*i);return t}},{key:"hideLights",value:function(){for(var e,t=new v.a.timeline,i=0,n=this._lights.length;i<n;i++)e=this._lights[i],t.to(e.mesh.material.uniforms.opacity,{duration:1,value:0,ease:"sine.inOut"},0);return t}},{key:"_createPositions",value:function(){for(var e,t,n=[],i=0;i<10;i++)e=1500*(2*Math.random()-1),t=7e3*(2*Math.random()-1),n.push([e,t]);return n}},{key:"_createModifiers",value:function(){for(var e=[],i=0;i<10;i++)e.push(100*Math.random()),e.push(.2*Math.PI*Math.random()),e.push(10*(.5+.5*Math.random()));return e}},{key:"_createBoats",value:function(){var e=this._gltf.scene.getObjectByName("sailboat-main").clone().geometry;e.setAttribute("modifiers",new o.InstancedBufferAttribute(new Float32Array(this._modifiers),3)),e.scale(this._scale,this._scale,this._scale);var t=new qt({fog:this._fog,color:this._materialColor,side:o.DoubleSide,roughness:this._materialRoughness,metalness:this._materialMetalness,lights:!1,wireframe:!1}),n=new o.InstancedMesh(e,t,10);n.userData.renderReflection=!0,n.userData.renderBloom=!1,n.matrixAutoUpdate=!1;for(var r=new o.Object3D,i=0,l=this._positions.length;i<l;i++)r.position.x=this._positions[i][0],r.position.z=this._positions[i][1],r.rotation.y=this._modifiers[3*i+1],r.updateMatrix(),n.setMatrixAt(i,r.matrix);return this.add(n),n}},{key:"_destroyBoats",value:function(){this._boats.material.dispose(),this._boats.geometry.dispose(),this._boats=null}},{key:"_createSpinnakers",value:function(){var e=this._gltf.scene.getObjectByName("sailboat-spinnaker").clone().geometry;e.setAttribute("modifiers",new o.InstancedBufferAttribute(new Float32Array(this._modifiers),3)),e.scale(this._scale,this._scale,this._scale);var t=new Ht({fog:this._fog,color:new o.Color(16777189),side:o.DoubleSide,roughness:this._materialRoughness,metalness:this._materialMetalness,lights:!1}),n=new o.InstancedMesh(e,t,10);n.userData.renderReflection=!0,n.userData.renderBloom=!1,n.matrixAutoUpdate=!1;for(var r=new o.Object3D,i=0,l=this._positions.length;i<l;i++)r.position.x=this._positions[i][0],r.position.z=this._positions[i][1],r.rotation.y=this._modifiers[3*i+1],r.updateMatrix(),n.setMatrixAt(i,r.matrix);if(this.add(n),this._debug){var c=this._debug.addGroup("Spinnaker");c.add(t.uniforms.diffuse,"value",{label:"color"}),c.add(t.uniforms.roughness,"value",{label:"roughness"}),c.add(t.uniforms.metalness,"value",{label:"metalness"}),c.add(t.uniforms.uWindFrequency,"value",{label:"windFrequency"}),c.add(t.uniforms.uWindAmplitude,"value",{label:"windAmplitude"}),c.add(t.uniforms.uWindSpeed,"value",{label:"windSpeed"})}return n}},{key:"_destroySpinnakers",value:function(){this._spinnakers.material.dispose(),this._spinnakers.geometry.dispose(),this._spinnakers=null}},{key:"_createWake",value:function(){var e=new jt({fog:this._fog,positions:this._positions,modifiers:this._modifiers});(this.add(e),this._debug)&&this._debug.addGroup("Wake").add(e,"visible");return e}},{key:"_createLights",value:function(){for(var e=[],i=0,t=this._positions.length;i<t;i++){var n=new Ut({position:this._positions[i],timeOffset:this._modifiers[3*i+0],angle:this._modifiers[3*i+1],speed:this._modifiers[3*i+2],color:new o.Color(10921638),intensity:25,distance:120,offset:new o.Vector3(12.09,45.03,-4.87),size:38});e.push(n),this.add(n)}if(this._debug){var r={offset:e[0].offset,color:e[0].color,intensity:e[0].intensity,distance:e[0].distance,size:e[0].size},l=this._debug.addGroup("Light");l.add(r,"color",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].color=r.color}}),l.add(r,"intensity",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].intensity=r.intensity}}),l.add(r,"distance",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].distance=r.distance}}),l.add(r.offset,"x",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].offsetX=r.offset.x}}),l.add(r.offset,"y",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].offsetY=r.offset.y}}),l.add(r.offset,"z",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].offsetZ=r.offset.z}}),l.add(r,"size",{onChange:function(){for(var t=0,n=e.length;t<n;t++)e[t].size=r.size}})}return e}},{key:"_destroyLights",value:function(){for(var i=0,e=this._lights.length;i<e;i++)this._lights[i].destroy()}},{key:"update",value:function(e){var time=e.time,t=e.delta;if(this._spinnakers&&(this._spinnakers.material.uniforms.uTime.value=time),this._boats&&(this._boats.material.uniforms.uTime.value=time),this._wake&&this._wake.update({time:time,delta:t}),this._lights)for(var i=0,n=this._lights.length;i<n;i++)this._lights[i].update({time:time,delta:t})}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Sailboat",{container:"Ocean"});t.add(this,"visible");var n=t.addGroup("Material");return n.add(this,"_materialColor",{label:"color",onChange:function(){e._boats.material.uniforms.diffuse.value=e._materialColor}}),n.add(this,"_materialRoughness",{label:"roughness",min:0,max:1,onChange:function(){e._boats&&(e._boats.material.uniforms.roughness.value=e._materialRoughness)}}),n.add(this,"_materialMetalness",{label:"metalness",min:0,max:1,onChange:function(){e._boats&&(e._boats.material.uniforms.metalness.value=e._materialMetalness)}}),t}}}]),n}(Object(_.a)(o.Object3D));function Kt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Qt=500,Zt=function(e){Object(d.a)(n,e);var t=Kt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.camera;this._root=t,this._renderer=n,this._camera=r,this._displacementSpeed=.1,this._scene=this._createDepthScene(),this._depthRenderTarget=this._createDepthRenderTarget(),this._clouds=this._createClouds(),this._renderDepth(),this.matrixAutoUpdate=!1}},{key:"addAssets",value:function(){var e=y.b.get("fog/texture");this._clouds.material.uniforms.uTexture.value=e;var t=y.b.get("fog/displacement");t.wrapS=o.RepeatWrapping,t.wrapT=o.RepeatWrapping,this._clouds.material.uniforms.uDisplacementTexture.value=e}},{key:"_createDepthScene",value:function(){var e=new o.Scene,t=new o.PlaneBufferGeometry(1e5,1e5),n=new o.MeshBasicMaterial,r=new o.Mesh(t,n);return r.rotation.x=-.5*Math.PI,e.add(r),e}},{key:"_createDepthRenderTarget",value:function(){var e=new o.WebGLRenderTarget(1,1);return e.texture.format=o.RGBFormat,e.texture.minFilter=o.NearestFilter,e.texture.magFilter=o.NearestFilter,e.texture.generateMipmaps=!1,e.depthBuffer=!0,e.depthTexture=new o.DepthTexture,e.depthTexture.format=o.DepthFormat,e.depthTexture.type=o.UnsignedShortType,e}},{key:"_createClouds",value:function(){for(var e=new o.PlaneBufferGeometry(100,100),t=new Float32Array(Qt),i=0;i<Qt;i++)t[i]=Math.random()*Math.PI*2;for(var n=new Float32Array(Qt),r=0;r<Qt;r++)n[r]=.8+.2*Math.random();var l=new o.InstancedBufferAttribute(t,1,!1);e.attributes.rotation=l;var c=new o.InstancedBufferAttribute(n,1,!1);e.attributes.scale=c;var h=new o.ShaderMaterial({vertexShader:"#define GLSLIFY 1\n// Attributes\nattribute float rotation;\nattribute float scale;\n\n// Varyings\nvarying vec2 vUv;\nvarying float vZ;\n\n// Uniforms\nuniform float uScale;\n\nvoid main() {\n    // Billboarding\n    vec4 mvPosition = modelViewMatrix * instanceMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Scale\n    vec2 alignedPosition = position.xy * scale * uScale;\n\n    // Rotation\n    vec2 rotatedPosition;\n    rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n    rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n    mvPosition.xy += rotatedPosition;\n\n    // Varyings\n    vZ = mvPosition.z;\n    vUv = uv;\n\n    // Ouput\n    gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader:"#define GLSLIFY 1\n// Includes\n#include <packing>\n\n// Varyings\nvarying vec2 vUv;\nvarying float vZ;\n\n// Uniforms\nuniform sampler2D uTexture;\nuniform sampler2D uDisplacementTexture;\nuniform float uDisplacementScale;\nuniform float uDisplacementStrength;\nuniform sampler2D uDepthTexture;\nuniform float uTime;\nuniform float uOpacity;\nuniform vec2 uResolution;\nuniform float uTransitionSize;\nuniform float uCameraNear;\nuniform float uCameraFar;\nuniform vec3 uColor;\n\n// Functions\nfloat readDepth(sampler2D depthSampler, vec2 coord) {\n    float fragCoordZ = texture2D(depthSampler, coord).x;\n    return perspectiveDepthToViewZ(fragCoordZ, uCameraNear, uCameraFar);\n}\n\nvoid main() {\n    // Displacement\n    vec2 displacementUv = vUv;\n    displacementUv.y -= uTime;\n    displacementUv *= uDisplacementScale;\n    vec4 displacement = texture2D(uDisplacementTexture, displacementUv);\n\n    // Color\n    vec2 uv = vUv;\n    uv += (-1.0 + displacement.r * 2.0) * uDisplacementStrength;\n    vec4 color = texture2D(uTexture, uv);\n    color.rgb *= uColor;\n\n    // Depth\n    vec2 depthUv = gl_FragCoord.xy / uResolution.xy;\n    float sceneDepth = readDepth(uDepthTexture, depthUv);\n    float currentDepth = vZ;\n    float depthDiff = clamp((currentDepth - sceneDepth) / uTransitionSize, 0.0, 1.0);\n    float depthAlpha = depthDiff * depthDiff;\n\n    // Output\n    gl_FragColor = color;\n    gl_FragColor.a *= uOpacity * depthAlpha;\n}\n",uniforms:{uTexture:{value:null},uDisplacementTexture:{value:null},uDisplacementScale:{value:1},uDisplacementStrength:{value:.02},uDepthTexture:{value:null},uTime:{value:0},uOpacity:{value:.012},uResolution:{value:new o.Vector2},uTransitionSize:{value:37},uScale:{value:11.59},uCameraNear:{value:null},uCameraFar:{value:null},uColor:{value:new o.Color(12566463)}},transparent:!0,depthWrite:!1}),d=new o.InstancedMesh(e,h,Qt);d.userData.renderToDepth=!1,d.position.x=4783,d.position.y=-428,d.position.z=-170,d.frustumCulled=!1,d.renderOrder=1,d.updateMatrix(),d.matrixAutoUpdate=!1;for(var f,m,v,_,y=new o.Object3D,w=0;w<Qt;w++)_=500*Math.random()-250,f=1600*(2*Math.random()-1)+_,m=_,v=1600*(2*Math.random()-1)+_,y.position.x=f,y.position.y=m,y.position.z=v,y.updateMatrix(),d.setMatrixAt(w,y.matrix);if(x.a){var S=x.a.addGroup("Fog soft",{container:"Ocean"});S.add(d,"position",{stepSize:1}),S.add(h.uniforms.uScale,"value",{label:"scale"}),S.add(h.uniforms.uOpacity,"value",{label:"opacity",min:0,stepSize:.001}),S.add(h.uniforms.uDisplacementScale,"value",{label:"displacement scale"}),S.add(h.uniforms.uDisplacementStrength,"value",{label:"displacement strength"}),S.add(h.uniforms.uColor,"value",{label:"color"}),S.add(h.uniforms.uTransitionSize,"value",{label:"transition size",stepSize:1}),S.add(this,"_displacementSpeed",{label:"displacement speed"})}return this.add(d),d}},{key:"update",value:function(e){var t=e.delta;this._renderDepth(),this._clouds.material.uniforms.uTime.value+=t*this._displacementSpeed,this._clouds.material.uniforms.uCameraNear.value=this._camera.active.near,this._clouds.material.uniforms.uCameraFar.value=this._camera.active.far,this._clouds.material.uniforms.uDepthTexture.value=this._depthRenderTarget.depthTexture}},{key:"_renderDepth",value:function(){this._renderer.setRenderTarget(this._depthRenderTarget),this._renderer.clear(),this._renderer.render(this._scene,this._camera.active),this._renderer.setRenderTarget(null)}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._resizeDepthRenderTarget(t,n),this._resizeMaterial(t,n)}},{key:"_resizeDepthRenderTarget",value:function(e,t){this._depthRenderTarget.setSize(512,512)}},{key:"_resizeMaterial",value:function(e,t){this._clouds.material.uniforms.uResolution.value.x=e,this._clouds.material.uniforms.uResolution.value.y=t}}]),n}(Object(_.a)(o.Object3D));function Jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var en=function(e){Object(d.a)(n,e);var t=Jt(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog;this._fog=t,this._mesh=this._createMesh(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"_createMesh",value:function(){var e=404,t=y.b.get("ocean/model").scene.getObjectByName("ocean-floor").geometry.clone(),n=new o.MeshBasicMaterial;n.color=new o.Color(0),n.side=o.DoubleSide;var r=new o.InstancedMesh(t,n,16);r.position.x=-18180,r.position.z=-18180,r.position.y=-1758,r.position.z+=-12e3,r.rotation.y=.12,r.scale.set(30,32.64,30),r.visible=!1,r.userData.renderRefraction=!0,r.userData.renderBloom=!1,r.updateMatrix(),r.matrixAutoUpdate=!1,this.add(r);for(var l=new o.Object3D,c=0,h=0;h<4;h++)for(var d=0;d<4;d++)l.position.x=h*e,l.position.z=d*e,l.scale.x=h%2==0?-1:1,l.scale.z=d%2==0?-1:1,l.updateMatrix(),r.setMatrixAt(c,l.matrix),c++;if(x.a){var f=x.a.addGroup("Ocean floor",{container:"Ocean"});f.add(this,"visible"),f.add(r.material,"color"),f.add(r.position,"y",{label:"depth",stepSize:1}),f.add(r.position,"z",{label:"z",stepSize:1});var m=f.addGroup("Scale");m.add(r.scale,"x"),m.add(r.scale,"y"),m.add(r.scale,"z");var v=f.addGroup("Rotation");v.add(r.rotation,"x"),v.add(r.rotation,"y"),v.add(r.rotation,"z")}return r}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}}]),n}(Object(_.a)(o.Object3D));function tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var nn=function(e){Object(d.a)(n,e);var t=tn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._envMap=e.envMap,this._sun=e.sun||null,this._rotation=e.rotation||new o.Euler(0,0,0),this._debugContainer=e.debugContainer,this._strength=e.strength||1,this._debug=this._createDebug(),this._mesh=this._createMesh(),this._stars=this._createStars(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListener(),this._destroyMesh()}},{key:"addAssets",value:function(){var e=y.d.get("dust-particle");this._stars.material.map=e}},{key:"_bindHandlers",value:function(){this._sunChangeHandler=this._sunChangeHandler.bind(this),this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._sun&&this._sun.addEventListener("change",this._sunChangeHandler),this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListener",value:function(){this._sun&&this._sun.removeEventListener("change",this._sunChangeHandler),this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createMesh",value:function(){var e=o.UniformsUtils.merge([o.ShaderLib.cube.uniforms,{uEnvMapRotation:{value:(new o.Matrix4).makeRotationFromEuler(this._rotation)},uStrength:{value:this._strength},uStarsNoiseScale:{value:715},uStarsNoiseSmoothEdge:{value:new o.Vector2(.968,1.152)},uStarsStrength:{value:0}}]),t=new o.BoxBufferGeometry(1,1,1),n=new Q({vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec3 vWorldDirection;\nvarying vec2 vUv;\n\n// Includes\n#include <common>\n\nvoid main() {\n    // World direction\n    vWorldDirection = transformDirection(position, modelMatrix);\n\n    // UV\n    vUv = uv;\n\n    // Includes\n    #include <begin_vertex>\n    #include <project_vertex>\n\n    // Output\n    gl_Position.z = gl_Position.w;\n}\n",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec3 vWorldDirection;\nvarying vec2 vUv;\n\n// Uniforms\nuniform float uStrength;\n// uniform float uStarsNoiseScale;\n// uniform vec2 uStarsNoiseSmoothEdge;\n// uniform float uStarsStrength;\n\n// Includes\n#include <custom_envmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <cube_uv_reflection_fragment>\n\n// <https://www.shadertoy.com/view/4dS3Wd>\n// By Morgan McGuire @morgan3d, http://graphicscodex.com\n\n// Precision-adjusted variations of https://www.shadertoy.com/view/4djSRW\nfloat hash(float p) { p = fract(p * 0.011); p *= p + 7.5; p *= p + p; return fract(p); }\nfloat hash(vec2 p) {vec3 p3 = fract(vec3(p.xyx) * 0.13); p3 += dot(p3, p3.yzx + 3.333); return fract((p3.x + p3.y) * p3.z); }\n\nfloat noise(vec2 x) {\n    vec2 i = floor(x);\n    vec2 f = fract(x);\n\n    // Four corners in 2D of a tile\n    float a = hash(i);\n    float b = hash(i + vec2(1.0, 0.0));\n    float c = hash(i + vec2(0.0, 1.0));\n    float d = hash(i + vec2(1.0, 1.0));\n\n    // Simple 2D lerp using smoothstep envelope between the values.\n    // return vec3(mix(mix(a, b, smoothstep(0.0, 1.0, f.x)),\n    //\t\t\tmix(c, d, smoothstep(0.0, 1.0, f.x)),\n    //\t\t\tsmoothstep(0.0, 1.0, f.y)));\n\n    // Same code, with the clamps in smoothstep and common subexpressions\n    // optimized away.\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nfloat aastep(float value) {\n  #ifdef GL_OES_standard_derivatives\n    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\n  #else\n    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));\n  #endif\n  return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);\n}\n\nvoid main() {\n    vec3 worldDirection = normalize(vWorldDirection);\n\n    // Envmap\n    vec3 vReflect = vWorldDirection;\n    #include <custom_envmap_fragment>\n\n    // Output\n    gl_FragColor = envColor * uStrength;\n\n    // Includes\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n}\n",uniforms:e,side:o.BackSide,depthWrite:!1});n.extensions={derivatives:!0},n.uniforms.envMap.value=this._envMap.cubeTexture;var r=new o.Mesh(t,n);return r.frustumCulled=!1,r.geometry.deleteAttribute("normal"),r.userData.renderBloom=!1,r.userData.renderReflection=!0,r.matrixAutoUpdate=!1,r.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(r.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),this.add(r),this._debug&&(this._debug.add(n.uniforms.uStrength,"value",{label:"strength"}),this._debug.add(n.uniforms.uStarsNoiseScale,"value",{label:"uStarsNoiseScale",stepSize:1}),this._debug.add(n.uniforms.uStarsNoiseSmoothEdge,"value",{label:"uStarsNoiseSmoothEdge",stepSize:.001}),this._debug.add(n.uniforms.uStarsStrength,"value",{label:"uStarsStrength"})),r}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_updateSunUniforms",value:function(){this._mesh.material.uniforms.uSunSize.value=this._sun.size,this._mesh.material.uniforms.uSunStrength.value=this._sun.strength,this._mesh.material.uniforms.uSunColor.value=this._sun.color,this._mesh.material.uniforms.uSunPosition.value=this._sun.position}},{key:"_createStars",value:function(){var e=[];function t(e,t,n,r){var u=Math.random(),o=Math.random(),l=2*Math.PI*u*.5,c=Math.acos(2*o-1);return[e+r*Math.sin(c)*Math.cos(l),t+r*Math.sin(c)*Math.sin(l),n+r*Math.cos(c)]}for(var n,i=0;i<2e3;i++)n=t(0,0,0,1e6),e.push(n[0]),e.push(n[1]),e.push(n[2]);var r=new o.BufferGeometry;r.setAttribute("position",new o.Float32BufferAttribute(e,3));var l=new o.PointsMaterial({color:16777215,map:new o.Texture,size:1.5,sizeAttenuation:!1,transparent:!0,opacity:0}),c=new o.Points(r,l);return c.matrixAutoUpdate=!1,this.add(c),c}},{key:"onResize",value:function(e){var t=e.dpr;this._stars.material.size=1.5/t}},{key:"_sunChangeHandler",value:function(){this._updateSunUniforms()}},{key:"_envMapChangeHandler",value:function(e){var t=e.cubeTexture;this._mesh.material.uniforms.envMap.value=t}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Skybox",{container:this._debugContainer});t.add(this,"visible");var n=t.addGroup("Rotation");return n.add(this._rotation,"x",{stepSize:.001,onChange:function(){e._mesh.material.uniforms.uEnvMapRotation.value.makeRotationFromEuler(e._rotation)}}),n.add(this._rotation,"y",{stepSize:.001,onChange:function(){e._mesh.material.uniforms.uEnvMapRotation.value.makeRotationFromEuler(e._rotation)}}),n.add(this._rotation,"z",{stepSize:.001,onChange:function(){e._mesh.material.uniforms.uEnvMapRotation.value.makeRotationFromEuler(e._rotation)}}),t}}}]),n}(Object(_.a)(o.Object3D));function rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}o.ShaderChunk.custom_envmap_fragment=Pe,o.ShaderChunk.custom_envmap_pars_fragment=Re;var an={name:"Ocean",class:function(e){Object(d.a)(n,e);var t=rn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.config;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._config=l,this._isActive=!1,this._isFirstShow=!0,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera(),this._fog=this._createFog(),this._envMap=this._createEnvMap(),this._components=this._createComponents(),this._lights=this._createLights(),this._bindHandlers(),this._setupEventListeners()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyComponents()}},{key:"camera",get:function(){return this._camera}},{key:"config",get:function(){return this._config}},{key:"activeStateIndex",get:function(){return this._activeStateIndex}},{key:"prepare",value:function(e,t){this._root.nuxtRoot.$store.getters["context/isProduction"]&&this._addAssetsToComponents(),this._renderer.shadowMap.needsUpdate=!0,this._postProcessing.loadSettings(this.name),t.loadRenderSettings(this._config.renderer),this._renderer.compile(this,this._camera.main),this._renderer.render(this,this._camera.main),this._postProcessing.render(this,this.camera.active),this._renderer.setClearColor(0),this._renderer.clear(),e()}},{key:"show",value:function(e){var t=this,n=e.instant;this._resourceManager.load().then((function(){var e;t._isActive=!0,t._activeStateIndex=0,t._isState0Active=!0,t._isState1Active=!1,t._isState2Active=!1,t._isFirstShow&&t._root.nuxtRoot.$store.getters["context/isDevelopment"]&&(t._addAssetsToComponents(),t._isFirstShow=!1),w.a.playLandscapeTrack(t._config.audio.background),t._camera.reset(),n||(t._camera.enable(),t._root.nuxtRoot.$store.getters["context/isProduction"]&&t._camera.startDolly()),null===(e=t._timelineHide)||void 0===e||e.kill(),t._timelineShow=new v.a.timeline({onComplete:function(){t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionNone")}}),t._timelineShow.call((function(){return t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionIn")}),null,0),t._timelineShow.call((function(){return t._postProcessing.passes.lineRender.changeColor(new o.Color(t._config.lines.color))}),null,0),t._timelineShow.fromTo(t._postProcessing.passes.transition,{progress:1},{duration:3,progress:0,ease:"sine.inOut"},0),t._timelineShow.add(t._showState0(),0),v.a.delayedCall(5,(function(){t._root.landscapeManager.loadResourcesNextScene()}))}))}},{key:"hide",value:function(e){var t,n,r=this,o=e.onCompleteCallback,l=(e.hideLines,e.instant);return null===(t=this._timelineShow)||void 0===t||t.kill(),null===(n=this._timelineHide)||void 0===n||n.kill(),this._timelineHide=new v.a.timeline({onComplete:function(){r._isActive=!1,r._camera.stopDolly(),l||(r._camera.disable(),r._camera.reset()),r._resetStates(),"function"==typeof o&&o()}}),this._timelineHide.call((function(){return r._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionOut")}),null,0),this._timelineHide.to(this._postProcessing.passes.transition,{duration:3,progress:1,ease:"sine.inOut"},0),this._timelineHide}},{key:"setState",value:function(e){switch(this._postProcessing.passes.final.spawnScan(this._camera.position,{alphaDuration:.7,alphaDelay:2}),this._postProcessing.passes.transition.changeLUT(e),this._postProcessing.passes.lineRender.lines.spin(),this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}if(this._activeStateIndex!==e)switch(this._activeStateIndex=e,this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}}},{key:"_bindHandlers",value:function(){this._cameraDollyCompleteHandler=this._cameraDollyCompleteHandler.bind(this),this._menuOpenHandler=this._menuOpenHandler.bind(this),this._menuClosedHandler=this._menuClosedHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._camera.addEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.addEventListener("menu:open",this._menuOpenHandler),this.addEventListener("menu:closed",this._menuClosedHandler)}},{key:"_removeEventListeners",value:function(){this._camera.removeEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.removeEventListener("menu:open",this._menuOpenHandler),this.removeEventListener("menu:closed",this._menuClosedHandler)}},{key:"_createResourceManager",value:function(){return new y.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new F({root:this._root,renderer:this._renderer,scene:this,debugContainer:"Ocean",near:10,far:1e7,dollySpeed:3.5,dollyHeight:150,dollyStartPosition:1e4,dollyEndPosition:-1e3,menuPositions:this._config.menuCameraPositions});return e.activateMain(),B.a.copySettings(e.main),e}},{key:"_createFog",value:function(){var e=new W({type:V,color:new o.Color(11295589),globalStrength:0,near:2418,far:2e4,density:.025,height:.008});if(e.visible=!1,x.a){var t=x.a.addGroup("Fog",{container:"Ocean"});t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:.001}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:1});var r=t.addGroup("Ground");r.add(e,"density",{stepSize:1e-4}),r.add(e,"height",{stepSize:.001});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:1e-4})}return e}},{key:"_createEnvMap",value:function(){return new X({renderer:this._renderer,name:this._config.renderer.envMap,debugContainer:"Ocean"})}},{key:"_createLights",value:function(){var e,t={};if(x.a&&(e=x.a.addGroup("Lights",{container:"Ocean"})),t.directional=new o.DirectionalLight(13620696,.387),t.directional.visible=!0,t.directional.position.x=4680,t.directional.position.y=3044,t.directional.position.z=-2436,t.directional.castShadow=!0,t.directional.shadow.mapSize.width=1024,t.directional.shadow.mapSize.height=1024,t.directional.shadow.camera.near=1,t.directional.shadow.camera.far=4622,t.directional.shadow.camera.left=-3e3,t.directional.shadow.camera.bottom=-3e3,t.directional.shadow.camera.right=3e3,t.directional.shadow.camera.top=3e3,t.directional.target.position.x=5056,t.directional.target.position.y=2090,t.directional.target.position.z=-94,t.directional.updateMatrix(),t.directional.matrixAutoUpdate=!1,this.add(t.directional.target),this.add(t.directional),e){var n=function(){t.directional.shadow.mapSize.width=parseInt(l.mapSize),t.directional.shadow.mapSize.height=parseInt(l.mapSize),t.directional.shadow.camera.updateProjectionMatrix(),t.directional.shadow.map&&t.directional.shadow.map.dispose(),t.directional.shadow.map=null,t.directional.shadow.needsUpdate=!0},r=e.addGroup("Directional");r.add(t.directional,"visible"),r.add(t.directional,"color"),r.add(t.directional,"intensity",{stepSize:.001}),r.add(t.directional,"castShadow"),r.add(t.directional,"position",{stepSize:1}),r.add(t.directional.target,"position",{label:"target",stepSize:1});var l={mapSize:1024},c=r.addGroup("Shadow");c.add(t.directional,"castShadow"),c.add(l,"mapSize",{options:[128,256,512,1024,2048,4096],onChange:n}),c.add(t.directional.shadow.camera,"near",{stepSize:1,onChange:n}),c.add(t.directional.shadow.camera,"far",{stepSize:1,onChange:n}),n()}if(t.hemisphere=new o.HemisphereLight(16777215,526368,.158),t.hemisphere.visible=!0,t.hemisphere.matrixAutoUpdate=!1,this.add(t.hemisphere),e){var h=e.addGroup("Hemisphere");h.add(t.hemisphere,"visible"),h.add(t.hemisphere,"color",{label:"skyColor"}),h.add(t.hemisphere,"groundColor"),h.add(t.hemisphere,"intensity",{min:0,stepSize:.001})}return t}},{key:"_restart",value:function(){var e=this,t=new v.a.timeline;t.to(this._postProcessing.passes.transition,{duration:4,progress:1,ease:"sine.inOut"},0),t.call((function(){e._camera.reset(),e._camera.startDolly()}),null,4),t.to(this._postProcessing.passes.transition,{duration:4,progress:0,ease:"sine.inOut"},4)}},{key:"_createComponents",value:function(){var e={};return e.moon=this._createMoonComponent(),e.skybox=this._createSkyboxComponent(e.moon),e.water=this._createWaterComponent(e.moon),e.oceanFloor=this._createOceanFloorComponent(),e.lighthouse=this._createLighthouseComponent(),this._root.nuxtRoot.$store.getters["context/isProduction"]&&(e.whales=this._createWhalesComponent()),e.sailboats=this._createSailboatsComponent(),e.birds=this._createBirdsComponent(),e.fog=this._createFogComponent(),e}},{key:"_addAssetsToComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].addAssets&&this._components[e].addAssets()}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_createSkyboxComponent",value:function(){var component=new nn({debugContainer:"Ocean",envMap:this._envMap,rotation:new o.Euler(0,.118,0),strength:1});return this.add(component),component}},{key:"_createShootingStarComponent",value:function(){var component=new Je({renderer:this._renderer});return this.add(component),component}},{key:"_createCloudsComponent",value:function(){var component=new lt;return this.add(component),component}},{key:"_createMoonComponent",value:function(){var component=new ht({size:21059,color:new o.Color(14277854),strength:0,glowSize:13,inclination:-.218,azimuth:3.344});return this.add(component),component}},{key:"_createWaterComponent",value:function(e){var component=new gt({root:this._root,fog:this._fog,moon:e,windSpeed:1,renderer:this._renderer,sceneRenderer:this._sceneRenderer,camera:this._camera,outputEncoding:this._config.renderer.outputEncoding});if(this.add(component),x.a){var t=x.a.addGroup("Water",{container:"Ocean"});t.add(component,"visible"),t.add(component.mesh.material.uniforms.alpha,"value",{label:"alpha",min:0,max:1}),t.add(component.mesh.material.uniforms.waterColor,"value",{label:"waterColor"}),t.add(component.mesh.material.uniforms.distortionScale,"value",{label:"distortionScale"}),t.add(component.mesh.material.uniforms.size,"value",{label:"size",stepSize:.001}),t.add(component.mesh.material.uniforms.sunShiny,"value",{label:"sunShiny",stepSize:1}),t.add(component.mesh.material.uniforms.sunSpec,"value",{label:"sunSpec",stepSize:.01}),t.add(component.mesh.material.uniforms.sunDiffuse,"value",{label:"sunDiffuse"}),t.add(component.mesh.material.uniforms.reflectanceRf0,"value",{label:"reflectanceRf0",stepSize:.001,min:0,max:1}),t.add(component.mesh.material.uniforms.surfaceNormalModifier,"value",{label:"surfaceNormalModifier"}),t.add(component.mesh,"clipBias"),t.add(component,"windSpeed");var n=t.addGroup("Depth");n.add(component.mesh.material.uniforms.waterDepthColor,"value",{label:"color"}),n.add(component.mesh.material.uniforms.waterDepthTransitionSize,"value",{label:"transition size",stepSize:1}),n.add(component.mesh.material.uniforms.waterDepthMax,"value",{label:"max",stepSize:1}),n.add(component.mesh.material.uniforms.waterDepthStrength,"value",{label:"strength",stepSize:.01});var r=t.addGroup("Mask");r.add(component.mesh.material.uniforms.waterMaskColor,"value",{label:"color"}),r.add(component.mesh.material.uniforms.waterMaskSize,"value",{label:"size",stepSize:.001}),r.add(component.mesh.material.uniforms.waterMaskStrength,"value",{label:"strength",stepSize:.01}),r.add(component.mesh.material.uniforms.waterMaskSampler,"value",{label:"texture"});var o=t.addGroup("Foam");o.add(component.mesh.material.uniforms.foamColor,"value",{label:"color"}),o.add(component.mesh.material.uniforms.foamStrength,"value",{label:"strength",stepSize:.001}),o.add(component.mesh.material.uniforms.foamFalloff,"value",{label:"falloff",stepSize:1})}return component}},{key:"_createOceanFloorComponent",value:function(){var component=new en({fog:this._fog});return this.add(component),component}},{key:"_createLighthouseComponent",value:function(){var component=new wt({fog:this._fog,envMap:this._envMap});return this.add(component),component}},{key:"_createWhalesComponent",value:function(){var component=new Tt({fog:this._fog});return this.add(component),component}},{key:"_createSailboatsComponent",value:function(){var component=new Xt({fog:this._fog});return this.add(component),component}},{key:"_createBirdsComponent",value:function(){for(var e,component,t=[],i=0,n=this._config.birds.length;i<n;i++)e=this._config.birds[i],component=new Ne({name:e.name,fog:this._fog,renderer:this._renderer,camera:this._camera,points:e.points,speed:e.speed,debugContainer:"Ocean"}),t.push(component),this.add(component);return t}},{key:"_createFogComponent",value:function(){var component=new Zt({fog:this._fog,root:this._root,renderer:this._renderer,camera:this._camera});return this.add(component),component}},{key:"_toggleState0",value:function(){var e;this._isState0Active=!this._isState0Active,null===(e=this._timelineState0)||void 0===e||e.kill(),this._timelineState0=new v.a.timeline,this._isState0Active?this._timelineState0.add(this._showState0()):this._timelineState0.add(this._hideState0())}},{key:"_showState0",value:function(){var e=new v.a.timeline;return e.to(this._components.lighthouse._coneLight.children[1].material.uniforms.uOpacity,{duration:2,value:1.11,ease:"sine.inOut"},0),e.to(this._components.lighthouse._lightBulb.material.uniforms.opacity,{duration:2,value:1,ease:"sine.inOut"},0),e.add(this._components.sailboats.showLights(),0),e}},{key:"_hideState0",value:function(){var e=new v.a.timeline;return e.to(this._components.lighthouse._coneLight.children[1].material.uniforms.uOpacity,{duration:2,value:0,ease:"sine.inOut"},1),e.to(this._components.lighthouse._lightBulb.material.uniforms.opacity,{duration:2,value:0,ease:"sine.inOut"},1),e.add(this._components.sailboats.hideLights(),.5),e}},{key:"_toggleState1",value:function(){var e;this._isState1Active=!this._isState1Active,null===(e=this._timelineState1)||void 0===e||e.kill(),this._timelineState1=new v.a.timeline,this._isState1Active?(this._timelineState1.to(this._components.water.mesh.material.uniforms.waterDepthStrength,{duration:2,value:.74,ease:"sine.inOut"},0),this._timelineState1.to(this._lights.hemisphere.color,{duration:2,r:0,g:0,b:0,ease:"sine.inOut"},0),this._timelineState1.to(this._lights.hemisphere.groundColor,{duration:2,r:31/255,g:229/255,b:1,ease:"sine.inOut"},0),this._timelineState1.to(this._lights.hemisphere,{duration:2,intensity:.814,ease:"sine.inOut"},0)):(this._timelineState1.to(this._components.water.mesh.material.uniforms.waterDepthStrength,{duration:2,value:.08,ease:"sine.inOut"},0),this._timelineState1.to(this._lights.hemisphere.color,{duration:2,r:1,g:1,b:1,ease:"sine.inOut"},0),this._timelineState1.to(this._lights.hemisphere.groundColor,{duration:2,r:8/255,g:8/255,b:32/255,ease:"sine.inOut"},0),this._timelineState1.to(this._lights.hemisphere,{duration:2,intensity:.158,ease:"sine.inOut"},0))}},{key:"_toggleState2",value:function(){var e;this._isState2Active=!this._isState2Active,null===(e=this._timelineState2)||void 0===e||e.kill(),this._timelineState2=new v.a.timeline,this._isState2Active?this._timelineState2.to(this._components.skybox._stars.material,{duration:2,opacity:2,ease:"sine.inOut"},1):this._timelineState2.to(this._components.skybox._stars.material,{duration:2,opacity:0,ease:"sine.inOut"},1)}},{key:"_resetStates",value:function(){this._components.lighthouse._coneLight.children[1].material.uniforms.uOpacity.value=0,this._components.lighthouse._lightBulb.material.uniforms.opacity.value=0,this._components.water.mesh.material.uniforms.waterDepthStrength.value=.08,this._lights.hemisphere.color.set(16777215),this._lights.hemisphere.groundColor.set(526368),this._lights.hemisphere.intensity=.158,this._components.skybox._stars.material.opacity=0}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&(this._updateCamera({time:time,delta:t}),this._updateComponents({time:time,delta:t}),this._updateBirds({time:time,delta:t}))}},{key:"_updateCamera",value:function(e){var time=e.time,t=e.delta;this._camera.update({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"_updateBirds",value:function(e){var time=e.time,t=e.delta;if(this._components&&this._components.birds)for(var i=0,n=this._components.birds.length;i<n;i++)this._components.birds[i].update({time:time,delta:t})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n}},{key:"_cameraDollyCompleteHandler",value:function(){this._root.nuxtRoot.$store.getters["home/isScrollTriggered"]?this._restart():this.dispatchEvent({type:"complete"})}},{key:"_menuOpenHandler",value:function(){this._isState0Active&&(this._components.lighthouse._coneLight.children[1].material.uniforms.uOpacity.value=0,this._components.lighthouse._lightBulb.material.uniforms.opacity.value=0),this._isState1Active&&(this._components.water.mesh.material.uniforms.waterDepthStrength.value=.08,this._lights.hemisphere.color.set(16777215),this._lights.hemisphere.groundColor.set(526368),this._lights.hemisphere.intensity=.158),this._isState2Active&&(this._components.skybox._stars.material.opacity=0)}},{key:"_menuClosedHandler",value:function(){this._isState0Active&&(this._components.lighthouse._coneLight.children[1].material.uniforms.uOpacity.value=1.11,this._components.lighthouse._lightBulb.material.uniforms.opacity.value=1),this._isState1Active&&(this._components.water.mesh.material.uniforms.waterDepthStrength.value=.74,this._lights.hemisphere.color.set(0),this._lights.hemisphere.groundColor.set(2090495),this._lights.hemisphere.intensity=.814),this._isState2Active&&(this._components.skybox._stars.material.opacity=2)}}]),n}(Object(_.a)(o.Scene)),renderer:{clearColor:"#000000",envMap:"ocean",toneMapping:o.CineonToneMapping,toneMappingExposure:1,outputEncoding:o.sRGBEncoding},postProcessing:{fogBloom:{enabled:!1,strength:1.07,radius:1},ssms:{depthOffset:-.827,bottom:new o.Vector2(472,-564)},bloom:{enabled:!0,strength:1.18,radius:.63},final:{enabled:!0,default:!0,lut:"lut/ocean"}},lines:{color:4433407},audio:{background:"audio-landscape-ocean",transition:"audio-transition-ocean"},resources:{preload:{development:!1,production:!0},items:[{type:"ktx",name:"ocean/island/albedo-map",path:"/webgl/scenes/ocean/island/albedo-map.ktx2"},{type:"ktx",name:"ocean/island/normal-map",path:"/webgl/scenes/ocean/island/normal-map.ktx2"},{type:"ktx",name:"ocean/lighthouse/albedo-map",path:"/webgl/scenes/ocean/lighthouse/albedo-map.ktx2"},{type:"ktx",name:"ocean/whale/color-map",path:"/webgl/scenes/ocean/whale/color-map.ktx2"},{type:"ktx",name:"ocean/clouds-map",path:"/webgl/scenes/ocean/clouds-map.ktx2"},{type:"ktx",name:"fog/texture",path:"/webgl/scenes/shared/fog/texture.ktx2"},{type:"ktx",name:"fog/displacement",path:"/webgl/scenes/shared/fog/displacement.ktx2"},{type:"ktx",name:"ocean/sailboat/wake-map",path:"/webgl/scenes/ocean/wake-map.ktx2"}]},menuCameraPositions:[{position:new o.Vector3(3926.703706571788,362.7781387770983,1233.8982946643425),rotation:new o.Euler(.2179300415535363,.013366881300735824,-6245004513516506e-32),target:new o.Vector3(3911.819330484855,603.5183433488311,146.77472807329528),transitionProgress:.44,lutIndex:0},{position:new o.Vector3(1289.7944376980176,265.1161953121757,-5755.595422257223),rotation:new o.Euler(-1.6625953289700213,-.5737393946023337,-1.7388027983267762),target:new o.Vector3(2155.298778423686,-1068.502088917002,-5632.82553765124),transitionProgress:0,lutIndex:1},{position:new o.Vector3(-1985.8480316678927,445.6497025013145,-1951.3441219761883),rotation:new o.Euler(.10957260967465379,-.04799982008433652,-.4800000000000003),target:new o.Vector3(-1932.4178925213807,567.281073834161,-3056.9507742376745),transitionProgress:.4,lutIndex:0}],birds:[{name:"Birds lighthouse",speed:.01,points:[new o.Vector3(3041.9244954613496,452.3095466404309,-3363.9619446749834),new o.Vector3(2065.7392303118017,773.7619906998194,-2220.1314018082935),new o.Vector3(560.883679387865,310.1611379116598,-1419.3497447079917),new o.Vector3(129.532779772768,274.95722502047056,-709.9831074006673),new o.Vector3(-290.0536342858562,446.6972946544472,-12.520978454076314),new o.Vector3(283.60074241248157,551.1134561721492,1183.3385877473215),new o.Vector3(2016.3327972188442,267.9567178508531,-83.81375152219266),new o.Vector3(-411.66648990818976,478.88746372961816,-1869.4128842332802),new o.Vector3(-1335.7039221135115,121.51176839109354,-315.36867884946207),new o.Vector3(-1425.704739318671,313.7996028947664,9634.837026754929)]}]};an.resources.items=[].concat(Object(r.a)(an.resources.items),Object(r.a)($[an.renderer.envMap].items));var on=an;function sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ln=function(e){Object(d.a)(n,e);var t=sn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=e.size,r=e.strength,o=e.inclination,l=e.azimuth,c=e.glowSize,h=e.texture,d=e.debugContainer,f=e.camera;this._color=t,this._size=n,this._strength=r,this._inclination=o||-.3,this._azimuth=l||3.3,this._glowSize=c||1,this._texture=h,this._debugContainer=d,this._camera=f,this._mesh=this._createMesh(),this._debugger=this._createDebugger(),this._updatePosition()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh()}},{key:"color",get:function(){return this._color}},{key:"size",get:function(){return this._size}},{key:"strength",get:function(){return this._strength}},{key:"glowSize",get:function(){return this._glowSize}},{key:"mesh",get:function(){return this._mesh}},{key:"addAssets",value:function(){}},{key:"_createMesh",value:function(){var map=new o.Texture;map.encoding=o.sRGBEncoding,map.flipY=!0;var e=new o.ShaderMaterial({vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform vec3 uColor;\nuniform float uOpacity;\n\nvoid main() {\n    float alpha = 1.0 - length(vUv - 0.5);\n    alpha = smoothstep(0.5, 0.55, alpha);\n    alpha *= uOpacity;\n    gl_FragColor = vec4(uColor, alpha);\n}\n",uniforms:{uColor:{value:this._color},uOpacity:{value:1}},transparent:!0,depthWrite:!1}),t=new o.PlaneGeometry(10,10),n=new o.Mesh(t,e);return n.visible=!0,n.scale.set(this._size,this._size,1),n.frustumCulled=!1,n.matrixAutoUpdate=!1,n.userData.renderBloom=!1,this.add(n),n}},{key:"_destroyMesh",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_updatePosition",value:function(){var e=new o.Vector3(0,0,1900),t=new o.Quaternion;t.setFromAxisAngle(new o.Vector3(1,0,0),this._inclination),e.applyQuaternion(t);var n=new o.Quaternion;n.setFromAxisAngle(new o.Vector3(0,1,0),this._azimuth),e.applyQuaternion(n),this._mesh.position.copy(e),this._mesh.lookAt(0,0,0),this._mesh.updateMatrix(),this._triggerChangeEvent()}},{key:"_triggerChangeEvent",value:function(){this.dispatchEvent({type:"change"})}},{key:"update",value:function(){this.position.z=this._camera.position.z}},{key:"_createDebugger",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Moon",{container:this._debugContainer});return t.add(this,"visible"),t.add(this,"_color",{label:"color",onChange:function(){e._mesh.material.color=e._color,e._triggerChangeEvent()}}),t.add(this,"_size",{label:"size",stepSize:1,onChange:function(){e._mesh.scale.set(e._size,e._size,1)}}),t.add(this,"_strength",{label:"strength",onChange:function(){e._triggerChangeEvent()}}),t.add(this,"_glowSize",{label:"glowSize",stepSize:1,onChange:function(){e._triggerChangeEvent()}}),t.add(this,"_inclination",{label:"inclination",stepSize:.001,onChange:function(){e._updatePosition()}}),t.add(this,"_azimuth",{label:"azimuth",stepSize:.001,onChange:function(){e._updatePosition()}}),t}}}]),n}(Object(_.a)(o.Object3D));function un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var cn=function(e){Object(d.a)(n,e);var t=un(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).map=e.map,r.uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common]),e.color&&(r.uniforms.diffuse.value=new o.Color(e.color||16777215)),e.map&&(r.uniforms.map.value=e.map,r.map=e.map),r.vertexShader="#define GLSLIFY 1\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <skinbase_vertex>\n\n    #ifdef USE_ENVMAP\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n\n    #include <worldpos_vertex>\n    #include <clipping_planes_vertex>\n    #include <envmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n}\n",r.fragmentShader="#define GLSLIFY 1\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <specularmap_fragment>\n\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n    // accumulation (baked indirect lighting only)\n    #ifdef USE_LIGHTMAP\n\n        vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n        reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n    #else\n\n        reflectedLight.indirectDiffuse += vec3( 1.0 );\n\n    #endif\n\n    // modulation\n    #include <aomap_fragment>\n\n    reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n    vec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n    #include <envmap_fragment>\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}}]),n}(Q);var hn="#define GLSLIFY 1\n#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvarying float vShadowDistance;\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <envmap_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    vShadowDistance = smoothstep(5.0, 45.0, abs(worldPosition.x));\n}\n\n",dn="#define GLSLIFY 1\n#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying float vShadowDistance;\n\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <specularmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <emissivemap_fragment>\n    #include <lights_phong_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    #include <envmap_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    // Custom side shadow\n    vec3 shadowColor = vec3(0.0, 0.0, 0.0);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, shadowColor, vShadowDistance);\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var mn=function(e){Object(d.a)(n,e);var t=fn(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{emissive:{value:new o.Color(0)},shininess:{value:60},specular:{value:new o.Color(1052702)}}]),e.name=r.name||null,r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap])),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),r.aoMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.aomap]),e.aoMap=r.aoMap),r.envMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.envmap]),e.envMap=r.envMap,e.uniforms.envMapIntensity={value:void 0===r.envMapIntensity?1:r.envMapIntensity}),e.map&&(e.uniforms.map.value=r.map),r.normalMap&&(e.normalMap=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),r.roughnessMap&&(e.roughnessMap=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.aoMap&&(e.uniforms.aoMap.value=r.aoMap),e.envMap&&(e.uniforms.envMap.value=r.envMap),e.lights=!0,e.vertexShader=hn,e.fragmentShader=dn,e.type="ForestTerrainMaterial",e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"map",get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"roughnessMap",get:function(){return this.uniforms.roughnessMap?this.uniforms.roughnessMap.value:null},set:function(e){this.roughnessMap||(this.uniforms=o.UniformsUtils.merge([this.uniforms,o.UniformsLib.roughnessmap])),this.uniforms.roughnessMap.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalMap",get:function(){return this.uniforms.normalMap?this.uniforms.normalMap.value:null},set:function(e){this.normalMap||(this.uniforms=o.UniformsUtils.merge([this.uniforms,o.UniformsLib.normalmap]),this.defines.TANGENTSPACE_NORMALMAP=""),this.uniforms.normalMap.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"repeat",value:function(e,t){var n=new o.Texture;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix),this.uniforms.uv2Transform.value.copy(n.matrix))}}]),n}(Q);function pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var gn=function(e){Object(d.a)(n,e);var t=pn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){this._fog=e.fog,this._envMap=e.envMap,this._debug=this._createDebug(),this._gltf=y.b.get("forest/model"),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._bottom=this._createBottom(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyMaterial(),this._destroyMesh(),this._destroyBottom()}},{key:"addAssets",value:function(){var e=y.b.get("forest/terrain/normal-map");e.wrapS=e.wrapT=o.RepeatWrapping,this._material.uniforms.normalMap.value=e}},{key:"_bindHandlers",value:function(){this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListeners",value:function(){this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createMaterial",value:function(){var e=new mn({fog:this._fog,color:8026746,normalMap:new o.Texture,wireframe:!1});if(e.repeat(20,20),e.normalScale=new o.Vector2(1,-1),this._debug){var t=this._debug.addGroup("Material");t.add(e,"color"),t.add(e.uniforms.shininess,"value",{label:"shininess",min:0,stepSize:1}),t.add(e.uniforms.specular,"value",{label:"specular"})}return e}},{key:"_destroyMaterial",value:function(){this._material.normalMap.dispose(),this._material.dispose(),this._material=null}},{key:"_createMesh",value:function(){for(var e,t=[],n=this._gltf.scene.getObjectByName("terrain"),r=Math.abs(n.geometry.boundingBox.min.z)+Math.abs(n.geometry.boundingBox.max.z),i=0;i<3;i++)(e=new o.Mesh(n.geometry,this._material)).position.copy(n.position),e.position.z-=(r+-10)*i,e.receiveShadow=!0,e.userData.renderBloom=!1,e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),t.push(e);return t}},{key:"_destroyMesh",value:function(){for(var i=0,e=this._mesh.length;i<e;i++)this._mesh[i].geometry.dispose();this._mesh=null}},{key:"_createBottom",value:function(){var e=this._gltf.scene.getObjectByName("bottom").clone(),t=new cn({fog:this._fog,color:new o.Color(657930)});(e.material=t,e.frustrumCulled=!1,e.scale.set(1,1,3),e.position.z=3*-e.geometry.boundingBox.max.z,e.userData.renderBloom=!1,e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),this._debug)&&this._debug.addGroup("Ravine").add(t,"color");return e}},{key:"_destroyBottom",value:function(){this._bottom.material.dispose(),this._bottom.geometry.dispose(),this._bottom=null}},{key:"_envMapChangeHandler",value:function(e){var map=e.map;this._material.envMap=map}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("Terrain",{container:"Forest"});return e.add(this,"visible"),e}}}]),n}(Object(_.a)(o.Object3D)),vn="#define GLSLIFY 1\n#include <common>\n#include <uv_pars_vertex>\n#include <custom_fog_pars_vertex>\n\n// Attributes\nattribute vec3 offsets;\n\n// Varyings\nvarying vec4 vWPosition;\nvarying vec3 vLight1Position;\nvarying vec3 vLight2Position;\nvarying vec3 vNormal;\n\n// Uniforms\nuniform float uWindStrength;\nuniform float uTime;\nuniform float uFirefliesLightSpeed;\nuniform float uFirefliesLightRadius;\nuniform float uFirefliesLightProgress;\n\nvoid main() {\n    #include <uv_vertex>\n    #include <begin_vertex>\n    #include <beginnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n        vNormal = normalize( transformedNormal );\n\n        #ifdef USE_TANGENT\n\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n        #endif\n\n    #endif\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    // Wind\n    float scale = 10.;\n    mvPosition.y += sin((mvPosition.x * scale + mvPosition.z * scale + offsets.x + uTime) * 4.) * 0.1;\n    mvPosition.z += sin((mvPosition.x * scale + mvPosition.y * scale + offsets.x + uTime) * 1.) * 0.1;\n    mvPosition.x += pow(mvPosition.y, 3.) * sin(offsets.x + uTime * offsets.y) * uWindStrength * 0.0001 * offsets.z;\n\n    #ifdef USE_INSTANCING\n        mvPosition = instanceMatrix * mvPosition;\n    #endif\n\n    mvPosition = modelViewMatrix * mvPosition;\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <custom_fog_vertex>\n\n    // World position\n    vWPosition = modelMatrix * instanceMatrix * vec4(transformed, 1.0);\n\n    // Fireflies\n    float maxHeight = 40.0 * uFirefliesLightProgress;\n    vec4 instancePosition = vec4(vec3(instanceMatrix[3][0], instanceMatrix[3][1], instanceMatrix[3][2]), 1.0);\n\n    float light1Time = uTime + offsets.x;\n    vec4 light1Position = instancePosition;\n    light1Position.x += uFirefliesLightRadius * cos(light1Time);\n    light1Position.z += uFirefliesLightRadius * sin(light1Time);\n    light1Position.y += mod(light1Time * 0.2 * uFirefliesLightSpeed, 1.0) * maxHeight;\n\n    float light2Time = uTime + offsets.y * 132.0;\n    vec4 light2Position = instancePosition;\n    light2Position.x += uFirefliesLightRadius * cos(light2Time);\n    light2Position.z += uFirefliesLightRadius * sin(light2Time);\n    light2Position.y += (1.0 - mod(light2Time * 0.1 * uFirefliesLightSpeed, 1.0)) * maxHeight;\n\n    vLight1Position = (modelMatrix * light1Position).xyz;\n    vLight2Position = (modelMatrix * light2Position).xyz;\n}\n",_n="#define GLSLIFY 1\nuniform vec3 diffuse;\n\nvarying vec3 vNormal;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <custom_fog_pars_fragment>\n\nvarying vec4 vWPosition;\nvarying vec3 vLight1Position;\nvarying vec3 vLight2Position;\n\nuniform vec3 uFirefliesLightColor;\nuniform float uFirefliesLightIntensity;\nuniform float uFirefliesLightDistance;\nuniform float uFirefliesLightDecay;\nuniform float uFirefliesLightAlpha;\n\nvoid main() {\n    #include <normal_fragment_begin>\n\n    vec4 sampleColor = sRGBToLinear(texture2D(map, vUv));\n\n    #ifdef ALPHATEST\n        if (sampleColor.a < ALPHATEST) discard;\n    #endif\n\n    vec3 shadowColor = vec3(0.0);\n    vec3 color = mix(shadowColor, sampleColor.rgb, vUv.x * 0.2);\n    color *= diffuse;\n    gl_FragColor = vec4(color, sampleColor.a);\n\n    // Fireflies lights\n    float light1Distance = distance(vLight1Position, vWPosition.xyz);\n    vec3 surfaceToLight1Direction = normalize(vLight1Position - vWPosition.xyz);\n    float light1Strength = pow(saturate(-light1Distance / uFirefliesLightDistance + 1.0), uFirefliesLightDecay) * uFirefliesLightIntensity;\n    float light1 = saturate(dot(normal, surfaceToLight1Direction)) * light1Strength;\n\n    float light2Distance = distance(vLight2Position, vWPosition.xyz);\n    vec3 surfaceToLight2Direction = normalize(vLight2Position - vWPosition.xyz);\n    float light2Strength = pow(saturate(-light2Distance / uFirefliesLightDistance + 1.0), uFirefliesLightDecay) * uFirefliesLightIntensity;\n    float light2 = saturate(dot(normal, surfaceToLight2Direction)) * light2Strength;\n\n    float light = light1 + light2;\n    gl_FragColor.rgb += uFirefliesLightColor * light * uFirefliesLightAlpha;\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <custom_fog_fragment>\n}\n";function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var bn=function(e){Object(d.a)(n,e);var t=yn(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{uTime:{value:0},uWindStrength:{value:.3},uFirefliesLightColor:{value:new o.Color(4670244)},uFirefliesLightIntensity:{value:.08},uFirefliesLightDistance:{value:4.61},uFirefliesLightDecay:{value:2},uFirefliesLightSpeed:{value:1},uFirefliesLightRadius:{value:5},uFirefliesLightProgress:{value:0},uFirefliesLightAlpha:{value:0}}]),r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.uniforms.map.value=r.map,e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.normalMap=r.normalMap,e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap]),e.roughnessMap=r.roughnessMap),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.envmap]),e.uniforms.envMap.value=r.envMap,e.uniforms.envMapIntensity={value:void 0===r.envMapIntensity?1:r.envMapIntensity},e.envMap=r.envMap,e.normalMap&&(e.uniforms.normalMap.value=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),e.roughnessMap&&(e.uniforms.roughnessMap.value=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.lights=!0,e.vertexShader=vn,e.fragmentShader=_n,e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"envMap",get:function(){return this.uniforms.envMap.value},set:function(e){this.uniforms.envMap.value=e}},{key:"envMapIntensity",get:function(){return this.uniforms.envMapIntensity.value},set:function(e){this.uniforms.envMapIntensity.value=e}},{key:"repeat",value:function(e,t){var n=this.map;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix))}}]),n}(Q);function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var wn=1080,Sn=function(e){Object(d.a)(n,e);var t=xn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){this._fog=e.fog,this._envMap=e.envMap,this._windSpeed=1.13,this._debug=this._createDebug(),this._gltf=y.b.get("forest/model"),this._materialLod1=this._createMaterialLod1(),this._materialLod2=this._createMaterialLod2(),this._chuncksInside=this._createChuncksInside(),this._chuncksOutside=this._createChuncksOutside(),this._backdrops=this._createBackdrops(),this._bindHandlers(),this._setupEventListeners(),this.name="Trees",this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyMaterialLod1(),this._destroyMaterialLod2(),this._destroyChuncksInside(),this._destroyChuncksOutside()}},{key:"showFireflies",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.fromTo(this._materialLod1.uniforms.uFirefliesLightProgress,{value:0},{duration:3,value:1,ease:"sine.inOut"},0),t.to(this._materialLod1.uniforms.uFirefliesLightAlpha,{duration:.75,value:1,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"hideFireflies",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._materialLod1.uniforms.uFirefliesLightAlpha,{duration:.5,value:0,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"resetFireflies",value:function(){this._materialLod1.uniforms.uFirefliesLightAlpha.value=0}},{key:"addAssets",value:function(){var e=y.b.get("forest/tree/leaf-albedo-map");this._materialLod1.uniforms.map.value=e;var t=y.b.get("forest/tree/tree-map");this._materialLod2.uniforms.map.value=t;var n=y.b.get("forest/backdrop-map");n.flipY=!1,n.encoding=o.sRGBEncoding,n.wrapS=o.RepeatWrapping,n.wrapT=o.RepeatWrapping,n.repeat=new o.Vector2(15,1),this._backdrops&&(this._backdrops.map=n)}},{key:"_bindHandlers",value:function(){this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){}},{key:"_removeEventListeners",value:function(){}},{key:"_createMaterialLod1",value:function(){var map=new o.Texture;map.encoding=o.sRGBEncoding;var e=new bn({color:1842204,map:map});return e.side=o.DoubleSide,e.alphaTest=.7,e}},{key:"_destroyMaterialLod1",value:function(){this._materialLod1.map.dispose(),this._materialLod1.dispose(),this._materialLod1=null}},{key:"_createMaterialLod2",value:function(){var map=new o.Texture;map.encoding=o.sRGBEncoding;var e=new cn({fog:this._fog,color:0,map:map,side:o.DoubleSide});return e.alphaTest=.5,e}},{key:"_destroyMaterialLod2",value:function(){this._materialLod2.map.dispose(),this._materialLod2.dispose(),this._materialLod2=null}},{key:"_createChuncksInside",value:function(){for(var e,t,n,r,l=this._gltf.scene.getObjectByName("trees-inside").children,c=[],i=0;i<3;i++)for(var h=0,d=l.length;h<d;h++)e=l[h],(t=new o.LOD).position.copy(e.position),t.position.z-=i*wn,t.updateMatrix(),t.matrixAutoUpdate=!1,n=this._createMeshLod1(e),t.addLevel(n,0),c.push(n),r=this._createMeshLod2(e),t.addLevel(r,1e3),c.push(r),this.add(t);return c}},{key:"_createChuncksOutside",value:function(){for(var e,t,n,r,l=this._gltf.scene.getObjectByName("trees-outside").children,c=[],i=0;i<3;i++)for(var h=0,d=l.length;h<d;h++)e=l[h],(t=new o.LOD).position.copy(e.position),t.position.z-=i*wn,t.updateMatrix(),t.matrixAutoUpdate=!1,n=this._createMeshLod2(e),t.addLevel(n,0),c.push(n),(r=new o.Object3D).matrixAutoUpdate=!1,t.addLevel(r,1e3),this.add(t);return c}},{key:"_createMeshLod1",value:function(e){for(var t=e.children,n=this._gltf.scene.getObjectByName("tree-lod-1").geometry.clone(),r=new Float32Array(3*t.length),i=0;i<3*t.length;i+=3)r[i]=1e4*Math.random(),r[i+1]=.5+.5*Math.random(),r[i+2]=.5+.5*Math.random();n.setAttribute("offsets",new o.InstancedBufferAttribute(r,3));var l=new o.InstancedMesh(n,this._materialLod1,t.length);l.frustumCulled=!0,l.matrixAutoUpdate=!1;for(var c,h=new o.Box3,d=new o.Box3,f=new o.Sphere,m=0,v=t.length;m<v;m++)(c=t[m]).updateMatrix(),l.setMatrixAt(m,c.matrix),d.copy(l.geometry.boundingBox).applyMatrix4(c.matrix),h.union(d);return h.getBoundingSphere(f),l.geometry.boundingBox=h,l.geometry.boundingSphere=f,l.geometry.needsUpdate=!0,l}},{key:"_createMeshLod2",value:function(e){var t=e.children,n=this._gltf.scene.getObjectByName("tree-lod-2").geometry.clone(),r=new o.InstancedMesh(n,this._materialLod2,t.length);r.frustumCulled=!0,r.matrixAutoUpdate=!1;for(var l,c=new o.Box3,h=new o.Box3,d=new o.Sphere,i=0,f=t.length;i<f;i++)(l=t[i]).updateMatrix(),r.setMatrixAt(i,l.matrix),h.copy(r.geometry.boundingBox).applyMatrix4(l.matrix),c.union(h);return c.getBoundingSphere(d),r.geometry.boundingBox=c,r.geometry.boundingSphere=d,r.geometry.needsUpdate=!0,r}},{key:"_destroyChuncksInside",value:function(){for(var i=0,e=this._chuncksInside.length;i<e;i++)this._chuncksInside[i].geometry.dispose();this._chuncksInside=null}},{key:"_destroyChuncksOutside",value:function(){for(var i=0,e=this._chuncksOutside.length;i<e;i++)this._chuncksOutside[i].geometry.dispose();this._chuncksOutside=null}},{key:"_createBackdrops",value:function(){var e=this._gltf.scene.getObjectByName("backdrops").clone(!0).children,t=e[0],map=new o.Texture;map.encoding=o.sRGBEncoding;for(var n=new o.MeshBasicMaterial({map:map,transparent:!0,alphaTest:.5,side:o.DoubleSide}),i=0;i<3;i++){for(var r=new o.InstancedMesh(t.geometry,n,e.length),l=void 0,c=0,h=e.length;c<h;c++)(l=e[c]).updateMatrix(),r.setMatrixAt(c,l.matrix);r.position.z=-1080*i,r.updateMatrix(),r.matrixAutoUpdate=!1,r.userData.renderBloom=!1,this.add(r)}return n}},{key:"update",value:function(e){var t=e.delta;this._materialLod1.uniforms.uTime.value+=t*this._windSpeed}},{key:"_envMapChangeHandler",value:function(e){for(var map=e.map,i=0,t=this._chuncks.length;i<t;i++)this._chuncks[i].material.envMap=map}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("Trees",{container:"Forest"});return e.add(this,"visible"),e}}}]),n}(Object(_.a)(o.Object3D));function Cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var On=function(e){Object(d.a)(n,e);var t=Cn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){this._fog=e.fog,this._data=e.data,this._camera=e.camera,this._postProcessing=e.postProcessing,this._gltf=y.b.get("forest/model"),this._color=new o.Color(268432481),this._lightIntensity=.04,this._lightDistance=30,this._isPulseTriggered=!1,this._debug=this._createDebug(),this._material=this._createMaterial(),this._shapes=this._createShapes(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMaterial(),this._destroyShapes()}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.set(this._shapes,{visible:!0},0),t.to(this._material.uniforms.opacity,{duration:2.5,value:1},0),e&&t.timeScale(10),t}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new v.a.timeline;return n.to(this._material.uniforms.opacity,{duration:.5,value:0,onComplete:function(){e._shapes.visible=!1}},0),t&&n.timeScale(10),n}},{key:"reset",value:function(){this._shapes.visible=!1,this._material.uniforms.opacity.value=0}},{key:"_createMaterial",value:function(){var e=new cn({color:this._color,fog:this._fog,transparent:!0});return e.uniforms.opacity.value=0,e}},{key:"_destroyMaterial",value:function(){this._material.dispose(),this._material=null}},{key:"_createShapes",value:function(){var e,t=this._gltf.scene.getObjectByName("shape-rectangle"),n=new o.TorusBufferGeometry(20,.3,4,4),r=this._data.length,l=new o.Group;l.visible=!1,l.matrixAutoUpdate=!1,this.add(l);for(var i=0;i<r;i++)(e="rectangle"===this._data[i].type?new o.Mesh(t.geometry,this._material):new o.Mesh(n,this._material)).position.copy(this._data[i].position),e.userData.renderBloom=!0,e.updateMatrix(),e.matrixAutoUpdate=!1,l.add(e),this._debug&&this._debug.addGroup("Shape ".concat(i)).add(e,"position");return l}},{key:"_destroyShapes",value:function(){for(var i=0,e=this._shapes.children.length;i<e;i++)this._shapes.children[i].geometry.dispose();this._shapes=null}},{key:"_createLights",value:function(){for(var e,t=[],i=0,n=this._data.length;i<n;i++)(e=new o.PointLight(this._color,0,this._lightDistance)).position.copy(this._data[i].position),e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),t.push(e);return t}},{key:"_triggerPulse",value:function(e){var t=this;this._isPulseTriggered||(this._isPulseTriggered=!0,this._timelineTriggerPulse=new v.a.timeline,this._timelineTriggerPulse.to(this._postProcessing.passes.bloom,{duration:.5,strength:2.1,ease:"power2.out"},0),this._timelineTriggerPulse.to(this._postProcessing.passes.bloom,{duration:1,strength:1.18,ease:"power1.out"},.5),this._timelineTriggerPulse.call((function(){t._isPulseTriggered=!1}),null,3))}},{key:"update",value:function(){if(this._shapes.visible)for(var i=0,e=this._shapes.children.length;i<e;i++)this._camera.rollContainer.position.distanceTo(this._shapes.children[i].position)<55&&this._triggerPulse(i)}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Shapes",{container:"Forest"});return t.add(this,"visible"),t.add(this,"_color",{label:"color",onChange:function(){for(var i=0,t=e._shapes.children.length;i<t;i++)e._shapes.children[i].material.color=e._color}}),t.addButton("Export",{onClick:function(){for(var data=[],i=0,t=e._shapes.children.length;i<t;i++){var n=e._shapes.children[i].position;data.push("{"),data.push("position: new Vector3(".concat(n.x,", ").concat(n.y,", ").concat(n.z,")")),data.push("},")}var code=data.join("\n\t");prompt("copy and paste code",code)}}),t.addButton("Trigger pulse",{onClick:function(){e._triggerPulse(0)}}),t}}}]),n}(Object(_.a)(o.Object3D));function Ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var kn=function(e){Object(d.a)(n,e);var t=Ln(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){this._root=e.root,this._renderer=e.renderer,this._envMap=e.envMap,this._sceneCamera=e.sceneCamera,this._isStarted=!1,this._debug=this._createDebug(),this._container=this._createContainer(),this._camera=this._createCamera(),this._gltf=function(e){var t={animations:e.animations,scene:e.scene.clone(!0)},n={};e.scene.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var r={},l={};for(var c in t.scene.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(l[e.name]=e)})),n){for(var h=n[c].skeleton,d=l[c],f=[],i=0;i<h.bones.length;++i){var m=r[h.bones[i].name];f.push(m)}d.bind(new o.Skeleton(f,h.boneInverses),d.matrixWorld)}t.cameras=[];for(var v=0;v<e.cameras.length;v++){var _=e.cameras[v];t.cameras.push(_.clone())}return t}(y.b.get("forest/model")),this._mesh=this._createMesh(),this._mixer=this._createMixer(),this._spotLight=this._createSpotLight(),this._hemisphereLight=this._createHemisphereLight(),this._bindHandlers(),this._setupEventListeners(),this.name="Statue",this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyMesh()}},{key:"camera",get:function(){return this._camera}},{key:"compile",value:function(){this._renderer.compile(this,this._camera.main)}},{key:"start",value:function(){this._isStarted=!0,this._action.play()}},{key:"show",value:function(){var e=new v.a.timeline;return e.to(this._spotLight,{duration:1.5,intensity:5.52,ease:"sine.inOut"},0),e}},{key:"hide",value:function(){var e=new v.a.timeline;return e.to(this._spotLight,{duration:1,intensity:0},0),e}},{key:"reset",value:function(){this._spotLight.intensity=0,this._mixer.setTime(0),this._camera.reset(),this._container.position.x=0,this._container.position.z=0}},{key:"addAssets",value:function(){var e=this.getObjectByName("statue"),t=y.b.get("forest/statue/albedo-map"),n=y.b.get("forest/statue/normal-map");e.material.uniforms.map.value=t,e.material.uniforms.normalMap.value=n}},{key:"render",value:function(){this._renderer.render(this,this._camera.active)}},{key:"_bindHandlers",value:function(){this._envMapChangeHandler=this._envMapChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._envMap.addEventListener("change",this._envMapChangeHandler)}},{key:"_removeEventListeners",value:function(){this._envMap.removeEventListener("change",this._envMapChangeHandler)}},{key:"_createContainer",value:function(){var e=new o.Object3D;(this.add(e),this._debug)&&this._debug.addGroup("Container").add(e,"position",{stepSize:1});return e}},{key:"_createCamera",value:function(){var e=new F({name:"Statue",root:this._root,renderer:this._renderer,scene:this,near:1,far:1e4,dollyHeight:this._sceneCamera.dollyHeight,dollyStartPosition:this._sceneCamera.dollyStartPosition,dollyEndPosition:this._sceneCamera.dollyEndPosition,dollySpeed:this._sceneCamera.dollySpeed,path:this._sceneCamera.pathPoints,triggerChangeEvent:!1,enableIdleAnimation:!1});return e.activateMain(),e}},{key:"_createMesh",value:function(){var e=this._gltf.scene.getObjectByName("statue-armature"),t=this._gltf.scene.getObjectByName("statue");t.frustumCulled=!1;var map=new o.Texture;map.encoding=o.LinearEncoding;var n=new ae({name:"statue",map:map,normalMap:new o.Texture,envMap:this._envMap.texture,roughness:1,metalness:.41,envMapIntensity:3.28});if(n.normalScale.set(1,-1),t.material=n,t.updateMatrix(),t.matrixAutoUpdate=!1,this._container.add(e),this._debug){var r=this._debug.addGroup("Material");r.add(n,"roughness",{min:0,max:1}),r.add(n,"metalness",{min:0,max:1}),r.add(n,"envMapIntensity",{min:0})}return e}},{key:"_destroyMesh",value:function(){var e=this._mesh.children[1];e.material.map.dispose(),e.material.normalMap.dispose(),e.material.dispose(),e.geometry.dispose()}},{key:"_createSpotLight",value:function(){var e=new o.SpotLight(16767641,0,2e3,5.78,1.006,3.18);if(e.position.set(10,-7,-1384),e.target.position.set(24,1871,-3807),e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e.target),this.add(e),this._debug){var t=this._debug.addGroup("Spot light");t.add(e,"visible"),t.add(e,"color"),t.add(e,"position",{stepSize:1}),t.add(e.target,"position",{label:"target",stepSize:1}),t.add(e,"intensity"),t.add(e,"distance"),t.add(e,"angle"),t.add(e,"penumbra",{stepSize:.001}),t.add(e,"decay")}return e}},{key:"_createHemisphereLight",value:function(){var e=new o.HemisphereLight(7697781,0,10.62);if(e.visible=!1,e.matrixAutoUpdate=!1,this.add(e),this._debug){var t=this._debug.addGroup("Hemisphere");t.add(e,"visible"),t.add(e,"color",{label:"skyColor"}),t.add(e,"groundColor"),t.add(e,"intensity",{min:0})}}},{key:"_createMixer",value:function(){var e=new o.AnimationMixer(this._mesh),t=this._gltf.animations[1],n=e.clipAction(t);(n.clampWhenFinished=!0,n.timeScale=.12,n.zeroSlopeAtEnd=!1,n.zeroSlopeAtStart=!1,this._action=n,this._debug)&&this._debug.addGroup("Animation").add(n,"timeScale");return e}},{key:"update",value:function(e){var t,n,r,time=e.time,o=e.delta;this._camera.update({time:time,delta:o}),this._camera.active.updateMatrix(),this._camera.active.updateWorldMatrix(),this._isStarted&&(this._container.position.x-=.4,this._container.position.z+=.2),this._camera.scrollProgress=this._sceneCamera.scrollProgress,null===(t=this._spotLight)||void 0===t||null===(n=t.userData.helper)||void 0===n||n.update(),null===(r=this._mixer)||void 0===r||r.update(o)}},{key:"_envMapChangeHandler",value:function(e){var map=e.map;this.getObjectByName("statue").material.envMap=map}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("Statue",{container:"Forest"});return e.add(this,"visible"),e}}}]),n}(Object(_.a)(o.Scene)),Mn=n(349);function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Pn=function(e){Object(d.a)(n,e);var t=Tn(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,{uColor:{value:new o.Color(e.color)},uTime:{value:null},uGradientSize:{value:e.gradientSize||0},uGradientStrength:{value:e.gradientStrength||0},uAlphaMultiplier:{value:e.alphaMultiplier||0},uTexturePosition:{value:null},uTextureVelocity:{value:null},uProgress:{value:0},uPulseInterval:{value:0}}]),r.vertexShader="#define GLSLIFY 1\n// Attributes\nattribute vec2 reference;\nattribute vec2 settings;\n\n// Varyings\nvarying vec2 vUv;\nvarying vec2 vSettings;\n\n// Uniforms\nuniform highp sampler2D uTexturePosition;\n\n// Requires\nmat3 rotation3dZ(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\tc, s, 0.0,\n\t\t-s, c, 0.0,\n\t\t0.0, 0.0, 1.0\n\t);\n}\n\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\nvoid main() {\n    // Position\n    vec3 newPosition = texture2D(uTexturePosition, reference).xyz;\n    vec4 modelPosition = vec4(position + newPosition, 1.0);\n    // modelPosition.z += 100.0;\n\n    // Output\n    vec4 mvPosition = viewMatrix * instanceMatrix * modelPosition;\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Varyings\n    vSettings = settings;\n    vUv = uv;\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec2 vSettings;\n\n// Uniforms\nuniform float uTime;\nuniform vec3 uColor;\nuniform float uGradientSize;\nuniform float uGradientStrength;\nuniform float uAlphaMultiplier;\nuniform float uProgress;\n\n// https://www.shadertoy.com/view/4djSRW\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\n// https://www.iquilezles.org/www/articles/functions/functions.htm\nfloat cubicPulse( float c, float w, float x ) {\n    x = abs(x - c);\n    if( x>w ) return 0.0;\n    x /= w;\n    return 1.0 - x*x*(3.0-2.0*x);\n}\n\nvoid main() {\n    // Pulse\n    // float pulse = sin(uTime * 4. + vSettings.x * 1.2);\n    float pulseTime = mod(uTime * 0.6 + vSettings.x * 1.2, 1.0);\n    float pulse = clamp(1.0 - cubicPulse(0.2, 0.2, pulseTime) * 4.0, 0.0, 1.0);\n\n    // Gradient\n    vec4 color = vec4(uGradientSize / length(vUv - 0.5));\n    color.rgb *= uColor.rgb;\n    color *= uGradientStrength;\n\n    // Ouput\n    gl_FragColor = color;\n\n    // Alpha\n    gl_FragColor.a *= uAlphaMultiplier * vSettings.y;\n    gl_FragColor.a *= pulse;\n\n    float alphaOffset = hash11(vSettings.y) * -3.0;\n    gl_FragColor.a *= min(1.0, alphaOffset + uProgress);\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.uColor.value},set:function(e){this.uniforms.uColor.value=e}}]),n}(Q);function Rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Dn=50,An=function(e){Object(d.a)(n,e);var t=Rn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog,n=e.renderer,r=e.postProcessing;this._fog=t,this._renderer=n,this._postProcessing=r,this._debug=this._createDebug(),this._gpuComputationRenderer=this._createGpuComputationRenderer(),this._velocityTexture=this._createVelocityTexture(),this._velocityVariable=this._createVelocityVariable(),this._positionTexture=this._createPositionTexture(),this._positionVariable=this._createPositionVariable(),this._particles=this._createParticles(),this._gpuComputationRenderer.init(),this._gpuComputationRenderer.compute(),this.matrixAutoUpdate=!1,this.visible=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._velocityTexture.dispose(),this._velocityVariable.renderTargets[0].dispose(),this._velocityVariable.renderTargets[1].dispose(),this._positionTexture.dispose(),this._positionVariable.renderTargets[0].dispose(),this._positionVariable.renderTargets[1].dispose(),this._destroyParticles()}},{key:"show",value:function(){this.visible=!0;var e=new v.a.timeline;return e.set(this._positionVariable.material.uniforms.uProgress,{value:1},0),e.to(this._velocityVariable.material.uniforms.uProgress,{duration:.5,value:1,ease:"none"},0),e.to(this._particles.material.uniforms.uProgress,{duration:1,value:4,ease:"sine.out"},0),e}},{key:"hide",value:function(){var e=this,t=new v.a.timeline({onComplete:function(){e.visible=!1}});return t.to(this._particles.material.uniforms.uProgress,{duration:1,value:0,ease:"sine.out"},0),t.set(this._velocityVariable.material.uniforms.uProgress,{value:0},1),t.set(this._positionVariable.material.uniforms.uProgress,{value:0},1),t}},{key:"reset",value:function(){this.visible=!1,this._particles.material.uniforms.uProgress.value=0,this._velocityVariable.material.uniforms.uProgress.value=0,this._positionVariable.material.uniforms.uProgress.value=0}},{key:"_createGpuComputationRenderer",value:function(){var e=new Mn.a(Dn,Dn,this._renderer);return Ke.a.isSafari()&&e.setDataType(o.HalfFloatType),e}},{key:"_createVelocityTexture",value:function(){for(var e=this._gpuComputationRenderer.createTexture(),data=e.image.data,i=(data.length,0),t=data.length;i<t;i+=4)data[i+0]=Math.random(),data[i+1]=Math.random(),data[i+2]=Math.random(),data[i+3]=Math.random();return e}},{key:"_createVelocityVariable",value:function(){var e=this._gpuComputationRenderer.addVariable("textureVelocity","#define GLSLIFY 1\n// Uniforms\nuniform sampler2D uPositionOriginTexture;\nuniform float uProgress;\n\nfloat hash13(vec3 p3) {\n    p3  = fract(p3 * .1031);\n    p3 += dot(p3, p3.zyx + 31.32);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvoid main() {\n    // Uv\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n    // Original position\n    vec4 originPosition = texture2D(uPositionOriginTexture, uv);\n\n    // Mass\n    float mass = 0.5 + hash13(originPosition.xyz) * 2.0;\n\n    // Acceleration\n    float acceleration = (0.1 * uProgress) / mass;\n\n    // Velocity\n    vec4 velocity = vec4(0.0, acceleration, 0.0, 0.0);\n\n    // Output\n    gl_FragColor = velocity;\n}\n",this._velocityTexture);return e.material.uniforms.uPositionOriginTexture={value:this._velocityTexture.clone()},e.material.uniforms.uTime={value:0},e.material.uniforms.uProgress={value:0},this._gpuComputationRenderer.setVariableDependencies(e,[e]),this._debug&&this._debug.add(e.material.uniforms.uProgress,"value",{label:"progress",stepSize:.01}),e}},{key:"_createPositionTexture",value:function(){for(var e=this._gpuComputationRenderer.createTexture(),data=e.image.data,t=data.length,i=0,n=data.length;i<n;i+=4)data[i+0]=70*(2*Math.random()-1),data[i+1]=0,data[i+2]=-2160*(1-i/t),data[i+3]=Math.random();return e}},{key:"_createPositionVariable",value:function(){var e=this._gpuComputationRenderer.addVariable("texturePosition","#define GLSLIFY 1\n// Uniforms\nuniform sampler2D uPositionOriginTexture;\nuniform float uTime;\nuniform float uProgress;\nuniform float uTurbulencesFrequency;\nuniform float uTurbulencesTimeFrequency;\nuniform float uTurbulencesAmplitude;\nuniform float uTurbulencesSpeed;\n\n// Requires\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nfloat cubicOut(float t) {\n  float f = t - 1.0;\n  return f * f * f + 1.0;\n}\n\nfloat hash13(vec3 p3) {\n    p3  = fract(p3 * .1031);\n    p3 += dot(p3, p3.zyx + 31.32);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvoid main() {\n    // Uv\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n    // Velocity\n    vec4 velocitySample = texture2D(textureVelocity, uv);\n\n    // Position\n    vec4 originPosition = texture2D(uPositionOriginTexture, uv);\n    vec4 position = texture2D(texturePosition, uv);\n\n    float maxY = hash13(originPosition.xyz) * 40.0;\n    position.w += velocitySample.y;\n    position.w = min(position.w, maxY);\n    position.w *= uProgress;\n\n    float delta = maxY - position.w;\n    float progress = delta / maxY;\n    float y = maxY * cubicOut(1.0 - progress);\n\n    position.x = originPosition.x + (snoise(vec3((originPosition.rgb + 0.0) * uTurbulencesFrequency) + uTime * uTurbulencesTimeFrequency) * uTurbulencesAmplitude) * uTurbulencesSpeed;\n    position.y = originPosition.y + y + (snoise(vec3((originPosition.rgb + 1234.0) * uTurbulencesFrequency) + uTime * uTurbulencesTimeFrequency) * uTurbulencesAmplitude) * uTurbulencesSpeed;\n\n    // Output\n    gl_FragColor = position;\n}\n",this._positionTexture);return e.material.uniforms.uPositionOriginTexture={value:this._positionTexture.clone()},e.material.uniforms.uTime={value:0},e.material.uniforms.uProgress={value:0},e.material.uniforms.uTurbulencesFrequency={value:-.0229},e.material.uniforms.uTurbulencesTimeFrequency={value:.13},e.material.uniforms.uTurbulencesAmplitude={value:27},e.material.uniforms.uTurbulencesSpeed={value:.351},this._gpuComputationRenderer.setVariableDependencies(e,[this._velocityVariable,e]),this._debug&&(this._debug.add(e.material.uniforms.uTurbulencesFrequency,"value",{label:"frequency",stepSize:1e-4}),this._debug.add(e.material.uniforms.uTurbulencesTimeFrequency,"value",{label:"time frequency"}),this._debug.add(e.material.uniforms.uTurbulencesAmplitude,"value",{label:"amplitude",stepSize:1}),this._debug.add(e.material.uniforms.uTurbulencesSpeed,"value",{label:"speed",stepSize:.001})),e}},{key:"_createParticles",value:function(){for(var e,t,n=2500,r=new Float32Array(5e3),l=new Float32Array(5e3),i=0;i<5e3;i+=2)e=i%Dn/Dn,t=~~(i/Dn)/Dn,r[i+0]=e,r[i+1]=t,l[i+0]=3*Math.random(),l[i+1]=.8+.2*Math.random();var c=new o.PlaneBufferGeometry(10,10);c.setAttribute("reference",new o.InstancedBufferAttribute(new Float32Array(r),2)),c.setAttribute("settings",new o.InstancedBufferAttribute(new Float32Array(l),2)),c.deleteAttribute("normal");var h=new Pn({color:14602620,gradientSize:.06,gradientStrength:.18,alphaMultiplier:1.25,transparent:!0});h.depthWrite=!1;var d=new o.InstancedMesh(c,h,n);d.updateMatrix(),d.userData.renderBloom=!1,d.matrixAutoUpdate=!1;for(var f=new o.Object3D,m=0;m<n;m++)f.position.set(0,0,0),f.updateMatrix(),d.setMatrixAt(m,f.matrix);return this.add(d),this._debug&&(this._debug.add(h,"color"),this._debug.add(h.uniforms.uGradientSize,"value",{label:"gradientSize",stepSize:.01,min:0}),this._debug.add(h.uniforms.uGradientStrength,"value",{label:"gradientStrength",stepSize:.01,min:0}),this._debug.add(h.uniforms.uAlphaMultiplier,"value",{label:"alphaMultiplier",stepSize:.01,min:0})),d}},{key:"_destroyParticles",value:function(){this._particles.material.dispose(),this._particles.geometry.dispose(),this._particles=null}},{key:"update",value:function(e){var time=e.time;this.visible&&(this._positionVariable.material.uniforms.uTime.value=time,this._gpuComputationRenderer.compute(),this._particles.material.uniforms.uTexturePosition.value=this._gpuComputationRenderer.getCurrentRenderTarget(this._positionVariable).texture,this._particles.material.uniforms.uTime.value=time)}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("Fireflies",{container:"Forest"});return e.add(this,"visible"),e}}}]),n}(Object(_.a)(o.Object3D));function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var In={name:"Forest",class:function(e){Object(d.a)(n,e);var t=En(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.config;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._config=l,this._isActive=!1,this._isFirstShow=!0,this._directionalLightShadowOffset=0,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera(),this._lights=this._createLights(),this._envMap=this._createEnvMap(),this._fog=this._createFog(),this._components=this._createComponents(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyComponents()}},{key:"camera",get:function(){return this._camera}},{key:"config",get:function(){return this._config}},{key:"components",get:function(){return this._components}},{key:"activeStateIndex",get:function(){return this._activeStateIndex}},{key:"prepare",value:function(e,t){this._root.nuxtRoot.$store.getters["context/isProduction"]&&this._addAssetsToComponents(),this._postProcessing.loadSettings(this.name),t.loadRenderSettings(this._config.renderer),this._renderer.compile(this,this._camera.main),this._components.statue&&this._components.statue.compile(),this._renderer.render(this,this._camera.main),this._postProcessing.render(this,this.camera.active),e()}},{key:"show",value:function(e){var t=this,n=e.instant;this._resourceManager.load().then((function(){var e;t._isActive=!0,t._activeStateIndex=0,t._isState0Active=!0,t._isState1Active=!1,t._isState2Active=!1,t._isFirstShow&&t._root.nuxtRoot.$store.getters["context/isDevelopment"]&&(t._addAssetsToComponents(),t._isFirstShow=!1),w.a.playLandscapeTrack(t._config.audio.background),t._camera.reset(),t._components.statue&&t._components.statue.reset(),n||(t._camera.enable(),t._components.statue&&t._components.statue.camera.enable(),t._root.nuxtRoot.$store.getters["context/isProduction"]&&(t._camera.startDolly(),t._components.statue&&t._components.statue.camera.startDolly())),null===(e=t._timelineHide)||void 0===e||e.kill(),t._timelineShow=new v.a.timeline({onComplete:function(){t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionNone")}}),t._timelineShow.call((function(){return t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionIn")}),null,0),t._timelineShow.call((function(){return t._postProcessing.passes.lineRender.changeColor(new o.Color(t._config.lines.color))}),null,0),t._components.statue&&t._timelineShow.call((function(){return t._components.statue.start()}),null,0),t._timelineShow.fromTo(t._postProcessing.passes.transition,{progress:1},{duration:3,progress:0,ease:"sine.inOut"},0),t._timelineShow.add(t._components.fireflies.show(),0),t._timelineShow.add(t._components.trees.showFireflies(),0),v.a.delayedCall(5,(function(){t._root.landscapeManager.loadResourcesNextScene()}))}))}},{key:"hide",value:function(e){var t,n,r=this,o=e.onCompleteCallback,l=e.instant;return null===(t=this._timelineShow)||void 0===t||t.kill(),null===(n=this._timelineHide)||void 0===n||n.kill(),this._timelineHide=new v.a.timeline({onComplete:function(){r._isActive=!1,r._camera.stopDolly(),r._components.statue&&r._components.statue.camera.stopDolly(),l||(r._camera.disable(),r._components.statue&&r._components.statue.camera.disable(),r._camera.reset(),r._components.statue&&r._components.statue.camera.reset()),r._resetStates(),"function"==typeof o&&o()}}),l||(this._timelineHide.call((function(){return r._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionOut")}),null,0),this._timelineHide.to(this._postProcessing.passes.transition,{duration:3,progress:1,ease:"sine.inOut"},0)),this._timelineHide}},{key:"setState",value:function(e){switch(this._postProcessing.passes.final.spawnScan(this._camera.position,{start:0,duration:8,alphaDuration:1,alphaDelay:1.5}),this._postProcessing.passes.transition.changeLUT(e),this._postProcessing.passes.lineRender.lines.spin(),this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}if(this._activeStateIndex!==e)switch(this._activeStateIndex=e,this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}}},{key:"_bindHandlers",value:function(){this._cameraDollyCompleteHandler=this._cameraDollyCompleteHandler.bind(this),this._menuOpenHandler=this._menuOpenHandler.bind(this),this._menuClosedHandler=this._menuClosedHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._camera.addEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.addEventListener("menu:open",this._menuOpenHandler),this.addEventListener("menu:closed",this._menuClosedHandler)}},{key:"_removeEventListeners",value:function(){this._camera.removeEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.removeEventListener("menu:open",this._menuOpenHandler),this.removeEventListener("menu:closed",this._menuClosedHandler)}},{key:"_createResourceManager",value:function(){return new y.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new F({root:this._root,renderer:this._renderer,scene:this,debugContainer:"Forest",near:1,far:2e3,dollyHeight:8.3,dollySpeed:22e-5,path:this._config.cameraPath,pathEnd:.7,menuPositions:this._config.menuCameraPositions,heightOffset:-4,enableIdleAnimation:!1});return e.activateMain(),B.a.copySettings(e.main),e}},{key:"_createFog",value:function(){var e=new W({type:V,color:new o.Color(328965),globalStrength:0,near:0,far:931,density:5e-4,height:.068,sides:!1,sideNear:0,sideFar:100,ravineLight:!0,ravineLightColor:new o.Color(11243900),ravineLightPosition:new o.Vector3(0,-150,0),ravineLightMaxDistance:145,ravineLightDecay:1.05,ravineLightIntensity:0,envMap:this._envMap});if(e.visible=!0,x.a){var t=x.a.addGroup("Fog",{container:"Forest"});t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"sides"),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:.001}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:1});var r=t.addGroup("Ground");r.add(e,"density",{stepSize:1e-4}),r.add(e,"height",{stepSize:.001});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:1e-4});var c=t.addGroup("Sides");c.add(e,"sideNear",{stepSize:1}),c.add(e,"sideFar",{stepSize:1});var h=t.addGroup("Ravine");h.add(e,"ravineLight",{label:"visible"}),h.add(e,"ravineLightColor"),h.add(e,"ravineLightPosition",{label:"position",stepSize:1}),h.add(e,"ravineLightMaxDistance",{label:"distance",stepSize:1}),h.add(e,"ravineLightDecay",{label:"decay"}),h.add(e,"ravineLightIntensity",{label:"intensity"})}return e}},{key:"_createEnvMap",value:function(){return new X({renderer:this._renderer,name:this._config.renderer.envMap,debugContainer:"Forest"})}},{key:"_createLights",value:function(){var e,t={};if(x.a&&(e=x.a.addGroup("Lights",{container:"Forest"})),t.directional=new o.DirectionalLight(2830902,.12),t.directional.visible=!0,t.directional.position.x=-48,t.directional.position.y=159,t.directional.userData.originalPositionZ=t.directional.position.z=-321,t.directional.castShadow=!1,t.directional.shadow.mapSize.width=1024,t.directional.shadow.mapSize.height=1024,t.directional.shadow.camera.near=0,t.directional.shadow.camera.far=400,t.directional.shadow.camera.left=-200,t.directional.shadow.camera.bottom=-200,t.directional.shadow.camera.right=200,t.directional.shadow.camera.top=200,t.directional.target.position.x=38,t.directional.target.position.y=-60,t.directional.userData.originalTargetZ=t.directional.target.position.z=168,this.add(t.directional.target),this.add(t.directional),e){var n=function(){t.directional.shadow.mapSize.width=parseInt(l.mapSize),t.directional.shadow.mapSize.height=parseInt(l.mapSize),t.directional.shadow.camera.updateProjectionMatrix(),t.directional.shadow.map&&t.directional.shadow.map.dispose(),t.directional.shadow.map=null,t.directional.shadow.needsUpdate=!0},r=e.addGroup("Directional");r.add(t.directional,"visible"),r.add(t.directional,"color"),r.add(t.directional,"intensity"),r.add(t.directional,"position",{stepSize:1}),r.add(t.directional.target,"position",{label:"target",stepSize:1}),r.add(this,"_directionalLightShadowOffset",{label:"offset",stepSize:1});var l={mapSize:1024},c=r.addGroup("Shadow");c.add(t.directional,"castShadow"),c.add(l,"mapSize",{options:[128,256,512,1024,2048,4096],onChange:n}),c.add(t.directional.shadow.camera,"near",{stepSize:1,onChange:n}),c.add(t.directional.shadow.camera,"far",{stepSize:1,onChange:n})}if(t.hemisphere=new o.HemisphereLight(0,5855577,.014),t.hemisphere.visible=!0,t.hemisphere.matrixAutoUpdate=!1,this.add(t.hemisphere),e){var h=e.addGroup("Hemisphere");h.add(t.hemisphere,"visible"),h.add(t.hemisphere,"color",{label:"skyColor"}),h.add(t.hemisphere,"groundColor"),h.add(t.hemisphere,"intensity",{min:0,stepSize:.001})}return t}},{key:"_restart",value:function(){var e=this,t=new v.a.timeline;t.to(this._postProcessing.passes.transition,{duration:4,progress:1,ease:"sine.inOut"},0),t.call((function(){e._camera.reset(),e._camera.startDolly(),e._components.statue&&e._components.statue.reset(),e._components.statue.camera.reset(),e._components.statue.camera.startDolly()}),null,4),t.to(this._postProcessing.passes.transition,{duration:4,progress:0,ease:"sine.inOut"},4)}},{key:"_createComponents",value:function(){var e={};return e.moon=this._createMoonComponent(),e.skybox=this._createSkyboxComponent(),e.fireflies=this._createFirefliesComponent(),e.terrain=this._createTerrainComponent(),e.trees=this._createTreesComponent(),e.shapes=this._createShapesComponent(),e.statue=this._createStatueComponent(),e}},{key:"_addAssetsToComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].addAssets&&this._components[e].addAssets()}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_createMoonComponent",value:function(){var component=new ln({debugContainer:"Forest",size:14,color:new o.Color(14277854),strength:0,glowSize:13,inclination:-.302,azimuth:3.24,camera:this._camera});return this.add(component),component}},{key:"_createSkyboxComponent",value:function(){var component=new Ae({envMap:this._envMap,rotation:new o.Euler(0,0,0),strength:.86,debugContainer:"Forest"});return this.add(component),component}},{key:"_createTerrainComponent",value:function(){var component=new gn({fog:this._fog,envMap:this._envMap});return this.add(component),component}},{key:"_createTreesComponent",value:function(){var component=new Sn({fog:this._fog});return this.add(component),component}},{key:"_createShapesComponent",value:function(){var component=new On({fog:this._fog,data:this._config.shapes,camera:this._camera,postProcessing:this._postProcessing});return this.add(component),component}},{key:"_createStatueComponent",value:function(){return new kn({root:this._root,renderer:this._renderer,fog:this._fog,sceneCamera:this._camera,envMap:this._envMap})}},{key:"_createFirefliesComponent",value:function(){var component=new An({fog:this._fog,renderer:this._renderer,postProcessing:this._postProcessing});return this.add(component),component}},{key:"_toggleState0",value:function(){var e;this._isState0Active=!this._isState0Active,null===(e=this._timelineState0)||void 0===e||e.kill(),this._timelineState0=new v.a.timeline,this._isState0Active?(this._components.fireflies&&this._timelineState0.add(this._components.fireflies.show(),0),this._timelineState0.add(this._components.trees.showFireflies(),0)):(this._components.fireflies&&this._timelineState0.add(this._components.fireflies.hide(),0),this._timelineState0.add(this._components.trees.hideFireflies(),0))}},{key:"_toggleState1",value:function(){var e;this._isState1Active=!this._isState1Active,null===(e=this._timelineState1)||void 0===e||e.kill(),this._timelineState1=new v.a.timeline,this._isState1Active?(this._components.statue&&this._timelineState1.add(this._components.statue.show(),.5),this._timelineState1.to(this._components.terrain._material.uniforms.ravineLightIntensity,{duration:1,value:2.6,ease:"sine.inOut"},.5),this._timelineState1.to(this._components.terrain._bottom.material.uniforms.ravineLightIntensity,{duration:1,value:2.6,ease:"sine.inOut"},.5),this._timelineState1.to(this._components.terrain._bottom.material.color,{duration:1,r:124/255,g:85/255,b:19/255,ease:"sine.inOut"},.5),this._timelineState1.to(this._lights.hemisphere.groundColor,{duration:1,r:1,g:168/255,b:87/255,ease:"sine.inOut"},.5),this._timelineState1.to(this._lights.hemisphere,{duration:1,intensity:.036,ease:"sine.inOut"},.5)):(this._components.statue&&this._timelineState1.add(this._components.statue.hide(),.5),this._timelineState1.to(this._components.terrain._material.uniforms.ravineLightIntensity,{duration:1,value:0,ease:"sine.inOut"},0),this._timelineState1.to(this._components.terrain._bottom.material.uniforms.ravineLightIntensity,{duration:1,value:0,ease:"sine.inOut"},0),this._timelineState1.to(this._components.terrain._bottom.material.color,{duration:1,r:10/255,g:10/255,b:10/255,ease:"sine.inOut"},1),this._timelineState1.to(this._lights.hemisphere.groundColor,{duration:1,r:89/255,g:89/255,b:89/255,ease:"sine.inOut"},.5),this._timelineState1.to(this._lights.hemisphere,{duration:1,intensity:.014,ease:"sine.inOut"},.5))}},{key:"_toggleState2",value:function(){var e;this._isState2Active=!this._isState2Active,null===(e=this._timelineState2)||void 0===e||e.kill(),this._timelineState2=new v.a.timeline,this._isState2Active?this._timelineState2.add(this._components.shapes.show(),0):this._timelineState2.add(this._components.shapes.hide(),0)}},{key:"_resetStates",value:function(){this._components.fireflies.reset(),this._components.trees.resetFireflies(),this._components.statue&&this._components.statue.reset(),this._components.terrain._material.uniforms.ravineLightIntensity.value=0,this._components.terrain._bottom.material.uniforms.ravineLightIntensity.value=0,this._components.terrain._bottom.material.color.set(657930),this._lights.hemisphere.groundColor.set(5855577),this._lights.hemisphere.intensity=.014,this._components.shapes.reset()}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&(this._updateCamera({time:time,delta:t}),this._updateComponents({time:time,delta:t}))}},{key:"_updateCamera",value:function(e){var time=e.time,t=e.delta;this._camera.update({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"_updateDirectionLightPosition",value:function(){this._lights.directional.position.z=this._lights.directional.userData.originalPositionZ+this._camera.position.z,this._lights.directional.target.position.z=this._lights.directional.userData.originalTargetZ+this._camera.position.z}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n}},{key:"_cameraDollyCompleteHandler",value:function(){this._root.nuxtRoot.$store.getters["home/isScrollTriggered"]?this._restart():this.dispatchEvent({type:"complete"})}},{key:"_menuOpenHandler",value:function(){this._components.statue.visible=!1,this._isState0Active&&(this._components.fireflies.visible=!1,this._components.trees.hideFireflies(!0)),this._isState1Active&&(this._components.terrain._material.uniforms.ravineLightIntensity.value=0,this._components.terrain._bottom.material.uniforms.ravineLightIntensity.value=0,this._components.terrain._bottom.material.color.set(657930),this._lights.hemisphere.intensity=0),this._isState2Active&&this._components.shapes.hide()}},{key:"_menuClosedHandler",value:function(){this._components.statue.visible=!0,this._isState0Active&&(this._components.fireflies.visible=!0,this._components.trees.hideFireflies(!0)),this._isState1Active&&(this._components.terrain._material.uniforms.ravineLightIntensity.value=2.6,this._components.terrain._bottom.material.ravineLightIntensity.value=2.6,this._components.terrain._bottom.material.color.set(8148243),this._lights.hemisphere.intensity=.036),this._isState2Active&&this._components.shapes.show()}},{key:"onCameraChange",value:function(e){"debug"===e.type?(this._fog.visible=!1,this._components.statue.camera.activateDebug()):(this._fog.visible=!0,this._components.statue.camera.activateMain())}}]),n}(Object(_.a)(o.Scene)),renderer:{clearColor:"#121212",envMap:"night-sky",toneMapping:o.ACESFilmicToneMapping,toneMappingExposure:2.49,outputEncoding:o.sRGBEncoding},postProcessing:{fogBloom:{enabled:!0,strength:1.07,radius:1},ssms:{depthOffset:-.688,sides:new o.Vector4(-1,214,72,120),bottom:new o.Vector2(-20,-86)},bloom:{enabled:!0,strength:1.18,radius:.63},final:{enabled:!0,lut:"lut/forest"}},lines:{color:16773490},audio:{background:"audio-landscape-forest",transition:"audio-transition-forest"},resources:{preload:{development:!1,production:!0},items:[{type:"ktx",name:"forest/tree/leaf-albedo-map",path:"/webgl/scenes/forest/tree/leaf-albedo-map.ktx2"},{type:"ktx",name:"forest/tree/tree-map",path:"/webgl/scenes/forest/tree/tree-map.ktx2"},{type:"ktx",name:"forest/backdrop-map",path:"/webgl/scenes/forest/tree/backdrop-map.ktx2"},{type:"ktx",name:"forest/terrain/normal-map",path:"/webgl/scenes/forest/terrain/normal-map.ktx2"},{type:"ktx",name:"forest/statue/albedo-map",path:"/webgl/scenes/forest/statue/albedo-map.ktx2"},{type:"ktx",name:"forest/statue/normal-map",path:"/webgl/scenes/forest/statue/normal-map.ktx2"}]},cameraPath:[[-.015909671783447266,18.842676162719727,-53.83839416503906],[-1.5977516174316406,18.842676162719727,-166.23287963867188],[-.8868170976638794,18.842676162719727,-492.67364501953125],[14.712669372558594,18.842676162719727,-686.3411865234375],[10.838642120361328,18.842676162719727,-914.38232421875],[-1.7023983001708984,18.842676162719727,-1128.594970703125],[-11.569772720336914,18.842676162719727,-1328.686279296875],[-.8055678606033325,18.842676162719727,-1553.6678466796875],[14.581503868103027,18.842676162719727,-1782.3304443359375],[1.7423686981201172,18.842676162719727,-2038.361083984375],[-4.14892578125,18.842676162719727,-2200.5859375]],menuCameraPositions:[{position:new o.Vector3(51.780883832704994,137.0433903942527,-708.0255056112853),rotation:new o.Euler(-1.5489786107554844,.015014865701805168,.602668178533101),target:new o.Vector3(48.857935156116085,-57.565970416271185,-712.2721112182253),transitionProgress:.22,lutIndex:0},{position:new o.Vector3(22.19299812192756,-37.34649733198748,-2002.407653156898),rotation:new o.Euler(2.728283586797574,.9200000000000013,-9.31999999999997),target:new o.Vector3(-92.18329392729171,187.60417380102803,-1489.4903695747169),transitionProgress:.12,lutIndex:0},{position:new o.Vector3(34.545036534565845,26.151062048589914,-420.24568378093073),rotation:new o.Euler(.40264408360059595,-.06693270062214883,-.6000000000000002),target:new o.Vector3(48.94115926153731,40.158023449060984,-453.1325573429),transitionProgress:.01,lutIndex:0}],shapes:[{type:"square",position:new o.Vector3(-.07,8.25,-100)},{type:"rectangle",position:new o.Vector3(.15,5.89,-600)},{type:"square",position:new o.Vector3(-9.63,3.64,-1100)},{type:"rectangle",position:new o.Vector3(.85,10.39,-1600)},{type:"square",position:new o.Vector3(-5.63,1.17,-2100)},{type:"rectangle",position:new o.Vector3(4.51,9.44,-2600)}]};In.resources.items=[].concat(Object(r.a)(In.resources.items),Object(r.a)($[In.renderer.envMap].items));var jn=In;function Fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Bn=function(e){Object(d.a)(n,e);var t=Fn(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,{uTexture:{value:e.texture},uColor:{value:e.color},uOpacity:{value:e.opacity},uPulseStrength:{value:e.pulseStrength},uTime:{value:0}}]),r.defines={USE_COLOR:""},r.type="DecalsMaterial",r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vColor;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n    vColor = color;\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Uniforms\nuniform sampler2D uTexture;\nuniform vec3 uColor;\nuniform float uOpacity;\nuniform float uTime;\nuniform float uPulseStrength;\n\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vColor;\n\nvoid main() {\n    // Sample\n    vec4 textureSample = texture2D(uTexture, vUv);\n\n    // Noise\n    vec2 noiseUv = vUv + vec2(vColor.r);\n    vec4 noise = texture2D(uTexture, noiseUv);\n\n    // Mask\n    float mask = clamp((1.0 - noise.r * 1.2), 0.0, 1.0);\n\n    // Alpha\n    float pulse = 0.7 + ((1.0 + sin(uTime + vColor.r * 100.0)) * 0.5) * uPulseStrength;\n    float alpha = (textureSample.g - mask) * uOpacity * pulse;\n\n    // Output\n    gl_FragColor = vec4(uColor, alpha);\n}\n",r}return n}(Q);function Un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Nn=function(e){Object(d.a)(n,e);var t=Un(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.gltf,n=e.nameMesh,r=e.nameLights,l=e.debug,c=e.intensity,h=e.distance;this._gltf=t,this._nameMesh=n,this._nameLights=r,this._intensity=c,this._distance=h,this._timeOffsets=[.2,.1,.3,.4,.4,.4,.4],this._pulseSpeed=2,this._color=new o.Color(4255209),this._debug=this._createDebug(l),this._mesh=this._createMesh(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._mesh.material.uniforms.uTexture.value.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.set(this._mesh,{visible:!0},0),t.to(this._mesh.material.uniforms.uOpacity,{duration:1,value:1},0),e&&t.timeScale(10),t}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._mesh.material.uniforms.uOpacity,{duration:1,value:0},0),t.set(this._mesh,{visible:!1}),e&&t.timeScale(10),t}},{key:"reset",value:function(){this._mesh.material.uniforms.uOpacity.value=0,this._mesh.visible=!1}},{key:"addTextures",value:function(){var e=ut.a["cave/decals-map"];this._mesh.material.uniforms.uTexture.value=e}},{key:"_createMesh",value:function(){var e=this,t=this._gltf.scene.getObjectByName(this._nameMesh).clone();return t.material=new Bn({texture:new o.Texture,color:this._color,opacity:0,pulseStrength:.8,transparent:!0}),t.visible=!1,t.material.uniforms.uTexture.generateMipmaps=!1,t.material.uniforms.uTexture.value.encoding=o.LinearEncoding,t.material.polygonOffset=!0,t.material.polygonOffsetFactor=-2,t.material.color=this._color,t.userData.renderBloom=!0,t.updateMatrix(),t.matrixAutoUpdate=!1,this.add(t),this._debug&&(this._debug.add(this,"_color",{label:"color",onChange:function(){if(t.material.uniforms.uColor.value=e._color,e._lights)for(var i=0,n=e._lights.length;i<n;i++)e._lights[i].color=e._color}}),this._debug.add(t.material,"polygonOffsetFactor"),this._debug.add(t.material.uniforms.uOpacity,"value",{label:"opacity",min:0,max:1,onChange:function(){if(e._lights)for(var i=0,n=e._lights.length;i<n;i++)e._lights[i].intensity=2*t.material.opacity}}),this._debug.add(t.material.uniforms.uPulseStrength,"value",{label:"pulseStrength"}),this._debug.add(this,"_pulseSpeed",{label:"pulseSpeed"})),t}},{key:"_createLights",value:function(){var e=this._gltf.scene.getObjectByName(this._nameLights);if(e){for(var t,n,r,source=e.children,l=[],c={visible:!0,intensity:1.16,distance:this._distance},i=0,h=source.length;i<h;i++)t=source[i],(n=new o.PointLight(this._color,c.intensity,c.distance)).visible=c.visible,n.position.copy(t.position),n.name=t.name,this.add(n),l.push(n),r=new o.PointLightHelper(n,5),this.add(r);if(this._debug){var d=this._debug.addGroup("Lights",{container:"Decals"});d.add(c,"visible",{onChange:f}),d.add(c,"intensity",{onChange:f}),d.add(c,"distance",{stepSize:1,onChange:f})}return l}function f(){for(var e,t=0,n=l.length;t<n;t++)(e=l[t]).visible=c.visible,e.intensity=c.intensity,e.distance=c.distance}}},{key:"update",value:function(e){var t=e.delta;this._mesh.material.uniforms.uTime.value+=t*this._pulseSpeed}},{key:"_createDebug",value:function(e){if(e){var t=e.addGroup("Decals");return t.add(this,"visible"),t}}}]),n}(Object(_.a)(o.Object3D)),zn="#define GLSLIFY 1\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float rockIndex;\nattribute float speed;\n\nuniform float uTime;\nuniform float uProgress;\nuniform float uRotationAngle;\n\nvarying float vAnimate;\nvarying float vProgress;\n\nvec4 quatFromAxisAngle(vec3 axis, float angle) {\n    vec4 qr;\n    float half_angle = (angle * 0.5) * PI;\n    qr.x = axis.x * sin(half_angle);\n    qr.y = axis.y * sin(half_angle);\n    qr.z = axis.z * sin(half_angle);\n    qr.w = cos(half_angle);\n    return qr;\n}\n\nvec3 rotateVertexPosition(vec3 position, vec3 axis, float angle){\n    vec4 q = quatFromAxisAngle(axis, angle);\n    vec3 v = position.xyz;\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\n// #pragma glslify: ease = require(glsl-easings/cubic-out)\nfloat quarticOut(float t) {\n  return pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n\n    // Noise\n    float noise = hash11(rockIndex * 1000.);\n\n    // Animate\n    float animate = noise > 0.8 ? 1.0 : 0.0;\n    vAnimate = animate;\n\n    // Rotation\n    vec3 rotationAxis = vec3(1.0, 0.0, 0.0);\n\n    vec3 transformedNormal = objectNormal;\n\n    // Normal map rotation\n    transformedNormal = rotateVertexPosition(transformedNormal, rotationAxis, uRotationAngle * animate);\n\n    #ifdef USE_INSTANCING\n\n        // this is in lieu of a per-instance normal-matrix\n        // shear transforms in the instance matrix are not supported\n\n        mat3 m = mat3( instanceMatrix );\n\n        transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n        transformedNormal = m * transformedNormal;\n\n    #endif\n\n    transformedNormal = normalMatrix * transformedNormal;\n\n    #ifdef FLIP_SIDED\n\n        transformedNormal = - transformedNormal;\n\n    #endif\n\n    #ifdef USE_TANGENT\n\n        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n        #ifdef FLIP_SIDED\n\n            transformedTangent = - transformedTangent;\n\n        #endif\n\n    #endif\n\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n        #ifdef USE_TANGENT\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        #endif\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    // Rotation\n    transformed = rotateVertexPosition(transformed, rotationAxis, uRotationAngle * animate);\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    #ifdef USE_INSTANCING\n\n        mvPosition = instanceMatrix * mvPosition;\n\n    #endif\n\n    // Float\n    float heightNoise = hash11(rockIndex + 1234.0);\n    float targetHeight = 20.0 + 300.0 * heightNoise;\n    float floatOffset = sin(uTime + heightNoise * 100.0) * 10.0;\n\n    float progressNoise = hash11(rockIndex + 1337.0 * 1000.);\n    float progressOffset = progressNoise * 0.4;\n    float progress = -progressOffset + uProgress * speed;\n    progress = quarticOut(clamp(progress, 0.0, 1.0));\n\n    vProgress = progress;\n\n    mvPosition.y += (targetHeight + floatOffset) * progress * animate;\n\n    mvPosition = modelViewMatrix * mvPosition;\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",Gn="#define GLSLIFY 1\n#define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n\n// #include <lights_pars_begin>\n\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvarying float vProgress;\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n    // normal is assumed to have unit length\n\n    float x = normal.x, y = normal.y, z = normal.z;\n\n    // band 0\n    vec3 result = shCoefficients[ 0 ] * 0.886227;\n\n    // band 1\n    result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n    result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n    result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n    // band 2\n    result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n    result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n    result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n    result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n    result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n    return result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n    vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n    vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n    return irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n    vec3 irradiance = ambientLightColor;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n        irradiance *= PI;\n\n    #endif\n\n    return irradiance;\n\n}\n\n// #if NUM_DIR_LIGHTS > 0\n\n    struct DirectionalLight {\n        vec3 direction;\n        vec3 color;\n    };\n\n    uniform DirectionalLight uDirectionalLights[ 1 ];\n\n    void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n        directLight.color = directionalLight.color * vProgress;\n        directLight.direction = directionalLight.direction;\n        directLight.visible = true;\n\n    }\n\n// #endif\n\n#if NUM_POINT_LIGHTS > 0\n\n    struct PointLight {\n        vec3 position;\n        vec3 color;\n        float distance;\n        float decay;\n    };\n\n    uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n    // directLight is an out parameter as having it as a return value caused compiler errors on some devices\n    void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n        vec3 lVector = pointLight.position - geometry.position;\n        directLight.direction = normalize( lVector );\n\n        float lightDistance = length( lVector );\n\n        directLight.color = pointLight.color;\n        directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n        directLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n    }\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n    struct SpotLight {\n        vec3 position;\n        vec3 direction;\n        vec3 color;\n        float distance;\n        float decay;\n        float coneCos;\n        float penumbraCos;\n    };\n\n    uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n    // directLight is an out parameter as having it as a return value caused compiler errors on some devices\n    void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n        vec3 lVector = spotLight.position - geometry.position;\n        directLight.direction = normalize( lVector );\n\n        float lightDistance = length( lVector );\n        float angleCos = dot( directLight.direction, spotLight.direction );\n\n        if ( angleCos > spotLight.coneCos ) {\n\n            float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n            directLight.color = spotLight.color;\n            directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n            directLight.visible = true;\n\n        } else {\n\n            directLight.color = vec3( 0.0 );\n            directLight.visible = false;\n\n        }\n    }\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n    struct HemisphereLight {\n        vec3 direction;\n        vec3 skyColor;\n        vec3 groundColor;\n    };\n\n    uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n    vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n        float dotNL = dot( geometry.normal, hemiLight.direction );\n        float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n        vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n        #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n            irradiance *= PI;\n\n        #endif\n\n        return irradiance;\n\n    }\n\n#endif\n\nstruct PhysicalMaterial {\n\n    vec3 diffuseColor;\n    float specularRoughness;\n    vec3 specularColor;\n\n#ifdef CLEARCOAT\n    float clearcoat;\n    float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    vec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n    return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n    vec3 irradiance = dotNL * directLight.color;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n        irradiance *= PI; // punctual light\n\n    #endif\n\n    #ifdef CLEARCOAT\n\n        float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n        vec3 ccIrradiance = ccDotNL * directLight.color;\n\n        #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n            ccIrradiance *= PI; // punctual light\n\n        #endif\n\n        float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n        reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n    #else\n\n        float clearcoatDHR = 0.0;\n\n    #endif\n\n    #ifdef USE_SHEEN\n        reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n            material.specularRoughness,\n            directLight.direction,\n            geometry,\n            material.sheenColor\n        );\n    #else\n        reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n    #endif\n\n    reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n    #ifdef CLEARCOAT\n\n        float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n        reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n        float ccDotNL = ccDotNV;\n        float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n    #else\n\n        float clearcoatDHR = 0.0;\n\n    #endif\n\n    float clearcoatInv = 1.0 - clearcoatDHR;\n\n    // Both indirect specular and indirect diffuse light accumulate here\n\n    vec3 singleScattering = vec3( 0.0 );\n    vec3 multiScattering = vec3( 0.0 );\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n    BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n    vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n    reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n    return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform float uIsFloating;\n\nvarying float vAnimate;\n\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n    #include <transmission_fragment>\n    #include <lights_physical_fragment>\n\n    // #include <lights_fragment_begin>\n\n    /**\n    * This is a template that can be used to light a material, it uses pluggable\n    * RenderEquations (RE)for specific lighting scenarios.\n    *\n    * Instructions for use:\n    * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n    * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n    * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n    *\n    * TODO:\n    * - Add area light support.\n    * - Add sphere light support.\n    * - Add diffuse light probe (irradiance cubemap) support.\n    */\n\n    GeometricContext geometry;\n\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    #ifdef CLEARCOAT\n\n        geometry.clearcoatNormal = clearcoatNormal;\n\n    #endif\n\n    IncidentLight directLight;\n\n    #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        PointLight pointLight;\n        #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n        PointLightShadow pointLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n            pointLight = pointLights[ i ];\n\n            getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n            pointLightShadow = pointLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        SpotLight spotLight;\n        #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n        SpotLightShadow spotLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n            spotLight = spotLights[ i ];\n\n            getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n            spotLightShadow = spotLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    // #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n    if (vAnimate > 0.0) {\n\n        DirectionalLight directionalLight;\n        // #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n        // DirectionalLightShadow directionalLightShadow;\n        // #endif\n\n        for ( int i = 0; i < 1; i ++ ) {\n\n            directionalLight = uDirectionalLights[ i ];\n\n            getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n            // #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n            // directionalLightShadow = directionalLightShadows[ i ];\n            // directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            // #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n\n    // #endif\n\n    }\n\n    #if defined( RE_IndirectDiffuse )\n\n        vec3 iblIrradiance = vec3( 0.0 );\n\n        vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n        irradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n        #if ( NUM_HEMI_LIGHTS > 0 )\n\n            #pragma unroll_loop_start\n            for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n                irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n            }\n            #pragma unroll_loop_end\n\n        #endif\n\n    #endif\n\n    #if defined( RE_IndirectSpecular )\n\n        vec3 radiance = vec3( 0.0 );\n        vec3 clearcoatRadiance = vec3( 0.0 );\n\n    #endif\n\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n    if (uIsFloating > 0.0) {\n        gl_FragColor.a *= pow(gl_FragCoord.z, 2.0);\n    }\n}\n";function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Vn=function(e){Object(d.a)(n,e);var t=Hn(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.normalmap,{map:{value:r.map},diffuse:{value:r.color||new o.Color(16777215)},emissive:{value:r.emissive||new o.Color(0)},roughness:{value:r.roughness||1},metalness:{value:0},normalMap:{value:r.normalMap},uTime:{value:0},uProgress:{value:0},uRotationSpeed:{value:r.rotationSpeed},uRotationAngle:{value:0},uIsFloating:{value:0},uDirectionalLights:{value:[{direction:new o.Vector3(0,-1,0),color:new o.Color}]}}]),e.defines.TANGENTSPACE_NORMALMAP="",e.lights=!1,e.map=r.map,e.normalMap=r.normalMap,e.vertexShader=zn,e.fragmentShader=Gn,e.extensions={derivatives:!0},e.type="ScatteredRocksMaterial",e._glowColor=r.glowColor,e._glowStrength=r.glowStrength,e._updateDirectionalLight(),e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"glowColor",get:function(){return this._glowColor},set:function(e){this._glowColor=e,this._updateDirectionalLight()}},{key:"glowStrength",get:function(){return this._glowStrength},set:function(e){this._glowStrength=e,this._updateDirectionalLight()}},{key:"updateColor",value:function(){this._updateDirectionalLight()}},{key:"_updateDirectionalLight",value:function(){this.uniforms.uDirectionalLights.value[0].color.copy(this._glowColor).multiplyScalar(this._glowStrength)}}]),n}(Q),Wn="#define GLSLIFY 1\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float rockIndex;\n\nuniform float uTime;\nuniform float uProgress;\nuniform float uRotationAngle;\n\nvec4 quatFromAxisAngle(vec3 axis, float angle) {\n    vec4 qr;\n    float half_angle = (angle * 0.5) * PI;\n    qr.x = axis.x * sin(half_angle);\n    qr.y = axis.y * sin(half_angle);\n    qr.z = axis.z * sin(half_angle);\n    qr.w = cos(half_angle);\n    return qr;\n}\n\nvec3 rotateVertexPosition(vec3 position, vec3 axis, float angle){\n    vec4 q = quatFromAxisAngle(axis, angle);\n    vec3 v = position.xyz;\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\nvoid main() {\n\n    #include <uv_vertex>\n\n    #include <skinbase_vertex>\n\n    #ifdef USE_DISPLACEMENTMAP\n\n        #include <beginnormal_vertex>\n        #include <morphnormal_vertex>\n        #include <skinnormal_vertex>\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    // Rotation\n    vec3 rotationAxis = vec3(1.0, 0.0, 0.0);\n    transformed = rotateVertexPosition(transformed, rotationAxis, uRotationAngle);\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    #ifdef USE_INSTANCING\n\n        mvPosition = instanceMatrix * mvPosition;\n\n    #endif\n\n    float noise = hash11(rockIndex);\n    float timeOffset = noise * 100.0;\n    mvPosition.y += (20.0 + 350.0 * noise + sin(uTime + timeOffset) * 10.0) * uProgress;\n\n    mvPosition = modelViewMatrix * mvPosition;\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <worldpos_vertex>\n    #include <clipping_planes_vertex>\n\n    vWorldPosition = worldPosition.xyz;\n\n}\n",$n="#define GLSLIFY 1\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( 1.0 );\n\n    #include <map_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n\n    float dist = length( vWorldPosition - referencePosition );\n    dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n    dist = saturate( dist ); // clamp to [ 0, 1 ]\n\n    gl_FragColor = packDepthToRGBA( dist );\n\n}\n";function qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}o.ShaderMaterial;var Yn="#define GLSLIFY 1\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float rockIndex;\nattribute float speed;\n\nuniform float uTime;\nuniform float uProgress;\nuniform float uRotationAngle;\n\nvarying float vAnimate;\nvarying float vProgress;\n\nvec4 quatFromAxisAngle(vec3 axis, float angle) {\n    vec4 qr;\n    float half_angle = (angle * 0.5) * PI;\n    qr.x = axis.x * sin(half_angle);\n    qr.y = axis.y * sin(half_angle);\n    qr.z = axis.z * sin(half_angle);\n    qr.w = cos(half_angle);\n    return qr;\n}\n\nvec3 rotateVertexPosition(vec3 position, vec3 axis, float angle){\n    vec4 q = quatFromAxisAngle(axis, angle);\n    vec3 v = position.xyz;\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\n// #pragma glslify: ease = require(glsl-easings/cubic-out)\nfloat quarticOut(float t) {\n  return pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n\n    // Noise\n    float noise = hash11(rockIndex * 1000.);\n\n    // Animate\n    float animate = noise > 0.8 ? 1.0 : 0.0;\n    vAnimate = animate;\n\n    // Rotation\n    vec3 rotationAxis = vec3(1.0, 0.0, 0.0);\n\n    vec3 transformedNormal = objectNormal;\n\n    // Normal map rotation\n    transformedNormal = rotateVertexPosition(transformedNormal, rotationAxis, uRotationAngle * animate);\n\n    #ifdef USE_INSTANCING\n\n        // this is in lieu of a per-instance normal-matrix\n        // shear transforms in the instance matrix are not supported\n\n        mat3 m = mat3( instanceMatrix );\n\n        transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n        transformedNormal = m * transformedNormal;\n\n    #endif\n\n    transformedNormal = normalMatrix * transformedNormal;\n\n    #ifdef FLIP_SIDED\n\n        transformedNormal = - transformedNormal;\n\n    #endif\n\n    #ifdef USE_TANGENT\n\n        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n        #ifdef FLIP_SIDED\n\n            transformedTangent = - transformedTangent;\n\n        #endif\n\n    #endif\n\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n        #ifdef USE_TANGENT\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        #endif\n    #endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    // Rotation\n    transformed = rotateVertexPosition(transformed, rotationAxis, uRotationAngle * animate);\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    #ifdef USE_INSTANCING\n\n        mvPosition = instanceMatrix * mvPosition;\n\n    #endif\n\n    // Float\n    float heightNoise = hash11(rockIndex + 1234.0);\n    float targetHeight = 20.0 + 300.0 * heightNoise;\n    float floatOffset = sin(uTime + heightNoise * 100.0) * 10.0;\n\n    float progressNoise = hash11(rockIndex + 1337.0 * 1000.);\n    float progressOffset = progressNoise * 0.4;\n    float progress = -progressOffset + uProgress * speed;\n    progress = quarticOut(clamp(progress, 0.0, 1.0));\n\n    vProgress = progress;\n\n    mvPosition.y += (targetHeight + floatOffset) * progress * animate;\n\n    mvPosition = modelViewMatrix * mvPosition;\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",Xn="#define GLSLIFY 1\n#define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n\n// #include <lights_pars_begin>\n\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvarying float vProgress;\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n    // normal is assumed to have unit length\n\n    float x = normal.x, y = normal.y, z = normal.z;\n\n    // band 0\n    vec3 result = shCoefficients[ 0 ] * 0.886227;\n\n    // band 1\n    result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n    result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n    result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n    // band 2\n    result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n    result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n    result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n    result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n    result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n    return result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n    vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n    vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n    return irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n    vec3 irradiance = ambientLightColor;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n        irradiance *= PI;\n\n    #endif\n\n    return irradiance;\n\n}\n\n// #if NUM_DIR_LIGHTS > 0\n\n    struct DirectionalLight {\n        vec3 direction;\n        vec3 color;\n    };\n\n    uniform DirectionalLight uDirectionalLights[ 1 ];\n\n    void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n        directLight.color = directionalLight.color * vProgress;\n        directLight.direction = directionalLight.direction;\n        directLight.visible = true;\n\n    }\n\n// #endif\n\n#if NUM_POINT_LIGHTS > 0\n\n    struct PointLight {\n        vec3 position;\n        vec3 color;\n        float distance;\n        float decay;\n    };\n\n    uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n    // directLight is an out parameter as having it as a return value caused compiler errors on some devices\n    void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n        vec3 lVector = pointLight.position - geometry.position;\n        directLight.direction = normalize( lVector );\n\n        float lightDistance = length( lVector );\n\n        directLight.color = pointLight.color;\n        directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n        directLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n    }\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n    struct SpotLight {\n        vec3 position;\n        vec3 direction;\n        vec3 color;\n        float distance;\n        float decay;\n        float coneCos;\n        float penumbraCos;\n    };\n\n    uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n    // directLight is an out parameter as having it as a return value caused compiler errors on some devices\n    void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n        vec3 lVector = spotLight.position - geometry.position;\n        directLight.direction = normalize( lVector );\n\n        float lightDistance = length( lVector );\n        float angleCos = dot( directLight.direction, spotLight.direction );\n\n        if ( angleCos > spotLight.coneCos ) {\n\n            float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n            directLight.color = spotLight.color;\n            directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n            directLight.visible = true;\n\n        } else {\n\n            directLight.color = vec3( 0.0 );\n            directLight.visible = false;\n\n        }\n    }\n\n#endif\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n    struct RectAreaLight {\n        vec3 color;\n        vec3 position;\n        vec3 halfWidth;\n        vec3 halfHeight;\n    };\n\n    // Pre-computed values of LinearTransformedCosine approximation of BRDF\n    // BRDF approximation Texture is 64x64\n    uniform sampler2D ltc_1; // RGBA Float\n    uniform sampler2D ltc_2; // RGBA Float\n\n    uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n    struct HemisphereLight {\n        vec3 direction;\n        vec3 skyColor;\n        vec3 groundColor;\n    };\n\n    uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n    vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n        float dotNL = dot( geometry.normal, hemiLight.direction );\n        float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n        vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n        #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n            irradiance *= PI;\n\n        #endif\n\n        return irradiance;\n\n    }\n\n#endif\n\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform float uIsFloating;\n\nvarying float vAnimate;\n\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n    #include <transmission_fragment>\n    #include <lights_physical_fragment>\n\n    // #include <lights_fragment_begin>\n\n    /**\n    * This is a template that can be used to light a material, it uses pluggable\n    * RenderEquations (RE)for specific lighting scenarios.\n    *\n    * Instructions for use:\n    * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n    * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n    * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n    *\n    * TODO:\n    * - Add area light support.\n    * - Add sphere light support.\n    * - Add diffuse light probe (irradiance cubemap) support.\n    */\n\n    GeometricContext geometry;\n\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    #ifdef CLEARCOAT\n\n        geometry.clearcoatNormal = clearcoatNormal;\n\n    #endif\n\n    IncidentLight directLight;\n\n    #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        PointLight pointLight;\n        #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n        PointLightShadow pointLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n            pointLight = pointLights[ i ];\n\n            getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n            pointLightShadow = pointLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        SpotLight spotLight;\n        #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n        SpotLightShadow spotLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n            spotLight = spotLights[ i ];\n\n            getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n            spotLightShadow = spotLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    // #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n    if (vAnimate > 0.0) {\n\n        DirectionalLight directionalLight;\n        // #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n        // DirectionalLightShadow directionalLightShadow;\n        // #endif\n\n        for ( int i = 0; i < 1; i ++ ) {\n\n            directionalLight = uDirectionalLights[ i ];\n\n            getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n            // #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n            // directionalLightShadow = directionalLightShadows[ i ];\n            // directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            // #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n\n    // #endif\n\n    }\n\n    #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n        RectAreaLight rectAreaLight;\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n            rectAreaLight = rectAreaLights[ i ];\n            RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if defined( RE_IndirectDiffuse )\n\n        vec3 iblIrradiance = vec3( 0.0 );\n\n        vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n        irradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n        #if ( NUM_HEMI_LIGHTS > 0 )\n\n            #pragma unroll_loop_start\n            for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n                irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n            }\n            #pragma unroll_loop_end\n\n        #endif\n\n    #endif\n\n    #if defined( RE_IndirectSpecular )\n\n        vec3 radiance = vec3( 0.0 );\n        vec3 clearcoatRadiance = vec3( 0.0 );\n\n    #endif\n\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    // #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n    if (uIsFloating > 0.0) {\n        gl_FragColor.a *= pow(gl_FragCoord.z, 2.0);\n    }\n}\n";function Kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Qn=function(e){Object(d.a)(n,e);var t=Kn(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.normalmap,{map:{value:r.map},diffuse:{value:r.color||new o.Color(16777215)},emissive:{value:r.emissive||new o.Color(0)},roughness:{value:r.roughness||1},metalness:{value:0},normalMap:{value:r.normalMap},uTime:{value:0},uProgress:{value:0},uRotationSpeed:{value:r.rotationSpeed},uRotationAngle:{value:0},uIsFloating:{value:0},uDirectionalLights:{value:[{direction:new o.Vector3(0,-1,0),color:new o.Color}]}}]),e.defines.TANGENTSPACE_NORMALMAP="",e.lights=!1,e.map=r.map,e.normalMap=r.normalMap,e.vertexShader=Yn,e.fragmentShader=Xn,e.extensions={derivatives:!0},e._glowColor=r.glowColor,e._glowStrength=r.glowStrength,e.type="ScatteredRocksBloomMaterial",e.instancing=!0,e._updateDirectionalLight(),e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"glowColor",get:function(){return this._glowColor},set:function(e){this._glowColor=e,this._updateDirectionalLight()}},{key:"glowStrength",get:function(){return this._glowStrength},set:function(e){this._glowStrength=e,this._updateDirectionalLight()}},{key:"updateColor",value:function(){this._updateDirectionalLight()}},{key:"_updateDirectionalLight",value:function(){this.uniforms.uDirectionalLights.value[0].color.copy(this._glowColor).multiplyScalar(this._glowStrength)}}]),n}(Q);function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Jn=function(e){Object(d.a)(n,e);var t=Zn(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debug=e.debug,this._fog=e.fog,this._rotationSpeed=.5,this._progress=0,this._startProgress=!1,this._gltf=y.b.get("cave/model"),this._mesh=this._createMesh(),this._bloomDummy=this._createBloomDummy()}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._mesh.material.map.dispose(),this._mesh.material.normalMap.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"bloomDummy",get:function(){return this._bloomDummy}},{key:"startFloat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.set(this._mesh.userData,{renderBloom:!0},0),t.set(this,{_startProgress:!0},0),t.to(this._mesh.material.uniforms.uIsFloating,{duration:1,value:1},0),e&&t.timeScale(10),t}},{key:"stopFloat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.set(this,{_startProgress:!1},0),t.to(this._mesh.material.uniforms.uIsFloating,{duration:1,value:0},0),t.set(this._mesh.userData,{renderBloom:!1},.5),e&&t.timeScale(10),t}},{key:"resetFloat",value:function(){this._startProgress=!1,this._mesh.material.uniforms.uIsFloating.value=0,this._mesh.userData.renderBloom=!1}},{key:"addTextures",value:function(){var e=y.b.get("cave/tunnel/rock-small/albedo-map");e.encoding=o.LinearEncoding;var t=y.b.get("cave/tunnel/rock-small/normal-map");t.encoding=o.LinearEncoding,this._mesh.material.uniforms.map.value=e,this._mesh.material.uniforms.normalMap.value=t,this._mesh.userData.bloomMaterial&&(this._mesh.userData.bloomMaterial.uniforms.map.value=e,this._mesh.userData.bloomMaterial.uniforms.normalMap.value=t)}},{key:"_createMesh",value:function(){for(var e=this,t=this._gltf.scene.getObjectByName("rocks-scattered").children,n=this._gltf.scene.getObjectByName("rock-small").geometry,r=new Float32Array(1*t.length),l=new Float32Array(1*t.length),i=0;i<t.length;i++)r[i]=i,l[i]=.5+Math.random()+.5;n.setAttribute("rockIndex",new o.InstancedBufferAttribute(r,1)),n.setAttribute("speed",new o.InstancedBufferAttribute(l,1));var c=new Vn({fog:this._fog,color:new o.Color(16777215),emissive:new o.Color(0),map:new o.Texture,normalMap:new o.Texture,rotationSpeed:100,roughness:.62,transparent:!0,glowColor:new o.Color(4255209),glowStrength:5}),h=new Qn({fog:this._fog,color:new o.Color(16777215),emissive:new o.Color(0),map:new o.Texture,normalMap:new o.Texture,rotationSpeed:100,roughness:.62,transparent:!0,glowColor:new o.Color(4255209),glowStrength:5}),d=new o.InstancedMesh(n,c,t.length);d.frustumCulled=!0,d.userData.renderBloom=!0,d.userData.bloomMaterial=h;for(var f,m=new o.Box3,v=new o.Box3,_=new o.Sphere,y=0,x=t.length;y<x;y++)(f=t[y]).updateMatrix(),d.setMatrixAt(y,f.matrix),v.copy(d.geometry.boundingBox).applyMatrix4(f.matrix),m.union(v);if(m.getBoundingSphere(_),d.geometry.boundingBox=m,d.geometry.boundingSphere=_,d.geometry.needsUpdate=!0,this._debug){var w=this._debug.addGroup("Scattered rocks");w.add(d,"visible"),w.add(c,"color"),w.add(c,"emissive"),w.add(c,"roughness",{min:0,max:1}),w.add(c,"metalness",{min:0,max:1}),w.add(c,"glowColor"),w.addButton("Update color",{onClick:function(){c.updateColor()}}),w.add(c,"glowStrength"),w.add(this,"_progress",{label:"progress",min:0,max:1,onChange:function(){d.material.uniforms.uProgress.value=e._progress,h.uniforms.uProgress.value=e._progress}}),w.add(this,"_rotationSpeed",{label:"rotation speed"})}return this.add(d),d}},{key:"_createBloomDummy",value:function(){var e=new o.PlaneBufferGeometry(1,1),t=new o.InstancedMesh(e,this._mesh.userData.bloomMaterial,1);return this.add(t),t}},{key:"update",value:function(e){var t=e.delta;this._startProgress?this._mesh.material.uniforms.uProgress.value+=.0027:this._mesh.material.uniforms.uProgress.value-=.01,this._mesh.material.uniforms.uProgress.value=L.a.clamp(this._mesh.material.uniforms.uProgress.value,0,1),this._mesh.material.uniforms.uTime.value+=t,this._mesh.material.uniforms.uRotationAngle.value+=t*this._rotationSpeed*this._mesh.material.uniforms.uProgress.value,this._mesh.userData.bloomMaterial&&(this._mesh.userData.bloomMaterial.uniforms.uProgress.value=this._mesh.material.uniforms.uProgress.value,this._mesh.userData.bloomMaterial.uniforms.uTime.value=this._mesh.material.uniforms.uTime.value,this._mesh.userData.bloomMaterial.uniforms.uRotationAngle.value=this._mesh.material.uniforms.uRotationAngle.value)}}]),n}(Object(_.a)(o.Object3D));function ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ti=function(e){Object(d.a)(n,e);var t=ei(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog,n=e.amount,r=e.maxWidth,l=e.maxHeight,c=e.maxDepth,h=e.brightness,d=e.windTurbulenceFrequency,f=e.windTurbulenceAmplitude,m=e.size,v=e.color,_=e.debug;this._fog=t,this._amount=n||500,this._maxWidth=r,this._maxHeight=l,this._maxDepth=c,this._brightness=h||.33,this._windTurbulenceFrequency=d||.04,this._windTurbulenceAmplitude=f||11.84,this._size=m||5.12,this._color=v||new o.Color(4255209),this._debug=_,this._windSpeed=10,this._points=this._createPoints(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._points.material.uniforms.uTexture.value.dispose(),this._points.material.dispose(),this._points.geometry.dispose(),this._points=null}},{key:"_createPoints",value:function(){for(var e=[],t=new Float32Array(this._amount),i=0;i<this._amount;i++){var n=.5*-this._maxWidth+Math.random()*this._maxWidth,r=.5*-this._maxHeight+Math.random()*this._maxHeight,l=Math.random()*this._maxDepth;e.push(n,r,l),t[i]=i}var c=new o.BufferGeometry;c.setAttribute("position",new o.Float32BufferAttribute(e,3)),c.setAttribute("index",new o.BufferAttribute(t,1));var h=y.b.get("dust-particle");h.needsUpdate=!0;var d=P.a.dpr(),f=new Ve({fog:this._fog,texture:h,brightness:this._brightness,windTurbulenceFrequency:this._windTurbulenceFrequency,windTurbulenceAmplitude:this._windTurbulenceAmplitude,size:this._size/d,color:this._color,transparent:!0,depthWrite:!1,maxDepth:this._maxDepth,blending:o.AdditiveBlending}),m=new o.Points(c,f);if(m.position.z=-this._maxDepth,m.userData.renderBloom=!1,m.updateMatrix(),m.matrixAutoUpdate=!1,this.add(m),this._debug){var v=this._debug.addGroup("Dust");v.add(this,"visible"),v.add(f.uniforms.uColor,"value",{label:"color"}),v.add(f.uniforms.uSize,"value",{label:"size"}),v.add(f.uniforms.uWindTurbulenceFrequency,"value",{label:"wind frequency"}),v.add(f.uniforms.uWindTurbulenceAmplitude,"value",{label:"wind amplitude"}),v.add(this,"_windSpeed",{label:"wind speed"}),v.add(this,"position",{stepSize:1,listen:!0}),v.add(f.uniforms.uBrightness,"value",{label:"brightness"}),v.add(f.uniforms.uShaftBrightness,"value",{label:"shaft brightness"})}return m}},{key:"update",value:function(e){var t=e.delta;this._points.material.uniforms.uTime.value+=t*this._windSpeed}}]),n}(Object(_.a)(o.Object3D));function ni(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ii=function(e){Object(d.a)(n,e);var t=ni(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._debug=e.debug,this._color=new o.Color(4255209),this._gltf=y.b.get("cave/model"),this._beams=this._createBeams(),this.matrixAutoUpdate=!1}},{key:"show",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new v.a.timeline;return n.call((function(){for(var i=0,t=e._beams.length;i<t;i++)e._beams[i].cone.visible=!0}),null,0),n.to(this._beams[0].material.uniforms.uOpacity,{duration:1,value:3.3,ease:"sine.inOut",onUpdate:function(){for(var i=1,t=e._beams.length;i<t;i++)e._beams[i].material.uniforms.uOpacity.value=e._beams[0].material.uniforms.uOpacity.value}}),t&&n.timeScale(10),n}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new v.a.timeline;return n.to(this._beams[0].material.uniforms.uOpacity,{duration:1,value:0,ease:"sine.inOut",onUpdate:function(){for(var i=1,t=e._beams.length;i<t;i++)e._beams[i].material.uniforms.uOpacity.value=e._beams[0].material.uniforms.uOpacity.value}}),n.call((function(){for(var i=0,t=e._beams.length;i<t;i++)e._beams[i].cone.visible=!1}),null,1),t&&n.timeScale(10),n}},{key:"reset",value:function(){for(var i=0,e=this._beams.length;i<e;i++)this._beams[i].material.uniforms.uOpacity.value=0,this._beams[i].cone.visible=!1}},{key:"_createBeams",value:function(){var e,t=this,n=this._gltf.scene.getObjectByName("cave-light-beams").children;this._debug&&((e=this._debug.addGroup("Light beams")).addButton("Show",{fullWidth:!0,onClick:function(){return t.show()}}),e.addButton("Hide",{fullWidth:!0,onClick:function(){return t.hide()}}));for(var r,l,c,h,d,f=[],i=0,m=n.length;i<m;i++){(l=n[i].clone(!0)).updateMatrix(),l.matrixAutoUpdate=!1,r={};var v=new _t({color:this._color,transparent:!0,blending:o.AdditiveBlending});if(v.uniforms.uOpacity.value=0,v.uniforms.uRimWidth.value=4.46,v.uniforms.uRimStrength.value=1.05,v.depthWrite=!1,(c=l.children[2]).visible=!1,c.material=v,c.userData.renderBloom=!1,c.updateMatrix(),c.matrixAutoUpdate=!1,h=l.children[1].removeFromParent(),d=l.children[0].removeFromParent(),r.material=v,r.cone=c,r.spotLight=h,r.pointLight=d,f.push(r),this.add(l),e){var _=e.addGroup("Item ".concat(i+1)).addGroup("Material");_.add(v.uniforms.uColor,"value",{label:"color"}),_.add(v.uniforms.uRimWidth,"value",{label:"rimWidth"}),_.add(v.uniforms.uRimStrength,"value",{label:"rimStrength"}),_.add(v.uniforms.uOpacity,"value",{label:"opacity"})}}return f}}]),n}(Object(_.a)(o.Object3D)),ri="#define GLSLIFY 1\n#define PHONG\n\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    #include <worldpos_vertex>\n    #include <envmap_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n}\n",ai="#define GLSLIFY 1\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform vec3 customAmbientLightColor;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <specularmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <emissivemap_fragment>\n    #include <lights_phong_fragment>\n\n    /**\n    * This is a template that can be used to light a material, it uses pluggable\n    * RenderEquations (RE)for specific lighting scenarios.\n    *\n    * Instructions for use:\n    * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n    * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n    * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n    *\n    * TODO:\n    * - Add area light support.\n    * - Add sphere light support.\n    * - Add diffuse light probe (irradiance cubemap) support.\n    */\n\n    GeometricContext geometry;\n\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    #ifdef CLEARCOAT\n\n        geometry.clearcoatNormal = clearcoatNormal;\n\n    #endif\n\n    IncidentLight directLight;\n\n    #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        PointLight pointLight;\n        #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n        PointLightShadow pointLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n            pointLight = pointLights[ i ];\n\n            getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n            pointLightShadow = pointLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n        SpotLight spotLight;\n        #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n        SpotLightShadow spotLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n            spotLight = spotLights[ i ];\n\n            getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n            spotLightShadow = spotLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n        DirectionalLight directionalLight;\n        #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n        DirectionalLightShadow directionalLightShadow;\n        #endif\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n            directionalLight = directionalLights[ i ];\n\n            getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n            directionalLightShadow = directionalLightShadows[ i ];\n            directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            #endif\n\n            RE_Direct( directLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n        RectAreaLight rectAreaLight;\n\n        #pragma unroll_loop_start\n        for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n            rectAreaLight = rectAreaLights[ i ];\n            RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n        }\n        #pragma unroll_loop_end\n\n    #endif\n\n    #if defined( RE_IndirectDiffuse )\n\n        vec3 iblIrradiance = vec3( 0.0 );\n\n        // vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n        vec3 irradiance = getAmbientLightIrradiance( customAmbientLightColor );\n\n        irradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n        #if ( NUM_HEMI_LIGHTS > 0 )\n\n            #pragma unroll_loop_start\n            for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n                irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n            }\n            #pragma unroll_loop_end\n\n        #endif\n\n    #endif\n\n    #if defined( RE_IndirectSpecular )\n\n        vec3 radiance = vec3( 0.0 );\n        vec3 clearcoatRadiance = vec3( 0.0 );\n\n    #endif\n\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    #include <envmap_fragment>\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}\n";function oi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var si=function(e){Object(d.a)(n,e);var t=oi(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,{emissive:{value:new o.Color(r.emissive||0)},customAmbientLightColor:{value:new o.Vector3(.0872,.1315,.1224)}}]),e.name=r.name||null,r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.aoMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.aomap]),e.aoMap=r.aoMap),e.map&&(e.uniforms.map.value=r.map),r.normalMap&&(e.normalMap=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),e.aoMap&&(e.uniforms.aoMap.value=r.aoMap),e.lights=!1,e.vertexShader=ri,e.fragmentShader=ai,e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"map",get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value}},{key:"normalMap",get:function(){return this.uniforms.normalMap?this.uniforms.normalMap.value:null},set:function(e){this.normalMap||(this.uniforms=o.UniformsUtils.merge([this.uniforms,o.UniformsLib.normalmap]),this.defines.TANGENTSPACE_NORMALMAP=""),this.uniforms.normalMap.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"repeat",value:function(e,t){var n=new o.Texture;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix),this.uniforms.uv2Transform.value.copy(n.matrix))}}]),n}(Q);function ui(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ci=function(e){Object(d.a)(n,e);var t=ui(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fog=e.fog,this._decalsColor=new o.Color(4255209),this._scatteredRocksGlowVisible=!1,this._gltf=y.b.get("cave/model"),this._debug=this._createDebug(),this._floor=this._createFloor(),this._rockGate=this._createRockGate(),this._rocksBig=this._createRocksBig(),this._rocksScattered=this._createRocksScattered(),this._decals=this._createDecals(),this._dust=this._createDust(),this._lightBeams=this._createLightBeams(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyFloor(),this._destroyRockGate(),this._destroyRocksBig(),this._rocksScattered.destroy(),this._decals.destroy(),this._dust.destroy()}},{key:"decals",get:function(){return this._decals}},{key:"rocksScattered",get:function(){return this._rocksScattered}},{key:"lightBeams",get:function(){return this._lightBeams}},{key:"addAssets",value:function(){this._addTexturesToFloor(),this._addTexturesToRockGate(),this._addTexturesToRocksBig(),this._rocksScattered.addTextures(),this._decals.addTextures()}},{key:"_createFloor",value:function(){var e=this._gltf.scene.getObjectByName("floor").clone(),t=e.geometry,n=new si({fog:this._fog,map:new o.Texture,normalMap:new o.Texture});n.repeat(5,5);var r=new o.Mesh(t,n);if(r.receiveShadow=!0,r.position.copy(e.position),r.updateMatrix(),r.matrixAutoUpdate=!1,this.add(r),this._debug){var l=this._debug.addGroup("Foor");l.add(r,"visible"),l.add(n,"emissive")}return r}},{key:"_addTexturesToFloor",value:function(){var e=y.b.get("cave/tunnel/floor/albedo-map");e.wrapS=e.wrapT=o.RepeatWrapping,e.encoding=o.LinearEncoding;var t=y.b.get("cave/tunnel/floor/normal-map");t.wrapS=t.wrapT=o.RepeatWrapping,t.encoding=o.LinearEncoding,this._floor.material.map=e,this._floor.material.normalMap=t}},{key:"_destroyFloor",value:function(){this._floor.material.map.dispose(),this._floor.material.normalMap.dispose(),this._floor.material.dispose(),this._floor.geometry.dispose(),this._floor=null}},{key:"_createRockGate",value:function(){var e=this._gltf.scene.getObjectByName("rock-gate").clone();(e.material=new si({fog:this._fog,map:new o.Texture,normalMap:new o.Texture}),e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),this._debug)&&this._debug.addGroup("Rock gate").add(e,"visible");return e}},{key:"_addTexturesToRockGate",value:function(){var e=y.b.get("cave/tunnel/gate/albedo-map");e.encoding=o.LinearEncoding;var t=y.b.get("cave/tunnel/gate/normal-map");t.encoding=o.LinearEncoding,this._rockGate.material.map=e,this._rockGate.material.normalMap=t}},{key:"_destroyRockGate",value:function(){this._rockGate.material.map.dispose(),this._rockGate.material.normalMap.dispose(),this._rockGate.material.dispose(),this._rockGate.geometry.dispose(),this._rockGate=null}},{key:"_createRocksBig",value:function(){var e=this._gltf.scene.getObjectByName("rocks-big").children,t=e[0].geometry,n=new cn({fog:this._fog,color:new o.Color(0)}),r=new o.InstancedMesh(t,n,e.length);r.frustumCulled=!0,r.matrixAutoUpdate=!1;for(var l,c=new o.Box3,h=new o.Box3,d=new o.Sphere,i=0,f=e.length;i<f;i++)(l=e[i]).updateMatrix(),r.setMatrixAt(i,l.matrix),h.copy(r.geometry.boundingBox).applyMatrix4(l.matrix),c.union(h);(c.getBoundingSphere(d),r.geometry.boundingBox=c,r.geometry.boundingSphere=d,r.geometry.needsUpdate=!0,this._debug)&&this._debug.addGroup("Rocks big").add(r,"visible");return this.add(r),r}},{key:"_addTexturesToRocksBig",value:function(){}},{key:"_destroyRocksBig",value:function(){this._rocksBig.material.dispose(),this._rocksBig.geometry.dispose(),this._rocksBig=null}},{key:"_createRocksScattered",value:function(){var e=new Jn({debug:this._debug,fog:this._fog});return this.add(e),e}},{key:"_createLights",value:function(){return this._debug&&this._debug.addGroup("Lights"),{}}},{key:"_createDecals",value:function(){var e=new Nn({gltf:this._gltf,nameMesh:"cave-decals-mesh",nameLights:"cave-decals-lights",debug:this._debug,intensity:1.16,distance:147});return this.add(e),e}},{key:"_toggleFloatingRocks",value:function(){var e;this._scatteredRocksGlowVisible=!this._scatteredRocksGlowVisible,null===(e=this._timelineFloatingRocksToggle)||void 0===e||e.kill(),this._timelineFloatingRocksToggle=new v.a.timeline,this._scatteredRocksGlowVisible?(this._timelineFloatingRocksToggle.to(this._lights.pointLight,{duration:1,intensity:0},0),this._timelineFloatingRocksToggle.add(this._rocksScattered.startFloat(),0)):(this._timelineFloatingRocksToggle.to(this._lights.pointLight,{duration:1,intensity:.1}),this._timelineFloatingRocksToggle.add(this._rocksScattered.stopFloat(),0))}},{key:"_createDust",value:function(){var e=new ti({fog:this._fog,maxWidth:1700,maxHeight:950,maxDepth:5500,debug:this._debug});return e.position.set(0,295,55),this.add(e),e}},{key:"_createLightBeams",value:function(){var e=new ii({fog:this._fog,debug:this._debug});return this.add(e),e}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._spotLightHelper&&this._spotLightHelper.update(),this._decals&&this._decals.update({time:time,delta:t}),this._rocksScattered&&this._rocksScattered.update({time:time,delta:t}),this._dust&&this._dust.update({time:time,delta:t})}},{key:"onCameraChange",value:function(e){e.type}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Cave",{container:"Cave"});return t.add(this,"visible"),t.addButton("Toggle floating rocks",{fullWidth:!0,onClick:function(){e._toggleFloatingRocks()}}),t}}}]),n}(Object(_.a)(o.Object3D)),hi=n(211),di="#define GLSLIFY 1\n// Attribues\nattribute float beamIndex;\n\n// Varyings\nvarying vec2 vUv;\nvarying float vInstanceId;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n    vInstanceId = beamIndex;\n\n    // Output\n    vec4 mvPosition = modelViewMatrix * instanceMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n",fi="#define GLSLIFY 1\n// Uniforms\nuniform sampler2D uTexture;\nuniform vec3 uColor;\nuniform float uOpacity;\nuniform float uTime;\n\n// Varyings\nvarying vec2 vUv;\nvarying float vInstanceId;\n\n// Includes\n#include <custom_fog_pars_fragment>\n\n// Partials\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\nvoid main() {\n    // Color\n    vec4 textureSample = texture2D(uTexture, vUv);\n    vec3 color = uColor * textureSample.r;\n\n    // Alpha\n    vec2 maskUv = vUv;\n    maskUv.x += hash11(vInstanceId) * 5.0;;\n    float alpha = (0.4 + texture2D(uTexture, maskUv).g * 0.6);\n    alpha *= 0.3 + ((1.0 + sin(uTime + hash11(vInstanceId) * 5.0)) * 0.5) * 1.;\n    alpha *= uOpacity;\n\n    // Fog\n    float fogStrength = 1.0;\n\n    #if defined(USE_CUSTOM_FOG)\n\n        #if defined(FOG_GROUND) || defined(FOG_COMBINED) || defined(FOG_USE_SUN)\n            vec3 fogRayDirection = normalize(vFogWorldPosition - cameraPosition);\n        #endif\n\n        vec3 fogColor = fogColor;\n\n        #if defined(FOG_EXP)\n            float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n        #elif defined(FOG_EXP2)\n            float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n        #elif defined(FOG_LINEAR)\n            float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n        #elif defined(FOG_GROUND)\n            float fogGroundDepth = distance(vFogWorldPosition.rgb, cameraPosition);\n\n            // float fogFactor = clamp(exp((-cameraPosition.y*fogHeight)*fogDensity) * (1.0-exp(-fogGroundDepth*fogRayDirection.y*fogHeight*fogDensity))/(fogRayDirection.y*fogHeight), 0.0, 1.0);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vFogWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n        #elif defined(FOG_COMBINED)\n            float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n            float fogGroundDepth = distance(vFogWorldPosition.rgb, cameraPosition);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vFogWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n            float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n        #endif\n\n        #if defined(FOG_USE_SUN)\n            vec3 sunDirection = normalize(sunPosition - cameraPosition);\n            float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n            fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n        #endif\n\n        #if defined(FOG_RAVINE_LIGHT)\n            float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vFogWorldPosition.y, 0.0));\n            float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n            fogColor = mix(fogColor, ravineLightColor, ravineLightStrength);\n        #endif\n\n        #if defined(FOG_SIDES)\n            fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vFogWorldPosition.x));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n        #endif\n\n        fogStrength = 1.0 - (fogFactor * fogActive);\n\n    #endif\n\n    // Output\n    gl_FragColor.rgb = color;\n    gl_FragColor.a = alpha * pow(gl_FragCoord.z, 10.0) * fogStrength;\n\n}\n";function mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var pi=function(e){Object(d.a)(n,e);var t=mi(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,{uTexture:{value:r.texture},uColor:{value:r.color},uOpacity:{value:r.opacity},uTime:{value:0}}]),e.vertexShader=di,e.fragmentShader=fi,e}return n}(Q),gi="#define GLSLIFY 1\n#include <custom_fog_pars_vertex>\n\nattribute vec3 center;\nattribute vec3 axis;\n\nuniform float uProgress;\nuniform float uTime;\n\nvarying vec2 vUv;\n\nmat4 rotationMatrix(vec3 axis, float angle) {\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n\n    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                0.0,                                0.0,                                0.0,                                1.0);\n}\n\nvec3 rotate(vec3 v, vec3 axis, float angle) {\n  mat4 m = rotationMatrix(axis, angle);\n  return (m * vec4(v, 1.0)).xyz;\n}\n\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\nfloat hash12(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * .1031);\n    p3 += dot(p3, p3.yzx + 33.33);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvoid main() {\n    // Noise\n    float noise = hash12(vec2(center.x, center.z) * 7331.);\n    float noise2 = hash12(vec2(center.x, center.z) * 1337.);\n    float timeOffset = hash12(vec2(center.x, center.z));\n\n    vec3 transformed = position;\n    if (noise2 > 0.2) {\n        transformed = rotate(transformed - center, vec3(1.0, 0.0, 0.0), sin(uTime * 0.5 + timeOffset * 13.0) * 0.1 * uProgress) + center;\n        transformed = rotate(transformed - center, vec3(0.0, 1.0, 0.0), sin(uTime * 0.5 + timeOffset * 33.0) * 0.1 * uProgress) + center;\n        transformed = rotate(transformed - center, vec3(0.0, 1.0, 1.0), sin(uTime * 0.5 + timeOffset * 03.0) * 0.1 * uProgress) + center;\n        transformed.y += (120.0 * noise + sin(uTime + timeOffset * 13.0) * 15.0) * uProgress;\n        // transformed = rotate(transformed - center, axis, 0.5 * uProgress) + center;\n    }\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    mvPosition = modelViewMatrix * mvPosition;\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <custom_fog_vertex>\n\n    vUv = uv;\n}\n",vi="#define GLSLIFY 1\nuniform sampler2D uMap;\nuniform vec3 uColor;\n\nvarying vec2 vUv;\n\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    vec4 color = sRGBToLinear(texture2D(uMap, vUv));\n    color.rgb *= uColor;\n    gl_FragColor = color;\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <custom_fog_fragment>\n}\n";function _i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var yi=function(e){Object(d.a)(n,e);var t=_i(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,{uColor:{value:new o.Color(r.color)},uMap:{value:null},uProgress:{value:0},uTime:{value:0}}]),e.vertexShader=gi,e.fragmentShader=vi,e}return n}(Q);function bi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var xi=function(e){Object(d.a)(n,e);var t=bi(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).map=e.map,r.uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common,{uCeilingFogColor:{value:new o.Color(0)},uCeilingFog:{value:new o.Vector2(3357,6292)}}]),e.color&&(r.uniforms.diffuse.value=new o.Color(e.color||16777215)),e.map&&(r.uniforms.map.value=e.map,r.map=e.map),r.vertexShader="#define GLSLIFY 1\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvarying vec4 vCustomWorldPosition;\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n    #include <skinbase_vertex>\n\n    #ifdef USE_ENVMAP\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n\n    #include <worldpos_vertex>\n    #include <clipping_planes_vertex>\n    #include <envmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    vCustomWorldPosition = worldPosition;\n\n}\n",r.fragmentShader="#define GLSLIFY 1\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec4 vCustomWorldPosition;\nuniform vec2 uCeilingFog;\nuniform vec3 uCeilingFogColor;\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <specularmap_fragment>\n\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n    // accumulation (baked indirect lighting only)\n    #ifdef USE_LIGHTMAP\n\n        vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n        reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n    #else\n\n        reflectedLight.indirectDiffuse += vec3( 1.0 );\n\n    #endif\n\n    // modulation\n    #include <aomap_fragment>\n\n    reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n    vec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n    #include <envmap_fragment>\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n\n    // Custom ceiling fog\n    float ceilingFogStrength = clamp(smoothstep(uCeilingFog.x, uCeilingFog.y, vCustomWorldPosition.y), 0.0, 1.0);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, uCeilingFogColor, ceilingFogStrength);\n\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}}]),n}(Q);function wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Si=function(e){Object(d.a)(n,e);var t=wi(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){e.fog;this._lightColor=new o.Color(11587540),this._gltf=y.b.get("cave/model"),this._debug=this._createDebug(),this._fog=this._createFog(),this._mesh=this._createMesh(),this._lightBoxes=this._createLightBoxes(),this._decals=this._createDecals(),this._lightBeams=this._createLightBeams(),this._dust=this._createDust(),this._floor=this._createFloor(),this._floorBloomDummy=this._createFloorBloomDummy(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh(),this._destroyLightBoxes(),this._decals.destroy(),this._dust.destroy(),this._destroyFloor()}},{key:"decals",get:function(){return this._decals}},{key:"floorBloomDummy",get:function(){return this._floorBloomDummy}},{key:"startFloatFloor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._floor.material.uniforms.uProgress,{duration:1,value:1,ease:"power3.out"},0),t.to(this._floor.userData.bloomMaterial.uniforms.uProgress,{duration:1,value:1,ease:"power3.out"},0),e&&t.timeScale(10),t}},{key:"stopFloatFloor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._floor.material.uniforms.uProgress,{duration:.7,value:0,ease:"power3.inOut"},0),t.to(this._floor.userData.bloomMaterial.uniforms.uProgress,{duration:.7,value:0,ease:"power3.inOut"},0),e&&t.timeScale(10),t}},{key:"resetFloatFloor",value:function(){this._floor.material.uniforms.uProgress.value=0,this._floor.userData.bloomMaterial.uniforms.uProgress.value=0}},{key:"showLightBeams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._lightBeams.material.uniforms.uOpacity,{duration:1,value:.7,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"hideLightBeams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._lightBeams.material.uniforms.uOpacity,{duration:1,value:0,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"resetLightBeams",value:function(){this._lightBeams.material.uniforms.uOpacity.value=0}},{key:"addAssets",value:function(){var e=ut.a["cave/corridor/light-map"];this._mesh&&(this._mesh.material.uniforms.map.value=e),this._floor&&(this._floor.material.uniforms.uMap.value=e);var t=y.b.get("cave/corridor/light-beam-map");this._lightBeams&&(this._lightBeams.material.uniforms.uTexture.value=t),this._decals&&this._decals.addTextures()}},{key:"hideFog",value:function(){if(!this._isFogHidden)return this._isFogHidden=!0,v.a.to(this._fog,{duration:8,near:7e3,far:1e4,ease:"sine.inOut"})}},{key:"resetFog",value:function(){this._fog.near=225,this._fog.far=6675,this._isFogHidden=!1}},{key:"_createFog",value:function(){var e=new W({type:N,color:new o.Color(4216153),density:.0028,height:.0188,globalStrength:0,near:225,far:6675,animation:!1,animationScale:.01,animationSpeed:1,animationDepth:500});if(e.visible=!0,this._debug){var t=this._debug.addGroup("Fog");t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:1e-4}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:.1});var r=t.addGroup("Ground");r.add(e,"density",{stepSize:1e-4}),r.add(e,"height",{stepSize:1e-4});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:.001})}return e}},{key:"_createMesh",value:function(){var e=this._gltf.scene.getObjectByName("corridor").clone(),t=new o.BufferAttribute(new Float32Array,2);t.copy(e.geometry.attributes.uv),e.geometry.setAttribute("uv2",t);var n=new o.Texture;if(n.encoding=o.sRGBEncoding,e.material=new xi({fog:this._fog,map:n}),e.material.color=new o.Color(11587540),e.updateMatrix(),e.matrixAutoUpdate=!1,this._debug){var r=this._debug.addGroup("Material");r.add(e,"visible"),r.add(e.material,"color")}return this.add(e),e}},{key:"_destroyMesh",value:function(){this._mesh.material.map.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_createLightBoxes",value:function(){var e=[],t=new cn({fog:this._fog,color:this._lightColor});t.type="LightBoxMaterial",t.color=new o.Color(6190456);var n=this._gltf.scene.getObjectByName("corridor-lightbox-left").clone();n.material=t,n.userData.renderBloom=!0,n.updateMatrix(),n.matrixAutoUpdate=!1,this.add(n),e.push(n);var r=this._gltf.scene.getObjectByName("corridor-lightbox-right").clone();r.material=t,r.userData.renderBloom=!0,r.updateMatrix(),r.matrixAutoUpdate=!1,this.add(r),e.push(r);var l=this._gltf.scene.getObjectByName("corridor-lightbox-bottom").clone();(l.material=t,l.userData.renderBloom=!0,l.updateMatrix(),l.matrixAutoUpdate=!1,this.add(l),e.push(l),this._debug)&&this._debug.addGroup("Light boxes").add(t,"color");return e}},{key:"_destroyLightBoxes",value:function(){for(var e,i=0,t=this._lightBoxes.length;i<t;i++)(e=this._lightBoxes[i]).material.dispose(),e.geometry.dispose();this._lightBoxes=null}},{key:"_createDecals",value:function(){var e=new Nn({gltf:this._gltf,nameMesh:"corridor-decals-mesh",nameLights:"corridor-decals-lights",debug:this._debug,intensity:.09,distance:168});return e.visible=!0,this.add(e),e}},{key:"_createLightBeams",value:function(){for(var e=this._gltf.scene.getObjectByName("corridor-lightbeams").children,t=e[0].geometry,n=new Float32Array(1*e.length),i=0;i<e.length;i++)n[i]=i;t.setAttribute("beamIndex",new o.InstancedBufferAttribute(n,1));var r=new pi({fog:this._fog,opacity:0,color:this._lightColor,transparent:!0,side:o.DoubleSide});r.blending=o.AdditiveBlending,r.depthWrite=!1;var l=new o.InstancedMesh(t,r,e.length);l.visible=!0,l.userData.renderBloom=!1,l.frustumCulled=!0,l.updateMatrix(),l.matrixAutoUpdate=!1;for(var c,h=new o.Box3,d=new o.Box3,f=new o.Sphere,m=0,v=e.length;m<v;m++)(c=e[m]).updateMatrix(),l.setMatrixAt(m,c.matrix),d.copy(l.geometry.boundingBox).applyMatrix4(c.matrix),h.union(d);if(h.getBoundingSphere(f),l.geometry.boundingBox=h,l.geometry.boundingSphere=f,l.geometry.needsUpdate=!0,this._debug){var _=this._debug.addGroup("Lightbeams");_.add(l,"visible"),_.add(r.uniforms.uColor,"value",{label:"color"}),_.add(r.uniforms.uOpacity,"value",{label:"opacity",min:0})}return this.add(l),l}},{key:"_createDust",value:function(){var e=new ti({fog:this._fog,maxWidth:1200,maxHeight:2010,maxDepth:2900,debug:this._debug});return e.position.set(0,782,-5260),this.add(e),e}},{key:"_createFloor",value:function(){for(var e,t,n,r,l,c,h,d=this._gltf.scene.getObjectByName("corridor-floor"),f=d.children,m=[],i=0,v=f.length;i<v;i++){n=(t=(e=f[i]).geometry.clone()).attributes.position.array.length,t.applyMatrix4((new o.Matrix4).makeTranslation(e.position.x,e.position.y,e.position.z)),r=this._getCentroid(t),l=new Float32Array(n),c=(new o.Vector3).random().subScalar(.5).normalize(),h=new Float32Array(n);for(var _=0;_<n;_+=3)l[_]=r.x,l[_+1]=r.y,l[_+2]=r.z,h[_]=c.x,h[_+1]=c.y,h[_+2]=c.z;t.setAttribute("center",new o.BufferAttribute(l,3)),t.setAttribute("axis",new o.BufferAttribute(h,3)),m.push(t)}var y=hi.a.mergeBufferGeometries(m,!1),x=new o.BufferAttribute(new Float32Array,2);x.copy(y.attributes.uv),y.setAttribute("uv2",x);var map=new o.Texture;map.encoding=o.sRGBEncoding;var w=new yi({fog:this._fog,map:map,color:new o.Color(11587540)}),S=new o.Mesh(y,w);S.position.copy(d.position),S.updateMatrix(),S.matrixAutoUpdate=!1;var C=new yi({color:0});if(S.userData.renderBloom=!0,S.userData.bloomMaterial=C,this._debug){var O=this._debug.addGroup("Floor");O.add(S,"visible"),O.add(w.uniforms.uProgress,"value",{label:"progress",min:0,max:1,onChange:function(){S.userData.bloomMaterial.uniforms.uProgress.value=w.uniforms.uProgress.value}})}return this.add(S),S}},{key:"_destroyFloor",value:function(){this._floor.material.dispose(),this._floor.geometry.dispose(),this._floor=null}},{key:"_createFloorBloomDummy",value:function(){var e=new o.PlaneBufferGeometry(1,1),t=new o.Mesh(e,this._floor.userData.bloomMaterial);return t.matrixAutoUpdate=!1,this.add(t),t}},{key:"_getCentroid",value:function(e){for(var t=e.attributes.position.array,n=t.length,r=0,o=0,l=0,i=0;i<n;i+=3)r+=t[i],o+=t[i+1],l+=t[i+2];return{x:3*r/n,y:3*o/n,z:3*l/n}}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._decals&&this._decals.update({time:time,delta:t}),this._dust&&this._dust.update({time:time,delta:t}),this._lightBeams&&(this._lightBeams.material.uniforms.uTime.value+=t),this._tiles&&(this._tiles.material.uniforms.uTime.value+=t,this._tiles.material.uniforms.uRotationAngle.value+=.1*t),this._floor&&(this._floor.material.uniforms.uTime.value+=t,this._floor.userData.bloomMaterial.uniforms.uTime.value=this._floor.material.uniforms.uTime.value)}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Corridor",{container:"Cave"});return t.add(this,"visible"),t.add(this,"_lightColor",{label:"color"}),t.addButton("Show light beams",{onClick:function(){e.showLightBeams()}}),t.addButton("Hide light beams",{onClick:function(){e.hideLightBeams()}}),t}}}]),n}(Object(_.a)(o.Object3D)),Ci=(n(427),n(350)),Oi="#define GLSLIFY 1\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#ifdef USE_TRANSMISSION\n\n    varying vec4 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvarying vec4 vCustomWorldPosition;\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n        vNormal = normalize( transformedNormal );\n\n        #ifdef USE_TANGENT\n\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n        #endif\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    #ifdef USE_TRANSMISSION\n\n        vWorldPosition = worldPosition;\n\n    #endif\n\n    vCustomWorldPosition = worldPosition;\n}\n",Li="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform vec2 uCeilingFog;\nuniform vec3 uCeilingFogColor;\nvarying vec4 vCustomWorldPosition;\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n\n    // Custom ceiling fog\n    float ceilingFogStrength = clamp(smoothstep(uCeilingFog.x, uCeilingFog.y, vCustomWorldPosition.y), 0.0, 1.0);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, uCeilingFogColor, ceilingFogStrength);\n\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n}\n";function ki(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Mi=function(e){Object(d.a)(n,e);var t=ki(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,{emissive:{value:new o.Color(0)},roughness:{value:r.roughness||1},metalness:{value:r.metalness||0}},{uCeilingFogColor:{value:new o.Color(0)},uCeilingFog:{value:new o.Vector2(3357,6292)}}]),r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.uniforms.map.value=r.map,e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.normalMap=r.normalMap,e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap]),e.roughnessMap=r.roughnessMap),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),e.normalMap&&(e.uniforms.normalMap.value=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),e.roughnessMap&&(e.uniforms.roughnessMap.value=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.lights=!1,e.vertexShader=Oi,e.fragmentShader=Li,e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"repeat",value:function(e,t){var n=this.map;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix))}}]),n}(Q);function Ti(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Pi=function(e){Object(d.a)(n,e);var t=Ti(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common,{uCeilingFogColor:{value:new o.Color(0)},uCeilingFog:{value:new o.Vector2(3357,6292)},uColorStrength:{value:.36}}]),e.color&&(r.uniforms.diffuse.value=new o.Color(e.color||16777215)),e.map&&(r.uniforms.map.value=e.map,r.map=e.map),r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec4 vCustomWorldPosition;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\nvoid main() {\n    // World position\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\n    // Output\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Varyings\n    vCustomWorldPosition = worldPosition;\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Uniforms\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec2 uCeilingFog;\nuniform vec3 uCeilingFogColor;\nuniform float uColorStrength;\n\n// Varyings\nvarying vec4 vCustomWorldPosition;\n\n// Includes\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    // Color\n    vec3 color = diffuse;\n\n    // Output\n    gl_FragColor = vec4(color * uColorStrength, opacity);\n\n    #if defined(USE_CUSTOM_FOG)\n\n        vec3 fogRayDirection = normalize(vCustomWorldPosition.rgb - cameraPosition);\n        vec3 fogColor = fogColor;\n\n        #if defined(FOG_EXP)\n            float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n        #elif defined(FOG_EXP2)\n            float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n        #elif defined(FOG_LINEAR)\n            float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n        #elif defined(FOG_GROUND)\n            float fogGroundDepth = distance(vCustomWorldPosition.rgb, cameraPosition);\n\n            // float fogFactor = clamp(exp((-cameraPosition.y*fogHeight)*fogDensity) * (1.0-exp(-fogGroundDepth*fogRayDirection.y*fogHeight*fogDensity))/(fogRayDirection.y*fogHeight), 0.0, 1.0);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vCustomWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n        #elif defined(FOG_COMBINED)\n            float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n            float fogGroundDepth = distance(vCustomWorldPosition.rgb, cameraPosition);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vCustomWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n            float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n        #endif\n\n        #if defined(FOG_USE_SUN)\n            vec3 sunDirection = normalize(sunPosition - cameraPosition);\n            float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n            fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n        #endif\n\n        #if defined(FOG_RAVINE_LIGHT)\n            float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vCustomWorldPosition.y, 0.0));\n            float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n            fogColor = mix(fogColor, ravineLightColor, ravineLightStrength);\n        #endif\n\n        #if defined(FOG_SIDES)\n            fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vCustomWorldPosition.x));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n        #endif\n\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor * fogActive);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogGlobalStrength * fogActive);\n\n    #endif\n\n    // Custom ceiling fog\n    float ceilingFogStrength = clamp(smoothstep(uCeilingFog.x, uCeilingFog.y, vCustomWorldPosition.y), 0.0, 1.0);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, uCeilingFogColor, ceilingFogStrength);\n\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}}]),n}(Q),Ri="#define GLSLIFY 1\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#ifdef USE_TRANSMISSION\n\n    varying vec4 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <custom_fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute vec3 center;\nattribute vec3 axis;\n\nuniform float uProgress;\nuniform float uTime;\n\nmat4 rotationMatrix(vec3 axis, float angle) {\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n\n    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                0.0,                                0.0,                                0.0,                                1.0);\n}\n\nvec3 rotate(vec3 v, vec3 axis, float angle) {\n  mat4 m = rotationMatrix(axis, angle);\n  return (m * vec4(v, 1.0)).xyz;\n}\n\nfloat hash11(float p) {\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    p *= p + p;\n    return fract(p);\n}\n\nfloat hash12(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * .1031);\n    p3 += dot(p3, p3.yzx + 33.33);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvoid main() {\n\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #include <color_vertex>\n\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n\n    // Noise\n    float noise = hash12(vec2(center.x, center.z) * 7331.);\n    float noise2 = hash12(vec2(center.x, center.z) * 1337.);\n    float timeOffset = hash12(vec2(center.x, center.z));\n\n    vec3 transformedNormal = objectNormal;\n\n    if (noise2 > 0.2) {\n        transformedNormal = rotate(transformedNormal - center, vec3(1.0, 0.0, 0.0), sin(uTime * 0.5 + timeOffset * 13.0) * 0.1 * uProgress) + center;\n        transformedNormal = rotate(transformedNormal - center, vec3(0.0, 1.0, 0.0), sin(uTime * 0.5 + timeOffset * 33.0) * 0.1 * uProgress) + center;\n        transformedNormal = rotate(transformedNormal - center, vec3(0.0, 1.0, 1.0), sin(uTime * 0.5 + timeOffset * 03.0) * 0.1 * uProgress) + center;\n        transformedNormal.y += (120.0 * noise + sin(uTime + timeOffset * 13.0) * 15.0) * uProgress;\n    }\n\n    #ifdef USE_INSTANCING\n\n        // this is in lieu of a per-instance normal-matrix\n        // shear transforms in the instance matrix are not supported\n\n        mat3 m = mat3( instanceMatrix );\n\n        transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n        transformedNormal = m * transformedNormal;\n\n    #endif\n\n    transformedNormal = normalMatrix * transformedNormal;\n\n    #ifdef FLIP_SIDED\n\n        transformedNormal = - transformedNormal;\n\n    #endif\n\n    #ifdef USE_TANGENT\n\n        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n        #ifdef FLIP_SIDED\n\n            transformedTangent = - transformedTangent;\n\n        #endif\n\n    #endif\n\n    #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n        vNormal = normalize( transformedNormal );\n\n        #ifdef USE_TANGENT\n\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n        #endif\n\n    #endif\n\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    if (noise2 > 0.2) {\n        transformed = rotate(transformed - center, vec3(1.0, 0.0, 0.0), sin(uTime * 0.5 + timeOffset * 13.0) * 0.1 * uProgress) + center;\n        transformed = rotate(transformed - center, vec3(0.0, 1.0, 0.0), sin(uTime * 0.5 + timeOffset * 33.0) * 0.1 * uProgress) + center;\n        transformed = rotate(transformed - center, vec3(0.0, 1.0, 1.0), sin(uTime * 0.5 + timeOffset * 03.0) * 0.1 * uProgress) + center;\n        transformed.y += (120.0 * noise + sin(uTime + timeOffset * 13.0) * 15.0) * uProgress;\n        // transformed = rotate(transformed - center, axis, 0.5 * uProgress) + center;\n    }\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    #ifdef USE_INSTANCING\n\n        mvPosition = instanceMatrix * mvPosition;\n\n    #endif\n\n    mvPosition = modelViewMatrix * mvPosition;\n\n    gl_Position = projectionMatrix * mvPosition;\n\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n    #include <custom_fog_vertex>\n\n    #ifdef USE_TRANSMISSION\n\n        vWorldPosition = worldPosition;\n\n    #endif\n}\n",Di="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef USE_TRANSMISSION\n    uniform float transmission;\n    uniform float thickness;\n    uniform vec3 attenuationColor;\n    uniform float attenuationDistance;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n    varying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n\n    #endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <custom_fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n\n    #ifdef USE_TRANSMISSION\n        float totalTransmission = transmission;\n        float thicknessFactor = thickness;\n    #endif\n\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n    vec3 rawDiffuseColor = diffuseColor.rgb;\n\n    #include <transmission_fragment>\n\n    // accumulation\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n\n    // modulation\n    #include <aomap_fragment>\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <custom_fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n\n}\n";function Ai(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ei=function(e){Object(d.a)(n,e);var t=Ai(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this,r)).uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.common,o.UniformsLib.lights,{emissive:{value:new o.Color(0)},roughness:{value:r.roughness||1},metalness:{value:r.metalness||0}},{uProgress:{value:0},uTime:{value:0}}]),r.color&&(e.uniforms.diffuse.value=new o.Color(r.color||16777215)),r.map&&(e.uniforms.map.value=r.map,e.map=r.map),r.normalMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.normalmap]),e.normalMap=r.normalMap,e.defines.TANGENTSPACE_NORMALMAP=""),r.lightMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.lightmap]),e.lightMap=r.lightMap),r.roughnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.roughnessmap]),e.roughnessMap=r.roughnessMap),r.metalnessMap&&(e.uniforms=o.UniformsUtils.merge([e.uniforms,o.UniformsLib.metalnessmap]),e.metalnessMap=r.metalnessMap),e.normalMap&&(e.uniforms.normalMap.value=r.normalMap),e.lightMap&&(e.uniforms.lightMap.value=r.lightMap),e.roughnessMap&&(e.uniforms.roughnessMap.value=r.roughnessMap),e.metalnessMap&&(e.uniforms.metalnessMap.value=r.metalnessMap),e.lights=!0,e.vertexShader=Ri,e.fragmentShader=Di,e.extensions={derivatives:!0},e}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},{key:"emissive",get:function(){return this.uniforms.emissive.value},set:function(e){this.uniforms.emissive.value=e}},{key:"roughness",get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}},{key:"metalness",get:function(){return this.uniforms.metalness.value},set:function(e){this.uniforms.metalness.value=e}},{key:"normalScale",get:function(){return this.uniforms.normalScale.value},set:function(e){this.uniforms.normalScale.value=e}},{key:"lightMapIntensity",get:function(){return this.uniforms.lightMapIntensity.value},set:function(e){this.uniforms.lightMapIntensity.value=e}},{key:"repeat",value:function(e,t){var n=this.map;n.repeat.x=e,n.repeat.y=t,void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),this.uniforms.uvTransform.value.copy(n.matrix))}}]),n}(Q);function Ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ji=function(e){Object(d.a)(n,e);var t=Ii(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common,{uAlpha:{value:0},uColor:{value:null},uCeilingFog:{value:new o.Vector2(3357,6292)},uNoiseMap:{value:null},uNoiseScale:{value:null},uNoiseStrength:{value:null},uGradientStrength:{value:null},uBottomGradientSize:{value:null}}]),r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vWorldPosition;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\nvoid main() {\n    // Output\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Varyings\n    vUv = uv;\n    vWorldPosition = modelMatrix * vec4(position, 1.0);\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vWorldPosition;\n\n// Uniforms\nuniform float uAlpha;\nuniform vec3 uColor;\nuniform vec2 uCeilingFog;\nuniform sampler2D uNoiseMap;\nuniform vec2 uNoiseScale;\nuniform float uNoiseStrength;\nuniform float uGradientStrength;\nuniform float uBottomGradientSize;\n\n// Includes\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    // Alpha\n    float alpha = vUv.x * uGradientStrength;\n    float noise = texture2D(uNoiseMap, vUv * uNoiseScale).r;\n    alpha += noise * uNoiseStrength * vUv.x;\n    float bottomGradient = smoothstep(1.0, (1.0 - uBottomGradientSize) + uBottomGradientSize * vUv.x, vUv.y);\n    alpha *= bottomGradient;\n\n    // Output\n    gl_FragColor = vec4(uColor, alpha * uAlpha);\n\n    // Custom ceiling fog\n    float ceilingFogStrength = clamp(smoothstep(uCeilingFog.x, uCeilingFog.y, vWorldPosition.y), 0.0, 1.0);\n    gl_FragColor.a *= 1.0 - ceilingFogStrength;\n\n    #if defined(USE_CUSTOM_FOG)\n\n        #if defined(FOG_GROUND) || defined(FOG_COMBINED) || defined(FOG_USE_SUN)\n            vec3 fogRayDirection = normalize(vFogWorldPosition - cameraPosition);\n        #endif\n\n        vec3 fogColor = fogColor;\n\n        #if defined(FOG_EXP)\n            float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n        #elif defined(FOG_EXP2)\n            float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n        #elif defined(FOG_LINEAR)\n            float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n        #elif defined(FOG_GROUND)\n            float fogGroundDepth = distance(vCustomWorldPosition.rgb, cameraPosition);\n\n            // float fogFactor = clamp(exp((-cameraPosition.y*fogHeight)*fogDensity) * (1.0-exp(-fogGroundDepth*fogRayDirection.y*fogHeight*fogDensity))/(fogRayDirection.y*fogHeight), 0.0, 1.0);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vCustomWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n        #elif defined(FOG_COMBINED)\n            float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n            float fogGroundDepth = distance(vCustomWorldPosition.rgb, cameraPosition);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vCustomWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n            float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n        #endif\n\n        #if defined(FOG_USE_SUN)\n            vec3 sunDirection = normalize(sunPosition - cameraPosition);\n            float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n            fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n        #endif\n\n        #if defined(FOG_RAVINE_LIGHT)\n            float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vCustomWorldPosition.y, 0.0));\n            float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n            fogColor = mix(fogColor, ravineLightColor, ravineLightStrength);\n        #endif\n\n        #if defined(FOG_SIDES)\n            fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vCustomWorldPosition.x));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n        #endif\n\n        float fogStrength = 1.0 - (fogFactor * fogActive);\n        gl_FragColor.a *= fogStrength;\n\n    #endif\n}\n",r}return n}(Q);function Fi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Bi=function(e){Object(d.a)(n,e);var t=Fi(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).uniforms=o.UniformsUtils.merge([r.uniforms,o.UniformsLib.common,{uCeilingFogColor:{value:new o.Color(0)},uCeilingFog:{value:new o.Vector2(3357,6292)},uColorStrength:{value:.36}}]),e.color&&(r.uniforms.diffuse.value=new o.Color(e.color||16777215)),e.map&&(r.uniforms.map.value=e.map,r.map=e.map),r.vertexShader="#define GLSLIFY 1\n// Varyings\nvarying vec4 vCustomWorldPosition;\n\n// Includes\n#include <custom_fog_pars_vertex>\n\nvoid main() {\n    // World position\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\n    // Output\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Varyings\n    vCustomWorldPosition = worldPosition;\n\n    // Includes\n    #include <custom_fog_vertex>\n}\n",r.fragmentShader="#define GLSLIFY 1\n// Uniforms\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec2 uCeilingFog;\nuniform vec3 uCeilingFogColor;\nuniform float uColorStrength;\n\n// Varyings\nvarying vec4 vCustomWorldPosition;\n\n// Includes\n#include <custom_fog_pars_fragment>\n\nvoid main() {\n    // Color\n    vec3 color = diffuse;\n\n    // Custom ceiling fog\n    float ceilingFogStrength = clamp(smoothstep(uCeilingFog.x, uCeilingFog.y, vCustomWorldPosition.y), 0.0, 1.0);\n    color = mix(color, uCeilingFogColor, ceilingFogStrength);\n\n    float fogStrength = 1.0;\n\n    #if defined(USE_CUSTOM_FOG)\n\n        vec3 fogRayDirection = normalize(vCustomWorldPosition.rgb - cameraPosition);\n        vec3 fogColor = fogColor;\n\n        #if defined(FOG_EXP)\n            float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n        #elif defined(FOG_EXP2)\n            float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n        #elif defined(FOG_LINEAR)\n            float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n        #elif defined(FOG_GROUND)\n            float fogGroundDepth = distance(vCustomWorldPosition.rgb, cameraPosition);\n\n            // float fogFactor = clamp(exp((-cameraPosition.y*fogHeight)*fogDensity) * (1.0-exp(-fogGroundDepth*fogRayDirection.y*fogHeight*fogDensity))/(fogRayDirection.y*fogHeight), 0.0, 1.0);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vCustomWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n        #elif defined(FOG_COMBINED)\n            float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n            float fogGroundDepth = distance(vCustomWorldPosition.rgb, cameraPosition);\n\n            #if defined(FOG_ANIMATE)\n                float fogNoiseSample = cnoise(vec4(vCustomWorldPosition.rgb * fogAnimationScale, fogTime * fogAnimationSpeed)) * 0.5 + 0.5;\n                fogGroundDepth *= mix(fogNoiseSample, 1.0, clamp((fogGroundDepth - fogAnimationDepth) / fogAnimationDepth, 0.0, 1.0));\n                // fogGroundDepth *= fogGroundDepth;\n            #endif\n\n            float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n            float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n        #endif\n\n        #if defined(FOG_USE_SUN)\n            vec3 sunDirection = normalize(sunPosition - cameraPosition);\n            float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n            fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n        #endif\n\n        #if defined(FOG_RAVINE_LIGHT)\n            float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vCustomWorldPosition.y, 0.0));\n            float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n            fogColor = mix(fogColor, ravineLightColor, ravineLightStrength);\n        #endif\n\n        #if defined(FOG_SIDES)\n            fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vCustomWorldPosition.x));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n        #endif\n\n        fogStrength = 1.0 - (fogFactor * fogActive);\n\n    #endif\n\n    // Output\n    gl_FragColor = vec4(color * uColorStrength * fogStrength, opacity);\n\n}\n",r}return Object(c.a)(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}}]),n}(Q);function Ui(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ni=function(e){Object(d.a)(n,e);var t=Ui(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.fog;this._fog=t,this._lightColor=new o.Color(11587540),this._gltf=y.b.get("cave/model"),this._debug=this._createDebug(),this._fog=this._createFog(),this._mesh=this._createMesh(),this._lightBox=this._createLightBox(),this._lights=this._createLights(),this._decals=this._createDecals(),this._dust=this._createDust(),this._floor=this._createFloor(),this._lightRays=this._createLightRays(),this._floorBloomDummy=this._createFloorBloomDummy(),this._lightBoxBloomDummy=this._createLightBoxBloomDummy(),Ci.a.init(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._destroyMesh(),this._destroyLightBox(),this._decals.destroy(),this._dust.destroy(),this._destroyFloor(),this._destroyLightRays()}},{key:"decals",get:function(){return this._decals}},{key:"floorBloomDummy",get:function(){return this._floorBloomDummy}},{key:"lightBoxBloomDummy",get:function(){return this._lightBoxBloomDummy}},{key:"startFloatFloor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._floor.material.uniforms.uProgress,{duration:1,value:1,ease:"power3.out"},0),t.to(this._floor.userData.bloomMaterial.uniforms.uProgress,{duration:1,value:1,ease:"power3.out"},0),e&&t.timeScale(10),t}},{key:"stopFloatFloor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._floor.material.uniforms.uProgress,{duration:.7,value:0,ease:"power3.inOut"},0),t.to(this._floor.userData.bloomMaterial.uniforms.uProgress,{duration:.7,value:0,ease:"power3.inOut"},0),e&&t.timeScale(10),t}},{key:"resetFloatFloor",value:function(){this._floor.material.uniforms.uProgress.value=0,this._floor.userData.bloomMaterial.uniforms.uProgress.value=0}},{key:"showLightRays",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._lightRays.material.uniforms.uAlpha,{duration:1,value:1,ease:"sine.inOut"},0),t.to(this._lightBox.material.uniforms.uColorStrength,{duration:1,value:1,ease:"sine.inOut"},0),t.to(this._lights.areaLight,{duration:1,intensity:1,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"hideLightRays",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new v.a.timeline;return t.to(this._lightRays.material.uniforms.uAlpha,{duration:1,value:0,ease:"sine.inOut"},0),t.to(this._lightBox.material.uniforms.uColorStrength,{duration:1,value:.55,ease:"sine.inOut"},0),t.to(this._lights.areaLight,{duration:1,intensity:.16,ease:"sine.inOut"},0),e&&t.timeScale(10),t}},{key:"resetLightRays",value:function(){this._lightRays.material.uniforms.uAlpha.value=0,this._lightBox.material.uniforms.uColorStrength.value=.55,this._lights.areaLight.intensity=.16}},{key:"addAssets",value:function(){var e=ut.a["cave/modern/light-map"];this._mesh.material.uniforms.lightMap.value=e,this._floor.material.uniforms.lightMap.value=e;var t=y.b.get("cave/modern/noise-map");t.wrapS=t.wrapT=o.MirroredRepeatWrapping,this._lightRays.material.uniforms.uNoiseMap.value=t,this._decals.addTextures()}},{key:"hideFog",value:function(){if(!this._isFogHidden)return this._isFogHidden=!0,v.a.to(this._fog,{duration:8,near:6e3,far:1e4,ease:"sine.inOut"})}},{key:"resetFog",value:function(){this._fog.near=225,this._fog.far=6675,this._isFogHidden=!1}},{key:"_createFog",value:function(){var e=new W({type:N,color:new o.Color(4216153),density:.0028,height:.0188,globalStrength:0,near:225,far:6675,animation:!1,animationScale:.01,animationSpeed:1,animationDepth:500});if(e.visible=!0,this._debug){var t=this._debug.addGroup("Fog");t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:1e-4}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:.1});var r=t.addGroup("Ground");r.add(e,"density",{stepSize:1e-4}),r.add(e,"height",{stepSize:1e-4});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:.001})}return e}},{key:"_createMesh",value:function(){var e=this._gltf.scene.getObjectByName("modern").clone(),t=new o.BufferAttribute(new Float32Array,2);t.copy(e.geometry.attributes.uv),e.geometry.setAttribute("uv2",t);var n=new o.Texture;n.encoding=o.LinearEncoding;var r=new o.Texture;(r.encoding=o.LinearEncoding,e.material=new Mi({fog:this._fog,lightMap:n,roughnessMap:r}),e.material.roughness=.38,e.material.metalness=.04,e.material.lightMapIntensity=.31,e.matrixAutoUpdate=!1,this._debug)&&this._debug.addGroup("Material").add(e.material,"color");(e.material.color=this._lightColor,this.add(e),this._debug)&&this._debug.addGroup("Mesh").add(e,"visible");return e}},{key:"_destroyMesh",value:function(){this._mesh.material.lightMap.dispose(),this._mesh.material.roughnessMap.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._mesh=null}},{key:"_createLightBox",value:function(){var e=this._gltf.scene.getObjectByName("modern-lightbox").clone();if(e.material=new Pi({fog:this._fog,color:this._lightColor,side:o.DoubleSide}),e.userData.renderBloom=!0,e.userData.bloomMaterial=new Bi({fog:this._fog}),e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),this._debug){var t=this._debug.addGroup("Light box");t.add(e,"visible"),t.add(e.material.uniforms.uColorStrength,"value",{label:"opacity",min:0,max:1})}return e}},{key:"_destroyLightBox",value:function(){this._lightBox.material.dispose(),this._lightBox.geometry.dispose(),this._lightBox=null}},{key:"_createLights",value:function(){var e={};if(e.areaLight=new o.RectAreaLight(11587540,.16,124,1980),e.areaLight.position.set(0,841,-11333),e.areaLight.rotation.y=Math.PI,e.areaLight.updateMatrix(),e.areaLight.matrixAutoUpdate=!1,this.add(e.areaLight),this._debug){var t=this._debug.addGroup("Lights");t.add(e.areaLight,"visible"),t.add(e.areaLight,"position",{stepSize:1}),t.add(e.areaLight,"intensity"),t.add(e.areaLight,"width",{stepSize:1}),t.add(e.areaLight,"height",{stepSize:1})}return e}},{key:"_createDecals",value:function(){var e=new Nn({gltf:this._gltf,nameMesh:"modern-decals-mesh",nameLights:"modern-decals-lights",debug:this._debug,intensity:.16,distance:129});return this.add(e),e}},{key:"_createDust",value:function(){var e=new ti({fog:this._fog,maxWidth:1700,maxHeight:2010,maxDepth:2900,debug:this._debug});return e.position.set(0,772,-8341),e.updateMatrix(),this.add(e),e}},{key:"_createFloor",value:function(){for(var e,t,n,r,l,c,h,d=this._gltf.scene.getObjectByName("modern-floor").clone(),f=d.children,m=[],i=0,v=f.length;i<v;i++){n=(t=(e=f[i]).geometry.clone()).attributes.position.array.length,t.applyMatrix4((new o.Matrix4).makeTranslation(e.position.x,e.position.y,e.position.z)),r=this._getCentroid(t),l=new Float32Array(n),c=(new o.Vector3).random().subScalar(.5).normalize(),h=new Float32Array(n);for(var _=0;_<n;_+=3)l[_]=r.x,l[_+1]=r.y,l[_+2]=r.z,h[_]=c.x,h[_+1]=c.y,h[_+2]=c.z;t.setAttribute("center",new o.BufferAttribute(l,3)),t.setAttribute("axis",new o.BufferAttribute(h,3)),m.push(t)}f[0].material.map,f[0].material.roughnessMap;var y=hi.a.mergeBufferGeometries(m,!1),x=new o.BufferAttribute(new Float32Array,2);x.copy(y.attributes.uv),y.setAttribute("uv2",x);var w=new Ei({fog:this._fog,color:this._lightColor,lightMap:new o.Texture});w.roughness=.15,w.metalness=.04,w.lightMapIntensity=.31;var S=new o.Mesh(y,w);if(S.position.copy(d.position),S.updateMatrix(),S.matrixAutoUpdate=!1,S.userData.renderBloom=!0,S.userData.bloomMaterial=new Ei({color:0}),this._debug){var C=this._debug.addGroup("Floor");C.add(S,"visible"),C.add(w,"roughness",{min:0,max:1}),C.add(w,"metalness",{min:0,max:1}),C.add(w.uniforms.uProgress,"value",{label:"progress",min:0,max:1,onChange:function(){S.userData.bloomMaterial.uniforms.uProgress.value=w.uniforms.uProgress.value}})}return this.add(S),S}},{key:"_destroyFloor",value:function(){this._floor.material.lightMap.dispose(),this._floor.material.dispose(),this._floor.geometry.dispose(),this._floor=null}},{key:"_createFloorBloomDummy",value:function(){var e=new o.PlaneBufferGeometry(1,1),t=new o.Mesh(e,this._floor.userData.bloomMaterial);return t.matrixAutoUpdate=!1,this.add(t),t}},{key:"_createLightBoxBloomDummy",value:function(){var e=new o.PlaneBufferGeometry(1,1),t=new o.Mesh(e,this._lightBox.userData.bloomMaterial);return t.matrixAutoUpdate=!1,this.add(t),t}},{key:"_createLightRays",value:function(){var e=new o.Texture,t=this._gltf.scene.getObjectByName("modern-ray-plane").clone(!0);if(t.material=new ji({fog:this._fog,transparent:!0}),t.material.uniforms.uColor.value=this._lightColor,t.material.uniforms.uNoiseScale.value=new o.Vector2(.066,1.27),t.material.uniforms.uNoiseStrength.value=-.94,t.material.uniforms.uGradientStrength.value=.8,t.material.uniforms.uBottomGradientSize.value=.01,t.material.uniforms.uNoiseMap.value=e,t.updateMatrix(),t.matrixAutoUpdate=!1,this.add(t),this._debug){var n=this._debug.addGroup("Light rays");n.add(t,"visible"),n.add(t.material.uniforms.uAlpha,"value",{label:"alpha",min:0}),n.add(t.material.uniforms.uNoiseScale,"value",{label:"noise scale",stepSize:.001}),n.add(t.material.uniforms.uNoiseStrength,"value",{label:"noise strength"}),n.add(t.material.uniforms.uGradientStrength,"value",{label:"gradient strength"}),n.add(t.material.uniforms.uBottomGradientSize,"value",{label:"bottom gradient size",min:0,stepSize:.001})}return t}},{key:"_destroyLightRays",value:function(){this._lightRays.material.uniforms.uNoiseMap.value.dispose(),this._lightRays.material.dispose(),this._lightRays.geometry.dispose(),this._lightRays=null}},{key:"_getCentroid",value:function(e){for(var t=e.attributes.position.array,n=t.length,r=0,o=0,l=0,i=0;i<n;i+=3)r+=t[i],o+=t[i+1],l+=t[i+2];return{x:3*r/n,y:3*o/n,z:3*l/n}}},{key:"update",value:function(e){var time=e.time,t=e.delta;this._decals.update({time:time,delta:t}),this._dust.update({time:time,delta:t}),this._floor.material.uniforms.uTime.value+=t,this._floor.userData.bloomMaterial.uniforms.uTime.value=this._floor.material.uniforms.uTime.value}},{key:"_createDebug",value:function(){var e=this;if(x.a){var t=x.a.addGroup("Modern",{container:"Cave"});return t.add(this,"visible"),t.add(this,"_lightColor",{label:"light color",onChange:function(){e._lightBox.material.color=e._lightColor}}),t.addButton("Show light rays",{onClick:function(){e.showLightRays()}}),t.addButton("Hide light rays",{onClick:function(){e.hideLightRays()}}),t}}}]),n}(Object(_.a)(o.Object3D)),zi="precision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv;\nattribute float index;\nattribute float size;\n\n// Uniforms\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform sampler2D uPositionTexture;\nuniform float uTextureSize;\nuniform float uMaxSize;\n\n// Varyings\nvarying float vLife;\nvarying vec2 vUv;\n\nvoid main() {\n    // Position\n    float x = mod(index, uTextureSize) / uTextureSize;\n    float y = floor(index / uTextureSize) / uTextureSize;\n    vec4 positionSample = texture2D(uPositionTexture, vec2(x, y));\n\n    // Life\n    float life = positionSample.a;\n    vLife = life;\n\n    // Position\n    vec3 pos = position;\n    pos *= size * uMaxSize;\n    pos += positionSample.rgb;\n\n    // Output\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // UV\n    vUv = uv;\n}\n",Gi="precision highp float;\n#define GLSLIFY 1\n\n// Defines\n#define PI 3.141592653589793\n\n// Uniforms\nuniform float uAlpha;\n\n// Varyings\nvarying float vLife;\nvarying vec2 vUv;\n\n// Functions\nfloat sineInOut(float t) {\n    return -0.5 * (cos(PI * t) - 1.0);\n}\n\n// Gradient noise from Jorge Jimenez's presentation:\n// http://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare\nfloat gradientNoise(vec2 uv) {\n    vec3 magic = vec3(0.06711056, 0.00583715, 52.9829189);\n    return fract(magic.z * fract(dot(uv, magic.xy)));\n}\n\n// Partials\n// https://www.shadertoy.com/view/4djSRW\nfloat random(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * 443.8975);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvoid main() {\n    // Alpha\n    float alpha = 1.0 - distance(vec2(0.5, 0.5), vUv) * 2.0;\n    alpha = clamp(alpha, 0.0, 1.0);\n    alpha = sineInOut(alpha);\n    alpha *= uAlpha;\n    alpha *= smoothstep(0.0, 0.3, vLife);\n    alpha += (1.0 / 255.0) * gradientNoise(gl_FragCoord.xy) - (0.5 / 255.0);\n    alpha *= 1.0 - random(gl_FragCoord.xy * 0.05) * 0.1;\n    alpha *= pow(gl_FragCoord.z, 10.0);\n\n    // Color\n    vec3 color = vec3(0.0, 0.0, 0.0);\n\n    // Output\n    gl_FragColor = vec4(color, alpha);\n}\n";function Hi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Vi=function(e){Object(d.a)(n,e);var t=Hi(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(l.a)(this,n),(e=t.call(this)).uniforms=o.UniformsUtils.merge([e.uniforms,{uTextureSize:{value:r.textureSize},uPositionTexture:{value:null},uMaxSize:{value:0},uAlpha:{value:0}}]),e.uniforms.uPositionTexture.value=r.positionTexture,e.transparent=!0,e.depthWrite=!1,e.depthTest=!1,e.type="TheEndParticlesMaterial",e.vertexShader=zi,e.fragmentShader=Gi,e}return n}(o.RawShaderMaterial);function Wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var $i=1600,qi=function(e){Object(d.a)(n,e);var t=Wi(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._camera=e.camera,this._spawnCount=0,this._lifeSpeed=.001,this._rotationSpeed=.008,this._spawnInterval=8,this._speed=new o.Vector2(4,5),this._spread=8,this._isVisible=!1,this._gltf=y.b.get("cave/model"),this._debug=this._createDebug(),this._heaven=this._createHeaven(),this._positionTexture=this._createPositionTexture(),this._mesh=this._createMesh(),this._particles=this._createParticles(),this.reset(),this.matrixAutoUpdate=!1}},{key:"show",value:function(){this._isVisible=!0;var e=new v.a.timeline;return e.set(this._mesh,{visible:!0},0),e.to(this._mesh.material.uniforms.uAlpha,3,{value:.4,ease:"sine.inOut"},0),e.to(this,1,{_spawnInterval:3,ease:"sine.inOut"},1),e}},{key:"reset",value:function(){this.visible=!1,this._mesh.visible=!1,this._mesh.material.uniforms.uAlpha.value=0,this._spawnInterval=8,this._mesh.material.uniforms.uMaxSize.value=1200,this._isVisible=!1}},{key:"activate",value:function(){this._isVisible&&(this._mesh.visible=!0)}},{key:"deactivate",value:function(){this._isVisible&&(this._mesh.visible=!1)}},{key:"_createHeaven",value:function(){var e=this._gltf.scene.getObjectByName("04-the-end").clone(),t=new o.ShaderMaterial({vertexShader:"#define GLSLIFY 1\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"#define GLSLIFY 1\nvoid main() {\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n",side:o.BackSide});return e.material=t,e.updateMatrix(),e.matrixAutoUpdate=!1,this.add(e),e}},{key:"_createPositionTexture",value:function(){var data=new Float32Array(6400),e=Math.sqrt($i);return new o.DataTexture(data,e,e,o.RGBAFormat,o.FloatType)}},{key:"_createMesh",value:function(){for(var e=new Float32Array($i),t=new Float32Array($i),i=0;i<$i;i++)e[i]=i,t[i]=.6+.4*Math.random();var n=new o.PlaneBufferGeometry(1,1);n.setAttribute("index",new o.InstancedBufferAttribute(e,1)),n.setAttribute("size",new o.InstancedBufferAttribute(t,1));var r=new Vi({positionTexture:this._positionTexture,textureSize:Math.sqrt($i)}),l=new o.InstancedMesh(n,r,$i);return l.position.z=-13e3,l.frustumCulled=!1,this.add(l),this._debug&&(this._debug.add(l,"visible"),this._debug.add(r.uniforms.uMaxSize,"value",{label:"max size",stepSize:1}),this._debug.add(r.uniforms.uAlpha,"value",{label:"alpha",min:0,stepSize:.001})),l}},{key:"_createParticles",value:function(){for(var e=[],i=0;i<$i;i++)e.push(new Yi);return e}},{key:"update",value:function(){this._camera.position.z<-11e3&&(this.visible=!0),this._spawnParticles(),this._updateRotation(),this._updateParticles(),this._updatePositionTexture()}},{key:"_spawnParticles",value:function(){if(this._spawnCount++,this._spawnCount%this._spawnInterval==0)for(var e,i=0,t=this._particles.length;i<t;i++)if(!(e=this._particles[i]).isAlive){e.spawn({speed:this._speed,spread:this._spread});break}}},{key:"_updateRotation",value:function(){this._mesh.rotation.z+=this._rotationSpeed}},{key:"_updateParticles",value:function(){for(var i=0,e=this._particles.length;i<e;i++)this._particles[i].update({lifeSpeed:this._lifeSpeed})}},{key:"_updatePositionTexture",value:function(){for(var e,i=0,t=this._particles.length;i<t;i++)e=this._particles[i],this._positionTexture.image.data[4*i+0]=e.location.x,this._positionTexture.image.data[4*i+1]=e.location.y,this._positionTexture.image.data[4*i+2]=e.location.z,this._positionTexture.image.data[4*i+3]=e.life;this._positionTexture.needsUpdate=!0}},{key:"_createDebug",value:function(){if(x.a){var e=x.a.addGroup("The end",{container:"Cave"});return e.add(this,"_lifeSpeed",{label:"life speed",min:0,stepSize:1e-4}),e.add(this,"_rotationSpeed",{label:"rotation speed",stepSize:1e-4}),e.add(this,"_spawnInterval",{label:"spawn interval",min:1,stepSize:1}),e.add(this,"_speed",{label:"speed",min:0}),e.add(this,"_spread",{label:"spread",min:0}),e}}}]),n}(Object(_.a)(o.Object3D)),Yi=function(){function e(){Object(l.a)(this,e),this._spread=2,this._speed=new o.Vector2(1,2),this._location=new o.Vector3(0,0,1e4),this._velocity=new o.Vector3(0,0,0),this._isAlive=!1,this._life=0}return Object(c.a)(e,[{key:"location",get:function(){return this._location}},{key:"isAlive",get:function(){return this._isAlive}},{key:"life",get:function(){return this._life}},{key:"spawn",value:function(e){var t=e.spread,n=e.speed;this._spread=t,this._speed.copy(n),this._reset(),this._isAlive=!0}},{key:"update",value:function(e){var t=e.lifeSpeed;this._isAlive&&(this._life+=t,this._location.add(this._velocity),this._life>1&&(this._isAlive=!1,this._life=0))}},{key:"_reset",value:function(){this._life=0,this._setStartLocation(),this._setVelocity()}},{key:"_setStartLocation",value:function(){var e=600*Math.random(),t=2*Math.PI*Math.random(),n=e*Math.cos(t),r=e*Math.sin(t);this._location.set(n,r,0)}},{key:"_setVelocity",value:function(){var e=-.5*this._spread+Math.random()*this._spread,t=-.5*this._spread+Math.random()*this._spread,n=this._speed.x+Math.random()*this._speed.y;this._velocity.set(e,t,n)}}]),e}();function Xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ki={name:"Cave",class:function(e){Object(d.a)(n,e);var t=Xi(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.config;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._config=l,this._isActive=!1,this._isFirstShow=!0,this._isTransitionOutTriggered=!1,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera(),this._fog=this._createFog(),this._components=this._createComponents(),this._bindHandlers(),this._setupEventListeners(),this.matrixAutoUpdate=!1}},{key:"destroy",value:function(){Object(h.a)(Object(m.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyComponents()}},{key:"camera",get:function(){return this._camera}},{key:"config",get:function(){return this._config}},{key:"activeStateIndex",get:function(){return this._activeStateIndex}},{key:"prepare",value:function(e,t){this._root.nuxtRoot.$store.getters["context/isProduction"]&&this._addAssetsToComponents(),this._postProcessing.loadSettings(this.name),t.loadRenderSettings(this._config.renderer),this._renderer.compile(this,this._camera.main),this._renderer.render(this,this._camera.main),this._postProcessing.render(this,this.camera.active),this._components.corridor&&this._components.corridor.floorBloomDummy&&(this._components.corridor.floorBloomDummy.visible=!1),this._components.corridor&&this._components.corridor.lightBoxBloomDummy&&(this._components.corridor.lightBoxBloomDummy.visible=!1),this._components.modern&&(this._components.modern.floorBloomDummy.visible=!1),this._components.tunnel&&this._components.rocksScattered&&(this._components.rocksScattered.bloomDummy.visible=!1),this._renderer.setClearColor(0),this._renderer.clear(),e()}},{key:"show",value:function(e){var t=this,n=e.instant;this._resourceManager.load().then((function(){var e;t._isActive=!0,t._activeStateIndex=0,t._isState0Active=!0,t._isState1Active=!1,t._isState2Active=!1,t._isTransitionOutTriggered=!1,t._components.modern.visible=!0,t._sceneRenderer._renderTarget.texture.encoding=o.LinearEncoding,t._isFirstShow&&t._root.nuxtRoot.$store.getters["context/isDevelopment"]&&(t._addAssetsToComponents(),t._isFirstShow=!1),w.a.playLandscapeTrack(t._config.audio.background),t._components.corridor.resetFog(),t._components.modern.resetFog(),t._camera.reset(),n||(t._camera.enable(),t._root.nuxtRoot.$store.getters["context/isProduction"]&&t._camera.startDolly()),null===(e=t._timelineHide)||void 0===e||e.kill(),t._timelineShow=new v.a.timeline({onComplete:function(){t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionNone")}}),t._timelineShow.call((function(){return t._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionIn")}),null,0),t._timelineShow.call((function(){return t._postProcessing.passes.lineRender.changeColor(new o.Color(t._config.lines.color))}),null,0),t._timelineShow.fromTo(t._postProcessing.passes.transition,{progress:1},{duration:3,progress:0,ease:"sine.inOut"},0),t._timelineShow.add(t._components.tunnel.decals.show(),1),t._timelineShow.add(t._components.corridor.decals.show(),1),t._timelineShow.add(t._components.modern.decals.show(),1)}))}},{key:"hide",value:function(e){var t,n,r=this,o=e.onCompleteCallback,l=(e.hideLines,e.instant);return null===(t=this._timelineShow)||void 0===t||t.kill(),null===(n=this._timelineHide)||void 0===n||n.kill(),this._timelineHide=new v.a.timeline({onComplete:function(){var e;r._isActive=!1,r._camera.stopDolly(),l||(r._camera.disable(),r._camera.reset()),r._resetStates(),null===(e=r._timelineShowTheEnd)||void 0===e||e.kill(),r._components.theEnd.reset(),"function"==typeof o&&o()}}),this._timelineHide}},{key:"setState",value:function(e){switch(this._postProcessing.passes.final.spawnScan(this._camera.position,{alphaDuration:1,alphaDelay:1.3}),this._postProcessing.passes.transition.changeLUT(e),this._postProcessing.passes.lineRender.lines.spin(),this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}if(this._activeStateIndex!==e)switch(this._activeStateIndex=e,this._activeStateIndex){case 0:this._toggleState0();break;case 1:this._toggleState1();break;case 2:this._toggleState2()}}},{key:"_bindHandlers",value:function(){this._cameraDollyCompleteHandler=this._cameraDollyCompleteHandler.bind(this),this._menuOpenHandler=this._menuOpenHandler.bind(this),this._menuClosedHandler=this._menuClosedHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._camera.addEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.addEventListener("menu:open",this._menuOpenHandler),this.addEventListener("menu:closed",this._menuClosedHandler)}},{key:"_removeEventListeners",value:function(){this._camera.removeEventListener("dolly:complete",this._cameraDollyCompleteHandler),this.removeEventListener("menu:open",this._menuOpenHandler),this.removeEventListener("menu:closed",this._menuClosedHandler)}},{key:"_createResourceManager",value:function(){return new y.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new F({root:this._root,renderer:this._renderer,scene:this,debugContainer:"Cave",near:10,far:11e3,dollySpeed:3.5,dollyHeight:30,dollyStartPosition:0,dollyEndPosition:-11500,menuPositions:this._config.menuCameraPositions});return e.activateMain(),B.a.copySettings(e.main),e}},{key:"_createFog",value:function(){var e=new W({type:V,color:new o.Color(4216153),density:.0028,height:.0188,globalStrength:0,near:225,far:6675,animation:!1,animationScale:.01,animationSpeed:1,animationDepth:500});if(e.visible=!0,x.a){var t=x.a.addGroup("Fog",{container:"Cave"});t.add(e,"visible"),t.add(e,"type",{options:[N,z,G,H,V]}),t.add(e,"color"),t.add(e,"globalStrength");var n=t.addGroup("Animation");n.add(e,"animation"),n.add(e,"animationScale",{label:"scale",stepSize:1e-4}),n.add(e,"animationSpeed",{label:"speed"}),n.add(e,"animationDepth",{label:"depth",stepSize:.1});var r=t.addGroup("Ground");r.add(e,"density",{stepSize:1e-4}),r.add(e,"height",{stepSize:1e-4});var l=t.addGroup("Linear");l.add(e,"near",{stepSize:1}),l.add(e,"far",{stepSize:1}),t.addGroup("Exp2").add(e,"density",{stepSize:.001})}return e}},{key:"_createLights",value:function(){var e={};if(e.ambientLight=new o.AmbientLight(3757648),e.ambientLight.intensity=.39,this.add(e.ambientLight),x.a){var t=x.a.addGroup("Lights",{container:"Cave"}).addGroup("Ambient");t.add(e.ambientLight,"visible"),t.add(e.ambientLight,"color"),t.add(e.ambientLight,"intensity")}return e}},{key:"_restart",value:function(){var e=this,t=new v.a.timeline;t.to(this._postProcessing.passes.transition,{duration:1,progress:1,ease:"sine.inOut"},0),t.call((function(){e._camera.reset(),e._camera.startDolly(),e._components.corridor.resetFog(),e._components.modern.resetFog()}),null,1),t.to(this._postProcessing.passes.transition,{duration:4,progress:0,ease:"sine.inOut"},4)}},{key:"_showTheEnd",value:function(){var e=this;return this._timelineShowTheEnd=new v.a.timeline,this._timelineShowTheEnd.set(this._components.modern,{visible:!1},0),this._timelineShowTheEnd.set(this._postProcessing.passes.transition.material.uniforms.uIsLutActive,{value:!1},0),this._timelineShowTheEnd.call((function(){return e._postProcessing.passes.lineRender.changeColor(new o.Color(16777215))}),null,0),this._timelineShowTheEnd.call((function(){return e._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionIn")}),null,0),this._timelineShowTheEnd.add(this._components.theEnd.show(),0),this._timelineShowTheEnd.to(this._postProcessing.passes.bloom,{duration:1,strength:.3,ease:"sine.inOut"},0),this._timelineShowTheEnd.call((function(){return e._root.nuxtRoot.$store.dispatch("webgl/setTheEndShow")}),null,0),this._timelineShowTheEnd.to(this._postProcessing.passes.transition,{duration:5,progress:1,ease:"sine.inOut"},5),this._timelineShowTheEnd.call((function(){return e._postProcessing.passes.lineRender.changeColor(new o.Color(16753487))}),null,9),this._timelineShowTheEnd.to(this._postProcessing.passes.bloom,{duration:1,strength:1.18,ease:"sine.inOut"},9),this._timelineShowTheEnd.call((function(){return e._root.nuxtRoot.$store.dispatch("webgl/setTheEndHide")}),null,10),this._timelineShowTheEnd.call((function(){return e.dispatchEvent({type:"complete"})}),null,13),this._timelineShowTheEnd}},{key:"_createComponents",value:function(){var e={};return e.tunnel=this._createTunnelComponent(),e.corridor=this._createCorridorComponent(),e.modern=this._createModernComponent(),e.theEnd=this._createTheEndComponent(),e}},{key:"_addAssetsToComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].addAssets&&this._components[e].addAssets()}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_createTunnelComponent",value:function(){var component=new ci({fog:this._fog});return this.add(component),component}},{key:"_createCorridorComponent",value:function(){var component=new Si({fog:this._fog});return this.add(component),component}},{key:"_createModernComponent",value:function(){var component=new Ni({fog:this._fog});return this.add(component),component}},{key:"_createTheEndComponent",value:function(){var component=new qi({camera:this._camera});return this.add(component),component}},{key:"_toggleState0",value:function(){var e;this._isState0Active=!this._isState0Active,null===(e=this._timelineState0)||void 0===e||e.kill(),this._timelineState0=new v.a.timeline,this._isState0Active?(this._timelineState0.add(this._components.tunnel.decals.show(),1),this._timelineState0.add(this._components.corridor.decals.show(),1),this._timelineState0.add(this._components.modern.decals.show(),1)):(this._timelineState0.add(this._components.tunnel.decals.hide(),0),this._timelineState0.add(this._components.corridor.decals.hide(),0),this._timelineState0.add(this._components.modern.decals.hide(),0))}},{key:"_toggleState1",value:function(){var e;this._isState1Active=!this._isState1Active,null===(e=this._timelineState1)||void 0===e||e.kill(),this._timelineState1=new v.a.timeline,this._isState1Active?(this._timelineState1.add(this._components.tunnel.rocksScattered.startFloat(),.5),this._timelineState1.add(this._components.corridor.startFloatFloor(),.5),this._timelineState1.add(this._components.modern.startFloatFloor(),.5)):(this._timelineState1.add(this._components.tunnel.rocksScattered.stopFloat(),0),this._timelineState1.add(this._components.corridor.stopFloatFloor(),0),this._timelineState1.add(this._components.modern.stopFloatFloor(),0))}},{key:"_toggleState2",value:function(){var e;this._isState2Active=!this._isState2Active,null===(e=this._timelineState2)||void 0===e||e.kill(),this._timelineState2=new v.a.timeline,this._isState2Active?(this._timelineState2.add(this._components.tunnel.lightBeams.show(),.5),this._timelineState2.add(this._components.corridor.showLightBeams(),.5),this._timelineState2.add(this._components.modern.showLightRays(),.5)):(this._timelineState2.add(this._components.tunnel.lightBeams.hide(),.5),this._timelineState2.add(this._components.corridor.hideLightBeams(),.5),this._timelineState2.add(this._components.modern.hideLightRays(),.5))}},{key:"_resetStates",value:function(){this._components.tunnel.decals.reset(),this._components.corridor.decals.reset(),this._components.modern.decals.reset(),this._components.tunnel.rocksScattered.resetFloat(),this._components.corridor.resetFloatFloor(),this._components.modern.resetFloatFloor(),this._components.tunnel.lightBeams.reset(),this._components.corridor.resetLightBeams(),this._components.modern.resetLightRays()}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&(this._updateCamera({time:time,delta:t}),this._updateComponents({time:time,delta:t}),!this._isTransitionOutTriggered&&this._camera.position.z<-1e4&&(this._isTransitionOutTriggered=!0,this._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionOut")),this._camera.position.z<-3500&&(this._components.corridor.hideFog(),this._components.modern.hideFog()),this._camera.position.z)}},{key:"_updateCamera",value:function(e){var time=e.time,t=e.delta;this._camera.update({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"_cameraDollyCompleteHandler",value:function(){this._root.nuxtRoot.$store.getters["home/isScrollTriggered"]?this._restart():(this._camera.stopDolly(),this._showTheEnd())}},{key:"_menuOpenHandler",value:function(){this._components.theEnd.deactivate(),this._isState0Active&&(this._components.tunnel.decals.hide(!0),this._components.corridor.decals.hide(!0),this._components.modern.decals.hide(!0)),this._isState1Active&&(this._components.tunnel.rocksScattered.stopFloat(!0),this._components.corridor.stopFloatFloor(!0),this._components.modern.stopFloatFloor(!0)),this._isState2Active&&(this._components.tunnel.lightBeams.hide(!0),this._components.corridor.hideLightBeams(!0),this._components.modern.hideLightRays(!0))}},{key:"_menuClosedHandler",value:function(){this._isState0Active&&(this._components.tunnel.decals.show(!0),this._components.corridor.decals.show(!0),this._components.modern.decals.show(!0)),this._isState1Active&&(this._components.tunnel.rocksScattered.startFloat(!0),this._components.corridor.startFloatFloor(!0),this._components.modern.startFloatFloor(!0)),this._isState2Active&&(this._components.tunnel.lightBeams.show(!0),this._components.corridor.showLightBeams(!0),this._components.modern.showLightRays(!0))}},{key:"onCameraChange",value:function(e){var t=e.type;this._fog.visible="debug"!==t}}]),n}(Object(_.a)(o.Scene)),renderer:{clearColor:"#405559",toneMapping:o.ACESFilmicToneMapping,toneMappingExposure:1,outputEncoding:o.LinearEncoding},postProcessing:{fogBloom:{enabled:!1,strength:1.09,radius:1},ssms:{depthOffset:-.236},bloom:{enabled:!0,strength:1.18,radius:.63},final:{enabled:!0,lut:"lut/cave"}},lines:{color:5111764},audio:{background:"audio-landscape-cave",transition:"audio-transition-cave"},resources:{preload:{development:!0,production:!0},items:[{type:"ktx",name:"cave/tunnel/floor/albedo-map",path:"/webgl/scenes/cave/tunnel/floor-albedo-map.ktx2"},{type:"ktx",name:"cave/tunnel/floor/normal-map",path:"/webgl/scenes/cave/tunnel/floor-normal-map.ktx2"},{type:"ktx",name:"cave/tunnel/gate/albedo-map",path:"/webgl/scenes/cave/tunnel/gate-albedo-map.ktx2"},{type:"ktx",name:"cave/tunnel/gate/normal-map",path:"/webgl/scenes/cave/tunnel/gate-normal-map.ktx2"},{type:"ktx",name:"cave/tunnel/rock-small/albedo-map",path:"/webgl/scenes/cave/tunnel/rock-small-albedo-map.ktx2"},{type:"ktx",name:"cave/tunnel/rock-small/normal-map",path:"/webgl/scenes/cave/tunnel/rock-small-normal-map.ktx2"},{type:"ktx",name:"cave/corridor/light-beam-map",path:"/webgl/scenes/cave/corridor/light-beam-map.ktx2"},{type:"ktx",name:"cave/modern/noise-map",path:"/webgl/scenes/cave/modern/noise-map.ktx2"}]},menuCameraPositions:[{position:new o.Vector3(-624.2539296033499,-22.584091996263552,-3585.674411433215),rotation:new o.Euler(-3.1281815790997087,-.08629976758030604,-3.3800000000000017),target:new o.Vector3(-311.97623250062014,-70.99038918496662,23.53640314657454),transitionProgress:.1,lutIndex:0},{position:new o.Vector3(-310.98432349373314,-110.51648326583258,-5663.847116533476),target:new o.Vector3(3.433027763754193,67.96685354262404,-6106.627319493601),transitionProgress:.32,lutIndex:0},{position:new o.Vector3(-79.57144948597886,569.8253885109668,-9891.509534012359),target:new o.Vector3(726.961725966238,1836.860775684566,-10427.077924562529),transitionProgress:.28,lutIndex:0}]};t.a=[Xe,on,jn,Ki]},function(e,t,n){"use strict";n(10);var r=n(2),o=n(3),l=n(6),c=n(4),h=n(5),d=n(1),f=(n(109),n(17),n(7)),m=n(11),v=n(0),_=n(8),y=n(75);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var w=function(e){Object(c.a)(n,e);var t=x(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.config;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._config=l,this._width=null,this._height=null,this._isActive=!1,this._ui=null,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera(),y.a.setup()}},{key:"destroy",value:function(){var e;Object(l.a)(Object(d.a)(n.prototype),"destroy",this).call(this),null===(e=this._ui)||void 0===e||e.destroy()}},{key:"components",get:function(){return this._components}},{key:"ui",get:function(){return this._ui}},{key:"show",value:function(){var e=this;this._resourceManager.load().then((function(){e._ui||(e._ui=e._createUI()),e._ui.show(),e._isActive=!0,e._root.landscapeManager.show({name:"Rocky desert",playIntro:!0}),e._root.landscapeManager.transitionIn(),e._postProcessing.passes.sceneTexture.enabled=!0,e._postProcessing.passes.lineRender.enabled=!0,e._postProcessing.passes.transition.enabled=!0,e._postProcessing.passes.lineTexture.enabled=!0,e._postProcessing.passes.UIRender.enabled=!0,e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"home",isAvailable:!0}),e._postProcessing.passes.lineRender.enable(),setTimeout((function(){e._postProcessing.passes.UIRender.enabled=!1}),32)}))}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=new f.a.timeline({onComplete:function(){e._isActive=!1,"function"==typeof t&&t()}});return n.call((function(){e._root.landscapeManager.transitionOut(),e._ui&&e._ui.hide(),e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"home",isAvailable:!1})}),null,0),n}},{key:"render",value:function(){var e=this._root.landscapeManager.active;e&&(y.a.copyRotation(e.camera),this._sceneRenderer.render(e,e.camera.active),this._postProcessing.render(e,e.camera.active))}},{key:"_createResourceManager",value:function(){return new _.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new v.PerspectiveCamera(50,1,.1,100);return e.position.z=50,e}},{key:"_createUI",value:function(){return new this._config.uiClass({config:this._config,root:this._root,renderer:this._renderer,postProcessing:this._postProcessing,width:this._width,height:this._height})}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&this._updateComponents({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeCamera(t,n),this._resizeComponents({width:t,height:n})}},{key:"_resizeCamera",value:function(e,t){this._camera.aspect=e/t,this._camera.updateProjectionMatrix()}},{key:"_resizeComponents",value:function(e){var component,t=e.width,n=e.height;for(var r in this._components)"function"==typeof(component=this._components[r]).resize&&component.resize({width:t,height:n})}}]),n}(Object(m.a)());function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var C=function(e){Object(c.a)(n,e);var t=S(n);function n(e){var o,l=e.width,c=e.height,h=e.perspective,d=e.near,f=e.far;return Object(r.a)(this,n),(o=t.call(this,75,l/c,d,f))._width=l,o._height=c,o._perspective=h,o.position.z=o._perspective,o._resize({width:l,height:c}),o}return Object(o.a)(n,[{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resize()}},{key:"_resize",value:function(){this.aspect=this._width/this._height,this.fov=2*Math.atan(this._height/2/this._perspective)*180/Math.PI,this.updateProjectionMatrix()}}]),n}(Object(m.a)(v.PerspectiveCamera)),O=(n(31),n(15),n(67),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(18),n(351)),L=n.n(O),k=n(150),M=n(9),T=n(135),P=n(55),R=n(69),D=n(79);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var E=new v.Vector3,I=function(e){Object(c.a)(n,e);var t=A(n);function n(e){var o;return Object(r.a)(this,n),(o=t.call(this))._root=e.root,o._postprocessing=o._root.postProcessing,o._postprocessingPass=o._postprocessing.passes.UIRender,o._content="content",o._width=null,o._height=null,o._time=0,o._style={small:{marginTop:100,width:295,containerWidth:295,fontSize:35,translateY:60},medium:{marginTop:250,width:1e3,containerWidth:1e3,fontSize:95,translateY:500},large:{marginTop:426,width:1146,containerWidth:1368,fontSize:120,translateY:600}},o._settings={speed:1,frequency:.2,amplitude:.05,showDuration:2,hideDuration:1,showTranslateY:o._style[R.a.current].translateY,distortionStrength:"large"===R.a.current?-.05:0},o._bindAll(),o._points=o._createPoints(),o._dataTexture=o._createDataTexture(),o._textContainer=new v.Object3D,o._text=o._createText(),o.add(o._textContainer),o._setupDebug(),o}return Object(o.a)(n,[{key:"destroy",value:function(){var e;null===(e=this._debugGroup)||void 0===e||e.remove(),this._dataTexture.dispose(),this._destroyText()}},{key:"setContent",value:function(content){this._content=content,this._updateText()}},{key:"show",value:function(){var e;return null===(e=this.timelineHide)||void 0===e||e.kill(),this.timelineShow=new f.a.timeline,this.timelineShow.to(this._text.material.uniforms.animationProgress,{duration:this._settings.showDuration,value:.2,ease:"none"},.5),this.timelineShow}},{key:"hide",value:function(){var e;return null===(e=this.timelineShow)||void 0===e||e.kill(),this.timelineHide=new f.a.timeline,this.timelineHide.to(this._text.material.uniforms.animationProgress,{value:0,duration:this._settings.hideDuration,ease:"sine.out"},0),this.timelineHide}},{key:"transitionIn",value:function(){var e;k.a.create("custom","M0,0 C0.272,0 0.436,0.454 0.456,0.506 0.627,0.953 0.744,1 1,1");return null===(e=this.timelineOut)||void 0===e||e.kill(),this.timelineIn=new f.a.timeline,this.timelineIn.add(this.show(),0),this.timelineIn.fromTo(this._textContainer.position,{y:-this._settings.showTranslateY},{duration:2,y:0,ease:"power3.out"},0),this.timelineIn}},{key:"transitionOut",value:function(){var e;return null===(e=this.timelineIn)||void 0===e||e.kill(),this.timelineOut=new f.a.timeline,this.timelineOut.add(this.hide(),0),this.timelineOut.to(this._textContainer.position,{duration:1,y:-this._settings.showTranslateY,ease:"power3.in"},0),this.timelineOut}},{key:"_createPoints",value:function(){return new Float32Array(80)}},{key:"_createDataTexture",value:function(){var e=new v.DataTexture(this._points,20,1,v.RGBFormat,v.FloatType);return e.needsUpdate=!0,e}},{key:"_createText",value:function(){var e="small"===R.a.current?_.b.get("BarlowExtraLight"):_.b.get("BarlowThin"),t=L()({text:this._content,font:e});t.setAttribute("position2",new v.BufferAttribute(t.attributes.position.array,2)),t.deleteAttribute("position");var n="small"===R.a.current?_.b.get("BarlowExtraLightTexture"):_.b.get("BarlowThinTexture");n.needsUpdate=!0;var r={map:{value:n},color:{value:new v.Color("white")},opacity:{value:1},alphaTest:{value:1e-4},resolution:{value:new v.Vector2(this._width,this._height)},minAlpha:{value:.25},distanceTreshold:{value:.32},smoothRangeTreshold:{value:.1},dataTexture:{value:this._dataTexture},randomness:{value:.1},colorRandomness:{value:0},noiseScale:{value:13},animationProgress:{value:0},animationDelay:{value:.2},linesTotal:{value:t.layout.linesTotal},lettersTotal:{value:t.layout.lettersTotal},fadeBottomSize:{value:"small"===R.a.current?.17:0}},o=new v.ShaderMaterial({fragmentShader:"#define GLSLIFY 1\nuniform float opacity;\nuniform vec3 color;\nuniform sampler2D map;\nuniform vec2 resolution;\nuniform float minAlpha;\nuniform float alphaTest;\n// uniform sampler2D dataTexture;\nuniform float distanceTreshold;\nuniform float smoothRangeTreshold;\nuniform float randomness;\nuniform float colorRandomness;\nuniform float noiseScale;\nuniform float animationProgress;\nuniform float animationDelay;\nuniform float linesTotal;\nuniform float lettersTotal;\nuniform float fadeBottomSize;\n\nvarying float minDistance;\nvarying vec2 vUv;\nvarying float lineIndex;\nvarying float instanceID;\nvarying vec2 vScreenPosition;\n\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\n\n// https://www.shadertoy.com/view/4djSRW\nfloat random(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * 443.8975);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat noise (in vec2 st) {\n    vec2 i = floor(st);\n    vec2 f = fract(st);\n\n    // Four corners in 2D of a tile\n    float a = random(i);\n    float b = random(i + vec2(1.0, 0.0));\n    float c = random(i + vec2(0.0, 1.0));\n    float d = random(i + vec2(1.0, 1.0));\n\n    // Smooth Interpolation\n\n    // Cubic Hermine Curve.  Same as SmoothStep()\n    vec2 u = f*f*(3.0-2.0*f);\n    // u = smoothstep(0.,1.,f);\n\n    // Mix 4 coorners percentages\n    return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\nvoid main() {\n    vec3 s = texture2D(map, vUv).rgb;\n    float sigDist = median(s.r, s.g, s.b) - 0.5;\n    float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);\n\n    // Randomize distance treshold per line\n    float randomValue = random(vec2(lineIndex + 1.0, lineIndex + 1.0)) - 0.5;\n    float randomizedDistanceTreshold = distanceTreshold + randomValue * randomness;\n\n    float perlinNoise = noise(vUv * noiseScale);\n\n    // Adjust distance with noise\n    // float finalDistance = minDistance * (perlinNoise + 1.0);\n    float finalDistance = minDistance;\n\n    // Mask\n    float maskAlpha = 1.0 - smoothstep(randomizedDistanceTreshold - smoothRangeTreshold, randomizedDistanceTreshold, finalDistance);\n    maskAlpha = maskAlpha + minAlpha;\n    maskAlpha = clamp(maskAlpha, 0.0, 1.0);\n\n    // Randomize color per letter\n    vec3 finalColor = color.xyz;\n    finalColor.r += (random(vec2(instanceID, instanceID)) - 0.5) * colorRandomness;\n    finalColor.g += (random(vec2(instanceID, instanceID)) - 0.5) * colorRandomness;\n    finalColor.b += (random(vec2(instanceID, instanceID)) - 0.5) * colorRandomness;\n\n    float bottomFade = smoothstep(vScreenPosition.y, 0.0, fadeBottomSize);\n\n    // Reveal animation per line\n    // float staggerOffset = animationDelay * lineIndex;\n    // float animationAlpha = min(-staggerOffset + animationProgress * linesTotal * max(animationDelay, 1.0), 1.0);\n\n    // Reveal animation per letter\n    float staggerOffset = perlinNoise;\n    float animationAlpha = min(-staggerOffset + animationProgress * linesTotal, 1.0);\n\n    gl_FragColor = vec4(finalColor, alpha * opacity * maskAlpha * animationAlpha * bottomFade);\n\n    // gl_FragColor = vec4(maskAlpha, 0.0, 0.0, 1.0);\n    // gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n    // Debug\n    // gl_FragColor = vec4(color.xyz, perlinNoise);\n\n    if (gl_FragColor.a < alphaTest) discard;\n\n}\n",vertexShader:"#define GLSLIFY 1\nattribute vec4 position2;\nattribute vec4 center;\nattribute float line;\nattribute float letter;\n\nuniform vec2 resolution;\nuniform highp sampler2D dataTexture;\n\nvarying vec2 vUv;\nvarying float minDistance;\nvarying float lineIndex;\nvarying float instanceID;\nvarying vec2 vScreenPosition;\n\nconst int POINTS_AMOUNT = 20;\n\nfloat _distance(vec2 p1, vec2 p2) {\n    float a = p1.x - p2.x;\n    float b = p1.y - p2.y;\n    return sqrt(a * a + b * b);\n}\n\nvoid main() {\n    instanceID = letter;\n\n    vUv = uv;\n\n    lineIndex = line;\n\n    vec4 glPosition = projectionMatrix * modelViewMatrix * position2;\n    vec4 centerPosition = projectionMatrix * modelViewMatrix * center;\n    centerPosition.xyz /= centerPosition.w;\n\n    vec4 pos = glPosition;\n    pos.xyz /= pos.w;\n    vScreenPosition = vec2((pos.x + 1.0) * 0.5, (pos.y + 1.0) * 0.5);\n\n    // vec2 screenSpaceCenter = vec2(centerPosition.x / (resolution.x * 0.5), centerPosition.y / (resolution.y * 0.5));\n\n    // Find closest point\n    minDistance = 10000.0;\n\n    for (int i = 0; i < POINTS_AMOUNT; i++) {\n        vec4 texel = texture2D(dataTexture, vec2(float(i) / float(POINTS_AMOUNT), 0.0));\n        float dist = abs(_distance(texel.xy, centerPosition.xy));\n\n        if (dist <= minDistance) {\n            minDistance = dist;\n        }\n    }\n\n    gl_Position = glPosition;\n}\n",uniforms:r,side:v.DoubleSide,transparent:!0,depthTest:!1,extensions:{derivatives:!0}}),l=new v.Mesh(t,o);return l.frustumCulled=!1,l.rotation.set(Math.PI,0,0),this._textContainer.add(l),l}},{key:"_destroyText",value:function(){this._text.material.uniforms.map.value.dispose(),this._text.material.dispose(),this._text.geometry.dispose(),this._text=null}},{key:"_updateText",value:function(){var e=this;this._text.geometry.update({text:this._content}),this._resizeText(),setTimeout((function(){P.a._updateDimensions(),e._resizeText()}),1e3)}},{key:"_resizeText",value:function(){var e=this._size(this._style[this._media()].fontSize)/150;this._text.geometry.update({text:this._content,width:this._size(this._style[this._media()].width)/e,lineHeight:this._size(this._style[this._media()].fontSize)/e});var t=this._text.geometry.layout.height*e,n=P.a.height-P.a.viewportHeight;"auto"===this._style[this._media()].marginTop?this._text.position.y=n/2-t/2:this._text.position.y=P.a.viewportHeight/2-t-this._size(this._style[this._media()].marginTop),this._text.position.x=-this._size(this._style[this._media()].containerWidth)/2,this._text.scale.set(e,e,1),this._text.material.uniforms.linesTotal.value=this._text.geometry.layout.linesTotal,this._text.geometry.setAttribute("position2",new v.BufferAttribute(this._text.geometry.attributes.position.array,2)),this._text.geometry.deleteAttribute("position"),this._settings.showTranslateY=this._size(this._style[this._media()].translateY)}},{key:"_updatePoints",value:function(){for(var i=0;i<=20;i++){var e=T.a[0].bones.length,t=i*Math.floor(e/20),n=T.a[0].bones[t],r=E.set(n.start.x,n.start.y,n.start.z).project(y.a),o=3*i;this._points[o+0]=r.x,this._points[o+1]=r.y,this._points[o+2]=1}}},{key:"_updateDataTexture",value:function(){this._dataTexture.image.data=this._points,this._dataTexture.needsUpdate=!0}},{key:"update",value:function(e){var time=e.time;this._time=time,this._updatePoints(),this._updateDataTexture()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._settings.distortionStrength="large"===R.a.current?-.05:0,this._resizeText(),this._text.material.uniforms.resolution.value.set(t,n),this._text.material.uniforms.fadeBottomSize.value="small"===R.a.current?.17:0}},{key:"_bindAll",value:function(){this._textChangeHandler=this._textChangeHandler.bind(this),this.show=this.show.bind(this)}},{key:"_textChangeHandler",value:function(){this._updateText()}},{key:"_setupDebug",value:function(){if(M.a){this._debugGroup=M.a.addGroup("Text Shader",{container:"UI"}),this._debugGroup.add(this._text.material.uniforms.minAlpha,"value",{min:0,max:1,label:"minimum alpha"}),this._debugGroup.add(this._text.material.uniforms.distanceTreshold,"value",{min:0,max:1,label:"Distance treshold"}),this._debugGroup.add(this._text.material.uniforms.smoothRangeTreshold,"value",{min:0,max:.5,label:"Smooth range treshold"}),this._debugGroup.add(this._text.material.uniforms.randomness,"value",{min:0,max:1,label:"Treshold randomness"}),this._debugGroup.add(this._text.material.uniforms.colorRandomness,"value",{min:0,max:1,label:"Color randomness"}),this._debugGroup.add(this._text.material.uniforms.noiseScale,"value",{min:0,max:100,label:"Noise scale"}),this._debugGroup.add(this._text.material.uniforms.fadeBottomSize,"value",{min:0,max:1,label:"Fade Bottom"});var e=this._debugGroup.addGroup("Animation",{container:"UI"});e.add(this._settings,"showDuration",{min:0,max:10,label:"Duration"}),e.add(this._settings,"showTranslateY",{min:0,max:500,label:"Translate Y"}),e.add(this._settings,"distortionStrength",{min:-1,max:1,label:"Strenght"}),e.add(this._text.material.uniforms.animationDelay,"value",{min:0,max:10,label:"Delay"}),e.add(this._text.material.uniforms.animationProgress,"value",{min:0,max:1,label:"Progress"}),e.addButton("Animate",{onClick:this.show})}}},{key:"_media",value:function(){return R.a.current}},{key:"_viewportWidth",value:function(){var e={small:D.viewportWidthSmall,medium:D.viewportWidthMedium,large:D.viewportWidthLarge}[R.a.current];return parseFloat(e)}},{key:"_vw",value:function(){var e={small:D.fontSizeSmall,medium:D.fontSizeMedium,large:D.fontSizeLarge};return.01*parseFloat(e[R.a.current])*this._width}},{key:"_size",value:function(e){return e/(this._viewportWidth()/100)*this._vw()}}]),n}(v.Object3D);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var F={name:"Home",class:w,uiClass:function(e){Object(c.a)(n,e);var t=j(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.config,n=e.root,r=e.renderer,o=e.postProcessing,l=e.width,c=e.height;this._config=t,this._root=n,this._renderer=r,this._postProcessing=o,this._width=l,this._height=c,this._scene=new v.Scene,this._camera=this._createCamera(),this._components=this._createComponents()}},{key:"destroy",value:function(){Object(l.a)(Object(d.a)(n.prototype),"destroy",this).call(this),this._destroyComponents()}},{key:"camera",get:function(){return this._camera}},{key:"text",get:function(){return this._components.text}},{key:"enable",value:function(){this._postProcessing.passes.UIRender.enabled=!0}},{key:"disable",value:function(){this._postProcessing.passes.UIRender.enabled=!1}},{key:"show",value:function(){this._postProcessing.passes.UIRender.scene=this._scene,this._postProcessing.passes.UIRender.camera=this._camera}},{key:"hide",value:function(){this._postProcessing.passes.UIRender.scene=null,this._postProcessing.passes.UIRender.camera=null}},{key:"_createCamera",value:function(){return new C({width:this._width,height:this._height,perspective:800,near:.1,far:1e3})}},{key:"_createComponents",value:function(){var e={};return e.text=this._createTextComponent(),e}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_createTextComponent",value:function(){var component=new I({root:this._root});return this._scene.add(component),component}},{key:"onUpdate",value:function(e){var time=e.time;this._updateComponents({time:time})}},{key:"_updateComponents",value:function(e){var time=e.time;for(var t in this._components)"function"==typeof this._components[t].update&&this._components[t].update({time:time})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeComponents({width:t,height:n})}},{key:"_resizeComponents",value:function(e){var t=e.width,n=e.height;for(var r in this._components)"function"==typeof this._components[r].resize&&this._components[r].resize({width:t,height:n})}}]),n}(Object(m.a)()),renderer:{clearColor:"#000000",dpr:{mobile:2,desktop:1}},postProcessing:{},resources:{preload:{development:!0,production:!0},items:[]}};function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var U=function(e){Object(c.a)(n,e);var t=B(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.postProcessing,o=e.config;this._root=t,this._renderer=n,this._postProcessing=r,this._config=o,this._scene=new v.Scene,this._isActive=!1,this._components=null,this._ui=null,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera()}},{key:"destroy",value:function(){var e;Object(l.a)(Object(d.a)(n.prototype),"destroy",this).call(this),null===(e=this._ui)||void 0===e||e.destroy()}},{key:"ui",get:function(){return this._ui}},{key:"show",value:function(){var e=this;this._resourceManager.load().then((function(){e._components||(e._components=e._createComponents()),e._ui||(e._ui=e._createUI()),e._ui.show(),e._isActive=!0,e._postProcessing.passes.sceneTexture.enabled=!1,e._postProcessing.passes.lineRender.enabled=!1,e._postProcessing.passes.fogBloom.enabled=!1,e._postProcessing.passes.ssms.enabled=!1,e._postProcessing.passes.transition.enabled=!1,e._postProcessing.passes.lineTexture.enabled=!1,e._postProcessing.passes.fxaa.enabled=!1,e._postProcessing.passes.bloomRender.enabled=!1,e._postProcessing.passes.bloom.enabled=!1,e._postProcessing.passes.godrays.enabled=!1,e._postProcessing.passes.UIRender.enabled=!1,e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"about",isAvailable:!0})}))}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=new f.a.timeline({onComplete:function(){e._isActive=!1,"function"==typeof t&&t()}});return n.call((function(){e._ui&&e._ui.hide(),e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"about",isAvailable:!1})}),null),n}},{key:"render",value:function(){this._postProcessing.render(this._scene,this._camera)}},{key:"_createResourceManager",value:function(){return new _.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new v.PerspectiveCamera(50,1,.1,100);return e.position.z=50,e}},{key:"_createComponents",value:function(){return{}}},{key:"_createUI",value:function(){return new this._config.uiClass({config:this._config,root:this._root,renderer:this._renderer,postProcessing:this._postProcessing,width:this._width,height:this._height})}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&this._updateComponents({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeCamera()}},{key:"_resizeCamera",value:function(){this._camera.aspect=this._width/this._height,this._camera.updateProjectionMatrix()}}]),n}(Object(m.a)());function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var z={name:"About",class:U,uiClass:function(e){Object(c.a)(n,e);var t=N(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.config,n=e.root,r=e.renderer,o=e.postProcessing,l=e.width,c=e.height;this._config=t,this._root=n,this._renderer=r,this._postProcessing=o,this._width=l,this._height=c,this._scene=new v.Scene,this._camera=this._createCamera(),this._components=this._createComponents()}},{key:"destroy",value:function(){Object(l.a)(Object(d.a)(n.prototype),"destroy",this).call(this),this._destroyComponents()}},{key:"camera",get:function(){return this._camera}},{key:"text",get:function(){return this._components.text}},{key:"show",value:function(){this._postProcessing.passes.UIRender.scene=this._scene,this._postProcessing.passes.UIRender.camera=this._camera}},{key:"hide",value:function(){this._postProcessing.passes.UIRender.scene=null}},{key:"_createCamera",value:function(){return new C({width:this._width,height:this._height,perspective:800,near:.1,far:1e3})}},{key:"_createComponents",value:function(){return{}}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"onUpdate",value:function(e){var time=e.time;this._updateComponents({time:time})}},{key:"_updateComponents",value:function(e){var time=e.time;for(var t in this._components)"function"==typeof this._components[t].update&&this._components[t].update({time:time})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n}}]),n}(Object(m.a)()),renderer:{clearColor:"#000000"},postProcessing:{},resources:{preload:{development:!0,production:!0},items:[]}};function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var H=function(e){Object(c.a)(n,e);var t=G(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.postProcessing,o=e.config;this._root=t,this._renderer=n,this._postProcessing=r,this._config=o,this._scene=new v.Scene,this._isActive=!1,this._components=null,this._ui=null,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera()}},{key:"destroy",value:function(){var e;Object(l.a)(Object(d.a)(n.prototype),"destroy",this).call(this),null===(e=this._ui)||void 0===e||e.destroy()}},{key:"components",get:function(){return this._components}},{key:"ui",get:function(){return this._ui}},{key:"show",value:function(){var e=this;this._resourceManager.load().then((function(){e._components||(e._components=e._createComponents()),e._ui||(e._ui=e._createUI()),e._ui.show(),e._isActive=!0,e._postProcessing.passes.sceneTexture.enabled=!1,e._postProcessing.passes.lineRender.enabled=!1,e._postProcessing.passes.fogBloom.enabled=!1,e._postProcessing.passes.ssms.enabled=!1,e._postProcessing.passes.transition.enabled=!1,e._postProcessing.passes.lineTexture.enabled=!1,e._postProcessing.passes.fxaa.enabled=!1,e._postProcessing.passes.bloomRender.enabled=!1,e._postProcessing.passes.bloom.enabled=!1,e._postProcessing.passes.final.enabled=!1,e._postProcessing.passes.UIRender.enabled=!0,e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"work",isAvailable:!0})}))}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=new f.a.timeline({onComplete:function(){e._isActive=!1,"function"==typeof t&&t()}});return n.call((function(){e._ui&&e._ui.hide(),e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"work",isAvailable:!1})}),null),n}},{key:"render",value:function(){this._postProcessing.render(this._scene,this._camera)}},{key:"_createResourceManager",value:function(){return new _.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new v.PerspectiveCamera(50,1,.1,100);return e.position.z=50,e}},{key:"_createComponents",value:function(){return{}}},{key:"_createUI",value:function(){return new this._config.uiClass({config:this._config,root:this._root,renderer:this._renderer,postProcessing:this._postProcessing,width:this._width,height:this._height})}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._isActive&&this._updateComponents({time:time,delta:t})}},{key:"_updateComponents",value:function(e){var component,time=e.time,t=e.delta;for(var n in this._components)"function"==typeof(component=this._components[n]).update&&component.update({time:time,delta:t})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeCamera()}},{key:"_resizeCamera",value:function(){this._camera.aspect=this._width/this._height,this._camera.updateProjectionMatrix()}}]),n}(Object(m.a)()),V=(n(30),n(23),n(56),n(63),n(27),n(64),n(12)),W=n(25),$=n(129),Y=n(212),X=n(59),K=n(141);function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var Z=function(e){Object(c.a)(n,e);var t=Q(n);function n(e){var o;return Object(r.a)(this,n),(o=t.call(this))._root=e.root,o._viewport=e.viewport,o._width=e.width,o._height=e.height,o._initialPosition=e.initialPosition,o._scrollPosition=e.scrollPosition,o._transitionPosition=0,o._index=e.index,o._cssContainer=e.cssContainer,o._element=e.element.cloneNode(!0),o._textElement=o._element.querySelector(".js-name"),o._projectUrl=e.url,o._content=e.data.name.toUpperCase(),o._image=e.image.src,o._settings=e.settings,o._textureWidth=o._image.width,o._textureHeight=o._image.height,o._textSettings={transitionProgress:0,opacityFactor:.5,scrollProgress:1,fadeLeftFactor:0,fadeSidesFactor:1,highlightFactor:o._settings.hover.highlightFactor},o._currentProgress=0,o._isTextureReady=!1,o._isShowed=!1,o._isIntersecting=!1,o._intersectedSlide=null,o._mousePosition=new v.Vector2(0,0),o._normalizedMousePosition=new v.Vector2(0,0),o._bindAll(),o._texture=o._createTexture(),o._material=o._createMaterial(),o._plane=o._createPlane(),o._cssBlock=o._createCssBlock(),o._intersectionPlane=o._createIntersectionPlane(),o}return Object(o.a)(n,[{key:"destroy",value:function(){this._texture.dispose(),this._material.dispose(),this._texture=null,this._material=null,this._plane=null}},{key:"update",value:function(){this._textElement.style.opacity=this._textSettings.opacityFactor*this._textSettings.scrollProgress*this._textSettings.transitionProgress*(1-this._textSettings.fadeLeftFactor)*this._textSettings.fadeSidesFactor*this._textSettings.highlightFactor}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"index",get:function(){return this._index}},{key:"settings",get:function(){return this._settings},set:function(e){}},{key:"mousePosition",get:function(){return this._mousePosition},set:function(e){this._mousePosition.x=e.x,this._mousePosition.y=e.y}},{key:"normalizedMousePosition",get:function(){return this._normalizedMousePosition},set:function(e){this._normalizedMousePosition.x=e.x,this._normalizedMousePosition.y=e.y}},{key:"intersectionPlane",get:function(){return this._intersectionPlane}},{key:"isIntersecting",get:function(){return this._isIntersecting},set:function(e){this._isIntersecting!==e&&this._intersectionHandler(e),this._isIntersecting=e}},{key:"intersectedSlide",get:function(){return this._intersectedSlide},set:function(e){e!==this._intersectedSlide&&(this._intersectedSlide=e,null!==this._intersectedSlide&&this._isIntersecting&&this._highlight(),null===this._intersectedSlide||this._isIntersecting||this._unhighlight(),null===this._intersectedSlide&&this._highlight())}},{key:"scrollPosition",get:function(){return this._scrollPosition},set:function(e){this._scrollPosition=e,this._updatePosition()}},{key:"transitionPosition",get:function(){return this._transitionPosition},set:function(e){this._transitionPosition=e,this._updatePosition()}},{key:"initialPosition",get:function(){return this._initialPosition},set:function(e){this._initialPosition.x=e.x,this._initialPosition.y=e.y,this._initialPosition.z=e.z}},{key:"element",get:function(){return this._element}},{key:"cssBlock",get:function(){return this._cssBlock}},{key:"currentProgress",get:function(){return this._currentProgress},set:function(progress){this._currentProgress=W.a.clamp(progress,0,1),this._textSettings.fadeSidesFactor=K.a.easePulseCubic(this._currentProgress,.5,.9)}},{key:"show",value:function(){this._isShowed=!0;var e=new f.a.timeline;return this._isTextureReady&&(e.to(this._textSettings,{duration:1.7,transitionProgress:1,ease:"sine.inOut"},0),e.to(this._material.uniforms.u_transition_progress,{duration:1.7,value:1,ease:"sine.inOut"},0)),e}},{key:"hide",value:function(){var e;null===(e=this.timelineOnLoad)||void 0===e||e.kill();var t=new f.a.timeline;return t.to(this._textSettings,{duration:1,transitionProgress:0,ease:"sine.out"},0),t.to(this._material.uniforms.u_transition_progress,{duration:1.2,value:0,ease:"sine.out"},0),t}},{key:"fadeLeft",value:function(){var e=new f.a.timeline;return e.to(this._material.uniforms.u_fadeleft_factor,{duration:1.2,value:this._settings.transition.fadeLeftFactor,ease:"sine.inOut"}),e.to(this._textSettings,{duration:1.2,fadeLeftFactor:1,ease:"sine.inOut"},0),e}},{key:"removefadeLeft",value:function(){var e=new f.a.timeline;return e.to(this._material.uniforms.u_fadeleft_factor,{duration:1.2,value:0,ease:"sine.inOut"},.7),e.to(this._textSettings,{duration:1.2,fadeLeftFactor:0,ease:"sine.inOut"},.5),e}},{key:"clickHandler",value:function(){var e=this;if(!this._isTweening)if(this._projectUrl===this._root.nuxtRoot.$route.fullPath){this._isTweening=!0;var t=document.querySelector(".js-section-project").__vue__.targetPosition;f.a.to($.a,{duration:1.5,position:t,ease:"power3.inOut",onComplete:function(){e._isTweening=!1}})}else this._root.nuxtRoot.$router.push({path:this._projectUrl})}},{key:"_createTexture",value:function(){return(new v.TextureLoader).load(this._image,this._loadTextureHandler)}},{key:"_createCssBlock",value:function(){var e=new Y.a(this._element);return this._cssContainer.add(e),this._textElement.style.opacity=1,e}},{key:"_createMaterial",value:function(){return new v.ShaderMaterial({depthTest:!1,vertexShader:"#define GLSLIFY 1\nuniform vec2 u_screen_resolution;\nuniform vec2 u_resolution;\nuniform vec2 u_aspect_ratio;\nuniform float u_scale;\nuniform float u_hover_scale;\n\nvarying vec2 v_uv;\nvarying vec2 v_uv_r;\nvarying vec2 v_uv_screen;\nvarying vec4 v_position;\nvarying vec2 v_screen_position;\n\nvec2 resizedUv(vec2 inital_uv, vec2 resolution, vec2 aspect_ratio)\n{\n\tvec2 ratio = vec2(\n\t\tmin((resolution.x / resolution.y) / (aspect_ratio.x / aspect_ratio.y), 1.0),\n\t\tmin((resolution.y / resolution.x) / (aspect_ratio.y / aspect_ratio.x), 1.0)\n\t);\n\n\tvec2 resized_uv = vec2(\n\t\tinital_uv.x * ratio.x + (1.0 - ratio.x) * 0.5,\n\t\tinital_uv.y * ratio.y + (1.0 - ratio.y) * 0.5\n\t);\n\n\treturn resized_uv;\n}\n\nvec2 screenUv(vec2 inital_uv, vec2 resolution, vec2 aspect_ratio) {\n\tvec2 ratio = vec2(\n\t\tmin((resolution.x / resolution.y) / (aspect_ratio.x / aspect_ratio.y), 1.0),\n\t\tmin((resolution.y / resolution.x) / (aspect_ratio.y / aspect_ratio.x), 1.0)\n\t);\n\n\tvec2 resized_uv = vec2(\n\t\tinital_uv.x * ratio.x + (1.0 - ratio.x) * 0.5,\n\t\tinital_uv.y * ratio.y + (1.0 - ratio.y) * 0.5\n\t);\n\n\treturn resized_uv;\n}\n\nfloat cubicPulse( float c, float w, float x ){\n    x = abs(x - c);\n    if( x>w ) return 0.0;\n    x /= w;\n    return 1.0 - x*x*(3.0-2.0*x);\n}\n\nvoid main() {\n    v_uv = uv;\n\n\tvec4 glPos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n\tv_position = glPos;\n    v_position.xyz /= v_position.w;\n\n    v_screen_position = vec2((v_position.x + 1.0) * 0.5, (v_position.y + 1.0) * 0.5);\n\n    // Resize\n    v_uv_r = resizedUv(v_uv, u_resolution, u_aspect_ratio);\n\n\tv_uv_screen = v_uv;\n    // v_uv_screen = screenUv(v_uv, u_resolution, u_screen_resolution);\n    // v_uv_screen = ;\n\n\t// Inside parallax\n\tv_uv_r = (v_uv_r - 0.5) * (1.0 / (u_scale + u_hover_scale)) + 0.5; // scale from center\n\tv_uv_r.x += v_position.x * (u_scale - 1.0); // displace uv.x\n\n\t// Output\n    gl_Position = glPos;\n}\n",fragmentShader:"#define GLSLIFY 1\nvarying vec2 v_uv_r;\nvarying vec2 v_uv_screen;\nvarying vec4 v_position;\nvarying vec2 v_screen_position;\n\nuniform float u_time;\nuniform vec2 u_resolution;\nuniform vec2 u_screen_resolution;\nuniform sampler2D u_texture;\n\nuniform float u_level_min;\nuniform float u_level_max;\n\nuniform float u_alpha_factor;\nuniform float u_level_factor;\nuniform float u_saturation_factor;\nuniform float u_brightness_factor;\nuniform float u_contrast_factor;\nuniform float u_color_pulse_size;\nuniform float u_alpha_pulse_size;\nuniform float u_highlight_factor;\n\nuniform vec2 u_mouse_position;\nuniform float u_mouse_scale;\n\nuniform float u_transition_progress;\nuniform float u_fadeleft_factor;\n\nuniform float u_scroll_progress;\n\n// Source: https://thebookofshaders.com/05/\nfloat cubicPulse( float c, float w, float x ){\n    x = abs(x - c);\n    if( x>w ) return 0.0;\n    x /= w;\n    return 1.0 - x*x*(3.0-2.0*x);\n}\n\n// Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 finalLevels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con)\n{\n\t// Increase or decrease theese values to adjust r, g and b color channels seperately\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\treturn conColor;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n\tvec2 r_uv = v_uv_r;\n\n    // Original texel\n    vec4 initial_texel = texture2D(u_texture, r_uv);\n    // vec4 initial_texel = vec4(1.0, 0.0, 0.0, 1.0);\n\n    // Effect texel\n    vec4 transformed_texel = texture2D(u_texture, r_uv);\n    // vec4 transformed_texel = vec4(1.0, 0.0, 0.0, 1.0);\n\n    // Screen Position\n    vec2 screen_position = v_screen_position;\n\n    vec2 mouse_position = u_mouse_position;\n    mouse_position.y *= u_screen_resolution.y / u_screen_resolution.x;\n\n    vec2 uv = vec2(screen_position.xy);\n    uv.y *= u_screen_resolution.y / u_screen_resolution.x;\n    float circle = smoothstep(0.0, u_mouse_scale, length(uv - mouse_position));\n\n    float brightness_mask = 1.0 - smoothstep(0.0, 1.0, circle);\n\n    float progress = screen_position.x;\n\n    // Filters tags open state\n    float fadeLeft = u_fadeleft_factor;\n    float filters_open_mask = 1.0 - (1.0 - progress) * 1.0 * fadeLeft;\n\n    float transition_progress = u_transition_progress;\n    // float transition_progress = 1.0;\n\n    // Color effects values\n    float level = cubicPulse(0.5, u_color_pulse_size, progress) * u_level_factor * transition_progress * filters_open_mask * u_scroll_progress * u_highlight_factor;\n    float brightness = 1.0 + u_brightness_factor * brightness_mask * transition_progress * filters_open_mask * u_scroll_progress * u_highlight_factor;\n    float saturation = cubicPulse(0.5, u_color_pulse_size, progress) * u_saturation_factor * transition_progress * filters_open_mask * u_scroll_progress * u_highlight_factor;\n    float alpha = cubicPulse(0.5, u_alpha_pulse_size, progress) * u_alpha_factor * transition_progress * filters_open_mask * u_scroll_progress * u_highlight_factor;\n    float contrast = 1.0;\n\n    // Levels\n    transformed_texel = vec4(finalLevels(transformed_texel.rgb, u_level_min, level, u_level_max), 1.0);\n\n    // Contrast & Saturation & Brightness\n    transformed_texel = vec4(ContrastSaturationBrightness(transformed_texel.rgb, brightness, saturation, contrast), 1.0);\n    transformed_texel *= alpha;\n\n    // Output\n\tfragColor = transformed_texel;\n\n    // Debug\n\t// fragColor = vec4(brightness_mask, 0.0, 0.5, 1.0);\n\t// fragColor = vec4(gl_FragCoord.xy / u_screen_resolution.xy, 0.0, 1.0);\n\t// fragColor = vec4(v_position.x / u_screen_resolution.x, 0.0, 0.0, 1.0);\n\t// fragColor = vec4(v_uv.x, v_uv.y, 0.0, 1.0);\n\t// fragColor = vec4(v_uv_screen.x, v_uv_screen.y, 0.0, 1.0);\n\t// fragColor = vec4(circle, 0.0, 0.0, 1.0);\n\t// fragColor = vec4(v_position.x, 0.0, 0.0, 1.0);\n\t// fragColor = vec4(screen_position.y, 0.0, 0.0, 1.0);\n\t// fragColor = vec4(gl_FragCoord.x / u_screen_resolution.x, 0.0, 0.0, 1.0);\n\t// fragColor = vec4(filters_open_mask, 0.0, 0.0, 1.0);\n\n}\n\nvoid main() {\n\tmainImage(gl_FragColor, gl_FragCoord.xy);\n}\n",uniforms:{u_time:{value:0},u_screen_resolution:{value:new v.Vector2(this._viewport.width,this._viewport.height)},u_resolution:{value:new v.Vector2(this._width,this._height)},u_texture:{value:this._texture},u_aspect_ratio:{value:new v.Vector2(this._textureWidth,this._textureHeight)},u_level_min:{value:0},u_level_max:{value:1},u_level_factor:{value:this._settings.filters.levelFactor},u_saturation_factor:{value:this._settings.filters.saturationFactor},u_brightness_factor:{value:this._settings.filters.brightnessFactor},u_contrast_factor:{value:this._settings.filters.contrastFactor},u_alpha_factor:{value:this._settings.filters.alphaFactor},u_color_pulse_size:{value:this._settings.filters.colorPulseSize},u_alpha_pulse_size:{value:this._settings.filters.alphaPulseSize},u_scale:{value:this._settings.parallax.scale},u_mouse_position:{value:this._normalizedMousePosition},u_mouse_scale:{value:this._settings.mouseScale},u_transition_progress:{value:0},u_fadeleft_factor:{value:0},u_scroll_progress:{value:0},u_hover_scale:{value:0},u_highlight_factor:{value:1}}})}},{key:"_createPlane",value:function(){var e=new v.PlaneGeometry(1,1,1),t=new v.Mesh(e,this._material);return t.scale.set(this._width,this._height,1),this.add(t),t}},{key:"_createText",value:function(){var text=new Text({content:this._content,style:this._textStyle,opacity:1});return this.add(text),text}},{key:"_createIntersectionPlane",value:function(){var e=new v.PlaneGeometry(1,1,1),t=new v.MeshBasicMaterial({color:"red",depthTest:!1,visible:!1}),n=new v.Mesh(e,t);return n.index=this._index,n.scale.set(this._width,this._height,1),this.add(n),n}},{key:"_highlight",value:function(){var e,t;X.a.isTouch()||(null===(e=this._timelineUnhighlight)||void 0===e||e.kill(),null===(t=this._timelineHighlight)||void 0===t||t.kill(),this._timelineHighlight=new f.a.timeline,this._timelineHighlight.to(this._material.uniforms.u_highlight_factor,{duration:3,value:1,ease:"power2.out"},0),this._timelineHighlight.to(this._settings.hover,{duration:3,highlightFactor:1,ease:"power2.out"},0))}},{key:"_unhighlight",value:function(){var e,t;X.a.isTouch()||(null===(e=this._timelineUnhighlight)||void 0===e||e.kill(),null===(t=this._timelineHighlight)||void 0===t||t.kill(),this._timelineUnhighlight=new f.a.timeline({delay:this._settings.hover.delay}),this._timelineUnhighlight.to(this._material.uniforms.u_highlight_factor,{duration:3,value:this._settings.hover.highlightFactor,ease:"power2.out"},0),this._timelineUnhighlight.to(this._settings.hover,{duration:3,highlightFactor:this._settings.hover.highlightFactor,ease:"power2.out"},0))}},{key:"_updatePosition",value:function(){var progress=(this._scrollPosition+this._transitionPosition)/(this._viewport.height-this._height);this.position.y=this._initialPosition.y+progress*this._settings.scroll.scrollYFactor,this.position.z=this._initialPosition.z-progress*this._settings.scroll.scrollZFactor,this._cssBlock.position.y=this.position.y,this._cssBlock.position.z=this.position.z,this._material.uniforms.u_scroll_progress.value=K.a.easeOutSine(W.a.clamp(1-progress*this._settings.scroll.scrollFadeFactor,0,1)),this._textSettings.scrollProgress=K.a.easeOutSine(W.a.clamp(1-progress*this._settings.scroll.scrollFadeTextFactor*this._settings.scroll.scrollFadeFactor,0,1))}},{key:"_bindAll",value:function(){this._loadTextureHandler=this._loadTextureHandler.bind(this)}},{key:"_loadTextureHandler",value:function(){var e;this._isTextureReady=!0,this._textureWidth=this._texture.image.width,this._textureHeight=this._texture.image.height,null===(e=this._material)||void 0===e||e.uniforms.u_aspect_ratio.value.set(this._textureWidth,this._textureHeight),this._isShowed&&(this.timelineOnLoad=new f.a.timeline,this.timelineOnLoad.to(this._textSettings,{duration:1.7,transitionProgress:1,ease:"sine.inOut"},.5),this.timelineOnLoad.to(this._material.uniforms.u_transition_progress,{duration:1.7,value:1,ease:"sine.inOut"},.5))}},{key:"_intersectionHandler",value:function(e){e?this._mouseenterHandler():this._mouseleaveHandler()}},{key:"_mouseenterHandler",value:function(){var e;X.a.isTouch()||(null===(e=this._timelineLeave)||void 0===e||e.kill(),this._timelineEnter=new f.a.timeline,this._timelineEnter.to(this._material.uniforms.u_hover_scale,{duration:3,value:this._settings.hover.scale,ease:"power2.out"},0),this._timelineEnter.to(this._textSettings,{duration:3,opacityFactor:1,ease:"power2.out"},0),this._timelineEnter.to(this._material.uniforms.u_alpha_factor,{duration:3,value:1,ease:"power2.out"},0))}},{key:"_mouseleaveHandler",value:function(){var e;X.a.isTouch()||(null===(e=this._timelineEnter)||void 0===e||e.kill(),this._timelineLeave=new f.a.timeline,this._timelineLeave.to(this._material.uniforms.u_hover_scale,{duration:4,value:0,ease:"power3.out"},0),this._timelineLeave.to(this._textSettings,{duration:4,opacityFactor:.5,ease:"power3.out"},0),this._timelineLeave.to(this._material.uniforms.u_alpha_factor,{duration:3,value:this._settings.filters.alphaFactor,ease:"power2.out"},0))}},{key:"resize",value:function(e){var t,n=e.width,r=e.height,o=e.viewport;this._width=n,this._height=r,this._viewport=o,this._plane.scale.set(this._width,this._height,1),null===(t=this._material)||void 0===t||t.uniforms.u_resolution.value.set(this._width,this._height),this._resizeIntersectionPlane()}},{key:"_resizeIntersectionPlane",value:function(){this._intersectionPlane.scale.set(this._width,this._height,1)}}]),n}(v.Object3D);function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var ee=function(e){Object(c.a)(n,e);var t=J(n);function n(e){var o,l=e.root,c=e.camera,h=e.scene,d=e.width,f=e.height,m=e.blocks,_=e.container,y=e.scrollPosition;return Object(r.a)(this,n),(o=t.call(this))._root=l,o._camera=c,o._scene=h,o._width=d,o._height=f,o._blocks=m,o._containerElement=_,o._scrollPosition=y,o._isClickEnable=!1,o._settings={damping:.1,mouseScale:.5,scale:.7,positionOnDrag:0,padding:200,zPadding:50,parallax:{scale:"small"===R.a.current?1.04:1.05},filters:{levelFactor:1.6,saturationFactor:1,brightnessFactor:.08,contrastFactor:1,alphaFactor:.5,colorPulseSize:"small"===R.a.current?.85:.8,alphaPulseSize:"small"===R.a.current?1:.75},transition:{fadeLeftFactor:.8},scroll:{scrollFadeFactor:"small"===R.a.current?1:.5,scrollFadeTextFactor:2.5,scrollYFactor:180,scrollZFactor:170},hover:{delay:.1,scale:.05,highlightFactor:.6}},o._sliderPosition=0,o._intersectedSlide=null,o._mousePosition=new v.Vector2(0,0),o._normalizedMousePosition=new v.Vector2(0,0),o._raycasterMousePosition=new v.Vector2(0,0),o._container=new v.Object3D,o.add(o._container),o._cssRenderer=o._createCSSRenderer(),o._cssScene=new v.Scene,o._cssContainer=new v.Object3D,o._cssScene.add(o._cssContainer),o._slides=o._createSlides(),o._intersectionPlanes=o._getIntersectionPlanes(),o._raycaster=new v.Raycaster,o._debugFolder=o._createDebugFolder(),o}return Object(o.a)(n,[{key:"destroy",value:function(){var e;if(this._slides)for(var i=0;i<this._slides.length;i++){this._slides[i].destroy()}this._slides=null,this._container=null,null===(e=this.parent)||void 0===e||e.remove(this)}},{key:"slides",get:function(){return this._slides}},{key:"sliderPosition",get:function(){return this._sliderPosition},set:function(e){this._sliderPosition=e,this.position.x=this._sliderPosition,this._cssContainer.position.x=this._sliderPosition}},{key:"scrollPosition",get:function(){return this._scrollPosition},set:function(e){this._scrollPosition=e}},{key:"transitionIn",value:function(){for(var e=new f.a.timeline,i=0;i<this._slides.length;i++){var t=this._slides[i];e.add(t.show(),0)}return e}},{key:"show",value:function(){for(var e=new f.a.timeline,i=0;i<this._slides.length;i++){var t=this._slides[i];e.add(t.show(),0)}return e}},{key:"hide",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new f.a.timeline,i=0;i<this._slides.length;i++){var n=this._slides[i];t.add(n.hide(),0)}return e&&t.call(this.destroy.bind(this),null),t}},{key:"fadeLeft",value:function(){for(var e=new f.a.timeline,i=0;i<this._slides.length;i++){var t=this._slides[i];e.add(t.fadeLeft(),0)}return e}},{key:"removefadeLeft",value:function(){for(var e=new f.a.timeline,i=0;i<this._slides.length;i++){var t=this._slides[i];e.add(t.removefadeLeft(),0)}return e}},{key:"resizeSlides",value:function(e){var t=e.blocks,n=e.width,r=e.height;this._width=n,this._height=r;var o={width:n,height:r};this._blocks=t;for(var i=0;i<this._slides.length;i++){var l=this._blocks[i],c=l.bounds.width,h=l.bounds.height,d=this._slides[i];d.resize({width:c,height:h,viewport:o}),d.position.x=l.bounds.x-this._width/2+c/2,d.position.y=-l.bounds.y-h/2+this._height/2,d.position.z=l.order*this._settings.zPadding,d.initialPosition=d.position,d.element.style.width="".concat(c,"px"),d.element.style.height="".concat(h,"px"),d.cssBlock.position.copy(d.position)}}},{key:"clickHandler",value:function(e){var t,n=e.position;this._isClickEnable&&(this._raycasterMousePosition.x=n.x/this._width*2-1,this._raycasterMousePosition.y=-n.y/this._height*2+1,this._updateRaycaster(),null===(t=this._intersectedSlide)||void 0===t||t.clickHandler())}},{key:"enableClick",value:function(){this._isClickEnable=!0}},{key:"disableClick",value:function(){this._isClickEnable=!1}},{key:"_createCSSRenderer",value:function(){var e=new Y.b;return e.setSize(this._width,this._height),e.domElement.style.position="absolute",e.domElement.style.top=0,e.domElement.style.left=0,e.domElement.style.pointerEvents="none",this._containerElement.appendChild(e.domElement),e}},{key:"_createSlides",value:function(){var e=[];this._slidesCss=[];for(var i=0;i<this._blocks.length;i++){var t=this._blocks[i],n=t.bounds.width,r=t.bounds.height,o=new Z({root:this._root,index:i,viewport:{width:this._width,height:this._height},width:n,height:r,cssContainer:this._cssContainer,element:t.el,scrollPosition:this._scrollPosition,url:t.url,data:t.data,image:t.image,settings:this._settings,initialPosition:new v.Vector3});o.position.x=t.bounds.x-this._width/2+n/2,o.position.y=-t.bounds.y-r/2+this._height/2,o.position.z=t.order*this._settings.zPadding,o.initialPosition=o.position,o.element.style.width="".concat(n,"px"),o.element.style.height="".concat(r,"px"),o.cssBlock.position.copy(o.position),this._container.add(o),e.push(o)}return e}},{key:"_getIntersectionPlanes",value:function(){for(var e=[],i=0;i<this._slides.length;i++){var t=this._slides[i];e.push(t.intersectionPlane)}return e}},{key:"resize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._cssRenderer.setSize(this._width,this._height)}},{key:"update",value:function(e){e.time;var t=e.mousePosition;this._slides&&(this._mousePosition.x=t.current.x,this._mousePosition.y=t.current.y,this._normalizedMousePosition.x=t.current.normalized.x,this._normalizedMousePosition.y=t.current.normalized.y,this._raycasterMousePosition.x=t.target.x/this._width*2-1,this._raycasterMousePosition.y=-t.target.y/this._height*2+1,this._updateSlides(),X.a.isTouch()||this._updateRaycaster(),this._cssRenderer.render(this._cssScene,this._camera))}},{key:"_updateSlides",value:function(){for(var i=0;i<this._slides.length;i++){var e=this._slides[i],t=this._blocks[i];e.mousePosition=this._mousePosition,e.normalizedMousePosition=this._normalizedMousePosition,e.scrollPosition=this._scrollPosition;var n=t.bounds.x+t.bounds.width/2+this._sliderPosition;e.currentProgress=n/this._width,e.update(),M.a&&(e.settings=this._settings)}}},{key:"_updateRaycaster",value:function(){if(!(this._root.nuxtRoot.$store.getters["menu/isOpen"]||this._root.nuxtRoot.$store.getters["menu/isClosing"]||this._root.nuxtRoot.$store.getters["menu/isOpening"])){this._raycaster.setFromCamera(this._raycasterMousePosition,this._camera);var e=this._raycaster.intersectObjects(this._intersectionPlanes);null!==this._intersectedSlide&&0===e.length&&this._root.nuxtRoot.cursorWork.hover(!1),null===this._intersectedSlide&&e.length>0&&this._root.nuxtRoot.cursorWork.hover(!0),this._intersectedSlide=e[0]?this._slides[e[0].object.index]:null;for(var i=0;i<this._slides.length;i++){var t=this._slides[i];t.isIntersecting=t===this._intersectedSlide,t.intersectedSlide=this._intersectedSlide}this._intersectedSlide?this._containerElement.style.cursor="pointer":this._containerElement.style.cursor="auto"}}},{key:"_createDebugFolder",value:function(){if(M.a){var e=M.a.addGroup("Slider",{container:"Work"});e.add(this._settings,"damping",{min:0,max:1}),e.add(this._settings,"mouseScale",{min:0,max:1}),e.add(this._settings,"positionOnDrag",{min:-300,max:0}),e.addGroup("Parallax").add(this._settings.parallax,"scale",{min:1,max:5});var t=e.addGroup("Filters");t.add(this._settings.filters,"alphaFactor",{min:0,max:10}),t.add(this._settings.filters,"levelFactor",{min:0,max:10}),t.add(this._settings.filters,"saturationFactor",{min:0,max:10}),t.add(this._settings.filters,"brightnessFactor",{min:0,max:10}),t.add(this._settings.filters,"colorPulseSize",{min:0,max:2}),t.add(this._settings.filters,"alphaPulseSize",{min:0,max:2});var n=e.addGroup("Scroll");n.add(this._settings.scroll,"scrollFadeFactor",{min:0,max:10}),n.add(this._settings.scroll,"scrollFadeTextFactor",{min:0,max:10}),n.add(this._settings.scroll,"scrollYFactor",{min:0,max:800}),n.add(this._settings.scroll,"scrollZFactor",{min:0,max:800});var r=e.addGroup("Hover");return r.add(this._settings.hover,"delay",{min:0,max:1}),r.add(this._settings.hover,"scale",{min:0,max:1}),r.add(this._settings.hover,"highlightFactor",{min:0,max:1}),e}}}]),n}(v.Object3D);function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var ne=function(e){Object(c.a)(n,e);var t=te(n);function n(e){var o;return Object(r.a)(this,n),(o=t.call(this))._root=e.root,o._viewport=e.viewport,o._scrollPosition=e.scrollPosition,o._source=e.source,o._width=e.width,o._height=e.height,o._position=e.position,o._bindAll(),o._material=o._createMaterial(),o._plane=o._createPlane(),o._resizePlane(),o}return Object(o.a)(n,[{key:"destroy",value:function(){var e;null===(e=this.parent)||void 0===e||e.remove(this)}},{key:"update",value:function(e){e.time}},{key:"scrollPosition",get:function(){return this._scrollPosition},set:function(e){this._scrollPosition=e,this.position.y=this._scrollPosition}},{key:"show",value:function(){var e=this;this._texture=this._loadTexture().then((function(){f.a.to(e._material.uniforms.u_transition_progress,{duration:1,value:1,ease:"sine.inOut"})}))}},{key:"hide",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new f.a.timeline;return t.to(this._material.uniforms.u_transition_progress,{duration:.5,value:0,ease:"sine.inOut"}),e&&t.call(this.destroy.bind(this),null),t}},{key:"_loadTexture",value:function(){var e=this;return new Promise((function(t){e._material.uniforms.u_texture.value?t():e._material.uniforms.u_texture.value=(new v.TextureLoader).load(e._source,t)}))}},{key:"_createMaterial",value:function(){return new v.ShaderMaterial({depthTest:!1,uniforms:{u_resolution:{value:new v.Vector2(this._width,this._height)},u_time:{value:0},u_texture:{value:null},u_transition_progress:{value:0},u_level_factor:{value:1},u_saturation_factor:{value:1},u_alpha_factor:{value:1}},vertexShader:"#define GLSLIFY 1\nuniform vec2 u_resolution;\n\nvarying vec2 v_uv;\nvarying vec2 v_uv_r;\n\nvec2 resizedUv(vec2 inital_uv, vec2 resolution, vec2 aspect_ratio)\n{\n\tvec2 ratio = vec2(\n\t\tmin((resolution.x / resolution.y) / (aspect_ratio.x / aspect_ratio.y), 1.0),\n\t\tmin((resolution.y / resolution.x) / (aspect_ratio.y / aspect_ratio.x), 1.0)\n\t);\n\n\tvec2 resized_uv = vec2(\n\t\tinital_uv.x * ratio.x + (1.0 - ratio.x) * 0.5,\n\t\tinital_uv.y * ratio.y + (1.0 - ratio.y) * 0.5\n\t);\n\n\treturn resized_uv;\n}\n\nvoid main() {\n    v_uv = uv;\n\n    // Resize\n    // v_uv_r = resizedUv(v_uv, u_resolution, u_aspect_ratio);\n    v_uv_r = v_uv;\n\n\t// Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);;\n}\n",fragmentShader:"#define GLSLIFY 1\nvarying vec2 v_uv_r;\n\nuniform float u_time;\nuniform vec2 u_resolution;\nuniform sampler2D u_texture;\n\nuniform float u_transition_progress;\n\nuniform float u_level_factor;\nuniform float u_saturation_factor;\nuniform float u_alpha_factor;\n\n// Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 finalLevels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con)\n{\n\t// Increase or decrease theese values to adjust r, g and b color channels seperately\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\treturn conColor;\n}\n\nvoid main() {\n    vec2 r_uv = v_uv_r;\n\n    // Original texel\n    vec4 initial_texel = texture2D(u_texture, r_uv);\n\n    // Effect texel\n    vec4 transformed_texel = texture2D(u_texture, r_uv);\n\n    // Color effects values\n    float level = u_transition_progress * u_level_factor;\n    float brightness = 1.0;\n    float saturation = u_transition_progress * u_saturation_factor;\n    float alpha = u_transition_progress * u_alpha_factor;\n    float contrast = 1.0;\n\n    // Levels\n    transformed_texel = vec4(finalLevels(transformed_texel.rgb, 0.0, level, 1.0), 1.0);\n\n    // Contrast & Saturation & Brightness\n    transformed_texel = vec4(ContrastSaturationBrightness(transformed_texel.rgb, brightness, saturation, contrast), 1.0);\n\n    // Alpha\n    transformed_texel *= alpha;\n\n\tgl_FragColor = transformed_texel;\n}\n"})}},{key:"_createPlane",value:function(){var e=new v.PlaneBufferGeometry(1,1,1),t=new v.Mesh(e,this._material);return this.add(t),t}},{key:"_bindAll",value:function(){this.show=this.show.bind(this)}},{key:"resize",value:function(e){var t=e.width,n=e.height,r=e.position,o=e.viewport;this._width=t,this._height=n,this._position=r,this._viewport=o,this._resizePlane()}},{key:"_resizePlane",value:function(){this._plane.scale.set(this._width,this._height,1),this._plane.position.x=this._width/2-this._viewport.width/2+this._position.x,this._plane.position.y=-this._height/2+this._viewport.height/2-this._position.y}}]),n}(v.Object3D);function ie(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var ae=.1,oe={name:"Work",class:H,uiClass:function(e){Object(c.a)(n,e);var t=re(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.config,n=e.root,r=e.renderer,o=e.postProcessing,l=e.width,c=e.height;this._config=t,this._root=n,this._renderer=r,this._postProcessing=o,this._width=l,this._height=c,this._bindAll(),this._mousePosition={target:{x:0,y:0,normalized:{x:0,y:0}},current:{x:0,y:0,normalized:{x:0,y:0}}},this._scrollPosition=$.a.position,this._scene=new v.Scene,this._camera=this._createCamera(),this._components=this._createComponents(),this._images=[],this._setupEventListeners()}},{key:"destroy",value:function(){Object(l.a)(Object(d.a)(n.prototype),"destroy",this).call(this),this._destroyComponents(),this._destroyImages(),this._removeEventListeners()}},{key:"camera",get:function(){return this._camera}},{key:"components",get:function(){return this._components}},{key:"show",value:function(){this._postProcessing.passes.UIRender.scene=this._scene,this._postProcessing.passes.UIRender.camera=this._camera}},{key:"hide",value:function(){this._postProcessing.passes.UIRender.scene=null}},{key:"createSlider",value:function(e){var t=e.blocks,n=e.container,r=new ee({root:this._root,camera:this._camera,scene:this._scene,width:this._width,height:this._height,scrollPosition:this._scrollPosition,blocks:t,container:n});return this._components.slider=r,this._components.slider.transitionIn(),this._scene.add(r),r}},{key:"createImage",value:function(e){var image=new ne(function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ie(Object(source),!0).forEach((function(t){Object(V.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):ie(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({root:this._root,camera:this._camera,viewport:{width:this._width,height:this._height},scrollPosition:this._scrollPosition},e));return this._images.push(image),this._scene.add(image),image}},{key:"_createCamera",value:function(){return new C({width:this._width,height:this._height,perspective:800,near:.1,far:1e4})}},{key:"_createComponents",value:function(){return{}}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_destroyImages",value:function(){for(var i=0;i<this._images.length;i++)this._images[i].destroy()}},{key:"onUpdate",value:function(e){var time=e.time;this._scrollPosition=$.a.position,this._updateMousePosition(),this._updateComponents({time:time}),this._upateImages({time:time})}},{key:"_updateMousePosition",value:function(){this._mousePosition.current.x=W.a.lerp(this._mousePosition.current.x,this._mousePosition.target.x,ae),this._mousePosition.current.y=W.a.lerp(this._mousePosition.current.y,this._mousePosition.target.y,ae),this._mousePosition.current.normalized.x=W.a.lerp(this._mousePosition.current.normalized.x,this._mousePosition.target.normalized.x,ae),this._mousePosition.current.normalized.y=W.a.lerp(this._mousePosition.current.normalized.y,this._mousePosition.target.normalized.y,ae)}},{key:"_updateComponents",value:function(e){var time=e.time;for(var t in this._components)this._components[t].update({time:time,mousePosition:this._mousePosition})}},{key:"_upateImages",value:function(e){for(var time=e.time,i=0;i<this._images.length;i++)this._images[i].update({time:time,mousePosition:this._mousePosition})}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeComponents({width:t,height:n})}},{key:"_resizeComponents",value:function(e){var t=e.width,n=e.height;for(var r in this._components)"function"==typeof this._components[r].resize&&this._components[r].resize({width:t,height:n})}},{key:"_bindAll",value:function(){this._mousemoveHandler=this._mousemoveHandler.bind(this),this._scrollHandler=this._scrollHandler.bind(this)}},{key:"_setupEventListeners",value:function(){window.addEventListener("mousemove",this._mousemoveHandler),$.a.addEventListener("scroll",this._scrollHandler)}},{key:"_removeEventListeners",value:function(){window.removeEventListener("mousemove",this._mousemoveHandler),$.a.removeEventListener("scroll",this._scrollHandler)}},{key:"_mousemoveHandler",value:function(e){this._mousePosition.target.x=e.clientX,this._mousePosition.target.y=e.clientY,this._mousePosition.target.normalized.x=e.clientX/this._width,this._mousePosition.target.normalized.y=1-e.clientY/this._height}},{key:"_scrollHandler",value:function(){for(var e in this._scrollPosition=$.a.position,this._components)"number"==typeof this._components[e].scrollPosition&&(this._components[e].scrollPosition=this._scrollPosition);for(var i=0;i<this._images.length;i++)"number"==typeof this._images[i].scrollPosition&&(this._images[i].scrollPosition=this._scrollPosition)}}]),n}(Object(m.a)()),renderer:{clearColor:"#000000"},postProcessing:{},resources:{preload:{development:!0,production:!0},items:[]}};function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var le={name:"Debug",class:function(e){Object(c.a)(n,e);var t=se(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.config;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._config=l,this._width=null,this._height=null,this._isActive=!1,this._resourceManager=this._createResourceManager(),this._camera=this._createCamera(),y.a.setup()}},{key:"show",value:function(){var e=this;this._resourceManager.load().then((function(){e._isActive=!0,e._root.landscapeManager.show({name:"Ocean"}),e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"debug",isAvailable:!0})}))}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=new f.a.timeline({onComplete:function(){e._isActive=!1,"function"==typeof t&&t()}});return n.call((function(){e._ui&&e._ui.hide(),e._root.nuxtRoot.$store.dispatch("webgl/views/setViewAvailable",{name:"debug",isAvailable:!1})}),null),n}},{key:"render",value:function(){var e=this._root.landscapeManager.active;e&&(y.a.copyRotation(e.camera),this._sceneRenderer.render(e,e.camera.active),this._postProcessing.render(e,e.camera.active))}},{key:"_createResourceManager",value:function(){return new _.c({namespace:this._config.name})}},{key:"_createCamera",value:function(){var e=new v.PerspectiveCamera(50,1,.1,100);return e.position.z=50,e}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._resizeCamera(t,n)}},{key:"_resizeCamera",value:function(e,t){this._camera.aspect=e/t,this._camera.updateProjectionMatrix()}}]),n}(Object(m.a)()),renderer:{clearColor:"#000000",dpr:1},postProcessing:{},resources:{preload:{development:!0,production:!0},items:[]}};t.a=[F,z,oe,le]},function(e,t,n){"use strict";n.d(t,"b",(function(){return jr})),n.d(t,"a",(function(){return K}));n(30),n(23),n(56),n(63),n(27),n(64);var r=n(26),o=n(12),l=(n(112),n(17),n(18),n(15),n(70),n(110),n(16)),c=n(61),h=n(178),d=n(274),f=n.n(d),m=n(153),v=n.n(m),_=(n(72),n(73),n(275)),y=n(91),x=n(14);"scrollRestoration"in window.history&&(Object(x.u)("manual"),window.addEventListener("beforeunload",(function(){Object(x.u)("auto")})),window.addEventListener("load",(function(){Object(x.u)("manual")})));function w(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?w(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):w(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var C=function(){return Object(x.m)(Promise.all([n.e(1),n.e(3),n.e(13)]).then(n.bind(null,668)))},O=function(){return Object(x.m)(Promise.all([n.e(0),n.e(1),n.e(2),n.e(8)]).then(n.bind(null,669)))},L=function(){return Object(x.m)(Promise.all([n.e(0),n.e(10)]).then(n.bind(null,670)))},k=function(){return Object(x.m)(n.e(14).then(n.bind(null,671)))},M=function(){return Object(x.m)(n.e(16).then(n.bind(null,672)))},T=function(){return Object(x.m)(Promise.all([n.e(0),n.e(5),n.e(18)]).then(n.bind(null,673)))},P=function(){return Object(x.m)(n.e(21).then(n.bind(null,674)))},R=function(){return Object(x.m)(Promise.all([n.e(0),n.e(5),n.e(22)]).then(n.bind(null,659)))},D=function(){return Object(x.m)(n.e(23).then(n.bind(null,660)))},A=function(){return Object(x.m)(Promise.all([n.e(4),n.e(19)]).then(n.bind(null,675)))},E=function(){return Object(x.m)(Promise.all([n.e(4),n.e(20)]).then(n.bind(null,661)))},I=function(){return Object(x.m)(Promise.all([n.e(0),n.e(1),n.e(2),n.e(9)]).then(n.bind(null,662)))},j=function(){return Object(x.m)(Promise.all([n.e(0),n.e(11)]).then(n.bind(null,663)))},F=function(){return Object(x.m)(Promise.all([n.e(1),n.e(3),n.e(12)]).then(n.bind(null,664)))},B=function(){return Object(x.m)(n.e(15).then(n.bind(null,665)))},U=function(){return Object(x.m)(n.e(17).then(n.bind(null,666)))},N=function(){};l.a.use(_.a);var z={mode:"history",base:"/",linkActiveClass:"nuxt-link-active",linkExactActiveClass:"nuxt-link-exact-active",scrollBehavior:function(e,t,n){var r=!1,o=e!==t;n?r=n:o&&function(e){var t=Object(x.g)(e);if(1===t.length){var n=t[0].options;return!1!==(void 0===n?{}:n).scrollToTop}return t.some((function(e){var t=e.options;return t&&t.scrollToTop}))}(e)&&(r={x:0,y:0});var l=window.$nuxt;return(!o||e.path===t.path&&e.hash!==t.hash)&&l.$nextTick((function(){return l.$emit("triggerScroll")})),new Promise((function(t){l.$once("triggerScroll",(function(){if(e.hash){var n=e.hash;void 0!==window.CSS&&void 0!==window.CSS.escape&&(n="#"+window.CSS.escape(n.substr(1)));try{document.querySelector(n)&&(r={selector:n})}catch(e){console.warn("Failed to save scroll position. Please add CSS.escape() polyfill (https://github.com/mathiasbynens/CSS.escape).")}}t(r)}))}))},routes:[{path:"/en",component:C,name:"index___en"},{path:"/fr",component:C,name:"index___fr"},{path:"/en/about",component:O,name:"about___en"},{path:"/en/error",component:L,name:"error___en"},{path:"/en/legal-mentions",component:k,name:"legal-mentions___en"},{path:"/en/not-supported",component:M,name:"not-supported___en"},{path:"/en/work",component:T,children:[{path:"",component:P,name:"work___en"},{path:"overview-layout/script",component:R,name:"work-overview-layout-script___en"},{path:"overview/script",component:D,name:"work-overview-script___en"},{path:":slug",component:A,name:"work-slug___en"},{path:":slug/script",component:E,name:"work-slug-script___en"}]},{path:"/fr/about",component:O,name:"about___fr"},{path:"/fr/error",component:L,name:"error___fr"},{path:"/fr/legal-mentions",component:k,name:"legal-mentions___fr"},{path:"/fr/not-supported",component:M,name:"not-supported___fr"},{path:"/fr/work",component:T,children:[{path:"",component:P,name:"work___fr"},{path:"overview-layout/script",component:R,name:"work-overview-layout-script___fr"},{path:"overview/script",component:D,name:"work-overview-script___fr"},{path:":slug",component:A,name:"work-slug___fr"},{path:":slug/script",component:E,name:"work-slug-script___fr"}]},{path:"/en/about/script",component:I,name:"about-script___en"},{path:"/en/error/script",component:j,name:"error-script___en"},{path:"/en/home/script",component:F,name:"home-script___en"},{path:"/en/legal-mentions/script",component:B,name:"legal-mentions-script___en"},{path:"/en/not-supported/script",component:U,name:"not-supported-script___en"},{path:"/fr/about/script",component:I,name:"about-script___fr"},{path:"/fr/error/script",component:j,name:"error-script___fr"},{path:"/fr/home/script",component:F,name:"home-script___fr"},{path:"/fr/legal-mentions/script",component:B,name:"legal-mentions-script___fr"},{path:"/fr/not-supported/script",component:U,name:"not-supported-script___fr"}],fallback:!1};function G(e,t){var base=t._app&&t._app.basePath||z.base,n=new _.a(S(S({},z),{},{base:base})),r=n.push;n.push=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,n=arguments.length>2?arguments[2]:void 0;return r.call(this,e,t,n)};var o=n.resolve.bind(n);return n.resolve=function(e,t,n){return"string"==typeof e&&(e=Object(y.d)(e)),o(e,t,n)},n}var H={name:"NuxtChild",functional:!0,props:{nuxtChildKey:{type:String,default:""},keepAlive:Boolean,keepAliveProps:{type:Object,default:void 0}},render:function(e,t){var n=t.parent,data=t.data,r=t.props,o=n.$createElement;data.nuxtChild=!0;for(var l=n,c=n.$nuxt.nuxt.transitions,h=n.$nuxt.nuxt.defaultTransition,d=0;n;)n.$vnode&&n.$vnode.data.nuxtChild&&d++,n=n.$parent;data.nuxtChildDepth=d;var f=c[d]||h,m={};V.forEach((function(e){void 0!==f[e]&&(m[e]=f[e])}));var v={};W.forEach((function(e){"function"==typeof f[e]&&(v[e]=f[e].bind(l))}));var _=v.beforeEnter;if(v.beforeEnter=function(e){if(window.$nuxt.$nextTick((function(){window.$nuxt.$emit("triggerScroll")})),_)return _.call(l,e)},!1===f.css){var y=v.leave;(!y||y.length<2)&&(v.leave=function(e,t){y&&y.call(l,e),l.$nextTick(t)})}var x=o("routerView",data);return r.keepAlive&&(x=o("keep-alive",{props:r.keepAliveProps},[x])),o("transition",{props:m,on:v},[x])}},V=["name","mode","appear","css","type","duration","enterClass","leaveClass","appearClass","enterActiveClass","enterActiveClass","leaveActiveClass","appearActiveClass","enterToClass","leaveToClass","appearToClass"],W=["beforeEnter","enter","afterEnter","enterCancelled","beforeLeave","leave","afterLeave","leaveCancelled","beforeAppear","appear","afterAppear","appearCancelled"];function $(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var Y={props:["error"],computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?$(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):$(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({isDevelopment:"context/isDevelopment"})),mounted:function(){this.isDevelopment?this.$el.style.opacity=1:this.$router.push(this.localePath("/error"))}},X=(n(391),n(71)),K=Object(X.a)(Y,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"error"},[e._v("\n    "+e._s(e.error)+"\n")])}),[],!1,null,"38e90db5",null).exports,Q=n(24),Z=(n(113),{name:"Nuxt",components:{NuxtChild:H,NuxtError:K},props:{nuxtChildKey:{type:String,default:void 0},keepAlive:Boolean,keepAliveProps:{type:Object,default:void 0},name:{type:String,default:"default"}},errorCaptured:function(e){this.displayingNuxtError&&(this.errorFromNuxtError=e,this.$forceUpdate())},computed:{routerViewKey:function(){if(void 0!==this.nuxtChildKey||this.$route.matched.length>1)return this.nuxtChildKey||Object(x.c)(this.$route.matched[0].path)(this.$route.params);var e=Object(Q.a)(this.$route.matched,1)[0];if(!e)return this.$route.path;var t=e.components.default;if(t&&t.options){var n=t.options;if(n.key)return"function"==typeof n.key?n.key(this.$route):n.key}return/\/$/.test(e.path)?this.$route.path:this.$route.path.replace(/\/$/,"")}},beforeCreate:function(){l.a.util.defineReactive(this,"nuxt",this.$root.$options.nuxt)},render:function(e){var t=this;return this.nuxt.err?this.errorFromNuxtError?(this.$nextTick((function(){return t.errorFromNuxtError=!1})),e("div",{},[e("h2","An error occurred while showing the error page"),e("p","Unfortunately an error occurred and while showing the error page another error occurred"),e("p","Error details: ".concat(this.errorFromNuxtError.toString())),e("nuxt-link",{props:{to:"/"}},"Go back to home")])):(this.displayingNuxtError=!0,this.$nextTick((function(){return t.displayingNuxtError=!1})),e(K,{props:{error:this.nuxt.err}})):e("NuxtChild",{key:this.routerViewKey,props:this.$props})}}),J=(n(74),n(90),n(99),n(100),n(109),{name:"NuxtLoading",data:function(){return{percent:0,show:!1,canSucceed:!0,reversed:!1,skipTimerCount:0,rtl:!1,throttle:200,duration:5e3,continuous:!1}},computed:{left:function(){return!(!this.continuous&&!this.rtl)&&(this.rtl?this.reversed?"0px":"auto":this.reversed?"auto":"0px")}},beforeDestroy:function(){this.clear()},methods:{clear:function(){clearInterval(this._timer),clearTimeout(this._throttle),this._timer=null},start:function(){var e=this;return this.clear(),this.percent=0,this.reversed=!1,this.skipTimerCount=0,this.canSucceed=!0,this.throttle?this._throttle=setTimeout((function(){return e.startTimer()}),this.throttle):this.startTimer(),this},set:function(e){return this.show=!0,this.canSucceed=!0,this.percent=Math.min(100,Math.max(0,Math.floor(e))),this},get:function(){return this.percent},increase:function(e){return this.percent=Math.min(100,Math.floor(this.percent+e)),this},decrease:function(e){return this.percent=Math.max(0,Math.floor(this.percent-e)),this},pause:function(){return clearInterval(this._timer),this},resume:function(){return this.startTimer(),this},finish:function(){return this.percent=this.reversed?0:100,this.hide(),this},hide:function(){var e=this;return this.clear(),setTimeout((function(){e.show=!1,e.$nextTick((function(){e.percent=0,e.reversed=!1}))}),500),this},fail:function(e){return this.canSucceed=!1,this},startTimer:function(){var e=this;this.show||(this.show=!0),void 0===this._cut&&(this._cut=1e4/Math.floor(this.duration)),this._timer=setInterval((function(){e.skipTimerCount>0?e.skipTimerCount--:(e.reversed?e.decrease(e._cut):e.increase(e._cut),e.continuous&&(e.percent>=100||e.percent<=0)&&(e.skipTimerCount=1,e.reversed=!e.reversed))}),100)}},render:function(e){var t=e(!1);return this.show&&(t=e("div",{staticClass:"nuxt-progress",class:{"nuxt-progress-notransition":this.skipTimerCount>0,"nuxt-progress-failed":!this.canSucceed},style:{width:this.percent+"%",left:this.left}})),t}}),ee=(n(393),Object(X.a)(J,undefined,undefined,!1,null,null,null).exports),te=(n(395),n(7)),ne=n(150),ie=n(205),re=n(8),ae=n(0);n(281);function oe(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var se=null;se=n(522);var le={index:"Home",work:"Work",about:"About",debug:"Debug"},ue={computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?oe(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):oe(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({isDevelopment:"context/isDevelopment",isDebug:"context/isDebug",gpuTier:"device/gpuTier",isLoadingStarted:"preloader/isLoadingStarted",isLoadingCompleted:"preloader/isLoadingCompleted"})),watch:{isLoadingStarted:function(){this.setupWebglApp()}},data:function(){return{isState0Active:!1,isState1Active:!1,isState2Active:!1}},created:function(){this.scrollAnimationActive=!1},mounted:function(){this.isLoadingCompleted&&this.setupWebglApp()},beforeDestroy:function(){this.$root.webglApp&&(this.$root.webglApp.destroy(),this.$root.webglApp=null)},methods:{setupWebglApp:function(){if(this.$root.webglApp=new se.default({canvas:this.$refs.canvas,nuxtRoot:this.$root,isDebug:this.isDebug,isDevelopment:this.isDevelopment,gpuTier:this.gpuTier}),this.isLoadingCompleted){this.$root.webglApp.setup();var e=this.getRouteBaseName(),t=le[e];t&&this.$root.webglApp.viewManager.show(t)}}}},ce=(n(440),Object(X.a)(ue,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("canvas",{ref:"canvas",staticClass:"background"})])}),[],!1,null,"424232e3",null).exports),he=n(115),de=n(29),fe={},me=(n(442),Object(X.a)(fe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lang-switch"},[n("div",{staticClass:"container"},[n("NuxtLink",{staticClass:"button",attrs:{to:e.switchLocalePath("fr")}},[e._v("\n            Fr\n        ")]),e._v(" "),n("NuxtLink",{staticClass:"button",attrs:{to:e.switchLocalePath("en")}},[e._v("\n            En\n        ")])],1)])}),[],!1,null,"3936698a",null).exports);function pe(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var ge={mixins:[he.a],computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?pe(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):pe(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({isOpen:"menu/isOpen",isClosing:"menu/isClosing",isOpening:"menu/isOpening"})),watch:{isOpen:function(e){e&&this.open(),e||this.close()},$route:function(){this.$store.dispatch("menu/setClose")}},mounted:function(){},methods:{open:function(){this.$store.dispatch("scroll/lock"),this.transitionIn()},close:function(){this.$store.dispatch("scroll/unlock"),this.transitionOut()},transitionIn:function(){var e,t=this;null===(e=this.timelineOut)||void 0===e||e.kill();this.timelineIn=new te.a.timeline,this.timelineIn.timeScale(.75),this.timelineIn.to(de.a,{duration:2,lowPassFrequency:1e3},0),this.timelineIn.set(this.$refs.diamondTop,{y:"-500%"},0),this.timelineIn.set(this.$refs.diamondBottom,{y:"500%"},0),this.timelineIn.call((function(){t.$store.dispatch("menu/setIsClosing",!1)}),null),this.timelineIn.call((function(){t.$store.dispatch("menu/setIsOpening",!0)}),null),this.timelineIn.add(this.$root.webglApp.showMenu(),0),this.timelineIn.set(this.$el,{autoAlpha:1},0),this.timelineIn.set(this.$refs.navItems,{alpha:1},0),this.timelineIn.fromTo(this.$refs.routeName,{alpha:0},{duration:2,alpha:1,ease:"sine.inOut",stagger:.1},.5);for(var i=0;i<this.$refs.navItems.length;i++){var n=this.$refs.navItems[i].querySelectorAll(".chars"),link=this.$refs.nuxtLink[i].$el,r=.5/n.length,o=new te.a.timeline;o.fromTo(n,{alpha:0},{duration:1.3,alpha:1,ease:"sine.inOut",stagger:r},0),link.classList.contains("nuxt-link-exact-active")||o.to(n,{duration:1.3,alpha:0,ease:"sine.inOut",stagger:r},.8),this.timelineIn.add(o,1.2+.2*i)}this.timelineIn.to(this.$refs.langSwitch.$el,{duration:1.5,alpha:1,ease:"sine.inOut",stagger:.1},1.7),this.timelineIn.to(this.$refs.logoContainer,{duration:1.8,alpha:1,ease:"sine.inOut"},1.7),this.timelineIn.to(this.$refs.diamondTop,{duration:2,y:"0%",ease:"power3.inOut"},1.7),this.timelineIn.to(this.$refs.diamondBottom,{duration:2,y:"0%",ease:"power3.inOut"},1.7),this.timelineIn.call((function(){t.$store.dispatch("menu/setIsOpening",!1)}),null)},transitionOut:function(){var e,t=this;null===(e=this.timelineIn)||void 0===e||e.kill(),this.timelineOut=new te.a.timeline,"index"===this.getRouteBaseName()&&this.timelineOut.to(de.a,{duration:2,lowPassFrequency:0},0),this.timelineOut.call((function(){t.$store.dispatch("menu/setIsOpening",!1)}),null),this.timelineOut.call((function(){t.$store.dispatch("menu/setIsClosing",!0)}),null),this.timelineOut.to(this.$refs.logoContainer,{duration:.8,alpha:0,ease:"sine.out"},0),this.timelineOut.to(this.$refs.navItems,{duration:.8,alpha:0,ease:"sine.out",stagger:-.1},0),this.timelineOut.to(this.$refs.langSwitch.$el,{duration:.8,alpha:0,ease:"sine.out",stagger:-.1},0),this.timelineOut.to(this.$el,{duration:1.5,autoAlpha:0,ease:"sine.out"},.6),this.$root.webglApp.viewManager.active&&"Home"===this.$root.webglApp.viewManager.active.name&&this.timelineOut.add(this.$root.webglApp.hideMenu(this.getRouteBaseName(this.$route)),.6),this.timelineOut.call((function(){t.$store.dispatch("menu/setIsClosing",!1)}),null)},clickHandler:function(e){e.currentTarget.classList.contains("nuxt-link-exact-active")&&this.$store.dispatch("menu/setClose")},randomFromInterval:function(e,t){return Math.random()*(t-e)+e}},components:{TheLangSwitch:me}},ve=(n(444),Object(X.a)(ge,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"menu",class:e.isOpen?"is-open":""},[n("div",{staticClass:"container"},[n("div",{ref:"logoContainer",staticClass:"logo-container"},[n("div",{staticClass:"logo-icon"},[n("div",{ref:"diamondTop",staticClass:"diamond"}),e._v(" "),n("div",{ref:"diamondBottom",staticClass:"diamond"})]),e._v(" "),n("div",{ref:"name",staticClass:"name"},[e._m(0)])]),e._v(" "),n("nav",{staticClass:"navigation"},[n("ul",{staticClass:"navigation-list"},e._l(e.localeCopy.routes,(function(t,i){return n("li",{key:i,ref:"navItems",refInFor:!0,staticClass:"navigation-list-item"},[n("NuxtLink",{ref:"nuxtLink",refInFor:!0,staticClass:"button link",attrs:{to:e.localePath(t.path)},nativeOn:{click:function(t){return e.clickHandler.apply(null,arguments)}}},[n("span",{ref:"routeName",refInFor:!0,staticClass:"route-name"},e._l(t.name.split(""),(function(t,r){return n("span",{key:r},[e._v(e._s(t))])})),0),e._v(" "),n("span",{staticClass:"route-name-chars"},e._l(t.name.split(""),(function(t,r){return n("span",{key:r,ref:"chars",refInFor:!0,staticClass:"chars"},[e._v(e._s(t))])})),0)])],1)})),0),e._v(" "),n("TheLangSwitch",{ref:"langSwitch",staticClass:"lang-switch"})],1)])])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"name-span"},[e._v("\n                    Artisans"),n("br"),e._v("d'idees\n                ")])}],!1,null,"7823738c",null).exports),_e=n(25),ye=n(141),be=n(79),xe=n(55);function we(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var Se={large:10,medium:10,small:10},Ce={large:13,medium:13,small:12},Oe={mixins:[he.a],data:function(){return{circleSize:50,radius:50,lineSize:15,isMuted:!1,isReady:!1}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?we(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):we(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({isDevelopment:"context/isDevelopment",breakpoint:"device/breakpoint",isTouch:"device/isTouch"})),watch:{isMuted:function(e){e?this.mute():this.unmute()}},created:function(){this.isMuted=this.isDevelopment},mounted:function(){this.circleTurnIndex=-1,this.lineRunIndex=-1,this.mousePosition={target:{x:0,y:0},current:{x:0,y:0}},this.mouseAlphaFactor=0,this.resize(),this.isTouch||this.setupEventListeners(),this.isMuted&&de.a.mute(),this.isTouch&&(this.$el.style.opacity=0,this.$el.style.pointerEvents="none")},beforeDestroy:function(){this.isTouch||this.removeEventListeners()},methods:{transitionIn:function(){var e,t=this;return null===(e=this.timelineOut)||void 0===e||e.kill(),this.timelineIn=new te.a.timeline({delay:1}),this.timelineIn.call((function(){t.isReady=!0})),this.timelineIn.set(this.$el,{alpha:1}),this.timelineIn.to(this.$refs.circle,{duration:.8,strokeDashoffset:0,ease:"sine.inOut"},0),this.timelineIn.to(this.$refs.label,{duration:.8,alpha:1,ease:"sine.inOut"},0),this.timelineIn.to(this.$refs.circle,{duration:.8,alpha:.5,ease:"sine.inOut"},.5),this.isMuted&&this.timelineIn.to(this.$refs.line,{duration:.5,strokeDashoffset:this.lineLength*this.lineRunIndex,ease:"sine.out"},1),this.timelineIn},transitionOut:function(){var e;return null===(e=this.timelineIn)||void 0===e||e.kill(),this.timelineOut=new te.a.timeline,this.timelineOut.to(this.$el,{duration:.5,alpha:0}),this.timelineOut},getBounds:function(){this.bounds=this.$el.getBoundingClientRect(),this.charBounds=[];for(var i=0;i<this.$refs.labelChar.length;i++){var e=this.$refs.labelChar[i].getBoundingClientRect();this.charBounds.push(e)}},updateChars:function(){for(var i=0;i<this.$refs.labelChar.length;i++){var e=this.$refs.labelChar[i],t=this.charBounds[i],n=_e.a.distance({x:this.mousePosition.current.x,y:0},{x:t.x+t.width/2,y:0}),r=ye.a.easeInOutQuad(_e.a.clamp(Math.abs(.2*this.bounds.width/n),0,1))*this.mouseAlphaFactor,o=_e.a.clamp(r,.45,1);e.style.opacity=o}},updateMousePosition:function(){this.mousePosition.current.x=_e.a.lerp(this.mousePosition.current.x,this.mousePosition.target.x,.1),this.mousePosition.current.y=_e.a.lerp(this.mousePosition.current.y,this.mousePosition.target.y,.1)},resize:function(){var e=this;this.getBounds(),this.circleSize=this.size(Se[this.breakpoint]),this.radius=this.circleSize/2,this.lineSize=this.size(Ce[this.breakpoint]),this.$nextTick((function(){e.circleLength=e.$refs.circle.getTotalLength()+1,e.$refs.circle.style.strokeDasharray=e.circleLength,e.$refs.circle.style.strokeDashoffset=e.circleLength,e.$refs.circleAnimated.style.strokeDasharray=e.circleLength,e.$refs.circleAnimated.style.strokeDashoffset=e.circleLength,e.$refs.circle.style.strokeDasharray=e.circleLength,e.$refs.circle.style.strokeDashoffset=e.isReady?0:e.circleLength,e.lineLength=e.$refs.line.getTotalLength()+1,e.$refs.line.style.strokeDasharray=e.lineLength,e.$refs.line.style.strokeDashoffset=e.isMuted?0:-e.lineLength}))},mute:function(){var e;de.a.mute(),null===(e=this.timelineUnMute)||void 0===e||e.kill(),this.lineRunIndex++,this.timelineMute=new te.a.timeline,this.timelineMute.to(this.$refs.circle,{duration:.5,alpha:0,ease:"sine.inOut"},0),this.timelineMute.to(this.$refs.circleAnimated,{duration:.5,alpha:0,ease:"sine.inOut"},0),this.timelineMute.to(this.$refs.line,{duration:.5,strokeDashoffset:this.lineLength*this.lineRunIndex,ease:"sine.out"},.4)},unmute:function(){var e;de.a.unmute(),null===(e=this.timelineMute)||void 0===e||e.kill(),this.lineRunIndex++,this.timelineUnMute=new te.a.timeline,this.timelineUnMute.to(this.$refs.line,{duration:.5,strokeDashoffset:this.lineLength*this.lineRunIndex,ease:"sine.out"},0),this.timelineUnMute.to(this.$refs.circle,{duration:.5,alpha:.5,ease:"sine.inOut"},.5),this.timelineUnMute.to(this.$refs.circleAnimated,{duration:.5,alpha:1,ease:"sine.inOut"},.5)},setupEventListeners:function(){window.addEventListener("mousemove",this.mousemoveHandler),xe.a.addEventListener("resize",this.resizeHandler),te.a.ticker.add(this.tickHandler)},removeEventListeners:function(){window.removeEventListener("mousemove",this.mousemoveHandler),xe.a.removeEventListener("resize",this.resizeHandler),te.a.ticker.remove(this.tickHandler)},clickHandler:function(){this.isMuted=!this.isMuted},mouseenterHandler:function(){var e;this.isTouch||(null===(e=this.timelineLeave)||void 0===e||e.kill(),this.circleTurnIndex++,this.timelineEnter=new te.a.timeline,this.timelineEnter.to(this.$refs.circleAnimated,{duration:.8,strokeDashoffset:this.circleTurnIndex*this.circleLength,ease:"power3.out"},0),this.timelineEnter.to(this,{duration:.2,mouseAlphaFactor:1,ease:"sine.inOut"},0))},mouseleaveHandler:function(){var e;this.isTouch||(null===(e=this.timelineEnter)||void 0===e||e.kill(),this.circleTurnIndex++,this.timelineLeave=new te.a.timeline,this.timelineLeave.to(this.$refs.circleAnimated,{duration:.8,strokeDashoffset:this.circleTurnIndex*this.circleLength,ease:"power3.inOut"},0),this.timelineLeave.to(this,{duration:.3,mouseAlphaFactor:0,ease:"sine.inOut"},0))},resizeHandler:function(){this.resize()},tickHandler:function(){this.updateMousePosition(),this.updateChars()},mousemoveHandler:function(e){this.mousePosition.target.x=e.clientX,this.mousePosition.target.y=e.clientY},viewportWidth:function(){var e={small:be.viewportWidthSmall,medium:be.viewportWidthMedium,large:be.viewportWidthLarge}[this.breakpoint];return parseFloat(e)},vw:function(){var e={small:be.fontSizeSmall,medium:be.fontSizeMedium,large:be.fontSizeLarge},t=Math.min(.01*parseFloat(e[this.breakpoint])*xe.a.width,parseFloat(be.maxWithLarge)/100);return t},size:function(e){return e}}},Le=(n(446),Object(X.a)(Oe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"button button-mute",on:{click:e.clickHandler,mouseenter:e.mouseenterHandler,mouseleave:e.mouseleaveHandler}},[n("div",{staticClass:"container"},[n("div",{ref:"label",staticClass:"label"},e._l(e.localeCopy.misc.mute.split(""),(function(t,r){return n("span",{key:r,ref:"labelChar",refInFor:!0},[e._v(e._s(t))])})),0),e._v(" "),n("div",{staticClass:"circle-container"},[n("svg",{ref:"svg",staticClass:"circle-svg",attrs:{width:e.circleSize,height:e.circleSize}},[n("circle",{ref:"circle",staticClass:"circle",attrs:{cx:e.radius,cy:e.radius,r:e.radius}}),e._v(" "),n("circle",{ref:"circleAnimated",staticClass:"circle animated",attrs:{cx:e.radius,cy:e.radius,r:e.radius}}),e._v(" "),n("line",{ref:"line",staticClass:"line",attrs:{x1:e.circleSize-e.lineSize,y1:e.circleSize/2,x2:e.lineSize,y2:e.circleSize/2}})])])])])}),[],!1,null,"99e23fd8",null).exports),ke=n(354),Me=n(180);function Te(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var Pe={data:function(){return{name:["Artisans","d'id√©es"],cursorsBounds:[]}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Te(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Te(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({breakpoint:"device/breakpoint"})),mounted:function(){this.getBounds(),this.setupEventListeners()},beforeDestroy:function(){this.removeEventListeners()},methods:{show:function(){var e=new te.a.timeline({delay:2});return"large"!==this.breakpoint&&e.set(this.$el,{x:this.offsetX},0),e.to(this.$el,{duration:1,alpha:1,ease:"sine.inOut"},0),e},animate:function(){var e=new te.a.timeline;return e.fromTo(this.$refs.topSquare,{y:"-800%"},{duration:1,y:"0%",ease:"power2.inOut"},0),e.fromTo(this.$refs.bottomSquare,{y:"800%"},{duration:1,y:"0%",ease:"power2.inOut"},0),e.to(this.$refs.squares,{duration:1.2,rotate:"180deg",ease:"power3.inOut"},1),e.to(this.$refs.topSquare,{duration:1.2,y:"-800%",ease:"power3.inOut"},1),e.to(this.$refs.bottomSquare,{duration:1.2,y:"800%",ease:"power3.inOut"},1),e},close:function(e){var t=new te.a.timeline({onComplete:e});t.fromTo(this.$refs.topSquare,{y:"-800%"},{duration:1,y:"0%",ease:"power2.inOut"},0),t.fromTo(this.$refs.bottomSquare,{y:"800%"},{duration:1,y:"0%",ease:"power2.inOut"},0)},transitionIn:function(){var e=new te.a.timeline;e.fromTo(this.$refs.squares,{rotate:"0deg"},{duration:1.2,rotate:"180deg",ease:"power3.inOut"},0),e.to(this.$refs.topSquare,{duration:1.2,y:"-800%",ease:"power3.inOut"},0),e.to(this.$refs.bottomSquare,{duration:1.2,y:"800%",ease:"power3.inOut"},0),e.to(this.$refs.topSquare,{duration:1.2,y:"0%",ease:"power3.inOut"},1.2),e.to(this.$refs.bottomSquare,{duration:1.2,y:"0%",ease:"power3.inOut"},1.2),"large"!==this.breakpoint&&(e.to([this.$refs.topSquare,this.$refs.bottomSquare],{duration:1,alpha:0,ease:"sine.inOut"}),e.set(this.$el,{x:0}),e.to([this.$refs.topSquare,this.$refs.bottomSquare],{duration:1,alpha:1,stagger:-.1,ease:"sine.inOut"}));var t="large"!==this.breakpoint?2.9:1.2;return e.to(this.$refs.charWord0,{duration:1,alpha:.2,stagger:.1,ease:"sine.inOut"},t),e.to(this.$refs.charWord1,{duration:1,alpha:.2,stagger:.1,ease:"sine.inOut"},t+.2),e.to(this.$refs.charWord0,{duration:1,alpha:1,stagger:.1,ease:"sine.inOut"},t+1),e.to(this.$refs.charWord1,{duration:1,alpha:1,stagger:.1,ease:"sine.inOut"},t+1+.2),e},transitionOut:function(){var e,t=new te.a.timeline;return"index"!==this.getRouteBaseName()&&t.timeScale(1.2),t.add(null===(e=this.$root.cursorHome)||void 0===e?void 0:e.transitionIn()),t.to(this.$refs.charWord0,{duration:2,alpha:0,stagger:.1,ease:"sine.inOut"},0),t.to(this.$refs.charWord1,{duration:2,alpha:0,stagger:.1,ease:"sine.inOut"},.2),t.to(this.$refs.topSquare,{duration:1.5,alpha:0,ease:"sine.inOut"},.5),t.to(this.$refs.bottomSquare,{duration:1.5,alpha:0,ease:"sine.inOut"},.5),t},getBounds:function(){this.cursorsBounds=[this.$refs.topSquarePlaceholder.getBoundingClientRect(),this.$refs.bottomSquarePlaceholder.getBoundingClientRect()],"large"!==this.breakpoint&&(this.squaresBounds=this.$refs.squares.getBoundingClientRect(),this.width=xe.a.width,this.height=xe.a.height,this.offsetX=this.width/2-(this.squaresBounds.x+this.squaresBounds.width/2))},setupEventListeners:function(){xe.a.addEventListener("resize",this.resizeHandler)},removeEventListeners:function(){xe.a.removeEventListener("resize",this.resizeHandler)},resizeHandler:function(){this.getBounds()}}},Re=(n(448),Object(X.a)(Pe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"logo-animation"},[n("div",{ref:"squares",staticClass:"squares"},[n("div",{ref:"topSquare",staticClass:"square top"}),e._v(" "),n("div",{ref:"bottomSquare",staticClass:"square bottom"}),e._v(" "),n("div",{ref:"topSquarePlaceholder",staticClass:"square top placeholder"}),e._v(" "),n("div",{ref:"bottomSquarePlaceholder",staticClass:"square bottom placeholder"})]),e._v(" "),n("div",{ref:"name",staticClass:"name"},e._l(e.name,(function(t,r){return n("div",{key:r,ref:"word",refInFor:!0,staticClass:"word"},e._l(t.split(""),(function(t,o){return n("span",{key:o,ref:"charWord"+r,refInFor:!0,staticClass:"char"},[e._v(e._s(t))])})),0)})),0)])}),[],!1,null,"07152e2f",null).exports);n(76);function De(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var Ae={mixins:[he.a],props:["state"],data:function(){return{content:this.state,hasMoved:!1}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?De(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):De(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({isTouch:"device/isTouch"})),watch:{state:function(){var e;null===(e=this.timelineUpdate)||void 0===e||e.kill(),this.timelineUpdate=new te.a.timeline,this.timelineUpdate.to(this.$el,{duration:.5,alpha:0}),this.timelineUpdate.call(this.updateContent,null),this.timelineUpdate.to(this.$el,{duration:.5,alpha:1}),this.timelineUpdate.to(this.$refs.cursorMobile,{duration:1,alpha:1,ease:"sine.inOut"},0),this.timelineUpdate.to(this.$refs.cursorMobileChar,{duration:1.5,alpha:1,stagger:.1,ease:"sine.inOut"},.3)},hasMoved:function(){var e=new te.a.timeline;e.to(this.$refs.cursorStatic,{duration:.5,alpha:0,ease:"sine.inOut"},0),e.to(this.$refs.cursor,{duration:.5,alpha:1,ease:"sine.inOut"},0)}},mounted:function(){this.position={current:{x:0,y:0},target:{x:0,y:0}},this.getBounds(),this.setupEventListeners(),this.transitionIn()},beforeDestroy:function(){this.removeEventListeners()},methods:{transitionIn:function(){var e;return null===(e=this.timelineOut)||void 0===e||e.kill(),this.timelineIn=new te.a.timeline,this.timelineIn.to(this.$refs.cursorStatic,{duration:.5,alpha:1,ease:"sine.inOut"},0),this.timelineIn},transitionOut:function(){var e;return null===(e=this.timelineIn)||void 0===e||e.kill(),this.timelineOut=new te.a.timeline,this.timelineOut.to(this.$refs.cursorStatic,{duration:.5,alpha:0,ease:"sine.inOut"},0),this.timelineOut.to(this.$refs.cursor,{duration:.5,alpha:0,ease:"sine.inOut"},0),this.timelineOut},updateContent:function(){this.content=this.state},getBounds:function(){this.isTouch||(this.bounds=this.$el.getBoundingClientRect(),this.cursorBounds=this.$refs.cursor.getBoundingClientRect())},setupEventListeners:function(){this.isTouch||(xe.a.addEventListener("resize",this.resizeHandler),window.addEventListener("mousemove",this.mousemoveHandler),te.a.ticker.add(this.tickHandler))},removeEventListeners:function(){this.isTouch||(xe.a.removeEventListener("resize",this.resizeHandler),window.removeEventListener("mousemove",this.mousemoveHandler),te.a.ticker.remove(this.tickHandler))},resizeHandler:function(){this.$el.style.transform="translate(0px, 0px)",this.getBounds()},mousemoveHandler:function(e){this.position.target.x=e.clientX-this.bounds.x-this.cursorBounds.width/2,this.position.target.y=e.clientY-this.bounds.y,this.hasMoved||(this.position.current.x=this.position.target.x,this.position.current.y=this.position.target.y),this.hasMoved=!0},tickHandler:function(){this.position.current.x=_e.a.lerp(this.position.current.x,this.position.target.x,.15),this.position.current.y=_e.a.lerp(this.position.current.y,this.position.target.y,.15),this.$refs.cursor.style.transform="translate(".concat(this.position.current.x,"px, ").concat(this.position.current.y,"px)")}}},Ee=(n(450),Object(X.a)(Ae,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"cursor-intro"},[n("div",{ref:"cursor",staticClass:"cursor"},[e._v("\n        "+e._s(e.content)+"\n    ")]),e._v(" "),n("div",{ref:"cursorStatic",staticClass:"cursor-static"},[e._v("\n        "+e._s(e.content)+"\n    ")]),e._v(" "),n("div",{ref:"cursorMobile",staticClass:"cursor-mobile"},[n("span",{ref:"cursorContentMobile",staticClass:"content"},e._l(e.localeCopy.misc.enter.split(""),(function(t,r){return n("span",{key:r,ref:"cursorMobileChar",refInFor:!0,staticClass:"char"},[e._v(e._s(t))])})),0)])])}),[],!1,null,"cff97910",null).exports),Ie=n(179),je=n(127),Fe=n(126);function Be(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Ue(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Be(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Be(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var Ne={mixins:[he.a],data:function(){return{isReady:!1,isCookiesAccepted:this.$cookies.get("cookies")}},computed:Ue(Ue({},Object(c.b)({isDevelopment:"context/isDevelopment",isProduction:"context/isProduction",isCompleted:"preloader/isCompleted",isLoadingCompleted:"preloader/isLoadingCompleted",breakpoint:"device/breakpoint"})),{},{cursorText:function(){return this.localeCopy.misc[this.isReady?"explore":"loading"][this.breakpoint]}}),created:function(){this.resourceLoader=this.createResourceLoader()},mounted:function(){this.getGPUTier(),this.$store.dispatch("scroll/lock"),this.transitionIn(),this.loadingAnimation(),this.setupEventListeners(),this.isCookiesAccepted&&Object(Me.a)().then((function(){console.log("GTAG Enabled")}))},beforeDestroy:function(){var e,t,n,r;null===(e=this.timelineIn)||void 0===e||e.kill(),null===(t=this.timelineOut)||void 0===t||t.kill(),null===(n=this.timelineLoading)||void 0===n||n.kill(),null===(r=this.timelineLoadingComplete)||void 0===r||r.kill()},methods:{start:function(){this.transitionOut(),this.$store.dispatch("scroll/unlock")},transitionIn:function(){var e;null===(e=this.timelineOut)||void 0===e||e.kill(),this.timelineIn=new te.a.timeline,this.timelineIn.to(this.$el,{duration:1,alpha:1,ease:"sine.out"},2)},transitionOut:function(){var e,t=this;null===(e=this.timelineIn)||void 0===e||e.kill(),this.timelineOut=new te.a.timeline,this.timelineOut.to(this.$refs.cursor.$el,{duration:1,alpha:0,ease:"sine.inOut"},0),this.timelineOut.to(this.$refs.cookies,{duration:1,alpha:0,ease:"sine.out"},0),"index"===this.getRouteBaseName()?(this.timelineOut.call((function(){t.$root.webglApp.viewManager.show("Home")}),null,0),this.timelineOut.add(this.$refs.logo.transitionOut(),3),this.timelineOut.call(this.remove,null)):(this.timelineOut.add(this.$refs.logo.transitionOut(),0),this.timelineOut.call(this.remove,null))},loadingAnimation:function(){this.$refs.logo.show(),this.timelineLoading=new te.a.timeline({onRepeat:this.loadingAnimationRepeatHandler,repeat:-1,delay:2}),this.timelineLoading.add(this.$refs.logo.animate(),0)},loadingCompleteAnimation:function(){var e=this;this.timelineLoadingComplete=new te.a.timeline,this.isCookiesAccepted||this.timelineLoadingComplete.to(this.$refs.cookies,{duration:1,alpha:1,ease:"sine.out"},1.2),this.timelineLoadingComplete.add(this.$refs.logo.transitionIn(),0),this.timelineLoadingComplete.call((function(){e.isReady=!0}),null),this.timelineLoadingComplete.call((function(){e.$el.style.cursor="pointer"}),null)},remove:function(){this.$store.dispatch("preloader/setCompleted")},setupEventListeners:function(){this.resourceLoader.addEventListener("complete",this.loadResourcesCompleteHandler)},getGPUTier:function(){var e=this;Object(ke.a)({benchmarksURL:"/webgl/misc/benchmarks"}).then((function(t){var n=t.tier;"apple m1 (Apple M1)"===t.gpu&&(n=3),e.$store.dispatch("device/setGpuTier",n),e.$store.dispatch("preloader/setLoadingStarted"),e.resourceLoader.preload()}))},createResourceLoader:function(){var e=new re.b;return e.add({resources:Ie.a,preload:!0}),this.addViewsResources(e),this.addLandscapesResources(e),e},addViewsResources:function(e){for(var view,t,i=0,n=je.a.length;i<n;i++)view=je.a[i],t=!1,(this.isProduction&&view.resources.preload.production||this.isDevelopment&&view.resources.preload.development)&&(t=!0),e.add({resources:view.resources.items,namespace:view.name,preload:t})},addLandscapesResources:function(e){for(var t,n,i=0,r=Fe.a.length;i<r;i++)t=Fe.a[i],n=!1,(this.isProduction&&t.resources.preload.production||this.isDevelopment&&t.resources.preload.development)&&(n=!0),e.add({resources:t.resources.items,namespace:t.name,preload:n})},loadingAnimationRepeatHandler:function(){var e=this;this.isLoadingCompleted&&(this.timelineLoading.kill(),this.$refs.logo.close((function(){e.$root.webglApp.setup((function(){e.isDevelopment&&(e.remove(),e.$store.dispatch("scroll/unlock"),"index"===e.getRouteBaseName()&&e.$root.webglApp.viewManager.show("Home")),e.loadingCompleteAnimation()}))})))},clickHandler:function(){this.isReady&&(this.start(),this.$cookies.set("cookies",!0,{expires:new Date((new Date).getTime()+2592e6),maxAge:2592e6}),Object(Me.a)().then((function(){console.log("GTAG Enabled")})))},loadResourcesCompleteHandler:function(){this.$store.dispatch("preloader/setLoadingCompleted")}},components:{TheLogoAnimation:Re,TheCursorIntro:Ee}},ze=(n(452),Object(X.a)(Ne,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"preloader",on:{click:e.clickHandler}},[n("TheLogoAnimation",{ref:"logo",staticClass:"logo-animation"}),e._v(" "),n("TheCursorIntro",{ref:"cursor",attrs:{state:e.cursorText}}),e._v(" "),n("div",{ref:"cookies",staticClass:"cookies-message paragraph"},[e._v("\n        "+e._s(e.localeCopy.misc.cookies.message)+"\n    ")])],1)}),[],!1,null,"278753da",null).exports),Ge={mixins:[he.a],data:function(){return{accepted:this.$cookies.get("cookies")}},mounted:function(){this.accepted&&this.$ga.enable()},methods:{clickHandler:function(){this.$cookies.set("cookies",!0,{expires:new Date((new Date).getTime()+2592e6),maxAge:2592e6}),this.$ga.enable()}}},He=(n(454),Object(X.a)(Ge,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.accepted?e._e():n("div",{staticClass:"cookie-message"},[n("span",[e._v(e._s(e.localeCopy.misc.cookies.message))]),e._v(" "),n("button",{staticClass:"button",on:{click:e.clickHandler}},[e._v("\n        "+e._s(e.localeCopy.misc.cookies.agree)+"\n    ")])])}),[],!1,null,"4e0c4033",null).exports);function Ve(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function We(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Ve(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Ve(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var $e={computed:We(We({},Object(c.b)({isMenuOpen:"menu/isOpen",isPreloaderCompleted:"preloader/isCompleted"})),{},{isHome:function(){return"index"===this.getRouteBaseName(this.$route)}}),watch:{isPreloaderCompleted:function(){de.a.playMainTrack()},isMenuOpen:function(e){e?(de.a.muteLandscape(),de.a.unmuteMain()):this.isHome&&(de.a.muteMain(),de.a.unmuteLandscape())},isHome:function(e){e?(de.a.unmuteLandscape(),de.a.muteMain()):(de.a.muteLandscape(),de.a.unmuteMain())}},mounted:function(){this.isHome?de.a.unmuteLandscape():de.a.unmuteMain()}},qe=(n(456),Object(X.a)($e,(function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"audio-controller"})}),[],!1,null,"5d87bb12",null).exports),Ye=(n(10),n(2)),Xe=n(3),Ke=n(4),Qe=n(5),Ze=n(1);function Je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var et=function(e){Object(Ke.a)(n,e);var t=Je(n);function n(){return Object(Ye.a)(this,n),t.apply(this,arguments)}return Object(Xe.a)(n,[{key:"load",value:function(e){var path=e.path,t=e.name,image=new Image,n=new Promise((function(e,n){image.addEventListener("load",(function(){e(image)})),image.addEventListener("error",(function(e){n(new Error('ImageLoader : Error while loading resource "'.concat(t,'"')))}))}));return image.src=path,n}}]),n}(re.a),tt=n(355),nt=n.n(tt);function it(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var at=function(e){Object(Ke.a)(n,e);var t=it(n);function n(){return Object(Ye.a)(this,n),t.apply(this,arguments)}return Object(Xe.a)(n,[{key:"load",value:function(e){var path=e.path;return new Promise((function(e,t){nt()(path,(function(n,r){n&&t(new Error(n)),e(r)}))}))}}]),n}(re.a);function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var st=function(e){Object(Ke.a)(n,e);var t=ot(n);function n(){return Object(Ye.a)(this,n),t.apply(this,arguments)}return Object(Xe.a)(n,[{key:"load",value:function(e){var t=e.name,path=e.path;return new Promise((function(e,n){de.a.load(t,path).then((function(audio){e(audio)}))}))}}]),n}(re.a);function lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var ut=function(e){Object(Ke.a)(n,e);var t=lt(n);function n(e){var r;return Object(Ye.a)(this,n),(r=t.call(this,e))._loader=new ae.TextureLoader,r}return Object(Xe.a)(n,[{key:"load",value:function(e){var t=this,path=e.path;return new Promise((function(e,n){t._loader.load(path,e,null,n)}))}}]),n}(re.a);n(172),n(173),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(88),n(146),n(148),n(31),n(124),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(89),n(92);function ct(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function ht(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ct(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):ct(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var mt=new WeakMap,pt=function(e){Object(Ke.a)(n,e);var t=ft(n);function n(e){var r;return Object(Ye.a)(this,n),(r=t.call(this,e)).transcoderPath="",r.transcoderBinary=null,r.transcoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.workerConfig=null,r}return Object(Xe.a)(n,[{key:"setTranscoderPath",value:function(path){return this.transcoderPath=path,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"detectSupport",value:function(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}},{key:"load",value:function(e,t,n,r){var o=this,l=new ae.FileLoader(this.manager);l.setResponseType("arraybuffer"),l.setWithCredentials(this.withCredentials);var c=new ae.CompressedTexture;return l.load(e,(function(e){if(mt.has(e))return mt.get(e).promise.then(t).catch(r);o._createTexture([e]).then((function(e){e.constructor!==c.constructor&&(c=new e.constructor),c.copy(e),c.needsUpdate=!0,t&&t(c)})).catch(r)}),n,r),c}},{key:"parseInternalAsync",value:function(e){for(var t=e.levels,n=new Set,i=0;i<t.length;i++)n.add(t[i].data.buffer);return this._createTexture(Array.from(n),ht(ht({},e),{},{lowLevel:!0}))}},{key:"_createTexture",value:function(e){for(var t,n,r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=o,c=0,i=0;i<e.length;i++)c+=e[i].byteLength;var h=this._allocateWorker(c).then((function(o){return t=o,n=r.workerNextTaskID++,new Promise((function(r,o){t._callbacks[n]={resolve:r,reject:o},t.postMessage({type:"transcode",id:n,buffers:e,taskConfig:l},e)}))})).then((function(e){var t=e.mipmaps,n=e.cubeImages,r=e.width,o=e.height,l=e.format;if(n){for(var c=[],h=0;h<n.length;h++){var d=new ae.CompressedTexture([n[h]],r,o,l,ae.UnsignedByteType);d.minFilter=ae.LinearFilter,d.magFilter=ae.LinearFilter,d.generateMipmaps=!1,d.needsUpdate=!0,c.push(d)}var f=new ae.CubeTexture(c);return f.minFilter=c[0].minFilter,f.magFilter=c[0].magFilter,f.format=c[0].format,f.encoding=c[0].encoding,f.generateMipmaps=!1,f.needsUpdate=!0,f}var m=new ae.CompressedTexture(t,r,o,l,ae.UnsignedByteType);return m.minFilter=1===t.length?ae.LinearFilter:ae.LinearMipmapLinearFilter,m.magFilter=ae.LinearFilter,m.generateMipmaps=!1,m.needsUpdate=!0,m}));return h.catch((function(){return!0})).then((function(){t&&n&&(t._taskLoad-=c,delete t._callbacks[n])})),mt.set(e[0],{promise:h}),h}},{key:"_initTranscoder",value:function(){var e=this;if(!this.transcoderPending){var t=new ae.FileLoader(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);var r=new Promise((function(e,n){t.load("basis_transcoder.js",e,void 0,n)})),o=new ae.FileLoader(this.manager);o.setPath(this.transcoderPath),o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials);var l=new Promise((function(e,t){o.load("basis_transcoder.wasm",e,void 0,t)}));this.transcoderPending=Promise.all([r,l]).then((function(t){var r=Object(Q.a)(t,2),o=r[0],l=r[1],c=n.BasisWorker.toString(),body=["/* constants */","let _EngineFormat = "+JSON.stringify(n.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(n.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(n.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([body])),e.transcoderBinary=l}))}return this.transcoderPending}},{key:"_allocateWorker",value:function(e){var t=this;return this._initTranscoder().then((function(){if(t.workerPool.length<t.workerLimit){var n=new Worker(t.workerSourceURL);n._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:t.workerConfig,transcoderBinary:t.transcoderBinary}),n.onmessage=function(e){var t=e.data;switch(t.type){case"transcode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(n)}else t.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));var r=t.workerPool[t.workerPool.length-1];return r._taskLoad+=e,r}))}},{key:"dispose",value:function(){for(var i=0;i<this.workerPool.length;i++)this.workerPool[i].terminate();return this.workerPool.length=0,this}}]),n}(ae.Loader);function gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}pt.BasisFormat={ETC1S:0,UASTC_4x4:1},pt.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},pt.EngineFormat={RGBAFormat:ae.RGBAFormat,RGBA_ASTC_4x4_Format:ae.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:ae.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:ae.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:ae.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:ae.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:ae.RGB_ETC1_Format,RGB_ETC2_Format:ae.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:ae.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:ae.RGB_S3TC_DXT1_Format},pt.BasisWorker=function(){var e,t,n,r=_EngineFormat,o=_TranscoderFormat,l=_BasisFormat;onmessage=function(r){var o,c=r.data;switch(c.type){case"init":e=c.config,o=c.transcoderBinary,t=new Promise((function(e){n={wasmBinary:o,onRuntimeInitialized:e},BASIS(n)})).then((function(){n.initializeBasis()}));break;case"transcode":t.then((function(){try{var e=c.taskConfig.lowLevel?function(e){var t=e.basisFormat,r=e.width,o=e.height,c=e.hasAlpha,h=f(t,r,o,c),d=h.transcoderFormat,x=h.engineFormat,w=n.getBytesPerBlockOrPixel(d);m(n.isFormatSupported(d),"THREE.BasisTextureLoader: Unsupported format.");var S=[];if(t===l.ETC1S){var C=new n.LowLevelETC1SImageTranscoder,O=e.globalData,L=O.endpointCount,k=O.endpointsData,M=O.selectorCount,T=O.selectorsData,P=O.tablesData;try{m(C.decodePalettes(L,k,M,T),"THREE.BasisTextureLoader: decodePalettes() failed."),m(C.decodeTables(P),"THREE.BasisTextureLoader: decodeTables() failed.");for(var i=0;i<e.levels.length;i++){var R=e.levels[i],D=e.globalData.imageDescs[i],A=y(d,R.width,R.height),E=new Uint8Array(A);m(C.transcodeImage(d,E,A/w,R.data,v(d,R.width),_(d,R.height),R.width,R.height,R.index,D.rgbSliceByteOffset,D.rgbSliceByteLength,D.alphaSliceByteOffset,D.alphaSliceByteLength,D.imageFlags,c,!1,0,0),"THREE.BasisTextureLoader: transcodeImage() failed for level "+R.index+"."),S.push({data:E,width:R.width,height:R.height})}}finally{C.delete()}}else for(var I=0;I<e.levels.length;I++){var j=e.levels[I],F=y(d,j.width,j.height),B=new Uint8Array(F);m(n.transcodeUASTCImage(d,B,F/w,j.data,v(d,j.width),_(d,j.height),j.width,j.height,j.index,0,j.data.byteLength,0,c,!1,0,0,-1,-1),"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+j.index+"."),S.push({data:B,width:j.width,height:j.height})}return{width:r,height:o,hasAlpha:c,mipmaps:S,format:x}}(c.taskConfig):function(e){var t=new n.BasisFile(new Uint8Array(e)),r=t.isUASTC()?l.UASTC_4x4:l.ETC1S,o=t.getImageWidth(0,0),c=t.getImageHeight(0,0),h=t.getNumLevels(0),d=t.getHasAlpha(),m=t.getNumImages();function v(){t.close(),t.delete()}var _=f(r,o,c,d),y=_.transcoderFormat,x=_.engineFormat;if(!o||!c||!h)throw v(),new Error("THREE.BasisTextureLoader:\tInvalid texture");if(!t.startTranscoding())throw v(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");if(1===m){for(var w=[],S=0;S<h;S++){var C=t.getImageWidth(0,S),O=t.getImageHeight(0,S),L=new Uint8Array(t.getImageTranscodedSizeInBytes(0,S,y));if(!t.transcodeImage(L,0,S,y,0,d))throw v(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");w.push({data:L,width:C,height:O})}return v(),{width:o,height:c,hasAlpha:d,mipmaps:w,format:x}}if(6===m){for(var k=[],i=0;i<m;i++){var M=0,T=t.getImageWidth(i,M),P=t.getImageHeight(i,M),R=new Uint8Array(t.getImageTranscodedSizeInBytes(i,M,y));if(!t.transcodeImage(R,i,M,y,0,d))throw v(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");k.push({data:R,width:T,height:P})}return v(),{width:o,height:c,hasAlpha:d,cubeImages:k,format:x}}throw new Error("THREE.BasisTextureLoader: Array textures are not currently supported.")}(c.buffers[0]),t=e.width,r=e.height,o=e.hasAlpha,h=e.mipmaps,d=e.cubeImages,x=e.format,w=[];if(d){for(var i=0;i<d.length;i++)w.push(d[i].data.buffer);self.postMessage({type:"transcode",id:c.id,width:t,height:r,hasAlpha:o,cubeImages:d,format:x},w)}else{for(var S=0;S<h.length;++S)w.push(h[S].data.buffer);self.postMessage({type:"transcode",id:c.id,width:t,height:r,hasAlpha:o,mipmaps:h,format:x},w)}}catch(e){console.error(e),self.postMessage({type:"error",id:c.id,error:e.message})}}))}};var c=[{if:"astcSupported",basisFormat:[l.UASTC_4x4],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.BC1,o.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC1],engineFormat:[r.RGB_ETC1_Format,r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=c.sort((function(a,b){return a.priorityETC1S-b.priorityETC1S})),d=c.sort((function(a,b){return a.priorityUASTC-b.priorityUASTC}));function f(t,n,c,f){for(var m=t===l.ETC1S?h:d,i=0;i<m.length;i++){var v=m[i];if(e[v.if]&&(v.basisFormat.includes(t)&&(!v.needsPowerOfTwo||x(n)&&x(c))))return{transcoderFormat:v.transcoderFormat[f?1:0],engineFormat:v.engineFormat[f?1:0]}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:o.RGBA32,engineFormat:r.RGBAFormat}}function m(e,t){if(!e)throw new Error(t)}function v(e,t){return Math.ceil(t/n.getFormatBlockWidth(e))}function _(e,t){return Math.ceil(t/n.getFormatBlockHeight(e))}function y(e,t,r){var l=n.getBytesPerBlockOrPixel(e);if(n.formatIsUncompressed(e))return t*r*l;if(e===o.PVRTC1_4_RGB||e===o.PVRTC1_4_RGBA){var c=t+3&-4,h=r+3&-4;return(Math.max(8,c)*Math.max(8,h)*4+7)/8}return v(e,t)*_(e,r)*l}function x(e){return e<=2||0==(e&e-1)&&0!==e}};var vt=function(e){Object(Ke.a)(n,e);var t=gt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(Ye.a)(this,n),(e=t.call(this,r))._loader=new pt,e._transcoderPath=r.transcoderPath,e._renderer=r.renderer,!e._transcoderPath)throw new Error("ThreeBasisTextureLoader: transcoderPath is not defined");if(!e._renderer)throw new Error("ThreeBasisTextureLoader: renderer is not defined");return e._loader.setTranscoderPath(e._transcoderPath),e._loader.detectSupport(e._renderer),e}return Object(Xe.a)(n,[{key:"load",value:function(e){var t=this,path=e.path;return new Promise((function(e,n){t._loader.load(path,e,null,n)}))}}]),n}(re.a),_t=n(78),yt=(n(236),n(202),n(67),n(237),n(324),n(147),n(105));function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var xt=new WeakMap,wt=function(e){Object(Ke.a)(n,e);var t=bt(n);function n(e){var r;return Object(Ye.a)(this,n),(r=t.call(this,e)).decoderPath="",r.decoderConfig={},r.decoderBinary=null,r.decoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},yt.a.isSafari()?r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Uint16Array",uv:"Float32Array",uv2:"Float32Array",skinIndex:"Uint8Array",skinWeight:"Float32Array"}:r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},r}return Object(Xe.a)(n,[{key:"setDecoderPath",value:function(path){return this.decoderPath=path,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,r){var o=this,l=new ae.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(e){var n={attributeIDs:o.defaultAttributeIDs,attributeTypes:o.defaultAttributeTypes,useUniqueIDs:!1};o.decodeGeometry(e,n).then(t).catch(r)}),n,r)}},{key:"decodeDracoFile",value:function(e,t,n,r){var o;o=yt.a.isSafari()?{attributeIDs:n||this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!!n}:{attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n},this.decodeGeometry(e,o).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var r in t.attributeTypes){var o=t.attributeTypes[r];void 0!==o.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=o.name)}var l,c=JSON.stringify(t);if(xt.has(e)){var h=xt.get(e);if(h.key===c)return h.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var d=this.workerNextTaskID++,f=e.byteLength,m=this._getWorker(d,f).then((function(n){return l=n,new Promise((function(n,r){l._callbacks[d]={resolve:n,reject:r},l.postMessage({type:"decode",id:d,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return m.catch((function(){return!0})).then((function(){l&&d&&n._releaseTask(l,d)})),xt.set(e,{key:c,promise:m}),m}},{key:"_createGeometry",value:function(e){var t=new ae.BufferGeometry;e.index&&t.setIndex(new ae.BufferAttribute(e.index.array,1));for(var i=0;i<e.attributes.length;i++){var n=e.attributes[i],r=n.name,o=n.array,l=n.itemSize;t.setAttribute(r,new ae.BufferAttribute(o,l))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new ae.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==("undefined"==typeof WebAssembly?"undefined":Object(_t.a)(WebAssembly))||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var r=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var o=St.toString(),body=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([body]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var r=new Worker(n.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(r)}else n.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));var o=n.workerPool[n.workerPool.length-1];return o._taskCosts[e]=t,o._taskLoad+=t,o}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var i=0;i<this.workerPool.length;++i)this.workerPool[i].terminate();return this.workerPool.length=0,this}}]),n}(ae.Loader);function St(){var e,t;function n(e,t,n,r,o,l){var c=l.num_components(),h=n.num_points()*c,d=h*o.BYTES_PER_ELEMENT,f=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,o),m=e._malloc(d);t.GetAttributeDataArrayForAllPoints(n,l,f,d,m);var v=new o(e.HEAPF32.buffer,m,h).slice();return e._free(m),{name:r,array:v,itemSize:c}}onmessage=function(r){var o=r.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var l=o.buffer,c=o.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,h=new t.DecoderBuffer;h.Init(new Int8Array(l),l.byteLength);try{var d=function(e,t,r,o){var l,c,h=o.attributeIDs,d=o.attributeTypes,f=t.GetEncodedGeometryType(r);if(f===e.TRIANGULAR_MESH)l=new e.Mesh,c=t.DecodeBufferToMesh(r,l);else{if(f!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");l=new e.PointCloud,c=t.DecodeBufferToPointCloud(r,l)}if(!c.ok()||0===l.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+c.error_msg());var m={index:null,attributes:[]};for(var v in h){var _=self[d[v]],y=void 0,x=void 0;if(o.useUniqueIDs)x=h[v],y=t.GetAttributeByUniqueId(l,x);else{if(-1===(x=t.GetAttributeId(l,e[h[v]])))continue;y=t.GetAttribute(l,x)}m.attributes.push(n(e,t,l,v,_,y))}f===e.TRIANGULAR_MESH&&(m.index=function(e,t,n){var r=3*n.num_faces(),o=4*r,l=e._malloc(o);t.GetTrianglesUInt32Array(n,o,l);var c=new Uint32Array(e.HEAPF32.buffer,l,r).slice();return e._free(l),{array:c,itemSize:1}}(e,t,l));return e.destroy(l),m}(t,r,h,c),f=d.attributes.map((function(e){return e.array.buffer}));d.index&&f.push(d.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:d},f)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(h),t.destroy(r)}}))}}}var Ct=n(28),Ot=n(6);n(96),n(254),n(255),n(85),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(474);function Lt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var Tt=function(e){Object(Ke.a)(n,e);var t=Mt(n);function n(e){var r;return Object(Ye.a)(this,n),(r=t.call(this,e)).dracoLoader=null,r.ktx2Loader=null,r.meshoptDecoder=null,r.pluginCallbacks=[],r.register((function(e){return new Et(e)})),r.register((function(e){return new Ut(e)})),r.register((function(e){return new Nt(e)})),r.register((function(e){return new It(e)})),r.register((function(e){return new jt(e)})),r.register((function(e){return new Ft(e)})),r.register((function(e){return new Bt(e)})),r.register((function(e){return new Dt(e)})),r.register((function(e){return new zt(e)})),r}return Object(Xe.a)(n,[{key:"load",value:function(e,t,n,r){var o,l=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ae.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);var c=function(t){r?r(t):console.error(t),l.manager.itemError(e),l.manager.itemEnd(e)},h=new ae.FileLoader(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,(function(data){try{l.parse(data,o,(function(n){t(n),l.manager.itemEnd(e)}),c)}catch(e){c(e)}}),n,c)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return this.pluginCallbacks.includes(e)||this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return this.pluginCallbacks.includes(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(data,path,e,t){var content,n={},r={};if("string"==typeof data)content=data;else if(ae.LoaderUtils.decodeText(new Uint8Array(data,0,4))===Gt){try{n[Rt.KHR_BINARY_GLTF]=new Wt(data)}catch(e){return void(t&&t(e))}content=n[Rt.KHR_BINARY_GLTF].content}else content=ae.LoaderUtils.decodeText(new Uint8Array(data));var o=JSON.parse(content);if(void 0===o.asset||o.asset.version[0]<2)t&&t(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new Cn(o,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(var i=0;i<this.pluginCallbacks.length;i++){var c=this.pluginCallbacks[i](l);r[c.name]=c,n[c.name]=!0}if(o.extensionsUsed)for(var h=0;h<o.extensionsUsed.length;++h){var d=o.extensionsUsed[h],f=o.extensionsRequired||[];switch(d){case Rt.KHR_MATERIALS_UNLIT:n[d]=new At;break;case Rt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:n[d]=new Xt;break;case Rt.KHR_DRACO_MESH_COMPRESSION:n[d]=new $t(o,this.dracoLoader);break;case Rt.KHR_TEXTURE_TRANSFORM:n[d]=new qt;break;case Rt.KHR_MESH_QUANTIZATION:n[d]=new Kt;break;default:f.includes(d)&&void 0===r[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(n),l.setPlugins(r),l.parse(e,t)}}}]),n}(ae.Loader);function Pt(){var e={};return{get:function(t){return e[t]},add:function(t,object){e[t]=object},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var Rt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Dt=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return Object(Xe.a)(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var o=t[n];o.extensions&&o.extensions[this.name]&&void 0!==o.extensions[this.name].light&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var o,l=t.json,c=((l.extensions&&l.extensions[this.name]||{}).lights||[])[e],h=new ae.Color(16777215);void 0!==c.color&&h.fromArray(c.color);var d=void 0!==c.range?c.range:0;switch(c.type){case"directional":(o=new ae.DirectionalLight(h)).target.position.set(0,0,-1),o.add(o.target);break;case"point":(o=new ae.PointLight(h)).distance=d;break;case"spot":(o=new ae.SpotLight(h)).distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,o.angle=c.spot.outerConeAngle,o.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return o.position.set(0,0,0),o.decay=2,void 0!==c.intensity&&(o.intensity=c.intensity),o.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(o),t.cache.add(n,r),r}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(e){return n._getNodeRef(t.cache,o,e)}))}}]),e}(),At=function(){function e(){Object(Ye.a)(this,e),this.name=Rt.KHR_MATERIALS_UNLIT}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(){return ae.MeshBasicMaterial}},{key:"extendParams",value:function(e,t,n){var r=[];e.color=new ae.Color(1,1,1),e.opacity=1;var o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var l=o.baseColorFactor;e.color.fromArray(l),e.opacity=l[3]}void 0!==o.baseColorTexture&&r.push(n.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(r)}}]),e}(),Et=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_MATERIALS_CLEARCOAT}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ae.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var o=[],l=r.extensions[this.name];if(void 0!==l.clearcoatFactor&&(t.clearcoat=l.clearcoatFactor),void 0!==l.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",l.clearcoatTexture)),void 0!==l.clearcoatRoughnessFactor&&(t.clearcoatRoughness=l.clearcoatRoughnessFactor),void 0!==l.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),void 0!==l.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",l.clearcoatNormalTexture)),void 0!==l.clearcoatNormalTexture.scale)){var c=l.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ae.Vector2(c,c)}return Promise.all(o)}}]),e}(),It=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_MATERIALS_TRANSMISSION}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ae.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var o=[],l=r.extensions[this.name];return void 0!==l.transmissionFactor&&(t.transmission=l.transmissionFactor),void 0!==l.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",l.transmissionTexture)),Promise.all(o)}}]),e}(),jt=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_MATERIALS_VOLUME}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ae.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var o=[],l=r.extensions[this.name];t.thickness=void 0!==l.thicknessFactor?l.thicknessFactor:0,void 0!==l.thicknessTexture&&o.push(n.assignTexture(t,"thicknessMap",l.thicknessTexture)),t.attenuationDistance=l.attenuationDistance||0;var c=l.attenuationColor||[1,1,1];return t.attenuationTint=new ae.Color(c[0],c[1],c[2]),Promise.all(o)}}]),e}(),Ft=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_MATERIALS_IOR}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ae.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}]),e}(),Bt=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_MATERIALS_SPECULAR}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ae.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var o=[],l=r.extensions[this.name];t.specularIntensity=void 0!==l.specularFactor?l.specularFactor:1,void 0!==l.specularTexture&&o.push(n.assignTexture(t,"specularIntensityMap",l.specularTexture));var c=l.specularColorFactor||[1,1,1];return t.specularTint=new ae.Color(c[0],c[1],c[2]),void 0!==l.specularColorTexture&&o.push(n.assignTexture(t,"specularTintMap",l.specularColorTexture).then((function(e){e.encoding=ae.sRGBEncoding}))),Promise.all(o)}}]),e}(),Ut=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.KHR_TEXTURE_BASISU}return Object(Xe.a)(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var o=r.extensions[this.name],source=n.images[o.source],l=t.options.ktx2Loader;if(!l){if(n.extensionsRequired&&n.extensionsRequired.includes(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,source,l)}}]),e}(),Nt=function(){function e(t){Object(Ye.a)(this,e),this.parser=t,this.name=Rt.EXT_TEXTURE_WEBP,this.isSupported=null}return Object(Xe.a)(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;var l=o.extensions[t],source=r.images[l.source],c=n.textureLoader;if(source.uri){var h=n.options.manager.getHandler(source.uri);null!==h&&(c=h)}return this.detectSupport().then((function(o){if(o)return n.loadTextureImage(e,source,c);if(r.extensionsRequired&&r.extensionsRequired.includes(t))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var image=new Image;image.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",image.onload=image.onerror=function(){e(1===image.height)}}))),this.isSupported}}]),e}(),zt=function(){function e(t){Object(Ye.a)(this,e),this.name=Rt.EXT_MESHOPT_COMPRESSION,this.parser=t}return Object(Xe.a)(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),l=this.parser.options.meshoptDecoder;if(!l||!l.supported){if(t.extensionsRequired&&t.extensionsRequired.includes(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,l.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,o=r.count,c=r.byteStride,h=new ArrayBuffer(o*c),source=new Uint8Array(e[0],t,n);return l.decodeGltfBuffer(new Uint8Array(h),o,c,source,r.mode,r.filter),h}))}return null}}]),e}(),Gt="glTF",Ht=1313821514,Vt=5130562,Wt=function e(data){Object(Ye.a)(this,e),this.name=Rt.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(data,0,12);if(this.header={magic:ae.LoaderUtils.decodeText(new Uint8Array(data.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Gt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=this.header.length-12,r=new DataView(data,12),o=0;o<n;){var l=r.getUint32(o,!0);o+=4;var c=r.getUint32(o,!0);if(o+=4,c===Ht){var h=new Uint8Array(data,12+o,l);this.content=ae.LoaderUtils.decodeText(h)}else if(c===Vt){var d=12+o;this.body=data.slice(d,d+l)}o+=l}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")},$t=function(){function e(t,n){if(Object(Ye.a)(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Rt.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return Object(Xe.a)(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,c={},h={},d={};for(var f in l){var m=dn[f]||f.toLowerCase();c[m]=l[f]}for(var v in e.attributes){var _=dn[v]||v.toLowerCase();if(void 0!==l[v]){var y=n.accessors[e.attributes[v]],x=ln[y.componentType];d[_]=x,h[_]=!0===y.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],o=h[n];void 0!==o&&(r.normalized=o)}t(e)}),c,d)}))}))}}]),e}(),qt=function(){function e(){Object(Ye.a)(this,e),this.name=Rt.KHR_TEXTURE_TRANSFORM}return Object(Xe.a)(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),Yt=function(e){Object(Ke.a)(n,e);var t=Mt(n);function n(e){var r;Object(Ye.a)(this,n),(r=t.call(this)).isGLTFSpecularGlossinessMaterial=!0;var o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),l=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),c=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),d=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),f={specular:{value:(new ae.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return r._extraUniforms=f,r.onBeforeCompile=function(e){for(var t in f)e.uniforms[t]=f[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",l).replace("#include <roughnessmap_fragment>",c).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",d)},Object.defineProperties(Object(Ct.a)(r),{specular:{get:function(){return f.specular.value},set:function(e){f.specular.value=e}},specularMap:{get:function(){return f.specularMap.value},set:function(e){f.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return f.glossiness.value},set:function(e){f.glossiness.value=e}},glossinessMap:{get:function(){return f.glossinessMap.value},set:function(e){f.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete r.metalness,delete r.roughness,delete r.metalnessMap,delete r.roughnessMap,r.setValues(e),r}return Object(Xe.a)(n,[{key:"copy",value:function(source){return Object(Ot.a)(Object(Ze.a)(n.prototype),"copy",this).call(this,source),this.specularMap=source.specularMap,this.specular.copy(source.specular),this.glossinessMap=source.glossinessMap,this.glossiness=source.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(ae.MeshStandardMaterial),Xt=function(){function e(){Object(Ye.a)(this,e),this.name=Rt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return Object(Xe.a)(e,[{key:"getMaterialType",value:function(){return Yt}},{key:"extendParams",value:function(e,t,n){var r=t.extensions[this.name];e.color=new ae.Color(1,1,1),e.opacity=1;var o=[];if(Array.isArray(r.diffuseFactor)){var l=r.diffuseFactor;e.color.fromArray(l),e.opacity=l[3]}if(void 0!==r.diffuseTexture&&o.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new ae.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new ae.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var c=r.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",c)),o.push(n.assignTexture(e,"specularMap",c))}return Promise.all(o)}},{key:"createMaterial",value:function(e){var t=new Yt(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=ae.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}]),e}(),Kt=function e(){Object(Ye.a)(this,e),this.name=Rt.KHR_MESH_QUANTIZATION},Qt=function(e){Object(Ke.a)(n,e);var t=Mt(n);function n(e,r,o,l){return Object(Ye.a)(this,n),t.call(this,e,r,o,l)}return Object(Xe.a)(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r,i=0;i!==r;i++)t[i]=n[o+i];return t}}]),n}(ae.Interpolant);Qt.prototype.beforeStart_=Qt.prototype.copySampleValue_,Qt.prototype.afterEnd_=Qt.prototype.copySampleValue_,Qt.prototype.interpolate_=function(e,t,n,r){for(var o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,h=2*c,d=3*c,td=r-t,p=(n-t)/td,f=p*p,m=f*p,v=e*d,_=v-d,y=-2*m+3*f,x=m-f,w=1-y,S=x-f+p,i=0;i!==c;i++){var C=l[_+i+c],O=l[_+i+h]*td,L=l[v+i+c],k=l[v+i]*td;o[i]=w*C+S*O+y*L+x*k}return o};var Zt=new ae.Quaternion,Jt=function(e){Object(Ke.a)(n,e);var t=Mt(n);function n(){return Object(Ye.a)(this,n),t.apply(this,arguments)}return Object(Xe.a)(n,[{key:"interpolate_",value:function(e,t,r,o){var l=Object(Ot.a)(Object(Ze.a)(n.prototype),"interpolate_",this).call(this,e,t,r,o);return Zt.fromArray(l).normalize().toArray(l),l}}]),n}(Qt),en=0,tn=1,nn=2,rn=3,an=4,on=5,sn=6,ln={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},un={9728:ae.NearestFilter,9729:ae.LinearFilter,9984:ae.NearestMipmapNearestFilter,9985:ae.LinearMipmapNearestFilter,9986:ae.NearestMipmapLinearFilter,9987:ae.LinearMipmapLinearFilter},cn={33071:ae.ClampToEdgeWrapping,33648:ae.MirroredRepeatWrapping,10497:ae.RepeatWrapping},hn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},mn={CUBICSPLINE:void 0,LINEAR:ae.InterpolateLinear,STEP:ae.InterpolateDiscrete},pn="OPAQUE",gn="MASK",vn="BLEND";function _n(e,path){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(path)&&/^\//.test(e)&&(path=path.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:path+e)}function yn(e,object,t){for(var n in t.extensions)void 0===e[n]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[n]=t.extensions[n])}function bn(object,e){void 0!==e.extras&&("object"===Object(_t.a)(e.extras)?Object.assign(object.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function xn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(var o=0,l=r.length;o<l;o++)e.morphTargetDictionary[r[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function wn(e){for(var t="",n=Object.keys(e).sort(),i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function Sn(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var Cn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(Ye.a)(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Pt,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new ae.ImageBitmapLoader(this.options.manager):this.textureLoader=new ae.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ae.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return Object(Xe.a)(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var l={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};yn(o,l,r),bn(l,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(l)}))).then((function(){e(l)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,o=t.length;r<o;r++)for(var l=t[r].joints,i=0,c=l.length;i<c;i++)e[l[i]].isBone=!0;for(var h=0,d=e.length;h<d;h++){var f=e[h];void 0!==f.mesh&&(this._addNodeRef(this.meshCache,f.mesh),void 0!==f.skin&&(n[f.mesh].isSkinnedMesh=!0)),void 0!==f.camera&&this._addNodeRef(this.cameraCache,f.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,object){var n=this;if(e.refs[t]<=1)return object;var r=object.clone();return function e(t,r){var o=n.associations.get(t);null!=o&&n.associations.set(r,o);var l,c=Lt(t.children.entries());try{for(c.s();!(l=c.n()).done;){var h=Object(Q.a)(l.value,2),i=h[0];e(h[1],r.children[i])}}catch(e){c.e(e)}finally{c.f()}}(object,r),r.name+="_instance_"+e.uses[t]++,r}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var i=0;i<t.length;i++){var n=e(t[i]);if(n)return n}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var r=e(t[i]);r&&n.push(r)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this,defs=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(defs.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Rt.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,o){n.load(_n(t.uri,r.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var o=[];return void 0!==r.bufferView?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),void 0!==r.sparse&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then((function(e){var o,l,c=e[0],h=hn[r.type],d=ln[r.componentType],f=d.BYTES_PER_ELEMENT,m=f*h,v=r.byteOffset||0,_=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,y=!0===r.normalized;if(_&&_!==m){var x=Math.floor(v/_),w="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+x+":"+r.count,S=t.cache.get(w);S||(o=new d(c,x*_,r.count*_/f),S=new ae.InterleavedBuffer(o,_/f),t.cache.add(w,S)),l=new ae.InterleavedBufferAttribute(S,h,v%_/f,y)}else o=null===c?new d(r.count*h):new d(c,v,r.count*h),l=new ae.BufferAttribute(o,h,y);if(void 0!==r.sparse){var C=hn.SCALAR,O=ln[r.sparse.indices.componentType],L=r.sparse.indices.byteOffset||0,k=r.sparse.values.byteOffset||0,M=new O(e[1],L,r.sparse.count*C),T=new d(e[2],k,r.sparse.count*h);null!==c&&(l=new ae.BufferAttribute(l.array.slice(),l.itemSize,l.normalized));for(var i=0,P=M.length;i<P;i++){var R=M[i];if(l.setX(R,T[i*h]),h>=2&&l.setY(R,T[i*h+1]),h>=3&&l.setZ(R,T[i*h+2]),h>=4&&l.setW(R,T[i*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return l}))}},{key:"loadTexture",value:function(e){var t=this.json,n=this.options,r=t.textures[e],source=t.images[r.source],o=this.textureLoader;if(source.uri){var l=n.manager.getHandler(source.uri);null!==l&&(o=l)}return this.loadTextureImage(e,source,o)}},{key:"loadTextureImage",value:function(e,source,t){var n=this,r=this.json,o=this.options,l=r.textures[e],c=(source.uri||source.bufferView)+":"+l.sampler;if(this.textureCache[c])return this.textureCache[c];var h=self.URL||self.webkitURL,d=source.uri||"",f=!1;if(void 0!==source.bufferView)d=n.getDependency("bufferView",source.bufferView).then((function(e){f=!0;var t=new Blob([e],{type:source.mimeType});return d=h.createObjectURL(t)}));else if(void 0===source.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var m=Promise.resolve(d).then((function(e){return new Promise((function(n,r){var l=n;!0===t.isImageBitmapLoader&&(l=function(e){var t=new ae.Texture(e);t.needsUpdate=!0,n(t)}),t.load(_n(e,o.path),l,void 0,r)}))})).then((function(t){!0===f&&h.revokeObjectURL(d),t.flipY=!1,l.name&&(t.name=l.name);var o=(r.samplers||{})[l.sampler]||{};return t.magFilter=un[o.magFilter]||ae.LinearFilter,t.minFilter=un[o.minFilter]||ae.LinearMipmapLinearFilter,t.wrapS=cn[o.wrapS]||ae.RepeatWrapping,t.wrapT=cn[o.wrapT]||ae.RepeatWrapping,n.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",d),null}));return this.textureCache[c]=m,m}},{key:"assignTexture",value:function(e,t,n){var r=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Rt.KHR_TEXTURE_TRANSFORM]){var l=void 0!==n.extensions?n.extensions[Rt.KHR_TEXTURE_TRANSFORM]:void 0;if(l){var c=r.associations.get(o);o=r.extensions[Rt.KHR_TEXTURE_TRANSFORM].extendTexture(o,l),r.associations.set(o,c)}}return e[t]=o,o}))}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,r=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,l=void 0===t.attributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new ae.PointsMaterial,ae.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(c,h)),n=h}else if(e.isLine){var d="LineBasicMaterial:"+n.uuid,f=this.cache.get(d);f||(f=new ae.LineBasicMaterial,ae.Material.prototype.copy.call(f,n),f.color.copy(n.color),this.cache.add(d,f)),n=f}if(r||o||l){var m="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(m+="specular-glossiness:"),r&&(m+="derivative-tangents:"),o&&(m+="vertex-colors:"),l&&(m+="flat-shading:");var v=this.cache.get(m);v||(v=n.clone(),o&&(v.vertexColors=!0),l&&(v.flatShading=!0),r&&(v.normalScale&&(v.normalScale.y*=-1),v.clearcoatNormalScale&&(v.clearcoatNormalScale.y*=-1)),this.cache.add(m,v),this.associations.set(v,this.associations.get(n))),n=v}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return ae.MeshStandardMaterial}},{key:"loadMaterial",value:function(e){var t,n=this,r=this.json,o=this.extensions,l=r.materials[e],c={},h=l.extensions||{},d=[];if(h[Rt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var f=o[Rt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=f.getMaterialType(),d.push(f.extendParams(c,l,n))}else if(h[Rt.KHR_MATERIALS_UNLIT]){var m=o[Rt.KHR_MATERIALS_UNLIT];t=m.getMaterialType(),d.push(m.extendParams(c,l,n))}else{var v=l.pbrMetallicRoughness||{};if(c.color=new ae.Color(1,1,1),c.opacity=1,Array.isArray(v.baseColorFactor)){var _=v.baseColorFactor;c.color.fromArray(_),c.opacity=_[3]}void 0!==v.baseColorTexture&&d.push(n.assignTexture(c,"map",v.baseColorTexture)),c.metalness=void 0!==v.metallicFactor?v.metallicFactor:1,c.roughness=void 0!==v.roughnessFactor?v.roughnessFactor:1,void 0!==v.metallicRoughnessTexture&&(d.push(n.assignTexture(c,"metalnessMap",v.metallicRoughnessTexture)),d.push(n.assignTexture(c,"roughnessMap",v.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),d.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,c)}))))}!0===l.doubleSided&&(c.side=ae.DoubleSide);var y=l.alphaMode||pn;if(y===vn?(c.transparent=!0,c.depthWrite=!1):(c.format=ae.RGBFormat,c.transparent=!1,y===gn&&(c.alphaTest=void 0!==l.alphaCutoff?l.alphaCutoff:.5)),void 0!==l.normalTexture&&t!==ae.MeshBasicMaterial&&(d.push(n.assignTexture(c,"normalMap",l.normalTexture)),c.normalScale=new ae.Vector2(1,1),void 0!==l.normalTexture.scale)){var x=l.normalTexture.scale;c.normalScale.set(x,x)}return void 0!==l.occlusionTexture&&t!==ae.MeshBasicMaterial&&(d.push(n.assignTexture(c,"aoMap",l.occlusionTexture)),void 0!==l.occlusionTexture.strength&&(c.aoMapIntensity=l.occlusionTexture.strength)),void 0!==l.emissiveFactor&&t!==ae.MeshBasicMaterial&&(c.emissive=(new ae.Color).fromArray(l.emissiveFactor)),void 0!==l.emissiveTexture&&t!==ae.MeshBasicMaterial&&d.push(n.assignTexture(c,"emissiveMap",l.emissiveTexture)),Promise.all(d).then((function(){var r;return c&&c.format&&delete c.format,r=t===Yt?o[Rt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new t(c),l.name&&(r.name=l.name),r.map&&(r.map.encoding=ae.sRGBEncoding),r.emissiveMap&&(r.emissiveMap.encoding=ae.sRGBEncoding),bn(r,l),n.associations.set(r,{materials:e}),l.extensions&&yn(o,r,l),r}))}},{key:"createUniqueName",value:function(e){for(var t=ae.PropertyBinding.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,r=this.primitiveCache;function o(e){return n[Rt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return Ln(n,e,t)}))}for(var l,c,h=[],i=0,d=e.length;i<d;i++){var f=e[i],m=(c=void 0,(c=(l=f).extensions&&l.extensions[Rt.KHR_DRACO_MESH_COMPRESSION])?"draco:"+c.bufferView+":"+c.indices+":"+wn(c.attributes):l.indices+":"+wn(l.attributes)+":"+l.mode),v=r[m];if(v)h.push(v.promise);else{var _=void 0;_=f.extensions&&f.extensions[Rt.KHR_DRACO_MESH_COMPRESSION]?o(f):Ln(new ae.BufferGeometry,f,t),r[m]={primitive:f,promise:_},h.push(_)}}return Promise.all(h)}},{key:"loadMesh",value:function(e){for(var t,n=this,r=this.json,o=this.extensions,l=r.meshes[e],c=l.primitives,h=[],i=0,d=c.length;i<d;i++){var f=void 0===c[i].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new ae.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ae.FrontSide})),t.DefaultMaterial):this.getDependency("material",c[i].material);h.push(f)}return h.push(n.loadGeometries(c)),Promise.all(h).then((function(t){for(var r=t.slice(0,t.length-1),h=t[t.length-1],d=[],f=0,m=h.length;f<m;f++){var v=h[f],_=c[f],y=void 0,x=r[f];if(_.mode===an||_.mode===on||_.mode===sn||void 0===_.mode)!0!==(y=!0===l.isSkinnedMesh?new ae.SkinnedMesh(v,x):new ae.Mesh(v,x)).isSkinnedMesh||y.geometry.attributes.skinWeight.normalized||y.normalizeSkinWeights(),_.mode===on?y.geometry=kn(y.geometry,ae.TriangleStripDrawMode):_.mode===sn&&(y.geometry=kn(y.geometry,ae.TriangleFanDrawMode));else if(_.mode===tn)y=new ae.LineSegments(v,x);else if(_.mode===rn)y=new ae.Line(v,x);else if(_.mode===nn)y=new ae.LineLoop(v,x);else{if(_.mode!==en)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+_.mode);y=new ae.Points(v,x)}Object.keys(y.geometry.morphAttributes).length>0&&xn(y,l),y.name=n.createUniqueName(l.name||"mesh_"+e),bn(y,l),_.extensions&&yn(o,y,_),n.assignFinalMaterial(y),d.push(y)}for(var w=0,S=d.length;w<S;w++)n.associations.set(d[w],{meshes:e,primitives:w});if(1===d.length)return d[0];var C=new ae.Group;n.associations.set(C,{meshes:e});for(var O=0,L=d.length;O<L;O++)C.add(d[O]);return C}))}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new ae.PerspectiveCamera(ae.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new ae.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),bn(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}},{key:"loadAnimation",value:function(e){for(var t=this.json.animations[e],n=[],r=[],o=[],l=[],c=[],i=0,h=t.channels.length;i<h;i++){var d=t.channels[i],f=t.samplers[d.sampler],m=d.target,v=void 0!==m.node?m.node:m.id,input=void 0!==t.parameters?t.parameters[f.input]:f.input,output=void 0!==t.parameters?t.parameters[f.output]:f.output;n.push(this.getDependency("node",v)),r.push(this.getDependency("accessor",input)),o.push(this.getDependency("accessor",output)),l.push(f),c.push(m)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(c)]).then((function(n){for(var r=n[0],o=n[1],l=n[2],c=n[3],h=n[4],d=[],f=function(e,t){var n=r[e],f=o[e],m=l[e],v=c[e],_=h[e];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var y=void 0;switch(fn[_.path]){case fn.weights:y=ae.NumberKeyframeTrack;break;case fn.rotation:y=ae.QuaternionKeyframeTrack;break;case fn.position:case fn.scale:default:y=ae.VectorKeyframeTrack}var x=n.name?n.name:n.uuid,w=void 0!==v.interpolation?mn[v.interpolation]:ae.InterpolateLinear,S=[];fn[_.path]===fn.weights?n.traverse((function(object){!0===object.isMesh&&object.morphTargetInfluences&&S.push(object.name?object.name:object.uuid)})):S.push(x);var C=m.array;if(m.normalized){for(var O=Sn(C.constructor),L=new Float32Array(C.length),k=0,M=C.length;k<M;k++)L[k]=C[k]*O;C=L}for(var T=0,P=S.length;T<P;T++){var track=new y(S[T]+"."+fn[_.path],f.array,C,w);"CUBICSPLINE"===v.interpolation&&(track.createInterpolant=function(e){return new(this instanceof ae.QuaternionKeyframeTrack?Jt:Qt)(this.times,this.values,this.getValueSize()/3,e)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),d.push(track)}},m=0,v=r.length;m<v;m++)f(m);var _=t.name?t.name:"animation_"+e;return new ae.AnimationClip(_,void 0,d)}))}},{key:"createNodeMesh",value:function(e){var t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(var i=0,t=r.weights.length;i<t;i++)e.morphTargetInfluences[i]=r.weights[i]})),t}))}},{key:"loadNode",value:function(e){var t,n,r=this.json,o=this.extensions,l=this,c=r.nodes[e],h=c.name?l.createUniqueName(c.name):"";return(t=[],n=l._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)})),n&&t.push(n),void 0!==c.camera&&t.push(l.getDependency("camera",c.camera).then((function(e){return l._getNodeRef(l.cameraCache,c.camera,e)}))),l._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===c.isBone?new ae.Bone:t.length>1?new ae.Group:1===t.length?t[0]:new ae.Object3D)!==t[0])for(var i=0,r=t.length;i<r;i++)n.add(t[i]);if(c.name&&(n.userData.name=c.name,n.name=h),bn(n,c),c.extensions&&yn(o,n,c),void 0!==c.matrix){var d=new ae.Matrix4;d.fromArray(c.matrix),n.applyMatrix4(d)}else void 0!==c.translation&&n.position.fromArray(c.translation),void 0!==c.rotation&&n.quaternion.fromArray(c.rotation),void 0!==c.scale&&n.scale.fromArray(c.scale);return l.associations.has(n)||l.associations.set(n,{}),l.associations.get(n).nodes=e,n}))}},{key:"loadScene",value:function(e){var t=this.json,n=this.extensions,r=this.json.scenes[e],o=this,l=new ae.Group;r.name&&(l.name=o.createUniqueName(r.name)),bn(l,r),r.extensions&&yn(n,l,r);for(var c=r.nodes||[],h=[],i=0,d=c.length;i<d;i++)h.push(On(c[i],l,t,o));return Promise.all(h).then((function(){return o.associations=function(e){var t,n=new Map,r=Lt(o.associations);try{for(r.s();!(t=r.n()).done;){var l=Object(Q.a)(t.value,2),c=l[0],h=l[1];(c instanceof ae.Material||c instanceof ae.Texture)&&n.set(c,h)}}catch(e){r.e(e)}finally{r.f()}return e.traverse((function(e){var t=o.associations.get(e);null!=t&&n.set(e,t)})),n}(l),l}))}}]),e}();function On(e,t,n,r){var o=n.nodes[e];return r.getDependency("node",e).then((function(e){return void 0===o.skin?e:r.getDependency("skin",o.skin).then((function(e){for(var n=[],i=0,o=(t=e).joints.length;i<o;i++)n.push(r.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],o=[],l=0,c=n.length;l<c;l++){var h=n[l];if(h){r.push(h);var d=new ae.Matrix4;void 0!==t.inverseBindMatrices&&d.fromArray(t.inverseBindMatrices.array,16*l),o.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}e.bind(new ae.Skeleton(r,o),e.matrixWorld)}})),e}));var t})).then((function(e){t.add(e);var l=[];if(o.children)for(var c=o.children,i=0,h=c.length;i<h;i++){var d=c[i];l.push(On(d,e,n,r))}return Promise.all(l)}))}function Ln(e,t,n){var r=t.attributes,o=[];function l(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var c in r){var h=dn[c]||c.toLowerCase();h in e.attributes||o.push(l(r[c],h))}if(void 0!==t.indices&&!e.index){var d=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(d)}return bn(e,t),function(e,t,n){var r=t.attributes,o=new ae.Box3;if(void 0!==r.POSITION){var l=n.json.accessors[r.POSITION],c=l.min,h=l.max;if(void 0!==c&&void 0!==h){if(o.set(new ae.Vector3(c[0],c[1],c[2]),new ae.Vector3(h[0],h[1],h[2])),l.normalized){var d=Sn(ln[l.componentType]);o.min.multiplyScalar(d),o.max.multiplyScalar(d)}var f=t.targets;if(void 0!==f){for(var m=new ae.Vector3,v=new ae.Vector3,i=0,_=f.length;i<_;i++){var y=f[i];if(void 0!==y.POSITION){var x=n.json.accessors[y.POSITION],w=x.min,S=x.max;if(void 0!==w&&void 0!==S){if(v.setX(Math.max(Math.abs(w[0]),Math.abs(S[0]))),v.setY(Math.max(Math.abs(w[1]),Math.abs(S[1]))),v.setZ(Math.max(Math.abs(w[2]),Math.abs(S[2]))),x.normalized){var C=Sn(ln[x.componentType]);v.multiplyScalar(C)}m.max(v)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(m)}e.boundingBox=o;var O=new ae.Sphere;o.getCenter(O.center),O.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=O}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,o=!1,i=0,l=t.length;i<l;i++){var c=t[i];if(void 0!==c.POSITION&&(r=!0),void 0!==c.NORMAL&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(e);for(var h=[],d=[],f=0,m=t.length;f<m;f++){var v=t[f];if(r){var _=void 0!==v.POSITION?n.getDependency("accessor",v.POSITION):e.attributes.position;h.push(_)}if(o){var y=void 0!==v.NORMAL?n.getDependency("accessor",v.NORMAL):e.attributes.normal;d.push(y)}}return Promise.all([Promise.all(h),Promise.all(d)]).then((function(t){var n=t[0],l=t[1];return r&&(e.morphAttributes.position=n),o&&(e.morphAttributes.normal=l),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function kn(e,t){var n=e.getIndex();if(null===n){var r=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)r.push(i);e.setIndex(r),n=e.getIndex()}var l=n.count-2,c=[];if(t===ae.TriangleFanDrawMode)for(var h=1;h<=l;h++)c.push(n.getX(0)),c.push(n.getX(h)),c.push(n.getX(h+1));else for(var d=0;d<l;d++)d%2==0?(c.push(n.getX(d)),c.push(n.getX(d+1)),c.push(n.getX(d+2))):(c.push(n.getX(d+2)),c.push(n.getX(d+1)),c.push(n.getX(d)));c.length/3!==l&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var f=e.clone();return f.setIndex(c),f}function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var Tn=function(e){Object(Ke.a)(n,e);var t=Mn(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Ye.a)(this,n),(e=t.call(this,r))._dracoDecoderPath=r.dracoDecoderPath,e._gltfLoader=new Tt,e._dracoDecoderPath&&(e._dracoLoader=new wt,e._dracoLoader.setDecoderPath(e._dracoDecoderPath),e._gltfLoader.setDRACOLoader(e._dracoLoader)),e}return Object(Xe.a)(n,[{key:"load",value:function(e){var t=this,path=e.path;return new Promise((function(e,n){t._gltfLoader.load(path,e,null,n)}))}}]),n}(re.a),Pn=n(360);function Rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var Dn=function(e){Object(Ke.a)(n,e);var t=Rn(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(Ye.a)(this,n),(e=t.call(this,r))._loader=new Pn.a,e._transcoderPath=r.transcoderPath,e._renderer=r.renderer,!e._transcoderPath)throw new Error("ThreeKTX2TextureLoader: transcoderPath is not defined");if(!e._renderer)throw new Error("ThreeKTX2TextureLoader: renderer is not defined");return e._loader.setTranscoderPath(e._transcoderPath),e._loader.detectSupport(e._renderer),e}return Object(Xe.a)(n,[{key:"load",value:function(e){var t=this,path=e.path;return new Promise((function(e,n){t._loader.load(path,e,null,n)}))}}]),n}(re.a),An=n(356);function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var In=function(e){Object(Ke.a)(n,e);var t=En(n);function n(e){var r;return Object(Ye.a)(this,n),(r=t.call(this,e))._loader=new An.a,r._loader.setDataType(ae.UnsignedByteType),r}return Object(Xe.a)(n,[{key:"load",value:function(e){var t=this,path=e.path;return new Promise((function(e,n){t._loader.load(path,e,null,n)}))}}]),n}(re.a);function jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(Ze.a)(e);if(t){var o=Object(Ze.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(Qe.a)(this,n)}}var Fn=function(e){Object(Ke.a)(n,e);var t=jn(n);function n(){return Object(Ye.a)(this,n),t.apply(this,arguments)}return Object(Xe.a)(n,[{key:"load",value:function(e){var path=e.path,t=e.name;return new Promise((function(e,n){var r=new XMLHttpRequest;r.addEventListener("load",(function(){var data=JSON.parse(r.response);e(data)})),r.addEventListener("error",(function(){n(new Error('ImageLoader : Error while loading resource "'.concat(t,'"')))})),r.open("GET",path),r.send()}))}}]),n}(re.a);function Bn(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Un(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Bn(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Bn(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}te.a.registerPlugin(ie.a),te.a.registerPlugin(ne.a);var Nn={computed:Un(Un({},Object(c.b)({isDebug:"context/isDebug",isCompleted:"preloader/isCompleted",isLoadingCompleted:"preloader/isLoadingCompleted"})),{},{routeName:function(){return this.getRouteBaseName()}}),watch:{$route:function(e,t){this.$store.dispatch("router/setCurrent",e),this.$store.dispatch("router/setPrevious",t)},isCompleted:function(e){e&&this.transitionIn()}},mounted:function(){this.$root.logoAnimation=this.$refs.preloader.$refs.logo,this.$store.dispatch("router/setCurrent",this.$route),this.registerLoaders()},destroyed:function(){this.removeDebugger()},methods:{transitionIn:function(){(new te.a.timeline).add(this.$refs.buttonMute.transitionIn(),0)},registerLoaders:function(){var e=new ae.WebGLRenderer;re.b.registerLoader(et,"image"),re.b.registerLoader(In,"hdr"),re.b.registerLoader(ut,"texture"),re.b.registerLoader(at,"BMFont"),re.b.registerLoader(st,"audio"),re.b.registerLoader(Fn,"json"),re.b.registerLoader(vt,"basis",{transcoderPath:"/webgl/libs/basis/",renderer:e}),re.b.registerLoader(Tn,"gltf",{dracoDecoderPath:"/webgl/libs/draco/"}),re.b.registerLoader(Dn,"ktx",{transcoderPath:"/webgl/libs/basis/",renderer:e})}},components:{WebglBackground:ce,TheMenu:ve,TheButtonMute:Le,ThePreloader:ze,TheCookieMessage:He,AudioController:qe}},zn=(n(475),Object(X.a)(Nn,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("WebglBackground",{ref:"webglBackground"}),e._v(" "),n("Nuxt"),e._v(" "),n("TheMenu"),e._v(" "),n("TheButtonMute",{ref:"buttonMute"}),e._v(" "),e.isCompleted?e._e():n("ThePreloader",{ref:"preloader"}),e._v(" "),n("AudioController")],1)}),[],!1,null,"6d28008c",null).exports);function Gn(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Hn(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Gn(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Gn(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}te.a.registerPlugin(ie.a),te.a.registerPlugin(ne.a);var script={computed:Hn(Hn({},Object(c.b)({isDebug:"context/isDebug",isCompleted:"preloader/isCompleted",isLoadingCompleted:"preloader/isLoadingCompleted"})),{},{routeName:function(){return this.getRouteBaseName()}}),watch:{$route:function(e,t){this.$store.dispatch("router/setCurrent",e),this.$store.dispatch("router/setPrevious",t)},isCompleted:function(e){e&&this.transitionIn()}},mounted:function(){this.$root.logoAnimation=this.$refs.preloader.$refs.logo,this.$store.dispatch("router/setCurrent",this.$route),this.registerLoaders()},destroyed:function(){this.removeDebugger()},methods:{transitionIn:function(){(new te.a.timeline).add(this.$refs.buttonMute.transitionIn(),0)},registerLoaders:function(){var e=new ae.WebGLRenderer;re.b.registerLoader(et,"image"),re.b.registerLoader(In,"hdr"),re.b.registerLoader(ut,"texture"),re.b.registerLoader(at,"BMFont"),re.b.registerLoader(st,"audio"),re.b.registerLoader(Fn,"json"),re.b.registerLoader(vt,"basis",{transcoderPath:"/webgl/libs/basis/",renderer:e}),re.b.registerLoader(Tn,"gltf",{dracoDecoderPath:"/webgl/libs/draco/"}),re.b.registerLoader(Dn,"ktx",{transcoderPath:"/webgl/libs/basis/",renderer:e})}},components:{WebglBackground:ce,TheMenu:ve,TheButtonMute:Le,ThePreloader:ze,TheCookieMessage:He,AudioController:qe}};function Vn(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var Wn={props:["error"],computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Vn(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Vn(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)({isDevelopment:"context/isDevelopment"})),mounted:function(){this.isDevelopment?this.$el.style.opacity=1:this.$router.push(this.localePath("/error"))}};function $n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var Yn={_default:Object(x.s)(zn),"_default/script":Object(x.s)(script),"_error/script":Object(x.s)(Wn)},Xn={render:function(e,t){var n=e("NuxtLoading",{ref:"loading"}),r=e(this.layout||"nuxt"),o=e("div",{domProps:{id:"__layout"},key:this.layoutName},[r]),l=e("transition",{props:{name:"layout",mode:"out-in"},on:{beforeEnter:function(e){window.$nuxt.$nextTick((function(){window.$nuxt.$emit("triggerScroll")}))}}},[o]);return e("div",{domProps:{id:"__nuxt"}},[n,l])},data:function(){return{isOnline:!0,layout:null,layoutName:"",nbFetching:0}},beforeCreate:function(){l.a.util.defineReactive(this,"nuxt",this.$options.nuxt)},created:function(){this.$root.$options.$nuxt=this,window.$nuxt=this,this.refreshOnlineStatus(),window.addEventListener("online",this.refreshOnlineStatus),window.addEventListener("offline",this.refreshOnlineStatus),this.error=this.nuxt.error,this.context=this.$options.context},mounted:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$loading=e.$refs.loading;case 1:case"end":return t.stop()}}),t)})))()},watch:{"nuxt.err":"errorChanged"},computed:{isOffline:function(){return!this.isOnline},isFetching:function(){return this.nbFetching>0}},methods:{refreshOnlineStatus:function(){void 0===window.navigator.onLine?this.isOnline=!0:this.isOnline=window.navigator.onLine},refresh:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=Object(x.h)(e.$route)).length){t.next=3;break}return t.abrupt("return");case 3:return e.$loading.start(),r=n.map((function(t){var p=[];if(t.$options.fetch&&t.$options.fetch.length&&p.push(Object(x.q)(t.$options.fetch,e.context)),t.$fetch)p.push(t.$fetch());else{var n,r=$n(Object(x.e)(t.$vnode.componentInstance));try{for(r.s();!(n=r.n()).done;){var component=n.value;p.push(component.$fetch())}}catch(e){r.e(e)}finally{r.f()}}return t.$options.asyncData&&p.push(Object(x.q)(t.$options.asyncData,e.context).then((function(e){for(var n in e)l.a.set(t.$data,n,e[n])}))),Promise.all(p)})),t.prev=5,t.next=8,Promise.all(r);case 8:t.next=15;break;case 10:t.prev=10,t.t0=t.catch(5),e.$loading.fail(t.t0),Object(x.k)(t.t0),e.error(t.t0);case 15:e.$loading.finish();case 16:case"end":return t.stop()}}),t,null,[[5,10]])})))()},errorChanged:function(){if(this.nuxt.err){this.$loading&&(this.$loading.fail&&this.$loading.fail(this.nuxt.err),this.$loading.finish&&this.$loading.finish());var e=(K.options||K).layout;"function"==typeof e&&(e=e(this.context)),this.setLayout(e)}},setLayout:function(e){return e&&Yn["_"+e]||(e="default"),this.layoutName=e,this.layout=Yn["_"+e],this.layout},loadLayout:function(e){return e&&Yn["_"+e]||(e="default"),Promise.resolve(Yn["_"+e])}},components:{NuxtLoading:ee}};n(108);function Kn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Qn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function Qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}l.a.use(c.a);var Zn=["state","getters","actions","mutations"],Jn={};Jn.modules=Jn.modules||{},ni(n(477),"context/actions.js"),ni(n(478),"context/getters.js"),ni(n(479),"context/mutations.js"),ni(n(480),"context/state.js"),ni(n(481),"device/actions.js"),ni(n(482),"device/getters.js"),ni(n(483),"device/mutations.js"),ni(n(484),"device/state.js"),ni(n(485),"home/actions.js"),ni(n(486),"home/getters.js"),ni(n(487),"home/mutations.js"),ni(n(488),"home/state.js"),ni(n(489),"menu/actions.js"),ni(n(490),"menu/getters.js"),ni(n(491),"menu/mutations.js"),ni(n(492),"menu/state.js"),ni(n(493),"mouse/actions.js"),ni(n(494),"mouse/getters.js"),ni(n(495),"mouse/mutations.js"),ni(n(496),"mouse/state.js"),ni(n(497),"preloader/actions.js"),ni(n(498),"preloader/getters.js"),ni(n(499),"preloader/mutations.js"),ni(n(500),"preloader/state.js"),ni(n(501),"router/actions.js"),ni(n(502),"router/getters.js"),ni(n(503),"router/mutations.js"),ni(n(504),"router/state.js"),ni(n(505),"scroll/actions.js"),ni(n(506),"scroll/getters.js"),ni(n(507),"scroll/mutations.js"),ni(n(508),"scroll/state.js"),ni(n(509),"webgl/actions.js"),ni(n(510),"webgl/getters.js"),ni(n(86),"webgl/mutation-types.js"),ni(n(511),"webgl/mutations.js"),ni(n(512),"webgl/state.js"),ni(n(513),"device/browser/actions.js"),ni(n(514),"device/browser/getters.js"),ni(n(515),"device/browser/mutations.js"),ni(n(516),"device/browser/state.js"),ni(n(517),"webgl/views/actions.js"),ni(n(518),"webgl/views/getters.js"),ni(n(519),"webgl/views/mutations.js"),ni(n(520),"webgl/views/state.js");var ei=Jn instanceof Function?Jn:function(){return new c.a.Store(Object.assign({strict:!1},Jn))};function ti(e,t){if(e.state&&"function"!=typeof e.state){console.warn("'state' should be a method that returns an object in ".concat(t));var n=Object.assign({},e.state);e=Object.assign({},e,{state:function(){return n}})}return e}function ni(e,t){e=e.default||e;var n=t.replace(/\.(js|mjs)$/,"").split("/"),r=n[n.length-1],o="store/".concat(t);if(e="state"===r?function(e,t){if("function"!=typeof e){console.warn("".concat(t," should export a method that returns an object"));var n=Object.assign({},e);return function(){return n}}return ti(e,t)}(e,o):ti(e,o),Zn.includes(r)){var l=r;ri(ii(Jn,n,{isProperty:!0}),e,l)}else{"index"===r&&(n.pop(),r=n[n.length-1]);var c,h=ii(Jn,n),d=Kn(Zn);try{for(d.s();!(c=d.n()).done;){var f=c.value;ri(h,e[f],f)}}catch(e){d.e(e)}finally{d.f()}!1===e.namespaced&&delete h.namespaced}}function ii(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.isProperty,o=void 0!==r&&r;if(!t.length||o&&1===t.length)return e;var l=t.shift();return e.modules[l]=e.modules[l]||{},e.modules[l].namespaced=!0,e.modules[l].modules=e.modules[l].modules||{},ii(e.modules[l],t,{isProperty:o})}function ri(e,t,n){t&&("state"===n?e.state=t||e.state:e[n]=Object.assign({},e[n],t))}n(203),n(192);var ai={COMPONENT_OPTIONS_KEY:"nuxtI18n",STRATEGIES:{PREFIX:"prefix",PREFIX_EXCEPT_DEFAULT:"prefix_except_default",PREFIX_AND_DEFAULT:"prefix_and_default",NO_PREFIX:"no_prefix"}},oi=void 0,si={vueI18n:{fallbackLocale:"fr",messages:{fr:{data:{label:"Fran√ßais",routes:{home:{name:"Accueil",path:"/"},about:{name:"√Ä propos",path:"/about"},work:{name:"Nos projets",path:"/work"}},work:{filterLabel:"Filtrer",closeFilterLabel:"Fermer",slideButtonLabel:"Voir"},menu:{open:"menu",close:"fermer"},error:{message:"Page introuvable",cta:"Retour √† l'accueil"},notSupported:{message:"Nous sommes d√©sol√©s ce site n'est pas support√© par votre navigateur"},misc:{backToTop:"Retour",mute:"audio",scroll:{desktop:"scroll",touch:"d√©couvrir"},scrollBack:{desktop:"",touch:"retour"},cookies:{message:"En naviguant sur ce site vous autorisez l'utilisation des cookies",agree:"Ok"},loading:{large:"chargement",small:"chargement"},explore:{large:"explore",small:"Cliquez pour explorer"},enter:"entrer"}}},en:{data:{label:"English",routes:{home:{name:"Home",path:"/"},about:{name:"About us",path:"/about"},work:{name:"Our Work",path:"/work"}},work:{filterLabel:"Filter",closeFilterLabel:"Close",slideButtonLabel:"See"},menu:{open:"menu",close:"close"},error:{message:"Page not found",cta:"Back to home"},notSupported:{message:"We're sorry this website is currently not supported on your browser"},misc:{backToTop:"Back",mute:"sound",scroll:{desktop:"scroll",touch:"discover"},scrollBack:{desktop:"",touch:"back"},cookies:{message:"By entering the site, you agree to our use of cookies.",agree:"Ok"},loading:{large:"loading",small:"loading"},explore:{large:"explore",small:"Tap to explorer"},enter:"enter"}}}}},vueI18nLoader:!1,locales:[{code:"fr",name:"fr-fr"},{code:"en",name:"en-gb"}],defaultLocale:"fr",defaultDirection:"ltr",routesNameSeparator:"___",defaultLocaleRouteNameSuffix:"default",sortRoutes:!0,strategy:"prefix",lazy:!1,langDir:null,rootRedirect:null,detectBrowserLanguage:{alwaysRedirect:!1,cookieCrossOrigin:!1,cookieDomain:null,cookieKey:"i18n_redirected",cookieSecure:!1,fallbackLocale:"",onlyOnNoPrefix:!1,onlyOnRoot:!1,useCookie:!0},differentDomains:!1,seo:!1,baseUrl:"",vuex:{moduleName:"i18n",syncLocale:!1,syncMessages:!1,syncRouteParams:!0},parsePages:!0,pages:{},skipSettingLocaleOnNavigate:!0,beforeLanguageSwitch:function(){return null},onBeforeLanguageSwitch:function(){},onLanguageSwitched:function(){return null},normalizedLocales:[{code:"fr",name:"fr-fr"},{code:"en",name:"en-gb"}],localeCodes:["fr","en"]},ui=(n(197),n(118),n(521),n(277)),ci=n.n(ui);function hi(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return di(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return di(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function di(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function fi(text){return"[nuxt-i18n] ".concat(text)}function mi(e,t){var n,r=[],o=[],l=hi(e);try{for(l.s();!(n=l.n()).done;){var c=n.value,code=c.code,h=c.iso||code;o.push({code:code,iso:h})}}catch(e){l.e(e)}finally{l.f()}var d,f=hi(t.entries());try{var m=function(){var e=Object(Q.a)(d.value,2),n=e[0],l=e[1],c=o.find((function(e){return e.iso.toLowerCase()===l.toLowerCase()}));if(c)return r.push({code:c.code,score:1-n/t.length}),"break"};for(f.s();!(d=f.n()).done;){if("break"===m())break}}catch(e){f.e(e)}finally{f.f()}var v,_=hi(t.entries());try{var y=function(){var e=Object(Q.a)(v.value,2),n=e[0],l=e[1].split("-")[0].toLowerCase(),c=o.find((function(e){return e.iso.split("-")[0].toLowerCase()===l}));if(c)return r.push({code:c.code,score:.999-n/t.length}),"break"};for(_.s();!(v=_.n()).done;){if("break"===y())break}}catch(e){_.e(e)}finally{_.f()}return r.length>1&&r.sort((function(e,t){return e.score===t.score?t.code.length-e.code.length:t.score-e.score})),r.length?r[0].code:void 0}function pi(e,t){var n;if(n=window.location.host){var r=e.find((function(e){return e.domain===n}));if(r)return r.code}return""}function gi(e){return new RegExp("^/(".concat(e.join("|"),")(?:/|$)"),"i")}function vi(e,t){var n=t.routesNameSeparator,r=t.defaultLocaleRouteNameSuffix,o="(".concat(e.join("|"),")"),l="(?:".concat(n).concat(r,")?"),c=new RegExp("".concat(n).concat(o).concat(l,"$"),"i"),h=gi(e);return function(e){if(e.name){var t=e.name.match(c);if(t&&t.length>1)return t[1]}else if(e.path){var n=e.path.match(h);if(n&&n.length>1)return n[1]}return""}}function _i(e,t){var n,r=t.useCookie,o=t.cookieKey,l=t.localeCodes;if(r&&((n=ci.a.get(o))&&l.includes(n)))return n}function yi(e,t,n){var r=n.useCookie,o=n.cookieDomain,l=n.cookieKey,c=n.cookieSecure,h=n.cookieCrossOrigin;if(r){var d=new Date,f={expires:new Date(d.setDate(d.getDate()+365)),path:"/",sameSite:h?"none":"lax",secure:h||c};o&&(f.domain=o),ci.a.set(l,e,f)}}function bi(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function xi(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?bi(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):bi(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function wi(e,t){return Si.apply(this,arguments)}function Si(){return(Si=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.app,(o=r.i18n).loadedLanguages||(o.loadedLanguages=[]),o.loadedLanguages.includes(n)||((l=si.normalizedLocales.find((function(e){return e.code===n})))?l.file||console.warn(fi("Could not find lang file for locale ".concat(n))):console.warn(fi('Attempted to load messages for non-existant locale code "'.concat(n,'"'))));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ci(e,t,n,r){var o=r.differentDomains,l=r.normalizedLocales;if("function"==typeof e)return e(t);if(o&&n){var c=Oi(n,t.req,{normalizedLocales:l});if(c)return c}return e}function Oi(e,t,n){var r,o=n.normalizedLocales.find((function(t){return t.code===e}));if(o&&o.domain)return Object(y.a)(o.domain)?o.domain:(r=window.location.protocol.split(":")[0],"".concat(r,"://").concat(o.domain));console.warn(fi("Could not find domain name for locale ".concat(e)))}function Li(e,t,n){var r={namespaced:!0,state:function(){return xi(xi(xi({},t.syncLocale?{locale:""}:{}),t.syncMessages?{messages:{}}:{}),t.syncRouteParams?{routeParams:{}}:{})},actions:xi(xi(xi({},t.syncLocale?{setLocale:function(e,t){(0,e.commit)("setLocale",t)}}:{}),t.syncMessages?{setMessages:function(e,t){(0,e.commit)("setMessages",t)}}:{}),t.syncRouteParams?{setRouteParams:function(e,t){(0,e.commit)("setRouteParams",t)}}:{}),mutations:xi(xi(xi({},t.syncLocale?{setLocale:function(e,t){e.locale=t}}:{}),t.syncMessages?{setMessages:function(e,t){e.messages=t}}:{}),t.syncRouteParams?{setRouteParams:function(e,t){e.routeParams=t}}:{}),getters:xi({},t.syncRouteParams?{localeRouteParams:function(e){var t=e.routeParams;return function(e){return t&&t[e]||{}}}}:{})};e.registerModule(t.moduleName,r,{preserveState:!!e.state[t.moduleName]})}function ki(e){return Mi.apply(this,arguments)}function Mi(){return(Mi=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,o,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2&&void 0!==l[2]?l[2]:null,!(o=l.length>3?l[3]:void 0)||!t){e.next=10;break}if(null===n||!o.syncLocale){e.next=7;break}return e.next=7,t.dispatch(o.moduleName+"/setLocale",n);case 7:if(null===r||!o.syncMessages){e.next=10;break}return e.next=10,t.dispatch(o.moduleName+"/setMessages",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ti=n(361),Pi=n(176),Ri=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,o,l,c,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.app,!t.isHMR){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.i18n.__onNavigate(t.route);case 5:r=e.sent,o=Object(Q.a)(r,3),l=o[0],c=o[1],h=o[2],l&&c&&(d=h?t.route.query:void 0,t.redirect(l,c,d));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Pi.a.nuxti18n=Ri;var Di=["params"];function Ai(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Ei(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Ai(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Ai(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function Ii(e,t){var n=Bi.call(this,e,t);return n?n.route.fullPath:""}function ji(e,t){var n=Bi.call(this,e,t);return n?n.route:void 0}function Fi(e,t){var n=Bi.call(this,e,t);return n?n.location:void 0}function Bi(e,t){if(e){var n=this.i18n;if(t=t||n.locale){"string"==typeof e&&(e="/"===e[0]?{path:e}:{name:e});var r=Object.assign({},e);if(r.path&&!r.name){var o=this.router.resolve(r).route,l=this.getRouteBaseName(o);if(l)r={name:zi(l,t),params:o.params,query:o.query,hash:o.hash};else!(t===si.defaultLocale&&[ai.STRATEGIES.PREFIX_EXCEPT_DEFAULT,ai.STRATEGIES.PREFIX_AND_DEFAULT].includes(si.strategy)||si.strategy===ai.STRATEGIES.NO_PREFIX||n.differentDomains)&&(r.path="/".concat(t).concat(r.path)),r.path=oi?Object(y.f)(r.path,!0):Object(y.g)(r.path,!0)}else{r.name||r.path||(r.name=this.getRouteBaseName()),r.name=zi(r.name,t);var c=r.params;c&&void 0===c[0]&&c.pathMatch&&(c[0]=c.pathMatch)}var h=this.router.resolve(r);return h.route.name?h:this.router.resolve(e)}}}function Ui(e){var t=this.getRouteBaseName();if(!t)return"";var n=this.i18n,r=this.route,o=this.store,l=r.params,c=Object(Ti.a)(r,Di),h={};si.vuex&&si.vuex.syncRouteParams&&o&&(h=o.getters["".concat(si.vuex.moduleName,"/localeRouteParams")](e));var d=Object.assign({},c,{name:t,params:Ei(Ei(Ei({},l),h),{},{0:l.pathMatch})}),path=this.localePath(d,e);if(n.differentDomains){var f={differentDomains:n.differentDomains,normalizedLocales:si.normalizedLocales},m=Oi(e,this.req,f);m&&(path=m+path)}return path}function Ni(e){var t=void 0!==e?e:this.route;if(t&&t.name)return t.name.split(si.routesNameSeparator)[0]}function zi(e,t){var n=e+(si.strategy===ai.STRATEGIES.NO_PREFIX?"":si.routesNameSeparator+t);return t===si.defaultLocale&&si.strategy===ai.STRATEGIES.PREFIX_AND_DEFAULT&&(n+=si.routesNameSeparator+si.defaultLocaleRouteNameSuffix),n}var Gi=function(e){return function(){var t={getRouteBaseName:this.getRouteBaseName,i18n:this.$i18n,localePath:this.localePath,localeRoute:this.localeRoute,localeLocation:this.localeLocation,req:null,route:this.$route,router:this.$router,store:this.$store};return e.call.apply(e,[t].concat(Array.prototype.slice.call(arguments)))}},Hi=function(e,t){return function(){var n=e.app,r=(e.req,e.route),o=e.store,l={getRouteBaseName:n.getRouteBaseName,i18n:n.i18n,localePath:n.localePath,localeLocation:n.localeLocation,localeRoute:n.localeRoute,req:null,route:r,router:n.router,store:o};return t.call.apply(t,[l].concat(Array.prototype.slice.call(arguments)))}},Vi={install:function(e){e.mixin({methods:{localePath:Gi(Ii),localeRoute:Gi(ji),localeLocation:Gi(Fi),switchLocalePath:Gi(Ui),getRouteBaseName:Gi(Ni)}})}},Wi=function(e){l.a.use(Vi);var t=e.app,n=e.store;t.localePath=e.localePath=Hi(e,Ii),t.localeRoute=e.localeRoute=Hi(e,ji),t.localeLocation=e.localeLocation=Hi(e,Fi),t.switchLocalePath=e.switchLocalePath=Hi(e,Ui),t.getRouteBaseName=e.getRouteBaseName=Hi(e,Ni),n&&(n.localePath=t.localePath,n.localeRoute=t.localeRoute,n.localeLocation=t.localeLocation,n.switchLocalePath=t.switchLocalePath,n.getRouteBaseName=t.getRouteBaseName)},$i=(n(232),n(278)),qi=n(114);function Yi(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Xi(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Yi(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Yi(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function Ki(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Qi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qi(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function Qi(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Zi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.addDirAttribute,n=void 0===t||t,r=e.addSeoAttributes,o=void 0!==r&&r;if(!this.$i18n)return{};var l={htmlAttrs:{},link:[],meta:[]},c=this.$i18n.localeProperties,d=c.iso,f=c.dir||si.defaultDirection;if(n&&(l.htmlAttrs.dir=f),o&&(h.a.hasMetaInfo?h.a.hasMetaInfo(this):this._hasMetaInfo)&&this.$i18n.locale&&this.$i18n.locales&&!1!==this.$options[ai.COMPONENT_OPTIONS_KEY]&&(!this.$options[ai.COMPONENT_OPTIONS_KEY]||!1!==this.$options[ai.COMPONENT_OPTIONS_KEY].seo)){d&&(l.htmlAttrs.lang=d);var m=this.$i18n.locales;v.bind(this)(m,this.$i18n.__baseUrl,l.link),_.bind(this)(this.$i18n.__baseUrl,l.link),y.bind(this)(c,d,l.meta),x.bind(this)(m,d,l.meta)}function v(e,t,link){if(si.strategy!==ai.STRATEGIES.NO_PREFIX){var n,r=new Map,o=Ki(e);try{for(o.s();!(n=o.n()).done;){var l=n.value,c=l.iso;if(c){var h=c.split("-"),d=Object(Q.a)(h,2),f=d[0],m=d[1];f&&m&&(l.isCatchallLocale||!r.has(f))&&r.set(f,l),r.set(c,l)}else console.warn(fi("Locale ISO code is required to generate alternate link"))}}catch(e){o.e(e)}finally{o.f()}var v,_=Ki(r.entries());try{for(_.s();!(v=_.n()).done;){var y=Object(Q.a)(v.value,2),x=y[0],w=y[1],C=this.switchLocalePath(w.code);C&&link.push({hid:"i18n-alt-".concat(x),rel:"alternate",href:S(C,t),hreflang:x})}}catch(e){_.e(e)}finally{_.f()}if(si.defaultLocale){var O=this.switchLocalePath(si.defaultLocale);O&&link.push({hid:"i18n-xd",rel:"alternate",href:S(O,t),hreflang:"x-default"})}}}function _(e,link){var t=this.localeRoute(Xi(Xi({},this.$route),{},{name:this.getRouteBaseName()})),n=t?t.path:null;n&&link.push({hid:"i18n-can",rel:"canonical",href:S(n,e)})}function y(e,t,meta){e&&t&&meta.push({hid:"i18n-og",property:"og:locale",content:w(t)})}function x(e,t,meta){var n=e.filter((function(e){var n=e.iso;return n&&n!==t}));if(n.length){var r=n.map((function(e){return{hid:"i18n-og-alt-".concat(e.iso),property:"og:locale:alternate",content:w(e.iso)}}));meta.push.apply(meta,Object(qi.a)(r))}}function w(e){return(e||"").replace(/-/g,"_")}function S(e,t){return e.match(/^https?:\/\//)?e:t+e}return l}function Ji(){return Zi.call(this,{addDirAttribute:!1,addSeoAttributes:!0})}var er=n(154);function nr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ir(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ir(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function ir(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}l.a.use($i.a);var rr=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,o,c,h,d,f,m,v,_,x,w,S,C,O,L,k,M,T,P,R,D,A,E,I,j,F,B,U,N,z,G,H,V,W,$,Y,X,K;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.app,o=t.route,c=t.store,h=t.req,t.res,d=t.redirect,si.vuex&&c&&Li(c,si.vuex,si.localeCodes),f=si.lazy,f&&(!0===f||!0!==f.skipNuxtState),e.next=9;break;case 7:m=e.sent.default,t.beforeNuxtRender((function(e){var t=e.nuxtState,r={},o=n.i18n,l=o.fallbackLocale,c=o.locale;if(c&&c!==l){var h=n.i18n._getMessages()[c];if(h)try{m(h),r[c]=h}catch(e){}}t.__i18n={langs:r}}));case 9:if(v=si.detectBrowserLanguage,_=v.alwaysRedirect,x=v.fallbackLocale,w=v.onlyOnNoPrefix,S=v.onlyOnRoot,C=v.useCookie,O=v.cookieKey,L=v.cookieDomain,k=v.cookieSecure,M=v.cookieCrossOrigin,T=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(r){var o,h,f,m,v,_,y,x,w,S,O,L,k,M,T,P,D,A,E=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=E.length>1&&void 0!==E[1]?E[1]:{},h=o.initialSetup,f=void 0!==h&&h,r){e.next=3;break}return e.abrupt("return");case 3:if(f||!n.i18n.differentDomains){e.next=5;break}return e.abrupt("return");case 5:if(m=n.i18n.locale,r!==m){e.next=8;break}return e.abrupt("return");case 8:if(!(v=n.i18n.onBeforeLanguageSwitch(m,r,f,t))||!n.i18n.localeCodes.includes(v)){e.next=13;break}if(v!==m){e.next=12;break}return e.abrupt("return");case 12:r=v;case 13:if(f||n.i18n.beforeLanguageSwitch(m,r),C&&n.i18n.setLocaleCookie(r),!si.langDir){e.next=29;break}if(_=n.i18n.fallbackLocale,!si.lazy){e.next=27;break}if(!_){e.next=23;break}return y=[],Array.isArray(_)?y=_.map((function(e){return wi(t,e)})):"object"===Object(_t.a)(_)?(_[r]&&(y=y.concat(_[r].map((function(e){return wi(t,e)})))),_.default&&(y=y.concat(_.default.map((function(e){return wi(t,e)}))))):r!==_&&y.push(wi(t,_)),e.next=23,Promise.all(y);case 23:return e.next=25,wi(t,r);case 25:e.next=29;break;case 27:return e.next=29,Promise.all(si.localeCodes.map((function(e){return wi(t,e)})));case 29:for(n.i18n.locale=r,x=si.normalizedLocales.find((function(e){return e.code===r}))||{code:r},w=0,S=Object.keys(n.i18n.localeProperties);w<S.length;w++)O=S[w],n.i18n.localeProperties[O]=void 0;for(L=0,k=Object.entries(x);L<k.length;L++)M=Object(Q.a)(k[L],2),T=M[0],P=M[1],l.a.set(n.i18n.localeProperties,T,Object(er.a)(P));if(!si.vuex){e.next=36;break}return e.next=36,ki(c,r,n.i18n.getLocaleMessage(r),si.vuex);case 36:D=t.route,A=R(D,r),f?n.i18n.__redirect=A:(n.i18n.onLanguageSwitched(m,r),A&&d(A));case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=vi(si.localeCodes,{routesNameSeparator:si.routesNameSeparator,defaultLocaleRouteNameSuffix:si.defaultLocaleRouteNameSuffix}),R=function(e,t){if(!t||n.i18n.differentDomains||si.strategy===ai.STRATEGIES.NO_PREFIX)return"";if(P(e)===t&&(!S&&!w||t!==si.defaultLocale||si.strategy!==ai.STRATEGIES.PREFIX_AND_DEFAULT))return"";var r=n.switchLocalePath(t);return r||(r=n.localePath(e.fullPath,t)),!r||r===e.fullPath||r.startsWith("//")?"":r},D=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(r){var o,path,l,c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("/"!==r.path||!si.rootRedirect){e.next=5;break}return o=302,path=si.rootRedirect,"string"!=typeof si.rootRedirect&&(o=si.rootRedirect.statusCode,path=si.rootRedirect.path),e.abrupt("return",[o,"/".concat(path),!0]);case 5:if(!(l=n.i18n.__redirect)){e.next=9;break}return n.i18n.__redirect=null,e.abrupt("return",[302,l]);case 9:if(c={differentDomains:si.differentDomains,normalizedLocales:si.normalizedLocales},n.i18n.__baseUrl=Ci(si.baseUrl,t,n.i18n.locale,c),h=si.detectBrowserLanguage&&j(r)||P(r)||n.i18n.locale||n.i18n.defaultLocale||"",!si.skipSettingLocaleOnNavigate){e.next=17;break}n.i18n.__pendingLocale=h,n.i18n.__pendingLocalePromise=new Promise((function(e){n.i18n.__resolvePendingLocalePromise=e})),e.next=19;break;case 17:return e.next=19,n.i18n.setLocale(h);case 19:return e.abrupt("return",[null,null]);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.i18n.__pendingLocale){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.i18n.setLocale(n.i18n.__pendingLocale);case 4:n.i18n.__resolvePendingLocalePromise(""),n.i18n.__pendingLocale=null;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.i18n.__pendingLocale){e.next=3;break}return e.next=3,n.i18n.__pendingLocalePromise;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){return"undefined"!=typeof navigator&&navigator.languages?mi(si.normalizedLocales,navigator.languages):h&&void 0!==h.headers["accept-language"]?mi(si.normalizedLocales,h.headers["accept-language"].split(",").map((function(e){return e.split(";")[0]}))):void 0},j=function(e){if(si.strategy!==ai.STRATEGIES.NO_PREFIX)if(S){if("/"!==e.path)return""}else if(w&&!_&&e.path.match(gi(si.localeCodes)))return"";var t;C&&(t=n.i18n.getLocaleCookie())||(t=I());var r=t||x;return!r||C&&!_&&n.i18n.getLocaleCookie()||r===n.i18n.locale?"":r},F=function(e){e.locales=Object(er.a)(si.locales),e.localeCodes=Object(er.a)(si.localeCodes),e.localeProperties=l.a.observable(Object(er.a)(si.normalizedLocales.find((function(t){return t.code===e.locale}))||{code:e.locale})),e.defaultLocale=si.defaultLocale,e.differentDomains=si.differentDomains,e.beforeLanguageSwitch=si.beforeLanguageSwitch,e.onBeforeLanguageSwitch=si.onBeforeLanguageSwitch,e.onLanguageSwitched=si.onLanguageSwitched,e.setLocaleCookie=function(e){return yi(e,0,{useCookie:C,cookieDomain:L,cookieKey:O,cookieSecure:k,cookieCrossOrigin:M})},e.getLocaleCookie=function(){return _i(0,{useCookie:C,cookieKey:O,localeCodes:si.localeCodes})},e.setLocale=function(e){return T(e)},e.getBrowserLocale=function(){return I()},e.finalizePendingLocaleChange=A,e.waitForPendingLocaleChange=E,e.__baseUrl=n.i18n.__baseUrl,e.__pendingLocale=n.i18n.__pendingLocale,e.__pendingLocalePromise=n.i18n.__pendingLocalePromise,e.__resolvePendingLocalePromise=n.i18n.__resolvePendingLocalePromise},"function"!=typeof si.vueI18n){e.next=25;break}return e.next=22,si.vueI18n(t);case 22:e.t0=e.sent,e.next=26;break;case 25:e.t0=Object(er.a)(si.vueI18n);case 26:if((B=e.t0).componentInstanceCreatedListener=F,n.i18n=t.i18n=new $i.a(B),n.i18n.locale="",n.i18n.fallbackLocale=B.fallbackLocale||"",F(n.i18n),U={differentDomains:si.differentDomains,normalizedLocales:si.normalizedLocales},n.i18n.__baseUrl=Ci(si.baseUrl,t,"",U),n.i18n.__onNavigate=D,l.a.prototype.$nuxtI18nSeo=Ji,l.a.prototype.$nuxtI18nHead=Zi,!c){e.next=58;break}if(c.$i18n=n.i18n,!c.state.localeDomains){e.next=58;break}N=nr(n.i18n.locales),e.prev=41,N.s();case 43:if((z=N.n()).done){e.next=50;break}if("string"!=typeof(G=z.value)){e.next=47;break}return e.abrupt("continue",48);case 47:G.domain=c.state.localeDomains[G.code];case 48:e.next=43;break;case 50:e.next=55;break;case 52:e.prev=52,e.t1=e.catch(41),N.e(e.t1);case 55:return e.prev=55,N.f(),e.finish(55);case 58:return(H=si.detectBrowserLanguage?j(o):"")||((V=si.vuex)&&V.syncLocale&&c&&""!==c.state[V.moduleName].locale?H=c.state[V.moduleName].locale:n.i18n.differentDomains?(W=pi(si.normalizedLocales),H=W):si.strategy!==ai.STRATEGIES.NO_PREFIX&&($=P(o),H=$)),!H&&C&&(H=n.i18n.getLocaleCookie()),H||(H=n.i18n.defaultLocale||""),e.next=64,T(H,{initialSetup:!0});case 64:e.next=72;break;case 67:Y=e.sent,X=Object(Q.a)(Y,2),X[0],(K=X[1])&&location.assign(Object(y.c)(t.base,K));case 72:case"end":return e.stop()}}),e,null,[[41,52,55,58]])})));return function(t){return e.apply(this,arguments)}}(),ar=n(357),or=n.n(ar),sr=function(e,t){var n=e.req,r=e.res,o=!0;t("cookies",or()(n,r,o))},lr=n(279),ur=n(139),cr=n.n(ur),dr=function(e){return"/"},fr=null;function mr(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function pr(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?mr(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):mr(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var gr=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.req,t.route,t.res,t.query,t.redirect,t.nuxtState,t.base,r={},o={};try{o=lr.a.client("https://mardi8.cdn.prismic.io/api/v2",Object.assign({},r,{}))}catch(e){console.error(e),console.error("Failed to init Prismic API, preventing app fatal error.")}c=new l.a({computed:{api:function(){return o},apiEndpoint:function(){return"https://mardi8.cdn.prismic.io/api/v2"},predicates:function(){return lr.a.Predicates},dom:function(){return cr.a}},methods:pr(pr({asHtml:function(e){if(e)return cr.a.RichText.asHtml(e,dr,fr)},asText:function(e){if(e)return cr.a.RichText.asText(e)},asLink:function(link){if(link)return cr.a.Link.url(link,dr)},asDate:function(e){if(e)return cr.a.Date(e)}},dr&&{linkResolver:dr}),fr)}),n("prismic",c),t.$prismic=c;case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),vr=n(280);function _r(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function yr(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?_r(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):_r(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}Object.entries(yr(yr({},vr.common),vr.nuxt)).forEach((function(e){var t=Object(Q.a)(e,2),n=(t[0],t[1]);l.a.component(n.name,n)}));var xr=n(59),wr=n(69),Sr=n(9),Cr=function(e){var t=e.store,n=e.app;function r(){var e=xe.a.width,n=xe.a.height,r=wr.a.current;t.dispatch("device/setSizes",{width:e,height:n}),t.dispatch("device/setBreakpoint",r)}function o(){r()}function l(e){t.dispatch("mouse/setPosition",{x:e.clientX,y:e.clientY})}!function(){var e=xr.a.isTouch();t.dispatch("device/setTouch",e),e?document.body.classList.add("is-touch"):document.body.classList.add("no-touch");var r=yt.a.getClassName();t.dispatch("device/browser/setName",r),t.dispatch("device/browser/setSafari",yt.a.isSafari()),t.dispatch("device/browser/setEdge",yt.a.isEdge()),t.dispatch("device/browser/setIE",yt.a.isInternetExplorer()),t.dispatch("device/browser/setFirefox",yt.a.isFirefox()),Sr.a&&(Sr.a.create(),Sr.a.addLayer("UI"));var o="not-supported";n.getRouteBaseName()===o||yt.a.isValidBrowser()||n.router.push(n.localePath("/".concat(o)))}(),r(),xe.a.addEventListener("resize",o),window.addEventListener("mousemove",l)},Or=function(e){var t=e.query,n=e.store,r=t.production||null===t.production||!0;n.dispatch("context/setProduction",r);n.dispatch("context/setDevelopment",!1);var o=t.debug||null===t.debug;n.dispatch("context/setDebug",o)},Lr=(n(315),{en:"en-gb",fr:"fr-fr"});function kr(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var Mr=function(e,t,n,r,l,c,h){return function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?kr(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):kr(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},function(e){var t=e.i18n,n=(e.error,e.$prismic);return{getSingleDocumentByType:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=Lr[t.__pendingLocale],l=r.lang||o;return n.api.getSingle(e,{fetchLinks:r.fetchLinks,lang:l})},getDocumentsByType:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=Lr[t.__pendingLocale],l=r.lang||o;return n.api.query(n.predicates.at("document.type",e),{fetchLinks:r.fetchLinks,pageSize:100,lang:l})},getDocumentByUID:function(e,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=Lr[t.__pendingLocale],c=o.lang||l;return n.api.getByUID(e,r,{fetchLinks:o.fetchLinks,lang:c})}}}({i18n:e,error:t,store:n,$prismic:h}))},Tr=function(e,t){var n=e.app,r=e.error,o=e.store,l=(e.route,e.req,e.redirect,e.$prismic),c=n.i18n;t("api",Mr(c,r,o,0,0,0,l)),t("i18n",c)},Pr=function(e){var t=e.app;l.a.use(Me.b,{appName:"artisansdidees",config:{id:"G-8ERKEWB1L1"},enabled:!0,bootstrap:!1,pageTrackerTemplate:function(e){var n=t.getRouteBaseName(e);return{path:e.fullPath,name:"work-slug"===n?"work-".concat(e.params.slug):n}}},t.router)};function Rr(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Dr(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Rr(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Rr(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}l.a.component(f.a.name,f.a),l.a.component(v.a.name,Dr(Dr({},v.a),{},{render:function(e,t){return v.a._warned||(v.a._warned=!0,console.warn("<no-ssr> has been deprecated and will be removed in Nuxt 3, please use <client-only> instead")),v.a.render(e,t)}})),l.a.component(H.name,H),l.a.component("NChild",H),l.a.component(Z.name,Z),Object.defineProperty(l.a.prototype,"$nuxt",{get:function(){var e=this.$root.$options.$nuxt;return e||"undefined"==typeof window?e:window.$nuxt},configurable:!0}),l.a.use(h.a,{keyName:"head",attribute:"data-n-head",ssrAttribute:"data-n-head-ssr",tagIDKeyName:"hid"});var Ar={name:"page",mode:"out-in",appear:!1,appearClass:"appear",appearActiveClass:"appear-active",appearToClass:"appear-to"},Er=c.a.Store.prototype.registerModule;function Ir(path,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Array.isArray(path)?!!path.reduce((function(e,path){return e&&e[path]}),this.state):path in this.state;return Er.call(this,path,e,Dr({preserveState:n},t))}function jr(e){return Fr.apply(this,arguments)}function Fr(){return(Fr=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,o,c,h,d,f,path,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m=function(e,t){if(!e)throw new Error("inject(key, value) has no key provided");if(void 0===t)throw new Error("inject('".concat(e,"', value) has no value provided"));h[e="$"+e]=t,h.context[e]||(h.context[e]=t),c[e]=h[e];var n="__nuxt_"+e+"_installed__";l.a[n]||(l.a[n]=!0,l.a.use((function(){Object.prototype.hasOwnProperty.call(l.a.prototype,e)||Object.defineProperty(l.a.prototype,e,{get:function(){return this.$root.$options[e]}})})))},n=v.length>1&&void 0!==v[1]?v[1]:{},e.next=4,G(0,n);case 4:return o=e.sent,(c=ei(t)).$router=o,c.registerModule=Ir,h=Dr({head:{title:"Artisans d'id√©es",htmlAttrs:{lang:"en"},meta:[{charset:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{hid:"description",name:"description",content:""}],link:[{rel:"icon",type:"image/png",href:"/favicon.png"}],style:[],script:[]},store:c,router:o,nuxt:{defaultTransition:Ar,transitions:[Ar],setTransitions:function(e){return Array.isArray(e)||(e=[e]),e=e.map((function(e){return e=e?"string"==typeof e?Object.assign({},Ar,{name:e}):Object.assign({},Ar,e):Ar})),this.$options.nuxt.transitions=e,e},err:null,dateErr:null,error:function(e){e=e||null,h.context._errored=Boolean(e),e=e?Object(x.p)(e):null;var n=h.nuxt;return this&&(n=this.nuxt||this.$options.nuxt),n.dateErr=Date.now(),n.err=e,t&&(t.nuxt.error=e),e}}},Xn),c.app=h,d=t?t.next:function(e){return h.router.push(e)},t?f=o.resolve(t.url).route:(path=Object(x.f)(o.options.base,o.options.mode),f=o.resolve(path).route),e.next=14,Object(x.t)(h,{store:c,route:f,next:d,error:h.nuxt.error.bind(h),payload:t?t.payload:void 0,req:t?t.req:void 0,res:t?t.res:void 0,beforeRenderFns:t?t.beforeRenderFns:void 0,ssrContext:t});case 14:m("config",n),window.__NUXT__&&window.__NUXT__.state&&c.replaceState(window.__NUXT__.state),e.next=20;break;case 20:return e.next=23,Wi(h.context);case 23:if("function"!=typeof rr){e.next=26;break}return e.next=26,rr(h.context,m);case 26:return e.next=29,sr(h.context,m);case 29:if("function"!=typeof gr){e.next=32;break}return e.next=32,gr(h.context,m);case 32:e.next=35;break;case 35:return e.next=38,Cr(h.context);case 38:return e.next=41,Or(h.context);case 41:return e.next=44,Tr(h.context,m);case 44:return e.next=47,Pr(h.context);case 47:return e.next=50,new Promise((function(e,t){if(!o.resolve(h.context.route.fullPath).route.matched.length)return e();o.replace(h.context.route.fullPath,e,(function(n){if(!n._isRouter)return t(n);if(2!==n.type)return e();var l=o.afterEach(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n,r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(x.j)(n);case 3:h.context.route=t.sent,h.context.params=n.params||{},h.context.query=n.query||{},l(),e();case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}))}));case 50:return e.abrupt("return",{store:c,app:h,router:o});case 51:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";n(10);var r=n(78),o=n(2),l=n(3),c=n(4),h=n(5),d=n(1),f=(n(109),n(7)),m=n(107),v=n(25);function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var y=function(e){Object(c.a)(n,e);var t=_(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this))._el=window,e._isSmooth=!0,e._damping=.1,e._isEnabled=!0,e._isScrolling=!1,e._position=window.scrollY,e._delta=0,e._isSmoothScrolling=!1,e._smoothPosition=window.scrollY,e._smoothDelta=0,e._bindAll(),e._setupEventListeners(),e}return Object(l.a)(n,[{key:"destroy",value:function(){this._removeEventListeners()}},{key:"position",get:function(){return this._isSmooth?this._smoothPosition:this._position},set:function(e){this._isSmooth?(this._smoothPosition=e,this._position=e,window.scrollTo({top:e}),this.dispatchEvent("scroll",{position:this.position,delta:this.delta})):window.scrollTo({top:e})}},{key:"delta",get:function(){return this._isSmooth?this._smoothDelta:this._delta}},{key:"disableSmooth",value:function(){this._isSmooth=!1,f.a.ticker.remove(this._tickHandler)}},{key:"setPosition",value:function(e){this._position=e,this._smoothPosition=e,window.scrollTo({top:e}),this.dispatchEvent("scroll",{position:this.position,delta:this.delta})}},{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"scrollTo",value:function(e,t){var n,o=t||0;switch(Object(r.a)(e)){case"string":document.querySelector("".concat(e))&&(n=document.querySelector("".concat(e)).getBoundingClientRect().top+this._position+o);break;case"number":n=e+o;break;case"object":e.tagName&&(n=e.getBoundingClientRect().top+this._position+o);break;default:console.error("ScrollTo Target is not valid, it has to be either a selector, an absolute position or a node element")}window.scrollTo({top:n,behavior:"smooth"})}},{key:"_checkScroll",value:function(){if(this._isEnabled){var e=v.a.lerp(this._smoothPosition,this._position,this._damping),t=Math.round(100*e)/100,n=this._smoothPosition-t,r=Math.round(100*n)/100;Math.round(n);this._smoothPosition=t,this._smoothDelta=r,0!==r?this.smoothScrollHandler():this._isSmoothScrolling&&this._smoothScrollEndHandler()}}},{key:"_bindAll",value:function(){this._tickHandler=this._tickHandler.bind(this),this._scrollHandler=this._scrollHandler.bind(this),this._scrollDebounceHandler=this._scrollDebounceHandler.bind(this),this._scrollEndHandler=this._scrollEndHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._isSmooth&&f.a.ticker.add(this._tickHandler),this._el.addEventListener("scroll",this._scrollHandler)}},{key:"_removeEventListeners",value:function(){this._isSmooth&&f.a.ticker.remove(this._tickHandler),this._el.removeEventListener("scroll",this._scrollHandler)}},{key:"_tickHandler",value:function(){this._checkScroll()}},{key:"_scrollHandler",value:function(e){if(this._isEnabled){this._isScrolling=!0;var t=this._el.pageYOffset,n=this._position-t;this._position=t,this._delta=n,this._isSmooth||this._isScheduledAnimationFrame||(this._isScheduledAnimationFrame=!0,requestAnimationFrame(this._scrollDebounceHandler))}}},{key:"_scrollDebounceHandler",value:function(){this.dispatchEvent("scroll",{position:this._position,delta:this._delta}),this._scrollTimeout&&clearTimeout(this._scrollTimeout),this._scrollTimeout=setTimeout(this._scrollEndHandler,250),this._isScheduledAnimationFrame=!1}},{key:"_scrollEndHandler",value:function(){this._isScrolling=!1,this._delta=0,this.dispatchEvent("scroll:end",{position:this._position,delta:this._delta})}},{key:"smoothScrollHandler",value:function(){this._isSmooth&&(this._isSmoothScrolling=!0,this.dispatchEvent("scroll",{position:this._smoothPosition,delta:this._smoothDelta}))}},{key:"_smoothScrollEndHandler",value:function(){this._isSmooth&&(this._isSmoothScrolling=!1,this._smoothDelta=0,this.dispatchEvent("scroll:end",{position:Math.round(this._smoothPosition),delta:this._smoothDelta}))}}]),n}(m.a);t.a=new y},,,,,,function(e,t,n){"use strict";t.a=[]},,,,,,function(e,t,n){"use strict";t.a={easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return 1-Math.pow(1-e,3)},easeInOutCubic:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2},easeInSine:function(e){return 1-Math.cos(e*Math.PI/2)},easeOutSine:function(e){return Math.sin(e*Math.PI/2)},easeInOutSine:function(e){return-(Math.cos(Math.PI*e)-1)/2},easeInCirc:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return 1-(1-e)*(1-e)},easeInOutQuad:function(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2},easePulseCubic:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return(e=Math.abs(e-t))>n?0:1-(e/=n)*e*(3-2*e)}}},,,,,,,,function(e,t,n){"use strict";var r=n(2),o=n(3),l=function(){function e(t){Object(r.a)(this,e),this.el=t.el,this.handleScroll=null===t.handleScroll||void 0===t.handleScroll||t.handleScroll,this._touchStartPosition={x:0,y:0},this._touchPosition={x:0,y:0},this._dragDelta={x:0,y:0},this._touchStartPositionScroll={x:0,y:0},this._touchPositionScroll={x:0,y:0},this._touchDeltaScroll={x:0,y:0},this._isDragging=!1,this._dragDirection=null,this._enable=!0,this._bindAll(),this._setup()}return Object(o.a)(e,[{key:"dispose",value:function(){this._removeEventListeners()}},{key:"addEventListener",value:function(e,t){switch(e){case"dragstart":this._dragstartCallback=t;break;case"drag":this._dragCallback=t;break;case"dragend":this._dragendCallback=t;break;case"tap":this._tapCallback=t}}},{key:"enable",value:function(){this._enable=!0}},{key:"disable",value:function(){this._enable=!1}},{key:"_setup",value:function(){this._setupEventListeners()}},{key:"_bindAll",value:function(){this._touchstartHandler=this._touchstartHandler.bind(this),this._touchmoveHandler=this._touchmoveHandler.bind(this),this._touchendHandler=this._touchendHandler.bind(this),this._mousedownHandler=this._mousedownHandler.bind(this),this._mousemoveHandler=this._mousemoveHandler.bind(this),this._mouseupHandler=this._mouseupHandler.bind(this),this._touchStartScrollHandler=this._touchStartScrollHandler.bind(this),this._touchScrollHandler=this._touchScrollHandler.bind(this),this._touchEndScrollHandler=this._touchEndScrollHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this.isTouch()?(this.el.addEventListener("touchstart",this._touchstartHandler),window.addEventListener("touchmove",this._touchmoveHandler),window.addEventListener("touchend",this._touchendHandler)):(this.el.addEventListener("mousedown",this._mousedownHandler),window.addEventListener("mousemove",this._mousemoveHandler),window.addEventListener("mouseup",this._mouseupHandler)),document.addEventListener("touchstart",this._touchStartScrollHandler,{passive:!1}),document.addEventListener("touchmove",this._touchScrollHandler,{passive:!1}),document.addEventListener("touchend",this._touchEndScrollHandler,{passive:!1})}},{key:"_removeEventListeners",value:function(){this.isTouch()?(this.el.removeEventListener("touchstart",this._touchstartHandler),window.removeEventListener("touchmove",this._touchmoveHandler),window.removeEventListener("touchend",this._touchendHandler)):(this.el.removeEventListener("mousedown",this._mousedownHandler),window.removeEventListener("mousemove",this._mousemoveHandler),window.removeEventListener("mouseup",this._mouseupHandler)),document.removeEventListener("touchstart",this._touchStartScrollHandler,{passive:!1}),document.removeEventListener("touchmove",this._touchScrollHandler,{passive:!1}),document.removeEventListener("touchend",this._touchEndScrollHandler,{passive:!1})}},{key:"_dragstartHandler",value:function(e){this._enable&&this._dragstartCallback&&this._dragstartCallback(e)}},{key:"_dragHandler",value:function(e){this._enable&&this._dragCallback&&this._dragCallback(e)}},{key:"_dragendHandler",value:function(e){this._enable&&this._dragendCallback&&this._dragendCallback(e)}},{key:"_tapHandler",value:function(e){this._enable&&this._tapCallback&&this._tapCallback(e)}},{key:"_mousedownHandler",value:function(e){this._isDraging=!0;var t={x:e.clientX,y:e.clientY};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._touchStartPosition.x=t.x,this._touchStartPosition.y=t.y,this._dragstartHandler({position:t,delta:{x:0,y:0},element:this.el})}},{key:"_mousemoveHandler",value:function(e){if(this._isDraging){var t={x:e.clientX,y:e.clientY},n={x:this._touchPosition.x-t.x,y:this._touchPosition.y-t.y};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._dragDelta.x=n.x,this._dragDelta.y=n.y,this._dragHandler({position:t,delta:n,element:this.el})}}},{key:"_mouseupHandler",value:function(){var e=this._touchPosition,t=this._dragDelta;this._isDraging&&Math.abs(e.x-this._touchStartPosition.x)<1&&this._tapHandler({position:e,delta:t,element:this.el}),this._isDraging&&this._dragendHandler({position:e,delta:t,element:this.el}),this._isDraging=!1}},{key:"_touchstartHandler",value:function(e){this._isDraging=!0;var t={x:e.touches[0].clientX,y:e.touches[0].clientY};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._touchStartPosition.x=t.x,this._touchStartPosition.y=t.y,"vertical"===this._dragDirection&&this.handleScroll||this._dragstartHandler({position:t,delta:{x:0,y:0},element:this.el})}},{key:"_touchmoveHandler",value:function(e){if(this._isDraging){var t={x:e.touches[0].clientX,y:e.touches[0].clientY},n={x:this._touchPosition.x-t.x,y:this._touchPosition.y-t.y};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._dragDelta.x=n.x,this._dragDelta.y=n.y,"vertical"===this._dragDirection&&this.handleScroll||this._dragHandler({position:t,delta:n})}}},{key:"_touchendHandler",value:function(){var e=this._touchPosition,t=this._dragDelta;this._isDraging&&Math.abs(e.x-this._touchStartPosition.x)<1&&this._tapHandler({position:e,delta:t,element:this.el}),"vertical"===this._dragDirection&&this.handleScroll||(this._isDraging&&this._dragendHandler({position:e,delta:t,element:this.el}),this._isDraging=!1)}},{key:"_touchStartScrollHandler",value:function(e){if(this.handleScroll&&!this._dragDirection){var t={x:e.touches[0].clientX,y:e.touches[0].clientY};this._touchPositionScroll.x=t.x,this._touchPositionScroll.y=t.y,this._touchStartPositionScroll.x=t.x,this._touchStartPositionScroll.y=t.y}}},{key:"_touchScrollHandler",value:function(e){if(this.handleScroll){var t={x:e.touches[0].clientX,y:e.touches[0].clientY},n={x:this._touchPositionScroll.x-t.x,y:this._touchPositionScroll.y-t.y};this._touchPositionScroll.x=t.x,this._touchPositionScroll.y=t.y,this._touchDeltaScroll.x=n.x,this._touchDeltaScroll.y=n.y,"horizontal"===this._dragDirection&&this._isDraging&&e.preventDefault(),this._dragDirection||(Math.abs(this._touchDeltaScroll.y)>Math.abs(this._dragDelta.x)?this._dragDirection="vertical":this._dragDirection="horizontal")}}},{key:"_touchEndScrollHandler",value:function(e){this.handleScroll&&(this._dragDirection=null)}},{key:"isTouch",value:function(){return"ontouchstart"in window}}]),e}();t.a=l},function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var r=n(2),o=n(3),l=(n(96),n(70),n(118),n(88),n(74),n(76),n(108),n(110),/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi),c=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,h=Math.PI/180,d=(Math.PI,Math.sin),f=Math.cos,m=Math.abs,v=Math.sqrt,_=(Math.atan2,function(e){return"number"==typeof e}),y=1e5,x=function(e){return Math.round(e*y)/y||0};function w(e,t,n,r,o,l,c,_,y){if(e!==_||t!==y){n=m(n),r=m(r);var x=o%360*h,w=f(x),S=d(x),C=Math.PI,O=2*C,L=(e-_)/2,k=(t-y)/2,M=w*L+S*k,T=-S*L+w*k,P=M*M,R=T*T,D=P/(n*n)+R/(r*r);D>1&&(n=v(D)*n,r=v(D)*r);var A=n*n,E=r*r,I=(A*E-A*R-E*P)/(A*R+E*P);I<0&&(I=0);var j=(l===c?-1:1)*v(I),F=j*(n*T/r),B=j*(-r*M/n),U=(e+_)/2+(w*F-S*B),N=(t+y)/2+(S*F+w*B),z=(M-F)/n,G=(T-B)/r,H=(-M-F)/n,V=(-T-B)/r,W=z*z+G*G,$=(G<0?-1:1)*Math.acos(z/v(W)),Y=(z*V-G*H<0?-1:1)*Math.acos((z*H+G*V)/v(W*(H*H+V*V)));isNaN(Y)&&(Y=C),!c&&Y>0?Y-=O:c&&Y<0&&(Y+=O),$%=O,Y%=O;var i,X=Math.ceil(m(Y)/(O/4)),K=[],Q=Y/X,Z=4/3*d(Q/2)/(1+f(Q/2)),J=w*n,ee=S*n,te=S*-r,ne=w*r;for(i=0;i<X;i++)M=f(o=$+i*Q),T=d(o),z=f(o+=Q),G=d(o),K.push(M-Z*T,T+Z*M,z+Z*G,G-Z*z,z,G);for(i=0;i<K.length;i+=2)M=K[i],T=K[i+1],K[i]=M*J+T*te+U,K[i+1]=M*ee+T*ne+N;return K[i-2]=_,K[i-1]=y,K}}function S(e){var i,t,n,r,o,h,d,f,v,_,y,x,S,C,O,a=(e+"").replace(c,(function(e){var t=+e;return t<1e-4&&t>-1e-4?0:t})).match(l)||[],path=[],L=0,k=0,M=2/3,T=a.length,P=0,R="ERROR: malformed path: "+e,line=function(e,t,n,r){_=(n-e)/3,y=(r-t)/3,d.push(e+_,t+y,n-_,r-y,n,r)};if(!e||!isNaN(a[0])||isNaN(a[1]))return console.log(R),path;for(i=0;i<T;i++)if(S=o,isNaN(a[i])?h=(o=a[i].toUpperCase())!==a[i]:i--,n=+a[i+1],r=+a[i+2],h&&(n+=L,r+=k),i||(f=n,v=r),"M"===o)d&&(d.length<8?path.length-=1:P+=d.length),L=f=n,k=v=r,d=[n,r],path.push(d),i+=2,o="L";else if("C"===o)d||(d=[0,0]),h||(L=k=0),d.push(n,r,L+1*a[i+3],k+1*a[i+4],L+=1*a[i+5],k+=1*a[i+6]),i+=6;else if("S"===o)_=L,y=k,"C"!==S&&"S"!==S||(_+=L-d[d.length-4],y+=k-d[d.length-3]),h||(L=k=0),d.push(_,y,n,r,L+=1*a[i+3],k+=1*a[i+4]),i+=4;else if("Q"===o)_=L+(n-L)*M,y=k+(r-k)*M,h||(L=k=0),L+=1*a[i+3],k+=1*a[i+4],d.push(_,y,L+(n-L)*M,k+(r-k)*M,L,k),i+=4;else if("T"===o)_=L-d[d.length-4],y=k-d[d.length-3],d.push(L+_,k+y,n+(L+1.5*_-n)*M,r+(k+1.5*y-r)*M,L=n,k=r),i+=2;else if("H"===o)line(L,k,L=n,k),i+=1;else if("V"===o)line(L,k,L,k=n+(h?k-L:0)),i+=1;else if("L"===o||"Z"===o)"Z"===o&&(n=f,r=v,d.closed=!0),("L"===o||m(L-n)>.5||m(k-r)>.5)&&(line(L,k,n,r),"L"===o&&(i+=2)),L=n,k=r;else if("A"===o){if(C=a[i+4],O=a[i+5],_=a[i+6],y=a[i+7],t=7,C.length>1&&(C.length<3?(y=_,_=O,t--):(y=O,_=C.substr(2),t-=2),O=C.charAt(1),C=C.charAt(0)),x=w(L,k,+a[i+1],+a[i+2],+a[i+3],+C,+O,(h?L:0)+1*_,(h?k:0)+1*y),i+=t,x)for(t=0;t<x.length;t++)d.push(x[t]);L=d[d.length-2],k=d[d.length-1]}else console.log(R);return(i=d.length)<6?(path.pop(),i=0):d[0]===d[i-2]&&d[1]===d[i-1]&&(d.closed=!0),path.totalPoints=P+i,path}function C(e){_(e[0])&&(e=[e]);var t,s,i,n,r="",o=e.length;for(s=0;s<o;s++){for(n=e[s],r+="M"+x(n[0])+","+x(n[1])+" C",t=n.length,i=2;i<t;i++)r+=x(n[i++])+","+x(n[i++])+" "+x(n[i++])+","+x(n[i++])+" "+x(n[i++])+","+x(n[i])+" ";n.closed&&(r+="z")}return r}var O,L,k=function(){return O||"undefined"!=typeof window&&(O=window.gsap)&&O.registerPlugin&&O},M=function(){(O=k())?(O.registerEase("_CE",A.create),L=1):console.warn("Please gsap.registerPlugin(CustomEase)")},T=function(e){return~~(1e3*e+(e<0?-.5:.5))/1e3},P=/[-+=\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/gi,R=/[cLlsSaAhHvVtTqQ]/g,D=function e(t,n,r,o,l,c,h,d,f,m,v){var _,y=(t+r)/2,x=(n+o)/2,w=(r+l)/2,S=(o+c)/2,C=(l+h)/2,O=(c+d)/2,L=(y+w)/2,k=(x+S)/2,M=(w+C)/2,T=(S+O)/2,P=(L+M)/2,R=(k+T)/2,D=h-t,A=d-n,E=Math.abs((r-h)*A-(o-d)*D),I=Math.abs((l-h)*A-(c-d)*D);return m||(m=[{x:t,y:n},{x:h,y:d}],v=1),m.splice(v||m.length-1,0,{x:P,y:R}),(E+I)*(E+I)>f*(D*D+A*A)&&(_=m.length,e(t,n,y,x,L,k,P,R,f,m,v),e(P,R,M,T,C,O,h,d,f,m,v+1+(m.length-_))),m},A=function(){function e(t,data,n){Object(r.a)(this,e),L||M(),this.id=t,this.setData(data,n)}return Object(o.a)(e,[{key:"setData",value:function(data,e){e=e||{};var t,n,r,i,o,l,c,h,p,d=(data=data||"0,0,1,1").match(P),f=1,m=[],v=[],_=e.precision||1,y=_<=1;if(this.data=data,(R.test(data)||~data.indexOf("M")&&data.indexOf("C")<0)&&(d=S(data)[0]),4===(t=d.length))d.unshift(0,0),d.push(1,1),t=8;else if((t-2)%6)throw"Invalid CustomEase";for(0==+d[0]&&1==+d[t-2]||function(e,t,n){n||0===n||(n=Math.max(+e[e.length-1],+e[1]));var i,r=-1*+e[0],o=-n,l=e.length,c=1/(+e[l-2]+r),h=-t||(Math.abs(+e[l-1]-+e[1])<.01*(+e[l-2]-+e[0])?function(e){var i,t=e.length,n=1e20;for(i=1;i<t;i+=6)+e[i]<n&&(n=+e[i]);return n}(e)+o:+e[l-1]+o);for(h=h?1/h:-c,i=0;i<l;i+=2)e[i]=(+e[i]+r)*c,e[i+1]=(+e[i+1]+o)*h}(d,e.height,e.originY),this.segment=d,i=2;i<t;i+=6)n={x:+d[i-2],y:+d[i-1]},r={x:+d[i+4],y:+d[i+5]},m.push(n,r),D(n.x,n.y,+d[i],+d[i+1],+d[i+2],+d[i+3],r.x,r.y,1/(2e5*_),m,m.length-1);for(t=m.length,i=0;i<t;i++)c=m[i],h=m[i-1]||c,(c.x>h.x||h.y!==c.y&&h.x===c.x||c===h)&&c.x<=1?(h.cx=c.x-h.x,h.cy=c.y-h.y,h.n=c,h.nx=c.x,y&&i>1&&Math.abs(h.cy/h.cx-m[i-2].cy/m[i-2].cx)>2&&(y=0),h.cx<f&&(h.cx?f=h.cx:(h.cx=.001,i===t-1&&(h.x-=.001,f=Math.min(f,.001),y=0)))):(m.splice(i--,1),t--);if(o=1/(t=1/f+1|0),l=0,c=m[0],y){for(i=0;i<t;i++)p=i*o,c.nx<p&&(c=m[++l]),n=c.y+(p-c.x)/c.cx*c.cy,v[i]={x:p,cx:o,y:n,cy:0,nx:9},i&&(v[i-1].cy=n-v[i-1].y);v[t-1].cy=m[m.length-1].y-n}else{for(i=0;i<t;i++)c.nx<i*o&&(c=m[++l]),v[i]=c;l<m.length-1&&(v[i-1]=m[m.length-2])}return this.ease=function(p){var e=v[p*t|0]||v[t-1];return e.nx<p&&(e=e.n),e.y+(p-e.x)/e.cx*e.cy},this.ease.custom=this,this.id&&O&&O.registerEase(this.id,this.ease),this}},{key:"getSVGData",value:function(t){return e.getSVGData(this,t)}}],[{key:"create",value:function(t,data,n){return new e(t,data,n).ease}},{key:"register",value:function(e){O=e,M()}},{key:"get",value:function(e){return O.parseEase(e)}},{key:"getSVGData",value:function(t,n){var a,r,i,o,l,c,h,d,f,m,v=(n=n||{}).width||100,_=n.height||100,y=n.x||0,x=(n.y||0)+_,w=O.utils.toArray(n.path)[0];if(n.invert&&(_=-_,x=0),"string"==typeof t&&(t=O.parseEase(t)),t.custom&&(t=t.custom),t instanceof e)a=C(function(e,a,b,t,n,r,o){for(var l,c,i,h,d,f=e.length;--f>-1;)for(c=(l=e[f]).length,i=0;i<c;i+=2)h=l[i],d=l[i+1],l[i]=h*a+d*t+r,l[i+1]=h*b+d*n+o;return e._dirty=1,e}([t.segment],v,0,0,-_,y,x));else{for(a=[y,x],o=1/(h=Math.max(5,200*(n.precision||1))),d=5/(h+=2),f=T(y+o*v),r=((m=T(x+t(o)*-_))-x)/(f-y),i=2;i<h;i++)l=T(y+i*o*v),c=T(x+t(i*o)*-_),(Math.abs((c-m)/(l-f)-r)>d||i===h-1)&&(a.push(f,m),r=(c-m)/(l-f)),f=l,m=c;a="M"+a.join(",")}return w&&w.setAttribute("d",a),a}}]),e}();k()&&O.registerPlugin(A),A.version="3.7.1"},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(88);t.a={clamp:function(e,t,n){return Math.min(Math.max(e,t),n)},map:function(e,t,n,r,o){return(e-t)*(o-r)/(n-t)+r},modulo:function(e,t){return(e%t+t)%t},zeroPad:function(e,t,n){return n=n||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(n)+e},radiansToDegrees:function(e){return e*(180/Math.PI)},degreesToRadians:function(e){return e*(Math.PI/180)}}},function(e,t,n){"use strict";t.a={}},,,function(e,t,n){"use strict";n(76);var r=[].concat([{type:"audio",name:"audio-landscape-rocky-desert",path:"/audio/audio-landscape-rocky-desert.mp3"},{type:"audio",name:"audio-landscape-ocean",path:"/audio/audio-landscape-ocean.mp3"},{type:"audio",name:"audio-landscape-forest",path:"/audio/audio-landscape-forest.mp3"},{type:"audio",name:"audio-landscape-cave",path:"/audio/audio-landscape-cave.mp3"},{type:"audio",name:"audio-main",path:"/audio/audio-main.mp3"},{type:"audio",name:"audio-transition-rocky-desert",path:"/audio/audio-transition-rocky-desert.mp3"},{type:"audio",name:"audio-transition-ocean",path:"/audio/audio-transition-ocean.mp3"},{type:"audio",name:"audio-transition-forest",path:"/audio/audio-transition-forest.mp3"},{type:"audio",name:"audio-transition-cave",path:"/audio/audio-transition-cave.mp3"},{type:"audio",name:"audio-interaction-a",path:"/audio/audio-interaction-a.mp3"},{type:"audio",name:"audio-interaction-c",path:"/audio/audio-interaction-c.mp3"},{type:"audio",name:"audio-interaction-d",path:"/audio/audio-interaction-d.mp3"},{type:"audio",name:"audio-interaction-e",path:"/audio/audio-interaction-e.mp3"},{type:"audio",name:"audio-interaction-f",path:"/audio/audio-interaction-f.mp3"},{type:"audio",name:"audio-interaction-g",path:"/audio/audio-interaction-g.mp3"}],[{name:"BarlowRegular",type:"BMFont",path:"/fonts/Barlow-Regular.fnt"},{name:"BarlowRegularTexture",type:"texture",path:"/fonts/Barlow-Regular.png"},{name:"BarlowLight",type:"BMFont",path:"/fonts/Barlow-Light.fnt"},{name:"BarlowLightTexture",type:"texture",path:"/fonts/Barlow-Light.png"},{name:"BarlowExtraLight",type:"BMFont",path:"/fonts/Barlow-ExtraLight.fnt"},{name:"BarlowExtraLightTexture",type:"texture",path:"/fonts/Barlow-ExtraLight.png"},{name:"BarlowThin",type:"BMFont",path:"/fonts/Barlow-Thin.fnt"},{name:"BarlowThinTexture",type:"texture",path:"/fonts/Barlow-Thin.png"}],[{type:"image",name:"curve-linear",path:"/webgl/scenes/shared/curves/linear.png"},{type:"image",name:"curve-non-linear-1",path:"/webgl/scenes/shared/curves/nonLinear1.png"},{type:"image",name:"curve-non-linear-2",path:"/webgl/scenes/shared/curves/nonLinear2.png"},{type:"image",name:"curve-non-linear-3",path:"/webgl/scenes/shared/curves/nonLinear3.png"},{type:"ktx",name:"dust-particle",path:"/webgl/scenes/shared/dust-particle.ktx2"},{type:"ktx",name:"water-normal-map",path:"/webgl/scenes/shared/water-normal-map.ktx2"},{type:"image",name:"ocean/moon-map-png",path:"/webgl/scenes/ocean/moon-map.png"},{type:"image",name:"cave/corridor/light-map",path:"/webgl/scenes/cave/corridor/light-map.png"},{type:"image",name:"cave/modern/light-map",path:"/webgl/scenes/cave/modern/light-map.png"},{type:"image",name:"cave/decals-map",path:"/webgl/scenes/cave/decals-map.png"}],[{type:"basis",name:"envmap/night-sky/cubemap",path:"/webgl/scenes/shared/envmaps/night-sky/cubemap.basis"},{type:"image",name:"envmap/ocean/px",path:"/webgl/scenes/shared/envmaps/ocean/px.png"},{type:"image",name:"envmap/ocean/nx",path:"/webgl/scenes/shared/envmaps/ocean/nx.png"},{type:"image",name:"envmap/ocean/py",path:"/webgl/scenes/shared/envmaps/ocean/py.png"},{type:"image",name:"envmap/ocean/ny",path:"/webgl/scenes/shared/envmaps/ocean/ny.png"},{type:"image",name:"envmap/ocean/pz",path:"/webgl/scenes/shared/envmaps/ocean/pz.png"},{type:"image",name:"envmap/ocean/nz",path:"/webgl/scenes/shared/envmaps/ocean/nz.png"}],[{type:"gltf",name:"bird",path:"/webgl/scenes/shared/bird.glb"},{type:"gltf",name:"cave/model",path:"/webgl/scenes/cave/model.glb"},{type:"gltf",name:"forest/model",path:"/webgl/scenes/forest/model.glb"},{type:"gltf",name:"rocky-desert/model",path:"/webgl/scenes/rocky-desert/model.glb"},{type:"gltf",name:"ocean/model",path:"/webgl/scenes/ocean/model.glb"}],[{type:"image",name:"lut/rocky-desert",path:"/webgl/scenes/rocky-desert/lut.png"},{type:"image",name:"lut/ocean",path:"/webgl/scenes/ocean/lut.png"},{type:"image",name:"lut/forest",path:"/webgl/scenes/forest/lut.png"},{type:"image",name:"lut/cave",path:"/webgl/scenes/cave/lut.png"}]);t.a=r},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return se}));var r,o,l,c,h,d,f,m,v=n(78),_=(n(70),n(108),n(3)),y=n(2),x=(n(27),function(){return r||"undefined"!=typeof window&&(r=window.gsap)}),w={},S=function(e){return m(e).id},C=function(e){return w[S("string"==typeof e?l(e)[0]:e)]},O=function(time){var e,t=h;if(time-f>=.05)for(f,f=time;t;)((e=t.g(t.t,t.p))!==t.v1||time-t.t1>.2)&&(t.v2=t.v1,t.v1=e,t.t2=t.t1,t.t1=time),t=t._next},L={deg:360,rad:2*Math.PI},k=function(){(r=x())&&(l=r.utils.toArray,c=r.utils.getUnit,m=r.core.getCache,d=r.ticker,o=1)},M=function e(t,n,r,o){Object(y.a)(this,e),this.t=t,this.p=n,this.g=t._gsap.get,this.rCap=L[r||c(this.g(t,n))],this.v1=this.v2=0,this.t1=this.t2=d.time,o&&(this._next=o,o._prev=this)},T=function(){function e(t,n){Object(y.a)(this,e),o||k(),this.target=l(t)[0],w[S(this.target)]=this,this._props={},n&&this.add(n)}return Object(_.a)(e,[{key:"get",value:function(e,t){var n,r,o,l=this._props[e];return l||console.warn("Not tracking "+e+" velocity."),n=parseFloat(t?l.v1:l.g(l.t,l.p))-parseFloat(l.v2),(r=l.rCap)&&(n%=r)!==n%(r/2)&&(n=n<0?n+r:n-r),o=n/((t?l.t1:d.time)-l.t2),Math.round(1e4*o)/1e4}},{key:"getAll",value:function(){var p,e={},t=this._props;for(p in t)e[p]=this.get(p);return e}},{key:"isTracking",value:function(e){return e in this._props}},{key:"add",value:function(e,t){e in this._props||(h||(d.add(O),f=d.time),h=this._props[e]=new M(this.target,e,t,h))}},{key:"remove",value:function(e){var t,n,r=this._props[e];r&&(t=r._prev,n=r._next,t&&(t._next=n),n?n._prev=t:h===r&&(d.remove(O),h=0),delete this._props[e])}},{key:"kill",value:function(e){for(var p in this._props)this.remove(p);e||delete w[S(this.target)]}}],[{key:"register",value:function(e){r=e,k()}},{key:"track",value:function(t,n,r){o||k();for(var c,h,d=[],f=l(t),a=n.split(","),m=(r||"").split(","),i=f.length;i--;){for(c=C(f[i])||new e(f[i]),h=a.length;h--;)c.add(a[h],m[h]||m[0]);d.push(c)}return d}},{key:"untrack",value:function(e,t){var n=(t||"").split(",");l(e).forEach((function(e){var t=C(e);t&&(n.length?n.forEach((function(p){return t.remove(p)})):t.kill(1))}))}},{key:"isTracking",value:function(e,t){var n=C(e);return n&&n.isTracking(t)}},{key:"getVelocity",value:function(e,t){var n=C(e);return n&&n.isTracking(t)?n.get(t):console.warn("Not tracking velocity of "+t)}}]),e}();T.getByTarget=C,x()&&r.registerPlugin(T);var P,R,D,A,E,I,j,F,B,U,N,z=T.getByTarget,G=function(){return P||"undefined"!=typeof window&&(P=window.gsap)&&P.registerPlugin&&P},H=function(e){return"string"==typeof e},V=function(e){return"number"==typeof e},W=function(e){return"object"===Object(v.a)(e)},$=function(e){return"function"==typeof e},Y=Array.isArray,X=function(p){return p},K=1e10,Q=1e-10,Z=function(e,t,n){for(var p in t)p in e||p===n||(e[p]=t[p]);return e},J=function(e,t,n,r,o){var l,c,p,h,i=t.length,d=0,f=K;if(W(e)){for(;i--;){for(p in l=t[i],c=0,e)c+=(h=l[p]-e[p])*h;c<f&&(d=i,f=c)}if((o||K)<K&&o<Math.sqrt(f))return e}else for(;i--;)(c=(l=t[i])-e)<0&&(c=-c),c<f&&l>=r&&l<=n&&(d=i,f=c);return t[d]},ee=function(e,t,n,r,o,l){if("auto"===e.end)return e;var c,p,h=e.end;if(n=isNaN(n)?K:n,r=isNaN(r)?-K:r,W(t)){if(c=t.calculated?t:($(h)?h(t):J(t,h,n,r,l))||t,!t.calculated){for(p in c)t[p]=c[p];t.calculated=!0}c=c[o]}else c=$(h)?h(t):Y(h)?J(t,h,n,r,l):parseFloat(h);return c>n?c=n:c<r&&(c=r),{max:c,min:c,unitFactor:e.unitFactor}},te=function(e,t,n){return isNaN(e[t])?n:+e[t]},ne=function(e,t){return.05*t*e/U},ie=function(e,t,n){return Math.abs((t-e)*U/n/.05)},re={resistance:1,checkpoint:1,preventOvershoot:1,linkedProps:1,radius:1,duration:1},ae=function(e,t,n,r){if(t.linkedProps){var i,p,o,l,c,h,d=t.linkedProps.split(","),f={};for(i=0;i<d.length;i++)(o=t[p=d[i]])&&(l=V(o.velocity)?o.velocity:(c=c||z(e))&&c.isTracking(p)?c.get(p):0,h=Math.abs(l/te(o,"resistance",r)),f[p]=parseFloat(n(e,p))+ne(l,h));return f}},oe=function(){(P=G())&&(D=P.parseEase,A=P.utils.toArray,j=P.utils.getUnit,B=P.core.getCache,N=P.utils.clamp,E=D("power3"),U=E(.05),F=P.core.PropTween,P.config({resistance:100,unitFactors:{time:1e3,totalTime:1e3}}),I=P.config(),P.registerPlugin(T),R=1)},se={version:"3.2.4",name:"inertia",register:function(e){P=e,oe()},init:function(e,t,n,r,o){R||oe();var l=z(e);if("auto"===t){if(!l)return void console.warn("No inertia tracking on "+e+". InertiaPlugin.track(target) first.");t=l.getAll()}this.target=e,this.tween=n;var p,c,h,d,f,m,v,_,y,x=e._gsap,w=x.get,S=t.duration,C=W(S),O=t.preventOvershoot||C&&0===S.overshoot,L=te(t,"resistance",I.resistance),k=V(S)?S:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(H(e)&&(e=A(e)[0]),!e)return 0;var p,c,h,d,f,m,v,_,y,x,w=0,S=K,C=t.inertia||t,O=B(e).get,L=te(C,"resistance",I.resistance);for(p in x=ae(e,C,O,L),C)re[p]||(c=C[p],W(c)||((_=_||z(e))&&_.isTracking(p)?c=V(c)?{velocity:c}:{velocity:_.get(p)}:(d=+c||0,h=Math.abs(d/L))),W(c)&&(d=V(c.velocity)?c.velocity:(_=_||z(e))&&_.isTracking(p)?_.get(p):0,h=N(r,n,Math.abs(d/te(c,"resistance",L))),m=(f=parseFloat(O(e,p))||0)+ne(d,h),"end"in c&&(c=ee(c,x&&p in x?x:m,c.max,c.min,p,C.radius),l&&(C[p]=Z(c,C[p],"end"))),"max"in c&&m>+c.max+Q?(y=c.unitFactor||I.unitFactors[p]||1,(v=f>c.max&&c.min!==c.max||d*y>-15&&d*y<45?r+.1*(n-r):ie(f,c.max,d))+o<S&&(S=v+o)):"min"in c&&m<+c.min-Q&&(y=c.unitFactor||I.unitFactors[p]||1,(v=f<c.min&&c.min!==c.max||d*y>-45&&d*y<15?r+.1*(n-r):ie(f,c.min,d))+o<S&&(S=v+o)),v>w&&(w=v)),h>w&&(w=h));return w>S&&(w=S),w>n?n:w<r?r:w}(e,t,C&&S.max||10,C&&S.min||.2,C&&"overshoot"in S?+S.overshoot:O?0:1);for(p in y=ae(e,t,w,L),t)re[p]||(c=t[p],$(c)&&(c=c(r,e,o)),V(c)?f=c:W(c)&&!isNaN(c.velocity)?f=+c.velocity:l&&l.isTracking(p)?f=l.get(p):console.warn("ERROR: No velocity was defined for "+e+" property: "+p),m=ne(f,k),_=0,h=w(e,p),d=j(h),h=parseFloat(h),W(c)&&(v=h+m,"end"in c&&(c=ee(c,y&&p in y?y:v,c.max,c.min,p,t.radius)),"max"in c&&+c.max<v?O||c.preventOvershoot?m=c.max-h:_=c.max-h-m:"min"in c&&+c.min>v&&(O||c.preventOvershoot?m=c.min-h:_=c.min-h-m)),this._props.push(p),this._pt=new F(this._pt,e,p,h,0,X,0,x.set(e,p,this)),this._pt.u=d||0,this._pt.c1=m,this._pt.c2=_);return n.duration(k),1},render:function(e,data){var t,n=data._pt;for(e=E(data.tween._time/data.tween._dur);n;)n.set(n.t,n.p,(t=n.s+n.c1*e+n.c2*e*e,Math.round(1e4*t)/1e4+n.u),n.d,e),n=n._next}};"track,untrack,isTracking,getVelocity,getByTarget".split(",").forEach((function(e){return se[e]=T[e]})),G()&&P.registerPlugin(se)},,,,,,,,function(e,t,n){n(10);var r=n(327),o=n(328),l=n(331),c=n(329),h=n(330),d=n(332);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}n(74),n(31),n(15),n(67),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(147),n(88),n(18),n(85),function(){"use strict";var h=this.THREE||n(0);if(!h)throw new Error("MeshLine requires three.js");function d(e,t,n,r,o){var i;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,o&&t+o):e.slice(t,o&&t+o):e,n.set)n.set(e,r);else for(i=0;i<e.length;i++)n[i+r]=e[i];return n}var m=function(e){c(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.call(this)).raycast=v,e.type="MeshLine",e.isMeshLine=!0,e.positions=[],e.previous=[],e.next=[],e.side=[],e.width=[],e.indices_array=[],e.uvs=[],e.counters=[],e._points=[],e._geom=null,e.widthCallback=null,e.matrixWorld=new h.Matrix4,Object.defineProperties(l(e),{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}}),e}return o(n,[{key:"setMatrixWorld",value:function(e){this.matrixWorld=e}},{key:"setGeometry",value:function(g,e){this._geometry=g,g instanceof h.Geometry?this.setPoints(g.vertices,e):g instanceof h.BufferGeometry?this.setPoints(g.getAttribute("position").array,e):this.setPoints(g,e)}},{key:"setPoints",value:function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof h.Vector3)for(var n=0;n<e.length;n++){var p=e[n],r=n/e.length;this.positions.push(p.x,p.y,p.z),this.positions.push(p.x,p.y,p.z),this.counters.push(r),this.counters.push(r)}else for(n=0;n<e.length;n+=3){r=n/e.length;this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(r),this.counters.push(r)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")}},{key:"compareV3",value:function(a,b){var e=6*a,t=6*b;return this.positions[e]===this.positions[t]&&this.positions[e+1]===this.positions[t+1]&&this.positions[e+2]===this.positions[t+2]}},{key:"copyV3",value:function(a){var e=6*a;return[this.positions[e],this.positions[e+1],this.positions[e+2]]}},{key:"process",value:function(){var e,t=this.positions.length/6;this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var n=0;n<t;n++)if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(n/(t-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(n/(t-1),0),this.uvs.push(n/(t-1),1),n<t-1){var r=2*n;this.indices_array.push(r,r+1,r+2),this.indices_array.push(r+2,r+1,r+3)}this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={side:new h.BufferAttribute(new Float32Array(this.side),1),width:new h.BufferAttribute(new Float32Array(this.width),1),uv:new h.BufferAttribute(new Float32Array(this.uvs),2),index:new h.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new h.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}},{key:"advance",value:function(e){var t=this._attributes.position.array,n=this._attributes.previous.array,r=this._attributes.next.array,o=t.length;d(t,0,n,0,o),d(t,6,t,0,o-6),t[o-6]=e.x,t[o-5]=e.y,t[o-4]=e.z,t[o-3]=e.x,t[o-2]=e.y,t[o-1]=e.z,d(t,6,r,0,o-6),r[o-6]=e.x,r[o-5]=e.y,r[o-4]=e.z,r[o-3]=e.x,r[o-2]=e.y,r[o-1]=e.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}]),n}(h.BufferGeometry),v=function e(t,n){r(this,e);var o=new h.Matrix4,l=new h.Ray,c=new h.Sphere,d=new h.Vector3,f=this.geometry;if(c.copy(f.boundingSphere),c.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(c,d)){o.getInverse(this.matrixWorld),l.copy(t.ray).applyMatrix4(o);var m=new h.Vector3,v=new h.Vector3,_=new h.Vector3,y=this instanceof h.LineSegments?2:1,x=f.index,w=f.attributes;if(null!==x)for(var S=x.array,C=w.position.array,O=w.width.array,i=0,L=S.length-1;i<L;i+=y){var a=S[i],b=S[i+1];m.fromArray(C,3*a),v.fromArray(C,3*b);var k=null!=O[Math.floor(i/3)]?O[Math.floor(i/3)]:1,M=t.params.Line.threshold+this.material.lineWidth*k/2,T=M*M;if(!(l.distanceSqToSegment(m,v,d,_)>T)){d.applyMatrix4(this.matrixWorld);var P=t.ray.origin.distanceTo(d);P<t.near||P>t.far||(n.push({distance:P,point:_.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this}),i=L)}}}};h.ShaderChunk.meshline_vert=["",h.ShaderChunk.logdepthbuf_pars_vertex,h.ShaderChunk.fog_pars_vertex,"","attribute float side;","attribute float width;","attribute float counters;","attribute float lineId;","","attribute vec2 positionUv;","attribute vec2 previousUv;","attribute vec2 nextUv;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","uniform highp sampler2D positionMap;","uniform float amount;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    float y = (lineId + 1.0) / amount;","    vec2 pUv = vec2(positionUv.x, y);","    vec3 pos = texture2D(positionMap, pUv).rgb;","    vec4 finalPosition = m * vec4( pos, 1.0 );","    vec2 prevUv = vec2(previousUv.x, y);","    vec3 prev = texture2D(positionMap, prevUv).rgb;","    vec2 nexUv = vec2(nextUv.x, y);","    vec3 nex = texture2D(positionMap, nexUv).rgb;","    vec4 prevPos = m * vec4( prev, 1.0 );","    vec4 nextPos = m * vec4( nex, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",h.ShaderChunk.logdepthbuf_vertex,h.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",h.ShaderChunk.fog_vertex,"}"].join("\n"),h.ShaderChunk.meshline_frag=["",h.ShaderChunk.fog_pars_fragment,h.ShaderChunk.logdepthbuf_pars_fragment,"","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",h.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",h.ShaderChunk.fog_fragment,"}"].join("\n");var _=function(e){c(n,e);var t=f(n);function n(e){var o;return r(this,n),(o=t.call(this,{uniforms:Object.assign({},h.UniformsLib.fog,{lineWidth:{value:e.lineWidth||1},map:{value:e.map},useMap:{value:e.useMap},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:e.color?new h.Color(e.color):new h.Color(16777215)},opacity:{value:1},resolution:{value:new h.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new h.Vector2(1,1)},positionMap:{value:e.positionMap},amount:{value:e.amount}}),vertexShader:h.ShaderChunk.meshline_vert,fragmentShader:h.ShaderChunk.meshline_frag})).type="MeshLineMaterial",o.isMeshLineMaterial=!0,o.transparent=e.transparent,o.blending=e.blending||h.NormalBlending,o.depthWrite=e.depthWrite,o.depthTest=e.depthTest,o}return o(n,[{key:"lineWidth",get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},{key:"map",get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},{key:"useMap",get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},{key:"alphaMap",get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},{key:"useAlphaMap",get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},{key:"color",get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},{key:"resolution",get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value=e}},{key:"sizeAttenuation",get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},{key:"dashArray",get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e}},{key:"dashOffset",get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},{key:"dashRatio",get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},{key:"useDash",get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},{key:"visibility",get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},{key:"repeat",get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value=e}},{key:"copy",value:function(source){return this.super(source),this.lineWidth=source.lineWidth,this.map=source.map,this.useMap=source.useMap,this.alphaMap=source.alphaMap,this.useAlphaMap=source.useAlphaMap,this.color.copy(source.color),this.opacity=source.opacity,this.resolution.copy(source.resolution),this.sizeAttenuation=source.sizeAttenuation,this.dashArray.copy(source.dashArray),this.dashOffset.copy(source.dashOffset),this.dashRatio.copy(source.dashRatio),this.useDash=source.useDash,this.visibility=source.visibility,this.alphaTest=source.alphaTest,this.repeat.copy(source.repeat),this}}]),n}(h.ShaderMaterial);e.exports&&(t=e.exports={MeshLine:m,MeshLineMaterial:_,MeshLineRaycast:v}),t.MeshLine=m,t.MeshLineMaterial=_,t.MeshLineRaycast=v}.call(this)},function(e,t,n){"use strict";n(109),n(27),n(89),n(92),n(18),n(56),n(15),n(74),n(17),n(90),n(72),n(23),n(99),n(100),n(73);var r=n(16);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,h=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){h=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(h)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var c=window.requestIdleCallback||function(e){var t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)},h=window.cancelIdleCallback||function(e){clearTimeout(e)},d=window.IntersectionObserver&&new window.IntersectionObserver((function(e){e.forEach((function(e){var t=e.intersectionRatio,link=e.target;t<=0||!link.__prefetch||link.__prefetch()}))}));t.a={name:"NuxtLink",extends:r.a.component("RouterLink"),props:{prefetch:{type:Boolean,default:!0},noPrefetch:{type:Boolean,default:!1}},mounted:function(){this.prefetch&&!this.noPrefetch&&(this.handleId=c(this.observe,{timeout:2e3}))},beforeDestroy:function(){h(this.handleId),this.__observed&&(d.unobserve(this.$el),delete this.$el.__prefetch)},methods:{observe:function(){d&&this.shouldPrefetch()&&(this.$el.__prefetch=this.prefetchLink.bind(this),d.observe(this.$el),this.__observed=!0)},shouldPrefetch:function(){return this.getPrefetchComponents().length>0},canPrefetch:function(){var e=navigator.connection;return!(this.$nuxt.isOffline||e&&((e.effectiveType||"").includes("2g")||e.saveData))},getPrefetchComponents:function(){return this.$router.resolve(this.to,this.$route,this.append).resolved.matched.map((function(e){return e.components.default})).filter((function(e){return"function"==typeof e&&!e.options&&!e.__prefetched}))},prefetchLink:function(){if(this.canPrefetch()){d.unobserve(this.$el);var e,t=o(this.getPrefetchComponents());try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n();r instanceof Promise&&r.catch((function(){})),n.__prefetched=!0}}catch(e){t.e(e)}finally{t.f()}}}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";new(n(16).a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var content=n(392);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("6bbf1d81",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(394);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("3191d5ad",content,!0,{sourceMap:!1})},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var content=n(441);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("15eaf85e",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(443);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("24164666",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(445);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("b9054d96",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(447);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("5b272c84",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(449);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("6b046d18",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(451);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("4424f348",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(453);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("af3a07f8",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(455);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("8e2fee90",content,!0,{sourceMap:!1})},function(e,t,n){var content=n(457);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("67f1400d",content,!0,{sourceMap:!1})},,function(e,t,n){var content=n(476);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("e82e9c32",content,!0,{sourceMap:!1})},,,,,,,,function(e,t,n){n(10);var r=n(327),o=n(328),l=n(329),c=n(330),h=n(332);function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var o=h(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}n(56);var f=n(429),m=n(434),v=n(438),_=n(439),y=n(0),x=y.BufferAttribute,w=y.Sphere,S=y.Box3,C=y.BufferGeometry;e.exports=function(e){return new O(e)};var O=function(e){"use strict";l(n,e);var t=d(n);function n(e){var o;return r(this,n),"string"==typeof e&&(e={text:e}),(o=t.call(this))._opt=Object.assign({},e),e&&o.update(e),o}return o(n,[{key:"update",value:function(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=f(e);var t=!1!==e.flipY,n=e.font,r=n.common.scaleW,o=n.common.scaleH,l=this.layout.glyphs.filter((function(glyph){var e=glyph.data;return e.width*e.height>0}));this.visibleGlyphs=l;var c=v.attributes(l,r,o,t),h=v.infos(l),d=m([],{clockwise:!0,type:"uint16",count:l.length});if(this.setIndex(d),this.setAttribute("position",new x(c.positions,2)),this.setAttribute("center",new x(c.centers,2)),this.setAttribute("uv",new x(c.uvs,2)),this.setAttribute("line",new x(h.lines,1)),this.setAttribute("letter",new x(h.letters,1)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var _=v.pages(l);this.setAttribute("page",new x(_,1))}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new w);var e=this.attributes.position2.array,t=this.attributes.position2.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);_.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new S);var e=this.boundingBox,t=this.attributes.position.array,n=this.attributes.position.itemSize;if(t&&n&&!(t.length<2))return _.computeBox(t,e);e.makeEmpty()}}]),n}(C)},,,,,,,,function(e,t,n){"use strict";var r=n(26),o=(n(112),n(15),n(109),n(16)),l=n(14),c=window.__NUXT__;function h(){if(!this._hydrated)return this.$fetch()}function d(){if((e=this).$vnode&&e.$vnode.elm&&e.$vnode.elm.dataset&&e.$vnode.elm.dataset.fetchKey){var e;this._hydrated=!0,this._fetchKey=this.$vnode.elm.dataset.fetchKey;var data=c.fetch[this._fetchKey];if(data&&data._error)this.$fetchState.error=data._error;else for(var t in data)o.a.set(this.$data,t,data[t])}}function f(){var e=this;return this._fetchPromise||(this._fetchPromise=m.call(this).then((function(){delete e._fetchPromise}))),this._fetchPromise}function m(){return v.apply(this,arguments)}function v(){return(v=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.$nuxt.nbFetching++,this.$fetchState.pending=!0,this.$fetchState.error=null,this._hydrated=!1,t=null,n=Date.now(),e.prev=6,e.next=9,this.$options.fetch.call(this);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(6),t=Object(l.p)(e.t0);case 15:if(!((r=this._fetchDelay-(Date.now()-n))>0)){e.next=19;break}return e.next=19,new Promise((function(e){return setTimeout(e,r)}));case 19:this.$fetchState.error=t,this.$fetchState.pending=!1,this.$fetchState.timestamp=Date.now(),this.$nextTick((function(){return o.$nuxt.nbFetching--}));case 23:case"end":return e.stop()}}),e,this,[[6,11]])})))).apply(this,arguments)}t.a={beforeCreate:function(){Object(l.l)(this)&&(this._fetchDelay="number"==typeof this.$options.fetchDelay?this.$options.fetchDelay:200,o.a.util.defineReactive(this,"$fetchState",{pending:!1,error:null,timestamp:Date.now()}),this.$fetch=f.bind(this),Object(l.a)(this,"created",d),Object(l.a)(this,"beforeMount",h))}}},,,,,function(e,t,n){e.exports=n(365)},function(e,t,n){"use strict";n.r(t),function(e){n(74),n(90),n(23),n(99),n(100);var t=n(78),r=n(26),o=(n(188),n(372),n(379),n(380),n(112),n(17),n(15),n(27),n(56),n(30),n(89),n(92),n(76),n(18),n(72),n(73),n(109),n(16)),l=n(344),c=n(176),h=n(14),d=n(128),f=n(359),m=n(214);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}o.a.__nuxt__fetch__mixin__||(o.a.mixin(f.a),o.a.__nuxt__fetch__mixin__=!0),o.a.component(m.a.name,m.a),o.a.component("NLink",m.a),e.fetch||(e.fetch=l.a);var y,x,w=[],S=window.__NUXT__||{},C=S.config||{};C._app&&(n.p=Object(h.v)(C._app.cdnURL,C._app.assetsPath)),Object.assign(o.a.config,{silent:!0,performance:!1});var O=o.a.config.errorHandler||console.error;function L(e,t,n){for(var r=function(component){var e=function(component,e){if(!component||!component.options||!component.options[e])return{};var option=component.options[e];if("function"==typeof option){for(var t=arguments.length,n=new Array(t>2?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];return option.apply(void 0,n)}return option}(component,"transition",t,n)||{};return"string"==typeof e?{name:e}:e},o=n?Object(h.g)(n):[],l=Math.max(e.length,o.length),c=[],d=function(i){var t=Object.assign({},r(e[i])),n=Object.assign({},r(o[i]));Object.keys(t).filter((function(e){return void 0!==t[e]&&!e.toLowerCase().includes("leave")})).forEach((function(e){n[e]=t[e]})),c.push(n)},i=0;i<l;i++)d(i);return c}function k(e,t,n){return M.apply(this,arguments)}function M(){return(M=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o,l,c,d,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._routeChanged=Boolean(y.nuxt.err)||n.name!==t.name,this._paramChanged=!this._routeChanged&&n.path!==t.path,this._queryChanged=!this._paramChanged&&n.fullPath!==t.fullPath,this._diffQuery=this._queryChanged?Object(h.i)(t.query,n.query):[],(this._routeChanged||this._paramChanged)&&this.$loading.start&&!this.$loading.manual&&this.$loading.start(),e.prev=5,!this._queryChanged){e.next=12;break}return e.next=9,Object(h.r)(t,(function(e,t){return{Component:e,instance:t}}));case 9:o=e.sent,o.some((function(e){var r=e.Component,o=e.instance,l=r.options.watchQuery;return!0===l||(Array.isArray(l)?l.some((function(e){return f._diffQuery[e]})):"function"==typeof l&&l.apply(o,[t.query,n.query]))}))&&this.$loading.start&&!this.$loading.manual&&this.$loading.start();case 12:r(),e.next=26;break;case 15:if(e.prev=15,e.t0=e.catch(5),l=e.t0||{},c=l.statusCode||l.status||l.response&&l.response.status||500,d=l.message||"",!/^Loading( CSS)? chunk (\d)+ failed\./.test(d)){e.next=23;break}return window.location.reload(!0),e.abrupt("return");case 23:this.error({statusCode:c,message:d}),this.$nuxt.$emit("routeChanged",t,n,l),r();case 26:case"end":return e.stop()}}),e,this,[[5,15]])})))).apply(this,arguments)}function T(e,t){return S.serverRendered&&t&&Object(h.b)(e,t),e._Ctor=e,e}function P(e){return Object(h.d)(e,function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r,o,l){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t||t.options){e.next=4;break}return e.next=3,t();case 3:t=e.sent;case 4:return c=T(Object(h.s)(t),S.data?S.data[l]:null),r.components[o]=c,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,o,l){return e.apply(this,arguments)}}())}function R(e,t,n){var r=this,o=["nuxti18n"],l=!1;if(void 0!==n&&(o=[],(n=Object(h.s)(n)).options.middleware&&(o=o.concat(n.options.middleware)),e.forEach((function(e){e.options.middleware&&(o=o.concat(e.options.middleware))}))),o=o.map((function(e){return"function"==typeof e?e:("function"!=typeof c.a[e]&&(l=!0,r.error({statusCode:500,message:"Unknown middleware "+e})),c.a[e])})),!l)return Object(h.o)(o,t)}function D(e,t,n){return A.apply(this,arguments)}function A(){return(A=Object(r.a)(regeneratorRuntime.mark((function e(t,n,o){var l,c,f,m,_,x,S,C,O,k,M,T,P,D,A,E=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==this._routeChanged||!1!==this._paramChanged||!1!==this._queryChanged){e.next=2;break}return e.abrupt("return",o());case 2:return!1,t===n?(w=[],!0):(l=[],w=Object(h.g)(n,l).map((function(e,i){return Object(h.c)(n.matched[l[i]].path)(n.params)}))),c=!1,f=function(path){n.path===path.path&&E.$loading.finish&&E.$loading.finish(),n.path!==path.path&&E.$loading.pause&&E.$loading.pause(),c||(c=!0,o(path))},e.next=8,Object(h.t)(y,{route:t,from:n,next:f.bind(this)});case 8:if(this._dateLastError=y.nuxt.dateErr,this._hadError=Boolean(y.nuxt.err),m=[],(_=Object(h.g)(t,m)).length){e.next=27;break}return e.next=15,R.call(this,_,y.context);case 15:if(!c){e.next=17;break}return e.abrupt("return");case 17:return x=(d.a.options||d.a).layout,e.next=20,this.loadLayout("function"==typeof x?x.call(d.a,y.context):x);case 20:return S=e.sent,e.next=23,R.call(this,_,y.context,S);case 23:if(!c){e.next=25;break}return e.abrupt("return");case 25:return y.context.error({statusCode:404,message:"This page could not be found"}),e.abrupt("return",o());case 27:return _.forEach((function(e){e._Ctor&&e._Ctor.options&&(e.options.asyncData=e._Ctor.options.asyncData,e.options.fetch=e._Ctor.options.fetch)})),this.setTransitions(L(_,t,n)),e.prev=29,e.next=32,R.call(this,_,y.context);case 32:if(!c){e.next=34;break}return e.abrupt("return");case 34:if(!y.context._errored){e.next=36;break}return e.abrupt("return",o());case 36:return"function"==typeof(C=_[0].options.layout)&&(C=C(y.context)),e.next=40,this.loadLayout(C);case 40:return C=e.sent,e.next=43,R.call(this,_,y.context,C);case 43:if(!c){e.next=45;break}return e.abrupt("return");case 45:if(!y.context._errored){e.next=47;break}return e.abrupt("return",o());case 47:O=!0,e.prev=48,k=v(_),e.prev=50,k.s();case 52:if((M=k.n()).done){e.next=63;break}if("function"==typeof(T=M.value).options.validate){e.next=56;break}return e.abrupt("continue",61);case 56:return e.next=58,T.options.validate(y.context);case 58:if(O=e.sent){e.next=61;break}return e.abrupt("break",63);case 61:e.next=52;break;case 63:e.next=68;break;case 65:e.prev=65,e.t0=e.catch(50),k.e(e.t0);case 68:return e.prev=68,k.f(),e.finish(68);case 71:e.next=77;break;case 73:return e.prev=73,e.t1=e.catch(48),this.error({statusCode:e.t1.statusCode||"500",message:e.t1.message}),e.abrupt("return",o());case 77:if(O){e.next=80;break}return this.error({statusCode:404,message:"This page could not be found"}),e.abrupt("return",o());case 80:return e.next=82,Promise.all(_.map(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(r,i){var o,l,c,d,f,v,_,x,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r._path=Object(h.c)(t.matched[m[i]].path)(t.params),r._dataRefresh=!1,o=r._path!==w[i],E._routeChanged&&o?r._dataRefresh=!0:E._paramChanged&&o?(l=r.options.watchParam,r._dataRefresh=!1!==l):E._queryChanged&&(!0===(c=r.options.watchQuery)?r._dataRefresh=!0:Array.isArray(c)?r._dataRefresh=c.some((function(e){return E._diffQuery[e]})):"function"==typeof c&&(P||(P=Object(h.h)(t)),r._dataRefresh=c.apply(P[i],[t.query,n.query]))),E._hadError||!E._isMounted||r._dataRefresh){e.next=6;break}return e.abrupt("return");case 6:return d=[],f=r.options.asyncData&&"function"==typeof r.options.asyncData,v=Boolean(r.options.fetch)&&r.options.fetch.length,_=f&&v?30:45,f&&((x=Object(h.q)(r.options.asyncData,y.context)).then((function(e){Object(h.b)(r,e),E.$loading.increase&&E.$loading.increase(_)})),d.push(x)),E.$loading.manual=!1===r.options.loading,v&&((p=r.options.fetch(y.context))&&(p instanceof Promise||"function"==typeof p.then)||(p=Promise.resolve(p)),p.then((function(e){E.$loading.increase&&E.$loading.increase(_)})),d.push(p)),e.abrupt("return",Promise.all(d));case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 82:c||(this.$loading.finish&&!this.$loading.manual&&this.$loading.finish(),o()),e.next=99;break;case 85:if(e.prev=85,e.t2=e.catch(29),"ERR_REDIRECT"!==(D=e.t2||{}).message){e.next=90;break}return e.abrupt("return",this.$nuxt.$emit("routeChanged",t,n,D));case 90:return w=[],Object(h.k)(D),"function"==typeof(A=(d.a.options||d.a).layout)&&(A=A(y.context)),e.next=96,this.loadLayout(A);case 96:this.error(D),this.$nuxt.$emit("routeChanged",t,n,D),o();case 99:case"end":return e.stop()}}),e,this,[[29,85],[48,73],[50,65,68,71]])})))).apply(this,arguments)}function E(e,n){Object(h.d)(e,(function(e,n,r,l){return"object"!==Object(t.a)(e)||e.options||((e=o.a.extend(e))._Ctor=e,r.components[l]=e),e}))}function I(e){var t=Boolean(this.$options.nuxt.err);this._hadError&&this._dateLastError===this.$options.nuxt.dateErr&&(t=!1);var n=t?(d.a.options||d.a).layout:e.matched[0].components.default.options.layout;"function"==typeof n&&(n=n(y.context)),this.setLayout(n)}function j(e){e._hadError&&e._dateLastError===e.$options.nuxt.dateErr&&e.error()}function F(e,t){var n=this;if(!1!==this._routeChanged||!1!==this._paramChanged||!1!==this._queryChanged){var r=Object(h.h)(e),l=Object(h.g)(e),c=!1;o.a.nextTick((function(){r.forEach((function(e,i){if(e&&!e._isDestroyed&&e.constructor._dataRefresh&&l[i]===e.constructor&&!0!==e.$vnode.data.keepAlive&&"function"==typeof e.constructor.options.data){var t=e.constructor.options.data.call(e);for(var n in t)o.a.set(e.$data,n,t[n]);c=!0}})),c&&window.$nuxt.$nextTick((function(){window.$nuxt.$emit("triggerScroll")})),j(n)}))}}function B(e){window.onNuxtReadyCbs.forEach((function(t){"function"==typeof t&&t(e)})),"function"==typeof window._onNuxtLoaded&&window._onNuxtLoaded(e),x.afterEach((function(t,n){o.a.nextTick((function(){return e.$nuxt.$emit("routeChanged",t,n)}))}))}function U(){return(U=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,l,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y=t.app,x=t.router,t.store,n=new o.a(y),r=S.layout||"default",e.next=7,n.loadLayout(r);case 7:return n.setLayout(r),l=function(){n.$mount("#__nuxt"),x.afterEach(E),x.afterEach(I.bind(n)),x.afterEach(F.bind(n)),o.a.nextTick((function(){B(n)}))},e.next=11,Promise.all(P(y.context.route));case 11:if(c=e.sent,n.setTransitions=n.$options.nuxt.setTransitions.bind(n),c.length&&(n.setTransitions(L(c,x.currentRoute)),w=x.currentRoute.matched.map((function(e){return Object(h.c)(e.path)(x.currentRoute.params)}))),n.$loading={},S.error&&n.error(S.error),x.beforeEach(k.bind(n)),x.beforeEach(D.bind(n)),!S.serverRendered||!Object(h.n)(S.routePath,n.context.route.path)){e.next=20;break}return e.abrupt("return",l());case 20:return d=function(){E(x.currentRoute,x.currentRoute),I.call(n,x.currentRoute),j(n),l()},e.next=23,new Promise((function(e){return setTimeout(e,0)}));case 23:D.call(n,x.currentRoute,x.currentRoute,(function(path){if(path){var e=x.afterEach((function(t,n){e(),d()}));x.push(path,void 0,(function(e){e&&O(e)}))}else d()}));case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(d.b)(null,S.config).then((function(e){return U.apply(this,arguments)})).catch(O)}.call(this,n(116))},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(310)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-38e90db5]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-38e90db5]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-38e90db5]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-38e90db5]:before{display:none;content:"large"}}.error[data-v-38e90db5]{opacity:0}',""]),e.exports=r},function(e,t,n){"use strict";n(311)},function(e,t,n){var r=n(94)(!1);r.push([e.i,".nuxt-progress{position:fixed;top:0;left:0;right:0;height:0;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}",""]),e.exports=r},function(e,t,n){var content=n(396);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(95).default)("dcafa518",content,!0,{sourceMap:!1})},function(e,t,n){var r=n(94)(!1);r.push([e.i,'@media (min-width:0){html:before{display:none;content:"small"}}@media (min-width:500px){html:before{display:none;content:"medium"}}@media (min-width:850px){html:before{display:none;content:"large"}}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,main,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;font-size:100%;vertical-align:baseline;border:0;font:inherit}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}[hidden]{display:none}body{line-height:1}menu,ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}@font-face{font-family:"Barlow";src:url(/fonts/Barlow-Thin.eot);src:url(/fonts/Barlow-Thin.eot?#iefix) format("embedded-opentype"),url(/fonts/Barlow-Thin.woff2) format("woff2"),url(/fonts/Barlow-Thin.woff) format("woff"),url(/fonts/Barlow-Thin.ttf) format("truetype"),url(/fonts/Barlow-Thin.svg) format("svg");font-weight:400;font-style:normal;font-display:swap;font-weight:100;-webkit-font-smoothing:antialiased;-khtml-font-smoothing:antialiased;-apple-font-smoothing:antialiased;font-smooth:always;-moz-osx-font-smoothing:grayscale}@font-face{font-family:"Barlow";src:url(/fonts/Barlow-ExtraLight.eot);src:url(/fonts/Barlow-ExtraLight.eot?#iefix) format("embedded-opentype"),url(/fonts/Barlow-ExtraLight.woff2) format("woff2"),url(/fonts/Barlow-ExtraLight.woff) format("woff"),url(/fonts/Barlow-ExtraLight.ttf) format("truetype"),url(/fonts/Barlow-ExtraLight.svg) format("svg");font-weight:400;font-style:normal;font-display:swap;font-weight:200;-webkit-font-smoothing:antialiased;-khtml-font-smoothing:antialiased;-apple-font-smoothing:antialiased;font-smooth:always;-moz-osx-font-smoothing:grayscale}@font-face{font-family:"Barlow";src:url(/fonts/Barlow-Light.eot);src:url(/fonts/Barlow-Light.eot?#iefix) format("embedded-opentype"),url(/fonts/Barlow-Light.woff2) format("woff2"),url(/fonts/Barlow-Light.woff) format("woff"),url(/fonts/Barlow-Light.ttf) format("truetype"),url(/fonts/Barlow-Light.svg) format("svg");font-weight:400;font-style:normal;font-display:swap;font-weight:300;-webkit-font-smoothing:antialiased;-khtml-font-smoothing:antialiased;-apple-font-smoothing:antialiased;font-smooth:always;-moz-osx-font-smoothing:grayscale}@font-face{font-family:"Barlow";src:url(/fonts/Barlow-Regular.eot);src:url(/fonts/Barlow-Regular.eot?#iefix) format("embedded-opentype"),url(/fonts/Barlow-Regular.woff2) format("woff2"),url(/fonts/Barlow-Regular.woff) format("woff"),url(/fonts/Barlow-Regular.ttf) format("truetype"),url(/fonts/Barlow-Regular.svg) format("svg");font-style:normal;font-display:swap;font-weight:400;-webkit-font-smoothing:antialiased;-khtml-font-smoothing:antialiased;-apple-font-smoothing:antialiased;font-smooth:always;-moz-osx-font-smoothing:grayscale}html{font-family:"Barlow",Arial,Helvetica,sans-serif;font-weight:400;font-size:1vw;-webkit-tap-highlight-color:transparent;-webkit-tap-highlight-color:rgba(0,0,0,0)}@media (min-width:500px){html{font-size:.55vw}}@media (min-width:850px){html{font-size:1vw}}@media (min-width:1920px){html{font-size:19.2px}}*{-webkit-touch-callout:none!important;-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important;font-family:"Barlow",Arial,Helvetica,sans-serif}body{overflow-y:scroll;-webkit-font-smoothing:antialiased;-khtml-font-smoothing:antialiased;-apple-font-smoothing:antialiased;font-smooth:always;-moz-osx-font-smoothing:grayscale}body.no-touch{overscroll-behavior-y:none;overscroll-behavior-block:none}body,html{color:#fff;background-color:#000}*{box-sizing:border-box}img{-webkit-user-drag:none;-khtml-user-drag:none;-moz-user-drag:none;-o-user-drag:none;user-drag:none}.button{display:inline-block;padding:0;color:inherit;text-decoration:none;background:none;border:0;outline:none;cursor:pointer}.paragraph{font-weight:300;font-size:4.26667rem;line-height:160%}@media (min-width:850px){.paragraph{font-size:1.25rem}}.paragraph--small{font-size:3.73333rem}@media (min-width:850px){.paragraph--small{font-size:1.10938rem}}.heading{font-weight:100;font-size:10.66667rem;line-height:auto}@media (min-width:850px){.heading{font-size:7.63698rem}}.container-max-width{width:calc(100% - 13.33333rem);margin:auto}@media (min-width:500px){.container-max-width{width:133.33333rem}}@media (min-width:850px){.container-max-width{width:87.76042rem}}',""]),r.locals={maxWithLarge:"1920px",fontSizeSmall:"1vw",fontSizeMedium:".55vw",fontSizeLarge:"1vw",viewportWidthSmall:"375px",viewportWidthMedium:"768px",viewportWidthLarge:"1920px"},e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(94)(!1);r.push([e.i,'@media (min-width:0){html:before{display:none;content:"small"}}@media (min-width:500px){html:before{display:none;content:"medium"}}@media (min-width:850px){html:before{display:none;content:"large"}}',""]),r.locals={maxWithLarge:"1920px",fontSizeSmall:"1vw",fontSizeMedium:".55vw",fontSizeLarge:"1vw",viewportWidthSmall:"375px",viewportWidthMedium:"768px",viewportWidthLarge:"1920px"},e.exports=r},,,,,,,function(e,t,n){n(27),n(88);var r=n(430),o=n(431),l=n(433),c=["x","e","a","o","n","s","r","c","u","m","v","w","z"],h=["m","w"],d=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],f="\t".charCodeAt(0),m=" ".charCodeAt(0);function v(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function _(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function y(e,t){if(!e.chars||0===e.chars.length)return null;var n=w(e.chars,t);return n>=0?e.chars[n]:null}function x(e,t,n){if(!e.kernings||0===e.kernings.length)return 0;for(var table=e.kernings,i=0;i<table.length;i++){var r=table[i];if(r.first===t&&r.second===n)return r.amount}return 0}function w(e,t,n){for(var i=n=n||0;i<e.length;i++)if(e[i].id===t)return i;return-1}e.exports=function(e){return new v(e)},v.prototype.update=function(e){if(e=o({measure:this._measure},e),this._opt=e,this._opt.tabSize=l(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,text=e.text||"",n=e.font;this._setupSpaceGlyphs(n);var h=r.lines(text,e),f=e.width||0;t.length=0;var m=h.reduce((function(e,line){return Math.max(e,line.width,f)}),0),v=0,_=0,y=l(e.lineHeight,n.common.lineHeight),S=n.common.base,C=y-S,O=e.letterSpacing||0,L=y*h.length-C,k=function(e){if("center"===e)return 1;if("right"===e)return 2;return 0}(this._opt.align);_-=L,this._width=m,this._height=L,this._descender=y-S,this._baseline=S,this._xHeight=function(e){for(var i=0;i<c.length;i++){var t=c[i].charCodeAt(0),n=w(e.chars,t);if(n>=0)return e.chars[n].height}return 0}(n),this._capHeight=function(e){for(var i=0;i<d.length;i++){var t=d[i].charCodeAt(0),n=w(e.chars,t);if(n>=0)return e.chars[n].height}return 0}(n),this._lineHeight=y,this._ascender=y-C-this._xHeight;var M=this;h.forEach((function(line,e){for(var r,o=line.start,l=line.end,c=line.width,i=o;i<l;i++){var h=text.charCodeAt(i),glyph=M.getGlyph(n,h);if(glyph){r&&(v+=x(n,r.id,glyph.id));var d=v;1===k?d+=(m-c)/2:2===k&&(d+=m-c),t.push({position:[d,_],data:glyph,index:i,line:e}),v+=glyph.xadvance+O,r=glyph}}_+=y,v=0})),this._lettersTotal=t.length,this._linesTotal=h.length},v.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=y(e,m)||function(e){for(var i=0;i<h.length;i++){var t=h[i].charCodeAt(0),n=w(e.chars,t);if(n>=0)return e.chars[n]}return 0}(e)||e.chars[0],n=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=o(t,{x:0,y:0,xadvance:n,id:f,xoffset:0,yoffset:0,width:0,height:0})}},v.prototype.getGlyph=function(e,t){var glyph=y(e,t);return glyph||(t===f?this._fallbackTabGlyph:t===m?this._fallbackSpaceGlyph:null)},v.prototype.computeMetrics=function(text,e,t,n){var r,o=this._opt.letterSpacing||0,l=this._opt.font,c=0,h=0,d=0;if(!l.chars||0===l.chars.length)return{start:e,end:e,width:0};t=Math.min(text.length,t);for(var i=e;i<t;i++){var glyph,f=text.charCodeAt(i);if(glyph=this.getGlyph(l,f)){glyph.xoffset;var m=(c+=r?x(l,r.id,glyph.id):0)+glyph.xadvance+o,v=c+glyph.width;if(v>=n||m>=n)break;c=m,h=v,r=glyph}d++}return r&&(h+=r.xoffset),{start:e,end:e+d,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight","linesTotal","lettersTotal"].forEach((function(e){Object.defineProperty(v.prototype,e,{get:_(e),configurable:!0})}))},,,,,,,,,function(e,t,n){n(31),n(15),n(67),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(27),e.exports.pages=function(e){var t=new Float32Array(4*e.length*1),i=0;return e.forEach((function(glyph){var e=glyph.data.page||0;t[i++]=e,t[i++]=e,t[i++]=e,t[i++]=e})),t},e.exports.attributes=function(e,t,n,r){var o=new Float32Array(4*e.length*2),l=new Float32Array(4*e.length*2),c=new Float32Array(4*e.length*2),i=0,h=0,d=0;return e.forEach((function(glyph){var e=glyph.data,f=e.x+e.width,m=e.y+e.height,v=e.x/t,_=e.y/n,y=f/t,x=m/n;r&&(_=(n-e.y)/n,x=(n-m)/n),o[i++]=v,o[i++]=_,o[i++]=v,o[i++]=x,o[i++]=y,o[i++]=x,o[i++]=y,o[i++]=_;var w=glyph.position[0]+e.xoffset,S=glyph.position[1]+e.yoffset,C=e.width,O=e.height;l[h++]=w,l[h++]=S,l[h++]=w,l[h++]=S+O,l[h++]=w+C,l[h++]=S+O,l[h++]=w+C,l[h++]=S,c[d++]=w+C/2,c[d++]=S+O/2,c[d++]=w+C/2,c[d++]=S+O/2,c[d++]=w+C/2,c[d++]=S+O/2,c[d++]=w+C/2,c[d++]=S+O/2})),{uvs:o,positions:l,centers:c}},e.exports.infos=function(e){var t=new Float32Array(4*e.length),n=new Float32Array(4*e.length),i=0,r=0;return e.forEach((function(glyph){t[i++]=glyph.line,t[i++]=glyph.line,t[i++]=glyph.line,t[i++]=glyph.line,n[r++]=glyph.index,n[r++]=glyph.index,n[r++]=glyph.index,n[r++]=glyph.index})),{lines:t,letters:n}}},function(e,t){var n={min:[0,0],max:[0,0]};function r(e){var t=e.length/2;n.min[0]=e[0],n.min[1]=e[1],n.max[0]=e[0],n.max[1]=e[1];for(var i=0;i<t;i++){var r=e[2*i+0],o=e[2*i+1];n.min[0]=Math.min(r,n.min[0]),n.min[1]=Math.min(o,n.min[1]),n.max[0]=Math.max(r,n.max[0]),n.max[1]=Math.max(o,n.max[1])}}e.exports.computeBox=function(e,output){return r(e),output.min.set(n.min[0],n.min[1],0),output.max.set(n.max[0],n.max[1],0),output},e.exports.computeSphere=function(e,output){r(e);var t=n.min[0],o=n.min[1],l=n.max[0]-t,c=n.max[1]-o,h=Math.sqrt(l*l+c*c);output.center.set(t+l/2,o+c/2,0),output.radius=h/2}},function(e,t,n){"use strict";n(333)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-424232e3]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-424232e3]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-424232e3]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-424232e3]:before{display:none;content:"large"}}.background[data-v-424232e3]{position:fixed;top:0;left:0}.interactions[data-v-424232e3]{z-index:1337;position:fixed;bottom:50px;left:0;right:0;width:200px;margin:0 auto;font-size:0;text-align:center}.interactions li[data-v-424232e3]{display:inline-block}.interactions button[data-v-424232e3]{width:30px;height:30px;margin:10px;border:0;outline:none;background:#fff;font-size:11px;color:#000;cursor:pointer}.interactions button.active[data-v-424232e3]{background:#000;color:#fff}',""]),e.exports=r},function(e,t,n){"use strict";n(334)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-3936698a]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-3936698a]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-3936698a]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-3936698a]:before{display:none;content:"large"}}.lang-switch[data-v-3936698a]{font-size:13px;text-transform:uppercase;white-space:nowrap}@media (min-width:850px){.lang-switch[data-v-3936698a]{font-size:13px}}.button[data-v-3936698a]{margin-right:4rem;color:hsla(0,0%,100%,.5);transition:color .2s cubic-bezier(.61,1,.88,1)}.button.nuxt-link-active[data-v-3936698a],.button[data-v-3936698a]:hover{color:#fff}@media (min-width:850px){.button[data-v-3936698a]{margin-right:.9375rem}}',""]),e.exports=r},function(e,t,n){"use strict";n(335)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-7823738c]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-7823738c]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-7823738c]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-7823738c]:before{display:none;content:"large"}}.menu[data-v-7823738c]{opacity:0;visibility:hidden;position:fixed;top:0;left:0;justify-content:center;width:100%;height:100%;pointer-events:none}.container[data-v-7823738c],.menu[data-v-7823738c]{display:flex;flex-direction:column}.container[data-v-7823738c]{position:relative;justify-content:flex-end;width:calc(100% - 13.33334rem);height:calc(100% - 10.66666rem);margin:auto}@media (min-width:850px){.container[data-v-7823738c]{display:block;width:100%;height:100%}}.navigation[data-v-7823738c]{display:flex;position:relative;justify-content:space-between;height:50%;flex-direction:column}@media (min-width:850px){.navigation[data-v-7823738c]{display:block;position:absolute;top:0;left:50%;width:47.76042rem;height:100%;margin-top:0;margin-left:0}}.navigation-list[data-v-7823738c]{position:relative;margin-bottom:10.93333rem;font-weight:100;font-size:13.33333rem;line-height:110%;letter-spacing:0;text-transform:uppercase}@media (min-width:850px){.navigation-list[data-v-7823738c]{position:absolute;top:46%;left:0;margin-bottom:0;padding-left:0;font-size:5.72917rem}}@media (min-width:850px) and (max-height:820px){.navigation-list[data-v-7823738c]{top:auto;bottom:20vh}}.navigation-list-item[data-v-7823738c]{pointer-events:all}.link[data-v-7823738c]{position:relative;color:#3e3d36;white-space:nowrap;transition:color 2s cubic-bezier(.33,1,.68,1)}.link[data-v-7823738c]:hover{color:#fff}.route-name[data-v-7823738c]{opacity:0;position:absolute;top:0;left:0}.chars[data-v-7823738c]{opacity:0;position:relative;color:#fff}.logo-container[data-v-7823738c]{opacity:0;position:absolute;top:0;left:0;height:9.6rem}@media (min-width:850px){.logo-container[data-v-7823738c]{position:absolute;top:33%;left:23%;width:.7rem;height:1.40625rem}}.logo-icon[data-v-7823738c]{position:absolute;top:0;left:0;width:100%;height:3.2rem}@media (min-width:850px){.logo-icon[data-v-7823738c]{width:.26042rem;height:.78125rem}}.diamond[data-v-7823738c]{position:absolute;left:0;width:.8rem;height:.8rem}.diamond[data-v-7823738c]:first-child{top:0;transform:translateY(-500%)}.diamond[data-v-7823738c]:nth-child(2){bottom:0;transform:translateY(500%)}.diamond[data-v-7823738c]:before{position:absolute;top:0;left:0;width:100%;height:100%;background:#fff;transform:rotate(45deg);content:""}@media (min-width:850px){.diamond[data-v-7823738c]{width:.20833rem;height:.20833rem}}.name[data-v-7823738c]{position:absolute;top:1.6rem;left:3.73333rem;font-weight:400;font-size:4rem;line-height:100%;letter-spacing:.2em;text-transform:uppercase}@media (min-width:850px){.name[data-v-7823738c]{top:.3125rem;left:.9375rem;font-size:1.09375rem}}.name-span[data-v-7823738c]{opacity:.5}.lang-switch[data-v-7823738c]{opacity:0;margin-left:1px;pointer-events:all}@media (min-width:850px){.lang-switch[data-v-7823738c]{position:absolute;bottom:2.08333rem;left:.26042rem;margin-left:0}}',""]),e.exports=r},function(e,t,n){"use strict";n(336)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-99e23fd8]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-99e23fd8]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-99e23fd8]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-99e23fd8]:before{display:none;content:"large"}}.button-mute[data-v-99e23fd8]{opacity:0;display:flex;position:fixed;right:6.66667rem;bottom:2.66667rem;align-items:flex-end;width:80px;min-width:80px;height:48px;min-height:48px;font-family:"Barlow";font-weight:300;font-size:15px;letter-spacing:.1em;-webkit-font-smoothing:auto;-khtml-font-smoothing:auto;-apple-font-smoothing:auto;font-smooth:auto;-moz-osx-font-smoothing:grayscale;color:#fff}.is-touch .button-mute[data-v-99e23fd8]{visibility:hidden!important}@media (min-width:850px){.button-mute[data-v-99e23fd8]{right:2.98438rem;bottom:1.04167rem;width:80px;min-width:80px;height:55px;min-height:55px;font-size:15px}}.container[data-v-99e23fd8]{position:absolute;right:0;bottom:2.66667rem;justify-content:flex-end;align-items:center;width:100%;text-align:right}@media (min-width:850px){.container[data-v-99e23fd8]{right:0;bottom:1.04167rem}}.label[data-v-99e23fd8]{opacity:0;position:absolute;right:19px;bottom:0;line-height:80%;text-align:right}.label span[data-v-99e23fd8]{opacity:.45}@media (min-width:850px){.label[data-v-99e23fd8]{right:19px}}.circle-container[data-v-99e23fd8]{position:absolute;right:-6px;bottom:-1px;width:12px;min-width:12px;height:12px;min-height:12px;margin-top:2px}@media (min-width:850px){.circle-container[data-v-99e23fd8]{right:-6px;width:12px;min-width:12px;height:12px;min-height:12px}}.circle-svg[data-v-99e23fd8]{position:absolute;right:0;bottom:0;width:100%;height:100%;overflow:visible;border:1px solid transparent;transform:rotate(-90deg)}.circle[data-v-99e23fd8]{transform-origin:center;transition:transform .5s ease-in-out;fill:transparent;stroke-width:1px;stroke:#fff}.circle[data-v-99e23fd8],.circle.animated[data-v-99e23fd8]{opacity:1}.line[data-v-99e23fd8]{transform:rotate(30deg);transform-origin:center;fill:transparent;stroke-width:1px;stroke:#fff}',""]),e.exports=r},function(e,t,n){"use strict";n(337)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-07152e2f]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-07152e2f]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-07152e2f]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-07152e2f]:before{display:none;content:"large"}}.logo-animation[data-v-07152e2f]{opacity:0;width:127px;height:40px;-webkit-touch-callout:none!important;-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}@media (min-width:850px){.logo-animation[data-v-07152e2f]{width:5px}}.squares[data-v-07152e2f]{position:absolute;top:-7px;left:0;width:5px;height:14px;flex-direction:column}@media (min-width:850px){.squares[data-v-07152e2f]{top:-7px;width:5px;height:14px}}.squares .square[data-v-07152e2f]{position:absolute;right:0;left:0;margin:auto;width:3px;height:3px;background-color:#fff;transform:rotate(45deg)}@media (min-width:850px){.squares .square[data-v-07152e2f]{width:3px;height:3px}}.squares .square.top[data-v-07152e2f]{top:0}.squares .square.bottom[data-v-07152e2f]{bottom:0}.squares .square.placeholder[data-v-07152e2f]{opacity:0}.name[data-v-07152e2f]{position:absolute;top:0;left:18px;font-weight:400;font-size:18px;line-height:100%;letter-spacing:.2em;text-transform:uppercase}@media (min-width:850px){.name[data-v-07152e2f]{top:0;left:18px;font-size:18px}}.word[data-v-07152e2f]{white-space:nowrap}.char[data-v-07152e2f]{opacity:0}',""]),e.exports=r},function(e,t,n){"use strict";n(338)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-cff97910]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-cff97910]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-cff97910]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-cff97910]:before{display:none;content:"large"}}.cursor-intro[data-v-cff97910]{opacity:.5;position:fixed;bottom:0;width:100%;height:100%;font-weight:300;font-size:10px;letter-spacing:.1em;color:#bbbab2;text-transform:uppercase;-webkit-font-smoothing:auto;-khtml-font-smoothing:auto;-apple-font-smoothing:auto;font-smooth:auto;-moz-osx-font-smoothing:grayscale}@media (min-width:850px){.cursor-intro[data-v-cff97910]{bottom:2.08333rem;width:auto;height:auto;font-size:10px}}.cursor[data-v-cff97910]{opacity:0;display:none;position:absolute;top:0;left:10px;padding-top:45px;white-space:nowrap}@media (min-width:850px){.cursor[data-v-cff97910]{display:block;padding-top:45px}}.cursor-static[data-v-cff97910]{opacity:0;display:none;position:absolute;top:60%;right:0;left:0;width:35%;margin:auto;padding-top:5.33333rem;padding-right:6.66667rem;padding-left:6.66667rem;line-height:120%;text-align:center}@media (min-width:850px){.cursor-static[data-v-cff97910]{display:block;position:absolute;top:auto;right:auto;bottom:0;left:0;width:auto;padding-top:2.08333rem;padding-right:0;padding-left:2.98438rem;line-height:100%;text-align:left}}.cursor-mobile[data-v-cff97910]{opacity:0;display:flex;position:absolute;top:60%;right:0;left:0;justify-content:center;align-items:center;width:85px;height:85px;margin:auto;color:#fff;text-align:center;border:1px solid #3e3d36;border-radius:50%}@media (min-width:850px){.cursor-mobile[data-v-cff97910]{display:none}}.cursor-mobile .content[data-v-cff97910]{margin-left:.3em;font-size:10px;line-height:70%;letter-spacing:.3em;text-align:center}.cursor-mobile .char[data-v-cff97910]{opacity:0}',""]),e.exports=r},function(e,t,n){"use strict";n(339)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-278753da]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-278753da]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-278753da]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-278753da]:before{display:none;content:"large"}}.preloader[data-v-278753da]{z-index:1338;opacity:0;position:fixed;top:0;left:0;width:100%;height:100%}.logo-animation[data-v-278753da]{top:0;bottom:0}.cookies-message[data-v-278753da],.logo-animation[data-v-278753da]{position:absolute;right:0;left:0;margin:auto}.cookies-message[data-v-278753da]{opacity:0;bottom:5.33333rem;width:55%;font-size:10px;line-height:160%;letter-spacing:.3em;color:#bbbab2;text-align:center;text-transform:uppercase}@media (min-width:850px){.cookies-message[data-v-278753da]{bottom:9%;width:50%;font-size:10px}}',""]),e.exports=r},function(e,t,n){"use strict";n(340)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-4e0c4033]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-4e0c4033]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-4e0c4033]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-4e0c4033]:before{display:none;content:"large"}}.cookie-message[data-v-4e0c4033]{position:fixed;bottom:0;left:0}',""]),e.exports=r},function(e,t,n){"use strict";n(341)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-5d87bb12]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-5d87bb12]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-5d87bb12]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-5d87bb12]:before{display:none;content:"large"}}.audio-controller[data-v-5d87bb12]{display:none}',""]),e.exports=r},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(343)},function(e,t,n){var r=n(94)(!1);r.push([e.i,'[data-v-6d28008c]:export{maxWithLarge:1920px;fontSizeSmall:1vw;fontSizeMedium:.55vw;fontSizeLarge:1vw;viewportWidthSmall:375px;viewportWidthMedium:768px;viewportWidthLarge:1920px}@media (min-width:0){html[data-v-6d28008c]:before{display:none;content:"small"}}@media (min-width:500px){html[data-v-6d28008c]:before{display:none;content:"medium"}}@media (min-width:850px){html[data-v-6d28008c]:before{display:none;content:"large"}}',""]),e.exports=r},function(e,t,n){"use strict";n.r(t);t.default={setDebug:function(e,t){(0,e.commit)("SET_DEBUG",t)},setDevelopment:function(e,t){(0,e.commit)("SET_DEVELOPMENT",t)},setProduction:function(e,t){(0,e.commit)("SET_PRODUCTION",t)}}},function(e,t,n){"use strict";n.r(t);t.default={isDebug:function(e){return e.isDebug},isDevelopment:function(e){return e.isDevelopment},isProduction:function(e){return e.isProduction}}},function(e,t,n){"use strict";n.r(t);t.default={SET_DEBUG:function(e,t){e.isDebug=t},SET_DEVELOPMENT:function(e,t){e.isDevelopment=t},SET_PRODUCTION:function(e,t){e.isProduction=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{isDebug:!1,isDevelopment:!1,isProduction:!1}}},function(e,t,n){"use strict";n.r(t);t.default={setSizes:function(e,t){(0,e.commit)("SET_SIZES",{width:t.width,height:t.height})},setBreakpoint:function(e,t){(0,e.commit)("SET_BREAKPOINT",t)},setTouch:function(e,t){(0,e.commit)("SET_TOUCH",t)},setGpuTier:function(e,t){(0,e.commit)("SET_GPU_TIER",t)}}},function(e,t,n){"use strict";n.r(t);t.default={width:function(e){return e.width},height:function(e){return e.height},viewportSize:function(e){return{width:e.width,height:e.height}},breakpoint:function(e){return e.breakpoint},isTouch:function(e){return e.isTouch},device:function(e){return e},gpuTier:function(e){return e.gpuTier}}},function(e,t,n){"use strict";n.r(t);t.default={SET_SIZES:function(e,t){var n=t.width,r=t.height;e.width=n,e.height=r},SET_BREAKPOINT:function(e,t){e.breakpoint=t},SET_TOUCH:function(e,t){e.isTouch=t},SET_GPU_TIER:function(e,t){e.gpuTier=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{width:null,height:null,breakpoint:"large",isTouch:!1,gpuTier:null}}},function(e,t,n){"use strict";n.r(t);t.default={setScrollTriggered:function(e,t){(0,e.commit)("SET_SCROLL_TRIGGERED",t)},setClickInteractionTriggered:function(e,t){(0,e.commit)("SET_CLICK_INTERACTION_TRIGGERED",t)},setMenuTriggeredWithScrollTriggered:function(e,t){(0,e.commit)("SET_MENU_TRIGGERED_WITH_SCROLL_TRIGGERED",t)}}},function(e,t,n){"use strict";n.r(t);t.default={isScrollTriggered:function(e){return e.isScrollTriggered},isClickInteractionTriggered:function(e){return e.isClickInteractionTriggered},isMenuTriggeredWithScrollTriggered:function(e){return e.isMenuTriggeredWithScrollTriggered}}},function(e,t,n){"use strict";n.r(t);t.default={SET_SCROLL_TRIGGERED:function(e,t){e.isScrollTriggered=t},SET_CLICK_INTERACTION_TRIGGERED:function(e,t){e.isClickInteractionTriggered=t},SET_MENU_TRIGGERED_WITH_SCROLL_TRIGGERED:function(e,t){e.isMenuTriggeredWithScrollTriggered=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{isScrollTriggered:!1,isClickInteractionTriggered:!1,isMenuTriggeredWithScrollTriggered:!1}}},function(e,t,n){"use strict";n.r(t);t.default={setOpen:function(e){(0,e.commit)("SET_OPEN")},setClose:function(e){(0,e.commit)("SET_CLOSE")},setIsClosing:function(e,t){(0,e.commit)("SET_IS_CLOSING",t)},setIsOpening:function(e,t){(0,e.commit)("SET_IS_OPENING",t)}}},function(e,t,n){"use strict";n.r(t);t.default={isOpen:function(e){return e.isOpen},isClosing:function(e){return e.isClosing},isOpening:function(e){return e.isOpening}}},function(e,t,n){"use strict";n.r(t);t.default={SET_OPEN:function(e){e.isOpen=!0},SET_CLOSE:function(e){e.isOpen=!1},SET_IS_CLOSING:function(e,t){e.isClosing=t},SET_IS_OPENING:function(e,t){e.isOpening=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{isOpen:!1,isClosing:!1,isOpening:!1}}},function(e,t,n){"use strict";n.r(t);t.default={setPosition:function(e,t){(0,e.commit)("SET_POSITION",t)}}},function(e,t,n){"use strict";n.r(t);t.default={position:function(e){return e.position},hasMoved:function(e){return e.hasMoved}}},function(e,t,n){"use strict";n.r(t);t.default={SET_POSITION:function(e,t){e.hasMoved=!0,e.position=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{hasMoved:!1,position:{x:0,y:0}}}},function(e,t,n){"use strict";n.r(t);t.default={setLoadingStarted:function(e){(0,e.commit)("SET_LOADING_STARTED")},setLoadingCompleted:function(e){(0,e.commit)("SET_LOADING_COMPLETED")},setCompleted:function(e){(0,e.commit)("SET_COMPLETED")}}},function(e,t,n){"use strict";n.r(t);t.default={isLoadingStarted:function(e){return e.isLoadingStarted},isLoadingCompleted:function(e){return e.isLoadingCompleted},isCompleted:function(e){return e.isCompleted}}},function(e,t,n){"use strict";n.r(t);t.default={SET_LOADING_STARTED:function(e){e.isLoadingStarted=!0},SET_LOADING_COMPLETED:function(e){e.isLoadingCompleted=!0},SET_COMPLETED:function(e){e.isCompleted=!0}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{isCompleted:!1,isLoadingStarted:!1,isLoadingCompleted:!1}}},function(e,t,n){"use strict";n.r(t);t.default={setPrevious:function(e,t){(0,e.commit)("SET_PREVIOUS",t)},setCurrent:function(e,t){(0,e.commit)("SET_CURRENT",t)}}},function(e,t,n){"use strict";n.r(t);t.default={previous:function(e){return e.previous},current:function(e){return e.current},state:function(e){return e}}},function(e,t,n){"use strict";n.r(t);t.default={SET_PREVIOUS:function(e,t){e.previous=t},SET_CURRENT:function(e,t){e.current=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{previous:null,current:null}}},function(e,t,n){"use strict";n.r(t);t.default={lock:function(e){(0,e.commit)("SET_LOCK")},unlock:function(e){(0,e.commit)("SET_UNLOCK")},setLockPosition:function(e,t){(0,e.commit)("SET_LOCK_POSITION",t)},setPosition:function(e,t){(0,e.commit)("SET_POSITION",t)}}},function(e,t,n){"use strict";n.r(t);t.default={isLocked:function(e){return e.isLocked},lockPosition:function(e){return e.lockPosition},position:function(e){return e.position}}},function(e,t,n){"use strict";n.r(t);t.default={SET_LOCK:function(e){e.isLocked=!0},SET_UNLOCK:function(e){e.isLocked=!1},SET_LOCK_POSITION:function(e,t){e.lockPosition=t},SET_POSITION:function(e,t){e.position=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{isLocked:!1,lockPosition:null,position:null}}},function(e,t,n){"use strict";n.r(t);t.default={setLandscapeTransitionIn:function(e){(0,e.commit)("SET_LANDSCAPE_TRANSITION_IN")},setLandscapeTransitionOut:function(e){(0,e.commit)("SET_LANDSCAPE_TRANSITION_OUT")},setLandscapeTransitionNone:function(e){(0,e.commit)("SET_LANDSCAPE_TRANSITION_NONE")},setLandscapeTransitionTriggered:function(e,t){(0,e.commit)("SET_LANDSCAPE_TRANSITION_TRIGGERED",t)},setActiveLandscape:function(e,t){(0,e.commit)("SET_ACTIVE_LANDSCAPE",t)},setTheEndShow:function(e){(0,e.commit)("SET_THE_END_SHOW")},setTheEndHide:function(e){(0,e.commit)("SET_THE_END_HIDE")},setTheEndNone:function(e){(0,e.commit)("SET_THE_END_NONE")}}},function(e,t,n){"use strict";n.r(t);var r=n(86),o={isLandscapeTransitioningIn:function(e){return e.landscapeTransition===r.LANDSCAPE_TRANSITION_IN},isLandscapeTransitioningOut:function(e){return e.landscapeTransition===r.LANDSCAPE_TRANSITION_OUT},isLandscapeTransitioningNone:function(e){return e.landscapeTransition===r.LANDSCAPE_TRANSITION_NONE},isLandscapeTransitionTriggered:function(e){return e.landscapeTransitionTriggered},activeLandscape:function(e){return e.activeLandscape},isTheEndShowStarted:function(e){return e.theEnd===r.THE_END_SHOW},isTheEndHideStarted:function(e){return e.theEnd===r.THE_END_HIDE},isTheEndNone:function(e){return e.theEnd===r.THE_END_NONE}};t.default=o},function(e,t,n){"use strict";n.r(t);var r=n(86),o={SET_LANDSCAPE_TRANSITION_IN:function(e){e.landscapeTransition=r.LANDSCAPE_TRANSITION_IN},SET_LANDSCAPE_TRANSITION_OUT:function(e){e.landscapeTransition=r.LANDSCAPE_TRANSITION_OUT},SET_LANDSCAPE_TRANSITION_NONE:function(e){e.landscapeTransition=r.LANDSCAPE_TRANSITION_NONE},SET_LANDSCAPE_TRANSITION_TRIGGERED:function(e,t){e.landscapeTransitionTriggered=t},SET_ACTIVE_LANDSCAPE:function(e,t){e.activeLandscape=t},SET_THE_END_SHOW:function(e){e.theEnd=r.THE_END_SHOW},SET_THE_END_HIDE:function(e){e.theEnd=r.THE_END_HIDE},SET_THE_END_NONE:function(e){e.theEnd=r.THE_END_NONE}};t.default=o},function(e,t,n){"use strict";n.r(t);var r=n(86);t.default=function(){return{landscapeTransition:r.LANDSCAPE_TRANSITION_NONE,landscapeTransitionTriggered:!1,activeLandscape:null,theEnd:r.THE_END_NONE}}},function(e,t,n){"use strict";n.r(t);t.default={setName:function(e,t){(0,e.commit)("SET_NAME",t)},setSafari:function(e,t){(0,e.commit)("SET_SAFARI",t)},setEdge:function(e,t){(0,e.commit)("SET_EDGE",t)},setIE:function(e,t){(0,e.commit)("SET_IE",t)},setFirefox:function(e,t){(0,e.commit)("SET_FIREFOX",t)}}},function(e,t,n){"use strict";n.r(t);n(17);t.default={name:function(e){return e.name},isSafari:function(e){return e.isSafari},isEdge:function(e){return e.isEdge},isIE:function(e){return e.isIE},isFirefox:function(e){return e.isFirefox}}},function(e,t,n){"use strict";n.r(t);n(17);t.default={SET_NAME:function(e,t){e.name=t},SET_SAFARI:function(e,t){e.isSafari=t},SET_EDGE:function(e,t){e.isEdge=t},SET_IE:function(e,t){e.isIE=t},SET_FIREFOX:function(e,t){e.isFirefox=t}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{name:null,isSafari:!1,isEdge:!1,isIE:!1,isFirefox:!1}}},function(e,t,n){"use strict";n.r(t);n(17);t.default={setViewAvailable:function(e,t){(0,e.commit)("SET_VIEW_AVAILABLE",{name:t.name,value:t.isAvailable})}}},function(e,t,n){"use strict";n.r(t);t.default={isViewAvailable:function(e){return function(t){return e[t].isAvailable}}}},function(e,t,n){"use strict";n.r(t);n(17);t.default={SET_VIEW_AVAILABLE:function(e,t){var n=t.name,r=t.value;e[n].isAvailable=r}}},function(e,t,n){"use strict";n.r(t);t.default=function(){return{home:{isAvailable:!1},about:{isAvailable:!1},work:{isAvailable:!1},debug:{isAvailable:!1}}}},,function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return bt}));var r=n(2),o=n(3),l=(n(109),n(7)),c=n(11),h=n(0),d=n(209),f=(n(10),n(4)),m=n(5),v=n(1);function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var y=function(e){Object(f.a)(n,e);var t=_(n);function n(e){var o,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GPU MS";Object(r.a)(this,n),o=t.call(this,l,"#f90","#210");var c=!0,h=e.getExtension("EXT_disjoint_timer_query_webgl2");return null===h&&(c=!1,null===(h=e.getExtension("EXT_disjoint_timer_query"))&&console.warn("GPUStatsPanel: disjoint_time_query extension not available.")),o.context=e,o.extension=h,o.maxTime=30,o.activeQueries=0,o.startQuery=function(){var e=this,t=this.context,n=this.extension;if(null!==n){var r;c?(r=t.createQuery(),t.beginQuery(n.TIME_ELAPSED_EXT,r)):(r=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,r)),this.activeQueries++;requestAnimationFrame((function(){var o,l,h;c?(o=t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),l=t.getParameter(n.GPU_DISJOINT_EXT),h=t.getQueryParameter(r,t.QUERY_RESULT)):(o=n.getQueryObjectEXT(r,n.QUERY_RESULT_AVAILABLE_EXT),l=t.getParameter(n.GPU_DISJOINT_EXT),h=n.getQueryObjectEXT(r,n.QUERY_RESULT_EXT));var d=1e-6*h;o&&(l||e.update(d,e.maxTime),e.activeQueries--)}))}},o.endQuery=function(){var e=this.extension,t=this.context;null!==e&&(c?t.endQuery(e.TIME_ELAPSED_EXT):e.endQueryEXT(e.TIME_ELAPSED_EXT))},o}return n}(d.a.Panel),x=n(8),w=n(9),S=n(59),C=n(55),O=(n(74),n(15),n(90),n(72),n(23),n(99),n(100),n(73),n(17),n(89),n(92),n(126)),L=n(29);function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var P=function(e){Object(f.a)(n,e);var t=T(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing,l=e.completeCallback;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._completeCallback=l,this._active=null,this._isTransitioning=!1,this._sceneResourcesLoaded=[],this._scenes=[],this._createScenes(),this._bindHandlers(),this._setupEventListeners()}},{key:"destroy",value:function(){this._destroyScenes(),this._removeEventListeners(),this._removeDebugLayers()}},{key:"scenes",get:function(){return this._scenes}},{key:"active",get:function(){var e;return null===(e=this._active)||void 0===e?void 0:e.instance}},{key:"get",value:function(e){return this._getSceneByName(e)}},{key:"show",value:function(e){var t=e.name,n=e.instant,r=void 0!==n&&n,o=e.playIntro,l=void 0!==o&&o,c=this._getSceneByName(t);c&&(this._sceneRenderer.enable(),this._active&&c.instance.camera.copyData(this._active.instance.camera),this._postProcessing.loadSettings(t),this._loadRenderSettings(c.data.renderer),this._active=c,this._root.nuxtRoot.$store.dispatch("webgl/setActiveLandscape",t),w.a&&w.a.gotoLayer(c.name),c.instance.addEventListener("complete",this._sceneCompleteHandler),c.instance.show({instant:r,playIntro:l}))}},{key:"hide",value:function(e){var t=e.name,n=e.instant,r=void 0!==n&&n,o=e.onCompleteCallback,l=this._getSceneByName(t);l&&l.instance.hide({instant:r,onCompleteCallback:o})}},{key:"transitionIn",value:function(){var e,t=this;return null===(e=this._timelineOut)||void 0===e||e.kill(),this._timelineIn=new l.a.timeline({onComplete:function(){t._isTransitioning=!1}}),this._timelineIn.set(this._postProcessing.passes.final.uniforms.uTransitionProgress,{value:0},0),this._timelineIn.to(this._postProcessing.passes.final.uniforms.uNoiseProgress,{duration:1,value:1,ease:"sine.inOut"},0),this._timelineIn}},{key:"transitionOut",value:function(){var e,t=this;return this._isTransitioning=!0,null===(e=this._timelineIn)||void 0===e||e.kill(),this._timelineOut=new l.a.timeline({onComplete:function(){t._active=!1}}),this._timelineOut.to(this._postProcessing.passes.final.uniforms.uTransitionProgress,{duration:1.3,value:1,ease:"sine.inOut"},0),this._timelineOut.to(this._postProcessing.passes.final.uniforms.uNoiseProgress,{duration:1,value:0,ease:"sine.inOut"},0),this._timelineOut.set(this._postProcessing.passes.godrays,{enabled:!1},1.7),this._timelineOut.call((function(){t._postProcessing.clear()}),null,1.7),this._timelineOut.call((function(){t._postProcessing.passes.lineRender.disable()}),null,1.7),this._timelineOut}},{key:"loadResourcesNextScene",value:function(){var e=(this._scenes.indexOf(this._active)+1)%this._scenes.length,t=this._scenes[e];this._sceneResourcesLoaded.includes(e)||(this._sceneResourcesLoaded.push(e),new x.c({namespace:t.name}).load())}},{key:"showNext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._showNextScene(e)}},{key:"loadRenderSettings",value:function(e){this._loadRenderSettings(e)}},{key:"_bindHandlers",value:function(){this._layerChangeHandler=this._layerChangeHandler.bind(this),this._sceneCompleteHandler=this._sceneCompleteHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this)}},{key:"_setupEventListeners",value:function(){w.a&&w.a.addEventListener("layer:change",this._layerChangeHandler),this._root.nuxtRoot.$store.getters["context/isDevelopment"]&&window.addEventListener("keydown",this._keyDownHandler)}},{key:"_removeEventListeners",value:function(){w.a&&w.a.removeEventListener("layer:change",this._layerChangeHandler),this._root.nuxtRoot.$store.getters["context/isDevelopment"]&&window.removeEventListener("keydown",this._keyDownHandler)}},{key:"_createScenes",value:function(){var e=0,t=this;!function n(r){var o=O.a[r];if(o){w.a&&w.a.addLayer(o.name),t._postProcessing.addSettings(o.name,o.postProcessing);var l=new o.class({root:t._root,renderer:t._renderer,sceneRenderer:t._sceneRenderer,postProcessing:t._postProcessing,config:o});l.name=o.name,t._scenes.push({name:o.name,instance:l,data:o}),"function"==typeof l.prepare&&l.prepare((function(){n(++e)}),t)}else"function"==typeof t._completeCallback&&t._completeCallback()}(e)}},{key:"_getSceneByName",value:function(e){var t,n=k(this._scenes);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.name===e)return r}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"_destroyScenes",value:function(){var e,t=k(this._scenes);try{for(t.s();!(e=t.n()).done;){var n=e.value;"function"==typeof n.instance.destroy&&n.instance.destroy()}}catch(e){t.e(e)}finally{t.f()}}},{key:"_loadRenderSettings",value:function(e){this._renderer.setClearColor(e.clearColor),this._renderer.toneMapping=e.toneMapping,e.toneMappingExposure&&(this._renderer.toneMappingExposure=e.toneMappingExposure),e.outputEncoding&&(this._renderer.outputEncoding=e.outputEncoding,this._sceneRenderer.renderTarget.texture.encoding=e.outputEncoding)}},{key:"_showNextScene",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isTransitioning){for(var n,i=0,r=O.a.length;i<r;i++)O.a[i].name===this._active.name&&(n=i);var o=(n+1)%O.a.length,l=O.a[o];L.a.playLandscapeTransition(l.audio.transition),this.hide({name:this._active.name,instant:t,onCompleteCallback:function(){e.show({name:l.name,instant:t}),e._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionTriggered",!1)}})}}},{key:"_removeDebugLayers",value:function(){if(w.a)for(var e,i=0,t=this._scenes.length;i<t;i++)e=this._scenes[i],w.a.removeLayer(e.name)}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._active&&"function"==typeof this._active.instance.update&&this._active.instance.update({time:time,delta:t})}},{key:"_layerChangeHandler",value:function(e){this.show({name:e,instant:!0})}},{key:"_sceneCompleteHandler",value:function(){this._root.nuxtRoot.$store.dispatch("webgl/setLandscapeTransitionTriggered",!0),this._root.nuxtRoot.$store.getters["menu/isOpen"]||this._root.nuxtRoot.$store.getters["menu/isOpening"]||this._showNextScene()}},{key:"_keyDownHandler",value:function(e){switch(e.key){case"1":this.active.setState(0);break;case"2":this.active.setState(1);break;case"3":this.active.setState(2)}}}]),n}(Object(c.a)()),R=n(127),D=n(69);function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var j=function(e){Object(f.a)(n,e);var t=I(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.postProcessing;this._root=t,this._renderer=n,this._sceneRenderer=r,this._postProcessing=o,this._active=null,this._views=this._createViews(),this._bindHandlers(),this._setupEventListeners()}},{key:"destroy",value:function(){this._destroyViews(),this._removeEventListeners(),this._removeDebugLayers()}},{key:"views",get:function(){return this._views}},{key:"active",get:function(){var e;return null===(e=this._active)||void 0===e?void 0:e.instance}},{key:"get",value:function(e){return this._getViewByName(e)}},{key:"show",value:function(e){var view=this._getViewByName(e);view&&this._active!==view&&(this._active=view,this._loadRenderSettings(view.data.renderer),view.instance.show())}},{key:"hide",value:function(e,t){var view=this._getViewByName(e);view&&view.instance.hide(t)}},{key:"_bindHandlers",value:function(){this._layerChangeHandler=this._layerChangeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){w.a&&w.a.addEventListener("layer:change",this._layerChangeHandler)}},{key:"_removeEventListeners",value:function(){w.a&&w.a.removeEventListener("layer:change",this._layerChangeHandler)}},{key:"_createViews",value:function(){var e,t,n=[],r=A(R.a);try{for(r.s();!(t=r.n()).done;){var view=t.value;w.a&&w.a.addLayer(view.name),this._postProcessing.addSettings(view.name,view.postProcessing),(e=new view.class({root:this._root,renderer:this._renderer,sceneRenderer:this._sceneRenderer,postProcessing:this._postProcessing,config:view})).name=view.name,n.push({name:view.name,instance:e,data:view})}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"_getViewByName",value:function(e){var t,n=A(this._views);try{for(n.s();!(t=n.n()).done;){var view=t.value;if(view.name.toLowerCase()===e.toLowerCase())return view}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"_destroyViews",value:function(){var e,t=A(this._views);try{for(t.s();!(e=t.n()).done;){var view=e.value;"function"==typeof view.instance.destroy&&view.instance.destroy()}}catch(e){t.e(e)}finally{t.f()}}},{key:"_loadRenderSettings",value:function(e){var t=1;e.dpr&&(t=D.a.active("small")&&S.a.dpr()>1?e.dpr.mobile:e.dpr.desktop),this._root.setDpr(t),this._renderer.setClearColor(e.clearColor)}},{key:"_showNextView",value:function(){for(var e,t=this,i=0,n=R.a.length;i<n;i++)R.a[i].name===this._active.name&&(e=i);var r=(e+1)%R.a.length,o=R.a[r];this.hide(this._active.name,(function(){t.show(o.name)}))}},{key:"_removeDebugLayers",value:function(){if(w.a)for(var e,i=0,t=this._views.length;i<t;i++)e=this._views[i],w.a.removeLayer(e.name)}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this._active&&"function"==typeof this._active.instance.update&&this._active.instance.update({time:time,delta:t})}},{key:"_layerChangeHandler",value:function(e){this.show(e)}}]),n}(Object(c.a)()),F=n(174);function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var U=function(e){Object(f.a)(n,e);var t=B(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.renderer;this._renderer=t,this._isEnabled=!0,this._renderTarget=this._createRenderTarget()}},{key:"destroy",value:function(){this._renderTarget.dispose()}},{key:"renderTarget",get:function(){return this._renderTarget}},{key:"texture",get:function(){return this._renderTarget.texture}},{key:"depthTexture",get:function(){return this._renderTarget.depthTexture}},{key:"transitionPass",get:function(){return this._transitionPass}},{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"_createRenderTarget",value:function(){var e=new(0,h.WebGLRenderTarget)(0,0);return e.texture.encoding=this._renderer.outputEncoding,e.texture.format=h.RGBAFormat,e.texture.minFilter=h.LinearFilter,e.texture.magFilter=h.LinearFilter,e.texture.generateMipmaps=!1,e.depthBuffer=!0,e.depthTexture=new h.DepthTexture,e}},{key:"render",value:function(e,t){this._isEnabled&&(this._renderScene(e,t),this._renderStatue(e))}},{key:"_renderScene",value:function(e,t){this._renderer.setRenderTarget(this._renderTarget),this._renderer.clear(),this._renderer.render(e,t)}},{key:"_renderStatue",value:function(e){"Forest"===e.name&&e.components&&e.components.statue&&e.components.statue.render()}},{key:"onResize",value:function(e){var t=e.width,n=e.height,r=e.renderScale;this._renderWidthScaled=t*r,this._renderHeightScaled=n*r,this._resizeRenderTarget()}},{key:"_resizeRenderTarget",value:function(){this._renderTarget.setSize(this._renderWidthScaled,this._renderHeightScaled)}}]),n}(Object(c.a)()),N=n(362),z=n(125),G=n(352),H=n(276),V=n(353),W=n(68),$=n(120),Y=n(152);function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var K=function(e){Object(f.a)(n,e);var t=X(n);function n(e,o,l,c){var d;Object(r.a)(this,n),(d=t.call(this)).strength=void 0!==o?o:1,d.radius=l,d.threshold=c,d.resolution=void 0!==e?new h.Vector2(e.x,e.y):new h.Vector2(256,256),d.clearColor=new h.Color(0,0,0);var f={minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBAFormat};d.renderTargetsHorizontal=[],d.renderTargetsVertical=[],d.nMips=5;var m=Math.round(d.resolution.x/2),v=Math.round(d.resolution.y/2);d.renderTargetBright=new h.WebGLRenderTarget(m,v,f),d.renderTargetBright.texture.name="UnrealBloomPass.bright",d.renderTargetBright.texture.generateMipmaps=!1;for(var i=0;i<d.nMips;i++){var _=new h.WebGLRenderTarget(m,v,f);_.texture.name="UnrealBloomPass.h"+i,_.texture.generateMipmaps=!1,d.renderTargetsHorizontal.push(_);var y=new h.WebGLRenderTarget(m,v,f);y.texture.name="UnrealBloomPass.v"+i,y.texture.generateMipmaps=!1,d.renderTargetsVertical.push(y),m=Math.round(m/2),v=Math.round(v/2)}void 0===Y.a&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");var x=Y.a;d.highPassUniforms=h.UniformsUtils.clone(x.uniforms),d.highPassUniforms.luminosityThreshold.value=c,d.highPassUniforms.smoothWidth.value=.01,d.materialHighPassFilter=new h.ShaderMaterial({uniforms:d.highPassUniforms,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,defines:{}}),d.separableBlurMaterials=[];var w=[3,5,7,9,11];m=Math.round(d.resolution.x/2),v=Math.round(d.resolution.y/2);for(var S=0;S<d.nMips;S++)d.separableBlurMaterials.push(d.getSeperableBlurMaterial(w[S])),d.separableBlurMaterials[S].type="UnrealBoomBlurMaterial",d.separableBlurMaterials[S].uniforms.texSize.value=new h.Vector2(m,v),m=Math.round(m/2),v=Math.round(v/2);d.compositeMaterial=d.getCompositeMaterial(d.nMips),d.compositeMaterial.type="UnrealBloomCompositeMaterial",d.compositeMaterial.uniforms.blurTexture1.value=d.renderTargetsVertical[0].texture,d.compositeMaterial.uniforms.blurTexture2.value=d.renderTargetsVertical[1].texture,d.compositeMaterial.uniforms.blurTexture3.value=d.renderTargetsVertical[2].texture,d.compositeMaterial.uniforms.blurTexture4.value=d.renderTargetsVertical[3].texture,d.compositeMaterial.uniforms.blurTexture5.value=d.renderTargetsVertical[4].texture,d.compositeMaterial.uniforms.bloomStrength.value=o,d.compositeMaterial.uniforms.bloomRadius.value=.1,d.compositeMaterial.needsUpdate=!0;d.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],d.bloomTintColors=[new h.Vector3(1,1,1),new h.Vector3(1,1,1),new h.Vector3(1,1,1),new h.Vector3(1,1,1),new h.Vector3(1,1,1)],d.compositeMaterial.uniforms.bloomTintColors.value=d.bloomTintColors,void 0===$.a&&console.error("THREE.UnrealBloomPass relies on CopyShader");var C=$.a;return d.copyUniforms=h.UniformsUtils.clone(C.uniforms),d.copyUniforms.opacity.value=1,d.materialCopy=new h.ShaderMaterial({uniforms:d.copyUniforms,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,blending:h.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),d.materialCopy.type="BloomBlendMaterial",d.enabled=!0,d.needsSwap=!1,d._oldClearColor=new h.Color,d.oldClearAlpha=1,d.basic=new h.MeshBasicMaterial,d.fsQuad=new W.a(null),d}return Object(o.a)(n,[{key:"dispose",value:function(){for(var i=0;i<this.renderTargetsHorizontal.length;i++)this.renderTargetsHorizontal[i].dispose();for(var e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}},{key:"setSize",value:function(e,t){var n=Math.round(e/3),r=Math.round(t/3);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new h.Vector2(n,r),n=Math.round(n/2),r=Math.round(r/2)}},{key:"render",value:function(e,t,r,o,l){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var c=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),l&&e.state.buffers.stencil.setTest(!1);for(var h=t,i=0;i<this.nMips;i++)this.fsQuad.material=this.separableBlurMaterials[i],this.separableBlurMaterials[i].uniforms.colorTexture.value=h.texture,this.separableBlurMaterials[i].uniforms.direction.value=n.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[i]),this.fsQuad.render(e),this.separableBlurMaterials[i].uniforms.colorTexture.value=this.renderTargetsHorizontal[i].texture,this.separableBlurMaterials[i].uniforms.direction.value=n.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[i]),this.fsQuad.render(e),h=this.renderTargetsVertical[i];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,l&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=c}},{key:"getSeperableBlurMaterial",value:function(e){return new h.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new h.Vector2(.5,.5)},direction:{value:new h.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}},{key:"getCompositeMaterial",value:function(e){return new h.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}]),n}(W.b);K.BlurDirectionX=new h.Vector2(1,0),K.BlurDirectionY=new h.Vector2(0,1);var Q=function(){function e(){Object(r.a)(this,e),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}return Object(o.a)(e,[{key:"setSize",value:function(){}},{key:"render",value:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}]),e}(),Z=new h.OrthographicCamera(-1,1,1,-1,0,1),J=new h.BufferGeometry;J.setAttribute("position",new h.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),J.setAttribute("uv",new h.Float32BufferAttribute([0,2,0,0,2,0],2));var ee=function(){function e(t){Object(r.a)(this,e),this._mesh=new h.Mesh(J,t)}return Object(o.a)(e,[{key:"dispose",value:function(){this._mesh.geometry.dispose()}},{key:"render",value:function(e){e.render(this._mesh,Z)}},{key:"compile",value:function(e){e.compile(this._mesh,Z)}},{key:"material",get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}]),e}();function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var ne=function(e){Object(f.a)(n,e);var t=te(n);function n(e,o,l,c,d,f){var m;Object(r.a)(this,n),(m=t.call(this)).renderer=e,m.strength=void 0!==l?l:1,m.radius=c,m.threshold=d,m.resolution=void 0!==o?new h.Vector2(o.x,o.y):new h.Vector2(256,256),m.resolutionScale=f||.25,m.inputTexture=null,m.clearColor=new h.Color(0,0,0);var v={minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBAFormat};m.renderTargetsHorizontal=[],m.renderTargetsVertical=[],m.nMips=5;var _=Math.round(m.resolution.x/2),y=Math.round(m.resolution.y/2);m.renderTargetBright=new h.WebGLRenderTarget(_,y,v),m.renderTargetBright.texture.name="UnrealBloomPass.bright",m.renderTargetBright.texture.generateMipmaps=!1;for(var i=0;i<m.nMips;i++){var x=new h.WebGLRenderTarget(_,y,v);x.texture.name="UnrealBloomPass.h"+i,x.texture.generateMipmaps=!1,m.renderTargetsHorizontal.push(x);var w=new h.WebGLRenderTarget(_,y,v);w.texture.name="UnrealBloomPass.v"+i,w.texture.generateMipmaps=!1,m.renderTargetsVertical.push(w),_=Math.round(_/2),y=Math.round(y/2)}void 0===Y.a&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");var S=Y.a;m.highPassUniforms=h.UniformsUtils.clone(S.uniforms),m.highPassUniforms.luminosityThreshold.value=d,m.highPassUniforms.smoothWidth.value=.01,m.materialHighPassFilter=new h.ShaderMaterial({uniforms:m.highPassUniforms,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,defines:{}}),m.separableBlurMaterials=[];var C=[3,5,7,9,11];_=Math.round(m.resolution.x/2),y=Math.round(m.resolution.y/2);for(var O=0;O<m.nMips;O++)m.separableBlurMaterials.push(m.getSeperableBlurMaterial(C[O])),m.separableBlurMaterials[O].uniforms.texSize.value=new h.Vector2(_,y),_=Math.round(_/2),y=Math.round(y/2);m.compositeMaterial=m.getCompositeMaterial(m.nMips),m.compositeMaterial.uniforms.blurTexture1.value=m.renderTargetsVertical[0].texture,m.compositeMaterial.uniforms.blurTexture2.value=m.renderTargetsVertical[1].texture,m.compositeMaterial.uniforms.blurTexture3.value=m.renderTargetsVertical[2].texture,m.compositeMaterial.uniforms.blurTexture4.value=m.renderTargetsVertical[3].texture,m.compositeMaterial.uniforms.blurTexture5.value=m.renderTargetsVertical[4].texture,m.compositeMaterial.uniforms.bloomStrength.value=l,m.compositeMaterial.uniforms.bloomRadius.value=.1,m.compositeMaterial.needsUpdate=!0;m.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],m.enabled=!0,m.needsSwap=!1,m._oldClearColor=new h.Color,m.oldClearAlpha=1,m.fsQuad=new ee(null);for(var L=0;L<m.nMips;L++)m.fsQuad.material=m.separableBlurMaterials[L],m.fsQuad.compile(m.renderer);return m.fsQuad.material=m.compositeMaterial,m.fsQuad.compile(m.renderer),m}return Object(o.a)(n,[{key:"dispose",value:function(){for(var i=0;i<this.renderTargetsHorizontal.length;i++)this.renderTargetsHorizontal[i].dispose();for(var e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}},{key:"setSize",value:function(e,t){var n=Math.round(e*this.resolutionScale),r=Math.round(t*this.resolutionScale);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new h.Vector2(n,r),n=Math.round(n/2),r=Math.round(r/2)}},{key:"render",value:function(e,t,r,o,l){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var c=e.autoClear;e.autoClear=!1,l&&e.state.buffers.stencil.setTest(!1);for(var h=this.inputTexture,i=0;i<this.nMips;i++)this.fsQuad.material=this.separableBlurMaterials[i],this.separableBlurMaterials[i].uniforms.colorTexture.value=h.texture,this.separableBlurMaterials[i].uniforms.direction.value=n.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[i]),this.fsQuad.render(e),this.separableBlurMaterials[i].uniforms.colorTexture.value=this.renderTargetsHorizontal[i].texture,this.separableBlurMaterials[i].uniforms.direction.value=n.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[i]),this.fsQuad.render(e),h=this.renderTargetsVertical[i];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,e.setRenderTarget(this.renderTargetsHorizontal[0]),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=c}},{key:"getSeperableBlurMaterial",value:function(e){return new h.RawShaderMaterial({type:"SeperableBlurMaterial",defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new h.Vector2(.5,.5)},direction:{value:new h.Vector2(.5,.5)}},vertexShader:"precision highp float;\n                precision highp int;\n\n                attribute vec3 position;\n                attribute vec2 uv;\n\n                uniform mat4 modelViewMatrix;\n                uniform mat4 projectionMatrix;\n\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"precision highp float;\n                precision highp int;\n\n                #include <common>\n                varying vec2 vUv;\n                uniform sampler2D colorTexture;\n                uniform vec2 texSize;\n                uniform vec2 direction;\n\n                float gaussianPdf(in float x, in float sigma) {\n                    return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n                }\n                void main() {\n                    vec2 invSize = 1.0 / texSize;\n                    float fSigma = float(SIGMA);\n                    float weightSum = gaussianPdf(0.0, fSigma);\n                    vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                    for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                        float x = float(i);\n                        float w = gaussianPdf(x, fSigma);\n                        vec2 uvOffset = direction * invSize * x;\n                        vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                        vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                        diffuseSum += (sample1 + sample2) * w;\n                        weightSum += 2.0 * w;\n                    }\n                    gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n                }"})}},{key:"getCompositeMaterial",value:function(e){return new h.RawShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomRadius:{value:0}},vertexShader:"precision highp float;\n                precision highp int;\n\n                attribute vec3 position;\n                attribute vec2 uv;\n\n                uniform mat4 modelViewMatrix;\n                uniform mat4 projectionMatrix;\n\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"precision highp float;\n                precision highp int;\n\n                varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\n                        lerpBloomFactor(bloomFactors[0]) * texture2D(blurTexture1, vUv) +\n                        lerpBloomFactor(bloomFactors[1]) * texture2D(blurTexture2, vUv) +\n                        lerpBloomFactor(bloomFactors[2]) * texture2D(blurTexture3, vUv) +\n                        lerpBloomFactor(bloomFactors[3]) * texture2D(blurTexture4, vUv) +\n                        lerpBloomFactor(bloomFactors[4]) * texture2D(blurTexture5, vUv)\n                    );\n                }"})}}]),n}(Q);ne.BlurDirectionX=new h.Vector2(1,0),ne.BlurDirectionY=new h.Vector2(0,1);function ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var re=function(e){Object(f.a)(n,e);var t=ie(n);function n(e){e.lut;var o,l=e.vignette;return Object(r.a)(this,n),(o=t.call(this,new h.RawShaderMaterial({vertexShader:"// Precision\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Uniforms\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv;\n\n// Varyings\nvarying vec2 vUv;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"// Precision\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Defines\n#define PI 3.141592653589793\n\n// Uniforms\nuniform sampler2D tDiffuse;\nuniform vec2 uResolution;\nuniform float uTime;\nuniform mat4 uProjectionInverse;\nuniform mat4 uViewMatrixInv;\nuniform float uCameraNear;\nuniform float uCameraFar;\n\n// Vignette\n#if defined(SHOW_VIGNETTE)\n    uniform float uVignetteOffset;\n    uniform float uVignetteDarkness;\n#endif\n\n// Sun flare\nuniform vec3 uSunPosition;\n\n// Depth texture\nuniform sampler2D uDepthTexture;\n\n// Transition\nuniform vec3 uTransitionColor;\nuniform float uTransitionProgress;\n\n// Scan effect\nuniform vec3 uScanStartPosition;\nuniform float uScanProgress;\nuniform float uScanAlpha;\n\n// Noise\nuniform float uNoiseStrength;\nuniform float uNoiseProgress;\n\n// Varyings\nvarying vec2 vUv;\n\n// Requires\n// https://www.shadertoy.com/view/4djSRW\nfloat random(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * 443.8975);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat luma(vec3 color) {\n  return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nfloat luma(vec4 color) {\n  return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nfloat blendSoftLight(float base, float blend) {\n\treturn (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend) {\n\treturn vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n\treturn (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n}\n\n// Includes\n#include <packing>\n\n// https://stackoverflow.com/questions/32227283/getting-world-position-from-depth-buffer-value\nvec3 worldPosFromDepth(float depth) {\n    float z = depth * 2.0 - 1.0;\n\n    vec4 clipSpacePosition = vec4(vUv * 2.0 - 1.0, z, 1.0);\n    vec4 viewSpacePosition = uProjectionInverse * clipSpacePosition;\n\n    // Perspective division\n    viewSpacePosition /= viewSpacePosition.w;\n\n    vec4 worldSpacePosition = uViewMatrixInv * viewSpacePosition;\n\n    return worldSpacePosition.xyz;\n}\n\n// Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 finalLevels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 contrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n    // Increase or decrease theese values to adjust r, g and b color channels seperately\n    const float AvgLumR = 0.5;\n    const float AvgLumG = 0.5;\n    const float AvgLumB = 0.5;\n\n    const vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n    vec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n    vec3 brtColor = color * brt;\n    vec3 intensity = vec3(dot(brtColor, LumCoeff));\n    vec3 satColor = mix(intensity, brtColor, sat);\n    vec3 conColor = mix(AvgLumin, satColor, con);\n    return conColor;\n}\n\nvoid main() {\n    // Depth\n    float depth = texture2D(uDepthTexture, vUv).r;\n\n    // World position\n    vec3 worldPosition = worldPosFromDepth(depth);\n\n    // Base\n    gl_FragColor = texture2D(tDiffuse, vUv);\n\n    // Scan effect\n    float scanDistance = uScanProgress * 10000.0;\n    float scanWidth = 5000.0;\n    float dist = distance(worldPosition, uScanStartPosition);\n\n    if (dist < scanDistance && dist > scanDistance - scanWidth && depth != 1.0) {\n        float diff = 1.0 - (scanDistance - dist) / scanWidth;\n        vec3 lvlColor = contrastSaturationBrightness(gl_FragColor.rgb, 2.0, 1.0, 1.0);\n        lvlColor *= 4.0;\n        float b = pow(diff, 20.0) * uScanAlpha;\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, lvlColor, b);\n    }\n\n    // Vignette\n    #if defined(SHOW_VIGNETTE)\n        const vec2 center = vec2(0.5);\n        float d = distance(vUv, center);\n        gl_FragColor *= smoothstep(0.8, uVignetteOffset * 0.799, d * (uVignetteDarkness + uVignetteOffset));\n    #endif\n\n    // Transition\n    float level = 1.0 - uTransitionProgress;\n    float brightness = 1.0;\n    float saturation = 1.0 - uTransitionProgress;\n    float alpha = 1.0 - uTransitionProgress;\n    float contrast = 1.0;\n    gl_FragColor = vec4(finalLevels(gl_FragColor.rgb, 0.0, level, 1.0), 1.0);\n    gl_FragColor = vec4(contrastSaturationBrightness(gl_FragColor.rgb, brightness, saturation, contrast), 1.0);\n    gl_FragColor = mix(vec4(uTransitionColor, 1.0), gl_FragColor, alpha);\n\n    // Noise\n    vec4 originalColor = gl_FragColor;\n    gl_FragColor.rgb += (random(vUv) - 0.5) * uNoiseStrength * uNoiseProgress;\n    float luminance = luma(originalColor.rgb);\n    float response = smoothstep(0.05, 0.5, luminance);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, originalColor.rgb, pow(response, 2.0));\n}\n",uniforms:{tDiffuse:{value:null},uResolution:{value:new h.Vector2},uTime:{value:0},uVignetteOffset:{value:l.offset},uVignetteDarkness:{value:l.darkness},uDepthTexture:{value:null},uCameraNear:{value:1},uCameraFar:{value:5e4},uProjectionInverse:{value:null},uViewMatrixInv:{value:null},uScanStartPosition:{value:new h.Vector3},uScanProgress:{value:0},uScanAlpha:{value:0},uFlashProgress:{value:0},uScanTexture:{value:0},uTransitionColor:{value:new h.Color(0)},uTransitionProgress:{value:0},uNoiseStrength:{value:.022},uNoiseProgress:{value:0}}})))._isLensFlareVisible=!1,o._isVignetteVisible=!1,o._isGrainVisible=!0,o._isGrainVisible&&(o.material.defines.SHOW_GRAIN=""),o.material.type="FinalPass",o}return Object(o.a)(n,[{key:"isVignetteVisible",get:function(){return this._isVignetteVisible},set:function(e){this._isVignetteVisible=e,e?this.material.defines.SHOW_VIGNETTE="":delete this.material.defines.SHOW_VIGNETTE,this.material.needsUpdate=!0}},{key:"vignetteOffset",get:function(){return this.uniforms.uVignetteOffset.value},set:function(e){this.uniforms.uVignetteOffset.value=e}},{key:"vignetteDarkness",get:function(){return this.uniforms.uVignetteDarkness.value},set:function(e){this.uniforms.uVignetteDarkness.value=e}},{key:"depthTexture",get:function(){return this.uniforms.uDepthTexture.value},set:function(e){this.uniforms.uDepthTexture.value=e}},{key:"transitionColor",get:function(){return this.uniforms.uTransitionColor.value},set:function(e){this.uniforms.uTransitionColor.value=e}},{key:"transitionProgress",get:function(){return this.uniforms.uTransitionProgress.value},set:function(e){this.uniforms.uTransitionProgress.value=e}},{key:"isGrainVisible",get:function(){return this._isGrainVisible},set:function(e){this._isGrainVisible=e,e?this.material.defines.SHOW_GRAIN="":delete this.material.defines.SHOW_GRAIN,this.material.needsUpdate=!0}},{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,e.setRenderTarget(null),this.fsQuad.render(e)}},{key:"spawnScan",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=void 0!==n.start?n.start:.018,o=void 0!==n.duration?n.duration:3,c=void 0!==n.alphaDuration?n.alphaDuration:1,h=void 0!==n.alphaDelay?n.alphaDelay:2;this.uniforms.uScanStartPosition.value=e,null===(t=this._spawnScanTimeline)||void 0===t||t.kill(),this._spawnScanTimeline=new l.a.timeline,this._spawnScanTimeline.fromTo(this.uniforms.uScanProgress,{value:r},{duration:o,value:1,ease:"power1.in"},0),this._spawnScanTimeline.fromTo(this.uniforms.uScanAlpha,{value:1},{duration:c,value:0,ease:"sine.inOut"},h)}},{key:"onUpdate",value:function(e){var time=e.time;this.uniforms.uTime.value=time}},{key:"setSize",value:function(e,t){this.uniforms.uResolution.value.x=e,this.uniforms.uResolution.value.y=t}}]),n}(Object(c.a)(z.a));function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var oe=function(e){Object(f.a)(n,e);var t=ae(n);function n(e){var o;return Object(r.a)(this,n),(o=t.call(this,{vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"#define GLSLIFY 1\n// Defines\n#define LUT_FLIP_Y\n\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D tDiffuse;\nuniform vec3 uColor;\nuniform float uProgress;\nuniform bool uIsLutActive;\nuniform sampler2D tLutTexture;\nuniform float uLutTransition;\nuniform vec4 uLutOffset;\n\n// Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 finalLevels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 contrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n    // Increase or decrease theese values to adjust r, g and b color channels seperately\n    const float AvgLumR = 0.5;\n    const float AvgLumG = 0.5;\n    const float AvgLumB = 0.5;\n\n    const vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n    vec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n    vec3 brtColor = color * brt;\n    vec3 intensity = vec3(dot(brtColor, LumCoeff));\n    vec3 satColor = mix(intensity, brtColor, sat);\n    vec3 conColor = mix(AvgLumin, satColor, con);\n    return conColor;\n}\n\n// https://github.com/mattdesl/glsl-lut\nvec4 lookup(in vec4 textureColor, in sampler2D lookupTable, in vec2 texOffset) {\n    #ifndef LUT_NO_CLAMP\n        textureColor = clamp(textureColor, 0.0, 1.0);\n    #endif\n\n    mediump float blueColor = textureColor.b * 63.0;\n\n    mediump vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n    mediump vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n    highp vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n    #ifdef LUT_FLIP_Y\n        texPos1.y = 1.0-texPos1.y;\n    #endif\n\n    highp vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n    #ifdef LUT_FLIP_Y\n        texPos2.y = 1.0-texPos2.y;\n    #endif\n\n    lowp vec4 newColor1 = texture2D(lookupTable, texOffset + texPos1 * 0.5);\n    lowp vec4 newColor2 = texture2D(lookupTable, texOffset + texPos2 * 0.5);\n\n    lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n    return newColor;\n}\n\nvoid main() {\n    // Sample\n    vec4 color = texture2D(tDiffuse, vUv);\n\n    // LUT\n    if (uIsLutActive) {\n        vec4 lut1 = lookup(color, tLutTexture, uLutOffset.xy);\n        vec4 lut2 = lookup(color, tLutTexture, uLutOffset.zw);\n        color = mix(lut1, lut2, uLutTransition);\n    }\n\n    // Transition\n    float level = 1.0 - uProgress;\n    float brightness = 1.0;\n    float saturation = 1.0 - uProgress;\n    float alpha = 1.0 - uProgress;\n    float contrast = 1.0;\n    color = vec4(finalLevels(color.rgb, 0.0, level, 1.0), 1.0);\n    color = vec4(contrastSaturationBrightness(color.rgb, brightness, saturation, contrast), 1.0);\n    color = mix(vec4(uColor, 1.0), color, alpha);\n    gl_FragColor = color;\n}\n",uniforms:{tDiffuse:{value:null},uColor:{value:new h.Color(e.color)},uProgress:{value:1},tLutTexture:{value:new h.Texture},uIsLutActive:{value:!1},uLutTransition:{value:0},uLutOffset:{value:new h.Vector4}}})).material.type="TransitionPass",o.material.transparent=!0,o.material.depthTest=!1,o.material.depthWrite=!1,o.needsSwap=!0,o}return Object(o.a)(n,[{key:"color",get:function(){return this.uniforms.uColor.value},set:function(e){this.uniforms.uColor.value=e}},{key:"progress",get:function(){return this.uniforms.uProgress.value},set:function(e){this.uniforms.uProgress.value=e}},{key:"render",value:function(e,t,n){this.material.uniforms.tDiffuse.value=n.texture,e.setRenderTarget(t),this.fsQuad.render(e)}},{key:"changeLUT",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new h.Vector4;switch(e){case 0:n.set(0,.5,0,0);break;case 1:n.set(0,0,.5,0);break;case 2:n.set(.5,0,0,.5)}this.uniforms.uLutOffset.value.copy(n);var r=t?0:2;l.a.fromTo(this.uniforms.uLutTransition,{value:0},{duration:r,value:1,ease:"sine.inOut"})}}]),n}(Object(c.a)(z.a)),se="#define GLSLIFY 1\n// Attributes\nattribute vec3 position;\n#ifdef USE_INSTANCING\n    attribute mat4 instanceMatrix;\n#endif\n\n// Uniforms\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main() {\n    // Output\n    #if defined(USE_INSTANCING)\n        gl_Position = projectionMatrix * modelViewMatrix * instanceMatrix * vec4(position, 1.0);\n    #else\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    #endif\n}\n",le="#define GLSLIFY 1\nvoid main() {\n    // Output\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n";function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var ce=function(e){Object(f.a)(n,e);var t=ue(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,n),(e=t.call(this))._lineTexture=o.lineTexture,e._transitionPass=o.transitionPass,e._scene=new h.Scene,e._camera=new h.PerspectiveCamera,e._oldClearColor=new h.Color,e._renderTarget=e._createRenderTarget(),e._overrideMaterial=e._createOverrideMaterial(),e._overrideInstanceMaterial=e._createOverrideIntanceMaterial(),e._transitionQuad=e._createTransitionQuad(),e._lineQuad=e._createLineQuad(),e.clear=!0,e.clearDepth=!1,e.needsSwap=!1,e.clearColor=o.clearColor,e.clearAlpha=void 0!==o.clearAlpha?o.clearAlpha:0,e}return Object(o.a)(n,[{key:"scene",get:function(){return this._scene},set:function(e){this._scene=e}},{key:"camera",get:function(){return this._camera},set:function(e){this._camera=e}},{key:"compile",value:function(e){var t=new h.PlaneBufferGeometry(1,1),n=new h.Mesh(t,this._overrideMaterial);this._scene.add(n),e.compile(this._scene,this._camera),n.material=this._overrideInstanceMaterial,e.compile(this._scene,this._camera),this._scene.remove(n)}},{key:"render",value:function(e,t){var n,r=this,o=e.autoClear;e.autoClear=!1,this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),this._renderTarget.texture.encoding=e.outputEncoding,e.setRenderTarget(this._renderTarget),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._scene.traverse((function(object){"Mesh"!==object.type&&"SkinnedMesh"!==object.type&&"Points"!==object.type&&"CameraHelper"!==object.type||(object.userData&&void 0!==object.userData.renderBloom&&object.visible?(object.userData.originalVisibilityState=object.visible,object.visible=object.userData.renderBloom,object.userData.bloomMaterial&&(object.userData.originalMaterial=object.material,object.material=object.userData.bloomMaterial)):object.visible&&(object.userData.material=object.material,object.instanceMatrix?object.material=r._overrideInstanceMaterial:object.material=r._overrideMaterial,object.userData.invisibleForBloom=!0)),"Trees"===object.name&&(object.visible=!1)})),e.render(this._scene,this._camera),e.setRenderTarget(t),this._transitionQuad.material.uniforms.tDiffuse.value=this._renderTarget.texture,this._transitionQuad.material.uniforms.uProgress.value=this._transitionPass.progress,this._transitionQuad.render(e),this._lineQuad.render(e),this._scene.traverse((function(object){object.userData&&(object.userData.originalVisibilityState&&(object.visible=object.userData.originalVisibilityState,object.userData.originalVisibilityState=null),object.userData.invisibleForBloom&&(object.material=object.userData.material,object.userData.invisibleForBloom=!1),object.userData.bloomMaterial&&(object.material=object.userData.originalMaterial),"Trees"===object.name&&(object.visible=!0))})),this.clearColor&&e.setClearColor(this._oldClearColor,n),e.autoClear=o}},{key:"_createRenderTarget",value:function(){var e=new h.WebGLRenderTarget(0,0);return e.texture.format=h.RGBFormat,e.texture.minFilter=h.NearestFilter,e.texture.magFilter=h.NearestFilter,e.texture.generateMipmaps=!1,e}},{key:"_createTransitionQuad",value:function(){var e=new h.ShaderMaterial({fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D tDiffuse;\nuniform vec3 uColor;\nuniform float uProgress;\n\n// Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 finalLevels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 contrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n    // Increase or decrease theese values to adjust r, g and b color channels seperately\n    const float AvgLumR = 0.5;\n    const float AvgLumG = 0.5;\n    const float AvgLumB = 0.5;\n\n    const vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n    vec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n    vec3 brtColor = color * brt;\n    vec3 intensity = vec3(dot(brtColor, LumCoeff));\n    vec3 satColor = mix(intensity, brtColor, sat);\n    vec3 conColor = mix(AvgLumin, satColor, con);\n    return conColor;\n}\n\nvoid main() {\n    // Sample\n    vec4 color = texture2D(tDiffuse, vUv);\n\n    // Transition\n    float level = 1.0 - uProgress;\n    float brightness = 1.0;\n    float saturation = 1.0 - uProgress;\n    float alpha = 1.0 - uProgress;\n    float contrast = 1.0;\n    color = vec4(finalLevels(color.rgb, 0.0, level, 1.0), 1.0);\n    color = vec4(contrastSaturationBrightness(color.rgb, brightness, saturation, contrast), 1.0);\n    color = mix(vec4(uColor, 1.0), color, alpha);\n    gl_FragColor = color;\n}\n",vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",uniforms:{tDiffuse:{value:null},uColor:{value:this._transitionPass.color},uProgress:{value:this._transitionPass.progress}}});return new W.a(e)}},{key:"_createLineQuad",value:function(){var e=new h.ShaderMaterial({fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vUv);\n}",vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",uniforms:{uTexture:{value:this._lineTexture}}});return e.blending=h.CustomBlending,e.blendEquation=h.AddEquation,e.blendSrc=h.OneFactor,e.blendDst=h.OneMinusSrcAlphaFactor,e.blendSrcAlpha=h.OneFactor,e.blendDstAlpha=h.OneMinusSrcAlphaFactor,new W.a(e)}},{key:"_createOverrideMaterial",value:function(){var e=new h.RawShaderMaterial({vertexShader:se,fragmentShader:le});return e.type="BloomOverrideMaterial",e}},{key:"_createOverrideIntanceMaterial",value:function(){var e=new h.RawShaderMaterial({vertexShader:se,fragmentShader:le,defines:{USE_INSTANCING:""}});return e.type="BloomOverrideMaterial",e}},{key:"setSize",value:function(e,t){var n=window.webglSettings.bloomRenderScale;this._renderTarget.setSize(e*n,t*n)}}]),n}(W.b),he=n(75),de=n(6),fe=(n(31),n(67),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(96),n(213)),me=n(210),pe=n.n(me),ge=n(25),ve=n(149);function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var ye=function(e){Object(f.a)(n,e);var t=_e(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.debug;this._time=0,this._speed=-12,this._debugger=t,this._renderer=this._createRenderer(),this._scene=this._createScene(),this._camera=this._createCamera(),this._texture=this._createTexture()}},{key:"destroy",value:function(){Object(de.a)(Object(v.a)(n.prototype),"destroy",this).call(this),this._renderer.dispose(),this._texture.material.dispose(),this._texture.geometry.dispose()}},{key:"texture",get:function(){return new h.Texture(this._renderer.domElement)}},{key:"_createRenderer",value:function(){var e=new h.WebGLRenderer({antialias:!1});return e.setClearColor("#ff0000",0),e.setSize(128,128),e}},{key:"_createScene",value:function(){return new h.Scene}},{key:"_createCamera",value:function(){return new h.OrthographicCamera(-1,1,1,-1,0,1)}},{key:"_createTexture",value:function(){var e=new h.PlaneGeometry(2,2),t=new h.RawShaderMaterial({vertexShader:"precision mediump float;\nprecision mediump int;\n#define GLSLIFY 1\n\nuniform mat4 modelViewMatrix; // optional\nuniform mat4 projectionMatrix; // optional\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"// uniform sampler2D tDiffuse;\nprecision mediump float;\n#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nuniform float uScale;\nuniform float uTime;\nuniform float uContrast;\nuniform float uMaskScale;\nuniform vec3 uColor;\nuniform bool uAbsolute;\n\n#define PI 3.141592653589793\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nfloat exponentialIn(float t) {\n  return t == 0.0 ? t : pow(2.0, 10.0 * (t - 1.0));\n}\n\nfloat sineInOut(float t) {\n    return -0.5 * (cos(PI * t) - 1.0);\n}\n\nvoid main(){\n    vec2 uv = vUv;\n    uv.x -= uTime;\n\n    vec2 smallNoiseUv = vUv;\n    smallNoiseUv.x -= uTime * 0.5;\n    float smallNoise = snoise(vec3((smallNoiseUv + 200.) * 10.0, 1.0)) * 0.5;\n\n    float noise = snoise(vec3(uv * uScale, 1.0));\n    // float noise = smallNoise;\n    if (uAbsolute) noise = abs(noise);\n\n    float radialMask = 1.0 - distance(vec2(0.5), vUv) * uMaskScale;\n    radialMask = clamp(radialMask, 0.0, 1.0);\n    radialMask = sineInOut(radialMask);\n\n    noise *= radialMask;\n\n    float progress = mod(uTime, 1.0);\n    float highlight = 1.0 - (smoothstep(progress, progress + 0.1, vUv.x) + smoothstep(progress, progress - 0.2, vUv.x));\n\n    vec3 color = noise + uColor * uContrast * radialMask;\n    // vec3 color = vec3(highlight);\n\n    color *= exponentialIn(vUv.x);\n\n    gl_FragColor = vec4(color, 1.);\n}\n",uniforms:{uColor:{value:new h.Color("#5acedd")},uScale:{value:7.67},uTime:{value:0},uAbsolute:{value:!1},uContrast:{value:7.03},uMaskScale:{value:1.17}}}),n=new h.Mesh(e,t);this._scene.add(n);var r={color:"#"+t.uniforms.uColor.value.getHexString()};if(this._debugger){var o=this._debugger.addGroup("Noise",{container:"Lines 2"});o.addCanvas({label:"canvas",canvas:this._renderer.domElement}),o.add(r,"color",{onChange:function(){t.uniforms.uColor.value=new h.Color(r.color)}}),o.add(t.uniforms.uScale,"value",{label:"scale"}),o.add(this,"_speed",{label:"speed",stepSize:.2}),o.add(t.uniforms.uContrast,"value",{label:"contrast"}),o.add(t.uniforms.uMaskScale,"value",{label:"mask scale"}),o.add(t.uniforms.uAbsolute,"value",{label:"absolute"})}return n}},{key:"update",value:function(){this._time+=.001*this._speed,this._texture.material.uniforms.uTime.value=this._time,this._renderer.render(this._scene,this._camera)}}]),n}(Object(c.a)(h.Object3D));n(233),n(199),n(181),n(70),n(118),n(113),n(170);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(e),t=1;t<arguments.length;t++){var source=arguments[t];if(null!=source)for(var n in source)Object.prototype.hasOwnProperty.call(source,n)&&(output[n]=source[n])}return output});var be,xe=function(e){console.error(e)},we={toRad:Math.PI/180,toDeg:180/Math.PI,pi90:.5*Math.PI,findAngle:function(e,t){var n,r,a=e.end.minus(t.end).lengthSq(),b=e.end.minus(e.start).lengthSq();return n=(r=(a+b-t.end.minus(e.start).lengthSq())/Math.sqrt(4*a*b))<=-1?Math.PI:r>=1?0:Math.acos(r),e.end.x*t.end.y-e.end.y*t.end.x>=0?n:-n},clamp:function(e,t,n){return e=(e=e<t?t:e)>n?n:e},lerp:function(e,t,n){return(1-n)*e+n*t},rand:function(e,t){return e+Math.random()*(t-e)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},nearEquals:function(a,b,e){return Math.abs(a-b)<=e},perpendicular:function(a,b){return!!we.nearEquals(a.dot(b),0,.01)},genPerpendicularVectorQuick:function(e){var p=e.clone();return Math.abs(e.y)<.99?p.set(-e.z,0,e.x).normalize():p.set(0,e.z,-e.y).normalize()},genPerpendicularVectorFrisvad:function(e){var t=e.clone();if(e.z<-.9999999)return t.set(0,-1,0);var a=1/(1+e.z);return t.set(1-e.x*e.x*a,-e.x*e.y*a,-e.x).normalize()},rotateXDegs:function(e,t){return e.clone().rotate(t*we.toRad,"X")},rotateYDegs:function(e,t){return e.clone().rotate(t*we.toRad,"Y")},rotateZDegs:function(e,t){return e.clone().rotate(t*we.toRad,"Z")},withinManhattanDistance:function(e,t,n){return!(Math.abs(t.x-e.x)>n)&&(!(Math.abs(t.y-e.y)>n)&&!(Math.abs(t.z-e.z)>n))},manhattanDistanceBetween:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.x-e.x)+Math.abs(t.x-e.x)},distanceBetween:function(e,t){var n=t.x-e.x,r=t.y-e.y,o=void 0!==e.z?t.z-e.z:0;return Math.sqrt(n*n+r*r+o*o)},rotateDegs:function(e,t){return e.clone().rotate(t*we.toRad)},validateDirectionUV:function(e){e.length()<0&&xe("vector direction unit vector cannot be zero.")},validateLength:function(e){e<0&&xe("Length must be a greater than or equal to zero.")}};function Se(e,t){this.x=e||0,this.y=t||0}function Ce(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function Oe(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("M3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Se.prototype,{isVector2:!0,set:function(e,t){return this.x=e||0,this.y=t||0,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return this.multiplyScalar(1/e)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return new Se(this.x,this.y).normalize()},lengthSq:function(){return this.x*this.x+this.y*this.y},add:function(e){return this.x+=e.x,this.y+=e.y,this},plus:function(e){return new Se(this.x+e.x,this.y+e.y)},min:function(e){return this.x-=e.x,this.y-=e.y,this},minus:function(e){return new Se(this.x-e.x,this.y-e.y)},divideBy:function(e){return new Se(this.x,this.y).divideScalar(e)},dot:function(a,b){return this.x*a.x+this.y*a.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},negated:function(){return new Se(-this.x,-this.y)},clone:function(){return new Se(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},cross:function(e){return this.x*e.y-this.y*e.x},sign:function(e){return this.cross(e)>=0?1:-1},approximatelyEquals:function(e,t){if(t<0)return!1;var n=Math.abs(this.x-e.x),r=Math.abs(this.y-e.y);return n<t&&r<t},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.x*t-this.y*n,o=this.x*n+this.y*t;return this.x=r,this.y=o,this},angleTo:function(e){var a=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return a<=-1?Math.PI:a>=1?0:Math.acos(a)},getSignedAngle:function(e){var a=this.angleTo(e);return 1===this.sign(e)?a:-a},constrainedUV:function(e,t,n){var r=e.getSignedAngle(this);return r>n&&this.copy(e).rotate(n),r<t&&this.copy(e).rotate(t),this}}),Object.assign(Ce.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e||0,this.y=t||0,this.z=n||0,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},abs:function(){return new Ce(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return new Ce(this.x,this.y,this.z).normalize()},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},min:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},plus:function(e){return new Ce(this.x+e.x,this.y+e.y,this.z+e.z)},minus:function(e){return new Ce(this.x-e.x,this.y-e.y,this.z-e.z)},divideBy:function(s){return new Ce(this.x/s,this.y/s,this.z/s)},multiply:function(s){return new Ce(this.x*s,this.y*s,this.z*s)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideScalar:function(e){return this.multiplyScalar(1/e)},cross:function(e){return new Ce(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},crossVectors:function(a,b){var e=a.x,t=a.y,n=a.z,r=b.x,o=b.y,l=b.z;return this.x=t*l-n*o,this.y=n*r-e*l,this.z=e*o-t*r,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},negated:function(){return new Ce(-this.x,-this.y,-this.z)},clone:function(){return new Ce(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},approximatelyEquals:function(e,t){if(t<0)return!1;var n=Math.abs(this.x-e.x),r=Math.abs(this.y-e.y),o=Math.abs(this.z-e.z);return n<t&&r<t&&o<t},zero:function(){return this.x=0,this.y=0,this.z=0,this},rotate:function(e,t){var n,r,o,l=Math.cos(e),c=Math.sin(e);switch(t){case"X":n=this.x,r=this.y*l-this.z*c,o=this.y*c+this.z*l;break;case"Y":n=this.z*c+this.x*l,r=this.y,o=this.z*l-this.x*c;break;case"Z":n=this.x*l-this.y*c,r=this.x*c+this.y*l,o=this.z}return this.x=n,this.y=r,this.z=o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:(be=new Ce,function(e){return be.copy(this).projectOnVector(e.normalised()),this.min(be).normalize()}),applyM3:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[1]*n+o[2]*r,this.y=o[3]*t+o[4]*n+o[5]*r,this.z=o[6]*t+o[7]*n+o[8]*r,this.normalize()},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*r,this.y=o[1]*t+o[4]*n+o[7]*r,this.z=o[2]*t+o[5]*n+o[8]*r,this},applyQuaternion:function(q){var e=this.x,t=this.y,n=this.z,r=q.x,o=q.y,l=q.z,c=q.w,h=c*e+o*n-l*t,d=c*t+l*e-r*n,f=c*n+r*t-o*e,m=-r*e-o*t-l*n;return this.x=h*c+m*-r+d*-l-f*-o,this.y=d*c+m*-o+f*-r-h*-l,this.z=f*c+m*-l+h*-o-d*-r,this},sign:function(e,t){return this.cross(e).dot(t)>=0?1:-1},angleTo:function(e){var a=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return a<=-1?Math.PI:a>=1?0:Math.acos(a)},getSignedAngle:function(e,t){var a=this.angleTo(e);return 1===this.sign(e,t)?a:-a},constrainedUV:function(e,t,n,r,o){var l=e.getSignedAngle(this,t);return l>o&&this.copy(n.rotateAboutAxis(e,o,t)),l<r&&this.copy(n.rotateAboutAxis(e,r,t)),this},limitAngle:function(base,e,t){if(base.angleTo(this)>t){var n=base.normalised().cross(this).normalize();this.copy(e.rotateAboutAxis(base,t,n))}return this}}),Object.assign(Oe.prototype,{isMatrix3:!0,set:function(e,t,n,r,o,l,c,h,d){var f=this.elements;return f[0]=e,f[1]=r,f[2]=c,f[3]=t,f[4]=o,f[5]=h,f[6]=n,f[7]=l,f[8]=d,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},setV3:function(e,t,n){var r=this.elements;return r[0]=e.x,r[3]=e.y,r[6]=e.z,r[1]=t.x,r[4]=t.y,r[7]=t.z,r[2]=n.x,r[5]=n.y,r[8]=n.z,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},createRotationMatrix:function(e){var t=e,n=new Ce(1,0,0),r=new Ce(0,1,0);if(e.z<-.9999999)n.set(1,0,0),r.set(0,1,0);else{var a=1/(1+t.z),b=-t.x*t.y*a;n.set(1-t.x*t.x*a,b,-t.x).normalize(),r.set(b,1-t.y*t.y*a,-t.y).normalize()}return this.setV3(n,r,t)},rotateAboutAxis:function(e,t,n){var r=Math.sin(t),o=Math.cos(t),l=1-o,c=n.x*n.y*l,h=n.x*n.z*l,d=n.y*n.z*l,f=this.elements;return f[0]=n.x*n.x*l+o,f[3]=c+n.z*r,f[6]=h-n.y*r,f[1]=c-n.z*r,f[4]=n.y*n.y*l+o,f[7]=d+n.x*r,f[2]=h+n.y*r,f[5]=d-n.x*r,f[8]=n.z*n.z*l+o,e.clone().applyM3(this)}});var Le=1/0,ke=Math.PI,Me=Math.PI/180,Te=(Math.PI,10),Pe=11,Re=12,De=21,Ae=(new Ce(1,0,0),new Ce(0,1,0),new Ce(0,0,1),new Ce(-1,0,0),new Ce(0,-1,0)),Ee=(new Ce(0,0,-1),new Se(0,1));new Se(0,-1),new Se(-1,0),new Se(1,0);function Ie(){this.rotor=ke,this.min=-ke,this.max=ke,this.freeHinge=!0,this.rotationAxisUV=new Ce,this.referenceAxisUV=new Ce,this.type=Te}function je(e,t,n,r,o){this.joint=new Ie,this.start=new Ce,this.end=new Ce,this.boneConnectionPoint=De,this.length=0,this.color=o||16777215,this.name="",this.init(e,t,n,r)}function Fe(e){this.tmpTarget=new Ce,this.tmpMtx=new Oe,this.bones=[],this.name="",this.color=e||16777215,this.solveDistanceThreshold=1,this.minIterationChange=.01,this.maxIteration=20,this.precision=.001,this.chainLength=0,this.numBones=0,this.baseLocation=new Ce,this.fixedBaseMode=!0,this.baseboneConstraintType=1,this.baseboneConstraintUV=new Ce,this.baseboneRelativeConstraintUV=new Ce,this.baseboneRelativeReferenceConstraintUV=new Ce,this.lastTargetLocation=new Ce(Le,Le,Le),this.lastBaseLocation=new Ce(Le,Le,Le),this.currentSolveDistance=Le,this.connectedChainNumber=-1,this.connectedBoneNumber=-1,this.boneConnectionPoint=De,this.isFullForward=!1,this.embeddedTarget=new Ce,this.useEmbeddedTarget=!1}function Be(e){this.fixedBaseMode=!0,this.chains=[],this.meshChains=[],this.targets=[],this.numChains=0,this.scene=e||null,this.tmpMtx=new Oe,this.isWithMesh=!1}function Ue(e,t,n){this.coordinateSystem=n||Pe,e<0&&(e*=-1),this.min=void 0!==e?-e*Me:-ke,this.max=void 0!==t?t*Me:ke}function Ne(e,t,n,r,o,l,c){this.start=new Se,this.end=new Se,this.length=r||0,this.joint=new Ue(o,l),this.globalConstraintUV=new Se(1,0),this.boneConnectionPoint=De,this.color=c||null,this.name="",this.setStartLocation(e),t?(this.setEndLocation(t),0===this.length&&(this.length=this.getLength())):n&&this.setEndLocation(this.start.plus(n.normalised().multiplyScalar(this.length)))}function ze(e){this.tmpTarget=new Se,this.bones=[],this.name="",this.solveDistanceThreshold=1,this.minIterationChange=.01,this.maxIteration=15,this.precision=.001,this.chainLength=0,this.numBones=0,this.baseLocation=new Se,this.fixedBaseMode=!0,this.baseboneConstraintType=1,this.baseboneConstraintUV=new Se,this.baseboneRelativeConstraintUV=new Se,this.lastTargetLocation=new Se(Le,Le),this.lastBaseLocation=new Se(Le,Le),this.boneConnectionPoint=De,this.currentSolveDistance=Le,this.connectedChainNumber=-1,this.connectedBoneNumber=-1,this.color=e||16777215,this.embeddedTarget=new Se,this.useEmbeddedTarget=!1}function Ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object.assign(Ie.prototype,{isJoint3D:!0,clone:function(){var e=new Ie;return e.type=this.type,e.rotor=this.rotor,e.max=this.max,e.min=this.min,e.freeHinge=this.freeHinge,e.rotationAxisUV.copy(this.rotationAxisUV),e.referenceAxisUV.copy(this.referenceAxisUV),e},testAngle:function(){this.max===ke&&this.min===-ke?this.freeHinge=!0:this.freeHinge=!1},validateAngle:function(a){return a=(a=a<0?0:a)>180?180:a},setAsBallJoint:function(e){this.rotor=this.validateAngle(e)*Me,this.type=Te},setHinge:function(e,t,n,r,o){this.type=e,n<0&&(n*=-1),this.min=-this.validateAngle(n)*Me,this.max=this.validateAngle(r)*Me,this.testAngle(),this.rotationAxisUV.copy(t).normalize(),this.referenceAxisUV.copy(o).normalize()},getHingeReferenceAxis:function(){return this.referenceAxisUV},getHingeRotationAxis:function(){return this.rotationAxisUV},setBallJointConstraintDegs:function(e){this.rotor=this.validateAngle(e)*Me},setHingeClockwise:function(e){e<0&&(e*=-1),this.min=-this.validateAngle(e)*Me,this.testAngle()},setHingeAnticlockwise:function(e){this.max=this.validateAngle(e)*Me,this.testAngle()}}),Object.assign(je.prototype,{isBone3D:!0,init:function(e,t,n,r){this.setStartLocation(e),t?(this.setEndLocation(t),this.length=this.getLength()):(this.setLength(r),this.setEndLocation(this.start.plus(n.normalised().multiplyScalar(r))))},clone:function(){var b=new je(this.start,this.end);return b.joint=this.joint.clone(),b},setColor:function(e){this.color=e},setBoneConnectionPoint:function(e){this.boneConnectionPoint=e},setHingeClockwise:function(e){this.joint.setHingeClockwise(e)},setHingeAnticlockwise:function(e){this.joint.setHingeAnticlockwise(e)},setBallJointConstraintDegs:function(e){this.joint.setBallJointConstraintDegs(e)},setStartLocation:function(e){this.start.copy(e)},setEndLocation:function(e){this.end.copy(e)},setLength:function(e){e>0&&(this.length=e)},setJoint:function(e){this.joint=e},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)}}),Object.assign(Fe.prototype,{isChain3D:!0,clone:function(){var e=new Fe;return e.solveDistanceThreshold=this.solveDistanceThreshold,e.minIterationChange=this.minIterationChange,e.maxIteration=this.maxIteration,e.precision=this.precision,e.bones=this.cloneBones(),e.baseLocation.copy(this.baseLocation),e.lastTargetLocation.copy(this.lastTargetLocation),e.lastBaseLocation.copy(this.lastBaseLocation),1!==this.baseboneConstraintType&&(e.baseboneConstraintUV.copy(this.baseboneConstraintUV),e.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV)),e.fixedBaseMode=this.fixedBaseMode,e.chainLength=this.chainLength,e.numBones=this.numBones,e.currentSolveDistance=this.currentSolveDistance,e.boneConnectionPoint=this.boneConnectionPoint,e.connectedChainNumber=this.connectedChainNumber,e.connectedBoneNumber=this.connectedBoneNumber,e.baseboneConstraintType=this.baseboneConstraintType,e.color=this.color,e.embeddedTarget=this.embeddedTarget.clone(),e.useEmbeddedTarget=this.useEmbeddedTarget,e},clear:function(){for(var i=this.numBones;i--;)this.removeBone(i);this.numBones=0},addBone:function(e){e.setColor(this.color),this.bones.push(e),this.numBones++,1===this.numBones&&(this.baseLocation.copy(e.start),this.baseboneConstraintUV.copy(e.getDirectionUV())),this.updateChainLength()},removeBone:function(e){e<this.numBones&&(this.bones.splice(e,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(e,t){this.numBones>0&&this.addBone(new je(this.bones[this.numBones-1].end,void 0,e.normalised(),t))},addConsecutiveFreelyRotatingHingedBone:function(e,t,n,r){this.addConsecutiveHingedBone(e,t,n,r,180,180,we.genPerpendicularVectorQuick(r))},addConsecutiveHingedBone:function(e,t,n,r,o,l,c){if(0!==this.numBones){var h=e.normalised(),d=r.normalised(),f=new je(this.bones[this.numBones-1].end,void 0,h,t,this.color);n=n||"global",f.joint.setHinge("global"===n?Re:Pe,d,o,l,c),this.addBone(f)}},addConsecutiveRotorConstrainedBone:function(e,t,n){if(0!==this.numBones){e=e.normalised();var r=new je(this.bones[this.numBones-1].end,void 0,e,t);r.joint.setAsBallJoint(n),this.addBone(r)}},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(1!==this.baseboneConstraintType)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].start},getEffectorLocation:function(){return this.bones[this.numBones-1].end},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var e=0,i=this.numBones;i--;)e+=this.bones[i].getLength();return e},getBaseboneRelativeReferenceConstraintUV:function(){return this.baseboneRelativeReferenceConstraintUV},setConnectedBoneNumber:function(e){this.connectedBoneNumber=e},setConnectedChainNumber:function(e){this.connectedChainNumber=e},setBoneConnectionPoint:function(e){this.boneConnectionPoint=e},setColor:function(e){this.color=e;for(var i=this.numBones;i--;)this.bones[i].setColor(this.color)},setBaseboneRelativeConstraintUV:function(e){this.baseboneRelativeConstraintUV=e.normalised()},setBaseboneRelativeReferenceConstraintUV:function(e){this.baseboneRelativeReferenceConstraintUV=e.normalised()},setBaseboneConstraintUV:function(e){this.baseboneConstraintUV=e.normalised()},setRotorBaseboneConstraint:function(e,t,n){0!==this.numBones?t.length()>0?(e=e||"global",this.baseboneConstraintType="global"===e?2:4,this.baseboneConstraintUV=t.normalised(),this.baseboneRelativeConstraintUV.copy(this.baseboneConstraintUV),this.bones[0].joint.setAsBallJoint(n)):xe("Constraint axis cannot be zero."):xe("Chain must contain a basebone before we can specify the basebone constraint type.")},setHingeBaseboneConstraint:function(e,t,n,r,o){0!==this.numBones?t.length()<=0?xe("Hinge rotation axis cannot be zero."):o.length()<=0?xe("Hinge reference axis cannot be zero."):we.perpendicular(t,o)?(e=e||"global",this.baseboneConstraintType="global"===e?3:5,this.baseboneConstraintUV=t.normalised(),this.bones[0].joint.setHinge("global"===e?Re:Pe,t,n,r,o)):xe("The hinge reference axis must be in the plane of the hinge rotation axis, that is, they must be perpendicular."):xe("Chain must contain a basebone before we can specify the basebone constraint type.")},setFreelyRotatingGlobalHingedBasebone:function(e){this.setHingeBaseboneConstraint("global",e,180,180,we.genPerpendicularVectorQuick(e))},setGlobalHingedBasebone:function(e,t,n,r){this.setHingeBaseboneConstraint("global",e,t,n,r)},setFreelyRotatingLocalHingedBasebone:function(e){this.setHingeBaseboneConstraint("local",e,180,180,we.genPerpendicularVectorQuick(e))},setLocalHingedBasebone:function(e,t,n,r){this.setHingeBaseboneConstraint("local",e,t,n,r)},setBaseLocation:function(e){this.baseLocation.copy(e)},setFixedBaseMode:function(e){(e||-1===this.connectedChainNumber)&&(2!==this.baseboneConstraintType||e)&&(this.fixedBaseMode=e)},setMaxIterationAttempts:function(e){e<1||(this.maxIteration=e)},setMinIterationChange:function(e){e<0||(this.minIterationChange=e)},setSolveDistanceThreshold:function(e){e<0||(this.solveDistanceThreshold=e)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new Ce(Le,Le,Le),this.currentSolveDistance=Le},solveForTarget:function(e){this.tmpTarget.set(e.x,e.y,e.z);var t,p=this.precision,n=this.lastBaseLocation.approximatelyEquals(this.baseLocation,p);if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,p)&&n)return this.currentSolveDistance;var r=null;n?(t=this.bones[this.numBones-1].end.distanceTo(this.tmpTarget),r=this.cloneBones()):t=Le;for(var o,l=[],c=Le,h=Le,i=this.maxIteration;i--;){if((o=this.solveIK(this.tmpTarget))<c){if(c=o,l=this.cloneBones(),o<=this.solveDistanceThreshold)break}else if(Math.abs(o-h)<this.minIterationChange)break;h=o}return c<t?(this.currentSolveDistance=c,this.bones=l):(this.currentSolveDistance=t,this.bones=r),this.lastBaseLocation.copy(this.baseLocation),this.lastTargetLocation.copy(this.tmpTarget),this.currentSolveDistance},solveIK:function(e){if(0!==this.numBones){for(var t,n,r,o,l=this.tmpMtx,i=this.numBones;i--;)if(n=(t=this.bones[i]).length,o=(r=t.joint).type,i!==this.numBones-1){var c=this.bones[i+1].getDirectionUV().negate(),h=t.getDirectionUV().negate();switch(o){case Te:h.limitAngle(c,l,r.rotor);break;case Re:_=r.getHingeRotationAxis(),h.projectOnPlane(_);break;case Pe:i>0?(l.createRotationMatrix(this.bones[i-1].getDirectionUV()),_=r.getHingeRotationAxis().clone().applyM3(l)):_=this.baseboneRelativeConstraintUV,h.projectOnPlane(_)}var d=t.end.plus(h.multiplyScalar(n));t.setStartLocation(d),i>0&&this.bones[i-1].setEndLocation(d)}else{t.setEndLocation(e);h=t.getDirectionUV().negated();switch(o){case Te:break;case Re:_=r.getHingeRotationAxis(),h.projectOnPlane(_);break;case Pe:l.createRotationMatrix(this.bones[i-1].getDirectionUV()),_=r.getHingeRotationAxis().clone().applyM3(l),h.projectOnPlane(_)}d=e.plus(h.multiplyScalar(n));t.setStartLocation(d),i>0&&this.bones[i-1].setEndLocation(d)}for(i=0;i<this.numBones;i++)if(n=(t=this.bones[i]).length,o=(r=t.joint).type,0!==i){var f=t.getDirectionUV(),m=this.bones[i-1].getDirectionUV();switch(o){case Te:f.limitAngle(m,l,r.rotor);break;case Re:_=r.getHingeRotationAxis(),y=r.getHingeReferenceAxis(),f.projectOnPlane(_),r.freeHinge||f.constrainedUV(y,_,l,r.min,r.max);break;case Pe:l.createRotationMatrix(m),_=r.getHingeRotationAxis().clone().applyM3(l),y=r.getHingeReferenceAxis().clone().applyM3(l),f.projectOnPlane(_),r.freeHinge||f.constrainedUV(y,_,l,r.min,r.max)}var v=t.start.plus(f.multiplyScalar(n));t.setEndLocation(v),i<this.numBones-1&&this.bones[i+1].setStartLocation(v)}else{this.fixedBaseMode?t.setStartLocation(this.baseLocation):t.setStartLocation(t.end.minus(t.getDirectionUV().multiplyScalar(n)));var _,y;f=t.getDirectionUV();switch(this.baseboneConstraintType){case 1:break;case 2:f.limitAngle(this.baseboneConstraintUV,l,r.rotor);break;case 4:f.limitAngle(this.baseboneRelativeConstraintUV,l,r.rotor);break;case 3:_=r.getHingeRotationAxis(),y=r.getHingeReferenceAxis(),f.projectOnPlane(_),r.freeHinge||f.constrainedUV(y,_,l,r.min,r.max);break;case 5:_=this.baseboneRelativeConstraintUV,y=this.baseboneRelativeReferenceConstraintUV,f.projectOnPlane(_),r.freeHinge||f.constrainedUV(y,_,l,r.min,r.max)}v=t.start.plus(f.multiplyScalar(n));t.setEndLocation(v),this.numBones>1&&this.bones[1].setStartLocation(v)}return this.lastTargetLocation.copy(e),this.bones[this.numBones-1].end.distanceTo(e)}},updateChainLength:function(){this.chainLength=0;for(var i=this.numBones;i--;)this.chainLength+=this.bones[i].length},cloneBones:function(){for(var e=[],i=0,t=this.bones.length;i<t;i++)e.push(this.bones[i].clone());return e}}),Object.assign(Be.prototype,{update:function(){for(var e,t,n,r,o,l,c,i=0;i<this.numChains;i++){if(e=this.chains[i],r=this.targets[i],-1!==(o=e.getConnectedChainNumber()))switch(l=this.chains[o].bones[e.getConnectedBoneNumber()],e.setBaseLocation(20===e.getBoneConnectionPoint()?l.start:l.end),c=e.getBaseboneConstraintType()){case 1:case 2:case 3:break;case 4:case 5:this.tmpMtx.createRotationMatrix(l.getDirectionUV());var h=e.getBaseboneConstraintUV().clone().applyM3(this.tmpMtx);e.setBaseboneRelativeConstraintUV(h),5===c&&e.setBaseboneRelativeReferenceConstraintUV(e.bones[0].joint.getHingeReferenceAxis().clone().applyM3(this.tmpMtx))}if(e.useEmbeddedTarget?e.solveForEmbeddedTarget():e.solveForTarget(r),this.isWithMesh){t=this.meshChains[i];for(var d=0;d<e.numBones;d++)n=e.bones[d],t[d].position.copy(n.start),t[d].lookAt(n.end)}}},clear:function(){var i;for(this.clearAllBoneMesh(),i=this.numChains;i--;)this.remove(i);this.chains=[],this.meshChains=[],this.targets=[]},add:function(e,t,n){this.chains.push(e),this.targets.push(t),this.numChains++,n&&this.addChainMeshs(e)},remove:function(e){this.chains[e].clear(),this.chains.splice(e,1),this.meshChains.splice(e,1),this.targets.splice(e,1),this.numChains--},setFixedBaseMode:function(e){this.fixedBaseMode=e;for(var i=this.numChains;i--;)-1===this.chains[i].getConnectedChainNumber()&&this.chains[i].setFixedBaseMode(this.fixedBaseMode)},getNumChains:function(){return this.numChains},getChain:function(e){return this.chains[e]},connectChain:function(e,t,n,r,o,l,c){var h=t,d=n;if(!(t>this.numChains||n>this.chains[t].numBones)){var f=e.clone();void 0!==c&&f.setColor(c),f.setBoneConnectionPoint("end"===r?De:20),f.setConnectedChainNumber(h),f.setConnectedBoneNumber(d);var m="end"===r?this.chains[h].bones[d].end:this.chains[h].bones[d].start;f.setBaseLocation(m),f.setFixedBaseMode(!0);for(var i=0;i<f.numBones;i++)f.bones[i].start.add(m),f.bones[i].end.add(m);this.add(f,o,l)}},addChainMeshs:function(e,t){this.isWithMesh=!0;for(var n=[],r=e.bones.length,i=0;i<r;i++)n.push(this.addBoneMesh(e.bones[i],i-1,n,e));this.meshChains.push(n)},addBoneMesh:function(e,t,n,r){var o=e.length,l=e.color,g=new h.CylinderBufferGeometry(1,.5,o,4);g.applyMatrix4((new h.Matrix4).makeRotationX(.5*-Math.PI)),g.applyMatrix4((new h.Matrix4).makeTranslation(0,0,.5*o));var c,d=new h.MeshStandardMaterial({color:l,wireframe:!1,shadowSide:!1}),f=new h.MeshBasicMaterial({wireframe:!0}),m=null,v=e.joint.type;switch(v){case Te:if(f.color.setHex(16737792),e.joint.rotor===Math.PI)break;var _=2;(c=new h.CylinderBufferGeometry(0,_,2,6,1,!0)).applyMatrix4((new h.Matrix4).makeRotationX(.5*-Math.PI)),c.applyMatrix4((new h.Matrix4).makeTranslation(0,0,1)),m=new h.Mesh(c,f);break;case Re:var y=e.joint.getHingeRotationAxis(),x=e.joint.min,w=e.joint.max;_=2;f.color.setHex(16776960),c=new h.CircleBufferGeometry(_,12,x,-x+w),1===y.z&&c.applyMatrix4((new h.Matrix4).makeRotationX(.5*-Math.PI)),1===y.y&&(c.applyMatrix4((new h.Matrix4).makeRotationY(.5*-Math.PI)),c.applyMatrix4((new h.Matrix4).makeRotationX(.5*-Math.PI))),1===y.x&&c.applyMatrix4((new h.Matrix4).makeRotationY(.5*Math.PI)),m=new h.Mesh(c,f);break;case Pe:y=e.joint.getHingeRotationAxis(),_=2,x=e.joint.min,w=e.joint.max;f.color.setHex(65535),(c=new h.CircleBufferGeometry(_,12,x,-x+w)).applyMatrix4((new h.Matrix4).makeRotationX(.5*-Math.PI)),1===y.z&&(c.applyMatrix4((new h.Matrix4).makeRotationY(.5*-Math.PI)),c.applyMatrix4((new h.Matrix4).makeRotationX(.5*Math.PI))),1===y.x&&c.applyMatrix4((new h.Matrix4).makeRotationZ(.5*-Math.PI)),1===y.y&&(c.applyMatrix4((new h.Matrix4).makeRotationX(.5*Math.PI)),c.applyMatrix4((new h.Matrix4).makeRotationY(.5*Math.PI))),m=new h.Mesh(c,f)}y=new h.AxesHelper(1.5);var b=new h.Mesh(g,d);return b.add(y),this.scene.add(b),b.castShadow=!0,b.receiveShadow=!0,-1!==t?null!==m&&(v!==Re?(m.position.z=r.bones[t].length,n[t].add(m)):b.add(m)):null!==m&&b.add(m),b},clearAllBoneMesh:function(){if(this.isWithMesh){var i,e,b;for(i=this.meshChains.length;i--;){for(e=this.meshChains[i].length;e--;)b=this.meshChains[i][e],this.scene.remove(b),b.geometry.dispose(),b.material.dispose();this.meshChains[i]=[]}this.meshChains=[]}}}),Object.assign(Ue.prototype,{isJoint2D:!0,clone:function(){var e=new Ue;return e.coordinateSystem=this.coordinateSystem,e.max=this.max,e.min=this.min,e},validateAngle:function(a){return a=(a=a<0?0:a)>180?180:a},set:function(e){this.max=e.max,this.min=e.min,this.coordinateSystem=e.coordinateSystem},setClockwiseConstraintDegs:function(e){e<0&&(e*=-1),this.min=-this.validateAngle(e)*Me},setAnticlockwiseConstraintDegs:function(e){this.max=this.validateAngle(e)*Me},setConstraintCoordinateSystem:function(e){this.coordinateSystem=e},getConstraintCoordinateSystem:function(){return this.coordinateSystem}}),Object.assign(Ne.prototype,{isBone2D:!0,clone:function(){var b=new Ne(this.start,this.end);return b.length=this.length,b.globalConstraintUV=this.globalConstraintUV,b.boneConnectionPoint=this.boneConnectionPoint,b.joint=this.joint.clone(),b.color=this.color,b.name=this.name,b},setName:function(e){this.name=e},setColor:function(e){this.color=e},setBoneConnectionPoint:function(e){this.boneConnectionPoint=e},setStartLocation:function(e){this.start.copy(e)},setEndLocation:function(e){this.end.copy(e)},setLength:function(e){e>0&&(this.length=e)},setGlobalConstraintUV:function(e){this.globalConstraintUV=e},setJoint:function(e){this.joint=e},setClockwiseConstraintDegs:function(e){this.joint.setClockwiseConstraintDegs(e)},setAnticlockwiseConstraintDegs:function(e){this.joint.setAnticlockwiseConstraintDegs(e)},setJointConstraintCoordinateSystem:function(e){this.joint.setConstraintCoordinateSystem(e)},getGlobalConstraintUV:function(){return this.globalConstraintUV},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)}}),Object.assign(ze.prototype,{isChain2D:!0,clone:function(){var e=new ze;return e.solveDistanceThreshold=this.solveDistanceThreshold,e.minIterationChange=this.minIterationChange,e.maxIteration=this.maxIteration,e.precision=this.precision,e.bones=this.cloneBones(),e.baseLocation.copy(this.baseLocation),e.lastTargetLocation.copy(this.lastTargetLocation),e.lastBaseLocation.copy(this.lastBaseLocation),1!==this.baseboneConstraintType&&(e.baseboneConstraintUV.copy(this.baseboneConstraintUV),e.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV)),e.fixedBaseMode=this.fixedBaseMode,e.chainLength=this.chainLength,e.numBones=this.numBones,e.currentSolveDistance=this.currentSolveDistance,e.boneConnectionPoint=this.boneConnectionPoint,e.connectedChainNumber=this.connectedChainNumber,e.connectedBoneNumber=this.connectedBoneNumber,e.baseboneConstraintType=this.baseboneConstraintType,e.color=this.color,e.embeddedTarget=this.embeddedTarget.clone(),e.useEmbeddedTarget=this.useEmbeddedTarget,e},clear:function(){for(var i=this.numBones;i--;)this.removeBone(i)},addBone:function(e){null===e.color&&e.setColor(this.color),this.bones.push(e),0===this.numBones&&(this.baseLocation.copy(e.start),this.baseboneConstraintUV.copy(e.getDirectionUV())),this.numBones++,this.updateChainLength()},removeBone:function(e){e<this.numBones&&(this.bones.splice(e,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(e,t,n,r,o){if(0!==this.numBones){if(e.isBone2D){var l=e,c=l.getDirectionUV();we.validateDirectionUV(c);var h=l.length;we.validateLength(h);var d=this.bones[this.numBones-1].end;l.setStartLocation(d),l.setEndLocation(d.plus(c.multiplyScalar(h))),this.addBone(l)}else if(e.isVector2){o=o||this.color,we.validateDirectionUV(e),we.validateLength(t);d=this.bones[this.numBones-1].end;this.addBone(new Ne(d,null,e.normalised(),t,n,r,o))}}else xe("Chain is empty ! need first bone")},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getEmbeddedTarget:function(){return this.embeddedTarget},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(1!==this.baseboneConstraintType)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].start},getEffectorLocation:function(){return this.bones[this.numBones-1].end},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var e=0,i=this.numBones;i--;)e+=this.bones[i].getLength();return e},setColor:function(e){this.color=e;for(var i=this.numBones;i--;)this.bones[i].setColor(this.color)},setBaseboneRelativeConstraintUV:function(e){this.baseboneRelativeConstraintUV=e},setConnectedBoneNumber:function(e){this.connectedBoneNumber=e},setConnectedChainNumber:function(e){this.connectedChainNumber=e},setBoneConnectionPoint:function(e){this.boneConnectionPoint=e},setBaseboneConstraintUV:function(e){we.validateDirectionUV(e),this.baseboneConstraintUV.copy(e.normalised())},setBaseLocation:function(e){this.baseLocation.copy(e)},setBaseboneConstraintType:function(e){this.baseboneConstraintType=e},setFixedBaseMode:function(e){(e||-1===this.connectedChainNumber)&&(6!==this.baseboneConstraintType||e)&&(this.fixedBaseMode=e)},setMaxIterationAttempts:function(e){e<1||(this.maxIteration=e)},setMinIterationChange:function(e){e<0||(this.minIterationChange=e)},setSolveDistanceThreshold:function(e){e<0||(this.solveDistanceThreshold=e)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new Se(Le,Le),this.currentSolveDistance=Le},solveForTarget:function(e){this.tmpTarget.set(e.x,e.y);var t,p=this.precision,n=this.lastBaseLocation.approximatelyEquals(this.baseLocation,p);if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,p)&&n)return this.currentSolveDistance;var r=null;n?(t=this.bones[this.numBones-1].end.distanceTo(this.tmpTarget),r=this.cloneBones()):t=Le;for(var o,l=[],c=Le,h=Le,i=this.maxIteration;i--;){if((o=this.solveIK(this.tmpTarget))<c){if(c=o,l=this.cloneBones(),o<=this.solveDistanceThreshold)break}else if(Math.abs(o-h)<this.minIterationChange)break;h=o}return c<t?(this.currentSolveDistance=c,this.bones=l):(this.currentSolveDistance=t,this.bones=r),this.lastBaseLocation.copy(this.baseLocation),this.lastTargetLocation.copy(this.tmpTarget),this.currentSolveDistance},solveIK:function(e){if(0!==this.numBones){for(var t,n,r,o,l,c,h,i=this.numBones;i--;)n=(t=this.bones[i]).length,i!==this.numBones-1?(r=this.bones[i+1],c=t.getDirectionUV().negate(),h=t.joint.coordinateSystem===Pe?r.getDirectionUV().negate():t.getGlobalConstraintUV().negated(),c.constrainedUV(h,r.joint.min,r.joint.max),o=t.end.plus(c.multiplyScalar(n)),t.setStartLocation(o),i>0&&this.bones[i-1].setEndLocation(o)):(t.setEndLocation(e),c=t.getDirectionUV().negate(),i>0?(h=t.joint.coordinateSystem===Pe?this.bones[i-1].getDirectionUV().negate():t.getGlobalConstraintUV().negated(),c.constrainedUV(h,t.joint.min,t.joint.max)):t.joint.coordinateSystem!==Pe&&(h=t.getGlobalConstraintUV().negated(),c.constrainedUV(h,t.joint.min,t.joint.max)),o=t.end.plus(c.multiplyScalar(n)),t.setStartLocation(o),i>0&&this.bones[i-1].setEndLocation(o));for(i=0;i<this.numBones;i++)n=(t=this.bones[i]).length,0!==i?(c=t.getDirectionUV(),h=t.joint.coordinateSystem===Pe?this.bones[i-1].getDirectionUV():t.getGlobalConstraintUV(),c.constrainedUV(h,t.joint.min,t.joint.max),l=t.start.plus(c.multiplyScalar(n)),t.setEndLocation(l),i<this.numBones-1&&this.bones[i+1].setStartLocation(l)):(this.fixedBaseMode?t.setStartLocation(this.baseLocation):(o=t.end.minus(t.getDirectionUV().multiplyScalar(n)),t.setStartLocation(o)),c=t.getDirectionUV(),1===this.baseboneConstraintType?(l=t.start.plus(c.multiplyScalar(n)),t.setEndLocation(l),this.numBones>1&&this.bones[1].setStartLocation(l)):(h=8===this.baseboneConstraintType?this.baseboneRelativeConstraintUV:this.baseboneConstraintUV,c.constrainedUV(h,t.joint.min,t.joint.max),l=t.start.plus(c.multiplyScalar(n)),t.setEndLocation(l),i<this.numBones-1&&this.bones[i+1].setStartLocation(l)));return this.lastTargetLocation.copy(e),this.bones[this.numBones-1].end.distanceTo(e)}},updateChainLength:function(){this.chainLength=0;for(var i=this.numBones;i--;)this.chainLength+=this.bones[i].length},cloneBones:function(){for(var e=[],i=0,t=this.bones.length;i<t;i++)e.push(this.bones[i].clone());return e}}),Object.assign(function(e){this.fixedBaseMode=!0,this.chains=[],this.meshChains=[],this.targets=[],this.numChains=0,this.scene=e||null,this.isWithMesh=!1}.prototype,{isStructure2D:!0,update:function(){for(var e,t,n,r,o,l,c=new h.Vector3,i=0;i<this.numChains;i++){if(e=this.chains[i],r=this.targets[i]||null,o=e.getConnectedChainNumber(),l=e.getBaseboneConstraintType(),-1!==o&&6!==l){var d=this.chains[o].bones[e.getConnectedBoneNumber()];e.setBaseLocation(20===e.getBoneConnectionPoint()?d.start:d.end);var f=d.getDirectionUV();if(7===l)e.setBaseboneConstraintUV(f);else if(8===l){var m=Ee.getSignedAngle(f),v=e.getBaseboneConstraintUV().clone().rotate(m);e.setBaseboneRelativeConstraintUV(v)}}if(e.useEmbeddedTarget?console.log("embed",e.solveForEmbeddedTarget()):e.solveForTarget(r),this.isWithMesh){t=this.meshChains[i];for(var _=0;_<e.numBones;_++)n=e.bones[_],t[_].position.set(n.start.x,n.start.y,0),t[_].lookAt(c.set(n.end.x,n.end.y,0))}}},setFixedBaseMode:function(e){this.fixedBaseMode=e;for(var i=this.numChains;i--;)-1===this.chains[i].getConnectedChainNumber()&&this.chains[i].setFixedBaseMode(this.fixedBaseMode)},clear:function(){var i;for(this.clearAllBoneMesh(),i=this.numChains;i--;)this.remove(i);this.chains=[],this.meshChains=[],this.targets=[]},add:function(e,t,n){this.chains.push(e),this.numChains++,t&&this.targets.push(t),n&&this.addChainMeshs(e)},remove:function(e){this.chains[e].clear(),this.chains.splice(e,1),this.meshChains.splice(e,1),this.targets.splice(e,1),this.numChains--},getNumChains:function(){return this.numChains},getChain:function(e){return this.chains[e]},connectChain:function(e,t,n,r,o,l,c){var h=t,d=n;if(r=r||"end",h>this.numChains)xe("Chain not existe !");else if(d>this.chains[h].numBones)xe("Bone not existe !");else{var f=e.clone();f.setBoneConnectionPoint("end"===r?De:20),f.setConnectedChainNumber(h),f.setConnectedBoneNumber(d);var m="end"===r?this.chains[h].bones[d].end:this.chains[h].bones[d].start;f.setBaseLocation(m),f.setFixedBaseMode(!0);for(var i=0;i<f.numBones;i++)f.bones[i].start.add(m),f.bones[i].end.add(m);this.add(f,o,l)}},addChainMeshs:function(e,t){this.isWithMesh=!0;for(var n=[],r=e.bones.length,i=0;i<r;i++)n.push(this.addBoneMesh(e.bones[i]));this.meshChains.push(n)},addBoneMesh:function(e){var t=e.length,n=e.color,g=new h.CylinderBufferGeometry(1,.5,t,4);g.applyMatrix4((new h.Matrix4).makeRotationX(-we.pi90)),g.applyMatrix4((new h.Matrix4).makeTranslation(0,0,.5*t));var r=new h.MeshStandardMaterial({color:n,wireframe:!1,shadowSide:!1}),b=(new h.MeshBasicMaterial({wireframe:!0}),new h.Mesh(g,r));return b.castShadow=!0,b.receiveShadow=!0,this.scene.add(b),b},clearAllBoneMesh:function(){if(this.isWithMesh){var i,e,b;for(i=this.meshChains.length;i--;){for(e=this.meshChains[i].length;e--;)b=this.meshChains[i][e],this.scene.remove(b),b.geometry.dispose(),b.material.dispose();this.meshChains[i]=[]}this.meshChains=[]}}}),Object.assign(function(e){this.startBones=null,this.endBones=null,this.target=null,this.goal=null,this.swivelAngle=0,this.iteration=40,this.thresholds={position:.1,rotation:.1},this.solver=null,this.chain=null}.prototype,{isIKSolver:!0}),Object.assign(function(e){this.startBones=null,this.endBones=null,this.scene=e.scene,this.target=null,this.goal=null,this.swivelAngle=0,this.iteration=15,this.thresholds={position:.1,rotation:.1},this.solver=new FIK.Structure2D(this.scene),this.bones=[],this.numBones=0,this.rotation=[],this.initStructure(e)}.prototype,{isHISolver:!0,initStructure:function(e){this.startBones=e.start,this.endBones=e.end,this.angles=e.angles;var t=this.startBones,n=t.children[0];this.bones.push(t);for(var i=0;i<100;i++){if(this.bones.push(n),n===this.endBones){this.createChain();break}n=(t=n).children[0]}},createChain:function(){this.numBones=this.bones.length;var e=new ze;e.setFixedBaseMode(!0),e.setBaseboneConstraintType(FIK.LOCAL_ABSOLUTE),this.fakeBone=new Ne(new Se(0,-1),new Se(0,0)),this.target=new h.Vector3;for(var base=new h.Vector3,t=new h.Vector3,n=new h.Vector3,r=new Se,o=0,i=0;i<this.numBones;i++)i>0&&(this.target.add(this.bones[i].position),o=base.distanceTo(this.bones[i].position),this.bones[i-1].getWorldPosition(t),this.bones[i].getWorldPosition(n),n.sub(t).normalize(),0===n.z?r.set(n.x,n.y):0===n.x&&r.set(n.z,n.y),1===i?e.addBone(new Ne(new Se(0,0),null,r,o,this.angles[i-1][0],this.angles[i-1][1])):e.addConsecutiveBone(r,o,this.angles[i-1][0],this.angles[i-1][1]));this.target.set(10,20,0),this.solver.add(e,this.target,!0)},update:function(){this.solver.update();for(var a,e=this.solver.chains[0].bones,t=this.numBones-1,i=0;i<t;i++)a=0===i?we.findAngle(this.fakeBone,e[i]):we.findAngle(e[i-1],e[i]),this.rotation[i]=a*we.toDeg,this.rotation[i]+=a<0?180:-180,this.rotation[i]*=-1;for(i=0;i<t;i++)this.bones[i].rotation.z=this.rotation[i]*we.toRad;console.log(this.rotation)}});var He=function(e){Object(f.a)(n,e);var t=Ge(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._time=e.timeOffset,this._speed=e.speed,this._xSineSize=e.xSize,this._ySineSize=e.ySize,this._lineWidth=e.lineWidth,this._texture=e.texture,this._targetScreenOffset=e.targetScreenOffset,this._camera=e.camera,this._depth=e.depth,this._bonesAmount=e.bonesAmount,this._mouseScale=e.mouseScale,this._noise=e.noise,this._zOffset=0,this._zOffsetAnimationCompleted=!0,this._target=new h.Object3D,this._targetContainer=new h.Object3D,this._targetContainer.add(this._target),this._targetWorldPosition=new h.Vector3,this._mousePositionLerp=.02+.08*Math.random(),this._mousePosition=new h.Vector2,this._mouseOffset=new h.Vector2,this._mouseTargetPosition=new h.Vector3,this._solver=new Be(this),this._chain=this._createChain()}},{key:"bones",get:function(){return this._chain?this._chain.bones:[]}},{key:"positions",get:function(){return this._mesh?this._mesh.geometry.positions:[]}},{key:"depth",get:function(){return this._depth},set:function(e){this._depth=e}},{key:"updateMousePosition",value:function(e){this._mousePosition.copy(e).multiply(this._mouseScale),this._mouseOffset.lerp(this._mousePosition,this._mousePositionLerp)}},{key:"updateMouseScale",value:function(e){this._mouseScale.copy(e)}},{key:"updateMouseTargetPosition",value:function(e){this._mouseTargetPosition.copy(e)}},{key:"spin",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this._isSpinning=!0,null===(e=this._timelineSpin)||void 0===e||e.kill(),this._timelineSpin=new l.a.timeline({onComplete:function(){t._isSpinning=!1}}),this._timelineSpin.to(this._target.position,o,{x:r*n,repeat:1,yoyo:!0,ease:"sine.inOut"},0),this._timelineSpin.fromTo(this._targetContainer.rotation,2*o,{z:0},{z:2*Math.PI*n,ease:"sine.inOut"},0)}},{key:"toggleMouseLock",value:function(){this._targetContainer.position.lerp(this._mouseTargetPosition,.1)}},{key:"goto",value:function(e){this._isGoto=!0,this._gotoPosition=e,this._timelineSpin&&this._timelineSpin.kill(),l.a.to(this._targetContainer.position,5,{x:e.x,y:e.y,z:e.z,ease:"power2.inOut"}),l.a.to(this._target.position,1.5,{x:20,ease:"power1.inOut"},0),l.a.to(this._targetContainer.rotation,6,{z:5*Math.PI,ease:"power1.inOut"},0)}},{key:"reset",value:function(){}},{key:"_createTargetHelper",value:function(){var e=new h.SphereBufferGeometry(1,16,16),t=new h.MeshBasicMaterial({color:16711680,wireframe:!0}),n=new h.Mesh(e,t);return this.add(n),n}},{key:"_createChain",value:function(){var e=Ae,t=new Fe(16776960),n=new Ce(-70,-40,100),r=n.plus(e.multiply(8)),o=new je(n,r);t.addBone(o);for(var l=0;l<this._bonesAmount;l++)t.addConsecutiveBone(e,8);return this._target.getWorldPosition(this._targetWorldPosition),this._solver.add(t,this._targetWorldPosition,!1),this._solver.setFixedBaseMode(!1),t}},{key:"update",value:function(e){var t=e.delta,time=e.time;this._time+=t*this._speed,this._setZOffset(),this._isGoto||this._updateTarget(time),this._solver.update()}},{key:"_setZOffset",value:function(){var e=this;if(this._zOffsetAnimationCompleted){this._zOffsetAnimationCompleted=!1;var t=1+2*Math.random();l.a.delayedCall(t,(function(){var t=Math.random()>.5?ge.a.randomArbitrary(-20,-50):ge.a.randomArbitrary(20,50);l.a.to(e,3,{_zOffset:t,ease:"power1.inOut",onComplete:function(){e._zOffsetAnimationCompleted=!0}})}))}}},{key:"_updateTarget",value:function(time){this._targetContainer.position.x=this._targetScreenOffset.x+Math.sin(this._time)*this._xSineSize+this._mouseOffset.x+15*this._noise.noise2D(.1*time,.1*time),this._targetContainer.position.y=this._targetScreenOffset.y+Math.cos(this._time)*this._ySineSize+this._mouseOffset.y+5*this._noise.noise2D(1337+.05*time,7331+.05*time),this._targetContainer.position.z=he.a.positionZ+this._depth+this._zOffset,this._target.getWorldPosition(this._targetWorldPosition)}},{key:"_updateGotoTarget",value:function(){this._targetWorldPosition.lerp(this._gotoPosition,.01)}},{key:"_updateTargetHelper",value:function(){this._targetHelper&&this._targetHelper.position.copy(this._targetWorldPosition)}}]),n}(Object(c.a)(h.Object3D)),Ve=n(135);function We(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var $e=40,qe=function(e){Object(f.a)(n,e);var t=We(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._renderer=e.renderer,this._debugContainer=e.debugContainer,this._settings={speed:1.44,xSize:1.69,ySize:3.18,lineWidth:.56,targetScreenOffset:D.a.active("small")?new h.Vector3(-20,-25,0):new h.Vector3(-45,-25,0),targetCenterScreenOffset:D.a.active("small")?new h.Vector3(-10,10,0):new h.Vector3(0,-25,0),depth:-156,mouseScale:new h.Vector3(30,30,30),mouseCenterScale:new h.Vector3(70,15,30),touchSensibility:3},this._currentLineIndex=-1,this._targetCenterProgress=0,this._color=new h.Color(16711680),this._mouseScale=new h.Vector3,this._mouseTargetZ=this._settings.depth,this._mousePosition=new h.Vector2,this._dragStartPosition=new h.Vector2,this._dragCurrentPosition=new h.Vector2,this._dragPosition=new h.Vector2,this._mouseTargetOffset=new h.Vector3,this._mouseTargetPosition=new h.Vector3,this._simplex=new pe.a("pizza"),this._debugger=this._createDebugger(),this._dataTexture=this._createDataTexture(),this._lines=this._createLines(),this._mesh=this._createMesh(),this._bindHandlers(),this._setupEventListeners()}},{key:"destroy",value:function(){Object(de.a)(Object(v.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._destroyLines()}},{key:"camera",get:function(){return this._camera},set:function(e){this._camera=e}},{key:"targetCenterProgress",get:function(){return this._targetCenterProgress},set:function(e){this._targetCenterProgress=e}},{key:"opacity",get:function(){return this._mesh.material.uniforms.opacity.value},set:function(e){this._mesh.material.uniforms.opacity.value=e}},{key:"show",value:function(){for(var e,t=new l.a.timeline,i=0,n=this._lines.length;i<n;i++)e=this._lines[i],t.fromTo(e,{depth:0},{duration:6,depth:this._settings.depth,ease:"sine.inOut"},.2*i);return t}},{key:"hide",value:function(){return l.a.to(this._mesh.material.uniforms.opacity,{duration:2,value:0,ease:"sine.inOut"})}},{key:"reset",value:function(){this._resetLines()}},{key:"changeColor",value:function(e){return l.a.to(this._mesh.material.color,{duration:1,r:e.r,g:e.g,b:e.b})}},{key:"spin",value:function(){this._spin()}},{key:"_bindHandlers",value:function(){this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseClickHandler=this._mouseClickHandler.bind(this),this._dragstartHandler=this._dragstartHandler.bind(this),this._dragHandler=this._dragHandler.bind(this),this._dragendHandler=this._dragendHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._dragManager=new ve.a({el:window,handleScroll:!1}),this._dragManager.addEventListener("dragstart",this._dragstartHandler),this._dragManager.addEventListener("drag",this._dragHandler),this._dragManager.addEventListener("dragend",this._dragendHandler),window.addEventListener("mousemove",this._mouseMoveHandler)}},{key:"_removeEventListeners",value:function(){window.removeEventListener("mousemove",this._mouseMoveHandler)}},{key:"_createLineTexture",value:function(){return new ye({debug:this._debugger})}},{key:"_createDataTexture",value:function(){var data=new Float32Array(882);return new h.DataTexture(data,42,7,h.RGBFormat,h.FloatType)}},{key:"_createLight",value:function(){var e=new h.PointLight;e.color.set(4255209),e.intensity=.46,e.distance=579,e.decay=3.53,this.add(e);var t=new h.PointLightHelper(e);if(t.visible=!1,this.add(t),e.userData.helper=t,this._debugger){var n=this._debugger.addGroup("Light");n.add(e,"visible"),n.add(e,"color"),n.add(e,"intensity"),n.add(e,"distance",{stepSize:1}),n.add(e,"decay")}return e}},{key:"_createLines",value:function(){var e=[];Ve.a.splice(0,Ve.a.length);for(var i=0;i<7;i++){var line=new He({timeOffset:2*Math.PI*Math.random(),speed:this._settings.speed,xSize:this._settings.xSize,ySize:this._settings.ySize,lineWidth:this._settings.lineWidth,targetScreenOffset:this._settings.targetScreenOffset.clone(),camera:this._camera,depth:this._settings.depth,bonesAmount:$e,color:this._color,mouseScale:this._settings.mouseScale.clone(),noise:this._simplex});this.add(line),e.push(line),Ve.a.push({bones:line.bones})}return e}},{key:"_destroyLines",value:function(){for(var i=0,e=this._lines.length;i<e;i++)this._lines[i].destroy()}},{key:"_resetLines",value:function(){for(var i=0,e=this._lines.length;i<e;i++)this._lines[i].reset()}},{key:"_createMesh",value:function(){var e=[new h.Vector3(148.61709439424038,227.00431800951662,-262.5109054525783),new h.Vector3(7.534857325096061,62.20516987234612,-578.6234113228197),new h.Vector3(-549.9626226698965,102.13970468885003,-379.41796272290793),new h.Vector3(-953.932670801701,22.79168035538504,-50.1584349958074),new h.Vector3(-473.3980540343701,243.03455711665086,102.00072889217877),new h.Vector3(-206.55505759408044,391.1494828860616,126.35054694628087),new h.Vector3(-117.92421845501099,188.8534279252881,536.5415545114024),new h.Vector3(275.0562511850492,133.20062464265033,754.528219466433),new h.Vector3(850.2820392682308,55.76062624557312,-1.7698422605295718),new h.Vector3(816.0053028927443,54.40283086973942,-489.52092768661845)],t=new h.CatmullRomCurve3(e).getPoints(39),line=new fe.MeshLine;line.setPoints(t);for(var n,r,o=new Float32Array(160),l=new Float32Array(160),c=new Float32Array(160),i=0;i<160;i+=4)n=i/$e/4,r=0,o[i+0]=n,o[i+1]=r,o[i+2]=n,o[i+3]=r,i<156&&(n=(i-4)/$e/4,r=0,l[i+0]=n,l[i+1]=r,l[i+2]=n,l[i+3]=r),i>0&&(n=(i+4)/$e/4,r=0,c[i+0]=n,c[i+1]=r,c[i+2]=n,c[i+3]=r);for(var d=new Float32Array(7),f=0;f<7;f++)d[f]=f;line.setAttribute("positionUv",new h.BufferAttribute(o,2)),line.setAttribute("previousUv",new h.BufferAttribute(l,2)),line.setAttribute("nextUv",new h.BufferAttribute(c,2)),line.setAttribute("lineId",new h.InstancedBufferAttribute(d,1));var m=new fe.MeshLineMaterial({color:new h.Color(16753487),resolution:new h.Vector2(window.innerWidth,window.innerHeight),lineWidth:this._settings.lineWidth,transparent:!0,blending:h.AdditiveBlending,depthTest:!1,depthWrite:!1,wireframe:!1,positionMap:this._dataTexture,amount:7}),v=new h.InstancedMesh(line,m,7);return this.add(v),v}},{key:"_createMouseTargetDebugMesh",value:function(){var e=new h.SphereBufferGeometry(2,16,16),t=new h.MeshBasicMaterial({color:255,wireframe:!0}),n=new h.Mesh(e,t);return n.visible=!1,this.add(n),n}},{key:"_spin",value:function(){for(var e=this,t=new l.a.timeline,n=Math.random()>.5?1:-1,r=30+30*Math.random(),o=1.2+.1*Math.random(),c=function(i,l){t.call((function(){return e._lines[i].spin(n,r,o)}),null,.07*i)},i=0,h=this._lines.length;i<h;i++)c(i)}},{key:"_toggleMouseLock",value:function(){for(var e=Math.random()>.5?1:-1,i=0,t=this._lines.length;i<t;i++)this._lines[i].toggleMouseLock(e)}},{key:"_jumpToLandmark",value:function(){var e=new h.BoxBufferGeometry(20,20,20),t=new h.MeshBasicMaterial({color:16711935}),n=new h.Mesh(e,t);n.position.x=this._mouseTargetPosition.x+500*(2*Math.random()-1),n.position.y=-50,n.position.z=this._mouseTargetPosition.z-1e3,this.add(n),this._currentLineIndex++,this._lines[this._currentLineIndex].goto(n.position)}},{key:"onUpdate",value:function(e){var time=e.time,t=e.delta;this.visible&&(this._updateLinesPosition(),this._updateLines({time:time,delta:t}),this._updateDataTexture(),this._updateTargetScreenOffset())}},{key:"_updateLinesPosition",value:function(){var e,t=!1;this._targetCenterProgress>0&&this._targetCenterProgress<1&&(this._mouseScale.lerpVectors(this._settings.mouseScale,this._settings.mouseCenterScale,this._targetCenterProgress),t=!0);for(var i=0,n=this._lines.length;i<n;i++)(e=this._lines[i]).updateMousePosition(this._mousePosition),t&&e.updateMouseScale(this._mouseScale),Ve.a[i].bones=e.bones}},{key:"_updateLightPosition",value:function(){this._light.position.z=he.a.positionZ-400,this._light.position.x=-30}},{key:"_updateLines",value:function(e){for(var time=e.time,t=e.delta,i=0,n=this._lines.length;i<n;i++)this._lines[i].update({time:time,delta:t})}},{key:"_updateDataTexture",value:function(){for(var e,t,n,r,i=0,o=this._lines.length;i<o;i++){n=42*i*3,r=0;for(var l=0,c=(e=this._lines[i].bones).length;l<c;l++)t=e[l],0===l?(this._dataTexture.image.data[n+0+r]=t.start.x,this._dataTexture.image.data[n+1+r]=t.start.y,this._dataTexture.image.data[n+2+r]=t.start.z,this._dataTexture.image.data[n+3+r]=t.end.x,this._dataTexture.image.data[n+4+r]=t.end.y,this._dataTexture.image.data[n+5+r]=t.end.z,r+=6):(this._dataTexture.image.data[n+0+r]=t.end.x,this._dataTexture.image.data[n+1+r]=t.end.y,this._dataTexture.image.data[n+2+r]=t.end.z,r+=3)}this._dataTexture.needsUpdate=!0}},{key:"_updateTargetScreenOffset",value:function(){for(var i=0,e=this._lines.length;i<e;i++)this._lines[i]._targetScreenOffset.lerpVectors(this._settings.targetScreenOffset,this._settings.targetCenterScreenOffset,this._targetCenterProgress)}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this._width=t,this._height=n,this._mesh.material.resolution.x=t,this._mesh.material.resolution.y=n}},{key:"_mouseMoveHandler",value:function(e){S.a.isTouch()||(this._mousePosition.x=e.clientX/this._width*2-1,this._mousePosition.y=1-e.clientY/this._height*2)}},{key:"_dragstartHandler",value:function(e){var t;S.a.isTouch()&&(this._dragStartPosition.x=e.position.x,this._dragStartPosition.y=e.position.y,this._dragPosition.set(0,0),this._mousePosition.set(0,0),null===(t=this._timelineDragend)||void 0===t||t.kill())}},{key:"_dragHandler",value:function(e){if(S.a.isTouch()){this._dragCurrentPosition.x=e.position.x,this._dragCurrentPosition.y=e.position.y;var t=Math.min(this._dragStartPosition.distanceTo(this._dragCurrentPosition),150),n=Math.atan2(this._dragStartPosition.y-this._dragCurrentPosition.y,this._dragStartPosition.x-this._dragCurrentPosition.x);this._dragPosition.x=-t*Math.cos(n),this._dragPosition.y=t*Math.sin(n),this._mousePosition.x=this._dragPosition.x/(this._width/this._settings.touchSensibility),this._mousePosition.y=this._dragPosition.y/(this._width/this._settings.touchSensibility)}}},{key:"_dragendHandler",value:function(){S.a.isTouch()&&(this._timelineDragend=new l.a.timeline,this._timelineDragend.to(this._dragPosition,{duration:1,x:0,y:0,ease:"power2.out"},0),this._timelineDragend.to(this._mousePosition,{duration:1,x:0,y:0,ease:"power2.out"},0))}},{key:"_mouseClickHandler",value:function(){}},{key:"onCameraChange",value:function(e){var t=e.type;this.visible="debug"!==t&&"menu"!==t}},{key:"_createDebugger",value:function(){var e=this;if(w.a){this._settingsChangeHandler=this._settingsChangeHandler.bind(this);var t=w.a.addGroup("Lines",{container:this._debugContainer});t.add(this,"visible"),t.add(this._settings,"speed",{onChange:this._settingsChangeHandler}),t.add(this._settings,"xSize",{onChange:this._settingsChangeHandler}),t.add(this._settings,"ySize",{onChange:this._settingsChangeHandler}),t.add(this._settings,"lineWidth",{onChange:this._settingsChangeHandler}),t.add(this._settings,"depth",{stepSize:1,onChange:this._settingsChangeHandler}),t.add(this._settings,"mouseScale",{listen:!0,onChange:this._settingsChangeHandler}),t.add(this._settings,"touchSensibility",{listen:!0,onChange:this._settingsChangeHandler}),t.add(this,"_targetCenterProgress",{label:"target center progress",min:0,max:1,stepSize:1}),t.addButton("Spin",{fullWidth:!0,onClick:function(){e._spin()}});var n=t.addGroup("Screen position");return n.add(this._settings.targetScreenOffset,"x",{onChange:this._settingsChangeHandler}),n.add(this._settings.targetScreenOffset,"y",{onChange:this._settingsChangeHandler}),n.add(this._settings.targetScreenOffset,"z",{onChange:this._settingsChangeHandler}),t}}},{key:"_settingsChangeHandler",value:function(){for(var e,i=0,t=this._lines.length;i<t;i++)(e=this._lines[i])._speed=this._settings.speed,e._xSineSize=this._settings.xSize,e._ySineSize=this._settings.ySize,e._targetScreenOffset.copy(this._settings.targetScreenOffset),e._depth=this._settings.depth,e._mouseScale.copy(this._settings.mouseScale);this._mesh.material.lineWidth=this._settings.lineWidth}}]),n}(Object(c.a)(h.Object3D));function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Xe=function(e){Object(f.a)(n,e);var t=Ye(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this))._scene=new h.Scene,e._camera=he.a,e._renderTarget=e._createRenderTarget(),e._lines=e._createLines(),e.needsSwap=!1,e}return Object(o.a)(n,[{key:"dispose",value:function(){this._lines.destroy()}},{key:"texture",get:function(){return this._renderTarget.texture}},{key:"lines",get:function(){return this._lines}},{key:"show",value:function(){return this._lines.show()}},{key:"hide",value:function(){return this._lines.hide()}},{key:"enable",value:function(){this._lines.visible=!0}},{key:"disable",value:function(){this._lines.visible=!1}},{key:"changeColor",value:function(e){this._lines.changeColor(e)}},{key:"_createRenderTarget",value:function(){var e=h.WebGLMultisampleRenderTarget;1!==window.webglSettings.gpuTier&&F.a.isWebGL2Available()||(e=h.WebGLRenderTarget);var t=new e(0,0);return t.texture.format=h.RGBAFormat,t.texture.minFilter=h.NearestFilter,t.texture.magFilter=h.NearestFilter,t.texture.generateMipmaps=!1,t.depthBuffer=!1,t}},{key:"_createLines",value:function(){var e=new qe({camera:this._camera,debugContainer:"Main"});return e.visible=!1,this._scene.add(e),e}},{key:"render",value:function(e,t){var n=e.getClearAlpha();e.setRenderTarget(this._renderTarget),e.setClearAlpha(0),e.clearColor(),e.render(this._scene,this._camera),e.setRenderTarget(t),e.setClearAlpha(n)}},{key:"setSize",value:function(e,t){this._renderTarget.setSize(e,t)}}]),n}(W.b);function Ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Qe=function(e){Object(f.a)(n,e);var t=Ke(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this))._width=null,e._height=null,e._scene=null,e._camera=null,e.needsSwap=!1,e}return Object(o.a)(n,[{key:"destroy",value:function(){this._scene&&this._scene.destroy()}},{key:"scene",get:function(){return this._scene},set:function(e){this._scene=e}},{key:"camera",get:function(){return this._camera},set:function(e){this._camera=e}},{key:"_createFullscreenQuad",value:function(){var e=new h.RawShaderMaterial({vertexShader:"// Precision\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Uniforms\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv;\n\n// Varyings\nvarying vec2 vUv;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"// Precision\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uTexture;\nuniform vec2 uResolution;\nuniform float uEffectStrength;\nuniform float uOffsetX;\nuniform float uOffsetY;\n\n// // https://www.shadertoy.com/view/4s2GRR\n// vec4 fisheye(sampler2D diffuse, vec2 uv, float strength) {\n//     //normalized coords with some cheat\n//     vec2 p = gl_FragCoord.xy / uResolution.x;\n//     // vec2 p = uv;\n\n//     //screen proportion\n//     float prop = uResolution.x / uResolution.y;\n//     //center coords\n//     vec2 m = vec2(0.5 + uOffsetX, (0.5 + uOffsetY) / prop);\n//     //vector from center to current fragment\n//     vec2 dd = p - m;\n//     // distance of pixel from center\n//     float r = sqrt(dot(dd, dd));\n//     //amount of effect\n//     float power = ( 2.0 * 3.141592 / (2.0 * sqrt(dot(m, m))) ) * strength;\n//     //radius of 1:1 effect\n//     float bind;\n//     if (power > 0.0) bind = sqrt(dot(m, m));//stick to corners\n//     else {if (prop < 1.0) bind = m.x; else bind = m.y;}//stick to borders\n\n//     //Weird formulas\n//     vec2 distortUv;\n//     if (power > 0.0)//fisheye\n//         distortUv = m + normalize(dd) * tan(r * power) * bind / tan( bind * power);\n//     else if (power < 0.0)//antifisheye\n//     distortUv = m + normalize(dd) * atan(r * -power * 10.0) * bind / atan(-power * bind * 10.0);\n//     else\n//         distortUv = p;//no effect for power = 1.0\n\n//     //Second part of cheat\n//     //for round effect, not elliptical\n//     return texture2D(diffuse, vec2(distortUv.x, distortUv.y * prop));\n//     // return texture2D(diffuse, uv);\n//     // return vec4(vec3(p.y), 1.);\n// }\n\nvoid main() {\n    // gl_FragColor = fisheye(uTexture, vUv, uEffectStrength);\n    // gl_FragColor = vec4(vUv.y * step(vUv.x, 0.5), 0.0, 0.0, 1.0);\n    gl_FragColor = texture2D(uTexture, vUv);\n    // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.);\n}\n",uniforms:{uTexture:{value:null},uResolution:{value:new h.Vector2(0,0)},uEffectStrength:{value:0},uOffsetX:{value:-.067},uOffsetY:{value:-.292}},transparent:!1});return e.blending=h.CustomBlending,e.blendEquation=h.AddEquation,e.blendSrc=h.OneFactor,e.blendDst=h.OneMinusSrcAlphaFactor,e.blendSrcAlpha=h.OneFactor,e.blendDstAlpha=h.OneMinusSrcAlphaFactor,new ee(e)}},{key:"render",value:function(e,t){this._scene&&(e.setRenderTarget(null),e.render(this._scene,this._camera))}},{key:"resize",value:function(e,t){this._width=e,this._height=t}}]),n}(W.b);function Ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Je=function(e){Object(f.a)(n,e);var t=Ze(n);function n(){Object(r.a)(this,n);var e=n.SkyShader,o=new h.ShaderMaterial({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:h.UniformsUtils.clone(e.uniforms),side:h.BackSide,depthWrite:!1});return t.call(this,new h.BoxGeometry(1,1,1),o)}return n}(h.Mesh);function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Je.prototype.isSky=!0,Je.SkyShader={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new h.Vector3},up:{value:new h.Vector3(0,1,0)}},vertexShader:"\n        uniform vec3 sunPosition;\n        uniform float rayleigh;\n        uniform float turbidity;\n        uniform float mieCoefficient;\n        uniform vec3 up;\n\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        // constants for atmospheric scattering\n        const float e = 2.71828182845904523536028747135266249775724709369995957;\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        // wavelength of used primaries, according to preetham\n        const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n        // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n        // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n        const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n        // mie stuff\n        // K coefficient for the primaries\n        const float v = 4.0;\n        const vec3 K = vec3( 0.686, 0.678, 0.666 );\n        // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n        const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n        // earth shadow hack\n        // cutoffAngle = pi / 1.95;\n        const float cutoffAngle = 1.6110731556870734;\n        const float steepness = 1.5;\n        const float EE = 1000.0;\n\n        float sunIntensity( float zenithAngleCos ) {\n            zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n            return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n        }\n\n        vec3 totalMie( float T ) {\n            float c = ( 0.2 * T ) * 10E-18;\n            return 0.434 * c * MieConst;\n        }\n\n        void main() {\n\n            vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n            vWorldPosition = worldPosition.xyz;\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            gl_Position.z = gl_Position.w; // set z to camera.far\n\n            vSunDirection = normalize( sunPosition );\n\n            vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n            vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n            float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n            // extinction (absorbtion + out scattering)\n            // rayleigh coefficients\n            vBetaR = totalRayleigh * rayleighCoefficient;\n\n            // mie coefficients\n            vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n        }",fragmentShader:"\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        uniform float mieDirectionalG;\n        uniform vec3 up;\n\n        const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n        // constants for atmospheric scattering\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        const float n = 1.0003; // refractive index of air\n        const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n        // optical length at zenith for molecules\n        const float rayleighZenithLength = 8.4E3;\n        const float mieZenithLength = 1.25E3;\n        // 66 arc seconds -> degrees, and the cosine of that\n        const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n        // 3.0 / ( 16.0 * pi )\n        const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n        // 1.0 / ( 4.0 * pi )\n        const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n        float rayleighPhase( float cosTheta ) {\n            return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n        }\n\n        float hgPhase( float cosTheta, float g ) {\n            float g2 = pow( g, 2.0 );\n            float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n            return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n        }\n\n        void main() {\n\n            vec3 direction = normalize( vWorldPosition - cameraPos );\n\n            // optical length\n            // cutoff angle at 90 to avoid singularity in next formula.\n            float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n            float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n            float sR = rayleighZenithLength * inverse;\n            float sM = mieZenithLength * inverse;\n\n            // combined extinction factor\n            vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n            // in scattering\n            float cosTheta = dot( direction, vSunDirection );\n\n            float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n            vec3 betaRTheta = vBetaR * rPhase;\n\n            float mPhase = hgPhase( cosTheta, mieDirectionalG );\n            vec3 betaMTheta = vBetaM * mPhase;\n\n            vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n            Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n            // nightsky\n            float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n            float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n            vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n            vec3 L0 = vec3( 0.1 ) * Fex;\n\n            // composition + solar disc\n            float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n            L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n            vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n            vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n            gl_FragColor = vec4( retColor, 1.0 );\n\n            #include <tonemapping_fragment>\n            #include <encodings_fragment>\n\n        }"};var tt=function(e){Object(f.a)(n,e);var t=et(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this))._cubeRenderTarget=new h.WebGLCubeRenderTarget(512,{format:h.RGBAFormat}),e._scene=new h.Scene,e._camera=new h.CubeCamera(.1,1e3,e._cubeRenderTarget),e._sky=e._createSky(),e.needsSwap=!1,e}return Object(o.a)(n,[{key:"_createSky",value:function(){var e=new Je;e.scale.setScalar(1e4),this._scene.add(e);var t=new h.Vector3,n={elevation:2,azimuth:180};function r(){var r=h.MathUtils.degToRad(90-n.elevation),o=h.MathUtils.degToRad(n.azimuth);t.setFromSphericalCoords(1,r,o),e.material.uniforms.sunPosition.value.copy(t)}return r(),this._debug&&(this._debug.add(e.material.uniforms.turbidity,"value",{label:"turbidity",min:0,max:20}),this._debug.add(e.material.uniforms.rayleigh,"value",{label:"rayleigh",min:0,max:4,stepSize:.001}),this._debug.add(e.material.uniforms.mieCoefficient,"value",{label:"mieCoefficient",min:0,max:.1,stepSize:.001}),this._debug.add(e.material.uniforms.mieDirectionalG,"value",{label:"mieDirectionalG",min:0,max:1,stepSize:.001}),this._debug.add(n,"elevation",{min:0,max:90,onChange:r}),this._debug.add(n,"azimuth",{min:-180,max:180,onChange:r})),e}},{key:"render",value:function(e){this._camera.update(e,this._scene)}}]),n}(W.b);function nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var it=function(e){Object(f.a)(n,e);var t=nt(n);function n(e,o){var l;return Object(r.a)(this,n),(l=t.call(this)).textureID=void 0!==o?o:"tDiffuse",e instanceof h.ShaderMaterial?(l.uniforms=e.uniforms,l.material=e):e&&(l.uniforms=h.UniformsUtils.clone(e.uniforms),l.material=new h.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:l.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),l.fsQuad=new ee(l.material),l}return Object(o.a)(n,[{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}]),n}(Q),at="// Precision\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Uniforms\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv;\n\n// Varying\nvarying vec2 vUv;\n\nvoid main() {\n    // Varyings\n    vUv = uv;\n\n    // Output\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",ot="// Precision\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\n// Varying\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D tDiffuse;\nuniform sampler2D tBlur;\nuniform sampler2D tDepth;\nuniform sampler2D tDepthCurve;\nuniform float uCameraNear;\nuniform float uCameraFar;\nuniform mat4 uProjectionInverse;\nuniform mat4 uViewMatrixInv;\nuniform float uDepthOffset;\nuniform bool uShowSides;\nuniform vec4 uSides;\nuniform bool uShowBottom;\nuniform vec2 uBottom;\nuniform vec2 uFar;\n\n// Includes\n#include <packing>\n\nfloat readDepth(float depthSample) {\n    float viewZ = perspectiveDepthToViewZ(depthSample, uCameraNear, uCameraFar);\n    return viewZToOrthographicDepth(viewZ, uCameraNear, uCameraFar);\n}\n\n// https://stackoverflow.com/questions/32227283/getting-world-position-from-depth-buffer-value\nvec3 worldPosFromDepth(float depth) {\n    float z = depth * 2.0 - 1.0;\n\n    vec4 clipSpacePosition = vec4(vUv * 2.0 - 1.0, z, 1.0);\n    vec4 viewSpacePosition = uProjectionInverse * clipSpacePosition;\n\n    // Perspective division\n    viewSpacePosition /= viewSpacePosition.w;\n\n    vec4 worldSpacePosition = uViewMatrixInv * viewSpacePosition;\n\n    return worldSpacePosition.xyz;\n}\n\nvoid main() {\n    // Base sample\n    vec4 base = texture2D(tDiffuse, vUv);\n\n    // Blur sample\n    vec4 blur = texture2D(tBlur, vUv);\n\n    // Depth\n    float depthSample = texture2D(tDepth, vUv).x;\n    float depth = readDepth(depthSample);\n\n    // Depth\n    float zDepth = clamp(depth + uDepthOffset, 0.0, 1.0);\n    float depthCurve = texture2D(tDepthCurve, clamp(vec2(zDepth, 0.5), 0.0, 1.0)).r;\n\n    // World position\n    vec3 worldPosition = worldPosFromDepth(depthSample);\n\n    // Sides\n    if (uShowSides) {\n        float sides = smoothstep(uSides.x, uSides.x + uSides.y, abs(worldPosition.x));\n        sides *= 1.0 - smoothstep(uSides.z, uSides.z + uSides.w, worldPosition.y);\n        sides += clamp(sides, 0.0, 1.0);\n        depthCurve += sides * (1.0 - depth);\n    }\n\n    // Bottom\n    if (uShowBottom) {\n        float bottom = smoothstep(uBottom.x, uBottom.y, worldPosition.y);\n        depthCurve += bottom;\n    }\n\n    // float dd = distance(vec3(0.0, 0.0, 0.0), worldPosition);\n    // depthCurve = 1.0 - smoothstep(uFar.x, uFar.x + uFar.y, dd);\n\n    depthCurve = clamp(depthCurve, 0.0, 1.0);\n\n    // Output\n    gl_FragColor = mix(base, blur, depthCurve);\n}\n";function st(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var lt=function(e){Object(f.a)(n,e);var t=st(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this,new h.RawShaderMaterial({vertexShader:at,fragmentShader:ot,uniforms:{tDepth:{value:null},tDepthCurve:{value:null},tDiffuse:{value:null},tBlur:{value:null},uCameraNear:{value:null},uCameraFar:{value:null},uDepthOffset:{value:0},uProjectionInverse:{value:0},uViewMatrixInv:{value:0},uShowSides:{value:!1},uSides:{value:new h.Vector4(0,0,0,0)},uShowBottom:{value:!1},uBottom:{value:new h.Vector2(0,0)},uFar:{value:new h.Vector2(34781,-22618)}}}))).needsSwap=!0,e}return Object(o.a)(n,[{key:"depthOffset",get:function(){return this.material.uniforms.uDepthOffset.value},set:function(e){this.material.uniforms.uDepthOffset.value=e}},{key:"render",value:function(e,t,n){this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.uniforms.tDiffuse.value=n.texture,e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}]),n}(Object(c.a)(it)),ut={uniforms:{tInput:{value:null},uCameraNear:{value:null},uCameraNearOffset:{value:null},uCameraFar:{value:null}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"#define GLSLIFY 1\n#include <packing>\n\nvarying vec2 vUv;\n\nuniform sampler2D tInput;\nuniform float uCameraNear;\nuniform float uCameraNearOffset;\nuniform float uCameraFar;\n\nfloat readDepth(sampler2D depthSampler, vec2 coord) {\n    float fragCoordZ = texture2D(depthSampler, coord).x;\n    float viewZ = perspectiveDepthToViewZ(fragCoordZ, uCameraNear, uCameraFar);\n    return viewZToOrthographicDepth(viewZ, uCameraNear * uCameraNearOffset, uCameraFar);\n}\n\nvoid main() {\n    float depth = readDepth(tInput, vUv);\n    depth = depth == 1.0 ? 0.0 : depth;\n    gl_FragColor = vec4(depth) * 1.5;\n}\n"},ct={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new h.Vector3}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:'#define GLSLIFY 1\n#define TAPS_PER_PASS 6.0\n\nvarying vec2 vUv;\n\nuniform sampler2D tInput;\n\nuniform vec3 vSunPositionScreenSpace;\nuniform float fStepSize; // filter step size\n\nvoid main() {\n\n// delta from current pixel to "sun" position\n\n    vec2 delta = vSunPositionScreenSpace.xy - vUv;\n    float dist = length( delta );\n\n// Step vector (uv space)\n\n    vec2 stepv = fStepSize * delta / dist;\n\n// Number of iterations between pixel and sun\n\n    float iters = dist/fStepSize;\n\n    vec2 uv = vUv.xy;\n    float col = 0.0;\n\n// This breaks ANGLE in Chrome 22\n//\t- see http://code.google.com/p/chromium/issues/detail?id=153105\n\n/*\n// Unrolling didnt do much on my hardware (ATI Mobility Radeon 3450),\n// so i\'ve just left the loop\n\n"for ( float i = 0.0; i < TAPS_PER_PASS; i += 1.0 ) {",\n\n// Accumulate samples, making sure we dont walk past the light source.\n\n// The check for uv.y < 1 would not be necessary with "border" UV wrap\n// mode, with a black border color. I don\'t think this is currently\n// exposed by three.js. As a result there might be artifacts when the\n// sun is to the left, right or bottom of screen as these cases are\n// not specifically handled.\n\n"\tcol += ( i <= iters && uv.y < 1.0 ? texture2D( tInput, uv ).r : 0.0 );",\n"\tuv += stepv;",\n\n"}",\n*/\n\n// Unrolling loop manually makes it work in ANGLE\n\n    float f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) ); // used to fade out godrays\n\n    if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n    uv += stepv;\n\n    if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n    uv += stepv;\n\n    if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n    uv += stepv;\n\n    if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n    uv += stepv;\n\n    if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n    uv += stepv;\n\n    if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n    uv += stepv;\n\n// Should technically be dividing by \'iters but \'TAPS_PER_PASS\' smooths out\n// objectionable artifacts, in particular near the sun position. The side\n// effect is that the result is darker than it should be around the sun, as\n// TAPS_PER_PASS is greater than the number of samples actually accumulated.\n// When the result is inverted (in the shader \'godrays_combine this produces\n// a slight bright spot at the position of the sun, even when it is occluded.\n\n    gl_FragColor = vec4( col/TAPS_PER_PASS ) * 2.0;\n    gl_FragColor.a = 1.0;\n\n}\n'},ht={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},uGodRayColor:{value:new h.Color},uResolution:{value:new h.Vector2}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nuniform sampler2D tColors;\nuniform sampler2D tGodRays;\n\nuniform float fGodRayIntensity;\nuniform vec2 uResolution;\nuniform vec3 uGodRayColor;\n\n// https://stackoverflow.com/questions/13501081/efficient-bicubic-filtering-code-in-glsl\nvec4 cubic(float v){\n    vec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\n    vec4 s = n * n * n;\n    float x = s.x;\n    float y = s.y - 4.0 * s.x;\n    float z = s.z - 4.0 * s.y + 6.0 * s.x;\n    float w = 6.0 - x - y - z;\n    return vec4(x, y, z, w) * (1.0 / 6.0);\n}\n\nvec4 textureBicubic(sampler2D sampler, vec2 texCoords, vec2 textureResolution){\n    vec2 texSize = textureResolution;\n    vec2 invTexSize = 1.0 / texSize;\n\n    texCoords = texCoords * texSize - 0.5;\n\n    vec2 fxy = fract(texCoords);\n    texCoords -= fxy;\n\n    vec4 xcubic = cubic(fxy.x);\n    vec4 ycubic = cubic(fxy.y);\n\n    vec4 c = texCoords.xxyy + vec2 (-0.5, +1.5).xyxy;\n\n    vec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\n    vec4 offset = c + vec4 (xcubic.yw, ycubic.yw) / s;\n\n    offset *= invTexSize.xxyy;\n\n    vec4 sample0 = texture2D(sampler, offset.xz);\n    vec4 sample1 = texture2D(sampler, offset.yz);\n    vec4 sample2 = texture2D(sampler, offset.xw);\n    vec4 sample3 = texture2D(sampler, offset.yw);\n\n    float sx = s.x / (s.x + s.y);\n    float sy = s.z / (s.z + s.w);\n\n    return mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n\nvoid main() {\n    vec4 raySample = textureBicubic(tGodRays, vUv, uResolution / 6.0);\n    vec4 rays = fGodRayIntensity * vec4(raySample.r * vec4(uGodRayColor, 1.0));\n    gl_FragColor = texture2D(tColors, vUv) + rays;\n    gl_FragColor.a = 1.0;\n}\n"};function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var mt=function(e){Object(f.a)(n,e);var t=ft(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){this._color=e.color,this._scene=null,this._camera=null,this._isActive=!1,this._godraysSunPosition=new h.Vector3(5500,1e3,-2e4),this._godraysClipPosition=new h.Vector4,this._godraysScreenSpacePosition=new h.Vector3,this._godraysPost=this._createGodraysPost(),this.needsSwap=!0}},{key:"scene",get:function(){return this._scene},set:function(e){this._scene=e}},{key:"camera",get:function(){return this._camera},set:function(e){this._camera=e}},{key:"post",get:function(){return this._godraysPost}},{key:"sunPosition",get:function(){return this._godraysSunPosition}},{key:"render",value:function(e,t,n){this._godraysClipPosition.x=this._godraysSunPosition.x,this._godraysClipPosition.y=this._godraysSunPosition.y,this._godraysClipPosition.z=this._godraysSunPosition.z,this._godraysClipPosition.w=1,this._godraysClipPosition.applyMatrix4(this._camera.matrixWorldInverse).applyMatrix4(this._camera.projectionMatrix),this._godraysClipPosition.x/=this._godraysClipPosition.w,this._godraysClipPosition.y/=this._godraysClipPosition.w,this._godraysScreenSpacePosition.x=(this._godraysClipPosition.x+1)/2,this._godraysScreenSpacePosition.y=(this._godraysClipPosition.y+1)/2,this._godraysScreenSpacePosition.z=this._godraysClipPosition.z,this._godraysPost.godrayGenUniforms.vSunPositionScreenSpace.value.copy(this._godraysScreenSpacePosition),this._godraysPost.scene.overrideMaterial=this._godraysPost.materialGodraysDepthMask,e.setRenderTarget(this._godraysPost.rtTextureDepthMask),e.render(this._godraysPost.scene,this._godraysPost.camera);this._filterGodRays(e,this._godraysPost.rtTextureDepthMask.texture,this._godraysPost.rtTextureGodRays2,this._getStepSize(1,6,1)),this._filterGodRays(e,this._godraysPost.rtTextureGodRays2.texture,this._godraysPost.rtTextureGodRays1,this._getStepSize(1,6,2)),this._filterGodRays(e,this._godraysPost.rtTextureGodRays1.texture,this._godraysPost.rtTextureGodRays2,this._getStepSize(1,6,3)),this._godraysPost.godrayCombineUniforms.tColors.value=n.texture,this._godraysPost.godrayCombineUniforms.tGodRays.value=this._godraysPost.rtTextureGodRays2.texture,this._godraysPost.scene.overrideMaterial=this._godraysPost.materialGodraysCombine,this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(t),e.render(this._godraysPost.scene,this._godraysPost.camera),this._godraysPost.scene.overrideMaterial=null}},{key:"show",value:function(){this._isActive=!0;var e=new l.a.timeline;return e.set(this,{enabled:!0},0),e.fromTo(this.post.godrayCombineUniforms.fGodRayIntensity,{value:0},{duration:2,value:1,ease:"sine.inOut"},0),e}},{key:"hide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=new l.a.timeline({onComplete:function(){e._isActive=!1}});return n.to(this.post.godrayCombineUniforms.fGodRayIntensity,{duration:t,value:0,ease:"sine.inOut"},0),n.set(this,{enabled:!1},1),n}},{key:"enable",value:function(){this._isActive&&(this.enabled=!0)}},{key:"disable",value:function(){this._isActive&&(this.enabled=!1)}},{key:"reset",value:function(){this.enabled=!1,this.post.godrayCombineUniforms.fGodRayIntensity.value=0}},{key:"_createGodraysPost",value:function(){var e={};e.scene=new h.Scene,e.camera=new h.OrthographicCamera(-1,1,1,-1,0,1),e.scene.add(e.camera);var t={minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBFormat};e.rtTextureDepthMask=new h.WebGLRenderTarget(0,0,t),e.rtTextureGodRays1=new h.WebGLRenderTarget(0,0,t),e.rtTextureGodRays2=new h.WebGLRenderTarget(0,0,t);var n=ut;e.godrayMaskUniforms=h.UniformsUtils.clone(n.uniforms),e.materialGodraysDepthMask=new h.ShaderMaterial({uniforms:e.godrayMaskUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),e.godrayMaskUniforms.uCameraNearOffset.value=150;var r=ct;e.godrayGenUniforms=h.UniformsUtils.clone(r.uniforms),e.materialGodraysGenerate=new h.ShaderMaterial({uniforms:e.godrayGenUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader});var o=ht;e.godrayCombineUniforms=h.UniformsUtils.clone(o.uniforms),e.materialGodraysCombine=new h.ShaderMaterial({uniforms:e.godrayCombineUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),e.godrayCombineUniforms.fGodRayIntensity.value=0,e.godrayCombineUniforms.uGodRayColor.value=this._color;var l=new h.BufferGeometry;return l.setAttribute("position",new h.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),l.setAttribute("uv",new h.Float32BufferAttribute([0,2,0,0,2,0],2)),e.quad=new h.Mesh(l,e.materialGodraysGenerate),e.scene.add(e.quad),e}},{key:"_getStepSize",value:function(e,t,n){return e*Math.pow(t,-n)}},{key:"_filterGodRays",value:function(e,t,n,r){this._godraysPost.scene.overrideMaterial=this._godraysPost.materialGodraysGenerate,this._godraysPost.godrayGenUniforms.fStepSize.value=r,this._godraysPost.godrayGenUniforms.tInput.value=t,e.setRenderTarget(n),e.render(this._godraysPost.scene,this._godraysPost.camera),this._godraysPost.scene.overrideMaterial=null}},{key:"setSize",value:function(e,t){this._width=e,this._height=t,this._godraysPost.rtTextureDepthMask.setSize(this._width,this._height);var n=.25*this._width,r=.25*this._height;this._godraysPost.rtTextureGodRays1.setSize(n,r),this._godraysPost.rtTextureGodRays2.setSize(n,r),this._godraysPost.materialGodraysCombine.uniforms.uResolution.value.x=this._width,this._godraysPost.materialGodraysCombine.uniforms.uResolution.value.y=this._height}}]),n}(Object(c.a)(W.b)),pt=n(179);function gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var o=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var vt={fogBloom:{enabled:!1},ssms:{depthOffset:0},godrays:{enabled:!1},final:{enabled:!0,noiseStrength:0,vignetteOffset:.39,vignetteDarkness:.38,isLensFlareVisible:!1,lut:!1}},_t=function(e){Object(f.a)(n,e);var t=gt(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){var t=e.root,n=e.renderer,r=e.sceneRenderer,o=e.width,l=e.height;this._root=t,this._renderer=n,this._sceneRenderer=r,this._width=o,this._height=l,this._scenes={},this._firstRender=!0,this._debugger=this._createDebugger(),this._renderTarget=this._createRenderTarget(),this._composer=this._createComposer(),this._luts=this._createLUTs(),this._passes=this._createPasses()}},{key:"destroy",value:function(){for(var e in this._renderTarget.dispose(),this._composer.renderTarget1.dispose(),this._composer.renderTarget2.dispose(),this._passes)"function"==typeof this._passes[e].dispose&&this._passes[e].dispose()}},{key:"passes",get:function(){return this._passes}},{key:"renderTarget",get:function(){return this._renderTarget}},{key:"render",value:function(e,t){this._passes.final&&(this._passes.final.uniforms.uProjectionInverse.value=t.projectionMatrixInverse,this._passes.final.uniforms.uViewMatrixInv.value=t.matrixWorld,this._passes.final.uniforms.uDepthTexture.value=this._sceneRenderer.depthTexture),this._passes.lineRender&&(this._passes.lineRender.camera=t),this._passes.fogBloom&&(this._passes.fogBloom.inputTexture=this._sceneRenderer.renderTarget),this._passes.ssms&&(this._passes.ssms.uniforms.tBlur.value=this._passes.fogBloom.renderTargetsHorizontal[0].texture,this._passes.ssms.uniforms.tDepth.value=this._sceneRenderer.depthTexture,this._passes.ssms.uniforms.uCameraNear.value=t.near,this._passes.ssms.uniforms.uCameraFar.value=t.far,this._passes.ssms.uniforms.uProjectionInverse.value=t.projectionMatrixInverse,this._passes.ssms.uniforms.uViewMatrixInv.value=t.matrixWorld),this._passes.godrays&&(this._passes.godrays.scene=e,this._passes.godrays.camera=t,this._passes.godrays._godraysPost.godrayMaskUniforms.tInput.value=this._sceneRenderer.depthTexture,this._passes.godrays._godraysPost.godrayMaskUniforms.uCameraNear.value=t.near,this._passes.godrays._godraysPost.godrayMaskUniforms.uCameraFar.value=t.far),this._passes.bloomRender&&(this._passes.bloomRender.scene=e,this._passes.bloomRender.camera=t),this._composer.render()}},{key:"addSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};Object.assign(n,vt,t),this._scenes[e]=n}},{key:"loadSettings",value:function(e){var t=this._scenes[e];if(this._activeScene=t,t.fogBloom&&this._passes.fogBloom){var n=t.fogBloom;void 0!==n.enabled&&(this._passes.fogBloom.enabled=n.enabled,this._passes.ssms.enabled=n.enabled),void 0!==n.strength&&(this._passes.fogBloom.strength=n.strength),void 0!==n.radius&&(this._passes.fogBloom.radius=n.radius),void 0!==n.radius&&(this._passes.fogBloom.radius=n.radius);var r=t.ssms;void 0!==r.depthOffset&&(this._passes.ssms.depthOffset=r.depthOffset)}if(t.bloom&&this._passes.bloom){var o=t.bloom;void 0!==o.enabled&&(this._passes.bloom.enabled=o.enabled,this._passes.bloomRender.enabled=o.enabled),void 0!==o.strength&&(this._passes.bloom.strength=o.strength),void 0!==o.radius&&(this._passes.bloom.radius=o.radius),void 0!==o.threshold&&(this._passes.bloom.threshold=o.threshold)}if(t.ssms&&this._passes.ssms){var l=t.ssms;void 0!==l.depthOffset&&(this._passes.ssms.material.uniforms.uDepthOffset.value=l.depthOffset),void 0!==l.sides?(this._passes.ssms.material.uniforms.uShowSides.value=!0,this._passes.ssms.material.uniforms.uSides.value.copy(l.sides)):this._passes.ssms.material.uniforms.uShowSides.value=!1,void 0!==l.bottom?(this._passes.ssms.material.uniforms.uShowBottom.value=!0,this._passes.ssms.material.uniforms.uBottom.value.copy(l.bottom)):this._passes.ssms.material.uniforms.uShowBottom.value=!1}if(t.bloom&&this._passes.godrays){var c=t.godrays;void 0!==c.enabled&&(this._passes.godrays.enabled=c.enabled)}if(t.final&&this._passes.final){var d=t.final;void 0!==d.enabled&&(this._passes.final.enabled=d.enabled),void 0!==d.noiseStrength&&(this._passes.final.noiseStrength=d.noiseStrength),void 0!==d.lensDistortionStrength&&(this._passes.final.lensDistortionStrength=d.lensDistortionStrength),void 0!==d.chromaticAberrationMaxDistortion&&(this._passes.final.chromaticAberrationMaxDistortion=d.chromaticAberrationMaxDistortion),void 0!==d.chromaticAberrationScale&&(this._passes.final.chromaticAberrationScale=d.chromaticAberrationScale),void 0!==d.chromaticAberrationSize&&(this._passes.final.chromaticAberrationSize=d.chromaticAberrationSize),void 0!==d.vignetteOffset&&(this._passes.final.vignetteOffset=d.vignetteOffset),void 0!==d.vignetteDarkness&&(this._passes.final.vignetteDarkness=d.vignetteDarkness),void 0!==d.isLensFlareVisible&&(this._passes.final.isLensFlareVisible=d.isLensFlareVisible),d.lut?(this._lutTexture=this._getLut(d.lut),this._passes.transition.material.uniforms.uIsLutActive.value=!0,this._passes.transition.material.uniforms.tLutTexture.value=this._getLut(d.lut),this._passes.transition.material.uniforms.uLutTransition.value=0,this._passes.transition.material.uniforms.uLutOffset.value=new h.Vector4(0,0,0,0)):(this._passes.transition.material.uniforms.uIsLutActive.value=!1,this._passes.transition.material.uniforms.tLutTexture.value=null)}}},{key:"clear",value:function(){this._renderer.setRenderTarget(this._composer.renderTarget1),this._renderer.clear(),this._renderer.setRenderTarget(this._composer.renderTarget2),this._renderer.clear()}},{key:"_createRenderTarget",value:function(){var e=new h.WebGLRenderTarget(0,0);return e.texture.format=h.RGBAFormat,e.texture.minFilter=h.NearestFilter,e.texture.magFilter=h.NearestFilter,e.texture.generateMipmaps=!1,e}},{key:"_createComposer",value:function(){return new N.a(this._renderer,this._renderTarget)}},{key:"_createLUTs",value:function(){for(var e,t,n=[],i=0,r=pt.a.length;i<r;i++)(e=pt.a[i]).name.includes("lut/")&&((t=new h.Texture(e.data)).minFilter=h.LinearFilter,t.magFilter=h.LinearFilter,t.generateMipmaps=!1,t.encoding=h.LinearEncoding,t.needsUpdate=!0,this._renderer.initTexture(t),n.push({name:e.name,texture:t}));return n}},{key:"_getLut",value:function(e){for(var t,i=0,n=this._luts.length;i<n;i++)if((t=this._luts[i]).name.includes(e))return t.texture}},{key:"_createPasses",value:function(){var e={};return e.sceneTexture=this._createSceneTexturePass(),e.godrays=this._createGodraysPass(),e.lineRender=this._createLineRenderpass(),e.fogBloom=this._createFogBloomPass(),e.ssms=this._createSSMSPass(),e.transition=this._createTransitionPass(),e.lineTexture=this._createLineTexturePass(e.lineRender.texture),e.fxaa=this._createFXAAPass(),e.bloomRender=this._createBloomRenderPass(e.lineRender.texture,e.transition),e.bloom=this._createBloomPass(),e.final=this._createFinalPass(),e.UIRender=this._createUIRenderpass(),e}},{key:"_createSceneTexturePass",value:function(){var e=new H.a(this._sceneRenderer.texture);return e.enabled=!0,this._composer.addPass(e),e}},{key:"_createLineRenderpass",value:function(){var e=new Xe;return e.enabled=!0,this._composer.addPass(e),e}},{key:"_createLineTexturePass",value:function(e){var t=new H.a(e);return t.enabled=!0,t.material.type="LineTexturePass",t.material.blending=h.CustomBlending,t.material.blendEquation=h.AddEquation,t.material.blendSrc=h.OneFactor,t.material.blendDst=h.OneMinusSrcAlphaFactor,t.material.blendSrcAlpha=h.OneFactor,t.material.blendDstAlpha=h.OneMinusSrcAlphaFactor,this._composer.addPass(t),t}},{key:"_createFXAAPass",value:function(){var e=new z.a(V.a);(e.enabled=!1,this._composer.addPass(e),this._debugger)&&this._debugger.addGroup("FXAA").add(e,"enabled",{listen:!0});return e}},{key:"_createSkyboxRenderpass",value:function(){var e=new tt;return this._composer.addPass(e),e}},{key:"_createUIRenderpass",value:function(){var e=new Qe({width:this._width,height:this._height});(e.enabled=!0,this._composer.addPass(e),this._debugger)&&this._debugger.addGroup("UI").add(e,"enabled",{listen:!0});return e}},{key:"_createStatueRenderPass",value:function(){var e=new G.a(null,null);return e.enabled=!1,e.clear=!1,this._composer.addPass(e),e}},{key:"_createTransitionPass",value:function(){var e=new oe({color:0});if(this._composer.addPass(e),this._debugger){var t=this._debugger.addGroup("Transition");t.add(e,"enabled",{listen:!0}),t.add(e,"progress",{min:0,max:1,listen:!0}),t.add(e,"color");var n=t.addGroup("LUT");n.add(e.material.uniforms.uIsLutActive,"value",{label:"active"}),n.add(e.material.uniforms.tLutTexture,"value",{label:"texture"}),n.add(e.material.uniforms.uLutTransition,"value",{label:"uLutTransition",min:0,max:1})}return e}},{key:"_createBloomRenderPass",value:function(e,t){var n=new ce({clearColor:16777215,clearAlpha:0,lineTexture:e,transitionPass:t});return n.enabled=!1,n.compile(this._renderer),this._composer.addPass(n),n}},{key:"_createBloomPass",value:function(){var e=this,t=new K(new h.Vector2,0,0,0);if(t.enabled=!1,this._composer.addPass(t),this._debugger){var n=this._debugger.addGroup("Bloom");n.add(t,"enabled",{listen:!0,onChange:function(){e._activeScene&&(e._passes.bloomRender.enabled=t.enabled,e._activeScene.bloom.enabled=t.enabled)}}),n.add(t,"strength",{min:0,max:3,step:.01,listen:!0,onChange:function(){e._activeScene&&(e._activeScene.bloom.strength=t.strength)}}),n.add(t,"radius",{min:0,max:1,step:.01,listen:!0,onChange:function(){e._activeScene&&(e._activeScene.bloom.radius=t.radius)}}),n.add(t,"threshold",{min:0,max:1,step:.01,listen:!0,onChange:function(){e._activeScene&&(e._activeScene.bloom.threshold=t.threshold)}})}return t}},{key:"_createFogBloomPass",value:function(){var e=this,t=new ne(this._renderer,new h.Vector2,0,0,0);if(t.enabled=!1,this._composer.addPass(t),this._debugger){var n=this._debugger.addGroup("Fog bloom");n.add(t,"resolutionScale",{options:[1,.5,.25,.2,.1,.05],onChange:function(){t.setSize(e._width,e._height)}}),n.add(t,"enabled",{listen:!0,onChange:function(){e._passes.ssms.enabled=t.enabled}}),n.add(t,"strength",{min:0,max:3,step:.01,listen:!0}),n.add(t,"radius",{min:0,max:1,step:.01,listen:!0})}return t}},{key:"_createSSMSPass",value:function(){var e=new h.Texture(x.b.get("curve-linear"));e.needsUpdate=!0,e.minFilter=h.LinearFilter;var t=new h.Texture(x.b.get("curve-non-linear-1"));t.needsUpdate=!0,t.minFilter=h.LinearFilter;var n=new h.Texture(x.b.get("curve-non-linear-2"));n.needsUpdate=!0,n.minFilter=h.LinearFilter;var r=new h.Texture(x.b.get("curve-non-linear-3"));r.needsUpdate=!0,r.minFilter=h.LinearFilter;var o=new lt;if(o.enabled=!1,o.uniforms.tDepthCurve.value=t,o.fsQuad.compile(this._renderer),this._composer.addPass(o),this._debugger){var l={curve:"curve-non-linear-1"},c=this._debugger.addGroup("SSMS");c.add(l,"curve",{options:["curve-linear","curve-non-linear-1","curve-non-linear-2","curve-non-linear-3"],onChange:function(){switch(l.curve){case"curve-linear":o.uniforms.tDepthCurve.value=e;break;case"curve-non-linear-1":o.uniforms.tDepthCurve.value=t;break;case"curve-non-linear-2":o.uniforms.tDepthCurve.value=n;break;case"curve-non-linear-3":o.uniforms.tDepthCurve.value=r}}}),c.add(o.uniforms.uDepthOffset,"value",{listen:!0,label:"depthOffset",stepSize:.001}),c.add(o.uniforms.uShowSides,"value",{label:"show sides",listen:!0}),c.add(o.uniforms.uSides,"value",{label:"sides",stepSize:1,listen:!0}),c.add(o.uniforms.uShowBottom,"value",{label:"show bottom",listen:!0}),c.add(o.uniforms.uBottom,"value",{label:"bottom",stepSize:1,listen:!0}),c.add(o.uniforms.uFar,"value",{label:"far",stepSize:10,listen:!0})}return o}},{key:"_createGodraysPass",value:function(){var e=new mt({color:new h.Color(13471319)});if(e.enabled=!0,this._composer.addPass(e),this._debugger){var t=this._debugger.addGroup("Rays",{container:"Rocky desert"});t.add(e,"enabled"),t.add(e.post.godrayCombineUniforms.fGodRayIntensity,"value",{label:"intensity"}),t.add(e.post.godrayCombineUniforms.uGodRayColor,"value",{label:"color"}),t.add(e.post.godrayMaskUniforms.uCameraNearOffset,"value",{label:"camera near offset",stepSize:1}),t.add(e,"sunPosition",{label:"sun position",stepSize:1})}return e}},{key:"_createFinalPass",value:function(){var e=this,t=new re({lut:{active:!1,texture:null},lensDistortion:{strength:0},chromaticAberration:{maxDistortion:0,scale:0,size:0},vignette:{offset:.54,darkness:.23}});if(t.enabled=!1,t.isVignetteVisible=!0,this._composer.addPass(t),this._debugger){var n=this._debugger.addGroup("Final");n.add(t,"enabled"),n.add(t.material.uniforms.uTransitionProgress,"value",{label:"transition progress"});var r=n.addGroup("Vignette");r.add(t,"isVignetteVisible"),r.add(t,"vignetteOffset",{min:0,max:1,label:"offset",listen:!0,onChange:function(){e._activeScene&&(e._activeScene.final.vignetteOffset=t.vignetteOffset)}}),r.add(t,"vignetteDarkness",{min:0,max:1,label:"darkness",listen:!0,onChange:function(){e._activeScene&&(e._activeScene.final.vignetteDarkness=t.vignetteDarkness)}}),n.addGroup("Noise").add(t.material.uniforms.uNoiseStrength,"value",{label:"noise strength",stepSize:.001})}return t}},{key:"onResize",value:function(e){var t=e.width,n=e.height,r=e.dpr,o=e.renderScale;this._width=t,this._height=n,this._dpr=r,this._renderWidthScaled=this._width*o,this._renderHeightScaled=this._height*o,this._resizeComposer(),this._resizeFogBloomPass(),this._resizeBloomPass(),this._resizeDofPass(),this._resizeFXAAPass(),this._resizeUIPass()}},{key:"_resizeComposer",value:function(){this._composer.setSize(this._renderWidthScaled,this._renderHeightScaled)}},{key:"_resizeFogBloomPass",value:function(){this._passes.fogBloom&&this._passes.fogBloom.setSize(this._renderWidthScaled,this._renderHeightScaled)}},{key:"_resizeBloomPass",value:function(){this._passes.bloom&&(this._passes.bloom.resolution=new h.Vector2(this._renderWidthScaled,this._renderHeightScaled))}},{key:"_resizeDofPass",value:function(){this._passes.dof&&(this._passes.dof.uniforms.aspect.value=this._renderWidthScaled/this._renderHeightScaled)}},{key:"_resizeFXAAPass",value:function(){this._passes.fxaa&&(this._passes.fxaa.material.uniforms.resolution.value.x=1/this._renderWidthScaled,this._passes.fxaa.material.uniforms.resolution.value.y=1/this._renderHeightScaled)}},{key:"_resizeUIPass",value:function(){this._passes.UIRender&&this._passes.UIRender.resize(this._width,this._height)}},{key:"_createDebugger",value:function(){if(w.a)return w.a.addGroup("Post processing",{container:"Main"})}}]),n}(Object(c.a)()),yt=n(104),bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e),this._canvas=t.canvas,this._nuxtRoot=t.nuxtRoot,this._isDebug=t.isDebug,this._isDevelopment=t.isDevelopment,window.webglSettings={gpuTier:t.gpuTier,bloomRenderScale:.5},this._width=null,this._height=null,this._clock=this._createClock(),this._debugger=this._createDebugger(),this._renderer=this._createRenderer(),this._bindHandlers(),this._setupEventListeners(),this._resize(),this._isDevelopment&&(this._stats=this._createStats(),this._statsGpuPanel=this._createStatsGpuPanel())}return Object(o.a)(e,[{key:"setup",value:function(e){this._createTextures(),this._sceneRenderer=this._createSceneRenderer(),this._postProcessing=this._createPostProcessing(),this._viewManager=this._createViewManager(),this._landscapeManager=this._createLandscapeManager(e)}},{key:"destroy",value:function(){var e,t,n;this._removeEventListeners(),this._removeDebugger(),this._removeStats(),null===(e=this._postProcessing)||void 0===e||e.destroy(),null===(t=this._landscapeManager)||void 0===t||t.destroy(),null===(n=this._viewManager)||void 0===n||n.destroy(),this._clock.stop(),this._renderer.dispose()}},{key:"landscapeManager",get:function(){return this._landscapeManager}},{key:"viewManager",get:function(){return this._viewManager}},{key:"postProcessing",get:function(){return this._postProcessing}},{key:"nuxtRoot",get:function(){return this._nuxtRoot}},{key:"sceneRenderer",get:function(){return this._sceneRenderer}},{key:"showMenu",value:function(){var e,t=this;if(null===(e=this._timelineHideMenu)||void 0===e||e.kill(),!this._landscapeManager.active)return new l.a.timeline;var n=this._landscapeManager.active.camera.getNextMenuIndex(),r=this._landscapeManager.active.config.menuCameraPositions[n],o=r.transitionProgress,c=r.lutIndex;return this._timelineShowMenu=new l.a.timeline({onComplete:function(){t._landscapeManager&&t._landscapeManager.active&&t._landscapeManager.active.dispatchEvent({type:"menu:opened"})}}),this._timelineShowMenu.to(this._postProcessing.passes.final.uniforms.uTransitionProgress,{duration:1,value:1,ease:"sine.inOut"},0),this._timelineShowMenu.call((function(){t._landscapeManager.active&&t._landscapeManager.active.dispatchEvent({type:"menu:open"})}),null,1),this._timelineShowMenu.call((function(){t._nuxtRoot.$store.getters["webgl/isLandscapeTransitioningOut"]&&t._landscapeManager.showNext(!0),setTimeout((function(){t._landscapeManager.active&&t._landscapeManager.active.camera.activateMenu(n)}),16)}),null,1),this._timelineShowMenu.call((function(){return t._postProcessing.passes.lineRender.disable()}),null,1),this._timelineShowMenu.call((function(){return t._postProcessing.passes.transition.changeLUT(c,!0)}),null,1),this._timelineShowMenu.to(this._postProcessing.passes.final.uniforms.uTransitionProgress,{duration:3.3,value:o,ease:"power3.out"},1),this._timelineShowMenu.fromTo(this.landscapeManager.active.camera.menu.rotation,{z:.2*Math.PI},{duration:100,z:0,ease:"power2.out"},1),this._timelineShowMenu}},{key:"hideMenu",value:function(e){var t,n=this;if(null===(t=this._timelineShowMenu)||void 0===t||t.kill(),"index"===e){var r=this._landscapeManager.active.activeStateIndex;return this._timelineHideMenu=new l.a.timeline,this._landscapeManager.active&&this._timelineHideMenu.call((function(){n._landscapeManager.active.dispatchEvent({type:"menu:close"})}),null,0),this._timelineHideMenu.to(this._postProcessing.passes.final.uniforms.uTransitionProgress,{duration:1.5,value:1,ease:"sine.inOut"},0),this._nuxtRoot.$store.getters["webgl/isLandscapeTransitionTriggered"]||this._nuxtRoot.$store.getters["webgl/isTheEndShowStarted"]?(this._timelineHideMenu.call((function(){n._landscapeManager.showNext(!0)}),null,1),this._timelineHideMenu.call((function(){n._landscapeManager.active&&n._landscapeManager.active.camera.activateMain(!0)}),null,1.51)):this._timelineHideMenu.call((function(){n._landscapeManager.active&&n._landscapeManager.active.camera.activateMain(!0)}),null,1.5),this._timelineHideMenu.call((function(){return n._postProcessing.passes.transition.changeLUT(r,!0)}),null,1),this._timelineHideMenu.call((function(){n._landscapeManager.active&&n._landscapeManager.active.dispatchEvent({type:"menu:closed",message:{route:e}})}),null,1.5),"index"===this._nuxtRoot.getRouteBaseName()&&this._timelineHideMenu.call((function(){return n._postProcessing.passes.lineRender.enable()}),null,1.52),this._timelineHideMenu.to(this._postProcessing.passes.final.uniforms.uTransitionProgress,{duration:1.75,value:0,ease:"sine.inOut"},1.52),this._timelineHideMenu}}},{key:"setDpr",value:function(e){this._viewDpr=e,this._resize()}},{key:"_bindHandlers",value:function(){this._resizeHandler=this._resizeHandler.bind(this),this._tickHandler=this._tickHandler.bind(this)}},{key:"_setupEventListeners",value:function(){C.a.addEventListener("resize",this._resizeHandler),l.a.ticker.add(this._tickHandler)}},{key:"_removeEventListeners",value:function(){C.a.removeEventListener("resize",this._resizeHandler),l.a.ticker.remove(this._tickHandler)}},{key:"_createStats",value:function(){var e=new d.a;return document.body.appendChild(e.dom),e}},{key:"_removeStats",value:function(){this._stats&&(document.body.removeChild(this._stats.dom),this._stats=null)}},{key:"_createStatsGpuPanel",value:function(){var e=new y(this._renderer.getContext());return this._stats.addPanel(e),this._stats.showPanel(3),e}},{key:"_createClock",value:function(){return new h.Clock}},{key:"_createRenderer",value:function(){var e=this,t=new h.WebGLRenderer({canvas:this._canvas,antialias:!1,powerPreference:"high-performance",depth:!0,stencil:!1}),n=new h.Color("#ffffff");t.setClearColor(n,1),t.autoClear=!1,t.toneMapping=h.NoToneMapping,t.toneMappingExposure=2.83,t.shadowMap.autoUpdate=!1,t.shadowMap.enabled=!0,t.shadowMap.type=h.PCFSoftShadowMap;var r=["NoToneMapping","LinearToneMapping","ReinhardToneMapping","CineonToneMapping","ACESFilmicToneMapping"],o={color:"#"+n.getHexString(),toneMapping:t.toneMapping};if(this._debugger){var l=this._debugger.addGroup("Renderer");l.add(o,"color",{onChange:function(){t.setClearColor(new h.Color(o.color),1)}}),l.add(o,"toneMapping",{options:r,onChange:function(){t.toneMapping=parseInt(r.indexOf(o.toneMapping)),t.compile(e._landscapeManager.active,e._landscapeManager.active.camera.active)}}),l.add(t,"toneMappingExposure",{min:0})}return t}},{key:"_createTextures",value:function(){var e=new h.Texture(x.d.get("ocean/moon-map-png"));e.encoding=h.sRGBEncoding,e.flipY=!0,e.needsUpdate=!0,yt.a["ocean/moon-map-png"]=e,this._renderer.initTexture(e);var t=new h.Texture(x.d.get("cave/corridor/light-map"));t.flipY=!1,t.encoding=h.sRGBEncoding,t.needsUpdate=!0,yt.a["cave/corridor/light-map"]=t,this._renderer.initTexture(t);var n=new h.Texture(x.d.get("cave/modern/light-map"));n.flipY=!1,n.encoding=h.sRGBEncoding,n.needsUpdate=!0,yt.a["cave/modern/light-map"]=n,this._renderer.initTexture(n);var r=new h.Texture(x.d.get("cave/decals-map"));r.flipY=!1,r.needsUpdate=!0,yt.a["cave/decals-map"]=r,this._renderer.initTexture(r)}},{key:"_createSceneRenderer",value:function(){return new U({renderer:this._renderer})}},{key:"_createPostProcessing",value:function(){return new _t({root:this,renderer:this._renderer,sceneRenderer:this._sceneRenderer,width:this._width,height:this._height})}},{key:"_createLandscapeManager",value:function(e){return new P({root:this,renderer:this._renderer,sceneRenderer:this._sceneRenderer,postProcessing:this._postProcessing,completeCallback:e})}},{key:"_createViewManager",value:function(){return new j({root:this,renderer:this._renderer,sceneRenderer:this._sceneRenderer,postProcessing:this._postProcessing})}},{key:"_update",value:function(){this._viewManager&&(this._stats&&this._stats.begin(),this._triggerBidelloUpdate(),this._render(),this._stats&&this._stats.end())}},{key:"_render",value:function(){var view=this._viewManager.active;this._statsGpuPanel&&this._statsGpuPanel.startQuery(),view&&view.render(),this._statsGpuPanel&&this._statsGpuPanel.endQuery()}},{key:"_triggerBidelloUpdate",value:function(){var e=this._clock.getDelta(),time=this._clock.getElapsedTime();c.b.trigger({name:"update",fireAtStart:!1},{delta:e,time:time})}},{key:"_resize",value:function(){this._width=C.a.width,this._height=C.a.height,this._dpr=this._viewDpr||1,this._renderScale=this._getRenderScale(),this._resizeCanvas(),this._resizeRenderer(),this._triggerBidelloResize()}},{key:"_getRenderScale",value:function(){return 1}},{key:"_resizeCanvas",value:function(){this._renderer.domElement.style.width="".concat(this._width,"px"),this._renderer.domElement.style.height="".concat(this._height,"px")}},{key:"_resizeRenderer",value:function(){this._renderer.setPixelRatio(this._dpr),this._renderer.setSize(this._width,this._height,!1)}},{key:"_triggerBidelloResize",value:function(){c.b.trigger({name:"resize",fireAtStart:!0},{width:this._width,height:this._height,dpr:this._dpr,renderScale:this._renderScale})}},{key:"_createDebugger",value:function(){var e=this;if(w.a){var t=w.a.addLayer("Main"),n=w.a.addGroup("States",{container:"Main"});return n.addButton("State 1",{fullWidth:!0,onClick:function(){e._landscapeManager.active.setState(0)}}),n.addButton("State 2",{fullWidth:!0,onClick:function(){e._landscapeManager.active.setState(1)}}),n.addButton("State 3",{fullWidth:!0,onClick:function(){e._landscapeManager.active.setState(2)}}),t}}},{key:"_removeDebugger",value:function(){this._debugger&&w.a.removeLayer("Main")}},{key:"_resizeHandler",value:function(){this._resize()}},{key:"_tickHandler",value:function(){this._update()}}]),e}();h.ShaderChunk.custom_fog_pars_vertex="#define GLSLIFY 1\n#ifdef USE_CUSTOM_FOG\n\n    #if defined(FOG_GROUND) || defined(FOG_COMBINED) || defined(FOG_USE_SUN) || defined(FOG_SIDES) || defined(FOG_RAVINE_LIGHT)\n        varying vec3 vFogWorldPosition;\n    #endif\n\n    #if defined(FOG_EXP)\n        varying float fogDepth;\n\n    #elif defined(FOG_EXP2)\n        varying float fogDepth;\n\n    #elif defined(FOG_LINEAR)\n        varying float fogDepth;\n\n    #elif defined(FOG_COMBINED)\n        varying float fogDepth;\n\n    #endif\n\n#endif\n",h.ShaderChunk.custom_fog_vertex="#define GLSLIFY 1\n#ifdef USE_CUSTOM_FOG\n\n    #if defined(FOG_GROUND) || defined(FOG_COMBINED) || defined(FOG_USE_SUN) || defined(FOG_SIDES) || defined(FOG_RAVINE_LIGHT)\n        #if defined(USE_INSTANCING)\n            vFogWorldPosition = (modelMatrix * instanceMatrix * vec4(position, 1.0)).xyz;\n        #else\n            vFogWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n        #endif\n    #endif\n\n    #if defined(FOG_EXP)\n        fogDepth = -mvPosition.z;\n\n    #elif defined(FOG_EXP2)\n        fogDepth = -mvPosition.z;\n\n    #elif defined(FOG_LINEAR)\n        fogDepth = -mvPosition.z;\n\n    #elif defined(FOG_COMBINED)\n        fogDepth = -mvPosition.z;\n\n    #endif\n\n#endif\n",h.ShaderChunk.custom_fog_pars_fragment="#define GLSLIFY 1\n#ifdef USE_CUSTOM_FOG\n\n    uniform float fogTime;\n    uniform vec3 fogColor;\n    uniform float fogGlobalStrength;\n    uniform float fogActive;\n\n    #if defined(FOG_GROUND) || defined(FOG_COMBINED) || defined(FOG_USE_SUN) || defined(FOG_SIDES) || defined(FOG_RAVINE_LIGHT)\n        varying vec3 vFogWorldPosition;\n    #endif\n\n    #if defined(FOG_EXP)\n        varying float fogDepth;\n\n        uniform float fogDensity;\n\n    #elif defined(FOG_EXP2)\n        varying float fogDepth;\n\n        uniform float fogDensity;\n\n    #elif defined(FOG_LINEAR)\n        varying float fogDepth;\n\n        uniform float fogNear;\n        uniform float fogFar;\n\n    #elif defined(FOG_GROUND)\n        uniform float fogHeight;\n        uniform float fogDensity;\n\n    #elif defined(FOG_COMBINED)\n        varying float fogDepth;\n\n        uniform float fogHeight;\n        uniform float fogDensity;\n        uniform float fogNear;\n        uniform float fogFar;\n\n    #endif\n\n    #if defined(FOG_ANIMATE)\n        uniform float fogAnimationScale;\n        uniform float fogAnimationSpeed;\n        uniform float fogAnimationDepth;\n    #endif\n\n    #if defined(FOG_USE_SUN)\n        uniform vec3 sunPosition;\n        uniform vec3 sunColor;\n        uniform float sunStrength;\n    #endif\n\n    #if defined(FOG_SIDES)\n        uniform float fogSideNear;\n        uniform float fogSideFar;\n    #endif\n\n    #if defined(FOG_RAVINE_LIGHT)\n        uniform vec3 ravineLightColor;\n        uniform vec3 ravineLightPosition;\n        uniform float ravineLightMaxDistance;\n        uniform float ravineLightDecay;\n        uniform float ravineLightIntensity;\n    #endif\n\n#endif\n",h.ShaderChunk.custom_fog_fragment="#define GLSLIFY 1\n#if defined(USE_CUSTOM_FOG)\n\n    #if defined(FOG_GROUND) || defined(FOG_COMBINED) || defined(FOG_USE_SUN)\n        vec3 fogRayDirection = normalize(vFogWorldPosition - cameraPosition);\n    #endif\n\n    vec3 fogColor = fogColor;\n\n    #if defined(FOG_EXP)\n        float fogFactor = 1.0 - exp(-fogDepth * fogDensity);\n\n    #elif defined(FOG_EXP2)\n        float fogFactor = 1.0 - exp(-fogDensity * fogDensity * fogDepth * fogDepth);\n\n    #elif defined(FOG_LINEAR)\n        float fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\n    #elif defined(FOG_GROUND)\n        float fogGroundDepth = distance(vFogWorldPosition, cameraPosition);\n        float fogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n\n    #elif defined(FOG_COMBINED)\n        float linearFogFactor = smoothstep(fogNear, fogFar, fogDepth);\n        float fogGroundDepth = distance(vFogWorldPosition, cameraPosition);\n\n        float groundFogFactor = clamp(fogDensity * exp(-cameraPosition.y * fogHeight) * (1.0 - exp(-fogGroundDepth * fogRayDirection.y * fogHeight)) / fogRayDirection.y, 0.0, 1.0);\n        float fogFactor = linearFogFactor + (1.0 - linearFogFactor) * groundFogFactor;\n\n    #endif\n\n    #if defined(FOG_USE_SUN)\n        vec3 sunDirection = normalize(sunPosition - cameraPosition);\n        float sunAmount = max(dot(fogRayDirection, sunDirection), 0.0);\n        fogColor = mix(fogColor, sunColor, pow(sunAmount, sunStrength));\n\n    #endif\n\n    #if defined(FOG_SIDES)\n        fogFactor += smoothstep(fogSideNear, fogSideFar, abs(vFogWorldPosition.x));\n        fogFactor = clamp(fogFactor, 0.0, 1.0);\n\n    #endif\n\n    #if defined(FOG_RAVINE_LIGHT)\n        float ff = 1.0- smoothstep(fogNear, fogFar, fogDepth);\n        float ravineLightDistance = distance(ravineLightPosition, vec3(0.0, vFogWorldPosition.y, 0.0));\n        float ravineLightStrength = pow(saturate(-ravineLightDistance / ravineLightMaxDistance + 1.0), ravineLightDecay) * ravineLightIntensity;\n        fogColor = mix(fogColor, ravineLightColor, ravineLightStrength * ff);\n\n    #endif\n\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor * fogActive);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogGlobalStrength * fogActive);\n\n#endif\n"}],[[364,24,7,25]]]);