import{F as ft,D as Rn,a9 as Un,aa as Bn,ab as ye,ac as jn,ad as Gn,ae as Ee,af as ze,ag as Re,ah as Ue,ai as mt,aj as Vn,_ as U,e as Be,ak as ue,al as qt,u as ae,am as Xn,J as Wn,a as _n,T as $n,an as Zn,ao as Hn,I as Xt,a2 as yt,ap as Yn,aq as qn,ar as oe,as as Kn,X as Wt,a8 as ut,at as Jn,au as ot,av as Qn,aw as tr,ax as er,ay as je,az as nr,aA as rr,aB as or,aC as ir,aD as Ge,aE as ar,aF as sr,aG as lr}from"./index.ff37fac8.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Ve={},he=function(r){return URL.createObjectURL(new Blob([r],{type:"text/javascript"}))},Ke=function(r){return new Worker(r)};try{URL.revokeObjectURL(he(""))}catch{he=function(r){return"data:application/javascript;charset=UTF-8,"+encodeURI(r)},Ke=function(r){return new Worker(r,{type:"module"})}}var cr=function(r,t,e,n,o){var i=Ke(Ve[t]||(Ve[t]=he(r)));return i.onerror=function(a){return o(a.error,null)},i.onmessage=function(a){return o(null,a.data)},i.postMessage(e,n),i},C=Uint8Array,G=Uint16Array,st=Uint32Array,Tt=new C([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dt=new C([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ft=new C([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Je=function(r,t){for(var e=new G(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var o=new st(e[30]),n=1;n<30;++n)for(var i=e[n];i<e[n+1];++i)o[i]=i-e[n]<<5|n;return[e,o]},Qe=Je(Tt,2),we=Qe[0],Kt=Qe[1];we[28]=258,Kt[258]=28;var tn=Je(Dt,0),en=tn[0],fe=tn[1],Et=new G(32768);for(var M=0;M<32768;++M){var ct=(M&43690)>>>1|(M&21845)<<1;ct=(ct&52428)>>>2|(ct&13107)<<2,ct=(ct&61680)>>>4|(ct&3855)<<4,Et[M]=((ct&65280)>>>8|(ct&255)<<8)>>>1}var J=function(r,t,e){for(var n=r.length,o=0,i=new G(t);o<n;++o)++i[r[o]-1];var a=new G(t);for(o=0;o<t;++o)a[o]=a[o-1]+i[o-1]<<1;var s;if(e){s=new G(1<<t);var l=15-t;for(o=0;o<n;++o)if(r[o])for(var c=o<<4|r[o],h=t-r[o],u=a[r[o]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)s[Et[u]>>>l]=c}else for(s=new G(n),o=0;o<n;++o)r[o]&&(s[o]=Et[a[r[o]-1]++]>>>15-r[o]);return s},lt=new C(288);for(var M=0;M<144;++M)lt[M]=8;for(var M=144;M<256;++M)lt[M]=9;for(var M=256;M<280;++M)lt[M]=7;for(var M=280;M<288;++M)lt[M]=8;var It=new C(32);for(var M=0;M<32;++M)It[M]=5;var nn=J(lt,9,0),rn=J(lt,9,1),on=J(It,5,0),an=J(It,5,1),Zt=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},K=function(r,t,e){var n=t/8|0;return(r[n]|r[n+1]<<8)>>(t&7)&e},Ht=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},Ut=function(r){return(r/8|0)+(r&7&&1)},Q=function(r,t,e){(t==null||t<0)&&(t=0),(e==null||e>r.length)&&(e=r.length);var n=new(r instanceof G?G:r instanceof st?st:C)(e-t);return n.set(r.subarray(t,e)),n},Bt=function(r,t,e){var n=r.length;if(!n||e&&!e.l&&n<5)return t||new C(0);var o=!t||e,i=!e||e.i;e||(e={}),t||(t=new C(n*3));var a=function(Vt){var Nt=t.length;if(Vt>Nt){var vt=new C(Math.max(Nt*2,Vt));vt.set(t),t=vt}},s=e.f||0,l=e.p||0,c=e.b||0,h=e.l,u=e.d,f=e.m,p=e.n,d=n*8;do{if(!h){e.f=s=K(r,l,1);var g=K(r,l+1,3);if(l+=3,g)if(g==1)h=rn,u=an,f=9,p=5;else if(g==2){var y=K(r,l,31)+257,k=K(r,l+10,15)+4,m=y+K(r,l+5,31)+1;l+=14;for(var v=new C(m),x=new C(19),I=0;I<k;++I)x[Ft[I]]=K(r,l+I*3,7);l+=k*3;for(var D=Zt(x),T=(1<<D)-1,w=J(x,D,1),I=0;I<m;){var N=w[K(r,l,T)];l+=N&15;var b=N>>>4;if(b<16)v[I++]=b;else{var F=0,P=0;for(b==16?(P=3+K(r,l,3),l+=2,F=v[I-1]):b==17?(P=3+K(r,l,7),l+=3):b==18&&(P=11+K(r,l,127),l+=7);P--;)v[I++]=F}}var S=v.subarray(0,y),L=v.subarray(y);f=Zt(S),p=Zt(L),h=J(S,f,1),u=J(L,p,1)}else throw"invalid block type";else{var b=Ut(l)+4,E=r[b-4]|r[b-3]<<8,R=b+E;if(R>n){if(i)throw"unexpected EOF";break}o&&a(c+E),t.set(r.subarray(b,R),c),e.b=c+=E,e.p=l=R*8;continue}if(l>d){if(i)throw"unexpected EOF";break}}o&&a(c+131072);for(var z=(1<<f)-1,X=(1<<p)-1,$=l;;$=l){var F=h[Ht(r,l)&z],q=F>>>4;if(l+=F&15,l>d){if(i)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(q<256)t[c++]=q;else if(q==256){$=l,h=null;break}else{var W=q-254;if(q>264){var I=q-257,et=Tt[I];W=K(r,l,(1<<et)-1)+we[I],l+=et}var nt=u[Ht(r,l)&X],Z=nt>>>4;if(!nt)throw"invalid distance";l+=nt&15;var L=en[Z];if(Z>3){var et=Dt[Z];L+=Ht(r,l)&(1<<et)-1,l+=et}if(l>d){if(i)throw"unexpected EOF";break}o&&a(c+131072);for(var V=c+W;c<V;c+=4)t[c]=t[c-L],t[c+1]=t[c+1-L],t[c+2]=t[c+2-L],t[c+3]=t[c+3-L];c=V}}e.l=h,e.p=$,e.b=c,h&&(s=1,e.m=f,e.d=u,e.n=p)}while(!s);return c==t.length?t:Q(t,0,c)},rt=function(r,t,e){e<<=t&7;var n=t/8|0;r[n]|=e,r[n+1]|=e>>>8},bt=function(r,t,e){e<<=t&7;var n=t/8|0;r[n]|=e,r[n+1]|=e>>>8,r[n+2]|=e>>>16},Yt=function(r,t){for(var e=[],n=0;n<r.length;++n)r[n]&&e.push({s:n,f:r[n]});var o=e.length,i=e.slice();if(!o)return[at,0];if(o==1){var a=new C(e[0].s+1);return a[e[0].s]=1,[a,1]}e.sort(function(I,D){return I.f-D.f}),e.push({s:-1,f:25001});var s=e[0],l=e[1],c=0,h=1,u=2;for(e[0]={s:-1,f:s.f+l.f,l:s,r:l};h!=o-1;)s=e[e[c].f<e[u].f?c++:u++],l=e[c!=h&&e[c].f<e[u].f?c++:u++],e[h++]={s:-1,f:s.f+l.f,l:s,r:l};for(var f=i[0].s,n=1;n<o;++n)i[n].s>f&&(f=i[n].s);var p=new G(f+1),d=Jt(e[h-1],p,0);if(d>t){var n=0,g=0,y=d-t,k=1<<y;for(i.sort(function(D,T){return p[T.s]-p[D.s]||D.f-T.f});n<o;++n){var m=i[n].s;if(p[m]>t)g+=k-(1<<d-p[m]),p[m]=t;else break}for(g>>>=y;g>0;){var v=i[n].s;p[v]<t?g-=1<<t-p[v]++-1:++n}for(;n>=0&&g;--n){var x=i[n].s;p[x]==t&&(--p[x],++g)}d=t}return[new C(p),d]},Jt=function(r,t,e){return r.s==-1?Math.max(Jt(r.l,t,e+1),Jt(r.r,t,e+1)):t[r.s]=e},pe=function(r){for(var t=r.length;t&&!r[--t];);for(var e=new G(++t),n=0,o=r[0],i=1,a=function(l){e[n++]=l},s=1;s<=t;++s)if(r[s]==o&&s!=t)++i;else{if(!o&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(o),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(o);i=1,o=r[s]}return[e.subarray(0,n),t]},xt=function(r,t){for(var e=0,n=0;n<t.length;++n)e+=r[n]*t[n];return e},St=function(r,t,e){var n=e.length,o=Ut(t+2);r[o]=n&255,r[o+1]=n>>>8,r[o+2]=r[o]^255,r[o+3]=r[o+1]^255;for(var i=0;i<n;++i)r[o+i+4]=e[i];return(o+4+n)*8},de=function(r,t,e,n,o,i,a,s,l,c,h){rt(t,h++,e),++o[256];for(var u=Yt(o,15),f=u[0],p=u[1],d=Yt(i,15),g=d[0],y=d[1],k=pe(f),m=k[0],v=k[1],x=pe(g),I=x[0],D=x[1],T=new G(19),w=0;w<m.length;++w)T[m[w]&31]++;for(var w=0;w<I.length;++w)T[I[w]&31]++;for(var N=Yt(T,7),b=N[0],F=N[1],P=19;P>4&&!b[Ft[P-1]];--P);var S=c+5<<3,L=xt(o,lt)+xt(i,It)+a,E=xt(o,f)+xt(i,g)+a+14+3*P+xt(T,b)+(2*T[16]+3*T[17]+7*T[18]);if(S<=L&&S<=E)return St(t,h,r.subarray(l,l+c));var R,z,X,$;if(rt(t,h,1+(E<L)),h+=2,E<L){R=J(f,p,0),z=f,X=J(g,y,0),$=g;var q=J(b,F,0);rt(t,h,v-257),rt(t,h+5,D-1),rt(t,h+10,P-4),h+=14;for(var w=0;w<P;++w)rt(t,h+3*w,b[Ft[w]]);h+=3*P;for(var W=[m,I],et=0;et<2;++et)for(var nt=W[et],w=0;w<nt.length;++w){var Z=nt[w]&31;rt(t,h,q[Z]),h+=b[Z],Z>15&&(rt(t,h,nt[w]>>>5&127),h+=nt[w]>>>12)}}else R=nn,z=lt,X=on,$=It;for(var w=0;w<s;++w)if(n[w]>255){var Z=n[w]>>>18&31;bt(t,h,R[Z+257]),h+=z[Z+257],Z>7&&(rt(t,h,n[w]>>>23&31),h+=Tt[Z]);var V=n[w]&31;bt(t,h,X[V]),h+=$[V],V>3&&(bt(t,h,n[w]>>>5&8191),h+=Dt[V])}else bt(t,h,R[n[w]]),h+=z[n[w]];return bt(t,h,R[256]),h+z[256]},sn=new st([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),at=new C(0),ln=function(r,t,e,n,o,i){var a=r.length,s=new C(n+a+5*(1+Math.ceil(a/7e3))+o),l=s.subarray(n,s.length-o),c=0;if(!t||a<8)for(var h=0;h<=a;h+=65535){var u=h+65535;u<a?c=St(l,c,r.subarray(h,u)):(l[h]=i,c=St(l,c,r.subarray(h,a)))}else{for(var f=sn[t-1],p=f>>>13,d=f&8191,g=(1<<e)-1,y=new G(32768),k=new G(g+1),m=Math.ceil(e/3),v=2*m,x=function(ie){return(r[ie]^r[ie+1]<<m^r[ie+2]<<v)&g},I=new st(25e3),D=new G(288),T=new G(32),w=0,N=0,h=0,b=0,F=0,P=0;h<a;++h){var S=x(h),L=h&32767,E=k[S];if(y[L]=E,k[S]=L,F<=h){var R=a-h;if((w>7e3||b>24576)&&R>423){c=de(r,l,0,I,D,T,N,b,P,h-P,c),b=w=N=0,P=h;for(var z=0;z<286;++z)D[z]=0;for(var z=0;z<30;++z)T[z]=0}var X=2,$=0,q=d,W=L-E&32767;if(R>2&&S==x(h-W))for(var et=Math.min(p,R)-1,nt=Math.min(32767,h),Z=Math.min(258,R);W<=nt&&--q&&L!=E;){if(r[h+X]==r[h+X-W]){for(var V=0;V<Z&&r[h+V]==r[h+V-W];++V);if(V>X){if(X=V,$=W,V>et)break;for(var Vt=Math.min(W,V-2),Nt=0,z=0;z<Vt;++z){var vt=h-W+z+32768&32767,zn=y[vt],Ne=vt-zn+32768&32767;Ne>Nt&&(Nt=Ne,E=vt)}}}L=E,E=y[L],W+=L-E+32768&32767}if($){I[b++]=268435456|Kt[X]<<18|fe[$];var Se=Kt[X]&31,Fe=fe[$]&31;N+=Tt[Se]+Dt[Fe],++D[257+Se],++T[Fe],F=h+X,++w}else I[b++]=r[h],++D[r[h]]}}c=de(r,l,i,I,D,T,N,b,P,h-P,c),!i&&c&7&&(c=St(l,c+1,at))}return Q(s,0,n+Ut(c)+o)},cn=function(){for(var r=new st(256),t=0;t<256;++t){for(var e=t,n=9;--n;)e=(e&1&&3988292384)^e>>>1;r[t]=e}return r}(),At=function(){var r=-1;return{p:function(t){for(var e=r,n=0;n<t.length;++n)e=cn[e&255^t[n]]^e>>>8;r=e},d:function(){return~r}}},be=function(){var r=1,t=0;return{p:function(e){for(var n=r,o=t,i=e.length,a=0;a!=i;){for(var s=Math.min(a+2655,i);a<s;++a)o+=n+=e[a];n=(n&65535)+15*(n>>16),o=(o&65535)+15*(o>>16)}r=n,t=o},d:function(){return r%=65521,t%=65521,(r&255)<<24|r>>>8<<16|(t&255)<<8|t>>>8}}},gt=function(r,t,e,n,o){return ln(r,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+t.mem,e,n,!o)},jt=function(r,t){var e={};for(var n in r)e[n]=r[n];for(var n in t)e[n]=t[n];return e},Xe=function(r,t,e){for(var n=r(),o=r.toString(),i=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var s=n[a],l=i[a];if(typeof s=="function"){t+=";"+l+"=";var c=s.toString();if(s.prototype)if(c.indexOf("[native code]")!=-1){var h=c.indexOf(" ",8)+1;t+=c.slice(h,c.indexOf("(",h))}else{t+=c;for(var u in s.prototype)t+=";"+l+".prototype."+u+"="+s.prototype[u].toString()}else t+=c}else e[l]=s}return[t,e]},_t=[],ur=function(r){var t=[];for(var e in r)(r[e]instanceof C||r[e]instanceof G||r[e]instanceof st)&&t.push((r[e]=new r[e].constructor(r[e])).buffer);return t},un=function(r,t,e,n){var o;if(!_t[e]){for(var i="",a={},s=r.length-1,l=0;l<s;++l)o=Xe(r[l],i,a),i=o[0],a=o[1];_t[e]=Xe(r[s],i,a)}var c=jt({},_t[e][1]);return cr(_t[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",e,c,ur(c),n)},Ct=function(){return[C,G,st,Tt,Dt,Ft,we,en,rn,an,Et,J,Zt,K,Ht,Ut,Q,Bt,Mt,dt,xe]},Lt=function(){return[C,G,st,Tt,Dt,Ft,Kt,fe,nn,lt,on,It,Et,sn,at,J,rt,bt,Yt,Jt,pe,xt,St,de,Ut,Q,ln,gt,Gt,dt]},hn=function(){return[Ie,Te,O,At,cn]},fn=function(){return[ke,gn]},pn=function(){return[De,O,be]},dn=function(){return[vn]},dt=function(r){return postMessage(r,[r.buffer])},xe=function(r){return r&&r.size&&new C(r.size)},Ot=function(r,t,e,n,o,i){var a=un(e,n,o,function(s,l){a.terminate(),i(s,l)});return a.postMessage([r,t],t.consume?[r.buffer]:[]),function(){a.terminate()}},tt=function(r){return r.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(t){return r.push(t.data[0],t.data[1])}},Pt=function(r,t,e,n,o){var i,a=un(r,n,o,function(s,l){s?(a.terminate(),t.ondata.call(t,s)):(l[1]&&a.terminate(),t.ondata.call(t,s,l[0],l[1]))});a.postMessage(e),t.push=function(s,l){if(i)throw"stream finished";if(!t.ondata)throw"no stream handler";a.postMessage([s,i=l],[s.buffer])},t.terminate=function(){a.terminate()}},_=function(r,t){return r[t]|r[t+1]<<8},j=function(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16|r[t+3]<<24)>>>0},se=function(r,t){return j(r,t)+j(r,t+4)*4294967296},O=function(r,t,e){for(;e;++t)r[t]=e,e>>>=8},Ie=function(r,t){var e=t.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=t.level<2?4:t.level==9?2:0,r[9]=3,t.mtime!=0&&O(r,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),e){r[3]=8;for(var n=0;n<=e.length;++n)r[n+10]=e.charCodeAt(n)}},ke=function(r){if(r[0]!=31||r[1]!=139||r[2]!=8)throw"invalid gzip data";var t=r[3],e=10;t&4&&(e+=r[10]|(r[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!r[e++]);return e+(t&2)},gn=function(r){var t=r.length;return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0},Te=function(r){return 10+(r.filename&&r.filename.length+1||0)},De=function(r,t){var e=t.level,n=e==0?0:e<6?1:e==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},vn=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Ae(r,t){return!t&&typeof r=="function"&&(t=r,r={}),this.ondata=t,r}var it=function(){function r(t,e){!e&&typeof t=="function"&&(e=t,t={}),this.ondata=e,this.o=t||{}}return r.prototype.p=function(t,e){this.ondata(gt(t,this.o,0,0,!e),e)},r.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},r}(),mn=function(){function r(t,e){Pt([Lt,function(){return[tt,it]}],this,Ae.call(this,t,e),function(n){var o=new it(n.data);onmessage=tt(o)},6)}return r}();function yn(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Ot(r,t,[Lt],function(n){return dt(Gt(n.data[0],n.data[1]))},0,e)}function Gt(r,t){return gt(r,t||{},0,0)}var Y=function(){function r(t){this.s={},this.p=new C(0),this.ondata=t}return r.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,n=new C(e+t.length);n.set(this.p),n.set(t,e),this.p=n},r.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,n=Bt(this.p,this.o,this.s);this.ondata(Q(n,e,this.s.b),this.d),this.o=Q(n,this.s.b-32768),this.s.b=this.o.length,this.p=Q(this.p,this.s.p/8|0),this.s.p&=7},r.prototype.push=function(t,e){this.e(t),this.c(e)},r}(),Ce=function(){function r(t){this.ondata=t,Pt([Ct,function(){return[tt,Y]}],this,0,function(){var e=new Y;onmessage=tt(e)},7)}return r}();function Le(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Ot(r,t,[Ct],function(n){return dt(Mt(n.data[0],xe(n.data[1])))},1,e)}function Mt(r,t){return Bt(r,t)}var Qt=function(){function r(t,e){this.c=At(),this.l=0,this.v=1,it.call(this,t,e)}return r.prototype.push=function(t,e){it.prototype.push.call(this,t,e)},r.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var n=gt(t,this.o,this.v&&Te(this.o),e&&8,!e);this.v&&(Ie(n,this.o),this.v=0),e&&(O(n,n.length-8,this.c.d()),O(n,n.length-4,this.l)),this.ondata(n,e)},r}(),We=function(){function r(t,e){Pt([Lt,hn,function(){return[tt,it,Qt]}],this,Ae.call(this,t,e),function(n){var o=new Qt(n.data);onmessage=tt(o)},8)}return r}();function _e(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Ot(r,t,[Lt,hn,function(){return[te]}],function(n){return dt(te(n.data[0],n.data[1]))},2,e)}function te(r,t){t||(t={});var e=At(),n=r.length;e.p(r);var o=gt(r,t,Te(t),8),i=o.length;return Ie(o,t),O(o,i-8,e.d()),O(o,i-4,n),o}var ee=function(){function r(t){this.v=1,Y.call(this,t)}return r.prototype.push=function(t,e){if(Y.prototype.e.call(this,t),this.v){var n=this.p.length>3?ke(this.p):4;if(n>=this.p.length&&!e)return;this.p=this.p.subarray(n),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Y.prototype.c.call(this,e)},r}(),wn=function(){function r(t){this.ondata=t,Pt([Ct,fn,function(){return[tt,Y,ee]}],this,0,function(){var e=new ee;onmessage=tt(e)},9)}return r}();function bn(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Ot(r,t,[Ct,fn,function(){return[ne]}],function(n){return dt(ne(n.data[0]))},3,e)}function ne(r,t){return Bt(r.subarray(ke(r),-8),t||new C(gn(r)))}var ge=function(){function r(t,e){this.c=be(),this.v=1,it.call(this,t,e)}return r.prototype.push=function(t,e){it.prototype.push.call(this,t,e)},r.prototype.p=function(t,e){this.c.p(t);var n=gt(t,this.o,this.v&&2,e&&4,!e);this.v&&(De(n,this.o),this.v=0),e&&O(n,n.length-4,this.c.d()),this.ondata(n,e)},r}(),hr=function(){function r(t,e){Pt([Lt,pn,function(){return[tt,it,ge]}],this,Ae.call(this,t,e),function(n){var o=new ge(n.data);onmessage=tt(o)},10)}return r}();function fr(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Ot(r,t,[Lt,pn,function(){return[ve]}],function(n){return dt(ve(n.data[0],n.data[1]))},4,e)}function ve(r,t){t||(t={});var e=be();e.p(r);var n=gt(r,t,2,4);return De(n,t),O(n,n.length-4,e.d()),n}var re=function(){function r(t){this.v=1,Y.call(this,t)}return r.prototype.push=function(t,e){if(Y.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Y.prototype.c.call(this,e)},r}(),xn=function(){function r(t){this.ondata=t,Pt([Ct,dn,function(){return[tt,Y,re]}],this,0,function(){var e=new re;onmessage=tt(e)},11)}return r}();function In(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Ot(r,t,[Ct,dn,function(){return[zt]}],function(n){return dt(zt(n.data[0],xe(n.data[1])))},5,e)}function zt(r,t){return Bt((vn(r),r.subarray(2,-4)),t)}var kn=function(){function r(t){this.G=ee,this.I=Y,this.Z=re,this.ondata=t}return r.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var n=new C(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var o=this,i=function(){o.ondata.apply(o,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(i):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,e),this.p=null}}},r}(),pr=function(){function r(t){this.G=wn,this.I=Ce,this.Z=xn,this.ondata=t}return r.prototype.push=function(t,e){kn.prototype.push.call(this,t,e)},r}();function dr(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return r[0]==31&&r[1]==139&&r[2]==8?bn(r,t,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Le(r,t,e):In(r,t,e)}function gr(r,t){return r[0]==31&&r[1]==139&&r[2]==8?ne(r,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Mt(r,t):zt(r,t)}var Oe=function(r,t,e,n){for(var o in r){var i=r[o],a=t+o;i instanceof C?e[a]=[i,n]:Array.isArray(i)?e[a]=[i[0],jt(n,i[1])]:Oe(i,a+"/",e,n)}},$e=typeof TextEncoder<"u"&&new TextEncoder,me=typeof TextDecoder<"u"&&new TextDecoder,Tn=0;try{me.decode(at,{stream:!0}),Tn=1}catch{}var Dn=function(r){for(var t="",e=0;;){var n=r[e++],o=(n>127)+(n>223)+(n>239);if(e+o>r.length)return[t,Q(r,e-1)];o?o==3?(n=((n&15)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):o&1?t+=String.fromCharCode((n&31)<<6|r[e++]&63):t+=String.fromCharCode((n&15)<<12|(r[e++]&63)<<6|r[e++]&63):t+=String.fromCharCode(n)}},vr=function(){function r(t){this.ondata=t,Tn?this.t=new TextDecoder:this.p=at}return r.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new C(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var o=Dn(n),i=o[0],a=o[1];if(e){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(i,e)},r}(),mr=function(){function r(t){this.ondata=t}return r.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(pt(t),this.d=e||!1)},r}();function pt(r,t){if(t){for(var e=new C(r.length),n=0;n<r.length;++n)e[n]=r.charCodeAt(n);return e}if($e)return $e.encode(r);for(var o=r.length,i=new C(r.length+(r.length>>1)),a=0,s=function(u){i[a++]=u},n=0;n<o;++n){if(a+5>i.length){var l=new C(a+8+(o-n<<1));l.set(i),i=l}var c=r.charCodeAt(n);c<128||t?s(c):c<2048?(s(192|c>>6),s(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|r.charCodeAt(++n)&1023,s(240|c>>18),s(128|c>>12&63),s(128|c>>6&63),s(128|c&63)):(s(224|c>>12),s(128|c>>6&63),s(128|c&63))}return Q(i,0,a)}function Pe(r,t){if(t){for(var e="",n=0;n<r.length;n+=16384)e+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return e}else{if(me)return me.decode(r);var o=Dn(r),i=o[0],a=o[1];if(a.length)throw"invalid utf-8 data";return i}}var An=function(r){return r==1?3:r<6?2:r==9?1:0},Cn=function(r,t){return t+30+_(r,t+26)+_(r,t+28)},Ln=function(r,t,e){var n=_(r,t+28),o=Pe(r.subarray(t+46,t+46+n),!(_(r,t+8)&2048)),i=t+46+n,a=j(r,t+20),s=e&&a==4294967295?On(r,i):[a,j(r,t+24),j(r,t+42)],l=s[0],c=s[1],h=s[2];return[_(r,t+10),l,c,o,i+_(r,t+30)+_(r,t+32),h]},On=function(r,t){for(;_(r,t)!=1;t+=4+_(r,t+2));return[se(r,t+12),se(r,t+4),se(r,t+20)]},ht=function(r){var t=0;if(r)for(var e in r){var n=r[e].length;if(n>65535)throw"extra field too long";t+=n+4}return t},kt=function(r,t,e,n,o,i,a,s){var l=n.length,c=e.extra,h=s&&s.length,u=ht(c);O(r,t,a!=null?33639248:67324752),t+=4,a!=null&&(r[t++]=20,r[t++]=e.os),r[t]=20,t+=2,r[t++]=e.flag<<1|(i==null&&8),r[t++]=o&&8,r[t++]=e.compression&255,r[t++]=e.compression>>8;var f=new Date(e.mtime==null?Date.now():e.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(O(r,t,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),t+=4,i!=null&&(O(r,t,e.crc),O(r,t+4,i),O(r,t+8,e.size)),O(r,t+12,l),O(r,t+14,u),t+=16,a!=null&&(O(r,t,h),O(r,t+6,e.attrs),O(r,t+10,a),t+=14),r.set(n,t),t+=l,u)for(var d in c){var g=c[d],y=g.length;O(r,t,+d),O(r,t+2,y),r.set(g,t+4),t+=4+y}return h&&(r.set(s,t),t+=h),t},Me=function(r,t,e,n,o){O(r,t,101010256),O(r,t+8,e),O(r,t+10,e),O(r,t+12,n),O(r,t+16,o)},Rt=function(){function r(t){this.filename=t,this.c=At(),this.size=0,this.compression=0}return r.prototype.process=function(t,e){this.ondata(null,t,e)},r.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},r}(),yr=function(){function r(t,e){var n=this;e||(e={}),Rt.call(this,t),this.d=new it(e,function(o,i){n.ondata(null,o,i)}),this.compression=8,this.flag=An(e.level)}return r.prototype.process=function(t,e){try{this.d.push(t,e)}catch(n){this.ondata(n,null,e)}},r.prototype.push=function(t,e){Rt.prototype.push.call(this,t,e)},r}(),wr=function(){function r(t,e){var n=this;e||(e={}),Rt.call(this,t),this.d=new mn(e,function(o,i,a){n.ondata(o,i,a)}),this.compression=8,this.flag=An(e.level),this.terminate=this.d.terminate}return r.prototype.process=function(t,e){this.d.push(t,e)},r.prototype.push=function(t,e){Rt.prototype.push.call(this,t,e)},r}(),br=function(){function r(t){this.ondata=t,this.u=[],this.d=1}return r.prototype.add=function(t){var e=this;if(this.d&2)throw"stream finished";var n=pt(t.filename),o=n.length,i=t.comment,a=i&&pt(i),s=o!=t.filename.length||a&&i.length!=a.length,l=o+ht(t.extra)+30;if(o>65535)throw"filename too long";var c=new C(l);kt(c,0,t,n,s);var h=[c],u=function(){for(var y=0,k=h;y<k.length;y++){var m=k[y];e.ondata(null,m,!1)}h=[]},f=this.d;this.d=0;var p=this.u.length,d=jt(t,{f:n,u:s,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(u(),f){var y=e.u[p+1];y?y.r():e.d=1}f=1}}),g=0;t.ondata=function(y,k,m){if(y)e.ondata(y,k,m),e.terminate();else if(g+=k.length,h.push(k),m){var v=new C(16);O(v,0,134695760),O(v,4,t.crc),O(v,8,g),O(v,12,t.size),h.push(v),d.c=g,d.b=l+g+16,d.crc=t.crc,d.size=t.size,f&&d.r(),f=1}else f&&u()},this.u.push(d)},r.prototype.end=function(){var t=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(t.d&1)||(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},r.prototype.e=function(){for(var t=0,e=0,n=0,o=0,i=this.u;o<i.length;o++){var a=i[o];n+=46+a.f.length+ht(a.extra)+(a.o?a.o.length:0)}for(var s=new C(n+22),l=0,c=this.u;l<c.length;l++){var a=c[l];kt(s,t,a,a.f,a.u,a.c,e,a.o),t+=46+a.f.length+ht(a.extra)+(a.o?a.o.length:0),e+=a.b}Me(s,t,this.u.length,n,e),this.ondata(null,s,!0),this.d=2},r.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++){var n=e[t];n.t()}this.d=2},r}();function xr(r,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";var n={};Oe(r,"",n,t);var o=Object.keys(n),i=o.length,a=0,s=0,l=i,c=new Array(i),h=[],u=function(){for(var g=0;g<h.length;++g)h[g]()},f=function(){var g=new C(s+22),y=a,k=s-a;s=0;for(var m=0;m<l;++m){var v=c[m];try{var x=v.c.length;kt(g,s,v,v.f,v.u,x);var I=30+v.f.length+ht(v.extra),D=s+I;g.set(v.c,D),kt(g,a,v,v.f,v.u,x,s,v.m),a+=16+I+(v.m?v.m.length:0),s=D+x}catch(T){return e(T,null)}}Me(g,a,c.length,k,y),e(null,g)};i||f();for(var p=function(g){var y=o[g],k=n[y],m=k[0],v=k[1],x=At(),I=m.length;x.p(m);var D=pt(y),T=D.length,w=v.comment,N=w&&pt(w),b=N&&N.length,F=ht(v.extra),P=v.level==0?0:8,S=function(L,E){if(L)u(),e(L,null);else{var R=E.length;c[g]=jt(v,{size:I,crc:x.d(),c:E,f:D,m:N,u:T!=y.length||N&&w.length!=b,compression:P}),a+=30+T+F+R,s+=76+2*(T+F)+(b||0)+R,--i||f()}};if(T>65535&&S("filename too long",null),!P)S(null,m);else if(I<16e4)try{S(null,Gt(m,v))}catch(L){S(L,null)}else h.push(yn(m,v,S))},d=0;d<l;++d)p(d);return u}function Ir(r,t){t||(t={});var e={},n=[];Oe(r,"",e,t);var o=0,i=0;for(var a in e){var s=e[a],l=s[0],c=s[1],h=c.level==0?0:8,u=pt(a),f=u.length,p=c.comment,d=p&&pt(p),g=d&&d.length,y=ht(c.extra);if(f>65535)throw"filename too long";var k=h?Gt(l,c):l,m=k.length,v=At();v.p(l),n.push(jt(c,{size:l.length,crc:v.d(),c:k,f:u,m:d,u:f!=a.length||d&&p.length!=g,o,compression:h})),o+=30+f+y+m,i+=76+2*(f+y)+(g||0)+m}for(var x=new C(i+22),I=o,D=i-o,T=0;T<n.length;++T){var u=n[T];kt(x,u.o,u,u.f,u.u,u.c.length);var w=30+u.f.length+ht(u.extra);x.set(u.c,u.o+w),kt(x,o,u,u.f,u.u,u.c.length,u.o,u.m),o+=16+w+(u.m?u.m.length:0)}return Me(x,o,n.length,D,I),x}var Pn=function(){function r(){}return r.prototype.push=function(t,e){this.ondata(null,t,e)},r.compression=0,r}(),kr=function(){function r(){var t=this;this.i=new Y(function(e,n){t.ondata(null,e,n)})}return r.prototype.push=function(t,e){try{this.i.push(t,e)}catch(n){this.ondata(n,t,e)}},r.compression=8,r}(),Tr=function(){function r(t,e){var n=this;e<32e4?this.i=new Y(function(o,i){n.ondata(null,o,i)}):(this.i=new Ce(function(o,i,a){n.ondata(o,i,a)}),this.terminate=this.i.terminate)}return r.prototype.push=function(t,e){this.i.terminate&&(t=Q(t,0)),this.i.push(t,e)},r.compression=8,r}(),Dr=function(){function r(t){this.onfile=t,this.k=[],this.o={0:Pn},this.p=at}return r.prototype.push=function(t,e){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var o=Math.min(this.c,t.length),i=t.subarray(0,o);if(this.c-=o,this.d?this.d.push(i,!this.c):this.k[0].push(i),t=t.subarray(o),t.length)return this.push(t,e)}else{var a=0,s=0,l=void 0,c=void 0;this.p.length?t.length?(c=new C(this.p.length+t.length),c.set(this.p),c.set(t,this.p.length)):c=this.p:c=t;for(var h=c.length,u=this.c,f=u&&this.d,p=function(){var k,m=j(c,s);if(m==67324752){a=1,l=s,d.d=null,d.c=0;var v=_(c,s+6),x=_(c,s+8),I=v&2048,D=v&8,T=_(c,s+26),w=_(c,s+28);if(h>s+30+T+w){var N=[];d.k.unshift(N),a=2;var b=j(c,s+18),F=j(c,s+22),P=Pe(c.subarray(s+30,s+=30+T),!I);b==4294967295?(k=D?[-2]:On(c,s),b=k[0],F=k[1]):D&&(b=-1),s+=w,d.c=b;var S,L={name:P,compression:x,start:function(){if(!L.ondata)throw"no callback";if(!b)L.ondata(null,at,!0);else{var E=n.o[x];if(!E)throw"unknown compression type "+x;S=b<0?new E(P):new E(P,b,F),S.ondata=function($,q,W){L.ondata($,q,W)};for(var R=0,z=N;R<z.length;R++){var X=z[R];S.push(X,!1)}n.k[0]==N&&n.c?n.d=S:S.push(at,!0)}},terminate:function(){S&&S.terminate&&S.terminate()}};b>=0&&(L.size=b,L.originalSize=F),d.onfile(L)}return"break"}else if(u){if(m==134695760)return l=s+=12+(u==-2&&8),a=3,d.c=0,"break";if(m==33639248)return l=s-=4,a=3,d.c=0,"break"}},d=this;s<h-4;++s){var g=p();if(g==="break")break}if(this.p=at,u<0){var y=a?c.subarray(0,l-12-(u==-2&&8)-(j(c,l-16)==134695760&&4)):c.subarray(0,s);f?f.push(y,!!a):this.k[+(a==2)].push(y)}if(a&2)return this.push(c.subarray(s),e);this.p=c.subarray(s)}if(e){if(this.c)throw"invalid zip file";this.p=null}},r.prototype.register=function(t){this.o[t.compression]=t},r}();function Ar(r,t){if(typeof t!="function")throw"no callback";for(var e=[],n=function(){for(var f=0;f<e.length;++f)e[f]()},o={},i=r.length-22;j(r,i)!=101010256;--i)if(!i||r.length-i>65558){t("invalid zip file",null);return}var a=_(r,i+8);a||t(null,{});var s=a,l=j(r,i+16),c=l==4294967295;if(c){if(i=j(r,i-12),j(r,i)!=101075792){t("invalid zip file",null);return}s=a=j(r,i+32),l=j(r,i+48)}for(var h=function(f){var p=Ln(r,l,c),d=p[0],g=p[1],y=p[2],k=p[3],m=p[4],v=p[5],x=Cn(r,v);l=m;var I=function(T,w){T?(n(),t(T,null)):(o[k]=w,--a||t(null,o))};if(!d)I(null,Q(r,x,x+g));else if(d==8){var D=r.subarray(x,x+g);if(g<32e4)try{I(null,Mt(D,new C(y)))}catch(T){I(T,null)}else e.push(Le(D,{size:y},I))}else I("unknown compression type "+d,null)},u=0;u<s;++u)h();return n}function Cr(r){for(var t={},e=r.length-22;j(r,e)!=101010256;--e)if(!e||r.length-e>65558)throw"invalid zip file";var n=_(r,e+8);if(!n)return{};var o=j(r,e+16),i=o==4294967295;if(i){if(e=j(r,e-12),j(r,e)!=101075792)throw"invalid zip file";n=j(r,e+32),o=j(r,e+48)}for(var a=0;a<n;++a){var s=Ln(r,o,i),l=s[0],c=s[1],h=s[2],u=s[3],f=s[4],p=s[5],d=Cn(r,p);if(o=f,!l)t[u]=Q(r,d,d+c);else if(l==8)t[u]=Mt(r.subarray(d,d+c),new C(h));else throw"unknown compression type "+l}return t}const Lr=Object.freeze(Object.defineProperty({__proto__:null,Deflate:it,AsyncDeflate:mn,deflate:yn,deflateSync:Gt,Inflate:Y,AsyncInflate:Ce,inflate:Le,inflateSync:Mt,Gzip:Qt,AsyncGzip:We,gzip:_e,gzipSync:te,Gunzip:ee,AsyncGunzip:wn,gunzip:bn,gunzipSync:ne,Zlib:ge,AsyncZlib:hr,zlib:fr,zlibSync:ve,Unzlib:re,AsyncUnzlib:xn,unzlib:In,unzlibSync:zt,compress:_e,AsyncCompress:We,compressSync:te,Compress:Qt,Decompress:kn,AsyncDecompress:pr,decompress:dr,decompressSync:gr,DecodeUTF8:vr,EncodeUTF8:mr,strToU8:pt,strFromU8:Pe,ZipPassThrough:Rt,ZipDeflate:yr,AsyncZipDeflate:wr,Zip:br,zip:xr,zipSync:Ir,UnzipPassThrough:Pn,UnzipInflate:kr,AsyncUnzipInflate:Tr,Unzip:Dr,unzip:Ar,unzipSync:Cr},Symbol.toStringTag,{value:"Module"}));function Mn(r,t,e){const n=e.length-r-1;if(t>=e[n])return n-1;if(t<=e[r])return r;let o=r,i=n,a=Math.floor((o+i)/2);for(;t<e[a]||t>=e[a+1];)t<e[a]?i=a:o=a,a=Math.floor((o+i)/2);return a}function Or(r,t,e,n){const o=[],i=[],a=[];o[0]=1;for(let s=1;s<=e;++s){i[s]=t-n[r+1-s],a[s]=n[r+s]-t;let l=0;for(let c=0;c<s;++c){const h=a[c+1],u=i[s-c],f=o[c]/(h+u);o[c]=l+h*f,l=u*f}o[s]=l}return o}function Pr(r,t,e,n){const o=Mn(r,n,t),i=Or(o,n,r,t),a=new oe(0,0,0,0);for(let s=0;s<=r;++s){const l=e[o-r+s],c=i[s],h=l.w*c;a.x+=l.x*h,a.y+=l.y*h,a.z+=l.z*h,a.w+=l.w*c}return a}function Mr(r,t,e,n,o){const i=[];for(let u=0;u<=e;++u)i[u]=0;const a=[];for(let u=0;u<=n;++u)a[u]=i.slice(0);const s=[];for(let u=0;u<=e;++u)s[u]=i.slice(0);s[0][0]=1;const l=i.slice(0),c=i.slice(0);for(let u=1;u<=e;++u){l[u]=t-o[r+1-u],c[u]=o[r+u]-t;let f=0;for(let p=0;p<u;++p){const d=c[p+1],g=l[u-p];s[u][p]=d+g;const y=s[p][u-1]/s[u][p];s[p][u]=f+d*y,f=g*y}s[u][u]=f}for(let u=0;u<=e;++u)a[0][u]=s[u][e];for(let u=0;u<=e;++u){let f=0,p=1;const d=[];for(let g=0;g<=e;++g)d[g]=i.slice(0);d[0][0]=1;for(let g=1;g<=n;++g){let y=0;const k=u-g,m=e-g;u>=g&&(d[p][0]=d[f][0]/s[m+1][k],y=d[p][0]*s[k][m]);const v=k>=-1?1:-k,x=u-1<=m?g-1:e-u;for(let D=v;D<=x;++D)d[p][D]=(d[f][D]-d[f][D-1])/s[m+1][k+D],y+=d[p][D]*s[k+D][m];u<=m&&(d[p][g]=-d[f][g-1]/s[m+1][u],y+=d[p][g]*s[u][m]),a[g][u]=y;const I=f;f=p,p=I}}let h=e;for(let u=1;u<=n;++u){for(let f=0;f<=e;++f)a[u][f]*=h;h*=e-u}return a}function Nr(r,t,e,n,o){const i=o<r?o:r,a=[],s=Mn(r,n,t),l=Mr(s,n,r,i,t),c=[];for(let h=0;h<e.length;++h){const u=e[h].clone(),f=u.w;u.x*=f,u.y*=f,u.z*=f,c[h]=u}for(let h=0;h<=i;++h){const u=c[s-r].clone().multiplyScalar(l[h][0]);for(let f=1;f<=r;++f)u.add(c[s-r+f].clone().multiplyScalar(l[h][f]));a[h]=u}for(let h=i+1;h<=o+1;++h)a[h]=new oe(0,0,0);return a}function Sr(r,t){let e=1;for(let o=2;o<=r;++o)e*=o;let n=1;for(let o=2;o<=t;++o)n*=o;for(let o=2;o<=r-t;++o)n*=o;return e/n}function Fr(r){const t=r.length,e=[],n=[];for(let i=0;i<t;++i){const a=r[i];e[i]=new ft(a.x,a.y,a.z),n[i]=a.w}const o=[];for(let i=0;i<t;++i){const a=e[i].clone();for(let s=1;s<=i;++s)a.sub(o[i-s].clone().multiplyScalar(Sr(i,s)*n[s]));o[i]=a.divideScalar(n[0])}return o}function Er(r,t,e,n,o){const i=Nr(r,t,e,n,o);return Fr(i)}class Ze extends rr{constructor(t,e,n,o,i){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=o||0,this.endKnot=i||this.knots.length-1;for(let a=0;a<n.length;++a){const s=n[a];this.controlPoints[a]=new oe(s.x,s.y,s.z,s.w)}}getPoint(t,e=new ft){const n=e,o=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=Pr(this.degree,this.knots,this.controlPoints,o);return i.w!==1&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(t,e=new ft){const n=e,o=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=Er(this.degree,this.knots,this.controlPoints,o,1);return n.copy(i[1]).normalize(),n}}let A,B,H;class zr extends Bn{constructor(t){super(t)}load(t,e,n,o){const i=this,a=i.path===""?ye.extractUrlBase(t):i.path,s=new jn(this.manager);s.setPath(i.path),s.setResponseType("arraybuffer"),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,function(l){try{e(i.parse(l,a))}catch(c){o?o(c):console.error(c),i.manager.itemError(t)}},n,o)}parse(t,e){if(Vr(t))A=new Gr().parse(t);else{const o=En(t);if(!Xr(o))throw new Error("FBXLoader: Unknown format.");if(Ye(o)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+Ye(o));A=new jr().parse(o)}const n=new Gn(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new Rr(n,this.manager).parse(A)}}class Rr{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){B=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),o=this.parseDeformers(),i=new Ur().parse(o);return this.parseScene(o,i,n),H}parseConnections(){const t=new Map;return"Connections"in A&&A.Connections.connections.forEach(function(e){const n=e[0],o=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const a={ID:o,relationship:i};t.get(n).parents.push(a),t.has(o)||t.set(o,{parents:[],children:[]});const s={ID:n,relationship:i};t.get(o).children.push(s)}),t}parseImages(){const t={},e={};if("Video"in A.Objects){const n=A.Objects.Video;for(const o in n){const i=n[o],a=parseInt(o);if(t[a]=i.RelativeFilename||i.Filename,"Content"in i){const s=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,l=typeof i.Content=="string"&&i.Content!=="";if(s||l){const c=this.parseImage(n[o]);e[i.RelativeFilename||i.Filename]=c}}}}for(const n in t){const o=t[n];e[o]!==void 0?t[n]=e[o]:t[n]=t[n].split("\\").pop()}return t}parseImage(t){const e=t.Content,n=t.RelativeFilename||t.Filename,o=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(o){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:console.warn('FBXLoader: Image type "'+o+'" is not supported.');return}if(typeof e=="string")return"data:"+i+";base64,"+e;{const a=new Uint8Array(e);return window.URL.createObjectURL(new Blob([a],{type:i}))}}parseTextures(t){const e=new Map;if("Texture"in A.Objects){const n=A.Objects.Texture;for(const o in n){const i=this.parseTexture(n[o],t);e.set(parseInt(o),i)}}return e}parseTexture(t,e){const n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;const o=t.WrapModeU,i=t.WrapModeV,a=o!==void 0?o.value:0,s=i!==void 0?i.value:0;if(n.wrapS=a===0?Ee:ze,n.wrapT=s===0?Ee:ze,"Scaling"in t){const l=t.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in t){const l=t.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(t,e){let n;const o=this.textureLoader.path,i=B.get(t.id).children;i!==void 0&&i.length>0&&e[i[0].ID]!==void 0&&(n=e[i[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const s=t.FileName.slice(-3).toLowerCase();if(s==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),a=new Re):(l.setPath(this.textureLoader.path),a=l.load(n))}else s==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),a=new Re):a=this.textureLoader.load(n);return this.textureLoader.setPath(o),a}parseMaterials(t){const e=new Map;if("Material"in A.Objects){const n=A.Objects.Material;for(const o in n){const i=this.parseMaterial(n[o],t);i!==null&&e.set(parseInt(o),i)}}return e}parseMaterial(t,e){const n=t.id,o=t.attrName;let i=t.ShadingModel;if(typeof i=="object"&&(i=i.value),!B.has(n))return null;const a=this.parseParameters(t,e,n),s=new Ue;return s.setValues(a),s.name=o,s}parseParameters(t,e,n){const o={};t.BumpFactor&&(o.bumpScale=t.BumpFactor.value),t.Diffuse?o.color=new mt().fromArray(t.Diffuse.value):t.DiffuseColor&&(t.DiffuseColor.type==="Color"||t.DiffuseColor.type==="ColorRGB")&&(o.color=new mt().fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value),t.Emissive?o.emissive=new mt().fromArray(t.Emissive.value):t.EmissiveColor&&(t.EmissiveColor.type==="Color"||t.EmissiveColor.type==="ColorRGB")&&(o.emissive=new mt().fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(o.opacity=parseFloat(t.Opacity.value)),o.opacity<1&&(o.transparent=!0);const i=this;return B.get(n).children.forEach(function(a){const s=a.relationship;switch(s){case"Bump":o.bumpMap=i.getTexture(e,a.ID);break;case"Maya|TEX_ao_map":o.aoMap=i.getTexture(e,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=i.getTexture(e,a.ID);break;case"DisplacementColor":o.displacementMap=i.getTexture(e,a.ID);break;case"EmissiveColor":o.emissiveMap=i.getTexture(e,a.ID);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=i.getTexture(e,a.ID);break;case"ReflectionColor":o.envMap=i.getTexture(e,a.ID),o.envMap!==void 0&&(o.envMap.mapping=Vn);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=i.getTexture(e,a.ID),o.transparent=!0;break;case"AmbientColor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported, skipping texture.",s);break}}),o}getTexture(t,e){return"LayeredTexture"in A.Objects&&e in A.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported. Discarding all but first layer."),e=B.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in A.Objects){const n=A.Objects.Deformer;for(const o in n){const i=n[o],a=B.get(parseInt(o));if(i.attrType==="Skin"){const s=this.parseSkeleton(a,n);s.ID=o,a.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),s.geometryID=a.parents[0].ID,t[o]=s}else if(i.attrType==="BlendShape"){const s={id:o};s.rawTargets=this.parseMorphTargets(a,n),s.id=o,a.parents.length>1&&console.warn("FBXLoader: morph target attached to more than one geometry is not supported."),e[o]=s}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const n=[];return t.children.forEach(function(o){const i=e[o.ID];if(i.attrType!=="Cluster")return;const a={ID:o.ID,indices:[],weights:[],transformLink:new U().fromArray(i.TransformLink.a)};"Indexes"in i&&(a.indices=i.Indexes.a,a.weights=i.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(t,e){const n=[];for(let o=0;o<t.children.length;o++){const i=t.children[o],a=e[i.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;s.geoID=B.get(parseInt(i.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(s)}return n}parseScene(t,e,n){H=new Be;const o=this.parseModels(t.skeletons,e,n),i=A.Objects.Model,a=this;o.forEach(function(l){const c=i[l.ID];a.setLookAtProperties(l,c),B.get(l.ID).parents.forEach(function(h){const u=o.get(h.ID);u!==void 0&&u.add(l)}),l.parent===null&&H.add(l)}),this.bindSkeleton(t.skeletons,e,o),this.createAmbientLight(),H.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=Sn(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const s=new Br().parse();H.children.length===1&&H.children[0].isGroup&&(H.children[0].animations=s,H=H.children[0]),H.animations=s}parseModels(t,e,n){const o=new Map,i=A.Objects.Model;for(const a in i){const s=parseInt(a),l=i[a],c=B.get(s);let h=this.buildSkeleton(c,t,s,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,e,n);break;case"NurbsCurve":h=this.createCurve(c,e);break;case"LimbNode":case"Root":h=new ue;break;case"Null":default:h=new Be;break}h.name=l.attrName?qt.sanitizeNodeName(l.attrName):"",h.ID=s}this.getTransformData(h,l),o.set(s,h)}return o}buildSkeleton(t,e,n,o){let i=null;return t.parents.forEach(function(a){for(const s in e){const l=e[s];l.rawBones.forEach(function(c,h){if(c.ID===a.ID){const u=i;i=new ue,i.matrixWorld.copy(c.transformLink),i.name=o?qt.sanitizeNodeName(o):"",i.ID=n,l.bones[h]=i,u!==null&&i.add(u)}})}}),i}createCamera(t){let e,n;if(t.children.forEach(function(o){const i=A.Objects.NodeAttribute[o.ID];i!==void 0&&(n=i)}),n===void 0)e=new ae;else{let o=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(o=1);let i=1;n.NearPlane!==void 0&&(i=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let s=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(s=n.AspectWidth.value,l=n.AspectHeight.value);const c=s/l;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(o){case 0:e=new ir(h,c,i,a),u!==null&&e.setFocalLength(u);break;case 1:e=new or(-s/2,s/2,l/2,-l/2,i,a);break;default:console.warn("FBXLoader: Unknown camera type "+o+"."),e=new ae;break}}return e}createLight(t){let e,n;if(t.children.forEach(function(o){const i=A.Objects.NodeAttribute[o.ID];i!==void 0&&(n=i)}),n===void 0)e=new ae;else{let o;n.LightType===void 0?o=0:o=n.LightType.value;let i=16777215;n.Color!==void 0&&(i=new mt().fromArray(n.Color.value));let a=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(a=0);let s=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?s=0:s=n.FarAttenuationEnd.value);const l=1;switch(o){case 0:e=new Ge(i,a,s,l);break;case 1:e=new sr(i,a);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=ot.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=ot.degToRad(n.OuterAngle.value),h=Math.max(h,1)),e=new ar(i,a,s,c,h,l);break;default:console.warn("FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),e=new Ge(i,a);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(e.castShadow=!0)}return e}createMesh(t,e,n){let o,i=null,a=null;const s=[];return t.children.forEach(function(l){e.has(l.ID)&&(i=e.get(l.ID)),n.has(l.ID)&&s.push(n.get(l.ID))}),s.length>1?a=s:s.length>0?a=s[0]:(a=new Ue({color:13421772}),s.push(a)),"color"in i.attributes&&s.forEach(function(l){l.vertexColors=!0}),i.FBX_Deformer?(o=new Xn(i,a),o.normalizeSkinWeights()):o=new Wn(i,a),o}createCurve(t,e){const n=t.children.reduce(function(i,a){return e.has(a.ID)&&(i=e.get(a.ID)),i},null),o=new _n({color:3342591,linewidth:1});return new $n(n,o)}getTransformData(t,e){const n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),"RotationOrder"in e?n.eulerOrder=Fn(e.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}setLookAtProperties(t,e){"LookAtProperty"in e&&B.get(t.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const o=A.Objects.Model[n.ID];if("Lcl_Translation"in o){const i=o.Lcl_Translation.value;t.target!==void 0?(t.target.position.fromArray(i),H.add(t.target)):t.lookAt(new ft().fromArray(i))}}})}bindSkeleton(t,e,n){const o=this.parsePoseNodes();for(const i in t){const a=t[i];B.get(parseInt(a.ID)).parents.forEach(function(s){if(e.has(s.ID)){const l=s.ID;B.get(l).parents.forEach(function(c){n.has(c.ID)&&n.get(c.ID).bind(new Zn(a.bones),o[c.ID])})}})}}parsePoseNodes(){const t={};if("Pose"in A.Objects){const e=A.Objects.Pose;for(const n in e)if(e[n].attrType==="BindPose"&&e[n].NbPoseNodes>0){const o=e[n].PoseNode;Array.isArray(o)?o.forEach(function(i){t[i.Node]=new U().fromArray(i.Matrix.a)}):t[o.Node]=new U().fromArray(o.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in A&&"AmbientColor"in A.GlobalSettings){const t=A.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],o=t[2];if(e!==0||n!==0||o!==0){const i=new mt(e,n,o);H.add(new Hn(i,1))}}}}class Ur{parse(t){const e=new Map;if("Geometry"in A.Objects){const n=A.Objects.Geometry;for(const o in n){const i=B.get(parseInt(o)),a=this.parseGeometry(i,n[o],t);e.set(parseInt(o),a)}}return e}parseGeometry(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,n){const o=n.skeletons,i=[],a=t.parents.map(function(u){return A.Objects.Model[u.ID]});if(a.length===0)return;const s=t.children.reduce(function(u,f){return o[f.ID]!==void 0&&(u=o[f.ID]),u},null);t.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&i.push(n.morphTargets[u.ID])});const l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=Fn(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=Sn(c);return this.genGeometry(e,s,i,h)}genGeometry(t,e,n,o){const i=new Xt;t.attrName&&(i.name=t.attrName);const a=this.parseGeoNode(t,e),s=this.genBuffers(a),l=new yt(s.vertex,3);if(l.applyMatrix4(o),i.setAttribute("position",l),s.colors.length>0&&i.setAttribute("color",new yt(s.colors,3)),e&&(i.setAttribute("skinIndex",new Yn(s.weightsIndices,4)),i.setAttribute("skinWeight",new yt(s.vertexWeights,4)),i.FBX_Deformer=e),s.normal.length>0){const c=new qn().getNormalMatrix(o),h=new yt(s.normal,3);h.applyNormalMatrix(c),i.setAttribute("normal",h)}if(s.uvs.forEach(function(c,h){let u="uv"+(h+1).toString();h===0&&(u="uv"),i.setAttribute(u,new yt(s.uvs[h],2))}),a.material&&a.material.mappingType!=="AllSame"){let c=s.materialIndex[0],h=0;if(s.materialIndex.forEach(function(u,f){u!==c&&(i.addGroup(h,f-h,c),c=u,h=f)}),i.groups.length>0){const u=i.groups[i.groups.length-1],f=u.start+u.count;f!==s.materialIndex.length&&i.addGroup(f,s.materialIndex.length-f,c)}i.groups.length===0&&i.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(i,t,n,o),i}parseGeoNode(t,e){const n={};if(n.vertexPositions=t.Vertices!==void 0?t.Vertices.a:[],n.vertexIndices=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];let o=0;for(;t.LayerElementUV[o];)t.LayerElementUV[o].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[o])),o++}return n.weightTable={},e!==null&&(n.skeleton=e,e.rawBones.forEach(function(o,i){o.indices.forEach(function(a,s){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:i,weight:o.weights[s]})})})),n}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,o=0,i=!1,a=[],s=[],l=[],c=[],h=[],u=[];const f=this;return t.vertexIndices.forEach(function(p,d){let g,y=!1;p<0&&(p=p^-1,y=!0);let k=[],m=[];if(a.push(p*3,p*3+1,p*3+2),t.color){const v=$t(d,n,p,t.color);l.push(v[0],v[1],v[2])}if(t.skeleton){if(t.weightTable[p]!==void 0&&t.weightTable[p].forEach(function(v){m.push(v.weight),k.push(v.id)}),m.length>4){i||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const v=[0,0,0,0],x=[0,0,0,0];m.forEach(function(I,D){let T=I,w=k[D];x.forEach(function(N,b,F){if(T>N){F[b]=T,T=N;const P=v[b];v[b]=w,w=P}})}),k=v,m=x}for(;m.length<4;)m.push(0),k.push(0);for(let v=0;v<4;++v)h.push(m[v]),u.push(k[v])}if(t.normal){const v=$t(d,n,p,t.normal);s.push(v[0],v[1],v[2])}t.material&&t.material.mappingType!=="AllSame"&&(g=$t(d,n,p,t.material)[0],g<0&&(console.warn("FBXLoader: Invalid material index:",g),g=0)),t.uv&&t.uv.forEach(function(v,x){const I=$t(d,n,p,v);c[x]===void 0&&(c[x]=[]),c[x].push(I[0]),c[x].push(I[1])}),o++,y&&(f.genFace(e,t,a,g,s,l,c,h,u,o),n++,o=0,a=[],s=[],l=[],c=[],h=[],u=[])}),e}genFace(t,e,n,o,i,a,s,l,c,h){for(let u=2;u<h;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[(u-1)*3]]),t.vertex.push(e.vertexPositions[n[(u-1)*3+1]]),t.vertex.push(e.vertexPositions[n[(u-1)*3+2]]),t.vertex.push(e.vertexPositions[n[u*3]]),t.vertex.push(e.vertexPositions[n[u*3+1]]),t.vertex.push(e.vertexPositions[n[u*3+2]]),e.skeleton&&(t.vertexWeights.push(l[0]),t.vertexWeights.push(l[1]),t.vertexWeights.push(l[2]),t.vertexWeights.push(l[3]),t.vertexWeights.push(l[(u-1)*4]),t.vertexWeights.push(l[(u-1)*4+1]),t.vertexWeights.push(l[(u-1)*4+2]),t.vertexWeights.push(l[(u-1)*4+3]),t.vertexWeights.push(l[u*4]),t.vertexWeights.push(l[u*4+1]),t.vertexWeights.push(l[u*4+2]),t.vertexWeights.push(l[u*4+3]),t.weightsIndices.push(c[0]),t.weightsIndices.push(c[1]),t.weightsIndices.push(c[2]),t.weightsIndices.push(c[3]),t.weightsIndices.push(c[(u-1)*4]),t.weightsIndices.push(c[(u-1)*4+1]),t.weightsIndices.push(c[(u-1)*4+2]),t.weightsIndices.push(c[(u-1)*4+3]),t.weightsIndices.push(c[u*4]),t.weightsIndices.push(c[u*4+1]),t.weightsIndices.push(c[u*4+2]),t.weightsIndices.push(c[u*4+3])),e.color&&(t.colors.push(a[0]),t.colors.push(a[1]),t.colors.push(a[2]),t.colors.push(a[(u-1)*3]),t.colors.push(a[(u-1)*3+1]),t.colors.push(a[(u-1)*3+2]),t.colors.push(a[u*3]),t.colors.push(a[u*3+1]),t.colors.push(a[u*3+2])),e.material&&e.material.mappingType!=="AllSame"&&(t.materialIndex.push(o),t.materialIndex.push(o),t.materialIndex.push(o)),e.normal&&(t.normal.push(i[0]),t.normal.push(i[1]),t.normal.push(i[2]),t.normal.push(i[(u-1)*3]),t.normal.push(i[(u-1)*3+1]),t.normal.push(i[(u-1)*3+2]),t.normal.push(i[u*3]),t.normal.push(i[u*3+1]),t.normal.push(i[u*3+2])),e.uv&&e.uv.forEach(function(f,p){t.uvs[p]===void 0&&(t.uvs[p]=[]),t.uvs[p].push(s[p][0]),t.uvs[p].push(s[p][1]),t.uvs[p].push(s[p][(u-1)*2]),t.uvs[p].push(s[p][(u-1)*2+1]),t.uvs[p].push(s[p][u*2]),t.uvs[p].push(s[p][u*2+1])})}addMorphTargets(t,e,n,o){if(n.length===0)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const i=this;n.forEach(function(a){a.rawTargets.forEach(function(s){const l=A.Objects.Geometry[s.geoID];l!==void 0&&i.genMorphGeometry(t,e,l,o,s.name)})})}genMorphGeometry(t,e,n,o,i){const a=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],s=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=t.attributes.position.count*3,h=new Float32Array(c);for(let d=0;d<l.length;d++){const g=l[d]*3;h[g]=s[d*3],h[g+1]=s[d*3+1],h[g+2]=s[d*3+2]}const u={vertexIndices:a,vertexPositions:h},f=this.genBuffers(u),p=new yt(f.vertex,3);p.name=i||n.attrName,p.applyMatrix4(o),t.morphAttributes.position.push(p)}parseNormals(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,o=t.Normals.a;let i=[];return n==="IndexToDirect"&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:o,indices:i,mappingType:e,referenceType:n}}parseUVs(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,o=t.UV.a;let i=[];return n==="IndexToDirect"&&(i=t.UVIndex.a),{dataSize:2,buffer:o,indices:i,mappingType:e,referenceType:n}}parseVertexColors(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,o=t.Colors.a;let i=[];return n==="IndexToDirect"&&(i=t.ColorIndex.a),{dataSize:4,buffer:o,indices:i,mappingType:e,referenceType:n}}parseMaterialIndices(t){const e=t.MappingInformationType,n=t.ReferenceInformationType;if(e==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const o=t.Materials.a,i=[];for(let a=0;a<o.length;++a)i.push(a);return{dataSize:1,buffer:o,indices:i,mappingType:e,referenceType:n}}parseNurbsGeometry(t){if(Ze===void 0)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Xt;const e=parseInt(t.Order);if(isNaN(e))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Xt;const n=e-1,o=t.KnotVector.a,i=[],a=t.Points.a;for(let h=0,u=a.length;h<u;h+=4)i.push(new oe().fromArray(a,h));let s,l;if(t.Form==="Closed")i.push(i[0]);else if(t.Form==="Periodic"){s=n,l=o.length-1-s;for(let h=0;h<n;++h)i.push(i[h])}const c=new Ze(n,o,i,s,l).getPoints(i.length*12);return new Xt().setFromPoints(c)}}class Br{parse(){const t=[],e=this.parseClips();if(e!==void 0)for(const n in e){const o=e[n],i=this.addClip(o);t.push(i)}return t}parseClips(){if(A.Objects.AnimationCurve===void 0)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=A.Objects.AnimationCurveNode,e=new Map;for(const n in t){const o=t[n];if(o.attrName.match(/S|R|T|DeformPercent/)!==null){const i={id:o.id,attr:o.attrName,curves:{}};e.set(i.id,i)}}return e}parseAnimationCurves(t){const e=A.Objects.AnimationCurve;for(const n in e){const o={id:e[n].id,times:e[n].KeyTime.a.map(Wr),values:e[n].KeyValueFloat.a},i=B.get(o.id);if(i!==void 0){const a=i.parents[0].ID,s=i.parents[0].relationship;s.match(/X/)?t.get(a).curves.x=o:s.match(/Y/)?t.get(a).curves.y=o:s.match(/Z/)?t.get(a).curves.z=o:s.match(/d|DeformPercent/)&&t.has(a)&&(t.get(a).curves.morph=o)}}}parseAnimationLayers(t){const e=A.Objects.AnimationLayer,n=new Map;for(const o in e){const i=[],a=B.get(parseInt(o));a!==void 0&&(a.children.forEach(function(s,l){if(t.has(s.ID)){const c=t.get(s.ID);if(c.curves.x!==void 0||c.curves.y!==void 0||c.curves.z!==void 0){if(i[l]===void 0){const h=B.get(s.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(h!==void 0){const u=A.Objects.Model[h.toString()];if(u===void 0){console.warn("FBXLoader: Encountered a unused curve.",s);return}const f={modelName:u.attrName?qt.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};H.traverse(function(p){p.ID===u.id&&(f.transform=p.matrix,p.userData.transformData&&(f.eulerOrder=p.userData.transformData.eulerOrder))}),f.transform||(f.transform=new U),"PreRotation"in u&&(f.preRotation=u.PreRotation.value),"PostRotation"in u&&(f.postRotation=u.PostRotation.value),i[l]=f}}i[l]&&(i[l][c.attr]=c)}else if(c.curves.morph!==void 0){if(i[l]===void 0){const h=B.get(s.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,u=B.get(h).parents[0].ID,f=B.get(u).parents[0].ID,p=B.get(f).parents[0].ID,d=A.Objects.Model[p],g={modelName:d.attrName?qt.sanitizeNodeName(d.attrName):"",morphName:A.Objects.Deformer[h].attrName};i[l]=g}i[l][c.attr]=c}}}),n.set(parseInt(o),i))}return n}parseAnimStacks(t){const e=A.Objects.AnimationStack,n={};for(const o in e){const i=B.get(parseInt(o)).children;i.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=t.get(i[0].ID);n[o]={name:e[o].attrName,layer:a}}return n}addClip(t){let e=[];const n=this;return t.layer.forEach(function(o){e=e.concat(n.generateTracks(o))}),new Kn(t.name,-1,e)}generateTracks(t){const e=[];let n=new ft,o=new Wt,i=new ft;if(t.transform&&t.transform.decompose(n,o,i),n=n.toArray(),o=new ut().setFromQuaternion(o,t.eulerOrder).toArray(),i=i.toArray(),t.T!==void 0&&Object.keys(t.T.curves).length>0){const a=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");a!==void 0&&e.push(a)}if(t.R!==void 0&&Object.keys(t.R.curves).length>0){const a=this.generateRotationTrack(t.modelName,t.R.curves,o,t.preRotation,t.postRotation,t.eulerOrder);a!==void 0&&e.push(a)}if(t.S!==void 0&&Object.keys(t.S.curves).length>0){const a=this.generateVectorTrack(t.modelName,t.S.curves,i,"scale");a!==void 0&&e.push(a)}if(t.DeformPercent!==void 0){const a=this.generateMorphTrack(t);a!==void 0&&e.push(a)}return e}generateVectorTrack(t,e,n,o){const i=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(i,e,n);return new Jn(t+"."+o,i,a)}generateRotationTrack(t,e,n,o,i,a){e.x!==void 0&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(ot.degToRad)),e.y!==void 0&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(ot.degToRad)),e.z!==void 0&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(ot.degToRad));const s=this.getTimesForAllAxes(e),l=this.getKeyframeTrackValues(s,e,n);o!==void 0&&(o=o.map(ot.degToRad),o.push(a),o=new ut().fromArray(o),o=new Wt().setFromEuler(o)),i!==void 0&&(i=i.map(ot.degToRad),i.push(a),i=new ut().fromArray(i),i=new Wt().setFromEuler(i).invert());const c=new Wt,h=new ut,u=[];for(let f=0;f<l.length;f+=3)h.set(l[f],l[f+1],l[f+2],a),c.setFromEuler(h),o!==void 0&&c.premultiply(o),i!==void 0&&c.multiply(i),c.toArray(u,f/3*4);return new Qn(t+".quaternion",s,u)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,n=e.values.map(function(i){return i/100}),o=H.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new tr(t.modelName+".morphTargetInfluences["+o+"]",e.times,n)}getTimesForAllAxes(t){let e=[];if(t.x!==void 0&&(e=e.concat(t.x.times)),t.y!==void 0&&(e=e.concat(t.y.times)),t.z!==void 0&&(e=e.concat(t.z.times)),e=e.sort(function(n,o){return n-o}),e.length>1){let n=1,o=e[0];for(let i=1;i<e.length;i++){const a=e[i];a!==o&&(e[n]=a,o=a,n++)}e=e.slice(0,n)}return e}getKeyframeTrackValues(t,e,n){const o=n,i=[];let a=-1,s=-1,l=-1;return t.forEach(function(c){if(e.x&&(a=e.x.times.indexOf(c)),e.y&&(s=e.y.times.indexOf(c)),e.z&&(l=e.z.times.indexOf(c)),a!==-1){const h=e.x.values[a];i.push(h),o[0]=h}else i.push(o[0]);if(s!==-1){const h=e.y.values[s];i.push(h),o[1]=h}else i.push(o[1]);if(l!==-1){const h=e.z.values[l];i.push(h),o[2]=h}else i.push(o[2])}),i}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const n=t.values[e-1],o=t.values[e]-n,i=Math.abs(o);if(i>=180){const a=i/180,s=o/a;let l=n+s;const c=t.times[e-1],h=(t.times[e]-c)/a;let u=c+h;const f=[],p=[];for(;u<t.times[e];)f.push(u),u+=h,p.push(l),l+=s;t.times=qe(t.times,e,f),t.values=qe(t.values,e,p)}}}}class jr{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new Nn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,n=t.split(/[\r\n]+/);return n.forEach(function(o,i){const a=o.match(/^[\s\t]*;/),s=o.match(/^[\s\t]*$/);if(a||s)return;const l=o.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),c=o.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=o.match("^\\t{"+(e.currentIndent-1)+"}}");l?e.parseNodeBegin(o,l):c?e.parseNodeProperty(o,c,n[++i]):h?e.popStack():o.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(o)}),this.allNodes}parseNodeBegin(t,e){const n=e[1].trim().replace(/^"/,"").replace(/"$/,""),o=e[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},a=this.parseNodeAttr(o),s=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,i):n in s?(n==="PoseNode"?s.PoseNode.push(i):s[n].id!==void 0&&(s[n]={},s[n][s[n].id]=s[n]),a.id!==""&&(s[n][a.id]=i)):typeof a.id=="number"?(s[n]={},s[n][a.id]=i):n!=="Properties70"&&(n==="PoseNode"?s[n]=[i]:s[n]=i),typeof a.id=="number"&&(i.id=a.id),a.name!==""&&(i.attrName=a.name),a.type!==""&&(i.attrType=a.type),this.pushStack(i)}parseNodeAttr(t){let e=t[0];t[0]!==""&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let n="",o="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),o=t[2]),{id:e,name:n,type:o}}parseNodeProperty(t,e,n){let o=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();o==="Content"&&i===","&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(t,o,i);return}if(o==="C"){const s=i.split(",").slice(1),l=parseInt(s[0]),c=parseInt(s[1]);let h=i.split(",").slice(3);h=h.map(function(u){return u.trim().replace(/^"/,"")}),o="connections",i=[l,c],$r(i,h),a[o]===void 0&&(a[o]=[])}o==="Node"&&(a.id=i),o in a&&Array.isArray(a[o])?a[o].push(i):o!=="a"?a[o]=i:a.a=i,this.setCurrentProp(a,o),o==="a"&&i.slice(-1)!==","&&(a.a=ce(i))}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,t.slice(-1)!==","&&(e.a=ce(e.a))}parseNodeSpecialProperty(t,e,n){const o=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=o[0],a=o[1],s=o[2],l=o[3];let c=o[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=ce(c);break}this.getPrevNode()[i]={type:a,type2:s,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),i)}}class Gr{parse(t){const e=new He(t);e.skip(23);const n=e.getUint32();if(n<6400)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+n);const o=new Nn;for(;!this.endOfContent(e);){const i=this.parseNode(e,n);i!==null&&o.add(i.name,i)}return o}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const n={},o=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const a=t.getUint8(),s=t.getString(a);if(o===0)return null;const l=[];for(let f=0;f<i;f++)l.push(this.parseProperty(t));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(n.singleProperty=i===1&&t.getOffset()===o;o>t.getOffset();){const f=this.parseNode(t,e);f!==null&&this.parseSubNode(s,n,f)}return n.propertyList=l,typeof c=="number"&&(n.id=c),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),s!==""&&(n.name=s),n}parseSubNode(t,e,n){if(n.singleProperty===!0){const o=n.propertyList[0];Array.isArray(o)?(e[n.name]=n,n.a=o):e[n.name]=o}else if(t==="Connections"&&n.name==="C"){const o=[];n.propertyList.forEach(function(i,a){a!==0&&o.push(i)}),e.connections===void 0&&(e.connections=[]),e.connections.push(o)}else if(n.name==="Properties70")Object.keys(n).forEach(function(o){e[o]=n[o]});else if(t==="Properties70"&&n.name==="P"){let o=n.propertyList[0],i=n.propertyList[1];const a=n.propertyList[2],s=n.propertyList[3];let l;o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),i==="Color"||i==="ColorRGB"||i==="Vector"||i==="Vector3D"||i.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],e[o]={type:i,type2:a,flag:s,value:l}}else e[n.name]===void 0?typeof n.id=="number"?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:n.name==="PoseNode"?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):e[n.name][n.id]===void 0&&(e[n.name][n.id]=n)}parseProperty(t){const e=t.getString(1);let n;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const o=t.getUint32(),i=t.getUint32(),a=t.getUint32();if(i===0)switch(e){case"b":case"c":return t.getBooleanArray(o);case"d":return t.getFloat64Array(o);case"f":return t.getFloat32Array(o);case"i":return t.getInt32Array(o);case"l":return t.getInt64Array(o)}typeof Lr>"u"&&console.error("FBXLoader: External library fflate.min.js required.");const s=zt(new Uint8Array(t.getArrayBuffer(a))),l=new He(s.buffer);switch(e){case"b":case"c":return l.getBooleanArray(o);case"d":return l.getFloat64Array(o);case"f":return l.getFloat32Array(o);case"i":return l.getInt32Array(o);case"l":return l.getInt64Array(o)}break;default:throw new Error("FBXLoader: Unknown property type "+e)}}}class He{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=e!==void 0?e:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(t){const e=[];for(let n=0;n<t;n++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e&2147483648?(e=~e&4294967295,t=~t&4294967295,t===4294967295&&(e=e+1&4294967295),t=t+1&4294967295,-(e*4294967296+t)):e*4294967296+t}getInt64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e*4294967296+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){let e=[];for(let o=0;o<t;o++)e[o]=this.getUint8();const n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),ye.decodeText(new Uint8Array(e))}}class Nn{add(t,e){this[t]=e}}function Vr(r){const t="Kaydara FBX Binary  \0";return r.byteLength>=t.length&&t===En(r,0,t.length)}function Xr(r){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let e=0;function n(o){const i=r[o-1];return r=r.slice(e+o),e++,i}for(let o=0;o<t.length;++o)if(n(1)===t[o])return!1;return!0}function Ye(r){const t=/FBXVersion: (\d+)/,e=r.match(t);if(e)return parseInt(e[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function Wr(r){return r/46186158e3}const _r=[];function $t(r,t,e,n){let o;switch(n.mappingType){case"ByPolygonVertex":o=r;break;case"ByPolygon":o=t;break;case"ByVertice":o=e;break;case"AllSame":o=n.indices[0];break;default:console.warn("FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(o=n.indices[o]);const i=o*n.dataSize,a=i+n.dataSize;return Zr(_r,n.buffer,i,a)}const le=new ut,wt=new ft;function Sn(r){const t=new U,e=new U,n=new U,o=new U,i=new U,a=new U,s=new U,l=new U,c=new U,h=new U,u=new U,f=new U,p=r.inheritType?r.inheritType:0;if(r.translation&&t.setPosition(wt.fromArray(r.translation)),r.preRotation){const b=r.preRotation.map(ot.degToRad);b.push(r.eulerOrder||ut.DefaultOrder),e.makeRotationFromEuler(le.fromArray(b))}if(r.rotation){const b=r.rotation.map(ot.degToRad);b.push(r.eulerOrder||ut.DefaultOrder),n.makeRotationFromEuler(le.fromArray(b))}if(r.postRotation){const b=r.postRotation.map(ot.degToRad);b.push(r.eulerOrder||ut.DefaultOrder),o.makeRotationFromEuler(le.fromArray(b)),o.invert()}r.scale&&i.scale(wt.fromArray(r.scale)),r.scalingOffset&&s.setPosition(wt.fromArray(r.scalingOffset)),r.scalingPivot&&a.setPosition(wt.fromArray(r.scalingPivot)),r.rotationOffset&&l.setPosition(wt.fromArray(r.rotationOffset)),r.rotationPivot&&c.setPosition(wt.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(u.copy(r.parentMatrix),h.copy(r.parentMatrixWorld));const d=e.clone().multiply(n).multiply(o),g=new U;g.extractRotation(h);const y=new U;y.copyPosition(h);const k=y.clone().invert().multiply(h),m=g.clone().invert().multiply(k),v=i,x=new U;if(p===0)x.copy(g).multiply(d).multiply(m).multiply(v);else if(p===1)x.copy(g).multiply(m).multiply(d).multiply(v);else{const b=new U().scale(new ft().setFromMatrixScale(u)).clone().invert(),F=m.clone().multiply(b);x.copy(g).multiply(d).multiply(F).multiply(v)}const I=c.clone().invert(),D=a.clone().invert();let T=t.clone().multiply(l).multiply(c).multiply(e).multiply(n).multiply(o).multiply(I).multiply(s).multiply(a).multiply(i).multiply(D);const w=new U().copyPosition(T),N=h.clone().multiply(w);return f.copyPosition(N),T=f.clone().multiply(x),T.premultiply(h.invert()),T}function Fn(r){r=r||0;const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[r]}function ce(r){return r.split(",").map(function(t){return parseFloat(t)})}function En(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=r.byteLength),ye.decodeText(new Uint8Array(r,t,e))}function $r(r,t){for(let e=0,n=r.length,o=t.length;e<o;e++,n++)r[n]=t[e]}function Zr(r,t,e,n){for(let o=e,i=0;o<n;o++,i++)r[i]=t[o];return r}function qe(r,t,e){return r.slice(0,t).concat(e).concat(r.slice(t))}const Hr=new Map,Yr=new zr,Kr=async(r,t)=>{const[e,n]=await Rn(Hr,r,()=>new Promise((o,i)=>{er(),Yr.load(r,a=>{var s;je();const l=[];let c=!0;a.traverse(h=>{h instanceof lr?l.push(h):c&&h instanceof ue&&(c=!1),h.castShadow=!0,h.receiveShadow=!0});for(const h of l)(s=h.parent)==null||s.remove(h);o([a,c])},nr(r),()=>{je(),i()})}));return t?Un(e,n):e};export{Kr as default};
