import{aH as Le,D as be,a9 as Ee,aa as de,ab as P,ac as V,ai as v,aE as Ie,aD as Pe,aF as Ce,ah as q,aI as C,aJ as O,aK as pe,aL as Oe,X as Ne,ad as ke,aM as Ue,aN as De,A as X,aO as me,aP as fe,ae as Z,ag as te,aQ as Fe,aR as W,a as He,a7 as Ge,f as B,al as je,I as ge,am as Be,J as Ke,aS as Ve,T as Xe,aT as qe,aU as ze,e as Y,aC as We,au as Ye,aB as Je,aV as Te,as as Qe,ak as xe,u as Ze,_ as _e,an as $e,aW as Ae,ax as es,ay as ne,az as ss,aX as ts,aY as ns,aZ as rs,a_ as os,af as is,a$ as as,b0 as cs,b1 as ls,b2 as us,b3 as hs,at as ds,av as re,aw as ps,O as ms,F as K,b4 as fs,aG as gs,b5 as Ts}from"./index.ff37fac8.js";class xs extends de{constructor(s){super(s),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new vs(e)}),this.register(function(e){return new Is(e)}),this.register(function(e){return new Ps(e)}),this.register(function(e){return new ws(e)}),this.register(function(e){return new Ss(e)}),this.register(function(e){return new Ls(e)}),this.register(function(e){return new bs(e)}),this.register(function(e){return new Rs(e)}),this.register(function(e){return new Es(e)}),this.register(function(e){return new Ms(e)}),this.register(function(e){return new As(e)}),this.register(function(e){return new Cs(e)})}load(s,e,o,n){const r=this;let t;this.resourcePath!==""?t=this.resourcePath:this.path!==""?t=this.path:t=P.extractUrlBase(s),this.manager.itemStart(s);const i=function(l){n?n(l):console.error(l),r.manager.itemError(s),r.manager.itemEnd(s)},a=new V(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(s,function(l){try{r.parse(l,t,function(u){e(u),r.manager.itemEnd(s)},i)}catch(u){i(u)}},o,i)}setDRACOLoader(s){return this.dracoLoader=s,this}setDDSLoader(){throw new Error('GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(s){return this.ktx2Loader=s,this}setMeshoptDecoder(s){return this.meshoptDecoder=s,this}register(s){return this.pluginCallbacks.indexOf(s)===-1&&this.pluginCallbacks.push(s),this}unregister(s){return this.pluginCallbacks.indexOf(s)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(s),1),this}parse(s,e,o,n){let r;const t={},i={};if(typeof s=="string")r=s;else if(P.decodeText(new Uint8Array(s,0,4))===ye){try{t[g.KHR_BINARY_GLTF]=new Os(s)}catch(u){n&&n(u);return}r=t[g.KHR_BINARY_GLTF].content}else r=P.decodeText(new Uint8Array(s));const a=JSON.parse(r);if(a.asset===void 0||a.asset.version[0]<2){n&&n(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new qs(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const c=this.pluginCallbacks[u](l);i[c.name]=c,t[c.name]=!0}if(a.extensionsUsed)for(let u=0;u<a.extensionsUsed.length;++u){const c=a.extensionsUsed[u],d=a.extensionsRequired||[];switch(c){case g.KHR_MATERIALS_UNLIT:t[c]=new ys;break;case g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:t[c]=new Us;break;case g.KHR_DRACO_MESH_COMPRESSION:t[c]=new Ns(a,this.dracoLoader);break;case g.KHR_TEXTURE_TRANSFORM:t[c]=new ks;break;case g.KHR_MESH_QUANTIZATION:t[c]=new Ds;break;default:d.indexOf(c)>=0&&i[c]===void 0&&console.warn('GLTFLoader: Unknown extension "'+c+'".')}}l.setExtensions(t),l.setPlugins(i),l.parse(o,n)}parseAsync(s,e){const o=this;return new Promise(function(n,r){o.parse(s,e,n,r)})}}function _s(){let h={};return{get:function(s){return h[s]},add:function(s,e){h[s]=e},remove:function(s){delete h[s]},removeAll:function(){h={}}}}const g={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class As{constructor(s){this.parser=s,this.name=g.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const s=this.parser,e=this.parser.json.nodes||[];for(let o=0,n=e.length;o<n;o++){const r=e[o];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&s._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(s){const e=this.parser,o="light:"+s;let n=e.cache.get(o);if(n)return n;const r=e.json,t=((r.extensions&&r.extensions[this.name]||{}).lights||[])[s];let i;const a=new v(16777215);t.color!==void 0&&a.fromArray(t.color);const l=t.range!==void 0?t.range:0;switch(t.type){case"directional":i=new Ce(a),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new Pe(a),i.distance=l;break;case"spot":i=new Ie(a),i.distance=l,t.spot=t.spot||{},t.spot.innerConeAngle=t.spot.innerConeAngle!==void 0?t.spot.innerConeAngle:0,t.spot.outerConeAngle=t.spot.outerConeAngle!==void 0?t.spot.outerConeAngle:Math.PI/4,i.angle=t.spot.outerConeAngle,i.penumbra=1-t.spot.innerConeAngle/t.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("GLTFLoader: Unexpected light type: "+t.type)}return i.position.set(0,0,0),i.decay=2,t.intensity!==void 0&&(i.intensity=t.intensity),i.name=e.createUniqueName(t.name||"light_"+s),n=Promise.resolve(i),e.cache.add(o,n),n}createNodeAttachment(s){const e=this,o=this.parser,n=o.json.nodes[s],r=(n.extensions&&n.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(t){return o._getNodeRef(e.cache,r,t)})}}class ys{constructor(){this.name=g.KHR_MATERIALS_UNLIT}getMaterialType(){return q}extendParams(s,e,o){const n=[];s.color=new v(1,1,1),s.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;s.color.fromArray(t),s.opacity=t[3]}r.baseColorTexture!==void 0&&n.push(o.assignTexture(s,"map",r.baseColorTexture,C))}return Promise.all(n)}}class Rs{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(s,e){const o=this.parser.json.materials[s];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const n=o.extensions[this.name].emissiveStrength;return n!==void 0&&(e.emissiveIntensity=n),Promise.resolve()}}class vs{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_CLEARCOAT}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser,n=o.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],t=n.extensions[this.name];if(t.clearcoatFactor!==void 0&&(e.clearcoat=t.clearcoatFactor),t.clearcoatTexture!==void 0&&r.push(o.assignTexture(e,"clearcoatMap",t.clearcoatTexture)),t.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=t.clearcoatRoughnessFactor),t.clearcoatRoughnessTexture!==void 0&&r.push(o.assignTexture(e,"clearcoatRoughnessMap",t.clearcoatRoughnessTexture)),t.clearcoatNormalTexture!==void 0&&(r.push(o.assignTexture(e,"clearcoatNormalMap",t.clearcoatNormalTexture)),t.clearcoatNormalTexture.scale!==void 0)){const i=t.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new pe(i,i)}return Promise.all(r)}}class Ms{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_IRIDESCENCE}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser,n=o.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],t=n.extensions[this.name];return t.iridescenceFactor!==void 0&&(e.iridescence=t.iridescenceFactor),t.iridescenceTexture!==void 0&&r.push(o.assignTexture(e,"iridescenceMap",t.iridescenceTexture)),t.iridescenceIor!==void 0&&(e.iridescenceIOR=t.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),t.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=t.iridescenceThicknessMinimum),t.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=t.iridescenceThicknessMaximum),t.iridescenceThicknessTexture!==void 0&&r.push(o.assignTexture(e,"iridescenceThicknessMap",t.iridescenceThicknessTexture)),Promise.all(r)}}class ws{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_SHEEN}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser,n=o.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new v(0,0,0),e.sheenRoughness=0,e.sheen=1;const t=n.extensions[this.name];return t.sheenColorFactor!==void 0&&e.sheenColor.fromArray(t.sheenColorFactor),t.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=t.sheenRoughnessFactor),t.sheenColorTexture!==void 0&&r.push(o.assignTexture(e,"sheenColorMap",t.sheenColorTexture,C)),t.sheenRoughnessTexture!==void 0&&r.push(o.assignTexture(e,"sheenRoughnessMap",t.sheenRoughnessTexture)),Promise.all(r)}}class Ss{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_TRANSMISSION}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser,n=o.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],t=n.extensions[this.name];return t.transmissionFactor!==void 0&&(e.transmission=t.transmissionFactor),t.transmissionTexture!==void 0&&r.push(o.assignTexture(e,"transmissionMap",t.transmissionTexture)),Promise.all(r)}}class Ls{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_VOLUME}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser,n=o.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],t=n.extensions[this.name];e.thickness=t.thicknessFactor!==void 0?t.thicknessFactor:0,t.thicknessTexture!==void 0&&r.push(o.assignTexture(e,"thicknessMap",t.thicknessTexture)),e.attenuationDistance=t.attenuationDistance||0;const i=t.attenuationColor||[1,1,1];return e.attenuationColor=new v(i[0],i[1],i[2]),Promise.all(r)}}class bs{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_IOR}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser.json.materials[s];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const n=o.extensions[this.name];return e.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}}class Es{constructor(s){this.parser=s,this.name=g.KHR_MATERIALS_SPECULAR}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:O}extendMaterialParams(s,e){const o=this.parser,n=o.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],t=n.extensions[this.name];e.specularIntensity=t.specularFactor!==void 0?t.specularFactor:1,t.specularTexture!==void 0&&r.push(o.assignTexture(e,"specularIntensityMap",t.specularTexture));const i=t.specularColorFactor||[1,1,1];return e.specularColor=new v(i[0],i[1],i[2]),t.specularColorTexture!==void 0&&r.push(o.assignTexture(e,"specularColorMap",t.specularColorTexture,C)),Promise.all(r)}}class Is{constructor(s){this.parser=s,this.name=g.KHR_TEXTURE_BASISU}loadTexture(s){const e=this.parser,o=e.json,n=o.textures[s];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],t=e.options.ktx2Loader;if(!t){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(s,r.source,t)}}class Ps{constructor(s){this.parser=s,this.name=g.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(s){const e=this.name,o=this.parser,n=o.json,r=n.textures[s];if(!r.extensions||!r.extensions[e])return null;const t=r.extensions[e],i=n.images[t.source];let a=o.textureLoader;if(i.uri){const l=o.options.manager.getHandler(i.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return o.loadTextureImage(s,t.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(s)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(s){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){s(e.height===1)}})),this.isSupported}}class Cs{constructor(s){this.name=g.EXT_MESHOPT_COMPRESSION,this.parser=s}loadBufferView(s){const e=this.parser.json,o=e.bufferViews[s];if(o.extensions&&o.extensions[this.name]){const n=o.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),t=this.parser.options.meshoptDecoder;if(!t||!t.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(i){const a=n.byteOffset||0,l=n.byteLength||0,u=n.count,c=n.byteStride,d=new Uint8Array(i,a,l);return t.decodeGltfBufferAsync?t.decodeGltfBufferAsync(u,c,d,n.mode,n.filter).then(function(p){return p.buffer}):t.ready.then(function(){const p=new ArrayBuffer(u*c);return t.decodeGltfBuffer(new Uint8Array(p),u,c,d,n.mode,n.filter),p})})}else return null}}const ye="glTF",D=12,oe={JSON:1313821514,BIN:5130562};class Os{constructor(s){this.name=g.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(s,0,D);if(this.header={magic:P.decodeText(new Uint8Array(s.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==ye)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");const o=this.header.length-D,n=new DataView(s,D);let r=0;for(;r<o;){const t=n.getUint32(r,!0);r+=4;const i=n.getUint32(r,!0);if(r+=4,i===oe.JSON){const a=new Uint8Array(s,D+r,t);this.content=P.decodeText(a)}else if(i===oe.BIN){const a=D+r;this.body=s.slice(a,a+t)}r+=t}if(this.content===null)throw new Error("GLTFLoader: JSON content not found.")}}class Ns{constructor(s,e){if(!e)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=g.KHR_DRACO_MESH_COMPRESSION,this.json=s,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(s,e){const o=this.json,n=this.dracoLoader,r=s.extensions[this.name].bufferView,t=s.extensions[this.name].attributes,i={},a={},l={};for(const u in t){const c=ee[u]||u.toLowerCase();i[c]=t[u]}for(const u in s.attributes){const c=ee[u]||u.toLowerCase();if(t[u]!==void 0){const d=o.accessors[s.attributes[u]],p=H[d.componentType];l[c]=p.name,a[c]=d.normalized===!0}}return e.getDependency("bufferView",r).then(function(u){return new Promise(function(c){n.decodeDracoFile(u,function(d){for(const p in d.attributes){const f=d.attributes[p],T=a[p];T!==void 0&&(f.normalized=T)}c(d)},i,l)})})}}class ks{constructor(){this.name=g.KHR_TEXTURE_TRANSFORM}extendTexture(s,e){return e.texCoord!==void 0&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(s=s.clone(),e.offset!==void 0&&s.offset.fromArray(e.offset),e.rotation!==void 0&&(s.rotation=e.rotation),e.scale!==void 0&&s.repeat.fromArray(e.scale),s.needsUpdate=!0),s}}class $ extends q{constructor(s){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),o=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),t=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),i={specular:{value:new v().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(a){for(const l in i)a.uniforms[l]=i[l];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",t)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(a){i.specular.value=a}},specularMap:{get:function(){return i.specularMap.value},set:function(a){i.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(a){i.glossiness.value=a}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(a){i.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(s)}copy(s){return super.copy(s),this.specularMap=s.specularMap,this.specular.copy(s.specular),this.glossinessMap=s.glossinessMap,this.glossiness=s.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Us{constructor(){this.name=g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return $}extendParams(s,e,o){const n=e.extensions[this.name];s.color=new v(1,1,1),s.opacity=1;const r=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;s.color.fromArray(t),s.opacity=t[3]}if(n.diffuseTexture!==void 0&&r.push(o.assignTexture(s,"map",n.diffuseTexture,C)),s.emissive=new v(0,0,0),s.glossiness=n.glossinessFactor!==void 0?n.glossinessFactor:1,s.specular=new v(1,1,1),Array.isArray(n.specularFactor)&&s.specular.fromArray(n.specularFactor),n.specularGlossinessTexture!==void 0){const t=n.specularGlossinessTexture;r.push(o.assignTexture(s,"glossinessMap",t)),r.push(o.assignTexture(s,"specularMap",t,C))}return Promise.all(r)}createMaterial(s){const e=new $(s);return e.fog=!0,e.color=s.color,e.map=s.map===void 0?null:s.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=s.aoMap===void 0?null:s.aoMap,e.aoMapIntensity=1,e.emissive=s.emissive,e.emissiveIntensity=s.emissiveIntensity===void 0?1:s.emissiveIntensity,e.emissiveMap=s.emissiveMap===void 0?null:s.emissiveMap,e.bumpMap=s.bumpMap===void 0?null:s.bumpMap,e.bumpScale=1,e.normalMap=s.normalMap===void 0?null:s.normalMap,e.normalMapType=Oe,s.normalScale&&(e.normalScale=s.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=s.specularMap===void 0?null:s.specularMap,e.specular=s.specular,e.glossinessMap=s.glossinessMap===void 0?null:s.glossinessMap,e.glossiness=s.glossiness,e.alphaMap=null,e.envMap=s.envMap===void 0?null:s.envMap,e.envMapIntensity=1,e}}class Ds{constructor(){this.name=g.KHR_MESH_QUANTIZATION}}class Re extends Ts{constructor(s,e,o,n){super(s,e,o,n)}copySampleValue_(s){const e=this.resultBuffer,o=this.sampleValues,n=this.valueSize,r=s*n*3+n;for(let t=0;t!==n;t++)e[t]=o[r+t];return e}interpolate_(s,e,o,n){const r=this.resultBuffer,t=this.sampleValues,i=this.valueSize,a=i*2,l=i*3,u=n-e,c=(o-e)/u,d=c*c,p=d*c,f=s*l,T=f-l,m=-2*p+3*d,x=p-d,_=1-m,A=x-d+c;for(let R=0;R!==i;R++){const L=t[T+R+i],M=t[T+R+a]*u,y=t[f+R+i],U=t[f+R]*u;r[R]=_*L+A*M+m*y+x*U}return r}}const Fs=new Ne;class Hs extends Re{interpolate_(s,e,o,n){const r=super.interpolate_(s,e,o,n);return Fs.fromArray(r).normalize().toArray(r),r}}const S={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},H={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ie={9728:ts,9729:me,9984:ns,9985:rs,9986:os,9987:fe},ae={33071:is,33648:as,10497:Z},ce={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ee={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Gs={CUBICSPLINE:void 0,LINEAR:Te,STEP:cs},J={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function js(h){return h.DefaultMaterial===void 0&&(h.DefaultMaterial=new q({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ls})),h.DefaultMaterial}function F(h,s,e){for(const o in e.extensions)h[o]===void 0&&(s.userData.gltfExtensions=s.userData.gltfExtensions||{},s.userData.gltfExtensions[o]=e.extensions[o])}function I(h,s){s.extras!==void 0&&(typeof s.extras=="object"?Object.assign(h.userData,s.extras):console.warn("GLTFLoader: Ignoring primitive type .extras, "+s.extras))}function Bs(h,s,e){let o=!1,n=!1,r=!1;for(let l=0,u=s.length;l<u;l++){const c=s[l];if(c.POSITION!==void 0&&(o=!0),c.NORMAL!==void 0&&(n=!0),c.COLOR_0!==void 0&&(r=!0),o&&n&&r)break}if(!o&&!n&&!r)return Promise.resolve(h);const t=[],i=[],a=[];for(let l=0,u=s.length;l<u;l++){const c=s[l];if(o){const d=c.POSITION!==void 0?e.getDependency("accessor",c.POSITION):h.attributes.position;t.push(d)}if(n){const d=c.NORMAL!==void 0?e.getDependency("accessor",c.NORMAL):h.attributes.normal;i.push(d)}if(r){const d=c.COLOR_0!==void 0?e.getDependency("accessor",c.COLOR_0):h.attributes.color;a.push(d)}}return Promise.all([Promise.all(t),Promise.all(i),Promise.all(a)]).then(function(l){const u=l[0],c=l[1],d=l[2];return o&&(h.morphAttributes.position=u),n&&(h.morphAttributes.normal=c),r&&(h.morphAttributes.color=d),h.morphTargetsRelative=!0,h})}function Ks(h,s){if(h.updateMorphTargets(),s.weights!==void 0)for(let e=0,o=s.weights.length;e<o;e++)h.morphTargetInfluences[e]=s.weights[e];if(s.extras&&Array.isArray(s.extras.targetNames)){const e=s.extras.targetNames;if(h.morphTargetInfluences.length===e.length){h.morphTargetDictionary={};for(let o=0,n=e.length;o<n;o++)h.morphTargetDictionary[e[o]]=o}else console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vs(h){const s=h.extensions&&h.extensions[g.KHR_DRACO_MESH_COMPRESSION];let e;return s?e="draco:"+s.bufferView+":"+s.indices+":"+le(s.attributes):e=h.indices+":"+le(h.attributes)+":"+h.mode,e}function le(h){let s="";const e=Object.keys(h).sort();for(let o=0,n=e.length;o<n;o++)s+=e[o]+":"+h[e[o]]+";";return s}function se(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("GLTFLoader: Unsupported normalized accessor component type.")}}function Xs(h){return h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0?"image/jpeg":h.search(/\.webp($|\?)/i)>0||h.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class qs{constructor(s={},e={}){this.json=s,this.extensions={},this.plugins={},this.options=e,this.cache=new _s,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,r=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||o||n&&r<98?this.textureLoader=new ke(this.options.manager):this.textureLoader=new Ue(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new V(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(s){this.extensions=s}setPlugins(s){this.plugins=s}parse(s,e){const o=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all(this._invokeAll(function(t){return t.beforeRoot&&t.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(t){const i={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:o,userData:{}};F(r,i,n),I(i,n),Promise.all(o._invokeAll(function(a){return a.afterRoot&&a.afterRoot(i)})).then(function(){s(i)})}).catch(e)}_markDefs(){const s=this.json.nodes||[],e=this.json.skins||[],o=this.json.meshes||[];for(let n=0,r=e.length;n<r;n++){const t=e[n].joints;for(let i=0,a=t.length;i<a;i++)s[t[i]].isBone=!0}for(let n=0,r=s.length;n<r;n++){const t=s[n];t.mesh!==void 0&&(this._addNodeRef(this.meshCache,t.mesh),t.skin!==void 0&&(o[t.mesh].isSkinnedMesh=!0)),t.camera!==void 0&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(s,e){e!==void 0&&(s.refs[e]===void 0&&(s.refs[e]=s.uses[e]=0),s.refs[e]++)}_getNodeRef(s,e,o){if(s.refs[e]<=1)return o;const n=o.clone(),r=(t,i)=>{const a=this.associations.get(t);a!=null&&this.associations.set(i,a);for(const[l,u]of t.children.entries())r(u,i.children[l])};return r(o,n),n.name+="_instance_"+s.uses[e]++,n}_invokeOne(s){const e=Object.values(this.plugins);e.push(this);for(let o=0;o<e.length;o++){const n=s(e[o]);if(n)return n}return null}_invokeAll(s){const e=Object.values(this.plugins);e.unshift(this);const o=[];for(let n=0;n<e.length;n++){const r=s(e[n]);r&&o.push(r)}return o}getDependency(s,e){const o=s+":"+e;let n=this.cache.get(o);if(!n){switch(s){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+s)}this.cache.add(o,n)}return n}getDependencies(s){let e=this.cache.get(s);if(!e){const o=this,n=this.json[s+(s==="mesh"?"es":"s")]||[];e=Promise.all(n.map(function(r,t){return o.getDependency(s,t)})),this.cache.add(s,e)}return e}loadBuffer(s){const e=this.json.buffers[s],o=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&s===0)return Promise.resolve(this.extensions[g.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,t){o.load(P.resolveURL(e.uri,n.path),r,void 0,function(){t(new Error('GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(s){const e=this.json.bufferViews[s];return this.getDependency("buffer",e.buffer).then(function(o){const n=e.byteLength||0,r=e.byteOffset||0;return o.slice(r,r+n)})}loadAccessor(s){const e=this,o=this.json,n=this.json.accessors[s];if(n.bufferView===void 0&&n.sparse===void 0)return Promise.resolve(null);const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(t){const i=t[0],a=ce[n.type],l=H[n.componentType],u=l.BYTES_PER_ELEMENT,c=u*a,d=n.byteOffset||0,p=n.bufferView!==void 0?o.bufferViews[n.bufferView].byteStride:void 0,f=n.normalized===!0;let T,m;if(p&&p!==c){const x=Math.floor(d/p),_="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+x+":"+n.count;let A=e.cache.get(_);A||(T=new l(i,x*p,n.count*p/u),A=new De(T,p/u),e.cache.add(_,A)),m=new us(A,a,d%p/u,f)}else i===null?T=new l(n.count*a):T=new l(i,d,n.count*a),m=new X(T,a,f);if(n.sparse!==void 0){const x=ce.SCALAR,_=H[n.sparse.indices.componentType],A=n.sparse.indices.byteOffset||0,R=n.sparse.values.byteOffset||0,L=new _(t[1],A,n.sparse.count*x),M=new l(t[2],R,n.sparse.count*a);i!==null&&(m=new X(m.array.slice(),m.itemSize,m.normalized));for(let y=0,U=L.length;y<U;y++){const N=L[y];if(m.setX(N,M[y*a]),a>=2&&m.setY(N,M[y*a+1]),a>=3&&m.setZ(N,M[y*a+2]),a>=4&&m.setW(N,M[y*a+3]),a>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(s){const e=this.json,o=this.options,n=e.textures[s].source,r=e.images[n];let t=this.textureLoader;if(r.uri){const i=o.manager.getHandler(r.uri);i!==null&&(t=i)}return this.loadTextureImage(s,n,t)}loadTextureImage(s,e,o){const n=this,r=this.json,t=r.textures[s],i=r.images[e],a=(i.uri||i.bufferView)+":"+t.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(e,o).then(function(u){u.flipY=!1,t.name&&(u.name=t.name);const c=(r.samplers||{})[t.sampler]||{};return u.magFilter=ie[c.magFilter]||me,u.minFilter=ie[c.minFilter]||fe,u.wrapS=ae[c.wrapS]||Z,u.wrapT=ae[c.wrapT]||Z,n.associations.set(u,{textures:s}),u}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(s,e){const o=this,n=this.json,r=this.options;if(this.sourceCache[s]!==void 0)return this.sourceCache[s].then(c=>c.clone());const t=n.images[s],i=self.URL||self.webkitURL;let a=t.uri||"",l=!1;if(t.bufferView!==void 0)a=o.getDependency("bufferView",t.bufferView).then(function(c){l=!0;const d=new Blob([c],{type:t.mimeType});return a=i.createObjectURL(d),a});else if(t.uri===void 0)throw new Error("GLTFLoader: Image "+s+" is missing URI and bufferView");const u=Promise.resolve(a).then(function(c){return new Promise(function(d,p){let f=d;e.isImageBitmapLoader===!0&&(f=function(T){const m=new te(T);m.needsUpdate=!0,d(m)}),e.load(P.resolveURL(c,r.path),f,void 0,p)})}).then(function(c){return l===!0&&i.revokeObjectURL(a),c.userData.mimeType=t.mimeType||Xs(t.uri),c}).catch(function(c){throw console.error("GLTFLoader: Couldn't load texture",a),c});return this.sourceCache[s]=u,u}assignTexture(s,e,o,n){const r=this;return this.getDependency("texture",o.index).then(function(t){if(o.texCoord!==void 0&&o.texCoord!=0&&!(e==="aoMap"&&o.texCoord==1)&&console.warn("GLTFLoader: Custom UV set "+o.texCoord+" for texture "+e+" not yet supported."),r.extensions[g.KHR_TEXTURE_TRANSFORM]){const i=o.extensions!==void 0?o.extensions[g.KHR_TEXTURE_TRANSFORM]:void 0;if(i){const a=r.associations.get(t);t=r.extensions[g.KHR_TEXTURE_TRANSFORM].extendTexture(t,i),r.associations.set(t,a)}}return n!==void 0&&(t.encoding=n),s[e]=t,t})}assignFinalMaterial(s){const e=s.geometry;let o=s.material;const n=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,t=e.attributes.normal===void 0;if(s.isPoints){const i="PointsMaterial:"+o.uuid;let a=this.cache.get(i);a||(a=new Fe,W.prototype.copy.call(a,o),a.color.copy(o.color),a.map=o.map,a.sizeAttenuation=!1,this.cache.add(i,a)),o=a}else if(s.isLine){const i="LineBasicMaterial:"+o.uuid;let a=this.cache.get(i);a||(a=new He,W.prototype.copy.call(a,o),a.color.copy(o.color),this.cache.add(i,a)),o=a}if(n||r||t){let i="ClonedMaterial:"+o.uuid+":";o.isGLTFSpecularGlossinessMaterial&&(i+="specular-glossiness:"),n&&(i+="derivative-tangents:"),r&&(i+="vertex-colors:"),t&&(i+="flat-shading:");let a=this.cache.get(i);a||(a=o.clone(),r&&(a.vertexColors=!0),t&&(a.flatShading=!0),n&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(i,a),this.associations.set(a,this.associations.get(o))),o=a}o.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),s.material=o}getMaterialType(){return q}loadMaterial(s){const e=this,o=this.json,n=this.extensions,r=o.materials[s];let t;const i={},a=r.extensions||{},l=[];if(a[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const c=n[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),l.push(c.extendParams(i,r,e))}else if(a[g.KHR_MATERIALS_UNLIT]){const c=n[g.KHR_MATERIALS_UNLIT];t=c.getMaterialType(),l.push(c.extendParams(i,r,e))}else{const c=r.pbrMetallicRoughness||{};if(i.color=new v(1,1,1),i.opacity=1,Array.isArray(c.baseColorFactor)){const d=c.baseColorFactor;i.color.fromArray(d),i.opacity=d[3]}c.baseColorTexture!==void 0&&l.push(e.assignTexture(i,"map",c.baseColorTexture,C)),i.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,i.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(l.push(e.assignTexture(i,"metalnessMap",c.metallicRoughnessTexture)),l.push(e.assignTexture(i,"roughnessMap",c.metallicRoughnessTexture))),t=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(s)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(s,i)})))}r.doubleSided===!0&&(i.side=Ge);const u=r.alphaMode||J.OPAQUE;if(u===J.BLEND?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,u===J.MASK&&(i.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&t!==B&&(l.push(e.assignTexture(i,"normalMap",r.normalTexture)),i.normalScale=new pe(1,1),r.normalTexture.scale!==void 0)){const c=r.normalTexture.scale;i.normalScale.set(c,c)}return r.occlusionTexture!==void 0&&t!==B&&(l.push(e.assignTexture(i,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(i.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&t!==B&&(i.emissive=new v().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&t!==B&&l.push(e.assignTexture(i,"emissiveMap",r.emissiveTexture,C)),Promise.all(l).then(function(){let c;return t===$?c=n[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):c=new t(i),r.name&&(c.name=r.name),I(c,r),e.associations.set(c,{materials:s}),r.extensions&&F(n,c,r),c})}createUniqueName(s){const e=je.sanitizeNodeName(s||"");let o=e;for(let n=1;this.nodeNamesUsed[o];++n)o=e+"_"+n;return this.nodeNamesUsed[o]=!0,o}loadGeometries(s){const e=this,o=this.extensions,n=this.primitiveCache;function r(i){return o[g.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(i,e).then(function(a){return ue(a,i,e)})}const t=[];for(let i=0,a=s.length;i<a;i++){const l=s[i],u=Vs(l),c=n[u];if(c)t.push(c.promise);else{let d;l.extensions&&l.extensions[g.KHR_DRACO_MESH_COMPRESSION]?d=r(l):d=ue(new ge,l,e),n[u]={primitive:l,promise:d},t.push(d)}}return Promise.all(t)}loadMesh(s){const e=this,o=this.json,n=this.extensions,r=o.meshes[s],t=r.primitives,i=[];for(let a=0,l=t.length;a<l;a++){const u=t[a].material===void 0?js(this.cache):this.getDependency("material",t[a].material);i.push(u)}return i.push(e.loadGeometries(t)),Promise.all(i).then(function(a){const l=a.slice(0,a.length-1),u=a[a.length-1],c=[];for(let p=0,f=u.length;p<f;p++){const T=u[p],m=t[p];let x;const _=l[p];if(m.mode===S.TRIANGLES||m.mode===S.TRIANGLE_STRIP||m.mode===S.TRIANGLE_FAN||m.mode===void 0)x=r.isSkinnedMesh===!0?new Be(T,_):new Ke(T,_),x.isSkinnedMesh===!0&&!x.geometry.attributes.skinWeight.normalized&&x.normalizeSkinWeights(),m.mode===S.TRIANGLE_STRIP?x.geometry=he(x.geometry,hs):m.mode===S.TRIANGLE_FAN&&(x.geometry=he(x.geometry,Ae));else if(m.mode===S.LINES)x=new Ve(T,_);else if(m.mode===S.LINE_STRIP)x=new Xe(T,_);else if(m.mode===S.LINE_LOOP)x=new qe(T,_);else if(m.mode===S.POINTS)x=new ze(T,_);else throw new Error("GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(x.geometry.morphAttributes).length>0&&Ks(x,r),x.name=e.createUniqueName(r.name||"mesh_"+s),I(x,r),m.extensions&&F(n,x,m),e.assignFinalMaterial(x),c.push(x)}for(let p=0,f=c.length;p<f;p++)e.associations.set(c[p],{meshes:s,primitives:p});if(c.length===1)return c[0];const d=new Y;e.associations.set(d,{meshes:s});for(let p=0,f=c.length;p<f;p++)d.add(c[p]);return d})}loadCamera(s){let e;const o=this.json.cameras[s],n=o[o.type];if(!n){console.warn("GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?e=new We(Ye.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):o.type==="orthographic"&&(e=new Je(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),o.name&&(e.name=this.createUniqueName(o.name)),I(e,o),Promise.resolve(e)}loadSkin(s){const e=this.json.skins[s],o={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(o):this.getDependency("accessor",e.inverseBindMatrices).then(function(n){return o.inverseBindMatrices=n,o})}loadAnimation(s){const e=this.json.animations[s],o=[],n=[],r=[],t=[],i=[];for(let a=0,l=e.channels.length;a<l;a++){const u=e.channels[a],c=e.samplers[u.sampler],d=u.target,p=d.node,f=e.parameters!==void 0?e.parameters[c.input]:c.input,T=e.parameters!==void 0?e.parameters[c.output]:c.output;o.push(this.getDependency("node",p)),n.push(this.getDependency("accessor",f)),r.push(this.getDependency("accessor",T)),t.push(c),i.push(d)}return Promise.all([Promise.all(o),Promise.all(n),Promise.all(r),Promise.all(t),Promise.all(i)]).then(function(a){const l=a[0],u=a[1],c=a[2],d=a[3],p=a[4],f=[];for(let m=0,x=l.length;m<x;m++){const _=l[m],A=u[m],R=c[m],L=d[m],M=p[m];if(_===void 0)continue;_.updateMatrix();let y;switch(E[M.path]){case E.weights:y=ps;break;case E.rotation:y=re;break;case E.position:case E.scale:default:y=ds;break}const U=_.name?_.name:_.uuid,N=L.interpolation!==void 0?Gs[L.interpolation]:Te,G=[];E[M.path]===E.weights?_.traverse(function(w){w.morphTargetInfluences&&G.push(w.name?w.name:w.uuid)}):G.push(U);let k=R.array;if(R.normalized){const w=se(k.constructor),j=new Float32Array(k.length);for(let b=0,z=k.length;b<z;b++)j[b]=k[b]*w;k=j}for(let w=0,j=G.length;w<j;w++){const b=new y(G[w]+"."+E[M.path],A.array,k,N);L.interpolation==="CUBICSPLINE"&&(b.createInterpolant=function(z){const Se=this instanceof re?Hs:Re;return new Se(this.times,this.values,this.getValueSize()/3,z)},b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),f.push(b)}}const T=e.name?e.name:"animation_"+s;return new Qe(T,void 0,f)})}createNodeMesh(s){const e=this.json,o=this,n=e.nodes[s];return n.mesh===void 0?null:o.getDependency("mesh",n.mesh).then(function(r){const t=o._getNodeRef(o.meshCache,n.mesh,r);return n.weights!==void 0&&t.traverse(function(i){if(i.isMesh)for(let a=0,l=n.weights.length;a<l;a++)i.morphTargetInfluences[a]=n.weights[a]}),t})}loadNode(s){const e=this.json,o=this.extensions,n=this,r=e.nodes[s],t=r.name?n.createUniqueName(r.name):"";return function(){const i=[],a=n._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(s)});return a&&i.push(a),r.camera!==void 0&&i.push(n.getDependency("camera",r.camera).then(function(l){return n._getNodeRef(n.cameraCache,r.camera,l)})),n._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(s)}).forEach(function(l){i.push(l)}),Promise.all(i)}().then(function(i){let a;if(r.isBone===!0?a=new xe:i.length>1?a=new Y:i.length===1?a=i[0]:a=new Ze,a!==i[0])for(let l=0,u=i.length;l<u;l++)a.add(i[l]);if(r.name&&(a.userData.name=r.name,a.name=t),I(a,r),r.extensions&&F(o,a,r),r.matrix!==void 0){const l=new _e;l.fromArray(r.matrix),a.applyMatrix4(l)}else r.translation!==void 0&&a.position.fromArray(r.translation),r.rotation!==void 0&&a.quaternion.fromArray(r.rotation),r.scale!==void 0&&a.scale.fromArray(r.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=s,a})}loadScene(s){const e=this.json,o=this.extensions,n=this.json.scenes[s],r=this,t=new Y;n.name&&(t.name=r.createUniqueName(n.name)),I(t,n),n.extensions&&F(o,t,n);const i=n.nodes||[],a=[];for(let l=0,u=i.length;l<u;l++)a.push(ve(i[l],t,e,r));return Promise.all(a).then(function(){const l=u=>{const c=new Map;for(const[d,p]of r.associations)(d instanceof W||d instanceof te)&&c.set(d,p);return u.traverse(d=>{const p=r.associations.get(d);p!=null&&c.set(d,p)}),c};return r.associations=l(t),t})}}function ve(h,s,e,o){const n=e.nodes[h];return o.getDependency("node",h).then(function(r){if(n.skin===void 0)return r;let t;return o.getDependency("skin",n.skin).then(function(i){t=i;const a=[];for(let l=0,u=t.joints.length;l<u;l++)a.push(o.getDependency("node",t.joints[l]));return Promise.all(a)}).then(function(i){return r.traverse(function(a){if(!a.isMesh)return;const l=[],u=[];for(let c=0,d=i.length;c<d;c++){const p=i[c];if(p){l.push(p);const f=new _e;t.inverseBindMatrices!==void 0&&f.fromArray(t.inverseBindMatrices.array,c*16),u.push(f)}else console.warn('GLTFLoader: Joint "%s" could not be found.',t.joints[c])}a.bind(new $e(l,u),a.matrixWorld)}),r})}).then(function(r){s.add(r);const t=[];if(n.children){const i=n.children;for(let a=0,l=i.length;a<l;a++){const u=i[a];t.push(ve(u,r,e,o))}}return Promise.all(t)})}function zs(h,s,e){const o=s.attributes,n=new ms;if(o.POSITION!==void 0){const i=e.json.accessors[o.POSITION],a=i.min,l=i.max;if(a!==void 0&&l!==void 0){if(n.set(new K(a[0],a[1],a[2]),new K(l[0],l[1],l[2])),i.normalized){const u=se(H[i.componentType]);n.min.multiplyScalar(u),n.max.multiplyScalar(u)}}else{console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=s.targets;if(r!==void 0){const i=new K,a=new K;for(let l=0,u=r.length;l<u;l++){const c=r[l];if(c.POSITION!==void 0){const d=e.json.accessors[c.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(a.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),a.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),a.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){const T=se(H[d.componentType]);a.multiplyScalar(T)}i.max(a)}else console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(i)}h.boundingBox=n;const t=new fs;n.getCenter(t.center),t.radius=n.min.distanceTo(n.max)/2,h.boundingSphere=t}function ue(h,s,e){const o=s.attributes,n=[];function r(t,i){return e.getDependency("accessor",t).then(function(a){h.setAttribute(i,a)})}for(const t in o){const i=ee[t]||t.toLowerCase();i in h.attributes||n.push(r(o[t],i))}if(s.indices!==void 0&&!h.index){const t=e.getDependency("accessor",s.indices).then(function(i){h.setIndex(i)});n.push(t)}return I(h,s),zs(h,s,e),Promise.all(n).then(function(){return s.targets!==void 0?Bs(h,s.targets,e):h})}function he(h,s){let e=h.getIndex();if(e===null){const t=[],i=h.getAttribute("position");if(i!==void 0){for(let a=0;a<i.count;a++)t.push(a);h.setIndex(t),e=h.getIndex()}else return console.error("GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h}const o=e.count-2,n=[];if(s===Ae)for(let t=1;t<=o;t++)n.push(e.getX(0)),n.push(e.getX(t)),n.push(e.getX(t+1));else for(let t=0;t<o;t++)t%2===0?(n.push(e.getX(t)),n.push(e.getX(t+1)),n.push(e.getX(t+2))):(n.push(e.getX(t+2)),n.push(e.getX(t+1)),n.push(e.getX(t)));n.length/3!==o&&console.error("GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=h.clone();return r.setIndex(n),r}const Q=new WeakMap;class Ws extends de{constructor(s){super(s),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(s){return this.decoderPath=s,this}setDecoderConfig(s){return this.decoderConfig=s,this}setWorkerLimit(s){return this.workerLimit=s,this}load(s,e,o,n){const r=new V(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(s,t=>{this.decodeDracoFile(t,e).catch(n)},o,n)}decodeDracoFile(s,e,o,n){const r={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!o};return this.decodeGeometry(s,r).then(e)}decodeGeometry(s,e){const o=JSON.stringify(e);if(Q.has(s)){const a=Q.get(s);if(a.key===o)return a.promise;if(s.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,t=s.byteLength,i=this._getWorker(r,t).then(a=>(n=a,new Promise((l,u)=>{n._callbacks[r]={resolve:l,reject:u},n.postMessage({type:"decode",id:r,taskConfig:e,buffer:s},[s])}))).then(a=>this._createGeometry(a.geometry));return i.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),Q.set(s,{key:o,promise:i}),i}_createGeometry(s){const e=new ge;s.index&&e.setIndex(new X(s.index.array,1));for(let o=0;o<s.attributes.length;o++){const n=s.attributes[o],r=n.name,t=n.array,i=n.itemSize;e.setAttribute(r,new X(t,i))}return e}_loadLibrary(s,e){const o=new V(this.manager);return o.setPath(this.decoderPath),o.setResponseType(e),o.setWithCredentials(this.withCredentials),new Promise((n,r)=>{o.load(s,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const s=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return s?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(o=>{const n=o[0];s||(this.decoderConfig.wasmBinary=o[1]);const r=Ys.toString(),t=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([t]))}),this.decoderPending}_getWorker(s,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){const t=r.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[s]=e,o._taskLoad+=e,o})}_releaseTask(s,e){s._taskLoad-=s._taskCosts[e],delete s._callbacks[e],delete s._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(s=>s._taskLoad))}dispose(){for(let s=0;s<this.workerPool.length;++s)this.workerPool[s].terminate();return this.workerPool.length=0,this}}function Ys(){let h,s;onmessage=function(t){const i=t.data;switch(i.type){case"init":h=i.decoderConfig,s=new Promise(function(u){h.onModuleLoaded=function(c){u({draco:c})},DracoDecoderModule(h)});break;case"decode":const a=i.buffer,l=i.taskConfig;s.then(u=>{const c=u.draco,d=new c.Decoder,p=new c.DecoderBuffer;p.Init(new Int8Array(a),a.byteLength);try{const f=e(c,d,p,l),T=f.attributes.map(m=>m.array.buffer);f.index&&T.push(f.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:f},T)}catch(f){console.error(f),self.postMessage({type:"error",id:i.id,error:f.message})}finally{c.destroy(p),c.destroy(d)}});break}};function e(t,i,a,l){const u=l.attributeIDs,c=l.attributeTypes;let d,p;const f=i.GetEncodedGeometryType(a);if(f===t.TRIANGULAR_MESH)d=new t.Mesh,p=i.DecodeBufferToMesh(a,d);else if(f===t.POINT_CLOUD)d=new t.PointCloud,p=i.DecodeBufferToPointCloud(a,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const T={index:null,attributes:[]};for(const m in u){const x=self[c[m]];let _,A;if(l.useUniqueIDs)A=u[m],_=i.GetAttributeByUniqueId(d,A);else{if(A=i.GetAttributeId(d,t[u[m]]),A===-1)continue;_=i.GetAttribute(d,A)}T.attributes.push(n(t,i,d,m,x,_))}return f===t.TRIANGULAR_MESH&&(T.index=o(t,i,d)),t.destroy(d),T}function o(t,i,a){const l=a.num_faces()*3,u=l*4,c=t._malloc(u);i.GetTrianglesUInt32Array(a,u,c);const d=new Uint32Array(t.HEAPF32.buffer,c,l).slice();return t._free(c),{array:d,itemSize:1}}function n(t,i,a,l,u,c){const d=c.num_components(),p=a.num_points()*d,f=p*u.BYTES_PER_ELEMENT,T=r(t,u),m=t._malloc(f);i.GetAttributeDataArrayForAllPoints(a,c,T,f,m);const x=new u(t.HEAPF32.buffer,m,p).slice();return t._free(m),{name:l,array:x,itemSize:d}}function r(t,i){switch(i){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}}const Js=new Map,Me=new xs,we=new Ws;Le(h=>we.setDecoderPath(h));Me.setDRACOLoader(we);const Zs=async(h,s)=>{const[e,o]=await be(Js,h,()=>new Promise((n,r)=>{es(),Me.load(h,t=>{var i;ne();const a=[];let l=!0;for(const u of t.scenes)u.traverse(c=>{c instanceof gs?a.push(c):l&&c instanceof xe&&(l=!1),c.castShadow=!0,c.receiveShadow=!0});for(const u of a)(i=u.parent)==null||i.remove(u);n([t,l])},ss(h),()=>{ne(),r()})}));return s?Ee(e.scene,o,e.animations):e.scene};export{Zs as default};
