(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8108],{96021:function(t){var e=Object.defineProperty,s=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,c=(t,e)=>{for(var s in e||(e={}))o.call(e,s)&&r(t,s,e[s]);if(i)for(var s of i(e))a.call(e,s)&&r(t,s,e[s]);return t},h=(t,e)=>s(t,n(e)),l=(t,e)=>{var s={};for(var n in t)o.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&i)for(var n of i(t))e.indexOf(n)<0&&a.call(t,n)&&(s[n]=t[n]);return s},u=(t,e,s)=>(r(t,"symbol"!=typeof e?e+"":e,s),s),d=(t,e,s)=>new Promise(((n,i)=>{var o=t=>{try{r(s.next(t))}catch(e){i(e)}},a=t=>{try{r(s.throw(t))}catch(e){i(e)}},r=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);r((s=s.apply(t,e)).next())}));t.exports=function(){"use strict";"undefined"!=typeof window&&(window.TONE_SILENCE_LOGGING=!0);var t,e,s={228(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n},t.exports.__esModule=!0,t.exports.default=t.exports},858(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},575(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},913(t){function e(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},884(t){t.exports=function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var n,i,o=[],a=!0,r=!1;try{for(s=s.call(t);!(a=(n=s.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(p){r=!0,i=p}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return o}},t.exports.__esModule=!0,t.exports.default=t.exports},521(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},38(t,e,s){var n=s(858),i=s(884),o=s(379),a=s(521);t.exports=function(t,e){return n(t)||i(t,e)||o(t,e)||a()},t.exports.__esModule=!0,t.exports.default=t.exports},379(t,e,s){var n=s(228);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var s={}.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},382(t,e,s){!function(t,e,s,n){function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=i(e),a=i(s),r=i(n),c=function(t,e,s){return{endTime:e,insertTime:s,type:"exponentialRampToValue",value:t}},h=function(t,e,s){return{endTime:e,insertTime:s,type:"linearRampToValue",value:t}},l=function(t,e){return{startTime:e,type:"setValue",value:t}},u=function(t,e,s){return{duration:s,startTime:e,type:"setValueCurve",values:t}},d=function(t,e,s){var n=s.target;return n+(e-n)*Math.exp((s.startTime-t)/s.timeConstant)},p=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},m=function(t){return p(t)||f(t)},g=function(t){return"setValue"===t.type},_=function(t){return"setValueCurve"===t.type},y=function t(e,s,n,i){var o=e[s];return void 0===o?i:m(o)||g(o)?o.value:_(o)?o.values[o.values.length-1]:d(n,t(e,s-1,o.startTime,i),o)},v=function(t,e,s,n,i){return void 0===s?[n.insertTime,i]:m(s)?[s.endTime,s.value]:g(s)?[s.startTime,s.value]:_(s)?[s.startTime+s.duration,s.values[s.values.length-1]]:[s.startTime,y(t,e-1,s.startTime,i)]},x=function(t){return"cancelAndHold"===t.type},b=function(t){return"cancelScheduledValues"===t.type},w=function(t){return x(t)||b(t)?t.cancelTime:p(t)||f(t)?t.endTime:t.startTime},T=function(t,e,s,n){var i=n.value;return s===i?i:0<s&&0<i||s<0&&i<0?s*Math.pow(i/s,(t-e)/(n.endTime-e)):0},S=function(t,e,s,n){return s+(t-e)/(n.endTime-e)*(n.value-s)},k=function(t,e){var s=e.values;return function(t,e){var s=Math.floor(e),n=Math.ceil(e);return s===n?t[s]:(1-(e-s))*t[s]+(1-(n-e))*t[n]}(s,(t-e.startTime)/e.duration*(s.length-1))},A=function(t){return"setTarget"===t.type},M=function(t){function e(t){a.default(this,e),this._automationEvents=[],this._currenTime=0,this._defaultValue=t}return r.default(e,[{key:t,value(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value(t){var e=w(t);if(x(t)||b(t)){var s=this._automationEvents.findIndex((function(s){return b(t)&&_(s)?s.startTime+s.duration>=e:w(s)>=e})),n=this._automationEvents[s];if(-1!==s&&(this._automationEvents=this._automationEvents.slice(0,s)),x(t)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==n&&m(n)){if(A(i))throw new Error("The internal list is malformed.");var o=_(i)?i.startTime+i.duration:w(i),a=_(i)?i.values[i.values.length-1]:i.value,r=p(n)?T(e,o,a,n):S(e,o,a,n),d=p(n)?c(r,e,this._currenTime):h(r,e,this._currenTime);this._automationEvents.push(d)}void 0!==i&&A(i)&&this._automationEvents.push(l(this.getValue(e),e)),void 0!==i&&_(i)&&i.startTime+i.duration>e&&(this._automationEvents[this._automationEvents.length-1]=u(new Float32Array([6,7]),i.startTime,e-i.startTime))}}else{var g=this._automationEvents.findIndex((function(t){return w(t)>e})),y=-1===g?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[g-1];if(void 0!==y&&_(y)&&w(y)+y.duration>e)return!1;var v=p(t)?c(t.value,t.endTime,this._currenTime):f(t)?h(t.value,e,this._currenTime):t;if(-1===g)this._automationEvents.push(v);else{if(_(t)&&e+t.duration>w(this._automationEvents[g]))return!1;this._automationEvents.splice(g,0,v)}}return!0}},{key:"flush",value(t){var e=this._automationEvents.findIndex((function(e){return w(e)>t}));if(e>1){var s=this._automationEvents.slice(e-1),n=s[0];A(n)&&s.unshift(l(y(this._automationEvents,e-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=s}}},{key:"getValue",value(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex((function(e){return w(e)>t})),s=this._automationEvents[e],n=(-1===e?this._automationEvents.length:e)-1,i=this._automationEvents[n];if(void 0!==i&&A(i)&&(void 0===s||!m(s)||s.insertTime>t))return d(t,y(this._automationEvents,n-1,i.startTime,this._defaultValue),i);if(void 0!==i&&g(i)&&(void 0===s||!m(s)))return i.value;if(void 0!==i&&_(i)&&(void 0===s||!m(s)||i.startTime+i.duration>t))return t<i.startTime+i.duration?k(t,i):i.values[i.values.length-1];if(void 0!==i&&m(i)&&(void 0===s||!m(s)))return i.value;if(void 0!==s&&p(s)){var a=v(this._automationEvents,n,i,s,this._defaultValue),r=o.default(a,2);return T(t,r[0],r[1],s)}if(void 0!==s&&f(s)){var c=v(this._automationEvents,n,i,s,this._defaultValue),h=o.default(c,2);return S(t,h[0],h[1],s)}return this._defaultValue}}]),e}(Symbol.iterator);t.AutomationEventList=M,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,s){return{startTime:e,target:t,timeConstant:s,type:"setTarget"}},t.createSetValueAutomationEvent=l,t.createSetValueCurveAutomationEvent=u,Object.defineProperty(t,"__esModule",{value:!0})}(e,s(38),s(575),s(913))},694(t){t.exports=(()=>{var t={d(e,s){for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>({}.hasOwnProperty.call(t,e)),r(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{MarkovN:()=>h,utils:()=>n});const s={mtof:t=>440*Math.pow(2,t/12),ftom:t=>Math.sqrt(t/440)/12,choose:t=>t[Math.floor(Math.random()*t.length)],getRateFromFrequencies:(t,e)=>t/e,getClosestMember:(t,e)=>e.reduce(((e,s)=>{const n=e-t;return Math.abs(s-t)<Math.abs(n)?s:e}),e[0]),findInCollection:(t,e)=>t.reduce(((t,s)=>e(s)?s:t)),mapToDomain(t,e){const n=Math.min(...e)-Math.min(...t),i=Math.max(...e)-Math.min(...e),o=Math.max(...t)-Math.min(...t);return t.map((a=>s.getClosestMember((a-Math.min(...t))/o*i+n,e)))},flipCoin:(t=.5)=>!(Math.random()<t),makeFunction:t=>"function"==typeof t?t:()=>t},n=s,i=t=>{let e=t.reduce(((t,e)=>t+e));return t.map(e>0?t=>t/e:()=>0)},o=(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){let s=0;return t.forEach(((t,n)=>{a(t,e[n])&&(s+=1)})),s===t.length}return!(Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))&&a(t,e)},a=(t,e)=>{if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e||null==t||null==e)return!1;let s=Object.keys(t),n=Object.keys(e);if(s.length!=n.length)return!1;for(let i of s){if(!n.includes(i))return!1;if("function"==typeof t[i]||"function"==typeof e[i]){if(t[i].toString()!=e[i].toString())return!1}else if(!a(t[i],e[i]))return!1}return!0},r=(t,e)=>(t%e+e)%e,c=(t,e)=>{const s=[...t];return s.shift(),s.push(e),s},h=class{constructor(t,e){this.dictionary=[],this.combinations=[],this.lastState=[];for(let s=0;s<e;s++)this.lastState.push(t[s]);this.transitionMatrix=this.createTransitionMatrix(t,e)}createTransitionMatrix(t,e){var s,n;this.dictionary=t.reduce(((t,e)=>{let s=!1;return t.forEach((t=>{o(t,e)&&(s=!0)})),s||t.push(e),t}),[]),this.combinations=(n=e,(s=t).reduce(((t,e,i)=>{const o=[];for(let a=n;a>=0;a--)o.push(s[r(i-a,s.length)]);return t.push(o),t}),[]));let a=[];for(let i=0;i<this.combinations.length;i++){let t=[];for(let e=0;e<this.dictionary.length;e++)t.push(0);a.push(t)}for(let i=0;i<t.length;i++){let s=[];for(let o=e;o>=0;o--)s.push(t[r(i-o,t.length)]);let n=this.combinations.findIndex((t=>o(s,t))),c=t[(i+1)%t.length],h=this.dictionary.findIndex((t=>o(c,t)));a[n][h]++}return a=a.map(i),a}getNextState(t){const e=(t=>{let e=t.reduce(((t,e)=>t+e)),s=Math.random()*e,n=0;for(let i=0;i<t.length;i++)if(n+=t[i],n=+n.toFixed(2),s<=n)return i})(this.transitionMatrix[this.combinations.findIndex((e=>o(t,e)))]);return this.dictionary[e]}*asPattern(t){for(this.lastState=t;;){let t=this.getNextState(this.lastState);this.lastState=c(this.lastState,t),yield t}}};return e})()},436(t,e,s){var n=this&&this.__generator||function(t,e){var s,n,i,o,a={label:0,sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(r){o=[6,r],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},i=this&&this.__spreadArray||function(t,e,s){if(s||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=[].slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||[].slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.Genetic=void 0;var o=s(778),a=function(){function t(t,e){this.population=t,this.scores=Array(t.length).fill(0),this.goal=e,this.lastState=t[Math.floor(Math.random()*(t.length-1))]}return t.prototype.getTotalFitnessRating=function(t,e){for(var s=0,n=t.map((function(e){return e-Math.min.apply(null,t)})),i=n.length-1;i>=0;i--)s+=this.getDistance(n[i],e[i]);return s},t.prototype.getTopTwoGenerations=function(t,e){for(var s=0,n=t.length-1;n>=0;n--)t[s]<t[n]&&(s=n),t[s]===t[n]&&(s=(0,o.flipCoin)(.5)?s:n);var i=0,a=t[s];if((0,o.flipCoin)(.75))i=Math.floor(Math.random()*t.length);else for(n=t.length-1;n>=0;n--)t[n]!==a&&(t[i]<t[n]&&(i=n),t[i]===t[n]&&(i=Math.random()>.5?i:n));return[e[s],e[i]]},t.prototype.mateGenerations=function(t){return[this.getSplicedOffspring(t[0],t[1]),this.getInterlacedOffspring(t[0],t[1])]},t.prototype.getInterlacedOffspring=function(t,e){for(var s=Array(t.length),n=s.length-1;n>=0;n--)s[n]=n%2==0?t[n]:e[n];return s},t.prototype.getSplicedOffspring=function(t,e){var s=0==(Math.random()>.5?1:0)?[t,e]:[e,t],n=Math.floor(t.length/2);return i(i([],s[0].slice(0,n),!0),s[1].slice(n-1,s[1].length-1),!0)},t.prototype.getDistance=function(t,e){return e-t},t.prototype.getPopulationScores=function(t,e){for(var s=Array(t.length).fill(0),n=t.length-1;n>=0;n--)s[n]=this.getTotalFitnessRating(t[n],e);return s},t.prototype.getNextGeneration=function(t,e){for(var s=this.getPopulationScores(t,e),n=this.getTopTwoGenerations(s,t),o=this.mateGenerations(n),a=0;a<o.length-1;a++)this.population.splice(Math.floor(Math.random()*(this.population.length-1)),1);return this.population=i(i([],this.population,!0),o,!0),o[Math.floor(Math.random()*(.999*o.length))]},t.prototype.getNextState=function(){return this.getNextGeneration(this.population,this.goal)},t.prototype.asPattern=function(){var t=this;return function(e){var s;return n(this,(function(n){switch(n.label){case 0:t.lastState=e,n.label=1;case 1:return s=t.getNextState(t.lastState),t.lastState=s,[4,s];case 2:return n.sent(),[3,1];case 3:return[2]}}))}},t}();e.Genetic=a},444(t,e,s){var n=this&&this.__generator||function(t,e){var s,n,i,o,a={label:0,sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(r){o=[6,r],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=s(941),o=s(778);e.default=function(t,e){var s,a,r;return n(this,(function(n){switch(n.label){case 0:if(s=0,a=function(){var e=(0,o.getSequentialRandomIndex)(s,t.length);return s=e,(0,i.unwrapValue)(t[e])},null!=e)return[3,4];n.label=1;case 1:return[4,a()];case 2:return n.sent(),[3,1];case 3:return[3,8];case 4:r=0,n.label=5;case 5:return r<e?[4,a()]:[3,8];case 6:n.sent(),n.label=7;case 7:return r++,[3,5];case 8:return[2]}}))}},807(t,e,s){var n=this&&this.__generator||function(t,e){var s,n,i,o,a={label:0,sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(r){o=[6,r],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=s(436);e.default=function(t,e){var s,o,a;return n(this,(function(n){switch(n.label){case 0:s=new i.Genetic(t,e),o=e,n.label=1;case 1:return a=s.getNextState(o),o=[o[o.length-1],a],[4,a];case 2:return n.sent(),[3,1];case 3:return[2]}}))}},696(t,e,s){Object.defineProperty(e,"__esModule",{value:!0});var n=s(694);e.default=function(t,e,s){return new n.MarkovN(t,e).asPattern(s)}},856(t,e,s){var n=this&&this.__generator||function(t,e){var s,n,i,o,a={label:0,sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(r){o=[6,r],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=s(941);e.default=function(t,e){var s,o;return n(this,(function(n){switch(n.label){case 0:if(s=function(){var e=t[Math.floor(Math.random()*t.length)];return(0,i.unwrapValue)(e)},null!=e)return[3,4];n.label=1;case 1:return[4,s()];case 2:return n.sent(),[3,1];case 3:return[3,8];case 4:o=0,n.label=5;case 5:return o<e?[4,s()]:[3,8];case 6:n.sent(),n.label=7;case 7:return o++,[3,5];case 8:return[2]}}))}},491(t,e,s){var n=this&&this.__generator||function(t,e){var s,n,i,o,a={label:0,sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(r){o=[6,r],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Pseq=void 0;var i=s(941);function o(t,e){var s,o,a,r;return n(this,(function(n){switch(n.label){case 0:if(s=0,o=function(){var e,n=t[s++%t.length];return null==(e=(0,i.unwrapValue)(n))&&n.next().done?(n.reset(),n=t[s++%t.length],e=(0,i.unwrapValue)(n)):null==e&&(n=t[s++%t.length],e=(0,i.unwrapValue)(n)),e},null!=e)return[3,4];n.label=1;case 1:return[4,o()];case 2:return n.sent(),[3,1];case 3:return[3,10];case 4:a=0,n.label=5;case 5:if(!(a<e))return[3,10];r=0,n.label=6;case 6:return r<t.length?[4,o()]:[3,9];case 7:n.sent(),n.label=8;case 8:return r++,[3,6];case 9:return a++,[3,5];case 10:return[2]}}))}e.Pseq=o,e.default=function(t,e){return(0,i.resettableGenerator)(o)(t,e)}},540(t,e,s){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.utils=e.Pgenetic=e.Pmarkov=e.Pchoose=e.Prand=e.Pseq=e.Pattern=void 0,e.Pattern=function(t){return[function(){return t.next().value}]};var i=s(491);Object.defineProperty(e,"Pseq",{enumerable:!0,get:()=>n(i).default});var o=s(856);Object.defineProperty(e,"Prand",{enumerable:!0,get:()=>n(o).default});var a=s(444);Object.defineProperty(e,"Pchoose",{enumerable:!0,get:()=>n(a).default});var r=s(696);Object.defineProperty(e,"Pmarkov",{enumerable:!0,get:()=>n(r).default});var c=s(807);Object.defineProperty(e,"Pgenetic",{enumerable:!0,get:()=>n(c).default});var h=s(778);Object.defineProperty(e,"utils",{enumerable:!0,get:()=>n(h).default})},941(t,e){var s=this&&this.__spreadArray||function(t,e,s){if(s||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=[].slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||[].slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.resettableGenerator=e.unwrapValue=void 0,e.unwrapValue=function(t){return t.hasOwnProperty("next")?t.next().value:"function"==typeof t?t():t},e.resettableGenerator=function(t){return new Proxy(t,{apply(t,e,n){var i=t.call.apply(t,s([e],n,!1)),o=i.next,a=i;return i.next=function(){return a===i?o.call(i):a.next()},Object.defineProperty(a,"reset",{enumerable:!1,value:()=>a=t.call.apply(t,s([e],n,!1))}),a}})}},778(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSequentialRandomIndex=e.mod=e.isEquivalent=e.normalize=e.windex=e.makeFunction=e.flipCoin=e.mapToDomain=e.findInCollection=e.getClosestMember=e.getRateFromFrequencies=e.choose=e.ftom=e.mtof=void 0,e.mtof=function(t){return 440*Math.pow(2,t/12)},e.ftom=function(t){return Math.sqrt(t/440)/12},e.choose=function(t){return t[Math.floor(Math.random()*t.length)]},e.getRateFromFrequencies=function(t,e){return t/e},e.getClosestMember=function(t,e){return e.reduce((function(e,s){var n=e-t;return Math.abs(s-t)<Math.abs(n)?s:e}),e[0])},e.findInCollection=function(t,e){return t.reduce((function(t,s){return e(s)?s:t}))},e.mapToDomain=function(t,s){var n=Math.min.apply(Math,s)-Math.min.apply(Math,t),i=Math.max.apply(Math,s)-Math.min.apply(Math,s),o=Math.max.apply(Math,t)-Math.min.apply(Math,t);return t.map((function(a){return(0,e.getClosestMember)((a-Math.min.apply(Math,t))/o*i+n,s)}))},e.flipCoin=function(t){return void 0===t&&(t=.5),Math.random()<t},e.makeFunction=function(t){return"function"==typeof t?t:function(){return t}},e.windex=function(t){for(var e=t.reduce((function(t,e){return t+e})),s=Math.random()*e,n=0,i=0;i<t.length;i++)if(s<=(n=+(n+=t[i]).toFixed(2)))return i;return 0},e.normalize=function(t){var e=t.reduce((function(t,e){return t+e}));return t.map(e>0?function(t){return t/e}:function(){return 0})},e.isEquivalent=function(t,e){var s=Object.getOwnPropertyNames(t),n=Object.getOwnPropertyNames(e);if(s.length!=n.length)return!1;for(var i=0;i<s.length;i++){var o=s[i];if(t[o]!==e[o])return!1}return!0},e.mod=function(t,e){return(t%e+e)%e},e.getSequentialRandomIndex=function(t,s){var n=Array(s).fill(0).map((function(t,e){return e})).filter((function(e){return e!==t}));return(0,e.choose)(n)},e.default={mtof:e.mtof,ftom:e.ftom,choose:e.choose,getRateFromFrequencies:e.getRateFromFrequencies,getClosestMember:e.getClosestMember,findInCollection:e.findInCollection,mapToDomain:e.mapToDomain,flipCoin:e.flipCoin,makeFunction:e.makeFunction,windex:e.windex,normalize:e.normalize,isEquivalent:e.isEquivalent,mod:e.mod,getSequentialRandomIndex:e.getSequentialRandomIndex}}},n={};function i(t){var e=n[t];if(void 0!==e)return e.exports;var o=n[t]={exports:{}};return s[t].call(o.exports,o,o.exports,i),o.exports}i.m=s,i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,s)=>(i.f[s](t,e),e)),[])),i.u=t=>t+"-esm-002453f8cf7b5d82dedb.js",i.o=(t,e)=>({}.hasOwnProperty.call(t,e)),t={},e="@plan8/klang:",i.l=(s,n,o)=>{if(t[s])t[s].push(n);else{var a,r;if(void 0!==o)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var l=c[h];if(l.getAttribute("src")==s||l.getAttribute("data-webpack")==e+o){a=l;break}}a||(r=!0,(a=document.createElement("script")).type="module",a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",e+o),a.src=s),t[s]=[n];var u=(e,n)=>{a.onerror=a.onload=null,clearTimeout(d);var i=t[s];if(delete t[s],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(n))),e)return e(n)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),r&&document.head.appendChild(a)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.p="",(()=>{var t={179:0};i.f.j=(e,s)=>{var n=i.o(t,e)?t[e]:void 0;if(0!==n)if(n)s.push(n[2]);else{var o=new Promise(((s,i)=>n=t[e]=[s,i]));s.push(n[2]=o);var a=i.p+i.u(e),r=new Error;i.l(a,(s=>{if(i.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var o=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.src;r.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",r.name="ChunkLoadError",r.type=o,r.request=a,n[1](r)}}),"chunk-"+e,e)}};var e=(e,s)=>{var n,o,[a,r,c]=s,h=0;if(a.some((e=>0!==t[e]))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);c&&c(i)}for(e&&e(s);h<a.length;h++)i.o(t,o=a[h])&&t[o]&&t[o][0](),t[o]=0},s=self.webpackChunk_plan8_klang=self.webpackChunk_plan8_klang||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var o={};(()=>{i.d(o,{qk:()=>Fh,UI:()=>Vh,gt:()=>vh,Gc:()=>yh,$W:()=>gh,hG:()=>Ac,G7:()=>Ah,FY:()=>qh,mb:()=>Th,Lz:()=>Ja,Ig:()=>Ph.Pchoose,Go:()=>Ih,Xw:()=>Rh,J5:()=>bh,BX:()=>Ph.Pmarkov,YX:()=>Ph.Prand,Jr:()=>Ph.Pseq,Z4:()=>xh,i$:()=>Ch,dz:()=>s,J7:()=>vc,ry:()=>Fc,bz:()=>Eh,oi:()=>Dh,zO:()=>_c,P6:()=>Qc});var t={};i.r(t),i.d(t,{assert:()=>Nn,assertContextRunning:()=>Bn,assertRange:()=>jn,log:()=>Wn,setLogger:()=>Gn,warn:()=>Un});var e={};i.r(e);var s={};i.r(s),i.d(s,{AMOscillator:()=>Yo,AMSynth:()=>Ca,Abs:()=>da,Add:()=>na,AmplitudeEnvelope:()=>ka,Analyser:()=>Yr,AudioToGain:()=>Xo,AutoFilter:()=>pr,AutoPanner:()=>mr,AutoWah:()=>_r,BaseContext:()=>Oi,BiquadFilter:()=>Oa,BitCrusher:()=>vr,Buffer:()=>Dc,BufferSource:()=>Pc,Buffers:()=>Ec,Channel:()=>ic,Chebyshev:()=>br,Chorus:()=>Ar,Clock:()=>vo,Compressor:()=>lc,Context:()=>Di,Convolver:()=>gc,CrossFade:()=>lr,DCMeter:()=>tc,Delay:()=>xo,Destination:()=>bc,Distortion:()=>Mr,Draw:()=>Ac,DuoSynth:()=>Ia,EQ3:()=>mc,Emitter:()=>Ci,Envelope:()=>ba,FFT:()=>Kr,FMOscillator:()=>Ho,FMSynth:()=>Ra,FatOscillator:()=>Ko,FeedbackCombFilter:()=>Wa,FeedbackDelay:()=>Or,Filter:()=>Da,Follower:()=>gr,Freeverb:()=>Rr,Frequency:()=>to,FrequencyClass:()=>Hi,FrequencyEnvelope:()=>Ea,FrequencyShifter:()=>Er,Gain:()=>lo,GainToAudio:()=>pa,Gate:()=>uc,GrainPlayer:()=>ua,GreaterThan:()=>_a,GreaterThanZero:()=>ga,IntervalTimeline:()=>Co,JCReverb:()=>Lr,LFO:()=>aa,Limiter:()=>dc,Listener:()=>Sc,Loop:()=>Ha,LowpassCombFilter:()=>$a,Master:()=>wc,MembraneSynth:()=>Va,Merge:()=>Tr,MetalSynth:()=>Fa,Meter:()=>Jr,MidSideCompressor:()=>pc,MidSideMerge:()=>Ur,MidSideSplit:()=>Wr,Midi:()=>So,MidiClass:()=>To,Mono:()=>oc,MonoSynth:()=>Pa,MultibandCompressor:()=>fc,MultibandSplit:()=>ac,Multiply:()=>Zo,Negate:()=>fa,Noise:()=>Lo,NoiseSynth:()=>La,Offline:()=>bo,OfflineContext:()=>qi,OmniOscillator:()=>sa,OnePoleFilter:()=>Ua,Oscillator:()=>Uo,PWMOscillator:()=>ta,PanVol:()=>nc,Panner:()=>fr,Panner3D:()=>cc,Param:()=>oo,Part:()=>Ja,Pattern:()=>cr,Phaser:()=>zr,PingPongDelay:()=>jr,PitchShift:()=>Br,Player:()=>ha,Players:()=>la,PluckSynth:()=>Qa,PolySynth:()=>Xa,Pow:()=>ya,PulseOscillator:()=>Jo,Recorder:()=>hc,Reverb:()=>Gr,Sampler:()=>Za,Scale:()=>ia,ScaleExp:()=>va,Sequence:()=>hr,Signal:()=>fo,Solo:()=>sc,Split:()=>wr,StateTimeline:()=>io,StereoWidener:()=>Qr,Subtract:()=>ma,SyncedSignal:()=>xa,Synth:()=>Aa,Ticks:()=>Ao,TicksClass:()=>ko,Time:()=>Yi,TimeClass:()=>Zi,Timeline:()=>Ti,ToneAudioBuffer:()=>Ri,ToneAudioBuffers:()=>wo,ToneAudioNode:()=>ao,ToneBufferSource:()=>Vo,ToneEvent:()=>Ya,ToneOscillatorNode:()=>Wo,Transport:()=>vc,TransportTime:()=>so,TransportTimeClass:()=>eo,Tremolo:()=>Xr,Unit:()=>e,UserMedia:()=>zo,Vibrato:()=>Zr,Volume:()=>Do,WaveShaper:()=>Qo,Waveform:()=>ec,Zero:()=>oa,connect:()=>co,connectSeries:()=>ro,connectSignal:()=>mo,context:()=>Cc,dbToGain:()=>Bi,debug:()=>t,defaultArg:()=>fi,disconnect:()=>ho,ftom:()=>Ui,gainToDb:()=>zi,getContext:()=>Li,getDestination:()=>Tc,getDraw:()=>Mc,getListener:()=>kc,getTransport:()=>xc,immediate:()=>yc,intervalToFrequencyRatio:()=>Gi,isArray:()=>Jn,isBoolean:()=>Hn,isDefined:()=>Qn,isFunction:()=>Xn,isNote:()=>ti,isNumber:()=>Zn,isObject:()=>Yn,isString:()=>Kn,isUndef:()=>$n,loaded:()=>Oc,mtof:()=>Qi,now:()=>_c,optionsFromArguments:()=>pi,setContext:()=>Ni,start:()=>ji,supported:()=>Ln,version:()=>n});const n="14.7.77";var a=i(382);const r=new WeakSet,u=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,_=new WeakMap,y=new WeakMap,v=new WeakMap,x=new WeakMap,b={construct:()=>b},w=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,T=(t,e)=>{const s=[];let n=t.replace(/^[\s]+/,""),i=n.match(w);for(;null!==i;){const t=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());s.push(o),n=n.slice(i[0].length).replace(/^[\s]+/,""),i=n.match(w)}return[s.join(";"),n]},S=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},k=t=>{if(!(t=>{try{new new Proxy(t,b)}catch(e){return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},A=(t,e)=>{const s=t.get(e);if(void 0===s)throw new Error("A value with the given key could not be found.");return s},M=(t,e)=>{const s=Array.from(t).filter(e);if(s.length>1)throw Error("More than one element was found.");if(0===s.length)throw Error("No element was found.");const[n]=s;return t.delete(n),n},C=(t,e,s,n)=>{const i=A(t,e),o=M(i,(t=>t[0]===s&&t[1]===n));return 0===i.size&&t.delete(e),o},O=t=>A(_,t),D=t=>{if(r.has(t))throw new Error("The AudioNode is already stored.");r.add(t),O(t).forEach((t=>t(!0)))},E=t=>"port"in t,P=t=>{if(!r.has(t))throw new Error("The AudioNode is not stored.");r.delete(t),O(t).forEach((t=>t(!1)))},I=(t,e)=>{!E(t)&&e.every((t=>0===t.size))&&P(t)},R={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},q=(t,e)=>t.context===e,F=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch(e){return!1}return!0},V=()=>new DOMException("","IndexSizeError"),L=t=>{var e;t.getChannelData=(e=t.getChannelData,s=>{try{return e.call(t,s)}catch(n){if(12===n.code)throw V();throw n}})},N={numberOfChannels:1},j=-34028234663852886e22,B=-j,z=t=>r.has(t),G={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},W=t=>A(u,t),U=t=>A(f,t),$=(t,e)=>{const{activeInputs:s}=W(t);s.forEach((s=>s.forEach((([s])=>{e.includes(t)||$(s,[...e,t])}))));const n="playbackRate"in t?[t.playbackRate]:E(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const i of n){const t=U(i);void 0!==t&&t.activeInputs.forEach((([t])=>$(t,e)))}z(t)&&P(t)},Q=t=>{$(t.destination,[])},X=t=>"context"in t,Z=t=>X(t[0]),Y=(t,e,s,n)=>{for(const i of t)if(s(i)){if(n)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},H=(t,e,[s,n],i)=>{Y(t,[e,s,n],(t=>t[0]===e&&t[1]===s),i)},J=(t,[e,s,n],i)=>{const o=t.get(e);void 0===o?t.set(e,new Set([[s,n]])):Y(o,[s,n],(t=>t[0]===s),i)},K=t=>"inputs"in t,tt=(t,e,s,n)=>{if(K(e)){const i=e.inputs[n];return t.connect(i,s,0),[i,s,0]}return t.connect(e,s,n),[e,s,n]},et=(t,e,s)=>{for(const n of t)if(n[0]===e&&n[1]===s)return t.delete(n),n;return null},st=(t,e)=>{if(!O(t).delete(e))throw new Error("Missing the expected event listener.")},nt=(t,e,s)=>{const n=A(t,e),i=M(n,(t=>t[0]===s));return 0===n.size&&t.delete(e),i},it=(t,e,s,n)=>{K(e)?t.disconnect(e.inputs[n],s,0):t.disconnect(e,s,n)},ot=t=>A(p,t),at=t=>A(m,t),rt=t=>y.has(t),ct=t=>!r.has(t),ht=(t,e)=>new Promise((s=>{if(null!==e)s(!0);else{const e=t.createScriptProcessor(256,1,1),n=t.createGain(),i=t.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const a=t.createBufferSource();a.buffer=i,a.loop=!0,a.connect(e).connect(t.destination),a.connect(n),a.disconnect(n),e.onaudioprocess=n=>{const i=n.inputBuffer.getChannelData(0);[].some.call(i,(t=>1===t))?s(!0):s(!1),a.stop(),e.onaudioprocess=null,a.disconnect(e),e.disconnect(t.destination)},a.start()}})),lt=(t,e)=>{const s=new Map;for(const n of t)for(const t of n){const e=s.get(t);s.set(t,void 0===e?1:e+1)}s.forEach(((t,s)=>e(s,t)))},ut=t=>"context"in t,dt=(t,e,s,n,i)=>{const[o,a]=((t,e,s,n)=>{const{activeInputs:i,passiveInputs:o}=W(e),a=et(i[n],t,s);return null===a?[C(o,t,s,n)[2],!1]:[a[2],!0]})(t,s,n,i);if(null!==o&&(st(t,o),!a||e||rt(t)||it(ot(t),ot(s),n,i)),z(s)){const{activeInputs:t}=W(s);I(s,t)}},pt=(t,e,s,n)=>{const[i,o]=((t,e,s)=>{const{activeInputs:n,passiveInputs:i}=U(e),o=et(n,t,s);return null===o?[nt(i,t,s)[1],!1]:[o[2],!0]})(t,s,n);null!==i&&(st(t,i),!o||e||rt(t)||ot(t).disconnect(at(s),n))};class ft{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((s,n)=>t.call(e,s,n,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const mt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function gt(t,e,s,n,i){if("function"==typeof t.copyFromChannel)0===e[s].byteLength&&(e[s]=new Float32Array(128)),t.copyFromChannel(e[s],n,i);else{const o=t.getChannelData(n);if(0===e[s].byteLength)e[s]=o.slice(i,i+128);else{const t=new Float32Array(o.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[s].set(t)}}}const _t=(t,e,s,n,i)=>{"function"==typeof t.copyToChannel?0!==e[s].byteLength&&t.copyToChannel(e[s],n,i):0!==e[s].byteLength&&t.getChannelData(n).set(e[s],i)},yt=(t,e)=>{const s=[];for(let n=0;n<t;n+=1){const t=[],i="number"==typeof e?e:e[n];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));s.push(t)}return s},vt=(t,e,s,n,i,o,a)=>d(this,null,(function*(){const r=null===e?128*Math.ceil(t.context.length/128):e.length,l=n.channelCount*n.numberOfInputs,u=i.reduce(((t,e)=>t+e),0),d=0===u?null:s.createBuffer(u,r,s.sampleRate);if(void 0===o)throw new Error("Missing the processor constructor.");const p=W(t),f=yield((t,e)=>{const s=A(x,t),n=ot(e);return A(s,n)})(s,t),m=yt(n.numberOfInputs,n.channelCount),g=yt(n.numberOfOutputs,i),_=Array.from(t.parameters.keys()).reduce(((t,e)=>h(c({},t),{[e]:new Float32Array(128)})),{});for(let c=0;c<r;c+=128){if(n.numberOfInputs>0&&null!==e)for(let t=0;t<n.numberOfInputs;t+=1)for(let s=0;s<n.channelCount;s+=1)gt(e,m[t],s,s,c);void 0!==o.parameterDescriptors&&null!==e&&o.parameterDescriptors.forEach((({name:t},s)=>{gt(e,_,t,l+s,c)}));for(let t=0;t<n.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===g[t][e].byteLength&&(g[t][e]=new Float32Array(128));try{const t=m.map(((t,e)=>0===p.activeInputs[e].size?[]:t)),e=a(c/s.sampleRate,s.sampleRate,(()=>f.process(t,g,_)));if(null!==d)for(let s=0,o=0;s<n.numberOfOutputs;s+=1){for(let t=0;t<i[s];t+=1)_t(d,g[s],t,o+t,c);o+=i[s]}if(!e)break}catch(b){t.dispatchEvent(new ErrorEvent("processorerror",{colno:b.colno,filename:b.filename,lineno:b.lineno,message:b.message}));break}}return d})),xt={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},bt={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},wt={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Tt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},St={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},kt=t=>{const{port1:e,port2:s}=new MessageChannel;return new Promise((n=>{const i=()=>{s.onmessage=null,e.close(),s.close(),n()};s.onmessage=()=>i();try{e.postMessage(t,[t])}finally{i()}}))},At={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Mt=(t,e,s)=>{const n=e[s];if(void 0===n)throw t();return n},Ct={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Ot={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Dt=()=>new DOMException("","InvalidStateError"),Et=()=>new DOMException("","InvalidAccessError"),Pt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},It=(t,e,s,n,i,o,a,r,c,h,l)=>{const u=h.length;let d=r;for(let p=0;p<u;p+=1){let r=s[0]*h[p];for(let e=1;e<i;e+=1){const n=d-e&c-1;r+=s[e]*o[n],r-=t[e]*a[n]}for(let t=i;t<n;t+=1)r+=s[t]*o[d-t&c-1];for(let s=i;s<e;s+=1)r-=t[s]*a[d-s&c-1];o[d]=h[p],a[d]=r,d=d+1&c-1,l[p]=r}return d},Rt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},qt=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const s=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==s&&(s.catch((()=>{})),!0)}catch(s){}return!1},Ft=(t,e,s)=>{const n=e[s];void 0!==n&&n!==t[s]&&(t[s]=n)},Vt=(t,e)=>{Ft(t,e,"channelCount"),Ft(t,e,"channelCountMode"),Ft(t,e,"channelInterpretation")},Lt=t=>"function"==typeof t.getFloatTimeDomainData,Nt=(t,e,s)=>{const n=e[s];void 0!==n&&n!==t[s].value&&(t[s].value=n)},jt=t=>{var e;t.start=(e=t.start,(s=0,n=0,i)=>{if("number"==typeof i&&i<0||n<0||s<0)throw new RangeError("The parameters can't be negative.");e.call(t,s,n,i)})},Bt=t=>{var e;t.stop=(e=t.stop,(s=0)=>{if(s<0)throw new RangeError("The parameter can't be negative.");e.call(t,s)})},zt=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Gt=(t,e)=>d(this,null,(function*(){const s=yield(n=e,new Promise(((t,e)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:e})=>{s.close(),i.close(),t(e)},s.onmessageerror=({data:t})=>{s.close(),i.close(),e(t)},i.postMessage(n)})));var n;return new t(s)})),Wt=(t,e)=>{const s=t.createBiquadFilter();return Vt(s,e),Nt(s,e,"Q"),Nt(s,e,"detune"),Nt(s,e,"frequency"),Nt(s,e,"gain"),Ft(s,e,"type"),s},Ut=(t,e)=>{const s=t.createChannelSplitter(e.numberOfOutputs);return Vt(s,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set(t){if(t!==e)throw Dt()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set(t){if("explicit"!==t)throw Dt()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set(t){if("discrete"!==t)throw Dt()}})})(s),s},$t=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Qt=(t,e)=>{const s=t.createDelay(e.maxDelayTime);return Vt(s,e),Nt(s,e,"delayTime"),s},Xt=(t,e)=>{const s=t.createGain();return Vt(s,e),Nt(s,e,"gain"),s};function Zt(t,e){const s=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/s,(t[1]*e[0]-t[0]*e[1])/s]}function Yt(t,e){let s=[0,0];for(let o=t.length-1;o>=0;o-=1)s=[(n=s)[0]*(i=e)[0]-n[1]*i[1],n[0]*i[1]+n[1]*i[0]],s[0]+=t[o];var n,i;return s}const Ht=(t,e,s,n)=>t.createScriptProcessor(e,s,n),Jt=()=>new DOMException("","NotSupportedError"),Kt={numberOfChannels:1},te={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ee={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},se={disableNormalization:!1},ne={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},ie={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},oe=(t,e,s)=>void 0===t.copyFromChannel?t.getChannelData(s)[0]:(t.copyFromChannel(e,s),e[0]),ae=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},re=(t,e,s,n)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:o,set:a}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:s(o),set:n(a)})},ce=(t,e,s)=>{try{t.setValueAtTime(e,s)}catch(n){if(9!==n.code)throw n;ce(t,e,s+1e-7)}},he=t=>{const e=t.createOscillator();try{e.start(-1)}catch(s){return s instanceof RangeError}return!1},le=t=>{const e=t.createBuffer(1,1,44100),s=t.createBufferSource();s.buffer=e,s.start(),s.stop();try{return s.stop(),!0}catch(n){return!1}},ue=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(s){return s instanceof RangeError}return!1},de=()=>{try{new DOMException}catch(t){return!1}return!0},pe=()=>new Promise((t=>{const e=new ArrayBuffer(0),{port1:s,port2:n}=new MessageChannel;s.onmessage=({data:e})=>t(null!==e),n.postMessage(e,[e])})),fe=(t,e)=>{const s=e.createGain();t.connect(s);const n=(i=t.disconnect,()=>{i.call(t,s),t.removeEventListener("ended",n)});var i;t.addEventListener("ended",n),$t(t,s),t.stop=(e=>{let n=!1;return(i=0)=>{if(n)try{e.call(t,i)}catch(o){s.gain.setValueAtTime(0,i)}else e.call(t,i),n=!0}})(t.stop)},me=(t,e)=>s=>{const n={value:t};return Object.defineProperties(s,{currentTarget:n,target:n}),"function"==typeof e?e.call(t,s):e.handleEvent.call(t,s)},ge=(we=Y,(t,e,[s,n,i],o)=>{we(t[n],[e,s,i],(t=>t[0]===e&&t[1]===s),o)}),_e=(t=>(e,s,[n,i,o],a)=>{const r=e.get(n);void 0===r?e.set(n,new Set([[i,s,o]])):t(r,[i,s,o],(t=>t[0]===i&&t[1]===s),a)})(Y),ye=(t=>(e,s,n,i)=>t(e[i],(t=>t[0]===s&&t[1]===n)))(M),ve=new WeakMap,xe=(t=>e=>{var s;return null!==(s=t.get(e))&&void 0!==s?s:0})(ve),be=(Te=new Map,Se=new WeakMap,(t,e)=>{const s=Se.get(t);if(void 0!==s)return s;const n=Te.get(t);if(void 0!==n)return n;try{const s=e();return s instanceof Promise?(Te.set(t,s),s.catch((()=>!1)).then((e=>(Te.delete(t),Se.set(t,e),e)))):(Se.set(t,s),s)}catch(i){return Se.set(t,!1),!1}});var we,Te,Se;const ke="undefined"==typeof window?null:window,Ae=((t,e)=>(s,n)=>{const i=s.createAnalyser();if(Vt(i,n),!(n.maxDecibels>n.minDecibels))throw e();return Ft(i,n,"fftSize"),Ft(i,n,"maxDecibels"),Ft(i,n,"minDecibels"),Ft(i,n,"smoothingTimeConstant"),t(Lt,(()=>Lt(i)))||((o=i).getFloatTimeDomainData=t=>{const e=new Uint8Array(t.length);o.getByteTimeDomainData(e);const s=Math.max(e.length,o.fftSize);for(let n=0;n<s;n+=1)t[n]=.0078125*(e[n]-128);return t}),i;var o})(be,V),Me=(t=>e=>{const s=t(e);if(null===s.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return s.renderer})(W),Ce=((t,e,s)=>(n,i,o)=>d(this,null,(function*(){const a=t(n);yield Promise.all(a.activeInputs.map(((t,a)=>Array.from(t).map((t=>d(this,[t],(function*([t,r]){const c=e(t),h=yield c.render(t,i),l=n.context.destination;s(t)||n===l&&s(n)||h.connect(o,r,a)})))))).reduce(((t,e)=>[...t,...e]),[]))})))(W,Me,rt),Oe=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):((i,o)=>d(this,null,(function*(){let a=e(i);return q(a,o)||(a=t(o,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant})),n.set(o,a),yield s(i,o,a),a})))(i,o)}}})(Ae,ot,Ce),De=(Ee=g,t=>{const e=Ee.get(t);if(void 0===e)throw Dt();return e});var Ee;const Pe=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(ke),Ie=(t=>e=>null!==t&&e instanceof t)(Pe),Re=new WeakMap,qe=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,s,n){if(null!==s){let i=this._listeners.get(s);void 0===i&&(i=t(this,s),"function"==typeof s&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(e,i,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,s){const n=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===n?null:n,s)}})(me),Fe=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(ke),Ve=(t=>e=>null!==t&&e instanceof t)(Fe),Le=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(ke),Ne=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(ke),je=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(ke),Be=((t,e,s,n,i,o,a,r,c,h,l,u,d,f,m,g)=>class extends h{constructor(e,n,i,o){super(i),this._context=e,this._nativeAudioNode=i;const a=l(e);u(a)&&!0!==s(ht,(()=>ht(a,g)))&&(t=>{const e=new Map;var s,n;t.connect=(n=t.connect.bind(t),(t,s=0,i=0)=>{const o=ut(t)?n(t,s,i):n(t,s),a=e.get(t);return void 0===a?e.set(t,[{input:i,output:s}]):a.every((t=>t.input!==i||t.output!==s))&&a.push({input:i,output:s}),o}),t.disconnect=(s=t.disconnect,(n,i,o)=>{if(s.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,s]of e){const i=s.filter((t=>t.output!==n));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(n))if(void 0===i)e.delete(n);else{const t=e.get(n);if(void 0!==t){const s=t.filter((t=>t.output!==i&&(t.input!==o||void 0===o)));0===s.length?e.delete(n):e.set(n,s)}}for(const[s,a]of e)a.forEach((e=>{ut(s)?t.connect(s,e.output,e.input):t.connect(s,e.output)}))})})(i),p.set(this,i),_.set(this,new Set),"closed"!==e.state&&n&&D(this),t(this,o,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,s=0,r=0){if(s<0||s>=this._nativeAudioNode.numberOfOutputs)throw i();const h=l(this._context),u=m(h);if(d(t)||f(t))throw o();if(X(t)){const i=ot(t);try{const e=tt(this._nativeAudioNode,i,s,r),n=ct(this);(u||n)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!n&&ct(t)&&D(t)}catch(_){if(12===_.code)throw o();throw _}if(e(this,t,s,r,u)){const e=c([this],t);lt(e,n(u))}return t}const p=at(t);if("playbackRate"===p.name&&1024===p.maxValue)throw a();try{this._nativeAudioNode.connect(p,s),(u||ct(this))&&this._nativeAudioNode.disconnect(p,s)}catch(_){if(12===_.code)throw o();throw _}if(((t,e,s,n)=>{const{activeInputs:i,passiveInputs:o}=U(e),{outputs:a}=W(t),r=O(t),c=a=>{const r=ot(t),c=at(e);if(a){const e=nt(o,t,s);H(i,t,e,!1),n||rt(t)||r.connect(c,s)}else{const e=(h=t,l=s,M(i,(t=>t[0]===h&&t[1]===l)));J(o,e,!1),n||rt(t)||r.disconnect(c,s)}var h,l};return!!Y(a,[e,s],(t=>t[0]===e&&t[1]===s),!0)&&(r.add(c),z(t)?H(i,t,[s,c],!0):J(o,[t,s,c],!0),!0)})(this,t,s,u)){const e=c([this],t);lt(e,n(u))}}disconnect(t,e,s){let n;const a=l(this._context),h=m(a);if(void 0===t)n=((t,e)=>{const s=W(t),n=[];for(const i of s.outputs)Z(i)?dt(t,e,...i):pt(t,e,...i),n.push(i[0]);return s.outputs.clear(),n})(this,h);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();n=((t,e,s)=>{const n=W(t),i=[];for(const o of n.outputs)o[1]===s&&(Z(o)?dt(t,e,...o):pt(t,e,...o),i.push(o[0]),n.outputs.delete(o));return i})(this,h,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(X(t)&&void 0!==s&&(s<0||s>=t.numberOfInputs))throw i();if(n=((t,e,s,n,i)=>{const o=W(t);return Array.from(o.outputs).filter((t=>!(t[0]!==s||void 0!==n&&t[1]!==n||void 0!==i&&t[2]!==i))).map((s=>(Z(s)?dt(t,e,...s):pt(t,e,...s),o.outputs.delete(s),s[0])))})(this,h,t,e,s),0===n.length)throw o()}for(const i of n){const t=c([this],i);lt(t,r)}}})((ze=u,(t,e,s)=>{const n=[];for(let i=0;i<s.numberOfInputs;i+=1)n.push(new Set);ze.set(t,{activeInputs:n,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,s,n,i,o,a,r,c,h,l,u,d)=>{const p=new WeakMap;return(f,m,g,_,y)=>{const{activeInputs:v,passiveInputs:x}=o(m),{outputs:b}=o(f),w=r(f),T=o=>{const r=c(m),h=c(f);if(o){const e=C(x,f,g,_);t(v,f,e,!1),y||u(f)||s(h,r,g,_),d(m)&&D(m)}else{const t=n(v,f,g,_);e(x,_,t,!1),y||u(f)||i(h,r,g,_);const s=a(m);if(0===s)l(m)&&I(m,v);else{const t=p.get(m);void 0!==t&&clearTimeout(t),p.set(m,setTimeout((()=>{l(m)&&I(m,v)}),1e3*s))}}};return!!h(b,[m,g,_],(t=>t[0]===m&&t[1]===g&&t[2]===_),!0)&&(w.add(T),l(f)?t(v,f,[g,_,T],!0):e(x,_,[f,g,T],!0),!0)}})(ge,_e,tt,ye,it,W,xe,O,ot,Y,z,rt,ct),be,((t,e,s,n,i,o)=>a=>(r,c)=>{const h=t.get(r);if(void 0===h){if(!a&&o(r)){const t=n(r),{outputs:o}=s(r);for(const s of o)if(Z(s)){const i=n(s[0]);e(t,i,s[1],s[2])}else{const e=i(s[0]);t.disconnect(e,s[1])}}t.set(r,c)}else t.set(r,h+c)})(y,it,W,ot,at,z),V,Et,Jt,((t,e,s,n,i,o,a,r)=>(c,h)=>{const l=e.get(c);if(void 0===l)throw new Error("Missing the expected cycle count.");const u=o(c.context),d=r(u);if(l===h){if(e.delete(c),!d&&a(c)){const e=n(c),{outputs:o}=s(c);for(const s of o)if(Z(s)){const i=n(s[0]);t(e,i,s[1],s[2])}else{const t=i(s[0]);e.connect(t,s[1])}}}else e.set(c,l-h)})(tt,y,W,ot,at,De,z,Ie),((t,e,s)=>function n(i,o){const a=X(o)?o:s(t,o);if("delayTime"in a)return[];if(i[0]===a)return[i];if(i.includes(a))return[];const{outputs:r}=e(a);return Array.from(r).map((t=>n([...i,a],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(Re,W,A),qe,De,Ve,Le,Ne,Ie,je);var ze;const Ge=((t,e,s,n,i,o)=>class extends t{constructor(t,s){const a=i(t),r=c(c({},R),s),h=n(a,r);super(t,!1,h,o(a)?e():null),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,s()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,s()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Be,Oe,V,Ae,De,Ie),We=new WeakSet,Ue=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(ke),$e=(Qe=new Uint32Array(1),t=>(Qe[0]=t,Qe[0]));var Qe;const Xe=((t,e)=>s=>{s.copyFromChannel=(n,i,o=0)=>{const a=t(o),r=t(i);if(r>=s.numberOfChannels)throw e();const c=s.length,h=s.getChannelData(r),l=n.length;for(let t=a<0?-a:0;t+a<c&&t<l;t+=1)n[t]=h[t+a]},s.copyToChannel=(n,i,o=0)=>{const a=t(o),r=t(i);if(r>=s.numberOfChannels)throw e();const c=s.length,h=s.getChannelData(r),l=n.length;for(let t=a<0?-a:0;t+a<c&&t<l;t+=1)h[t+a]=n[t]}})($e,V),Ze=(t=>e=>{var s;e.copyFromChannel=(s=e.copyFromChannel,(n,i,o=0)=>{const a=t(o),r=t(i);if(a<e.length)return s.call(e,n,r,a)}),e.copyToChannel=(s=>(n,i,o=0)=>{const a=t(o),r=t(i);if(a<e.length)return s.call(e,n,r,a)})(e.copyToChannel)})($e),Ye=((t,e,s,n,i,o,a,r)=>{let h=null;return class l{constructor(l){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:d,sampleRate:p}=c(c({},N),l);null===h&&(h=new i(1,1,44100));const f=null!==n&&e(o,o)?new n({length:u,numberOfChannels:d,sampleRate:p}):h.createBuffer(d,u,p);if(0===f.numberOfChannels)throw s();return"function"!=typeof f.copyFromChannel?(a(f),L(f)):e(F,(()=>F(f)))||r(f),t.add(f),f}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===l.prototype||t.has(e)}}})(We,be,Jt,Ue,Pe,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch(e){return!1}return!0})(Ue),Xe,Ze),He=(t=>(e,s)=>{const n=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.connect(n).connect(e.destination);const i=()=>{s.removeEventListener("ended",i),s.disconnect(n),n.disconnect()};s.addEventListener("ended",i)})(Xt),Je=((t,e,s)=>(n,i,o)=>d(this,null,(function*(){const a=e(n);yield Promise.all(Array.from(a.activeInputs).map((e=>d(this,[e],(function*([e,n]){const a=t(e),r=yield a.render(e,i);s(e)||r.connect(o,n)})))))})))(Me,U,rt),Ke=(t=>(e,s,n)=>t(s,e,n))(Je),ts=((t,e,s,n,i,o,a,r,c,h,l)=>(c,u)=>{const d=c.createBufferSource();return Vt(d,u),Nt(d,u,"playbackRate"),Ft(d,u,"buffer"),Ft(d,u,"loop"),Ft(d,u,"loopEnd"),Ft(d,u,"loopStart"),e(s,(()=>s(c)))||((p=d).start=(t=>{let e=!1;return(s=0,n=0,i)=>{if(e)throw Dt();t.call(p,s,n,i),e=!0}})(p.start)),e(n,(()=>n(c)))||(t=>{t.start=(e=>(s=0,n=0,i)=>{const o=t.buffer,a=null===o?n:Math.min(o.duration,n);null!==o&&a>o.duration-.5/t.context.sampleRate?e.call(t,s,0,0):e.call(t,s,a,i)})(t.start)})(d),e(i,(()=>i(c)))||h(d,c),e(o,(()=>o(c)))||jt(d),e(a,(()=>a(c)))||l(d,c),e(r,(()=>r(c)))||Bt(d),t(c,d),d;var p})(He,be,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch(s){return!0}return!1}),(t=>{const e=t.createBufferSource(),s=t.createBuffer(1,1,44100);e.buffer=s;try{e.start(0,1)}catch(n){return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch(s){return!1}return!0}),he,le,ue,0,(t=>(e,s)=>{const n=s.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=n),t(e,"buffer",(t=>()=>{const s=t.call(e);return s===n?null:s}),(t=>s=>t.call(e,null===s?n:s)))})(re),fe),es=((t,e)=>(s,n,i)=>(t(n).replay(i),e(n,s,i)))((t=>e=>{const s=t(e);if(null===s.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return s.renderer})(U),Je),ss=((t,e,s,n,i)=>()=>{const o=new WeakMap;let a=null,r=null;return{set start(t){a=t},set stop(t){r=t},render(c,h){const l=o.get(h);return void 0!==l?Promise.resolve(l):((c,h)=>d(this,null,(function*(){let l=s(c);const u=q(l,h);return u||(l=e(h,{buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value}),null!==a&&l.start(...a),null!==r&&l.stop(r)),o.set(h,l),u?yield t(h,c.playbackRate,l.playbackRate):yield n(h,c.playbackRate,l.playbackRate),yield i(c,h,l),l})))(c,h)}}})(Ke,ts,ot,es,Ce),ns=((t,e,s,n,i,o,r,c,h,l,u,d,p)=>(n,f,m,g=null,_=null)=>{const y=new a.AutomationEventList(m.defaultValue),v=f?(t=>({replay(e){for(const s of t)if("exponentialRampToValue"===s.type){const{endTime:t,value:n}=s;e.exponentialRampToValueAtTime(n,t)}else if("linearRampToValue"===s.type){const{endTime:t,value:n}=s;e.linearRampToValueAtTime(n,t)}else if("setTarget"===s.type){const{startTime:t,target:n,timeConstant:i}=s;e.setTargetAtTime(n,t,i)}else if("setValue"===s.type){const{startTime:t,value:n}=s;e.setValueAtTime(n,t)}else{if("setValueCurve"!==s.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:n,values:i}=s;e.setValueCurveAtTime(i,n,t)}}}}))(y):null,x={get defaultValue(){return m.defaultValue},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,x.setValueAtTime(t,n.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===v&&y.flush(n.context.currentTime),y.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(y).pop();null===v&&y.flush(n.context.currentTime),y.add(i(t));const s=Array.from(y).pop();m.cancelScheduledValues(t),e!==s&&void 0!==s&&("exponentialRampToValue"===s.type?m.exponentialRampToValueAtTime(s.value,s.endTime):"linearRampToValue"===s.type?m.linearRampToValueAtTime(s.value,s.endTime):"setValue"===s.type?m.setValueAtTime(s.value,s.startTime):"setValueCurve"===s.type&&m.setValueCurveAtTime(s.values,s.startTime,s.duration))}return x},cancelScheduledValues:t=>(null===v&&y.flush(n.context.currentTime),y.add(o(t)),m.cancelScheduledValues(t),x),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===v&&y.flush(n.context.currentTime),y.add(r(t,e)),m.exponentialRampToValueAtTime(t,e),x},linearRampToValueAtTime:(t,e)=>(null===v&&y.flush(n.context.currentTime),y.add(c(t,e)),m.linearRampToValueAtTime(t,e),x),setTargetAtTime:(t,e,s)=>(null===v&&y.flush(n.context.currentTime),y.add(h(t,e,s)),m.setTargetAtTime(t,e,s),x),setValueAtTime:(t,e)=>(null===v&&y.flush(n.context.currentTime),y.add(l(t,e)),m.setValueAtTime(t,e),x),setValueCurveAtTime(t,e,s){const i=t instanceof Float32Array?t:new Float32Array(t);if(null!==d&&"webkitAudioContext"===d.name){const t=e+s,o=n.context.sampleRate,a=Math.ceil(e*o),r=Math.floor(t*o),c=r-a,h=new Float32Array(c);for(let n=0;n<c;n+=1){const t=(i.length-1)/s*((a+n)/o-e),r=Math.floor(t),c=Math.ceil(t);h[n]=r===c?i[r]:(1-(t-r))*i[r]+(1-(c-t))*i[c]}null===v&&y.flush(n.context.currentTime),y.add(u(h,e,s)),m.setValueCurveAtTime(h,e,s);const l=r/o;l<t&&p(x,h[h.length-1],l),p(x,i[i.length-1],t)}else null===v&&y.flush(n.context.currentTime),y.add(u(i,e,s)),m.setValueCurveAtTime(i,e,s);return x}};return s.set(x,m),e.set(x,n),t(x,v),x})((is=f,(t,e)=>{is.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),Re,m,0,a.createCancelAndHoldAutomationEvent,a.createCancelScheduledValuesAutomationEvent,a.createExponentialRampToValueAutomationEvent,a.createLinearRampToValueAutomationEvent,a.createSetTargetAutomationEvent,a.createSetValueAutomationEvent,a.createSetValueCurveAutomationEvent,Fe,ce);var is;const os=((t,e,s,n,i,o,a,r)=>class extends t{constructor(t,n){const r=o(t),h=c(c({},G),n),l=i(r,h),u=a(r),d=u?e():null;super(t,!1,l,d),this._audioBufferSourceNodeRenderer=d,this._isBufferNullified=!1,this._isBufferSet=null!==h.buffer,this._nativeAudioBufferSourceNode=l,this._onended=null,this._playbackRate=s(this,u,l.playbackRate,B,j)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?r(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const s=this._nativeAudioBufferSourceNode.onended;this._onended=null!==s&&s===e?t:s}get playbackRate(){return this._playbackRate}start(t=0,e=0,s){if(this._nativeAudioBufferSourceNode.start(t,e,s),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===s?[t,e]:[t,e,s]),"closed"!==this.context.state){D(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),z(this)&&P(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Be,ss,ns,Dt,ts,De,Ie,me),as=((t,e,s,n,i,o,a,r)=>class extends t{constructor(t,s){const n=o(t),c=a(n),h=i(n,s,c);super(t,!1,h,c?e(r):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=h}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw s();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Be,(t=>{const e=new WeakMap;return{render(s,n){const i=e.get(n);return void 0!==i?Promise.resolve(i):((s,n)=>d(this,null,(function*(){const i=n.destination;return e.set(n,i),yield t(s,n,i),i})))(s,n)}}}),V,Dt,((t,e)=>(s,n,i)=>{const o=s.destination;if(o.channelCount!==n)try{o.channelCount=n}catch(r){}i&&"explicit"!==o.channelCountMode&&(o.channelCountMode="explicit"),0===o.maxChannelCount&&Object.defineProperty(o,"maxChannelCount",{value:n});const a=t(s,{channelCount:n,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1});return e(a,"channelCount",(t=>()=>t.call(a)),(t=>e=>{t.call(a,e);try{o.channelCount=e}catch(s){if(e>o.maxChannelCount)throw s}})),e(a,"channelCountMode",(t=>()=>t.call(a)),(t=>e=>{t.call(a,e),o.channelCountMode=e})),e(a,"channelInterpretation",(t=>()=>t.call(a)),(t=>e=>{t.call(a,e),o.channelInterpretation=e})),Object.defineProperty(a,"maxChannelCount",{get:()=>o.maxChannelCount}),a.connect(o),a})(Xt,re),De,Ie,Ce),rs=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(a,r){const c=o.get(r);return void 0!==c?Promise.resolve(c):((a,r)=>d(this,null,(function*(){let c=s(a);const h=q(c,r);return h||(c=e(r,{Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type})),o.set(r,c),h?(yield t(r,a.Q,c.Q),yield t(r,a.detune,c.detune),yield t(r,a.frequency,c.frequency),yield t(r,a.gain,c.gain)):(yield n(r,a.Q,c.Q),yield n(r,a.detune,c.detune),yield n(r,a.frequency,c.frequency),yield n(r,a.gain,c.gain)),yield i(a,r,c),c})))(a,r)}}})(Ke,Wt,ot,es,Ce),cs=(t=>(e,s)=>t.set(e,s))(ve),hs=((t,e,s,n,i,o,a,r)=>class extends t{constructor(t,n){const h=o(t),l=c(c({},xt),n),u=i(h,l),d=a(h);super(t,!1,u,d?s():null),this._Q=e(this,d,u.Q,B,j),this._detune=e(this,d,u.detune,1200*Math.log2(B),-1200*Math.log2(B)),this._frequency=e(this,d,u.frequency,t.sampleRate/2,0),this._gain=e(this,d,u.gain,40*Math.log10(B),j),this._nativeBiquadFilterNode=u,r(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,s){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,s)}catch(i){if(11===i.code)throw n();throw i}if(t.length!==e.length||e.length!==s.length)throw n()}})(Be,ns,rs,Et,Wt,De,Ie,cs),ls=((t,e)=>(s,n,i)=>{const o=new Set;return s.connect=(r=s.connect,(i,a=0,c=0)=>{const h=0===o.size;if(e(i))return r.call(s,i,a,c),t(o,[i,a,c],(t=>t[0]===i&&t[1]===a&&t[2]===c),!0),h&&n(),i;r.call(s,i,a),t(o,[i,a],(t=>t[0]===i&&t[1]===a),!0),h&&n()}),s.disconnect=(a=s.disconnect,(t,n,r)=>{const c=o.size>0;if(void 0===t)a.apply(s),o.clear();else if("number"==typeof t){a.call(s,t);for(const e of o)e[1]===t&&o.delete(e)}else{e(t)?a.call(s,t,n,r):a.call(s,t,n);for(const e of o)e[0]!==t||void 0!==n&&e[1]!==n||void 0!==r&&e[2]!==r||o.delete(e)}c&&0===o.size&&i()}),s;var a,r})(Y,Le),us=((t,e)=>(s,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set(){throw t()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set(){throw t()}});const i=s.createBufferSource();e(n,(()=>{const t=n.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(n,0,e)}),(()=>i.disconnect(n)))})(Dt,ls),ds=((t,e)=>(s,n)=>{const i=s.createChannelMerger(n.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(s,i),Vt(i,n),i})(Fe,us),ps=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):((i,o)=>d(this,null,(function*(){let a=e(i);return q(a,o)||(a=t(o,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs})),n.set(o,a),yield s(i,o,a),a})))(i,o)}}})(ds,ot,Ce),fs=((t,e,s,n,i)=>class extends t{constructor(t,o){const a=n(t),r=c(c({},bt),o);super(t,!1,s(a,r),i(a)?e():null)}})(Be,ps,ds,De,Ie),ms=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):((i,o)=>d(this,null,(function*(){let a=e(i);return q(a,o)||(a=t(o,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs})),n.set(o,a),yield s(i,o,a),a})))(i,o)}}})(Ut,ot,Ce),gs=((t,e,s,n,i,o)=>class extends t{constructor(t,o){const a=n(t),r=(t=>h(c({},t),{channelCount:t.numberOfOutputs}))(c(c({},wt),o));super(t,!1,s(a,r),i(a)?e():null)}})(Be,ms,Ut,De,Ie),_s=((t,e,s,n)=>(i,o)=>{var a=o,{offset:r}=a,u=l(a,["offset"]);const d=i.createBuffer(1,2,44100),p=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),f=s(i,h(c({},u),{gain:r})),m=d.getChannelData(0);m[0]=1,m[1]=1,p.buffer=d,p.loop=!0;const g={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(t){f.channelCount=t},get channelCountMode(){return f.channelCountMode},set channelCountMode(t){f.channelCountMode=t},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(t){f.channelInterpretation=t},get context(){return f.context},get inputs(){return[]},get numberOfInputs(){return p.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get offset(){return f.gain},get onended(){return p.onended},set onended(t){p.onended=t},addEventListener:(...t)=>p.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>p.dispatchEvent(t[0]),removeEventListener:(...t)=>p.removeEventListener(t[0],t[1],t[2]),start(t=0){p.start.call(p,t)},stop(t=0){p.stop.call(p,t)}};return t(i,p),n($t(g,f),(()=>p.connect(f)),(()=>p.disconnect(f)))})(He,ts,Xt,ls),ys=((t,e,s,n,i)=>(o,a)=>{if(void 0===o.createConstantSource)return s(o,a);const r=o.createConstantSource();return Vt(r,a),Nt(r,a,"offset"),e(n,(()=>n(o)))||jt(r),e(i,(()=>i(o)))||Bt(r),t(o,r),r})(He,be,_s,he,ue),vs=((t,e,s,n,i)=>()=>{const o=new WeakMap;let a=null,r=null;return{set start(t){a=t},set stop(t){r=t},render(c,h){const l=o.get(h);return void 0!==l?Promise.resolve(l):((c,h)=>d(this,null,(function*(){let l=s(c);const u=q(l,h);return u||(l=e(h,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value}),null!==a&&l.start(a),null!==r&&l.stop(r)),o.set(h,l),u?yield t(h,c.offset,l.offset):yield n(h,c.offset,l.offset),yield i(c,h,l),l})))(c,h)}}})(Ke,ys,ot,es,Ce),xs=((t,e,s,n,i,o,a)=>class extends t{constructor(t,a){const r=i(t),h=c(c({},Tt),a),l=n(r,h),u=o(r),d=u?s():null;super(t,!1,l,d),this._constantSourceNodeRenderer=d,this._nativeConstantSourceNode=l,this._offset=e(this,u,l.offset,B,j),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeConstantSourceNode.onended=e;const s=this._nativeConstantSourceNode.onended;this._onended=null!==s&&s===e?t:s}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){D(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),z(this)&&P(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Be,ns,vs,ys,De,Ie,me),bs=((t,e)=>(s,n)=>{const i=s.createConvolver();if(Vt(i,n),n.disableNormalization===i.normalize&&(i.normalize=!n.disableNormalization),Ft(i,n,"buffer"),n.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>s=>{if(s>2)throw t();return e.call(i,s)})),"max"===n.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>s=>{if("max"===s)throw t();return e.call(i,s)})),i})(Jt,re),ws=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):((i,o)=>d(this,null,(function*(){let a=e(i);return q(a,o)||(a=t(o,{buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize})),n.set(o,a),K(a)?yield s(i,o,a.inputs[0]):yield s(i,o,a),a})))(i,o)}}})(bs,ot,Ce),Ts=((t,e,s,n,i,o)=>class extends t{constructor(t,a){const r=n(t),h=c(c({},St),a),l=s(r,h);super(t,!1,l,i(r)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=l,null!==h.buffer&&o(this,h.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer?(this._nativeConvolverNode.buffer=this._nativeConvolverNode.context.createBuffer(1,1,44100),this._isBufferNullified=!0,o(this,0)):(this._isBufferNullified=!1,o(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration))}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Be,ws,bs,De,Ie,cs),Ss=((t,e,s,n,i)=>o=>{const a=new WeakMap;return{render(r,c){const h=a.get(c);return void 0!==h?Promise.resolve(h):((r,c)=>d(this,null,(function*(){let h=s(r);const l=q(h,c);return l||(h=e(c,{channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:o})),a.set(c,h),l?yield t(c,r.delayTime,h.delayTime):yield n(c,r.delayTime,h.delayTime),yield i(r,c,h),h})))(r,c)}}})(Ke,Qt,ot,es,Ce),ks=((t,e,s,n,i,o,a)=>class extends t{constructor(t,r){const h=i(t),l=c(c({},At),r),u=n(h,l),d=o(h);super(t,!1,u,d?s(l.maxDelayTime):null),this._delayTime=e(this,d,u.delayTime),a(this,l.maxDelayTime)}get delayTime(){return this._delayTime}})(Be,ns,Ss,Qt,De,Ie,cs),As=(t=>(e,s)=>{const n=e.createDynamicsCompressor();if(Vt(n,s),s.channelCount>2)throw t();if("max"===s.channelCountMode)throw t();return Nt(n,s,"attack"),Nt(n,s,"knee"),Nt(n,s,"ratio"),Nt(n,s,"release"),Nt(n,s,"threshold"),n})(Jt),Ms=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(a,r){const c=o.get(r);return void 0!==c?Promise.resolve(c):((a,r)=>d(this,null,(function*(){let c=s(a);const h=q(c,r);return h||(c=e(r,{attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value})),o.set(r,c),h?(yield t(r,a.attack,c.attack),yield t(r,a.knee,c.knee),yield t(r,a.ratio,c.ratio),yield t(r,a.release,c.release),yield t(r,a.threshold,c.threshold)):(yield n(r,a.attack,c.attack),yield n(r,a.knee,c.knee),yield n(r,a.ratio,c.ratio),yield n(r,a.release,c.release),yield n(r,a.threshold,c.threshold)),yield i(a,r,c),c})))(a,r)}}})(Ke,As,ot,es,Ce),Cs=((t,e,s,n,i,o,a,r)=>class extends t{constructor(t,i){const h=o(t),l=c(c({},Ct),i),u=n(h,l),d=a(h);super(t,!1,u,d?s():null),this._attack=e(this,d,u.attack),this._knee=e(this,d,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=e(this,d,u.ratio),this._release=e(this,d,u.release),this._threshold=e(this,d,u.threshold),r(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Be,ns,Ms,As,Jt,De,Ie,cs),Os=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(a,r){const c=o.get(r);return void 0!==c?Promise.resolve(c):((a,r)=>d(this,null,(function*(){let c=s(a);const h=q(c,r);return h||(c=e(r,{channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value})),o.set(r,c),h?yield t(r,a.gain,c.gain):yield n(r,a.gain,c.gain),yield i(a,r,c),c})))(a,r)}}})(Ke,Xt,ot,es,Ce),Ds=((t,e,s,n,i,o)=>class extends t{constructor(t,a){const r=i(t),h=c(c({},Ot),a),l=n(r,h),u=o(r);super(t,!1,l,u?s():null),this._gain=e(this,u,l.gain,B,j)}get gain(){return this._gain}})(Be,ns,Os,Xt,De,Ie),Es=((t,e,s,n)=>(i,o,{channelCount:a,channelCountMode:r,channelInterpretation:c,feedback:h,feedforward:l})=>{const u=zt(o,i.sampleRate),d=h instanceof Float64Array?h:new Float64Array(h),p=l instanceof Float64Array?l:new Float64Array(l),f=d.length,m=p.length,g=Math.min(f,m);if(0===f||f>20)throw n();if(0===d[0])throw e();if(0===m||m>20)throw n();if(0===p[0])throw e();if(1!==d[0]){for(let t=0;t<m;t+=1)p[t]/=d[0];for(let t=1;t<f;t+=1)d[t]/=d[0]}const _=s(i,u,a,a);_.channelCount=a,_.channelCountMode=r,_.channelInterpretation=c;const y=[],v=[],x=[];for(let t=0;t<a;t+=1){y.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),v.push(t),x.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,s=t.outputBuffer,n=e.numberOfChannels;for(let i=0;i<n;i+=1){const t=e.getChannelData(i),n=s.getChannelData(i);y[i]=It(d,f,p,m,g,v[i],x[i],y[i],32,t,n)}};const b=i.sampleRate/2;return $t({get bufferSize(){return u},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,s,n){if(e.length!==s.length||s.length!==n.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/b),o=[Math.cos(i),Math.sin(i)],a=Zt(Yt(p,o),Yt(d,o));s[t]=Math.sqrt(a[0]*a[0]+a[1]*a[1]),n[t]=Math.atan2(a[1],a[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(Et,Dt,Ht,Jt),Ps=((t,e,s,n)=>i=>t(qt,(()=>qt(i)))?Promise.resolve(t(n,n)).then((t=>{if(!t){const t=s(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const s=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{s.disconnect(),t(e.renderedBuffer)},s.connect(i.destination),i.startRendering()})))(be,Xt,Ht,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const s=new e(1,1,44100),n=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{s.oncomplete=()=>{n.disconnect(),t(0!==s.currentTime)},s.startRendering()}))})(Xt,Pe)),Is=((t,e,s,n,i)=>(o,a)=>{const r=new WeakMap;let c=null;const h=(h,l)=>d(this,null,(function*(){let u=null,p=e(h);const f=q(p,l);if(void 0===l.createIIRFilter?u=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(p=l.createIIRFilter(a,o)),r.set(l,null===u?p:u),null!==u){if(null===c){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new s(h.context.destination.channelCount,h.context.length,l.sampleRate);c=(()=>d(this,null,(function*(){return yield n(h,t,t.destination),((t,e,s,n)=>{const i=s instanceof Float64Array?s:new Float64Array(s),o=n instanceof Float64Array?n:new Float64Array(n),a=i.length,r=o.length,c=Math.min(a,r);if(1!==i[0]){for(let t=0;t<a;t+=1)o[t]/=i[0];for(let t=1;t<r;t+=1)i[t]/=i[0]}const h=new Float32Array(32),l=new Float32Array(32),u=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let p=0;p<d;p+=1){const e=t.getChannelData(p),s=u.getChannelData(p);h.fill(0),l.fill(0),It(i,a,o,r,c,h,l,0,32,e,s)}return u})(yield i(t),l,o,a)})))()}const t=yield c;return u.buffer=t,u.start(0),u}return yield n(h,l,p),p}));return{render(t,e){const s=r.get(e);return void 0!==s?Promise.resolve(s):h(t,e)}}})(ts,ot,Pe,Ce,Ps),Rs=(t=>(e,s,n)=>{if(void 0===e.createIIRFilter)return t(e,s,n);const i=e.createIIRFilter(n.feedforward,n.feedback);return Vt(i,n),i})(Es),qs=((t,e,s,n,i,o)=>class extends t{constructor(t,a){const r=n(t),h=i(r),l=c(c({},Pt),a),u=e(r,h?null:t.baseLatency,l);var d,p;super(t,!1,u,h?s(l.feedback,l.feedforward):null),(d=u).getFrequencyResponse=(p=d.getFrequencyResponse,(t,e,s)=>{if(t.length!==e.length||e.length!==s.length)throw Et();return p.call(d,t,e,s)}),this._nativeIIRFilterNode=u,o(this,1)}getFrequencyResponse(t,e,s){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,s)}})(Be,Rs,Is,De,Ie,cs),Fs=((t,e,s,n,i,o,a,r)=>(c,h)=>{const l=h.listener,{forwardX:u,forwardY:d,forwardZ:p,positionX:f,positionY:m,positionZ:g,upX:_,upY:y,upZ:v}=void 0===l.forwardX?(()=>{const u=new Float32Array(1),d=e(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=a(h);let f=!1,m=[0,0,-1,0,1,0],g=[0,0,0];const _=()=>{if(f)return;f=!0;const t=n(h,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[o(t,u,0),o(t,u,1),o(t,u,2),o(t,u,3),o(t,u,4),o(t,u,5)];e.some(((t,e)=>t!==m[e]))&&(l.setOrientation(...e),m=e);const s=[o(t,u,6),o(t,u,7),o(t,u,8)];s.some(((t,e)=>t!==g[e]))&&(l.setPosition(...s),g=s)},d.connect(t)},y=t=>e=>{e!==m[t]&&(m[t]=e,l.setOrientation(...m))},v=t=>e=>{e!==g[t]&&(g[t]=e,l.setPosition(...g))},x=(e,n,o)=>{const a=s(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:n});a.connect(d,0,e),a.start(),Object.defineProperty(a.offset,"defaultValue",{get:()=>n});const l=t({context:c},p,a.offset,B,j);var u,f,m,g,y,v,x;return r(l,"value",(t=>()=>t.call(l)),(t=>e=>{try{t.call(l,e)}catch(s){if(9!==s.code)throw s}_(),p&&o(e)})),l.cancelAndHoldAtTime=(u=l.cancelAndHoldAtTime,p?()=>{throw i()}:(...t)=>{const e=u.apply(l,t);return _(),e}),l.cancelScheduledValues=(f=l.cancelScheduledValues,p?()=>{throw i()}:(...t)=>{const e=f.apply(l,t);return _(),e}),l.exponentialRampToValueAtTime=(m=l.exponentialRampToValueAtTime,p?()=>{throw i()}:(...t)=>{const e=m.apply(l,t);return _(),e}),l.linearRampToValueAtTime=(g=l.linearRampToValueAtTime,p?()=>{throw i()}:(...t)=>{const e=g.apply(l,t);return _(),e}),l.setTargetAtTime=(y=l.setTargetAtTime,p?()=>{throw i()}:(...t)=>{const e=y.apply(l,t);return _(),e}),l.setValueAtTime=(v=l.setValueAtTime,p?()=>{throw i()}:(...t)=>{const e=v.apply(l,t);return _(),e}),l.setValueCurveAtTime=(x=l.setValueCurveAtTime,p?()=>{throw i()}:(...t)=>{const e=x.apply(l,t);return _(),e}),l};return{forwardX:x(0,0,y(0)),forwardY:x(1,0,y(1)),forwardZ:x(2,-1,y(2)),positionX:x(6,0,v(0)),positionY:x(7,0,v(1)),positionZ:x(8,0,v(2)),upX:x(3,0,y(3)),upY:x(4,1,y(4)),upZ:x(5,0,y(5))}})():l;return{get forwardX(){return u},get forwardY(){return d},get forwardZ(){return p},get positionX(){return f},get positionY(){return m},get positionZ(){return g},get upX(){return _},get upY(){return y},get upZ(){return v}}})(ns,ds,ys,Ht,Jt,oe,Ie,re),Vs=new WeakMap,Ls=((t,e,s,n,i,o)=>class extends s{constructor(s,o){super(s),this._nativeContext=s,g.set(this,s),n(s)&&i.set(s,new Set),this._destination=new t(this,o),this._listener=e(this,s),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?o(this,t):null;this._nativeContext.onstatechange=e;const s=this._nativeContext.onstatechange;this._onstatechange=null!==s&&s===e?t:s}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(as,Fs,qe,Ie,Vs,me),Ns=((t,e,s,n,i,o)=>(a,r)=>{const c=a.createOscillator();return Vt(c,r),Nt(c,r,"detune"),Nt(c,r,"frequency"),void 0!==r.periodicWave?c.setPeriodicWave(r.periodicWave):Ft(c,r,"type"),e(s,(()=>s(a)))||jt(c),e(n,(()=>n(a)))||o(c,a),e(i,(()=>i(a)))||Bt(c),t(a,c),c})(He,be,he,le,ue,fe),js=((t,e,s,n,i)=>()=>{const o=new WeakMap;let a=null,r=null,c=null;return{set periodicWave(t){a=t},set start(t){r=t},set stop(t){c=t},render(h,l){const u=o.get(l);return void 0!==u?Promise.resolve(u):((h,l)=>d(this,null,(function*(){let u=s(h);const d=q(u,l);return d||(u=e(l,{channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,periodicWave:null===a?void 0:a,type:u.type}),null!==r&&u.start(r),null!==c&&u.stop(c)),o.set(l,u),d?(yield t(l,h.detune,u.detune),yield t(l,h.frequency,u.frequency)):(yield n(l,h.detune,u.detune),yield n(l,h.frequency,u.frequency)),yield i(h,l,u),u})))(h,l)}}})(Ke,Ns,ot,es,Ce),Bs=((t,e,s,n,i,o,a)=>class extends t{constructor(t,a){const r=i(t),h=c(c({},te),a),l=s(r,h),u=o(r),d=u?n():null,p=t.sampleRate/2;super(t,!1,l,d),this._detune=e(this,u,l.detune,153600,-153600),this._frequency=e(this,u,l.frequency,p,-p),this._nativeOscillatorNode=l,this._onended=null,this._oscillatorNodeRenderer=d,null!==this._oscillatorNodeRenderer&&void 0!==h.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeOscillatorNode.onended=e;const s=this._nativeOscillatorNode.onended;this._onended=null!==s&&s===e?t:s}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){D(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),z(this)&&P(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Be,ns,Ns,js,De,Ie,me),zs=(t=>(e,s)=>{const n=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(s),n.start(),()=>{n.stop(),n.disconnect(s)}})(ts),Gs=((t,e,s,n,i)=>(o,a)=>{var r=a,{curve:u,oversample:d}=r,p=l(r,["curve","oversample"]);const f=o.createWaveShaper(),m=o.createWaveShaper();Vt(f,p),Vt(m,p);const g=s(o,h(c({},p),{gain:1})),_=s(o,h(c({},p),{gain:-1})),y=s(o,h(c({},p),{gain:1})),v=s(o,h(c({},p),{gain:-1}));let x=null,b=!1,w=null;const T={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(t){g.channelCount=t,_.channelCount=t,f.channelCount=t,y.channelCount=t,m.channelCount=t,v.channelCount=t},get channelCountMode(){return f.channelCountMode},set channelCountMode(t){g.channelCountMode=t,_.channelCountMode=t,f.channelCountMode=t,y.channelCountMode=t,m.channelCountMode=t,v.channelCountMode=t},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(t){g.channelInterpretation=t,_.channelInterpretation=t,f.channelInterpretation=t,y.channelInterpretation=t,m.channelInterpretation=t,v.channelInterpretation=t},get context(){return f.context},get curve(){return w},set curve(s){if(null!==s&&s.length<2)throw e();if(null===s)f.curve=s,m.curve=s;else{const t=s.length,e=new Float32Array(t+2-t%2),n=new Float32Array(t+2-t%2);e[0]=s[0],n[0]=-s[t-1];const i=Math.ceil((t+1)/2),o=(t+1)/2-1;for(let a=1;a<i;a+=1){const r=a/i*o,c=Math.floor(r),h=Math.ceil(r);e[a]=c===h?s[c]:(1-(r-c))*s[c]+(1-(h-r))*s[h],n[a]=c===h?-s[t-1-c]:-(1-(r-c))*s[t-1-c]-(1-(h-r))*s[t-1-h]}e[i]=t%2==1?s[i-1]:(s[i-2]+s[i-1])/2,f.curve=e,m.curve=n}w=s,b&&(n(w)&&null===x?x=t(o,g):null!==x&&(x(),x=null))},get inputs(){return[g]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get oversample(){return f.oversample},set oversample(t){f.oversample=t,m.oversample=t},addEventListener:(...t)=>g.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>g.dispatchEvent(t[0]),removeEventListener:(...t)=>g.removeEventListener(t[0],t[1],t[2])};return null!==u&&(T.curve=u instanceof Float32Array?u:new Float32Array(u)),d!==T.oversample&&(T.oversample=d),i($t(T,y),(()=>{g.connect(f).connect(y),g.connect(_).connect(m).connect(v).connect(y),b=!0,n(w)&&(x=t(o,g))}),(()=>{g.disconnect(f),f.disconnect(y),g.disconnect(_),_.disconnect(m),m.disconnect(v),v.disconnect(y),b=!1,null!==x&&(x(),x=null)}))})(zs,Dt,Xt,ae,ls),Ws=((t,e,s,n,i,o,a)=>(r,c)=>{const h=r.createWaveShaper();if(null!==o&&"webkitAudioContext"===o.name&&void 0===r.createGain().gain.automationRate)return s(r,c);Vt(h,c);const l=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==l&&l.length<2)throw e();Ft(h,{curve:l},"curve"),Ft(h,c,"oversample");let u=null,d=!1;return a(h,"curve",(t=>()=>t.call(h)),(e=>s=>(e.call(h,s),d&&(n(s)&&null===u?u=t(r,h):n(s)||null===u||(u(),u=null)),s))),i(h,(()=>{d=!0,n(h.curve)&&(u=t(r,h))}),(()=>{d=!1,null!==u&&(u(),u=null)}))})(zs,Dt,Gs,ae,ls,Fe,re),Us=((t,e,s,n,i,o,a,r,u,d)=>(p,f)=>{var m=f,{coneInnerAngle:g,coneOuterAngle:_,coneOuterGain:y,distanceModel:v,maxDistance:x,orientationX:b,orientationY:w,orientationZ:T,panningModel:S,positionX:k,positionY:A,positionZ:M,refDistance:C,rolloffFactor:O}=m,D=l(m,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]);const E=p.createPanner();if(D.channelCount>2)throw a();if("max"===D.channelCountMode)throw a();Vt(E,D);const P={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},I=s(p,h(c({},P),{channelInterpretation:"speakers",numberOfInputs:6})),R=n(p,h(c({},D),{gain:1})),q=n(p,h(c({},P),{gain:1})),F=n(p,h(c({},P),{gain:0})),V=n(p,h(c({},P),{gain:0})),L=n(p,h(c({},P),{gain:0})),N=n(p,h(c({},P),{gain:0})),j=n(p,h(c({},P),{gain:0})),B=i(p,256,6,1),z=o(p,h(c({},P),{curve:new Float32Array([1,1]),oversample:"none"}));let G=[b,w,T],W=[k,A,M];const U=new Float32Array(1);B.onaudioprocess=({inputBuffer:t})=>{const e=[u(t,U,0),u(t,U,1),u(t,U,2)];e.some(((t,e)=>t!==G[e]))&&(E.setOrientation(...e),G=e);const s=[u(t,U,3),u(t,U,4),u(t,U,5)];s.some(((t,e)=>t!==W[e]))&&(E.setPosition(...s),W=s)},Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(j.gain,"defaultValue",{get:()=>0});const $={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(t){if(t>2)throw a();R.channelCount=t,E.channelCount=t},get channelCountMode(){return E.channelCountMode},set channelCountMode(t){if("max"===t)throw a();R.channelCountMode=t,E.channelCountMode=t},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(t){R.channelInterpretation=t,E.channelInterpretation=t},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(t){E.coneInnerAngle=t},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(t){E.coneOuterAngle=t},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();E.coneOuterGain=t},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(t){E.distanceModel=t},get inputs(){return[R]},get maxDistance(){return E.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;E.maxDistance=t},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return q.gain},get orientationY(){return F.gain},get orientationZ(){return V.gain},get panningModel(){return E.panningModel},set panningModel(t){E.panningModel=t},get positionX(){return L.gain},get positionY(){return N.gain},get positionZ(){return j.gain},get refDistance(){return E.refDistance},set refDistance(t){if(t<0)throw new RangeError;E.refDistance=t},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;E.rolloffFactor=t},addEventListener:(...t)=>R.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>R.dispatchEvent(t[0]),removeEventListener:(...t)=>R.removeEventListener(t[0],t[1],t[2])};return g!==$.coneInnerAngle&&($.coneInnerAngle=g),_!==$.coneOuterAngle&&($.coneOuterAngle=_),y!==$.coneOuterGain&&($.coneOuterGain=y),v!==$.distanceModel&&($.distanceModel=v),x!==$.maxDistance&&($.maxDistance=x),b!==$.orientationX.value&&($.orientationX.value=b),w!==$.orientationY.value&&($.orientationY.value=w),T!==$.orientationZ.value&&($.orientationZ.value=T),S!==$.panningModel&&($.panningModel=S),k!==$.positionX.value&&($.positionX.value=k),A!==$.positionY.value&&($.positionY.value=A),M!==$.positionZ.value&&($.positionZ.value=M),C!==$.refDistance&&($.refDistance=C),O!==$.rolloffFactor&&($.rolloffFactor=O),1===G[0]&&0===G[1]&&0===G[2]||E.setOrientation(...G),0===W[0]&&0===W[1]&&0===W[2]||E.setPosition(...W),d($t($,E),(()=>{R.connect(E),t(R,z,0,0),z.connect(q).connect(I,0,0),z.connect(F).connect(I,0,1),z.connect(V).connect(I,0,2),z.connect(L).connect(I,0,3),z.connect(N).connect(I,0,4),z.connect(j).connect(I,0,5),I.connect(B).connect(p.destination)}),(()=>{R.disconnect(E),r(R,z,0,0),z.disconnect(q),q.disconnect(I),z.disconnect(F),F.disconnect(I),z.disconnect(V),V.disconnect(I),z.disconnect(L),L.disconnect(I),z.disconnect(N),N.disconnect(I),z.disconnect(j),j.disconnect(I),I.disconnect(B),B.disconnect(p.destination)}))})(tt,Dt,ds,Xt,Ht,Ws,Jt,it,oe,ls),$s=(t=>(e,s)=>{const n=e.createPanner();return void 0===n.orientationX?t(e,s):(Vt(n,s),Nt(n,s,"orientationX"),Nt(n,s,"orientationY"),Nt(n,s,"orientationZ"),Nt(n,s,"positionX"),Nt(n,s,"positionY"),Nt(n,s,"positionZ"),Ft(n,s,"coneInnerAngle"),Ft(n,s,"coneOuterAngle"),Ft(n,s,"coneOuterGain"),Ft(n,s,"distanceModel"),Ft(n,s,"maxDistance"),Ft(n,s,"panningModel"),Ft(n,s,"refDistance"),Ft(n,s,"rolloffFactor"),n)})(Us),Qs=((t,e,s,n,i,o,a,r,l,u)=>()=>{const p=new WeakMap;let f=null;return{render(m,g){const _=p.get(g);return void 0!==_?Promise.resolve(_):((m,g)=>d(this,null,(function*(){let _=null,y=o(m);const v={channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation},x=h(c({},v),{coneInnerAngle:y.coneInnerAngle,coneOuterAngle:y.coneOuterAngle,coneOuterGain:y.coneOuterGain,distanceModel:y.distanceModel,maxDistance:y.maxDistance,panningModel:y.panningModel,refDistance:y.refDistance,rolloffFactor:y.rolloffFactor}),b=q(y,g);if("bufferSize"in y)_=n(g,h(c({},v),{gain:1}));else if(!b){const t=h(c({},x),{orientationX:y.orientationX.value,orientationY:y.orientationY.value,orientationZ:y.orientationZ.value,positionX:y.positionX.value,positionY:y.positionY.value,positionZ:y.positionZ.value});y=i(g,t)}if(p.set(g,null===_?y:_),null!==_){if(null===f){if(null===a)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new a(6,m.context.length,g.sampleRate),n=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});n.connect(t.destination),f=(()=>d(this,null,(function*(){const e=yield Promise.all([m.orientationX,m.orientationY,m.orientationZ,m.positionX,m.positionY,m.positionZ].map(((e,n)=>d(this,null,(function*(){const i=s(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===n?1:0});return yield r(t,e,i.offset),i})))));for(let t=0;t<6;t+=1)e[t].connect(n,0,t),e[t].start(0);return u(t)})))()}const t=yield f,o=n(g,h(c({},v),{gain:1}));yield l(m,g,o);const p=[];for(let e=0;e<t.numberOfChannels;e+=1)p.push(t.getChannelData(e));let y=[p[0][0],p[1][0],p[2][0]],b=[p[3][0],p[4][0],p[5][0]],w=n(g,h(c({},v),{gain:1})),T=i(g,h(c({},x),{orientationX:y[0],orientationY:y[1],orientationZ:y[2],positionX:b[0],positionY:b[1],positionZ:b[2]}));o.connect(w).connect(T.inputs[0]),T.connect(_);for(let e=128;e<t.length;e+=128){const t=[p[0][e],p[1][e],p[2][e]],s=[p[3][e],p[4][e],p[5][e]];if(t.some(((t,e)=>t!==y[e]))||s.some(((t,e)=>t!==b[e]))){y=t,b=s;const a=e/g.sampleRate;w.gain.setValueAtTime(0,a),w=n(g,h(c({},v),{gain:0})),T=i(g,h(c({},x),{orientationX:y[0],orientationY:y[1],orientationZ:y[2],positionX:b[0],positionY:b[1],positionZ:b[2]})),w.gain.setValueAtTime(1,a),o.connect(w).connect(T.inputs[0]),T.connect(_)}}return _}return b?(yield t(g,m.orientationX,y.orientationX),yield t(g,m.orientationY,y.orientationY),yield t(g,m.orientationZ,y.orientationZ),yield t(g,m.positionX,y.positionX),yield t(g,m.positionY,y.positionY),yield t(g,m.positionZ,y.positionZ)):(yield r(g,m.orientationX,y.orientationX),yield r(g,m.orientationY,y.orientationY),yield r(g,m.orientationZ,y.orientationZ),yield r(g,m.positionX,y.positionX),yield r(g,m.positionY,y.positionY),yield r(g,m.positionZ,y.positionZ)),K(y)?yield l(m,g,y.inputs[0]):yield l(m,g,y),y})))(m,g)}}})(Ke,ds,ys,Xt,$s,ot,Pe,es,Ce,Ps),Xs=((t,e,s,n,i,o,a)=>class extends t{constructor(t,r){const h=i(t),l=c(c({},ee),r),u=s(h,l),d=o(h);super(t,!1,u,d?n():null),this._nativePannerNode=u,this._orientationX=e(this,d,u.orientationX,B,j),this._orientationY=e(this,d,u.orientationY,B,j),this._orientationZ=e(this,d,u.orientationZ,B,j),this._positionX=e(this,d,u.positionX,B,j),this._positionY=e(this,d,u.positionY,B,j),this._positionZ=e(this,d,u.positionZ,B,j),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Be,ns,$s,Qs,De,Ie,cs),Zs=(t=>(e,{disableNormalization:s,imag:n,real:i})=>{const o=n instanceof Float32Array?n:new Float32Array(n),a=i instanceof Float32Array?i:new Float32Array(i),r=e.createPeriodicWave(a,o,{disableNormalization:s});if(Array.from(n).length<2)throw t();return r})(V),Ys=((t,e,s,n)=>class n{constructor(n,i){const o=e(n),a=(t=>{const{imag:e,real:s}=t;return h(c({},t),void 0===e?void 0===s?{imag:[0,0],real:[0,0]}:{imag:Array.from(s,(()=>0)),real:s}:void 0===s?{imag:e,real:Array.from(e,(()=>0))}:{imag:e,real:s})})(c(c({},se),i)),r=t(o,a);return s.add(r),r}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===n.prototype||s.has(t)}})(Zs,De,new WeakSet),Hs=((t,e,s,n,i,o)=>{const a=16385,r=new Float32Array([1,1]),u=Math.PI/2,d={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},p=h(c({},d),{oversample:"none"}),f=(t,o,l,f,m)=>{if(1===o)return((t,e,i,o)=>{const l=new Float32Array(a),f=new Float32Array(a);for(let s=0;s<a;s+=1){const t=s/16384*u;l[s]=Math.cos(t),f[s]=Math.sin(t)}const m=s(t,h(c({},d),{gain:0})),g=n(t,h(c({},p),{curve:l})),_=n(t,h(c({},p),{curve:r})),y=s(t,h(c({},d),{gain:0})),v=n(t,h(c({},p),{curve:f}));return{connectGraph(){e.connect(m),e.connect(void 0===_.inputs?_:_.inputs[0]),e.connect(y),_.connect(i),i.connect(void 0===g.inputs?g:g.inputs[0]),i.connect(void 0===v.inputs?v:v.inputs[0]),g.connect(m.gain),v.connect(y.gain),m.connect(o,0,0),y.connect(o,0,1)},disconnectGraph(){e.disconnect(m),e.disconnect(void 0===_.inputs?_:_.inputs[0]),e.disconnect(y),_.disconnect(i),i.disconnect(void 0===g.inputs?g:g.inputs[0]),i.disconnect(void 0===v.inputs?v:v.inputs[0]),g.disconnect(m.gain),v.disconnect(y.gain),m.disconnect(o,0,0),y.disconnect(o,0,1)}}})(t,l,f,m);if(2===o)return((t,i,o,l)=>{const f=new Float32Array(a),m=new Float32Array(a),g=new Float32Array(a),_=new Float32Array(a),y=Math.floor(8192.5);for(let e=0;e<a;e+=1)if(e>y){const t=(e-y)/(16384-y)*u;f[e]=Math.cos(t),m[e]=Math.sin(t),g[e]=0,_[e]=1}else{const t=e/(16384-y)*u;f[e]=1,m[e]=0,g[e]=Math.cos(t),_[e]=Math.sin(t)}const v=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),x=s(t,h(c({},d),{gain:0})),b=n(t,h(c({},p),{curve:f})),w=s(t,h(c({},d),{gain:0})),T=n(t,h(c({},p),{curve:m})),S=n(t,h(c({},p),{curve:r})),k=s(t,h(c({},d),{gain:0})),A=n(t,h(c({},p),{curve:g})),M=s(t,h(c({},d),{gain:0})),C=n(t,h(c({},p),{curve:_}));return{connectGraph(){i.connect(v),i.connect(void 0===S.inputs?S:S.inputs[0]),v.connect(x,0),v.connect(w,0),v.connect(k,1),v.connect(M,1),S.connect(o),o.connect(void 0===b.inputs?b:b.inputs[0]),o.connect(void 0===T.inputs?T:T.inputs[0]),o.connect(void 0===A.inputs?A:A.inputs[0]),o.connect(void 0===C.inputs?C:C.inputs[0]),b.connect(x.gain),T.connect(w.gain),A.connect(k.gain),C.connect(M.gain),x.connect(l,0,0),k.connect(l,0,0),w.connect(l,0,1),M.connect(l,0,1)},disconnectGraph(){i.disconnect(v),i.disconnect(void 0===S.inputs?S:S.inputs[0]),v.disconnect(x,0),v.disconnect(w,0),v.disconnect(k,1),v.disconnect(M,1),S.disconnect(o),o.disconnect(void 0===b.inputs?b:b.inputs[0]),o.disconnect(void 0===T.inputs?T:T.inputs[0]),o.disconnect(void 0===A.inputs?A:A.inputs[0]),o.disconnect(void 0===C.inputs?C:C.inputs[0]),b.disconnect(x.gain),T.disconnect(w.gain),A.disconnect(k.gain),C.disconnect(M.gain),x.disconnect(l,0,0),k.disconnect(l,0,0),w.disconnect(l,0,1),M.disconnect(l,0,1)}}})(t,l,f,m);throw i()};return(e,n)=>{var a=n,{channelCount:r,channelCountMode:u,pan:d}=a,p=l(a,["channelCount","channelCountMode","pan"]);if("max"===u)throw i();const m=t(e,h(c({},p),{channelCount:1,channelCountMode:u,numberOfInputs:2})),g=s(e,h(c({},p),{channelCount:r,channelCountMode:u,gain:1})),_=s(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:d});let{connectGraph:y,disconnectGraph:v}=f(e,r,g,_,m);Object.defineProperty(_.gain,"defaultValue",{get:()=>0}),Object.defineProperty(_.gain,"maxValue",{get:()=>1}),Object.defineProperty(_.gain,"minValue",{get:()=>-1});const x={get bufferSize(){},get channelCount(){return g.channelCount},set channelCount(t){g.channelCount!==t&&(b&&v(),({connectGraph:y,disconnectGraph:v}=f(e,t,g,_,m)),b&&y()),g.channelCount=t},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();g.channelCountMode=t},get channelInterpretation(){return g.channelInterpretation},set channelInterpretation(t){g.channelInterpretation=t},get context(){return g.context},get inputs(){return[g]},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get pan(){return _.gain},addEventListener:(...t)=>g.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>g.dispatchEvent(t[0]),removeEventListener:(...t)=>g.removeEventListener(t[0],t[1],t[2])};let b=!1;return o($t(x,m),(()=>{y(),b=!0}),(()=>{v(),b=!1}))}})(ds,Ut,Xt,Ws,Jt,ls),Js=((t,e)=>(s,n)=>{const i=n.channelCountMode;if("clamped-max"===i)throw e();if(void 0===s.createStereoPanner)return t(s,n);const o=s.createStereoPanner();return Vt(o,n),Nt(o,n,"pan"),Object.defineProperty(o,"channelCountMode",{get:()=>i,set(t){if(t!==i)throw e()}}),o})(Hs,Jt),Ks=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(a,r){const c=o.get(r);return void 0!==c?Promise.resolve(c):((a,r)=>d(this,null,(function*(){let c=s(a);const h=q(c,r);return h||(c=e(r,{channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value})),o.set(r,c),h?yield t(r,a.pan,c.pan):yield n(r,a.pan,c.pan),K(c)?yield i(a,r,c.inputs[0]):yield i(a,r,c),c})))(a,r)}}})(Ke,Js,ot,es,Ce),tn=((t,e,s,n,i,o)=>class extends t{constructor(t,a){const r=i(t),h=c(c({},ne),a),l=s(r,h),u=o(r);super(t,!1,l,u?n():null),this._pan=e(this,u,l.pan)}get pan(){return this._pan}})(Be,ns,Js,Ks,De,Ie),en=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):((i,o)=>d(this,null,(function*(){let a=e(i);return q(a,o)||(a=t(o,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample})),n.set(o,a),K(a)?yield s(i,o,a.inputs[0]):yield s(i,o,a),a})))(i,o)}}})(Ws,ot,Ce),sn=((t,e,s,n,i,o,a)=>class extends t{constructor(t,e){const r=i(t),h=c(c({},ie),e),l=s(r,h);super(t,!0,l,o(r)?n():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=l,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Be,Dt,Ws,en,De,Ie,cs),nn=(t=>null!==t&&t.isSecureContext)(ke),on=(t=>(e,s,n)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*s)},currentTime:{configurable:!0,get:()=>e}});try{return n()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(ke),an=new WeakMap,rn=((t,e)=>s=>{let n=t.get(s);if(void 0!==n)return n;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),t.set(s,n),n})(an,Pe),cn=nn?((t,e,s,n,i,o,a,r,c,h,l,u,d)=>{let p=0;return(f,m,g={credentials:"omit"})=>{const _=l.get(f);if(void 0!==_&&_.has(m))return Promise.resolve();const y=h.get(f);if(void 0!==y){const t=y.get(m);if(void 0!==t)return t}const x=o(f),b=void 0===x.audioWorklet?i(m).then((([t,e])=>{const[n,i]=T(t,e);return s(`${n};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=d._AWGS.pop();if(void 0===t)throw new SyntaxError;n(x.currentTime,x.sampleRate,(()=>t(class{},void 0,((t,s)=>{if(""===t.trim())throw e();const n=v.get(x);if(void 0!==n){if(n.has(t))throw e();k(s),S(s.parameterDescriptors),n.set(t,s)}else k(s),S(s.parameterDescriptors),v.set(x,new Map([[t,s]]))}),x.sampleRate,void 0,void 0)))})):Promise.all([i(m),Promise.resolve(t(u,u))]).then((([[t,e],s])=>{const n=p+1;p=n;const[i,o]=T(t,e),h=new Blob([`${i};((AudioWorkletProcessor,registerProcessor)=>{${o}\n})(${s?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${s?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${s?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${n}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),l=URL.createObjectURL(h);return x.audioWorklet.addModule(l,g).then((()=>{if(r(x))return x;const t=a(x);return t.audioWorklet.addModule(l,g).then((()=>t))})).then((t=>{if(null===c)throw new SyntaxError;try{new c(t,`__sac${n}`)}catch(e){throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(l)))}));return void 0===y?h.set(f,new Map([[m,b]])):y.set(m,b),b.then((()=>{const t=l.get(f);void 0===t?l.set(f,new Set([m])):t.add(m)})).finally((()=>{const t=h.get(f);void 0!==t&&t.delete(m)})),b}})(be,Jt,(t=>e=>new Promise(((s,n)=>{if(null===t)return void n(new SyntaxError);const i=t.document.head;if(null===i)n(new SyntaxError);else{const o=t.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),r=URL.createObjectURL(a),c=t.onerror,h=()=>{t.onerror=c,URL.revokeObjectURL(r)};t.onerror=(e,s,i,o,a)=>s===r||s===t.location.href&&1===i&&1===o?(h(),n(a),!1):null!==c?c(e,s,i,o,a):void 0,o.onerror=()=>{h(),n(new SyntaxError)},o.onload=()=>{h(),s()},o.src=r,o.type="module",i.appendChild(o)}})))(ke),on,(t=>t=>d(this,null,(function*(){try{const e=yield fetch(t);if(e.ok)return[yield e.text(),e.url]}catch(e){}throw new DOMException("","AbortError")})))(),De,rn,Ie,je,new WeakMap,new WeakMap,((t,e)=>()=>d(this,null,(function*(){if(null===t)return!0;if(null===e)return!1;const s=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),i=URL.createObjectURL(s);let o=!1,a=!1;try{yield n.audioWorklet.addModule(i);const e=new t(n,"a",{numberOfOutputs:0}),s=n.createOscillator();e.port.onmessage=()=>o=!0,e.onprocessorerror=()=>a=!0,s.connect(e),s.start(0),yield n.startRendering()}catch(r){}finally{URL.revokeObjectURL(i)}return o&&!a})))(je,Pe),ke):void 0,hn=((t,e)=>s=>t(s)||e(s))(Ve,Ie),ln=((t,e,s,n,i,o,a,r,c,h,l)=>(s,n)=>{const u=a(s)?s:o(s);if(i.has(n)){const t=new DOMException("","DataCloneError");return Promise.reject(t)}try{i.add(n)}catch(g){}return e(c,(()=>c(u)))?u.decodeAudioData(n).then((s=>(kt(n).catch((()=>{})),e(r,(()=>r(s)))||l(s),t.add(s),s))):new Promise(((e,s)=>{const i=()=>d(this,null,(function*(){try{yield kt(n)}catch(t){}})),o=t=>{s(t),i()};try{u.decodeAudioData(n,(s=>{"function"!=typeof s.copyFromChannel&&(h(s),L(s)),t.add(s),i().then((()=>e(s)))}),(t=>{o(null===t?new DOMException("","EncodingError"):t)}))}catch(a){o(a)}}))})(We,be,0,0,new WeakSet,De,hn,F,qt,Xe,Ze),un=((t,e,s,n,i,o,a,r,l,u,d,p,f,m,g,_,y,v,x,b)=>class extends g{constructor(e,s){super(e,s),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,s)=>t(this,e,s)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,n){return new s({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new n(this)}createChannelMerger(t=6){return new o(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new a(this,{numberOfOutputs:t})}createConstantSource(){return new r(this)}createConvolver(){return new l(this)}createDelay(t=1){return new d(this,{maxDelayTime:t})}createDynamicsCompressor(){return new p(this)}createGain(){return new f(this)}createIIRFilter(t,e){return new m(this,{feedback:e,feedforward:t})}createOscillator(){return new _(this)}createPanner(){return new y(this)}createPeriodicWave(t,e,s={disableNormalization:!1}){return new v(this,h(c({},s),{imag:e,real:t}))}createStereoPanner(){return new x(this)}createWaveShaper(){return new b(this)}decodeAudioData(t,e,s){return u(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof s&&s(t),t}))}})(cn,Ge,Ye,os,hs,fs,gs,xs,Ts,ln,ks,Cs,Ds,qs,Ls,Bs,Xs,Ys,tn,sn),dn=((t,e,s,n)=>class extends t{constructor(t,e){const i=s(t),o=((t,e)=>t.createMediaElementSource(e.mediaElement))(i,e);if(n(i))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Be,0,De,Ie),pn=((t,e,s,n)=>class extends t{constructor(t,e){const i=s(t);if(n(i))throw new TypeError;const o=((t,e)=>{const s=t.createMediaStreamDestination();return Vt(s,e),1===s.numberOfOutputs&&Object.defineProperty(s,"numberOfOutputs",{get:()=>0}),s})(i,c(c({},Rt),e));super(t,!1,o,null),this._nativeMediaStreamAudioDestinationNode=o}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Be,0,De,Ie),fn=((t,e,s,n)=>class extends t{constructor(t,e){const i=s(t),o=((t,{mediaStream:e})=>{const s=e.getAudioTracks();s.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const n=s.slice(0,1),i=t.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(i,"mediaStream",{value:e}),i})(i,e);if(n(i))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Be,0,De,Ie),mn=((t,e)=>(s,{mediaStreamTrack:n})=>{if("function"==typeof s.createMediaStreamTrackSource)return s.createMediaStreamTrackSource(n);const i=new MediaStream([n]),o=s.createMediaStreamSource(i);if("audio"!==n.kind)throw t();if(e(s))throw new TypeError;return o})(Dt,Ie),gn=((t,e,s)=>class extends t{constructor(t,n){const i=s(t);super(t,!0,e(i,n),null)}})(Be,mn,De),_n=((t,e,s,n,i,o,a,r,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new c(t)}catch(a){if(12===a.code&&"sampleRate is not in range"===a.message)throw s();throw a}if(null===e)throw n();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw s();super(e,2);const{latencyHint:i}=t,{sampleRate:o}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/o:"interactive"===i||void 0===i?256/o:"playback"===i?1024/o:128*Math.max(2,Math.min(128,Math.round(i*o/128)))/o,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Q(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new o(this)}createMediaStreamSource(t){return new a(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new r(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const s=()=>{this._nativeAudioContext.removeEventListener("statechange",s),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",s)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(un,Dt,Jt,(()=>new DOMException("","UnknownError")),dn,pn,fn,gn,Fe),yn=(t=>e=>{const s=t.get(e);if(void 0===s)throw new Error("The context has no set of AudioWorkletNodes.");return s})(Vs),vn=(t=>(e,s)=>{t(e).add(s)})(yn),xn=(t=>(e,s,n=0,i=0)=>{const o=e[n];if(void 0===o)throw t();return ut(s)?o.connect(s,0,i):o.connect(s,0)})(V),bn=(t=>(e,s)=>{t(e).delete(s)})(yn),wn=(t=>(e,s,n,i=0)=>void 0===s?e.forEach((t=>t.disconnect())):"number"==typeof s?Mt(t,e,s).disconnect():ut(s)?void 0===n?e.forEach((t=>t.disconnect(s))):void 0===i?Mt(t,e,n).disconnect(s,0):Mt(t,e,n).disconnect(s,0,i):void 0===n?e.forEach((t=>t.disconnect(s))):Mt(t,e,n).disconnect(s,0))(V),Tn=new WeakMap,Sn=((t,e)=>s=>e(t,s))(Tn,A),kn=((t,e,s,n,i,o,a,r,l,u,d,p,f)=>(m,g,_,y)=>{if(0===y.numberOfInputs&&0===y.numberOfOutputs)throw l();const v=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(v.some((t=>t<1)))throw l();if(v.length!==y.numberOfOutputs)throw e();if("explicit"!==y.channelCountMode)throw l();const b=y.channelCount*y.numberOfInputs,w=v.reduce(((t,e)=>t+e),0),T=void 0===_.parameterDescriptors?0:_.parameterDescriptors.length;if(b+T>6||w>6)throw l();const S=new MessageChannel,k=[],A=[];for(let t=0;t<y.numberOfInputs;t+=1)k.push(a(m,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),A.push(i(m,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const M=[];if(void 0!==_.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:s,name:n}of _.parameterDescriptors){const i=o(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==y.parameterData[n]?y.parameterData[n]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?B:e},minValue:{get:()=>void 0===s?j:s}}),M.push(i)}const C=n(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,b+T)}),O=zt(g,m.sampleRate),D=r(m,O,b+T,Math.max(1,w)),E=i(m,{channelCount:Math.max(1,w),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,w)}),P=[];for(let t=0;t<y.numberOfOutputs;t+=1)P.push(n(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[t]}));for(let t=0;t<y.numberOfInputs;t+=1){k[t].connect(A[t]);for(let e=0;e<y.channelCount;e+=1)A[t].connect(C,e,t*y.channelCount+e)}const I=new ft(void 0===_.parameterDescriptors?[]:_.parameterDescriptors.map((({name:t},e)=>{const s=M[e];return s.connect(C,0,b+e),s.start(0),[t,s.offset]})));C.connect(D);let R=y.channelInterpretation,q=null;const F=0===y.numberOfOutputs?[D]:P,V={get bufferSize(){return O},get channelCount(){return y.channelCount},set channelCount(t){throw s()},get channelCountMode(){return y.channelCountMode},set channelCountMode(t){throw s()},get channelInterpretation(){return R},set channelInterpretation(t){for(const e of k)e.channelInterpretation=t;R=t},get context(){return D.context},get inputs(){return k},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get onprocessorerror(){return q},set onprocessorerror(t){"function"==typeof q&&V.removeEventListener("processorerror",q),q="function"==typeof t?t:null,"function"==typeof q&&V.addEventListener("processorerror",q)},get parameters(){return I},get port(){return S.port2},addEventListener:(...t)=>D.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,F),disconnect:u.bind(null,F),dispatchEvent:(...t)=>D.dispatchEvent(t[0]),removeEventListener:(...t)=>D.removeEventListener(t[0],t[1],t[2])},L=new Map;var N,z;S.port1.addEventListener=(N=S.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const s=L.get(t[1]);void 0!==s?t[1]=s:(t[1]=t=>{d(m.currentTime,m.sampleRate,(()=>e(t)))},L.set(e,t[1]))}}return N.call(S.port1,t[0],t[1],t[2])}),S.port1.removeEventListener=(z=S.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=L.get(t[1]);void 0!==e&&(L.delete(t[1]),t[1]=e)}return z.call(S.port1,t[0],t[1],t[2])});let G=null;Object.defineProperty(S.port1,"onmessage",{get:()=>G,set(t){"function"==typeof G&&S.port1.removeEventListener("message",G),G="function"==typeof t?t:null,"function"==typeof G&&(S.port1.addEventListener("message",G),S.port1.start())}}),_.prototype.port=S.port1;let W=null;((t,e,s,n)=>{let i=x.get(t);void 0===i&&(i=new WeakMap,x.set(t,i));const o=Gt(s,n);return i.set(e,o),o})(m,V,_,y).then((t=>W=t));const U=yt(y.numberOfInputs,y.channelCount),$=yt(y.numberOfOutputs,v),Q=void 0===_.parameterDescriptors?[]:_.parameterDescriptors.reduce(((t,{name:e})=>h(c({},t),{[e]:new Float32Array(128)})),{});let X=!0;const Z=()=>{y.numberOfOutputs>0&&D.disconnect(E);for(let t=0,e=0;t<y.numberOfOutputs;t+=1){const s=P[t];for(let n=0;n<v[t];n+=1)E.disconnect(s,e+n,n);e+=v[t]}},Y=new Map;D.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==W){const n=p(V);for(let i=0;i<O;i+=128){for(let e=0;e<y.numberOfInputs;e+=1)for(let s=0;s<y.channelCount;s+=1)gt(t,U[e],s,s,i);void 0!==_.parameterDescriptors&&_.parameterDescriptors.forEach((({name:e},s)=>{gt(t,Q,e,b+s,i)}));for(let t=0;t<y.numberOfInputs;t+=1)for(let e=0;e<v[t];e+=1)0===$[t][e].byteLength&&($[t][e]=new Float32Array(128));try{const t=U.map(((t,e)=>{if(n[e].size>0)return Y.set(e,O/128),t;const s=Y.get(e);return void 0===s?[]:(t.every((t=>t.every((t=>0===t))))&&(1===s?Y.delete(e):Y.set(e,s-1)),t)})),s=d(m.currentTime+i/m.sampleRate,m.sampleRate,(()=>W.process(t,$,Q)));X=s;for(let n=0,o=0;n<y.numberOfOutputs;n+=1){for(let t=0;t<v[n];t+=1)_t(e,$[n],t,o+t,i);o+=v[n]}}catch(s){X=!1,V.dispatchEvent(new ErrorEvent("processorerror",{colno:s.colno,filename:s.filename,lineno:s.lineno,message:s.message}))}if(!X){for(let t=0;t<y.numberOfInputs;t+=1){k[t].disconnect(A[t]);for(let e=0;e<y.channelCount;e+=1)A[i].disconnect(C,e,t*y.channelCount+e)}if(void 0!==_.parameterDescriptors){const t=_.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=M[e];t.disconnect(C,0,b+e),t.stop()}}C.disconnect(D),D.onaudioprocess=null,H?Z():tt();break}}}};let H=!1;const J=a(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),K=()=>D.connect(J).connect(m.destination),tt=()=>{D.disconnect(J),J.disconnect()};return K(),f(V,(()=>{if(X){tt(),y.numberOfOutputs>0&&D.connect(E);for(let t=0,e=0;t<y.numberOfOutputs;t+=1){const s=P[t];for(let n=0;n<v[t];n+=1)E.connect(s,e+n,n);e+=v[t]}}H=!0}),(()=>{X&&(K(),Z()),H=!1}))})(xn,V,Dt,ds,Ut,ys,Xt,Ht,Jt,wn,on,Sn,ls),An=((t,e,s,n,i)=>(o,a,r,h,l,u)=>{if(null!==r)try{const e=new r(o,h,u),n=new Map;let a=null;if(Object.defineProperties(e,{channelCount:{get:()=>u.channelCount,set(){throw t()}},channelCountMode:{get:()=>"explicit",set(){throw t()}},onprocessorerror:{get:()=>a,set(t){"function"==typeof a&&e.removeEventListener("processorerror",a),a="function"==typeof t?t:null,"function"==typeof a&&e.addEventListener("processorerror",a)}}}),e.addEventListener=(p=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const s=n.get(t[1]);void 0!==s?t[1]=s:(t[1]=s=>{"error"===s.type?(Object.defineProperties(s,{type:{value:"processorerror"}}),e(s)):e(new ErrorEvent(t[0],c({},s)))},n.set(e,t[1]))}}return p.call(e,"error",t[1],t[2]),p.call(e,...t)}),e.removeEventListener=(d=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=n.get(t[1]);void 0!==e&&(n.delete(t[1]),t[1]=e)}return d.call(e,"error",t[1],t[2]),d.call(e,t[0],t[1],t[2])}),0!==u.numberOfOutputs){const t=s(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return e.connect(t).connect(o.destination),i(e,(()=>t.disconnect()),(()=>t.connect(o.destination)))}return e}catch(_){if(11===_.code)throw n();throw _}var d,p;if(void 0===l)throw n();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(u),e(o,a,l,u)})(Dt,kn,Xt,Jt,ls),Mn=((t,e,s,n,i,o,a,r,c,h,l,u,p,f,m,g)=>(_,y,v)=>{const x=new WeakMap;let b=null;return{render(w,T){r(T,w);const S=x.get(T);return void 0!==S?Promise.resolve(S):((r,w)=>d(this,null,(function*(){let T=l(r),S=null;const k=q(T,w),A=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(null===u){const t=A.reduce(((t,e)=>t+e),0),s=i(w,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),o=[];for(let e=0;e<r.numberOfOutputs;e+=1)o.push(n(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[e]}));const h=a(w,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});h.connect=e.bind(null,o),h.disconnect=c.bind(null,o),S=[s,o,h]}else k||(T=new u(w,_));if(x.set(w,null===S?T:S[2]),null!==S){if(null===b){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=r.channelCount*r.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,s=t+e,c=()=>d(this,null,(function*(){const c=new p(s,128*Math.ceil(r.context.length/128),w.sampleRate),h=[],l=[];for(let t=0;t<y.numberOfInputs;t+=1)h.push(a(c,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),l.push(i(c,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const u=yield Promise.all(Array.from(r.parameters.values()).map((t=>d(this,null,(function*(){const e=o(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return yield f(c,t,e.offset),e}))))),_=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<y.numberOfInputs;t+=1){h[t].connect(l[t]);for(let e=0;e<y.channelCount;e+=1)l[t].connect(_,e,t*y.channelCount+e)}for(const[e,s]of u.entries())s.connect(_,0,t+e),s.start(0);return _.connect(c.destination),yield Promise.all(h.map((t=>m(r,c,t)))),g(c)}));b=vt(r,0===s?null:yield c(),w,y,A,v,h)}const t=yield b,e=s(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,l,u]=S;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let s=0,n=0;s<r.numberOfOutputs;s+=1){const t=l[s];for(let e=0;e<A[s];e+=1)c.connect(t,n+e,e);n+=A[s]}return u}if(k)for(const[e,s]of r.parameters.entries())yield t(w,s,T.parameters.get(e));else for(const[t,e]of r.parameters.entries())yield f(w,e,T.parameters.get(t));return yield m(r,w,T),T})))(w,T)}}})(Ke,xn,ts,ds,Ut,ys,Xt,bn,wn,on,ot,je,Pe,es,Ce,Ps),Cn=(t=>e=>t.get(e))(an),On=(t=>(e,s)=>{t.set(e,s)})(Tn),Dn=nn?((t,e,s,n,i,o,a,r,l,u,d,p,f,m)=>class extends e{constructor(e,d,f){var m;const g=r(e),_=l(g),y=(t=>h(c({},t),{outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))}))(c(c({},mt),f));(t=>{const{port1:e,port2:s}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),s.close()}})(y);const x=v.get(g),b=null==x?void 0:x.get(d),w=_||"closed"!==g.state?g:null!==(m=a(g))&&void 0!==m?m:g,T=i(w,_?null:e.baseLatency,u,d,b,y);super(e,!0,T,_?n(d,y,b):null);const S=[];T.parameters.forEach(((t,e)=>{const n=s(this,_,t);S.push([e,n])})),this._nativeAudioWorkletNode=T,this._onprocessorerror=null,this._parameters=new ft(S),_&&t(g,this);const{activeInputs:k}=o(this);p(T,k)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?m(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const s=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==s&&s===e?t:s}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(vn,Be,ns,Mn,An,W,Cn,De,Ie,je,0,On,0,me):void 0,En=((t,e)=>(s,n,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(s,n,i)}catch(o){if("SyntaxError"===o.name)throw t();throw o}})(Jt,Pe),Pn=((t,e,s,n,i,o,a,r)=>(c,h)=>s(c).render(c,h).then((()=>Promise.all(Array.from(n(h)).map((t=>s(t).render(t,h)))))).then((()=>i(h))).then((s=>("function"!=typeof s.copyFromChannel?(a(s),L(s)):e(o,(()=>o(s)))||r(s),t.add(s),s))))(We,be,Me,yn,Ps,F,Xe,Ze),In=((t,e,s,n,i)=>class extends t{constructor(t,s,i){let o;if("number"==typeof t&&void 0!==s&&void 0!==i)o={length:s,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");o=t}const{length:a,numberOfChannels:r,sampleRate:h}=c(c({},Kt),o),l=n(r,a,h);e(qt,(()=>qt(l)))||l.addEventListener("statechange",(()=>{let t=0;const e=s=>{"running"===this._state&&(t>0?(l.removeEventListener("statechange",e),s.stopImmediatePropagation(),this._waitForThePromiseToSettle(s)):t+=1)};return e})()),super(l,r),this._length=a,this._nativeOfflineAudioContext=l,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(s()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,Q(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(un,be,Dt,En,Pn),Rn=((t,e)=>s=>{const n=t.get(s);return e(n)||e(s)})(g,Ve),qn=((t,e)=>s=>t.has(s)||e(s))(p,Le),Fn=((t,e)=>s=>t.has(s)||e(s))(m,Ne),Vn=((t,e)=>s=>{const n=t.get(s);return e(n)||e(s)})(g,Ie),Ln=()=>((t,e,s,n,i,o,a,r,c,h,l,u,p,f,m,g)=>d(this,null,(function*(){return!!(t(e,e)&&t(s,s)&&t(i,i)&&t(o,o)&&t(r,r)&&t(c,c)&&t(h,h)&&t(l,l)&&t(u,u)&&t(p,p)&&t(f,f))&&(yield Promise.all([t(n,n),t(a,a),t(m,m),t(g,g)])).every((t=>t))})))(be,(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createBuffer(1,1,44100);if(void 0===e.copyToChannel)return!0;const s=new Float32Array(2);try{e.copyFromChannel(s,0,0)}catch(n){return!1}return!0})(Pe),(t=>()=>{if(null===t)return!1;if(void 0!==t.prototype&&void 0!==t.prototype.close)return!0;const e=new t,s=void 0!==e.close;try{e.close()}catch(n){}return s})(Fe),(t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);return new Promise((t=>{let s=!0;const n=n=>{s&&(s=!1,e.startRendering(),t(n instanceof TypeError))};let i;try{i=e.decodeAudioData(null,(()=>{}),n)}catch(o){n(o)}void 0!==i&&i.catch(n)}))})(Pe),(t=>()=>{if(null===t)return!1;let e;try{e=new t({latencyHint:"balanced"})}catch(s){return!1}return e.close(),!0})(Fe),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createGain(),s=e.connect(e)===e;return e.disconnect(e),s})(Pe),((t,e)=>()=>d(this,null,(function*(){if(null===t)return!0;if(null===e)return!1;const s=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new MessageChannel,i=new e(1,128,44100),o=URL.createObjectURL(s);let a=!1;try{yield i.audioWorklet.addModule(o);const e=new t(i,"a",{numberOfOutputs:0}),s=i.createOscillator();yield new Promise((t=>{e.port.onmessage=()=>t(),e.port.postMessage(n.port2,[n.port2])})),e.port.onmessage=()=>a=!0,s.connect(e),s.start(0),yield i.startRendering(),a=yield new Promise((t=>{n.port1.onmessage=({data:e})=>t(1===e),n.port1.postMessage(0)}))}catch(r){}finally{n.port1.close(),URL.revokeObjectURL(o)}return a})))(je,Pe),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createChannelMerger();if("max"===e.channelCountMode)return!0;try{e.channelCount=2}catch(s){return!0}return!1})(Pe),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100);return void 0===e.createConstantSource||e.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(Pe),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),s=e.createConvolver();s.buffer=e.createBuffer(1,1,e.sampleRate);try{s.buffer=e.createBuffer(1,1,e.sampleRate)}catch(n){return!1}return!0})(Pe),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createConvolver();try{e.channelCount=1}catch(s){return!1}return!0})(Pe),de,(t=>()=>null!==t&&t.hasOwnProperty("isSecureContext"))(ke),(t=>()=>{if(null===t)return!1;const e=new t;try{return e.createMediaStreamSource(new MediaStream),!1}catch(s){return!0}finally{e.close()}})(Fe),(t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);if(void 0===e.createStereoPanner)return Promise.resolve(!0);if(void 0===e.createConstantSource)return Promise.resolve(!0);const s=e.createConstantSource(),n=e.createStereoPanner();return s.channelCount=1,s.offset.value=1,n.channelCount=1,s.start(),s.connect(n).connect(e.destination),e.startRendering().then((t=>1!==t.getChannelData(0)[0]))})(Pe),pe);function Nn(t,e){if(!t)throw new Error(e)}function jn(t,e,s=1/0){if(!(e<=t&&t<=s))throw new RangeError(`Value must be within [${e}, ${s}], got: ${t}`)}function Bn(t){t.isOffline||"running"===t.state||Un('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let zn=console;function Gn(t){zn=t}function Wn(...t){zn.log(...t)}function Un(...t){zn.warn(...t)}function $n(t){return void 0===t}function Qn(t){return!$n(t)}function Xn(t){return"function"==typeof t}function Zn(t){return"number"==typeof t}function Yn(t){return"[object Object]"==={}.toString.call(t)&&t.constructor===Object}function Hn(t){return"boolean"==typeof t}function Jn(t){return Array.isArray(t)}function Kn(t){return"string"==typeof t}function ti(t){return Kn(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const ei="object"==typeof self?self:null,si=ei&&(ei.hasOwnProperty("AudioContext")||ei.hasOwnProperty("webkitAudioContext"));function ni(t,e,s,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,n);else for(var r=t.length-1;r>=0;r--)(i=t[r])&&(a=(o<3?i(a):o>3?i(e,s,a):i(e,s))||a);return o>3&&a&&Object.defineProperty(e,s,a),a}function ii(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))}class oi{constructor(t,e,s){this._callback=t,this._type=e,this._updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(we){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function ai(t){return Fn(t)}function ri(t){return qn(t)}function ci(t){return Vn(t)}function hi(t){return Rn(t)}function li(t){return t instanceof AudioBuffer}function ui(t,e){return"value"===t||ai(e)||ri(e)||li(e)}function di(t,...e){if(!e.length)return t;const s=e.shift();if(Yn(t)&&Yn(s))for(const n in s)ui(n,s[n])?t[n]=s[n]:Yn(s[n])?(t[n]||Object.assign(t,{[n]:{}}),di(t[n],s[n])):Object.assign(t,{[n]:s[n]});return di(t,...e)}function pi(t,e,s=[],n){const i={},o=Array.from(e);if(Yn(o[0])&&n&&!Reflect.has(o[0],n)&&(Object.keys(o[0]).some((e=>Reflect.has(t,e)))||(di(i,{[n]:o[0]}),s.splice(s.indexOf(n),1),o.shift())),1===o.length&&Yn(o[0]))di(i,o[0]);else for(let a=0;a<s.length;a++)Qn(o[a])&&(i[s[a]]=o[a]);return di(t,i)}function fi(t,e){return $n(t)?e:t}function mi(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}class gi{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||ei&&this.toString()===ei.TONE_DEBUG_CLASS)&&Wn(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}gi.version=n;const _i=1e-6;function yi(t,e){return t>e+_i}function vi(t,e){return yi(t,e)||bi(t,e)}function xi(t,e){return t+_i<e}function bi(t,e){return Math.abs(t-e)<_i}function wi(t,e,s){return Math.max(Math.min(t,s),e)}class Ti extends gi{constructor(){super(),this.name="Timeline",this._timeline=[];const t=pi(Ti.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Nn(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length)Nn(vi(t.time,this._timeline[this.length-1].time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t);else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}return this.length>this.memory&&this._timeline.splice(0,this.length-this.memory),this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return-1!==s?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(bi(this._timeline[e].time,t)){for(let s=e;s>=0&&bi(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&vi(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let s=0;const n=this._timeline.length;let i=n;if(n>0&&this._timeline[n-1][e]<=t)return n-1;for(;s<i;){let n=Math.floor(s+(i-s)/2);const o=this._timeline[n],a=this._timeline[n+1];if(bi(o[e],t)){for(let s=n;s<this._timeline.length&&bi(this._timeline[s][e],t);s++)n=s;return n}if(xi(o[e],t)&&yi(a[e],t))return n;yi(o[e],t)?i=n:s=n+1}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return-1!==s&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let n=this._search(t),i=this._search(e);return-1!==n&&-1!==i?(this._timeline[n].time!==t&&(n+=1),this._timeline[i].time===e&&(i-=1),this._iterate(s,n,i)):-1===n&&this._iterate(s,0,i),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(-1!==s&&bi(this._timeline[s].time,t)){let n=s;for(let e=s;e>=0&&bi(this._timeline[e].time,t);e--)n=e;this._iterate((t=>{e(t)}),n,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Si=[];function ki(t){Si.push(t)}const Ai=[];function Mi(t){Ai.push(t)}class Ci extends gi{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{$n(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const s=(...n)=>{e(...n),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach((()=>{if($n(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if($n(e))this._events[t]=[];else{const s=this._events[t];for(let t=s.length-1;t>=0;t--)s[t]===e&&s.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let t=0,n=s.length;t<n;t++)s[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const s=Object.getOwnPropertyDescriptor(Ci.prototype,e);Object.defineProperty(t.prototype,e,s)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Oi extends Ci{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Di extends Oi{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Ti,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=pi(Di.getDefaults(),arguments,["context"]);var e;this._context=t.context?t.context:(e={latencyHint:t.latencyHint},new _n(e)),this._ticker=new oi(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,Si.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return Nn(hi(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return Nn(hi(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return Nn(hi(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Nn(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Nn(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Nn(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Nn(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return s=this.rawContext,n=t,i=e,Nn(Qn(Dn),"This node only works in a secure context (https or localhost)"),new Dn(s,n,i);var s,n,i}addAudioWorkletModule(t,e){return ii(this,void 0,void 0,(function*(){Nn(Qn(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return ii(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Kn(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return hi(this._context)?this._context.resume():Promise.resolve()}close(){return ii(this,void 0,void 0,(function*(){var t;hi(this._context)&&(yield this._context.close()),this._initialized&&(t=this,Ai.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let i=0;i<s.length;i++)s[i]=t;const n=this._context.createBufferSource();return n.channelCount=1,n.channelCountMode="explicit",n.buffer=e,n.loop=!0,n.start(0),this._constants.set(t,n),n}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,n=()=>{const i=this.now();this._timeouts.add({callback(){t(),n()},id:s,time:i+e})};return n(),s}}function Ei(t,e){Jn(e)?e.forEach((e=>Ei(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function Pi(t,e){Jn(e)?e.forEach((e=>Pi(t,e))):Object.defineProperty(t,e,{writable:!0})}const Ii=()=>{};class Ri extends gi{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ii;const t=pi(Ri.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&li(t.url)||t.url instanceof Ri?this.set(t.url):Kn(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:Ii,onload:Ii,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Li().sampleRate}set(t){return t instanceof Ri?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return ii(this,void 0,void 0,(function*(){const e=Ri.load(t).then((t=>{this.set(t),this.onload(this)}));Ri.downloads.push(e);try{yield e}finally{const t=Ri.downloads.indexOf(e);Ri.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Jn(t)&&t[0].length>0,s=e?t.length:1,n=e?t[0].length:t.length,i=Li(),o=i.createBuffer(s,n,i.sampleRate),a=e||1!==s?t:[t];for(let r=0;r<s;r++)o.copyToChannel(a[r],r);return this._buffer=o,this}toMono(t){if(Zn(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let s=0;s<e;s++){const e=this.toArray(s);for(let s=0;s<e.length;s++)t[s]+=e[s]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Zn(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const s=Math.floor(t*this.sampleRate),n=Math.floor(e*this.sampleRate);Nn(s<n,"The start time must be less than the end time");const i=n-s,o=Li().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,n),a);return new Ri(o)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new Ri).fromArray(t)}static fromUrl(t){return ii(this,void 0,void 0,(function*(){const e=new Ri;return yield e.load(t)}))}static load(t){return ii(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const s=e[1].split("|");let n=s[0];for(const t of s)if(Ri.supportsType(t)){n=t;break}t=t.replace(e[0],n)}const s=""===Ri.baseUrl||Ri.baseUrl.endsWith("/")?Ri.baseUrl:Ri.baseUrl+"/",n=yield fetch(s+t);if(!n.ok)throw new Error(`could not load url: ${t}`);const i=yield n.arrayBuffer();return yield Li().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),s=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+s)}static loaded(){return ii(this,void 0,void 0,(function*(){for(yield Promise.resolve();Ri.downloads.length;)yield Ri.downloads[0]}))}}Ri.baseUrl="",Ri.downloads=[];class qi extends Di{constructor(){var t,e,s;super({clockSource:"offline",context:ci(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],s=arguments[2],new In(t,e,s)),lookAhead:0,updateInterval:ci(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ci(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return ii(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return ii(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Ri(e)}))}close(){return Promise.resolve()}}const Fi=new class extends Oi{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,s){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return ii(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let Vi=Fi;function Li(){return Vi===Fi&&si&&Ni(new Di),Vi}function Ni(t){Vi=hi(t)?new Di(t):ci(t)?new qi(t):t}function ji(){return Vi.resume()}function Bi(t){return Math.pow(10,t/20)}function zi(t){return Math.log(t)/Math.LN10*20}function Gi(t){return Math.pow(2,t/12)}ei&&ei.TONE_SILENCE_LOGGING;let Wi=440;function Ui(t){return Math.round($i(t))}function $i(t){return 69+12*Math.log2(t/Wi)}function Qi(t){return Wi*Math.pow(2,(t-69)/12)}class Xi extends gi{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),n="."===e?1.5:1;return 1===s?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/s)*n},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let n=0;return t&&"0"!==t&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(n+=this._beatsToUnits(parseFloat(e))),s&&"0"!==s&&(n+=this._beatsToUnits(parseFloat(s)/4)),n},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Xi&&this.fromType(this._val),$n(this._val))return this._noArg();if(Kn(this._val)&&$n(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Yn(this._val)){let t=0;for(const e in this._val)if(Qn(this._val[e])){const s=this._val[e];t+=new this.constructor(this.context,e).valueOf()*s}return t}if(Qn(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Kn(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Zi extends Xi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Zi(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),n=this.valueOf();return n+(Math.round(n/s)*s-n)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const t=Math.pow(2,i);e.push(t+"n."),e.push(t+"n"),e.push(t+"t")}e.push("0");let s=e[0],n=new Zi(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Zi(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(n-t)&&(s=e,n=i)})),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let n=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=n.toString();return i.length>3&&(n=parseFloat(parseFloat(i).toFixed(3))),[s,e,n].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Ui(this.toFrequency())}_now(){return this.context.now()}}function Yi(t,e){return new Zi(Li(),t,e)}class Hi extends Zi{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Wi}static set A4(t){Wi=t}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Hi.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const s=Ji[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?s:Hi.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let n=1;return t&&"0"!==t&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(n*=this._beatsToUnits(parseFloat(e))),s&&"0"!==s&&(n*=this._beatsToUnits(parseFloat(s)/4)),n}}})}transpose(t){return new Hi(this.context,this.valueOf()*Gi(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return Ui(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Hi.A4);let s=Math.round(12*e)+57;const n=Math.floor(s/12);return n<0&&(s+=-12*n),Ki[s%12]+n.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Qi(t)}static ftom(t){return Ui(t)}}const Ji={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Ki=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function to(t,e){return new Hi(Li(),t,e)}class eo extends Zi{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function so(t,e){return new eo(Li(),t,e)}class no extends gi{constructor(){super();const t=pi(no.getDefaults(),arguments,["context"]);this.context=this.defaultContext?this.defaultContext:t.context}static getDefaults(){return{context:Li()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Zi(this.context,t).toSeconds()}toFrequency(t){return new Hi(this.context,t).toFrequency()}toTicks(t){return new eo(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((s=>{$n(t[s])&&delete e[s]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const s=this[e];Qn(s)&&Qn(s.value)&&Qn(s.setValueAtTime)?t[e]=s.value:s instanceof no?t[e]=s._getPartialProperties(t[e]):Jn(s)||Zn(s)||Kn(s)||Hn(s)?t[e]=s:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Qn(this[e])&&(this[e]&&Qn(this[e].value)&&Qn(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof no?this[e].set(t[e]):this[e]=t[e])})),this}}class io extends Ti{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,s){return jn(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){for(let s=this._search(e);s>=0;s--){const e=this._timeline[s];if(e.state===t)return e}}getNextState(t,e){const s=this._search(e);if(-1!==s)for(let n=s;n<this._timeline.length;n++){const e=this._timeline[n];if(e.state===t)return e}}}class oo extends no{constructor(){super(pi(oo.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=pi(oo.getDefaults(),arguments,["param","units","convert"]);for(Nn(Qn(t.param)&&(ai(t.param)||t.param instanceof oo),"param must be an AudioParam");!ai(t.param);)t.param=t.param._param;this._swappable=!!Qn(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Ti(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Qn(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(no.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Qn(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Qn(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Qn(this.maxValue)&&Qn(this.minValue)&&jn(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?Bi(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?zi(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),n=this._fromType(t);return Nn(isFinite(n)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),n=this._events.get(e);let i=this._initialValue;if(null===n)i=this._initialValue;else if("setTargetAtTime"!==n.type||null!==s&&"setValueAtTime"!==s.type)if(null===s)i=n.value;else if("linearRampToValueAtTime"===s.type||"exponentialRampToValueAtTime"===s.type){let t=n.value;if("setTargetAtTime"===n.type){const e=this._events.getBefore(n.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===s.type?this._linearInterpolate(n.time,t,s.time,s.value,e):this._exponentialInterpolate(n.time,t,s.time,s.value,e)}else i=n.value;else{const t=this._events.getBefore(n.time);let s;s=null===t?this._initialValue:t.value,"setTargetAtTime"===n.type&&(i=this._exponentialApproach(n.time,s,n.value,n.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),n=this.toSeconds(e);return Nn(isFinite(s)&&isFinite(n),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:n,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,n),this._param.linearRampToValueAtTime(s,n),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=bi(s,0)?this._minOutput:s,this._assertRange(s);const n=this.toSeconds(e);return Nn(isFinite(s)&&isFinite(n),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:n,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,n),this._param.exponentialRampToValueAtTime(s,n),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const n=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,n),this.cancelAndHoldAtTime(e+.9*s),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const n=this._fromType(t);Nn(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(n),Nn(isFinite(n)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:n}),this.log(this.units,"setTargetAtTime",t,i,s),this._param.setTargetAtTime(n,i,s),this}setValueCurveAtTime(t,e,s,n=1){s=this.toSeconds(s),e=this.toSeconds(e);const i=this._fromType(t[0])*n;this.setValueAtTime(this._toType(i),e);const o=s/(t.length-1);for(let a=1;a<t.length;a++){const s=this._fromType(t[a])*n;this.linearRampToValueAtTime(this._toType(s),e+a*o)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Nn(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));Nn(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const n=this._events.get(e),i=this._events.getAfter(e);return n&&bi(n.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(s),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&"setTargetAtTime"===s.type){const n=this._events.getAfter(s.time),i=n?n.time:e+2,o=(i-e)/10;for(let s=e;s<i;s+=o)t.linearRampToValueAtTime(this.getValueAtTime(s),s)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Nn(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,n,i){return s+(e-s)*Math.exp(-(i-t)/n)}_linearInterpolate(t,e,s,n,i){return e+(i-t)/(s-t)*(n-e)}_exponentialInterpolate(t,e,s,n,i){return e*Math.pow(n/e,(i-t)/(s-t))}}class ao extends no{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Qn(this.input)?ai(this.input)||this.input instanceof oo?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Qn(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Qn(t)&&(t instanceof ao||ri(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Nn(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return co(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Un("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return ho(this,t,e,s),this}chain(...t){return ro(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Qn(this.input)&&(this.input instanceof ao?this.input.dispose():ri(this.input)&&this.input.disconnect()),Qn(this.output)&&(this.output instanceof ao?this.output.dispose():ri(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function ro(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof ao?t.connect(e):ri(t)&&co(t,e),e)),e)}function co(t,e,s=0,n=0){for(Nn(Qn(t),"Cannot connect from undefined node"),Nn(Qn(e),"Cannot connect to undefined node"),(e instanceof ao||ri(e))&&Nn(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Nn(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof ao||e instanceof oo;)Qn(e.input)&&(e=e.input);for(;t instanceof ao;)Qn(t.output)&&(t=t.output);ai(e)?t.connect(e,s):t.connect(e,s,n)}function ho(t,e,s=0,n=0){if(Qn(e))for(;e instanceof ao;)e=e.input;for(;!ri(t);)Qn(t.output)&&(t=t.output);ai(e)?t.disconnect(e,s):ri(e)?t.disconnect(e,s,n):t.disconnect()}class lo extends ao{constructor(){super(pi(lo.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=pi(lo.getDefaults(),arguments,["gain","units"]);this.gain=new oo({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),Ei(this,"gain")}static getDefaults(){return Object.assign(ao.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class uo extends ao{constructor(t){super(t),this.onended=Ii,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new lo({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(ao.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ii})}_startGain(t,e=1){Nn(-1===this._startTime,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Nn(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ii&&(this.onended(this),this.onended=Ii,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Nn(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class po extends uo{constructor(){super(pi(po.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=pi(po.getDefaults(),arguments,["offset"]);co(this._source,this._gainNode),this.offset=new oo({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(uo.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class fo extends ao{constructor(){super(pi(fo.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=pi(fo.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new po({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ao.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return mo(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,n){return this._param.setValueCurveAtTime(t,e,s,n),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function mo(t,e,s,n){(e instanceof oo||ai(e)||e instanceof fo&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof fo&&(e.overridden=!0)),co(t,e,s,n)}class go extends oo{constructor(){super(pi(go.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Ti(1/0),this._multiplier=1;const t=pi(go.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(oo.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const n=this._fromType(t),i=this._events.get(e),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const t=s*a+e,o=this._exponentialApproach(i.time,i.value,n,s,t);this.linearRampToValueAtTime(this._toType(o),t)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const n=this._events.get(s),i=this._events.previousEvent(n),o=this._getTicksUntilEvent(i,s);return n.ticks=Math.max(o,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const n=this._events.get(s),i=this._events.previousEvent(n),o=this._getTicksUntilEvent(i,s);return n.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),n=this._events.get(e),i=Math.round(Math.max(10*(e-n.time),1)),o=(e-n.time)/i;for(let a=0;a<=i;a++){const t=o*a+n.time,i=this._exponentialInterpolate(n.time,n.value,e,s,t);this.linearRampToValueAtTime(this._toType(i),t)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if($n(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let n=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(n=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+n)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),n=this.getTicksAtTime(e);return this.getTimeOfTick(n+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&"linearRampToValueAtTime"===s.type&&e.value!==s.value){const n=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(s.time))-n)/(s.time-e.time),o=Math.sqrt(Math.pow(n,2)-2*i*(e.ticks-t)),a=(-n+o)/i,r=(-n-o)/i;return(a>0?a:r)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),n=this.toSeconds(t),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+n)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class _o extends fo{constructor(){super(pi(_o.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=pi(_o.getDefaults(),arguments,["value"]);this.input=this._param=new go({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(fo.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class yo extends no{constructor(){super(pi(yo.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new io,this._tickOffset=new Ti;const t=pi(yo.getDefaults(),arguments,["frequency"]);this.frequency=new _o({context:this.context,units:t.units,value:t.frequency}),Ei(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},no.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return"started"!==this._state.getValueAtTime(s)&&(this._state.setStateAtTime("started",s),Qn(e)&&this.setTicksAtTime(e,s)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let i=s,o=0;return this._state.forEachBetween(s.time,e+this.sampleTime,(t=>{let e=i.time;const s=this._tickOffset.get(t.time);s&&s.time>=i.time&&(o=s.ticks,e=s.time),"started"===i.state&&"started"!==t.state&&(o+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(n),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let n=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=n.time;const s=this._tickOffset.get(t.time);s&&s.time>=n.time&&(i=s.seconds,e=s.time),"started"===n.state&&"started"!==t.state&&(i+=t.time-e),n=t})),this._state.remove(s),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),n=this._state.get(e),i=Math.max(s.time,n.time),o=this.frequency.getTicksAtTime(i)+t-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(t,e,s){let n=this._state.get(t);this._state.forEachBetween(t,e,(e=>{n&&"started"===n.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(n.time,t),e.time-this.sampleTime,s),n=e}));let i=null;if(n&&"started"===n.state){const a=Math.max(n.time,t),r=this.frequency.getTicksAtTime(a),c=r-this.frequency.getTicksAtTime(n.time);let h=Math.ceil(c)-c;h=bi(h,1)?0:h;let l=this.frequency.getTimeOfTick(r+h);for(;l<e;){try{s(l,Math.round(this.getTicksAtTime(l)))}catch(o){i=o;break}l+=this.frequency.getDurationOfTicks(1,l)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class vo extends no{constructor(){super(pi(vo.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Ii,this._lastUpdate=0,this._state=new io("stopped"),this._boundLoop=this._loop.bind(this);const t=pi(vo.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new yo({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ei(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(no.getDefaults(),{callback:Ii,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Bn(this.context);const s=this.toSeconds(t);return this.log("start",s),"started"!==this._state.getValueAtTime(s)&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),n=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(n+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ci.mixin(vo);class xo extends ao{constructor(){super(pi(xo.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=pi(xo.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new oo({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),Ei(this,"delayTime")}static getDefaults(){return Object.assign(ao.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function bo(t,e,s=2,n=Li().sampleRate){return ii(this,void 0,void 0,(function*(){const i=Li(),o=new qi(s,e,n);Ni(o),yield t(o);const a=o.render();Ni(i);const r=yield a;return new Ri(r)}))}class wo extends gi{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=pi(wo.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++,this.add(e,t.urls[e],this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Ii,onload:Ii,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Nn(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,s=Ii,n=Ii){return Kn(e)?this._buffers.set(t.toString(),new Ri(this.baseUrl+e,s,n)):this._buffers.set(t.toString(),new Ri(e,s,n)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class To extends Hi{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return Ui(super._frequencyToUnits(t))}_ticksToUnits(t){return Ui(super._ticksToUnits(t))}_beatsToUnits(t){return Ui(super._beatsToUnits(t))}_secondsToUnits(t){return Ui(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return Qi(this.toMidi())}transpose(t){return new To(this.context,this.toMidi()+t)}}function So(t,e){return new To(Li(),t,e)}class ko extends eo{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function Ao(t,e){return new ko(Li(),t,e)}class Mo extends no{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ti,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}ki((t=>{t.draw=new Mo({context:t})})),Mi((t=>{t.draw.dispose()}));class Co extends gi{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Nn(Qn(t.time),"Events must have a time property"),Nn(Qn(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new Oo(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,s=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,s=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,s=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,s=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,s=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),s&&this._rebalance(s)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),n=t.right;n&&(t.right=n.left,n.left=t),null!==e?s?e.left=n:e.right=n:this._setRoot(n)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),n=t.left;n&&(t.left=n.right,n.right=t),null!==e?s?e.left=n:e.right=n:this._setRoot(n)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let s=1;s<e.length;s++)e[s].low>t.low&&(t=e[s]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const s=[];this._root.search(t,s),s.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const s=[];this._root.searchAfter(t,s),s.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class Oo{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){this.height=null!==this.left&&null!==this.right?Math.max(this.left.height,this.right.height)+1:null!==this.right?this.right.height+1:null!==this.left?this.left.height+1:0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Do extends ao{constructor(){super(pi(Do.getDefaults(),arguments,["volume"])),this.name="Volume";const t=pi(Do.getDefaults(),arguments,["volume"]);this.input=this.output=new lo({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,Ei(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(ao.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Eo extends ao{constructor(){super(pi(Eo.getDefaults(),arguments)),this.name="Destination",this.input=new Do({context:this.context}),this.output=new lo({context:this.context}),this.volume=this.input.volume;const t=pi(Eo.getDefaults(),arguments);ro(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ao.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),ro(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}ki((t=>{t.destination=new Eo({context:t})})),Mi((t=>{t.destination.dispose()}));class Po extends gi{constructor(t){super(),this.name="TimelineValue",this._timeline=new Ti({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class Io{constructor(t,e){this.id=Io._eventId++;const s=Object.assign(Io.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=s.time}static getDefaults(){return{callback:Ii,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Io._eventId=0;class Ro extends Io{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(Ro.getDefaults(),e);this.duration=new ko(t.context,s.duration).valueOf(),this._interval=new ko(t.context,s.interval).valueOf(),this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Io.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ko(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new ko(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ko(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class qo extends no{constructor(){super(pi(qo.getDefaults(),arguments)),this.name="Transport",this._loop=new Po(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ti,this._repeatedEvents=new Co,this._syncedSignals=[],this._swingAmount=0;const t=pi(qo.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new vo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Ei(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(no.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const s=Math.sin(e%(2*this._swingTicks)/(2*this._swingTicks)*Math.PI)*this._swingAmount;t+=new ko(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const s=new Io(this,{callback:t,time:new eo(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,n=1/0){const i=new Ro(this,{callback:t,duration:new Zi(this.context,n).toTicks(),interval:new Zi(this.context,e).toTicks(),time:new eo(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const s=new Io(this,{callback:t,once:!0,time:new eo(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new ko(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let s;return Qn(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Jn(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Zi(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Zi(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new ko(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new ko(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const s=this._clock.getTicksAtTime(e),n=e+this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e);this.emit("stop",n),this._clock.setTicksAtTime(t,n),this.emit("start",n,this._clock.getSecondsAtTime(n))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),s=this.getTicksAtTime(e);return this._clock.nextTickTime(t-s%t,e)}}syncSignal(t,e){if(!e){const s=this.now();if(0!==t.getValueAtTime(s)){const n=1/(60/this.bpm.getValueAtTime(s)/this.PPQ);e=t.getValueAtTime(s)/n}else e=0}const s=new lo(e);return this.bpm.connect(s),s.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:s,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.ratio.dispose(),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Pi(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ci.mixin(qo),ki((t=>{t.transport=new qo({context:t})})),Mi((t=>{t.transport.dispose()}));class Fo extends ao{constructor(t){super(t),this.input=void 0,this._state=new io("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ii,this._syncedStop=Ii,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Do({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,Ei(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(ao.getDefaults(),{mute:!1,onstop:Ii,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let n=$n(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(n=this._clampToCurrentTime(n),this._synced||"started"!==this._state.getValueAtTime(n))if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){const t=this._state.get(n);t&&(t.offset=this.toSeconds(fi(e,0)),t.duration=s?this.toSeconds(s):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,s)}),n);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else Bn(this.context),this._start(n,e,s);else Nn(yi(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,e,s);return this}stop(t){let e=$n(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Qn(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const s=this._state.get(e);if(s&&"started"===s.state&&s.time!==e){const n=e-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-n),this._start(t,this.toSeconds(s.offset)+n,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ii,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Vo extends uo{constructor(){super(pi(Vo.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=pi(Vo.getDefaults(),arguments,["url","onload"]);co(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new oo({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Ri(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(uo.getDefaults(),{url:new Ri,loop:!1,loopEnd:0,loopStart:0,onload:Ii,onerror:Ii,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,n=1){Nn(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,n),e=fi(e,this.loop?this.loopStart:0);let o=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),s=t-e;vi(o,t)&&(o=(o-e)%s+e),bi(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,xi(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),Qn(s)){let t=this.toSeconds(s);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Lo extends Fo{constructor(){super(pi(Lo.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=pi(Lo.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Fo.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(Nn(t in Bo,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=Bo[this._type];this._source=new Vo({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const No=220500,jo={brown:null,pink:null,white:null},Bo={get brown(){if(!jo.brown){const t=[];for(let e=0;e<2;e++){const s=new Float32Array(No);t[e]=s;let n=0;for(let t=0;t<No;t++){const e=2*Math.random()-1;s[t]=(n+.02*e)/1.02,n=s[t],s[t]*=3.5}}jo.brown=(new Ri).fromArray(t)}return jo.brown},get pink(){if(!jo.pink){const t=[];for(let e=0;e<2;e++){const s=new Float32Array(No);let n,i,o,a,r,c,h;t[e]=s,n=i=o=a=r=c=h=0;for(let t=0;t<No;t++){const e=2*Math.random()-1;n=.99886*n+.0555179*e,i=.99332*i+.0750759*e,o=.969*o+.153852*e,a=.8665*a+.3104856*e,r=.55*r+.5329522*e,c=-.7616*c-.016898*e,s[t]=n+i+o+a+r+c+h+.5362*e,s[t]*=.11,h=.115926*e}}jo.pink=(new Ri).fromArray(t)}return jo.pink},get white(){if(!jo.white){const t=[];for(let e=0;e<2;e++){const s=new Float32Array(No);t[e]=s;for(let t=0;t<No;t++)s[t]=2*Math.random()-1}jo.white=(new Ri).fromArray(t)}return jo.white}};class zo extends ao{constructor(){super(pi(zo.getDefaults(),arguments,["volume"])),this.name="UserMedia";const t=pi(zo.getDefaults(),arguments,["volume"]);this._volume=this.output=new Do({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Ei(this,"volume"),this.mute=t.mute}static getDefaults(){return Object.assign(ao.getDefaults(),{mute:!1,volume:0})}open(t){return ii(this,void 0,void 0,(function*(){Nn(zo.supported,"UserMedia is not supported"),"started"===this.state&&this.close();const e=yield zo.enumerateDevices();Zn(t)?this._device=e[t]:(this._device=e.find((e=>e.label===t||e.deviceId===t)),!this._device&&e.length>0&&(this._device=e[0]),Nn(Qn(this._device),`No matching device ${t}`));const s={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(s.audio.deviceId=this._device.deviceId);const n=yield navigator.mediaDevices.getUserMedia(s);if(!this._stream){this._stream=n;const t=this.context.createMediaStreamSource(n);co(t,this.output),this._mediaStream=t}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((t=>{t.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return ii(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((t=>"audioinput"===t.kind))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Qn(navigator.mediaDevices)&&Qn(navigator.mediaDevices.getUserMedia)}}function Go(t,e){return ii(this,void 0,void 0,(function*(){const s=e/t.context.sampleRate,n=new qi(1,s,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/s,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)}))}class Wo extends uo{constructor(){super(pi(Wo.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=pi(Wo.getDefaults(),arguments,["frequency","type"]);co(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new oo({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new oo({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),Ei(this,["frequency","detune"])}static getDefaults(){return Object.assign(uo.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Uo extends Fo{constructor(){super(pi(Uo.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=pi(Uo.getDefaults(),arguments,["frequency","type"]);this.frequency=new fo({context:this.context,units:"frequency",value:t.frequency}),Ei(this,"frequency"),this.detune=new fo({context:this.context,units:"cents",value:t.detune}),Ei(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(Fo.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new Wo({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return Uo._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials).length===(s=this._partials).length&&e.every(((t,e)=>s[e]===t));var e,s}));{const t=Uo._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Qn(e)){const{partials:t,wave:s}=e;this._wave=s,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,s]=this._getRealImaginary(t,this._phase),n=this.context.createPeriodicWave(e,s);this._wave=n,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Uo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),Uo._periodicWaveCache.length>100&&Uo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.type=this.partialCount&&"custom"!==this._type&&"custom"!==t?t+this.partialCount:t}get partialCount(){return this._partialCount}set partialCount(t){jn(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,s)=>e[s]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let s=2048;const n=new Float32Array(s),i=new Float32Array(s);let o=1;if("custom"===t){if(o=this._partials.length+1,this._partialCount=this._partials.length,s=o,0===this._partials.length)return[n,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(o=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],o=Math.max(o,2),s=o):this._partialCount=0,this._partials=[]}for(let a=1;a<s;++a){const s=2/(a*Math.PI);let r;switch(t){case"sine":r=a<=o?1:0,this._partials[a-1]=r;break;case"square":r=1&a?2*s:0,this._partials[a-1]=r;break;case"sawtooth":r=s*(1&a?1:-1),this._partials[a-1]=r;break;case"triangle":r=1&a?s*s*2*(a-1>>1&1?-1:1):0,this._partials[a-1]=r;break;case"custom":r=this._partials[a-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==r?(n[a]=-r*Math.sin(e*a),i[a]=r*Math.cos(e*a)):(n[a]=0,i[a]=0)}return[n,i]}_inverseFFT(t,e,s){let n=0;const i=t.length;for(let o=0;o<i;o++)n+=t[o]*Math.cos(o*s)+e[o]*Math.sin(o*s);return n}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const n=2*Math.PI;for(let i=0;i<32;i++)s=Math.max(this._inverseFFT(t,e,i/32*n),s);return wi(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Uo._periodicWaveCache=[];class $o extends ao{constructor(){super(Object.assign(pi($o.getDefaults(),arguments,["context"])))}connect(t,e=0,s=0){return mo(this,t,e,s),this}}class Qo extends $o{constructor(){super(Object.assign(pi(Qo.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=pi(Qo.getDefaults(),arguments,["mapping","length"]);Jn(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Xn(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(fo.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let n=0,i=e;n<i;n++)s[n]=t(n/(i-1)*2-1,n);return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Nn(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Xo extends $o{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Qo({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Zo extends fo{constructor(){super(Object.assign(pi(Zo.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=pi(Zo.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new lo({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(fo.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Yo extends Fo{constructor(){super(pi(Yo.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Xo({context:this.context}),this._modulationNode=new lo({context:this.context});const t=pi(Yo.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Uo({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Uo({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Zo({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ei(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Uo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Ho extends Fo{constructor(){super(pi(Ho.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new lo({context:this.context,gain:0});const t=pi(Ho.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Uo({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new fo({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Uo({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Zo({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Zo({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ei(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Uo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Jo extends Fo{constructor(){super(pi(Jo.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new lo({context:this.context,gain:0}),this._thresh=new Qo({context:this.context,mapping:t=>t<=0?-1:1});const t=pi(Jo.getDefaults(),arguments,["frequency","width"]);this.width=new fo({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Uo({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ei(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Fo.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Ko extends Fo{constructor(){super(pi(Ko.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=pi(Ko.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new fo({context:this.context,units:"frequency",value:t.frequency}),this.detune=new fo({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,Ei(this,["frequency","detune"])}static getDefaults(){return Object.assign(Uo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach(((t,n)=>t.detune.value=e+s*n))}}get count(){return this._oscillators.length}set count(t){if(jn(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const s=new Uo({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):Ii});"custom"===this.type&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class ta extends Fo{constructor(){super(pi(ta.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Zo({context:this.context,value:2});const t=pi(ta.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Jo({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Uo({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ei(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Fo.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const ea={am:Yo,fat:Ko,fm:Ho,oscillator:Uo,pulse:Jo,pwm:ta};class sa extends Fo{constructor(){super(pi(sa.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=pi(sa.getDefaults(),arguments,["frequency","type"]);this.frequency=new fo({context:this.context,units:"frequency",value:t.frequency}),this.detune=new fo({context:this.context,units:"cents",value:t.detune}),Ei(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(Uo.getDefaults(),Ho.getDefaults(),Yo.getDefaults(),Ko.getDefaults(),Jo.getDefaults(),ta.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=ea[t],s=this.now();if(this._oscillator){const t=this._oscillator;t.stop(s),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof ea[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Zn(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Zn(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Kn(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return ii(this,void 0,void 0,(function*(){return Go(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class na extends fo{constructor(){super(Object.assign(pi(na.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new lo({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,ro(this._constantSource,this._sum)}static getDefaults(){return Object.assign(fo.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class ia extends $o{constructor(){super(Object.assign(pi(ia.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=pi(ia.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Zo({context:this.context,value:t.max-t.min}),this._add=this.output=new na({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign($o.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class oa extends $o{constructor(){super(Object.assign(pi(oa.getDefaults(),arguments))),this.name="Zero",this._gain=new lo({context:this.context}),this.output=this._gain,this.input=void 0,co(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),ho(this.context.getConstant(0),this._gain),this}}class aa extends ao{constructor(){super(pi(aa.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=oo.prototype._fromType,this._toType=oo.prototype._toType,this._is=oo.prototype._is,this._clampValue=oo.prototype._clampValue;const t=pi(aa.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new Uo(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new lo({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new fo({context:this.context,units:"audioRange",value:0}),this._zeros=new oa({context:this.context}),this._a2g=new Xo({context:this.context}),this._scaler=this.output=new ia({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Ei(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(Uo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,s=this.max;this._units=t,this.min=e,this.max=s}get state(){return this._oscillator.state}connect(t,e,s){return(t instanceof oo||t instanceof fo)&&(this.convert=t.convert,this.units=t.units),mo(this,t,e,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function ra(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get(){return s.get(this)},set(n){jn(n,t,e),s.set(this,n)}})}}function ca(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get(){return s.get(this)},set(n){jn(this.toSeconds(n),t,e),s.set(this,n)}})}}class ha extends Fo{constructor(){super(pi(ha.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=pi(ha.getDefaults(),arguments,["url","onload"]);this._buffer=new Ri({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Fo.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ii,onerror:Ii,playbackRate:1,reverse:!1})}load(t){return ii(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=Ii){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){e=fi(e,this._loop?this._loopStart:0);const n=this.toSeconds(e),i=s;s=fi(s,Math.max(this._buffer.duration-n,0));let o=this.toSeconds(s);o/=this._playbackRate,t=this.toSeconds(t);const a=new Vo({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+o),this._state.setStateAtTime("stopped",t+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&$n(i)?a.start(t,n):a.start(t,n,o-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){this._stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if("started"===this._state.getValueAtTime(s)){const e=this.toSeconds(t);this._stop(s),this._start(s,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&jn(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&jn(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((s=>{s.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}ni([ca(0)],ha.prototype,"fadeIn",void 0),ni([ca(0)],ha.prototype,"fadeOut",void 0);class la extends ao{constructor(){super(pi(la.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;const t=pi(la.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new Do({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Ei(this,"volume"),this._buffers=new wo({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Fo.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Ii,onerror:Ii,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach((e=>{e.fadeIn=t}))}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach((e=>{e.fadeOut=t}))}get state(){return Array.from(this._players).some((([t,e])=>"started"===e.state))?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(Nn(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new ha({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,s){return Nn(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,s),this}stopAll(t){return this._players.forEach((e=>e.stop(t))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((t=>t.dispose())),this._buffers.dispose(),this}}class ua extends Fo{constructor(){super(pi(ua.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const t=pi(ua.getDefaults(),arguments,["url","onload"]);this.buffer=new Ri({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new vo({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Fo.getDefaults(),{onload:Ii,onerror:Ii,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,s){e=fi(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const n=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/n),s&&this.stop(t+this.toSeconds(s))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){this._stop(t),this._start(t,e,s)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach((e=>{e.fadeOut=0,e.stop(t)})),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),s=e*this._grainSize;if(this.log("offset",s),!this.loop&&s>this.buffer.duration)return void this.stop(t);const n=new Vo({context:this.context,url:this.buffer,fadeIn:s<this._overlap?0:this._overlap,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:Gi(this.detune/100)}).connect(this.output);n.start(t,this._grainSize*e),n.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(n),n.onended=()=>{const t=this._activeSources.indexOf(n);-1!==t&&this._activeSources.splice(t,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){jn(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&jn(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&jn(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);jn(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((t=>t.dispose())),this}}class da extends $o{constructor(){super(...arguments),this.name="Abs",this._abs=new Qo({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class pa extends $o{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Qo({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class fa extends $o{constructor(){super(...arguments),this.name="Negate",this._multiply=new Zo({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class ma extends fo{constructor(){super(Object.assign(pi(ma.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new lo({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new fa({context:this.context}),this.subtrahend=this._param,ro(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(fo.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class ga extends $o{constructor(){super(Object.assign(pi(ga.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new Qo({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new Zo({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class _a extends fo{constructor(){super(Object.assign(pi(_a.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;const t=pi(_a.getDefaults(),arguments,["value"]);this._subtract=this.input=new ma({context:this.context,value:t.value}),this._gtz=this.output=new ga({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,Ei(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(fo.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class ya extends $o{constructor(){super(Object.assign(pi(ya.getDefaults(),arguments,["value"]))),this.name="Pow";const t=pi(ya.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new Qo({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign($o.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class va extends ia{constructor(){super(Object.assign(pi(va.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";const t=pi(va.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new ya({context:this.context,value:t.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(ia.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}}class xa extends fo{constructor(){super(pi(fo.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;const t=pi(fo.getDefaults(),arguments,["value","units"]);this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new po({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==e&&(this._lastVal=e,this._constantSource.offset.setValueAtTime(e,t))}_anchorValue(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal=e,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(e,t)}getValueAtTime(t){const e=new eo(this.context,t).toSeconds();return super.getValueAtTime(e)}setValueAtTime(t,e){const s=new eo(this.context,e).toSeconds();return super.setValueAtTime(t,s),this}linearRampToValueAtTime(t,e){const s=new eo(this.context,e).toSeconds();return super.linearRampToValueAtTime(t,s),this}exponentialRampToValueAtTime(t,e){const s=new eo(this.context,e).toSeconds();return super.exponentialRampToValueAtTime(t,s),this}setTargetAtTime(t,e,s){const n=new eo(this.context,e).toSeconds();return super.setTargetAtTime(t,n,s),this}cancelScheduledValues(t){const e=new eo(this.context,t).toSeconds();return super.cancelScheduledValues(e),this}setValueCurveAtTime(t,e,s,n){const i=new eo(this.context,e).toSeconds();return s=this.toSeconds(s),super.setValueCurveAtTime(t,i,s,n),this}cancelAndHoldAtTime(t){const e=new eo(this.context,t).toSeconds();return super.cancelAndHoldAtTime(e),this}setRampPoint(t){const e=new eo(this.context,t).toSeconds();return super.setRampPoint(e),this}exponentialRampTo(t,e,s){const n=new eo(this.context,s).toSeconds();return super.exponentialRampTo(t,e,n),this}linearRampTo(t,e,s){const n=new eo(this.context,s).toSeconds();return super.linearRampTo(t,e,n),this}targetRampTo(t,e,s){const n=new eo(this.context,s).toSeconds();return super.targetRampTo(t,e,n),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class ba extends ao{constructor(){super(pi(ba.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new fo({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=pi(ba.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(ao.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Kn(t))return t;{let s;for(s in wa)if(wa[s][e]===t)return s;return t}}_setCurve(t,e,s){if(Kn(s)&&Reflect.has(wa,s)){const n=wa[s];Yn(n)?"_decayCurve"!==t&&(this[t]=n[e]):this[t]=n}else{if(!Jn(s)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+s);this[t]=s}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){Nn(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let s=this.toSeconds(this.attack);const n=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0&&(s=(1-i)/(1/s)),s<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,s,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,s,t);else{this._sig.cancelAndHoldAtTime(t);let n=this._attackCurve;for(let t=1;t<n.length;t++)if(n[t-1]<=i&&i<=n[t]){n=this._attackCurve.slice(t),n[0]=i;break}this._sig.setValueCurveAtTime(n,t,s,e)}if(n&&this.sustain<1){const i=e*this.sustain,o=t+s;this.log("decay",o),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,n+o):this._sig.exponentialApproachValueAtTime(i,o,n)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,s,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,s,t):(Nn(Jn(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return mo(this,t,e,s),this}asArray(t=1024){return ii(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,s=new qi(1,e,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=n+this.toSeconds(this.release),o=.1*i,a=i+o,r=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/a,decay:e*this.toSeconds(this.decay)/a,release:e*this.toSeconds(this.release)/a,context:s}));return r._sig.toDestination(),r.triggerAttackRelease(e*(n+o)/a,0),(yield s.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}ni([ca(0)],ba.prototype,"attack",void 0),ni([ca(0)],ba.prototype,"decay",void 0),ni([ra(0,1)],ba.prototype,"sustain",void 0),ni([ca(0)],ba.prototype,"release",void 0);const wa=(()=>{const t=128;let e,s;const n=[];for(e=0;e<t;e++)n[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){s=e/127;const t=Math.sin(s*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*s}i[127]=1;const o=[];for(e=0;e<t;e++)o[e]=Math.ceil(e/127*5)/5;const a=[];for(e=0;e<t;e++)s=e/127,a[e]=.5*(1-Math.cos(Math.PI*s));const r=[];for(e=0;e<t;e++){s=e/127;const t=4*Math.pow(s,3)+.2,n=Math.cos(t*Math.PI*2*s);r[e]=Math.abs(n*(1-s))}function c(t){const e=new Array(t.length);for(let s=0;s<t.length;s++)e[s]=1-t[s];return e}return{bounce:{In:c(r),Out:r},cosine:{In:n,Out:(h=n,h.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:c(i)},sine:{In:a,Out:c(a)},step:{In:o,Out:c(o)}};var h})();class Ta extends ao{constructor(){super(pi(Ta.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=pi(Ta.getDefaults(),arguments);this._volume=this.output=new Do({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Ei(this,"volume")}static getDefaults(){return Object.assign(ao.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...t)=>{const n=this.context.transport.schedule((n=>{t[e]=n,s.apply(this,t)}),t[e]);this._scheduledEvents.push(n)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,s,n){const i=this.toSeconds(s),o=this.toSeconds(e);return this.triggerAttack(t,i,n),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Sa extends Ta{constructor(){super(pi(Sa.getDefaults(),arguments));const t=pi(Sa.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Ta.getDefaults(),{detune:0,onsilence:Ii,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const n=this.toSeconds(e);return this._triggerEnvelopeAttack(n,s),this.setNote(t,n),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),n=t instanceof Hi?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,t,s)}else this.frequency.setValueAtTime(n,s);return this}}ni([ca(0)],Sa.prototype,"portamento",void 0);class ka extends ba{constructor(){super(pi(ka.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new lo({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Aa extends Sa{constructor(){super(pi(Aa.getDefaults(),arguments)),this.name="Synth";const t=pi(Aa.getDefaults(),arguments);this.oscillator=new sa(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ka(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),Ei(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Sa.getDefaults(),{envelope:Object.assign(mi(ba.getDefaults(),Object.keys(ao.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(mi(sa.getDefaults(),[...Object.keys(Fo.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+s)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Ma extends Sa{constructor(){super(pi(Ma.getDefaults(),arguments)),this.name="ModulationSynth";const t=pi(Ma.getDefaults(),arguments);this._carrier=new Aa({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Aa({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new fo({context:this.context,units:"frequency"}),this.detune=new fo({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new Zo({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new lo({context:this.context,gain:0}),Ei(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Sa.getDefaults(),{harmonicity:3,oscillator:Object.assign(mi(sa.getDefaults(),[...Object.keys(Fo.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(mi(ba.getDefaults(),Object.keys(ao.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(mi(sa.getDefaults(),[...Object.keys(Fo.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(mi(ba.getDefaults(),Object.keys(ao.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Ca extends Ma{constructor(){super(pi(Ca.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Xo({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Oa extends ao{constructor(){super(pi(Oa.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const t=pi(Oa.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new oo({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new oo({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new oo({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new oo({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(ao.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){Nn(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let o=0;o<t;o++){const s=Math.pow(o/t,2);e[o]=19980*s+20}const s=new Float32Array(t),n=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,s,n),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Da extends ao{constructor(){super(pi(Da.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new lo({context:this.context}),this.output=new lo({context:this.context}),this._filters=[];const t=pi(Da.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new fo({context:this.context,units:"positive",value:t.Q}),this.frequency=new fo({context:this.context,units:"frequency",value:t.frequency}),this.detune=new fo({context:this.context,units:"cents",value:t.detune}),this.gain=new fo({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,Ei(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(ao.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){Nn(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._type=t,this._filters.forEach((e=>e.type=t))}get rolloff(){return this._rolloff}set rolloff(t){const e=Zn(t)?t:parseInt(t,10),s=[-12,-24,-48,-96];let n=s.indexOf(e);Nn(-1!==n,`rolloff can only be ${s.join(", ")}`),n+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach((t=>t.disconnect())),this._filters=new Array(n);for(let i=0;i<n;i++){const t=new Oa({context:this.context});t.type=this._type,this.frequency.connect(t.frequency),this.detune.connect(t.detune),this.Q.connect(t.Q),this.gain.connect(t.gain),this._filters[i]=t}this._internalChannels=this._filters,ro(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new Oa({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map((()=>1));return this._filters.forEach((()=>{e.getFrequencyResponse(t).forEach(((t,e)=>s[e]*=t))})),e.dispose(),s}dispose(){return super.dispose(),this._filters.forEach((t=>{t.dispose()})),Pi(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Ea extends ba{constructor(){super(pi(Ea.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const t=pi(Ea.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new ya({context:this.context,value:t.exponent}),this._scale=this.output=new ia({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(ba.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);jn(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Pa extends Sa{constructor(){super(pi(Pa.getDefaults(),arguments)),this.name="MonoSynth";const t=pi(Pa.getDefaults(),arguments);this.oscillator=new sa(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Da(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new Ea(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new ka(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Ei(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Sa.getDefaults(),{envelope:Object.assign(mi(ba.getDefaults(),Object.keys(ao.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(mi(Da.getDefaults(),Object.keys(ao.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(mi(Ea.getDefaults(),Object.keys(ao.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(mi(sa.getDefaults(),Object.keys(Fo.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+s)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Ia extends Sa{constructor(){super(pi(Ia.getDefaults(),arguments)),this.name="DuoSynth";const t=pi(Ia.getDefaults(),arguments);this.voice0=new Pa(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new Pa(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new Zo({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new aa({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new lo({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new fo({context:this.context,units:"frequency",value:440}),this.detune=new fo({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Ei(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return di(Sa.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:di(mi(Pa.getDefaults(),Object.keys(Sa.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:di(mi(Pa.getDefaults(),Object.keys(Sa.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Ra extends Ma{constructor(){super(pi(Ra.getDefaults(),arguments)),this.name="FMSynth";const t=pi(Ra.getDefaults(),arguments);this.modulationIndex=new Zo({context:this.context,value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Ma.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const qa=[1,1.483,1.932,2.546,2.63,3.897];class Fa extends Sa{constructor(){super(pi(Fa.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const t=pi(Fa.getDefaults(),arguments);this.detune=new fo({context:this.context,units:"cents",value:t.detune}),this.frequency=new fo({context:this.context,units:"frequency"}),this._amplitude=new lo({context:this.context,gain:0}).connect(this.output),this._highpass=new Da({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let e=0;e<qa.length;e++){const s=new Ho({context:this.context,harmonicity:t.harmonicity,modulationIndex:t.modulationIndex,modulationType:"square",onstop:0===e?()=>this.onsilence(this):Ii,type:"square"});s.connect(this._highpass),this._oscillators[e]=s;const n=new Zo({context:this.context,value:qa[e]});this._freqMultipliers[e]=n,this.frequency.chain(n,s.frequency),this.detune.connect(s.detune)}this._filterFreqScaler=new ia({context:this.context,max:7e3,min:this.toFrequency(t.resonance)}),this.envelope=new ba({attack:t.envelope.attack,attackCurve:"linear",context:this.context,decay:t.envelope.decay,release:t.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=t.octaves,this.octaves=t.octaves}static getDefaults(){return di(Sa.getDefaults(),{envelope:Object.assign(mi(ba.getDefaults(),Object.keys(ao.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,e=1){return this.envelope.triggerAttack(t,e),this._oscillators.forEach((e=>e.start(t))),0===this.envelope.sustain&&this._oscillators.forEach((e=>{e.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach((e=>e.stop(t+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach((e=>e.modulationIndex.value=t))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach((e=>e.harmonicity.value=t))}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach((t=>t.dispose())),this._freqMultipliers.forEach((t=>t.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Va extends Aa{constructor(){super(pi(Va.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=pi(Va.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,Ei(this,["oscillator","envelope"])}static getDefaults(){return di(Sa.getDefaults(),Aa.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),n=this.toFrequency(t instanceof Hi?t.toFrequency():t);return this.oscillator.frequency.setValueAtTime(n*this.octaves,s),this.oscillator.frequency.exponentialRampToValueAtTime(n,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}ni([ra(0)],Va.prototype,"octaves",void 0),ni([ca(0)],Va.prototype,"pitchDecay",void 0);class La extends Ta{constructor(){super(pi(La.getDefaults(),arguments)),this.name="NoiseSynth";const t=pi(La.getDefaults(),arguments);this.noise=new Lo(Object.assign({context:this.context},t.noise)),this.envelope=new ka(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Ta.getDefaults(),{envelope:Object.assign(mi(ba.getDefaults(),Object.keys(ao.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(mi(Lo.getDefaults(),Object.keys(Fo.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,s),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Na=new Set;function ja(t){Na.add(t)}function Ba(t,e){Na.add(`registerProcessor("${t}", ${e})`)}class za extends ao{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Ii;const e=URL.createObjectURL(new Blob([Array.from(Na).join("\n")],{type:"text/javascript"})),s=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e,s).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(s,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}ja('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),ja("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),ja("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");const Ga="feedback-comb-filter";Ba(Ga,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Wa extends za{constructor(){super(pi(Wa.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const t=pi(Wa.getDefaults(),arguments,["delayTime","resonance"]);this.input=new lo({context:this.context}),this.output=new lo({context:this.context}),this.delayTime=new oo({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new oo({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Ei(this,["resonance","delayTime"])}_audioWorkletName(){return Ga}static getDefaults(){return Object.assign(ao.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){ro(this.input,t,this.output);const e=t.parameters.get("delayTime");this.delayTime.setParam(e);const s=t.parameters.get("feedback");this.resonance.setParam(s)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Ua extends ao{constructor(){super(pi(Ua.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const t=pi(Ua.getDefaults(),arguments,["frequency","type"]);this._frequency=t.frequency,this._type=t.type,this.input=new lo({context:this.context}),this.output=new lo({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(ao.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const t=this._filter,e=this.toFrequency(this._frequency),s=1/(2*Math.PI*e);if("lowpass"===this._type){const t=1/(s*this.context.sampleRate);this._filter=this.context.createIIRFilter([t,0],[1,t-1])}else this._filter=this.context.createIIRFilter([1,-1],[1,1/(s*this.context.sampleRate)-1]);this.input.chain(this._filter,this.output),t&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(t),t.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let i=0;i<t;i++){const s=Math.pow(i/t,2);e[i]=19980*s+20}const s=new Float32Array(t),n=new Float32Array(t);return this._filter.getFrequencyResponse(e,s,n),s}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class $a extends ao{constructor(){super(pi($a.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const t=pi($a.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Wa({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Ua({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(ao.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Qa extends Ta{constructor(){super(pi(Qa.getDefaults(),arguments)),this.name="PluckSynth";const t=pi(Qa.getDefaults(),arguments);this._noise=new Lo({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new $a({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return di(Ta.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){const s=this.toFrequency(t);e=this.toSeconds(e);const n=1/s;return this._lfcf.delayTime.setValueAtTime(n,e),this._noise.start(e),this._noise.stop(e+n*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Xa extends Ta{constructor(){super(pi(Xa.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const t=pi(Xa.getDefaults(),arguments,["voice","options"]);Nn(!Zn(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const s=this._voices.indexOf(this._dummyVoice);this._voices.splice(s,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Ta.getDefaults(),{maxPolyphony:32,options:{},voice:Aa})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex((e=>e.voice===t));this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}Un("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,s){t.forEach((t=>{const n=new To(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,s),this._activeVoices.push({midi:n,voice:i,released:!1}),this.log("triggerAttack",t,e))}))}_triggerRelease(t,e){t.forEach((t=>{const s=new To(this.context,t).toMidi(),n=this._activeVoices.find((({midi:t,released:e})=>t===s&&!e));n&&(n.voice.triggerRelease(e),n.released=!0,this.log("triggerRelease",t,e))}))}_scheduleEvent(t,e,s,n){Nn(!this.disposed,"Synth was already disposed"),s<=this.now()?"attack"===t?this._triggerAttack(e,s,n):this._triggerRelease(e,s):this.context.setTimeout((()=>{this._scheduleEvent(t,e,s,n)}),s-this.now())}triggerAttack(t,e,s){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("attack",t,n,s),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("release",t,s),this}triggerAttackRelease(t,e,s,n){const i=this.toSeconds(s);if(this.triggerAttack(t,i,n),Jn(e)){Nn(Jn(t),"If the duration is an array, the notes must also be an array");for(let s=0;s<t.length;s++){const n=e[Math.min(s,e.length-1)],o=this.toSeconds(n);Nn(o>0,"The duration must be greater than 0"),this.triggerRelease(t[s],i+o)}}else{const s=this.toSeconds(e);Nn(s>0,"The duration must be greater than 0"),this.triggerRelease(t,i+s)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){const e=mi(t,["onsilence","context"]);return this.options=di(this.options,e),this._voices.forEach((t=>t.set(e))),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach((({voice:t})=>{t.triggerRelease(e)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((t=>t.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Za extends Ta{constructor(){super(pi(Za.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=pi(Za.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((s=>{const n=parseInt(s,10);if(Nn(ti(s)||Zn(n)&&isFinite(n),`url key is neither a note or midi pitch: ${s}`),ti(s)){const n=new Hi(this.context,s).toMidi();e[n]=t.urls[s]}else Zn(n)&&isFinite(n)&&(e[n]=t.urls[n])})),this._buffers=new wo({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Ta.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ii,onerror:Ii,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=$i(new Hi(this.context,t).toFrequency()),i=Math.round(n),o=n-i,a=this._findClosest(i),r=this._buffers.get(i-a),c=Gi(a+o),h=new Vo({url:r,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);h.start(e,0,r.duration/c,s),Jn(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(h),h.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(h);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=new Hi(this.context,t).toMidi();if(this._activeSources.has(s)&&this._activeSources.get(s).length){const t=this._activeSources.get(s);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(s,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;)t.shift().stop(e)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,n=1){const i=this.toSeconds(s);return this.triggerAttack(t,i,n),Jn(e)?(Nn(Jn(t),"notes must be an array when duration is array"),t.forEach(((t,s)=>{const n=e[Math.min(s,e.length-1)];this.triggerRelease(t,i+this.toSeconds(n))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,s){if(Nn(ti(t)||isFinite(t),`note must be a pitch or midi: ${t}`),ti(t)){const n=new Hi(this.context,t).toMidi();this._buffers.add(n,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}ni([ca(0)],Za.prototype,"attack",void 0),ni([ca(0)],Za.prototype,"release",void 0);class Ya extends no{constructor(){super(pi(Ya.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new io("stopped"),this._startOffset=0;const t=pi(Ya.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(no.getDefaults(),{callback:Ii,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,(t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const s=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||Zn(this._loop)&&this._loop>1){e=1/0,Zn(this._loop)&&(e=this._loop*this._getLoopDuration());const n=this._state.getAfter(s);null!==n&&(e=Math.min(e,n.time-s)),e!==1/0&&(this._state.setStateAtTime("stopped",s+e+1,{id:-1}),e=new ko(this.context,e));const i=new ko(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new ko(this.context,s),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new ko(this.context,s))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let s=e;null!==t&&(s=t.time),this._rescheduleEvents(s)}return this}cancel(t){t=fi(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,(t=>{this.context.transport.clear(t.id)})),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;Hn(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new ko(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new ko(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const s=this._getLoopDuration();return(t-e.time)%s/s}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class Ha extends no{constructor(){super(pi(Ha.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const t=pi(Ha.getDefaults(),arguments,["callback","interval"]);this._event=new Ya({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(no.getDefaults(),{interval:"4n",callback:Ii,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class Ja extends Ya{constructor(){super(pi(Ja.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new io("stopped"),this._events=new Set;const t=pi(Ja.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach((t=>{Jn(t)?this.add(t[0],t[1]):this.add(t)}))}static getDefaults(){return Object.assign(Ya.getDefaults(),{events:[]})}start(t,e){const s=this.toTicks(t);if("started"!==this._state.getValueAtTime(s)){e=fi(e,this._loop?this._loopStart:0),e=fi(e,this._loop?this._loopStart:0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:s}),this._forEach((e=>{this._startNote(e,s,t)}))}return this}_startNote(t,e,s){e-=s,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<s&&(e+=this._getLoopDuration()),t.start(new ko(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=s&&(t.loop=!1,t.start(new ko(this.context,e))):t.startOffset>=s&&t.start(new ko(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach((t=>{t.startOffset+=this._startOffset}))}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach((e=>{e.stop(t)})),this}at(t,e){const s=new eo(this.context,t).toTicks(),n=new ko(this.context,1).toSeconds(),i=this._events.values();let o=i.next();for(;!o.done;){const t=o.value;if(Math.abs(s-t.startOffset)<n)return Qn(e)&&(t.value=e),t;o=i.next()}return Qn(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const s=this.toTicks(t);let n;return e instanceof Ya?(n=e,n.callback=this._tick.bind(this)):n=new Ya({callback:this._tick.bind(this),context:this.context,value:e}),n.startOffset=s,n.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(n),this._restartEvent(n),this}_restartEvent(t){this._state.forEach((e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new ko(this.context,e.time))}))}remove(t,e){return Yn(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach((s=>{s.startOffset===t&&($n(e)||Qn(e)&&s.value===e)&&(this._events.delete(s),s.dispose())})),this}clear(){return this._forEach((t=>t.dispose())),this._events.clear(),this}cancel(t){return this._forEach((e=>e.cancel(t))),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach((e=>{e instanceof Ja?e._forEach(t):t(e)})),this}_setAll(t,e){this._forEach((s=>{s[t]=e}))}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach((e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)}))}get loopEnd(){return new ko(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((e=>{e.loopEnd=t,this._testLoopBoundries(e)}))}get loopStart(){return new ko(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*Ka(t){let e=0;for(;e<t.length;)e=sr(e,t),yield t[e],e++}function*tr(t){let e=t.length-1;for(;e>=0;)e=sr(e,t),yield t[e],e--}function*er(t,e){for(;;)yield*e(t)}function sr(t,e){return wi(t,0,e.length-1)}function*nr(t,e){let s=e?0:t.length-1;for(;;)s=sr(s,t),yield t[s],e?(s++,s>=t.length-1&&(e=!1)):(s--,s<=0&&(e=!0))}function*ir(t){let e=0,s=0;for(;e<t.length;)e=sr(e,t),yield t[e],s++,e+=s%2?2:-1}function*or(t){let e=t.length-1,s=0;for(;e>=0;)e=sr(e,t),yield t[e],s++,e+=s%2?-2:1}function*ar(t){const e=[];for(let s=0;s<t.length;s++)e.push(s);for(;e.length>0;){const s=sr(e.splice(Math.floor(e.length*Math.random()),1)[0],t);yield t[s]}}function*rr(t,e="up"){switch(Nn(t.length>0,"The array must have more than one value in it"),e){case"up":yield*er(t,Ka);case"down":yield*er(t,tr);case"upDown":yield*nr(t,!0);case"downUp":yield*nr(t,!1);case"alternateUp":yield*er(t,ir);case"alternateDown":yield*er(t,or);case"random":yield*function*(t){for(;;){const e=Math.floor(Math.random()*t.length);yield t[e]}}(t);case"randomOnce":yield*er(t,ar);case"randomWalk":yield*function*(t){let e=Math.floor(Math.random()*t.length);for(;;)0===e?e++:e===t.length-1||Math.random()<.5?e--:e++,yield t[e]}(t)}}class cr extends Ha{constructor(){super(pi(cr.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const t=pi(cr.getDefaults(),arguments,["callback","values","pattern"]);this.callback=t.callback,this._values=t.values,this._pattern=rr(t.values,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(Ha.getDefaults(),{pattern:"up",values:[],callback:Ii})}_tick(t){const e=this._pattern.next();this._value=e.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=rr(this._values,this._type)}}class hr extends Ya{constructor(){super(pi(hr.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new Ja({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const t=pi(hr.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(mi(Ya.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null!==e&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new ko(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,s)=>(t[e]=Kn(e)&&isFinite(parseInt(e,10))&&Jn(s)?this._createSequence(s):s,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,s){t.forEach(((t,n)=>{const i=n*e+s;if(Jn(t))this._rescheduleSequence(t,e/t.length,i);else{const e=new ko(this.context,i,"i").toSeconds();this._part.add(e,t)}}))}_indexTime(t){return new ko(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=this._indexTime(0===t?this._eventsArray.length:t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class lr extends ao{constructor(){super(Object.assign(pi(lr.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new pa({context:this.context}),this.a=new lo({context:this.context,gain:0}),this.b=new lo({context:this.context,gain:0}),this.output=new lo({context:this.context}),this._internalChannels=[this.a,this.b];const t=pi(lr.getDefaults(),arguments,["fade"]);this.fade=new fo({context:this.context,units:"normalRange",value:t.fade}),Ei(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",co(this._split,this.a.gain,0),co(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ao.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class ur extends ao{constructor(t){super(t),this.name="Effect",this._dryWet=new lr({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new lo({context:this.context}),this.effectReturn=new lo({context:this.context}),this.input=new lo({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Ei(this,"wet")}static getDefaults(){return Object.assign(ao.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class dr extends ur{constructor(t){super(t),this.name="LFOEffect",this._lfo=new aa({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,Ei(this,["frequency","depth"])}static getDefaults(){return Object.assign(ur.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class pr extends dr{constructor(){super(pi(pr.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";const t=pi(pr.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Da(Object.assign(t.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency}static getDefaults(){return Object.assign(dr.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}}class fr extends ao{constructor(){super(Object.assign(pi(fr.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=pi(fr.getDefaults(),arguments,["pan"]);this.pan=new oo({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",Ei(this,"pan")}static getDefaults(){return Object.assign(ao.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class mr extends dr{constructor(){super(pi(mr.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";const t=pi(mr.getDefaults(),arguments,["frequency"]);this._panner=new fr({context:this.context,channelCount:t.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(dr.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class gr extends ao{constructor(){super(pi(gr.getDefaults(),arguments,["smoothing"])),this.name="Follower";const t=pi(gr.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new da({context:this.context}),this._lowpass=this.output=new Ua({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(ao.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class _r extends ur{constructor(){super(pi(_r.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";const t=pi(_r.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new gr({context:this.context,smoothing:t.follower}),this._sweepRange=new va({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this._inputBoost=new lo({context:this.context}),this._bandpass=new Da({context:this.context,rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new Da({context:this.context,type:"peaking"}),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,Ei(this,["gain","Q"])}static getDefaults(){return Object.assign(ur.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return zi(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/Bi(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const yr="bit-crusher";Ba(yr,"\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class vr extends ur{constructor(){super(pi(vr.getDefaults(),arguments,["bits"])),this.name="BitCrusher";const t=pi(vr.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new xr({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(ur.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class xr extends za{constructor(){super(pi(xr.getDefaults(),arguments)),this.name="BitCrusherWorklet";const t=pi(xr.getDefaults(),arguments);this.input=new lo({context:this.context}),this.output=new lo({context:this.context}),this.bits=new oo({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(za.getDefaults(),{bits:12})}_audioWorkletName(){return yr}onReady(t){ro(this.input,t,this.output);const e=t.parameters.get("bits");this.bits.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class br extends ur{constructor(){super(pi(br.getDefaults(),arguments,["order"])),this.name="Chebyshev";const t=pi(br.getDefaults(),arguments,["order"]);this._shaper=new Qo({context:this.context,length:4096}),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample}static getDefaults(){return Object.assign(ur.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,e,s){return s.has(e)||s.set(e,0===e?0:1===e?t:2*t*this._getCoefficient(t,e-1,s)-this._getCoefficient(t,e-2,s)),s.get(e)}get order(){return this._order}set order(t){this._order=t,this._shaper.setMap((e=>this._getCoefficient(e,t,new Map)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class wr extends ao{constructor(){super(pi(wr.getDefaults(),arguments,["channels"])),this.name="Split";const t=pi(wr.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(ao.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Tr extends ao{constructor(){super(pi(Tr.getDefaults(),arguments,["channels"])),this.name="Merge";const t=pi(Tr.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(ao.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Sr extends ao{constructor(t){super(t),this.name="StereoEffect",this.input=new lo({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new lr({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new wr({context:this.context,channels:2}),this._merge=new Tr({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Ei(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),ro(...t),co(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),ro(...t),co(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(ao.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class kr extends Sr{constructor(t){super(t),this.feedback=new fo({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new lo({context:this.context}),this._feedbackR=new lo({context:this.context}),this._feedbackSplit=new wr({context:this.context,channels:2}),this._feedbackMerge=new Tr({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Ei(this,["feedback"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Ar extends kr{constructor(){super(pi(Ar.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const t=pi(Ar.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new aa({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new aa({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new xo({context:this.context}),this._delayNodeR=new xo({context:this.context}),this.frequency=this._lfoL.frequency,Ei(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(kr.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Mr extends ur{constructor(){super(pi(Mr.getDefaults(),arguments,["distortion"])),this.name="Distortion";const t=pi(Mr.getDefaults(),arguments,["distortion"]);this._shaper=new Qo({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(ur.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,s=Math.PI/180;this._shaper.setMap((t=>Math.abs(t)<.001?0:(3+e)*t*20*s/(Math.PI+e*Math.abs(t))))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Cr extends ur{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new lo({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Ei(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(ur.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Or extends Cr{constructor(){super(pi(Or.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const t=pi(Or.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new xo({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Ei(this,"delayTime")}static getDefaults(){return Object.assign(Cr.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Dr extends ao{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new lo({context:this.context}),this.output=new lo({context:this.context}),this.offset90=new lo({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),ro(this.input,...this._bank0,this._oneSampleDelay,this.output),ro(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){return t.map((t=>{const e=[[t*t,0,-1],[1,0,-t*t]];return this.context.createIIRFilter(e[0],e[1])}))}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((t=>t.disconnect())),this._bank1.forEach((t=>t.disconnect())),this._oneSampleDelay.disconnect(),this}}class Er extends ur{constructor(){super(pi(Er.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";const t=pi(Er.getDefaults(),arguments,["frequency"]);this.frequency=new fo({context:this.context,units:"frequency",value:t.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Wo({context:this.context,type:"sine"}),this._cosine=new Uo({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new Zo({context:this.context}),this._cosineMultiply=new Zo({context:this.context}),this._negate=new fa({context:this.context}),this._add=new na({context:this.context}),this._phaseShifter=new Dr({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const e=this.immediate();this._sine.start(e),this._cosine.start(e)}static getDefaults(){return Object.assign(ur.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const Pr=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Ir=[225,556,441,341];class Rr extends Sr{constructor(){super(pi(Rr.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];const t=pi(Rr.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new fo({context:this.context,value:t.roomSize,units:"normalRange"}),this._allpassFiltersL=Ir.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._allpassFiltersR=Ir.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._combFilters=Pr.map(((e,s)=>{const n=new $a({context:this.context,dampening:t.dampening,delayTime:e});return s<Pr.length/2?this.connectEffectLeft(n,...this._allpassFiltersL):this.connectEffectRight(n,...this._allpassFiltersR),this.roomSize.connect(n.resonance),n})),Ei(this,["roomSize"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(t){this._combFilters.forEach((e=>e.dampening=t))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((t=>t.disconnect())),this._allpassFiltersR.forEach((t=>t.disconnect())),this._combFilters.forEach((t=>t.dispose())),this.roomSize.dispose(),this}}const qr=[.06748,.06404,.08212,.09004],Fr=[.773,.802,.753,.733],Vr=[347,113,37];class Lr extends Sr{constructor(){super(pi(Lr.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];const t=pi(Lr.getDefaults(),arguments,["roomSize"]);this.roomSize=new fo({context:this.context,value:t.roomSize,units:"normalRange"}),this._scaleRoomSize=new ia({context:this.context,min:-.733,max:.197}),this._allpassFilters=Vr.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._feedbackCombFilters=qr.map(((t,e)=>{const s=new Wa({context:this.context,delayTime:t});return this._scaleRoomSize.connect(s.resonance),s.resonance.value=Fr[e],e<qr.length/2?this.connectEffectLeft(...this._allpassFilters,s):this.connectEffectRight(...this._allpassFilters,s),s})),this.roomSize.connect(this._scaleRoomSize),Ei(this,["roomSize"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((t=>t.disconnect())),this._feedbackCombFilters.forEach((t=>t.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Nr extends kr{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Ei(this,["feedback"])}}class jr extends Nr{constructor(){super(pi(jr.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const t=pi(jr.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new xo({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new xo({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new xo({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new fo({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Ei(this,["delayTime"])}static getDefaults(){return Object.assign(Nr.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Br extends Cr{constructor(){super(pi(Br.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=pi(Br.getDefaults(),arguments,["pitch"]);this._frequency=new fo({context:this.context}),this._delayA=new xo({maxDelay:1,context:this.context}),this._lfoA=new aa({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new xo({maxDelay:1,context:this.context}),this._lfoB=new aa({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new lr({context:this.context}),this._crossFadeLFO=new aa({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new xo({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Ei(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Cr.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=Gi(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=Gi(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class zr extends Sr{constructor(){super(pi(zr.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";const t=pi(zr.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new aa({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new aa({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new fo({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),Ei(this,["frequency","Q"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,e){const s=[];for(let n=0;n<t;n++){const t=this.context.createBiquadFilter();t.type="allpass",this.Q.connect(t.Q),e.connect(t.frequency),s.push(t)}return s}get octaves(){return this._octaves}set octaves(t){this._octaves=t;const e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((t=>t.disconnect())),this._filtersR.forEach((t=>t.disconnect())),this.frequency.dispose(),this}}class Gr extends ur{constructor(){super(pi(Gr.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=pi(Gr.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(ur.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){jn(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){jn(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return ii(this,void 0,void 0,(function*(){const t=this.ready,e=new qi(2,this._decay+this._preDelay,this.context.sampleRate),s=new Lo({context:e}),n=new Lo({context:e}),i=new Tr({context:e});s.connect(i,0,0),n.connect(i,0,1);const o=new lo({context:e}).toDestination();i.connect(o),s.start(0),n.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=e.render();return this.ready=a.then(Ii),yield t,this._convolver.buffer=(yield a).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Wr extends ao{constructor(){super(pi(Wr.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new wr({channels:2,context:this.context}),this._midAdd=new na({context:this.context}),this.mid=new Zo({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new ma({context:this.context}),this.side=new Zo({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class Ur extends ao{constructor(){super(pi(Ur.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new lo({context:this.context}),this.side=new lo({context:this.context}),this._left=new na({context:this.context}),this._leftMult=new Zo({context:this.context,value:Math.SQRT1_2}),this._right=new ma({context:this.context}),this._rightMult=new Zo({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Tr({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class $r extends ur{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new Ur({context:this.context}),this._midSideSplit=new Wr({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Qr extends $r{constructor(){super(pi(Qr.getDefaults(),arguments,["width"])),this.name="StereoWidener";const t=pi(Qr.getDefaults(),arguments,["width"]);this.width=new fo({context:this.context,value:t.width,units:"normalRange"}),Ei(this,["width"]),this._twoTimesWidthMid=new Zo({context:this.context,value:2}),this._twoTimesWidthSide=new Zo({context:this.context,value:2}),this._midMult=new Zo({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new ma({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),co(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new Zo({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign($r.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class Xr extends Sr{constructor(){super(pi(Xr.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";const t=pi(Xr.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new aa({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new aa({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new lo({context:this.context}),this._amplitudeR=new lo({context:this.context}),this.frequency=new fo({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new fo({context:this.context,value:t.depth,units:"normalRange"}),Ei(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign(Sr.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Zr extends ur{constructor(){super(pi(Zr.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";const t=pi(Zr.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new xo({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new aa({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,Ei(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(ur.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Yr extends ao{constructor(){super(pi(Yr.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const t=pi(Yr.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new lo({context:this.context}),this._split=new wr({context:this.context,channels:t.channels}),this.input.connect(this._split),jn(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type}static getDefaults(){return Object.assign(ao.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((t,e)=>{const s=this._buffers[e];"fft"===this._type?t.getFloatFrequencyData(s):"waveform"===this._type&&t.getFloatTimeDomainData(s)})),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach(((e,s)=>{e.fftSize=2*t,this._buffers[s]=new Float32Array(t)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(t){Nn("waveform"===t||"fft"===t,`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach((e=>e.smoothingTimeConstant=t))}dispose(){return super.dispose(),this._analysers.forEach((t=>t.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class Hr extends ao{constructor(){super(pi(Hr.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Yr({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Jr extends Hr{constructor(){super(pi(Jr.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const t=pi(Jr.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new Yr({context:this.context,size:256,type:"waveform",channels:t.channels}),this.smoothing=t.smoothing,this.normalRange=t.normalRange}static getDefaults(){return Object.assign(Hr.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return Un("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),e=(1===this.channels?[t]:t).map((t=>{const e=t.reduce(((t,e)=>t+e*e),0),s=Math.sqrt(e/t.length);return this._rms=Math.max(s,this._rms*this.smoothing),this.normalRange?this._rms:zi(this._rms)}));return 1===this.channels?e[0]:e}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Kr extends Hr{constructor(){super(pi(Kr.getDefaults(),arguments,["size"])),this.name="FFT";const t=pi(Kr.getDefaults(),arguments,["size"]);this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(ao.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map((t=>this.normalRange?Bi(t):t))}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return Nn(0<=t&&t<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),t*this.context.sampleRate/(2*this.size)}}class tc extends Hr{constructor(){super(pi(tc.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class ec extends Hr{constructor(){super(pi(ec.getDefaults(),arguments,["size"])),this.name="Waveform";const t=pi(ec.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign(Hr.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}class sc extends ao{constructor(){super(pi(sc.getDefaults(),arguments,["solo"])),this.name="Solo";const t=pi(sc.getDefaults(),arguments,["solo"]);this.input=this.output=new lo({context:this.context}),sc._allSolos.has(this.context)||sc._allSolos.set(this.context,new Set),sc._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(ao.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),sc._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){sc._soloed.has(this.context)||sc._soloed.set(this.context,new Set),sc._soloed.get(this.context).add(this)}_removeSolo(){sc._soloed.has(this.context)&&sc._soloed.get(this.context).delete(this)}_isSoloed(){return sc._soloed.has(this.context)&&sc._soloed.get(this.context).has(this)}_noSolos(){return!sc._soloed.has(this.context)||sc._soloed.has(this.context)&&0===sc._soloed.get(this.context).size}_updateSolo(){this.input.gain.value=this._isSoloed()||this._noSolos()?1:0}dispose(){return super.dispose(),sc._allSolos.get(this.context).delete(this),this._removeSolo(),this}}sc._allSolos=new Map,sc._soloed=new Map;class nc extends ao{constructor(){super(pi(nc.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=pi(nc.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new fr({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Do({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,Ei(this,["pan","volume"])}static getDefaults(){return Object.assign(ao.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class ic extends ao{constructor(){super(pi(ic.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=pi(ic.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new sc({solo:t.solo,context:this.context}),this._panVol=this.output=new nc({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ei(this,["pan","volume"])}static getDefaults(){return Object.assign(ao.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return ic.buses.has(t)||ic.buses.set(t,new lo({context:this.context})),ic.buses.get(t)}send(t,e=0){const s=this._getBus(t),n=new lo({context:this.context,units:"decibels",gain:e});return this.connect(n),n.connect(s),n}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}ic.buses=new Map;class oc extends ao{constructor(){super(pi(oc.getDefaults(),arguments)),this.name="Mono",this.input=new lo({context:this.context}),this._merge=this.output=new Tr({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class ac extends ao{constructor(){super(pi(ac.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new lo({context:this.context}),this.output=void 0,this.low=new Da({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Da({context:this.context,frequency:0,type:"highpass"}),this.mid=new Da({context:this.context,frequency:0,type:"lowpass"}),this.high=new Da({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];const t=pi(ac.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new fo({context:this.context,units:"frequency",value:t.lowFrequency}),this.highFrequency=new fo({context:this.context,units:"frequency",value:t.highFrequency}),this.Q=new fo({context:this.context,units:"positive",value:t.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Ei(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(ao.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Pi(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class rc extends ao{constructor(){super(...arguments),this.name="Listener",this.positionX=new oo({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new oo({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new oo({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new oo({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new oo({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new oo({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new oo({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new oo({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new oo({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ao.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ki((t=>{t.listener=new rc({context:t})})),Mi((t=>{t.listener.dispose()}));class cc extends ao{constructor(){super(pi(cc.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";const t=pi(cc.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=t.panningModel,this.maxDistance=t.maxDistance,this.distanceModel=t.distanceModel,this.coneOuterGain=t.coneOuterGain,this.coneOuterAngle=t.coneOuterAngle,this.coneInnerAngle=t.coneInnerAngle,this.refDistance=t.refDistance,this.rolloffFactor=t.rolloffFactor,this.positionX=new oo({context:this.context,param:this._panner.positionX,value:t.positionX}),this.positionY=new oo({context:this.context,param:this._panner.positionY,value:t.positionY}),this.positionZ=new oo({context:this.context,param:this._panner.positionZ,value:t.positionZ}),this.orientationX=new oo({context:this.context,param:this._panner.orientationX,value:t.orientationX}),this.orientationY=new oo({context:this.context,param:this._panner.orientationY,value:t.orientationY}),this.orientationZ=new oo({context:this.context,param:this._panner.orientationZ,value:t.orientationZ})}static getDefaults(){return Object.assign(ao.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,e,s){return this.positionX.value=t,this.positionY.value=e,this.positionZ.value=s,this}setOrientation(t,e,s){return this.orientationX.value=t,this.orientationY.value=e,this.orientationZ.value=s,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class hc extends ao{constructor(){super(pi(hc.getDefaults(),arguments)),this.name="Recorder";const t=pi(hc.getDefaults(),arguments);this.input=new lo({context:this.context}),Nn(hc.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:t.mimeType})}static getDefaults(){return ao.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==ei&&Reflect.has(ei,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return ii(this,void 0,void 0,(function*(){Nn("started"!==this.state,"Recorder is already started");const t=new Promise((t=>{const e=()=>{this._recorder.removeEventListener("start",e,!1),t()};this._recorder.addEventListener("start",e,!1)}));return this._recorder.start(),yield t}))}stop(){return ii(this,void 0,void 0,(function*(){Nn("stopped"!==this.state,"Recorder is not started");const t=new Promise((t=>{const e=s=>{this._recorder.removeEventListener("dataavailable",e,!1),t(s.data)};this._recorder.addEventListener("dataavailable",e,!1)}));return this._recorder.stop(),yield t}))}pause(){return Nn("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class lc extends ao{constructor(){super(pi(lc.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const t=pi(lc.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new oo({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new oo({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new oo({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new oo({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new oo({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),Ei(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(ao.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class uc extends ao{constructor(){super(Object.assign(pi(uc.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";const t=pi(uc.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new gr({context:this.context,smoothing:t.smoothing}),this._gt=new _a({context:this.context,value:Bi(t.threshold)}),this.input=new lo({context:this.context}),this._gate=this.output=new lo({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(ao.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return zi(this._gt.value)}set threshold(t){this._gt.value=Bi(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class dc extends ao{constructor(){super(Object.assign(pi(dc.getDefaults(),arguments,["threshold"]))),this.name="Limiter";const t=pi(dc.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new lc({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,Ei(this,"threshold")}static getDefaults(){return Object.assign(ao.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class pc extends ao{constructor(){super(Object.assign(pi(pc.getDefaults(),arguments))),this.name="MidSideCompressor";const t=pi(pc.getDefaults(),arguments);this._midSideSplit=this.input=new Wr({context:this.context}),this._midSideMerge=this.output=new Ur({context:this.context}),this.mid=new lc(Object.assign(t.mid,{context:this.context})),this.side=new lc(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),Ei(this,["mid","side"])}static getDefaults(){return Object.assign(ao.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class fc extends ao{constructor(){super(Object.assign(pi(fc.getDefaults(),arguments))),this.name="MultibandCompressor";const t=pi(fc.getDefaults(),arguments);this._splitter=this.input=new ac({context:this.context,lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new lo({context:this.context}),this.low=new lc(Object.assign(t.low,{context:this.context})),this.mid=new lc(Object.assign(t.mid,{context:this.context})),this.high=new lc(Object.assign(t.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),Ei(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(ao.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class mc extends ao{constructor(){super(pi(mc.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new lo({context:this.context}),this._internalChannels=[];const t=pi(mc.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new ac({context:this.context,highFrequency:t.highFrequency,lowFrequency:t.lowFrequency}),this._lowGain=new lo({context:this.context,gain:t.low,units:"decibels"}),this._midGain=new lo({context:this.context,gain:t.mid,units:"decibels"}),this._highGain=new lo({context:this.context,gain:t.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Ei(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(ao.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Pi(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class gc extends ao{constructor(){super(pi(gc.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();const t=pi(gc.getDefaults(),arguments,["url","onload"]);this._buffer=new Ri(t.url,(e=>{this.buffer=e,t.onload()})),this.input=new lo({context:this.context}),this.output=new lo({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=t.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(ao.getDefaults(),{normalize:!0,onload:Ii})}load(t){return ii(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(t)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const e=this._buffer.get();this._convolver.buffer=e||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function _c(){return Li().now()}function yc(){return Li().immediate()}const vc=Li().transport;function xc(){return Li().transport}const bc=Li().destination,wc=Li().destination;function Tc(){return Li().destination}const Sc=Li().listener;function kc(){return Li().listener}const Ac=Li().draw;function Mc(){return Li().draw}const Cc=Li();function Oc(){return Ri.loaded()}const Dc=Ri,Ec=wo,Pc=Vo;var Ic=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))};const Rc=(t,e)=>1e3/(t-e),qc=(t,e)=>t*(120/e),Fc={getFPS:Rc,getNormalizedForFPS:qc},Vc=({x:t,y:e,rows:s,columns:n,totalWidth:i,totalHeight:o,margin:a=0})=>{const r=Math.round(i-2*a),c=Math.round(o-2*a);a=Math.round(a);const h=Math.round(r/n),l=Math.round(c/s),u=Math.floor((e-a)/l),d=Math.floor((t-a)/h);return{x:d*h+a,y:u*l+a,row:Math.abs(u-(s-1)),column:d}};var Lc=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))};const Nc=t=>`${t||""}/`.split("//").join("/"),jc=(t,e)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),Bc=(t,e,s=1)=>Math.min(Math.max(t,e),s),zc={bottomOut:(t=1)=>new Qo((e=>Bc(2*e-t,0,1)),4096)};class Gc{constructor(t=10,e=0){this.oldestVal=0,this.sum=0,this.firstTime=!0,this.size=t,this.buffer=new Array(this.size).fill(e)}lowpass(t){return this.buffer.push(t),this.oldestVal=this.buffer.shift(),this.firstTime?(this.sum=this.buffer.reduce(((t,e)=>t+e)),this.firstTime=!1):this.sum=this.sum-this.oldestVal+t,this.sum/this.size}}const Wc=()=>Cc,Uc=t=>{let e,s=t.length,n=0;for(;s--;)n=Math.random()*s|0,e=t[s],t[s]=t[n],t[n]=e;return t},$c=t=>Array.isArray(t)?t:[t],Qc={calculateDistance:jc,getRangeBasedOnDistance(t){const{maxDistance:e,refDistance:s}=t,n=jc({x:t.listenerPosition.x,y:t.listenerPosition.z},{x:t.position.x,y:t.position.z});if(n<=s)return 1;const i=Bc(Math.abs(n-s),0,e);return n>e?0:-i/(e-s)+1},waveshapers:zc,clip:Bc,invert:t=>1-t,getContext:Wc,setMuteOnBlur(t,e=.3,s,n){const i=()=>{s.disableBlur||(document.hidden?(s.setBusVolume(t,0,e),n&&n(!0)):(s.setBusVolume(t,1,e),n&&n(!1)))};return window.addEventListener("visibilitychange",i),()=>{window.removeEventListener("visibilitychange",i)}},isWebkit:t=>/\b(iPad|iPhone|iPod)\b/.test(t)&&/WebKit/.test(t)&&!/Edge/.test(t)&&!window.MSStream,isMobile:t=>t.match(/Mobi/),isSafari:t=>t.match(/Safari/)&&!t.match(/Chrome/),decodeFileToBuffer:(t,e)=>Lc(void 0,void 0,void 0,(function*(){const s=yield(n=e,new Promise(((t,e)=>{const s=new FileReader;s.readAsArrayBuffer(n),s.onload=()=>t(s.result),s.onerror=t=>e(t)})));var n;return yield t.decodeAudioData(s)})),convertBufferToWave(t,e){const s=t.numberOfChannels,n=e*s*2+44,i=new ArrayBuffer(n),o=new DataView(i),a=[];let r,c,h=0,l=0;for(d(1179011410),d(n-8),d(1163280727),d(544501094),d(16),u(1),u(s),d(t.sampleRate),d(2*t.sampleRate*s),u(2*s),u(16),d(1635017060),d(n-l-4),r=0;r<t.numberOfChannels;r++)a.push(t.getChannelData(r));for(;l<n;){for(r=0;r<s;r++)c=Math.max(-1,Math.min(1,a[r][h])),c=0|(.5+c<0?32768*c:32767*c),o.setInt16(l,c,!0),l+=2;h++}return new Blob([i],{type:"audio/wav"});function u(t){o.setUint16(l,t,!0),l+=2}function d(t){o.setUint32(l,t,!0),l+=4}},Smoother:Gc,MouseInteraction:class{constructor({columns:t,rows:e,onTrigger:s,onFrame:n,options:i}){this.state={mouseIsMoving:!1,mouseEnergy:0,mouseActionEnabled:!1,mouseCoords:{x:0,y:0},lastMouseCoords:{x:0,y:0},stopped:!0,velocity:0},this.numColumns=6,this.numRows=6,this.velocityDecay=.94,this.maxVelocity=20,this.numColumns=t,this.numRows=e,this.onTrigger=s,this.onFrame=n,this.energySmoother=new Gc(5,0),i&&i.velocityDecay&&(this.velocityDecay=i.velocityDecay),i&&i.maxVelocity&&(this.maxVelocity=i.maxVelocity)}start(t){this.state.stopped=!1,this.bindMouseMove(t)}stop(){this.state.mouseActionEnabled=!1,this.state.stopped=!0}enable(){this.state.mouseActionEnabled=!0}disable(){this.state.mouseActionEnabled=!1}bindMouseMove(t){let e=0,s=0;t instanceof HTMLElement?(e=t.clientWidth,s=t.clientHeight):t instanceof Window?(e=t.innerWidth,s=t.innerHeight):t instanceof Document&&(e=window.innerWidth,s=window.innerHeight),t.addEventListener("mousemove",(t=>{const{clientX:n,clientY:i}=t;this.setMouseCoords.bind(this)(n,i,e,s)})),t.addEventListener("touchmove",(t=>{const{touches:n}=t;if(n.length>0){const{screenX:t,screenY:i}=n[0];this.setMouseCoords.bind(this)(t,i,e,s)}})),this.startRequestAnimationFrame()}setMouseCoords(t,e,s,n){this.state.mouseActionEnabled&&this.triggerGrid(this.state.mouseCoords,{x:t,y:e},s,n),this.state.lastMouseCoords=this.state.mouseCoords,this.state.mouseCoords={x:t,y:e}}triggerGrid(t,e,s,n){let i=Vc({x:t.x,y:t.y,rows:this.numRows,columns:this.numColumns,totalWidth:s,totalHeight:n}),o=Vc({x:e.x,y:e.y,rows:this.numRows,columns:this.numColumns,totalWidth:s,totalHeight:n});this.setMouseDelta(i.x-o.x,i.y-o.y),i.x===o.x&&i.y===o.y||this.onTrigger&&this.onTrigger(o)}setMouseDelta(t,e){this.state.mouseIsMoving=!0,t<=.001&&e<=.001&&(this.state.mouseIsMoving=!1);const s=Math.sqrt(Math.pow(t,2)+Math.pow(e,2))/500,n=Bc(this.state.mouseEnergy+s,0,1);this.state.mouseEnergy=this.energySmoother.lowpass(n)}setVelocity(t,e,s){var n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2))/s;null!==n&&n<this.maxVelocity&&(this.state.velocity=n)}startRequestAnimationFrame(){let t=0,e={x:0,y:0};const s=n=>{const i=qc(.01,Rc(n,t));this.state.mouseEnergy>0&&(this.state.mouseEnergy-=i),this.state.mouseCoords.x!==e.x&&this.state.mouseCoords.y!==e.y&&n-t<100&&this.setVelocity(e.x-this.state.mouseCoords.x,e.y-this.state.mouseCoords.y,n-t),this.state.velocity>0&&(this.state.velocity=this.state.velocity*=this.velocityDecay),t=n,e=this.state.mouseCoords,this.onFrame&&this.onFrame(this.state),this.state.stopped||requestAnimationFrame(s)};s(0)}},unmuteIOS:(t=!1)=>function(t,e,s){var n;function i(t,e,s,n,i){for(var o=0;o<e.length;++o)t.addEventListener(e[o],s,{capture:n,passive:i})}function o(t,e,s,n,i){for(var o=0;o<e.length;++o)t.removeEventListener(e[o],s,{capture:n,passive:i})}function a(){}void 0===e&&(e=!1),void 0===s&&(s=!1),void 0!==document.hidden?n={hidden:"hidden",visibilitychange:"visibilitychange"}:void 0!==document.webkitHidden?n={hidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"}:void 0!==document.mozHidden?n={hidden:"mozHidden",visibilitychange:"mozvisibilitychange"}:void 0!==document.msHidden&&(n={hidden:"msHidden",visibilitychange:"msvisibilitychange"});var r=navigator.userAgent.toLowerCase(),c=s||r.indexOf("iphone")>=0&&r.indexOf("like iphone")<0||r.indexOf("ipad")>=0&&r.indexOf("like ipad")<0||r.indexOf("ipod")>=0&&r.indexOf("like ipod")<0||r.indexOf("mac os x")>=0&&navigator.maxTouchPoints>0,h=!0;function l(){var t=!(!e&&(n&&document[n.hidden]||c&&!document.hasFocus()));t!==h&&(h=t,y(!1),p())}function u(){l()}function d(t){t&&t.target!==window||l()}function p(){var e;h?"running"!==t.state&&"closed"!==t.state&&b&&(e=t.resume())&&e.then(a,a).catch(a):"running"===t.state&&(e=t.suspend())&&e.then(a,a).catch(a)}function f(t){t&&t.unmute_handled||(t.unmute_handled=!0,p())}n&&i(document,[n.visibilitychange],u,!0,!0),c&&i(window,["focus","blur"],d,!0,!0),i(t,["statechange"],f,!0,!0),t.onstatechange||(t.onstatechange=f);var m=null;function g(t,e){for(var s=e;t>1;t--)s+=e;return s}var _="data:audio/mpeg;base64,//uQx"+g(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+g(16,"gICA")+g(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+g(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+g(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+g(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+g(97,"V")+"Q==";function y(t){if(c)if(h){if(t){if(!m){var e=document.createElement("div");e.innerHTML="<audio x-webkit-airplay='deny'></audio>",(m=e.children.item(0)).controls=!1,m.disableRemotePlayback=!0,m.preload="auto",m.src=_,m.loop=!0,m.load()}if(m.paused){var s=m.play();s&&s.then(a,v).catch(v)}}}else v()}function v(){m&&(m.src="about:blank",m.load(),m=null)}var x=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],b=!1;function w(){b=!0,y(!0),p()}return i(window,x,w,!0,!0),{dispose(){v(),n&&o(document,[n.visibilitychange],u,!0,!0),c&&o(window,["focus","blur"],d,!0,!0),o(window,x,w,!0,!0),o(t,["statechange"],f,!0,!0),t.onstatechange===f&&(t.onstatechange=null)}}}(Wc().rawContext,!0,t),makeArray:$c,bindAudioStart:(t,e)=>Lc(void 0,void 0,void 0,(function*(){const s=()=>Lc(void 0,void 0,void 0,(function*(){try{yield t.initAudio(),e.removeEventListener("touchend",s),e.removeEventListener("mousedown",s)}catch(n){}}));t.audioIsInitialized||(e.addEventListener("touchend",s),e.addEventListener("mousedown",s))})),InteractiveLayerBase:class{constructor({initializingElement:t,onInit:e,sceneManager:s,appFSM:n}){this.initializingElement=t||window,this.init=this.init.bind(this),this.onInit=e,this.sceneManager=s,this.appFSM=n}init(){return Ic(this,void 0,void 0,(function*(){if(this.sceneManager)try{yield this.sceneManager.initAudio(),this.initializingElement.removeEventListener("touchend",this.init),this.initializingElement.removeEventListener("mousedown",this.init),Qc.setMuteOnBlur("out",.3,this.sceneManager)}catch(we){}}))}initAudio(){return Ic(this,void 0,void 0,(function*(){return this.sceneManager.audioIsInitialized||(this.sceneManager.initAudio(),this.initializingElement.addEventListener("touchend",this.init),this.initializingElement.addEventListener("mousedown",this.init)),this.onInit&&(yield this.onInit())}))}setMute(t){this.sceneManager.setBusMute("master",t)}setBlurMute(t){this.sceneManager.setBusMute("out",t)}disableBlurMute(t){this.sceneManager.disableBlur=t}changeScene(t){var e;null===(e=this.appFSM)||void 0===e||e.transition(t)}trigger(t){this.sceneManager.audioIsInitialized&&this.sceneManager.trigger(t)}}},Xc={default:0,warp:"linear",min:0,max:1};class Zc{constructor(t){this.definition=Object.assign(Object.assign({},Xc),t)}process(t){const{warp:e,min:s=0,max:n=1}=this.definition;let i=t;return e&&(i=((t,e)=>{let s=t=>t;if("string"==typeof e)switch(e){case"exp":s=t=>Math.pow(t,2);break;case"cubic":s=t=>Math.pow(t,3)}else"function"==typeof e&&(s=e);return s(t)})(t,e)),"number"==typeof t&&(o=s,a=n,i=t*Math.abs(a-o)+o),i;var o,a}}Zc.PAN={definition:{default:0,min:-1,max:1},process:t=>2*t-1},Zc.BOOLEAN={definition:{default:!1},process:t=>!!t};const Yc=Zc;class Hc{constructor({name:t,set:e,controlSpec:s}){this.controlSpec=s||new Zc({}),this.name=t,this.setCallback=e}set(t,e){const s=this.controlSpec.process(t);return this.setCallback(s,e),this}setRaw(t,e){this.setCallback(t,e)}}const Jc=t=>new Hc({name:"rate",set:e=>t.player.playbackRate=e,controlSpec:new Zc({default:1,min:0,max:3})}),Kc=t=>new Hc({name:"pan",set:e=>t.channel.setPosition(e)}),th=Hc;var eh,sh=new Uint8Array(16);function nh(){if(!eh&&!(eh="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return eh(sh)}const ih=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,oh=function(t){return"string"==typeof t&&ih.test(t)};for(var ah=[],rh=0;rh<256;++rh)ah.push((rh+256).toString(16).substr(1));const ch=function(t,e,s){var n=(t=t||{}).random||(t.rng||nh)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){s=s||0;for(var i=0;i<16;++i)e[s+i]=n[i];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(ah[t[e+0]]+ah[t[e+1]]+ah[t[e+2]]+ah[t[e+3]]+"-"+ah[t[e+4]]+ah[t[e+5]]+"-"+ah[t[e+6]]+ah[t[e+7]]+"-"+ah[t[e+8]]+ah[t[e+9]]+"-"+ah[t[e+10]]+ah[t[e+11]]+ah[t[e+12]]+ah[t[e+13]]+ah[t[e+14]]+ah[t[e+15]]).toLowerCase();if(!oh(s))throw TypeError("Stringified UUID is invalid");return s}(n)};class hh{constructor(t,e){this.name="lfo",this.uuid=ch(),this.params=new Map;const{frequency:s=2,min:n=0,max:i=1,waveshaper:o,type:a}=t,r=new aa(s,n,i);if(a&&(r.type=a),o){const{sparseness:t}=o,e=zc.bottomOut(t);r.connect(e),this.modulator=e}else this.modulator=r;r.start();const c=`${this.name}-${e}-lfo-frequency`;this.params.set(c,new th({name:c,set:t=>r.set({frequency:t}),controlSpec:new Yc({min:.1,max:1e3,default:r.frequency})}))}setParam(t,e,s){this.params.get(t).set(e,s)}play(t,e){this.modulator.start(t)}connect(t){this.modulator.connect(t)}disconnect(){this.modulator.disconnect()}dispose(){this.disconnect(),this.modulator.dispose()}}const lh=t=>t?uh[t.toLowerCase()]:hh,uh={lfo:hh,envelope:class{constructor(t,e){this.name="envelope",this.uuid=ch(),this.params=new Map,this.modulator=new ba(t);const s=`${this.name}-env-attack`;this.params.set(s,new th({name:s,set:t=>this.modulator.attack=t,controlSpec:new Yc({min:0,max:20,default:this.modulator.attack.value})}));const n=`${this.name}-env-decay`;this.params.set(n,new th({name:n,set:t=>this.modulator.decay=t,controlSpec:new Yc({min:0,max:2,default:this.modulator.decay.value})}));const i=`${this.name}-env-sustain`;this.params.set(i,new th({name:i,set:t=>this.modulator.sustain=t,controlSpec:new Yc({min:0,max:1,default:this.modulator.sustain.value})}));const o=`${this.name}-env-release`;this.params.set(o,new th({name:o,set:t=>this.modulator.release=t,controlSpec:new Yc({min:0,max:20,default:this.modulator.release.value})}))}setParam(t,e,s){this.params.get(t).set(e,s)}play(t,e){this.modulator.triggerAttackRelease(e,t)}connect(t){this.modulator.connect(t)}disconnect(){this.modulator.disconnect()}dispose(){this.disconnect(),this.modulator.dispose()}},frequencyenvelope:class{constructor(t,e){this.name="envelope",this.uuid=ch(),this.params=new Map,this.modulator=new Ea(t);const s=`${this.name}-env-attack`;this.params.set(s,new th({name:s,set:t=>this.modulator.attack=t,controlSpec:new Yc({min:0,max:20,default:this.modulator.attack})}));const n=`${this.name}-env-decay`;this.params.set(n,new th({name:n,set:t=>this.modulator.decay=t,controlSpec:new Yc({min:0,max:2,default:this.modulator.decay})}));const i=`${this.name}-env-sustain`;this.params.set(i,new th({name:i,set:t=>this.modulator.sustain=t,controlSpec:new Yc({min:0,max:1,default:this.modulator.sustain})}));const o=`${this.name}-env-release`;this.params.set(o,new th({name:o,set:t=>this.modulator.release=t,controlSpec:new Yc({min:0,max:20,default:this.modulator.release})}));const a=`${this.name}-env-base-frequency`;this.params.set(a,new th({name:a,set:t=>this.modulator.baseFrequency=t,controlSpec:new Yc({min:10,max:4e3,default:this.modulator.baseFrequency,warp:"exp"})}));const r=`${this.name}-env-octaves`;this.params.set(r,new th({name:r,set:t=>this.modulator.octaves=t,controlSpec:new Yc({min:0,max:10,default:this.modulator.octaves,step:1})}))}setParam(t,e,s){this.params.get(t).set(e,s)}play(t,e){this.modulator.cancel(t),this.modulator.triggerAttackRelease(e,t)}connect(t){this.modulator.connect(t)}disconnect(){this.modulator.disconnect()}dispose(){this.disconnect(),this.modulator.dispose()}}};class dh{constructor(t){this.name="lpf",this.uuid=ch(),this.params=new Map;const{frequency:e=17e3,Q:s=1}=t;this.modulators=[];const n=new Da(e,"lowpass");s&&(n.Q.value=s),this.effectInstance=n,Object.entries(t).forEach((([t,e])=>{if("object"==typeof e){const s=e,{type:n}=s,i=s.settings,o=new(lh(n))(i);o.connect(this.effectInstance[t]),this.modulators.push(o)}})),this.initParams()}initParams(){this.params=new Map([new th({name:"frequency",set:t=>this.effectInstance.frequency.setValueAtTime(t),controlSpec:new Yc({min:.1,max:2e4,warp:"exp",default:this.effectInstance.frequency.value})}),new th({name:"Q",set:t=>this.effectInstance.Q.setValueAtTime(t),controlSpec:new Yc({min:0,max:30,default:this.effectInstance.Q.value})})].map((t=>[t.name,t])))}setParam(t,e,s){this.params.get(t).set(e,s)}setRawParam(t,e,s){this.params.get(t).setRaw(e,s)}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((t=>{t.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((t=>{t.dispose()}))}}const ph={lpf:dh,bpf:class{constructor(t){this.name="bpf",this.uuid=ch(),this.params=new Map;const{frequency:e}=t;this.frequency=e||17e3,this.Q=t&&t.Q||1,this.modulators=[];const s=new Da(this.frequency,"bandpass");this.Q&&(s.Q.value=this.Q),this.effectInstance=s,Object.entries(t).forEach((([t,e])=>{if("object"==typeof e){const s=e,{type:n}=s,i=s.settings,o=new(lh(n))(i);o.connect(this.effectInstance[t]),this.modulators.push(o)}})),this.initParams()}initParams(){this.params=new Map([new th({name:"frequency",set:t=>this.effectInstance.frequency.setValueAtTime(t),controlSpec:new Yc({min:.1,max:2e4,warp:"exp",default:this.effectInstance.frequency.value})}),new th({name:"Q",set:t=>this.effectInstance.Q.setValueAtTime(t),controlSpec:new Yc({min:0,max:30,default:this.effectInstance.Q.value})})].map((t=>[t.name,t])))}setParam(t,e,s){this.params.get(t).set(e,s)}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((t=>{t.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((t=>{t.dispose()}))}},reverb:class{constructor(t,e){this.uuid=ch(),this.modulators=[],this.name="reverb",this.params=new Map;const s=new gc;t&&t.sound&&e&&e().then((t=>{t.length&&(s.buffer=t[0])})),this.effectInstance=s,this.initParams()}initParams(){this.params=new Map}setParam(t,e,s){this.params.get(t).set(e,s)}disconnect(){this.effectInstance.disconnect()}dispose(){this.disconnect(),this.effectInstance.dispose()}},pingpong:class{constructor(t){this.uuid=ch(),this.name="pingpong",this.params=new Map;const e=new jr(t&&t.delayTime||"8n",t&&t.feedback||.5);this.effectInstance=e,this.modulators=[],this.initParams(),Object.entries(t).forEach((([t,e])=>{if("object"==typeof e){const s=e,n=new(lh(s.type))(s);n.connect(this.effectInstance[t]),this.modulators.push(n)}}))}setParam(t,e,s){this.params.get(t).set(e,s)}initParams(){this.params=new Map([new th({name:"delayTime",set:t=>this.effectInstance.delayTime.setValueAtTime(t),controlSpec:new Yc({min:.001,max:5,default:this.effectInstance.delayTime.value})}),new th({name:"feedback",set:t=>this.effectInstance.feedback.setValueAtTime(t),controlSpec:new Yc({min:0,max:1,default:this.effectInstance.feedback.value})})].map((t=>[t.name,t])))}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((t=>{t.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((t=>{t.dispose()}))}}},fh={gain:1,spatial:{isPositional:"stereo",refDistance:9,rolloffFactor:5}};class mh{constructor(t,e,s){this.params=new Map,this.isStatic=!1,this.pannerPosition=null,this.sends={},this.maxAudibleDistance=40,this.isPositional="stereo",(e=Object.assign(Object.assign({},fh),e)).spatial=Object.assign(Object.assign({},fh.spatial),e.spatial),this.resolveSources=s;const{spatial:n,gain:i}=e;this.initialGain=void 0!==i&&"number"==typeof i?i:1,this.effects=[],this.modulators=[],this.isStatic=(null==n?void 0:n.static)||(null==n?void 0:n.doesNotMove),this.isPositional=null==n?void 0:n.mode,this.maxAudibleDistance=(null==n?void 0:n.maxAudibleDistance)||40,this.initParams();const o=this.setupAudioGraph(this.isPositional,e);this.setupEffects(e.effects||[],o),this.gainSignal=new fo({value:this.initialGain}).connect(this.gain.gain),t&&this.add(t)}initParams(){this.params=new Map([new th({name:"gain",set:t=>this.setGain(t),controlSpec:new Yc({min:0,max:3,default:this.initialGain})}),new th({name:"pan",set:t=>this.setPosition(t),controlSpec:new Yc({min:-1,max:1,default:0})})].map((t=>[t.name,t])))}setupAudioGraph(t="stereo",e){const{spatial:{refDistance:s,rolloffFactor:n}}=e;let i;return this.muteGain=new lo(1),this.gain=new lo(0),"object"==typeof e.gain&&(this.modulatorGain=new lo(1),this.createModulator(e.gain,this.modulatorGain.gain),this.modulatorGain.connect(this.gain)),"3d"===t?(i=new cc({panningModel:"equalpower",refDistance:s,rolloffFactor:n}),this.panner=i):"mono"===t?(i=new fr,this.panner=i):this.panner=new lo(1),this.panner}createModulator(t,e){const{type:s,settings:n}=t,i=new(lh(s))(n);i.connect(e),this.modulators.push(i)}setupEffects(t,e){for(let s=0;s<t.length;s++){const n=this.createEffect(t[s]);n&&(e.connect(n.effectInstance),e=n.effectInstance,this.effects.push(n))}e.connect(this.muteGain),this.muteGain.connect(this.modulatorGain?this.modulatorGain:this.gain)}createEffect(t){const{effectType:e,settings:s={}}=t,n=(i=e)?ph[i.toLowerCase()]:dh;var i;return void 0===n?null:new n(s,this.resolveSources)}add(t){t.connect(this.panner),this.node=t}addSend(t,e){const{gain:s=0}=e,n=new lo;n.gain.value="number"==typeof s?s:0,e.pre?this.node.connect(n):this.gain.connect(n),n.connect(t.input),this.sends[t.settings.name]=n;const i=`sendTo:${t.settings.name}`;this.params.set(i,new th({name:i,set:t=>n.gain.value=t,controlSpec:new Yc({min:0,max:1,default:n.gain.value})})),"object"==typeof s&&this.createModulator(s,n.gain)}connect(t){this.gain.connect(t)}disconnect(){this.gain.disconnect()}updateDestination(t){this.disconnect(),this.connect(t)}setMuteState(t,e){let s=.2;return e&&e.fadeTime&&({fadeTime:s}=e),t?(this.muteGain.gain.rampTo(0,s),new Promise((t=>{setTimeout((()=>t(!0)),s)}))):(this.muteGain.gain.rampTo(1,s),new Promise((t=>{setTimeout((()=>t(!1)),s)})))}setPosition(t,e,s){"3d"===this.isPositional&&this.isStatic&&!this.pannerPosition?(this.panner.setPosition(t,e,s),this.pannerPosition=[t,e,s]):"3d"!==this.isPositional||this.isStatic?"mono"===this.isPositional&&(this.panner.set({pan:t}),this.pannerPosition=[t,0,0]):(this.panner.setPosition(t,e,s),this.pannerPosition=[t,e,s])}getPosition(){if(this.isPositional){const t=this.panner;return{x:t.positionX.value,y:t.positionY.value,z:t.positionZ.value}}return{x:this.panner.pan.value,y:0,z:0}}resetPosition(){this.pannerPosition=null}setGain(t,e,s){e=e||0,s=s||0,this.gainSignal.cancelAndHoldAtTime(_c()+s),this.gainSignal.rampTo(t*this.initialGain,e,_c()+s)}setInitialGain(t){this.initialGain=t}getGain(){return this.gainSignal.value}setSendGain(t,e,s,n){s=s||0,n=n||0;const i=this.sends[t];i&&(i.gain.cancelAndHoldAtTime(_c()),i.gain.rampTo(e,s,_c()+n))}resetGain(t){t=t||0,this.gainSignal.cancelAndHoldAtTime(_c()),this.gainSignal.rampTo(this.initialGain,t,_c())}fadeIn(t,e=0,s,n){const i=null==s?1:s,o=n&&n.fadeFromZero||!1;e=n&&n.exactTime?e:_c()+e,this.gainSignal.cancelAndHoldAtTime(e),o&&this.gainSignal.setValueAtTime(0,e),this.gainSignal.rampTo(i*this.initialGain,t,e)}fadeOut(t,e=0,s,n=!1){e=n?e:_c()+e,this.gainSignal.cancelAndHoldAtTime(e),this.gainSignal.rampTo(0,t,e),Ac.schedule((()=>s&&s()),e+t)}triggerModulators(t){const e=_c()+(t&&t.when||0),s=t&&void 0!==t.duration?t.duration:.5;this.effects.forEach((t=>{t.modulators&&t.modulators.forEach((t=>{t.play(e,s)}))})),this.modulators.forEach((t=>{t.play(e,s)}))}setParam(t,e,s){this.params.get(t).set(e,s)}setRawParam(t,e,s){this.params.get(t).setRaw(e,s)}dispose(){var t,e;null===(t=this.panner)||void 0===t||t.disconnect(),null===(e=this.panner)||void 0===e||e.dispose(),this.gain.disconnect(),this.gain.dispose(),this.muteGain.disconnect(),this.muteGain.dispose(),this.effects.forEach((t=>{t.disconnect();try{t.dispose()}catch(e){}}))}}const gh=mh;class _h{constructor(t,e){this.type="Bus",this.settings=t,this.uuid=ch(),this.name=t.name,this.settings.gain=void 0!==this.settings.gain?this.settings.gain:1,this.channel=new mh(null,t,e),this.setupAudioGraph()}setupAudioGraph(){this.input=new lo,this.channel.add(this.input)}connect(t){this.channel.connect(t)}setGain(t,e=1,s){this.channel.setGain(t,e,s)}setMuteState(t,e){this.channel.setMuteState(t,e)}triggerModulators(t){this.channel.triggerModulators(t)}get params(){return this.channel.params}setParam(t,e,s){this.channel.setParam(t,e,s)}setRawParam(t,e,s){this.channel.setRawParam(t,e,s)}dispose(){this.input.dispose(),this.channel.dispose()}}const yh=_h,vh=class{constructor(t,e="/"){this.supportedLanguages=["en"],this.baseFilePath=e,this.buffersInProgress=new Map,this.sources=new Map,t.forEach((t=>{this.sources.set(t.name,t)})),this.buffers=new Map}addSource(t){this.sources.set(t.name,t)}getSoundBuffer(t,e=!1){return function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){const s=this.buffers.get(t);if(s)return Promise.resolve(s);if(this.buffersInProgress.get(t))return this.buffersInProgress.get(t);const n=this.sources.get(t);let i;if(n.file||(n.file=n.name),e){const t=this.getLocalizedPathName();i=t?`${this.baseFilePath}${t}/${n.file}.[ogg|mp3]`:`${this.baseFilePath}${n.file}.[ogg|mp3]`}else i=`${this.baseFilePath}${n.file}.[ogg|mp3]`;const o=Ri.load(i);this.buffersInProgress.set(t,o);const a=yield o;return a&&this.buffers.set(t,a),this.buffersInProgress.delete(t),a}))}getLocalizedPathName(){const t=this.language||navigator.language;let e=null;if(this.supportedLanguages.includes(t))e=t;else{const s=`^${t.split("-")[0]}($|-)`;e=this.defaultLanguage.match(s)?this.defaultLanguage:this.supportedLanguages.find((t=>t.match(s)))}return e||(e=this.defaultLanguage),e}setSoundBuffer(t,e){this.buffers.set(t,e)}deleteSoundBuffer(t){this.buffers.delete(t)}empty(){this.buffers.forEach(((t,e)=>this.deleteSoundBuffer(e)))}setBaseFilePath(t){this.baseFilePath=t}setSupportedLanguages(t){this.supportedLanguages=t}setDefaultLanguage(t){this.defaultLanguage=t}setLanguage(t){this.language=t}},xh=class{constructor(t,e){this.params=new Map;const{name:s}=e,n=new Za(t),i=new mh(n,e);this.uuid=ch(),this.name=s,this.player=n,this.channel=i,this.metadata=e.metadata||{},this.settings=e,this.initParams(),this.settings.envelope&&Object.entries(this.settings.envelope).forEach((([t,e])=>{this.setParam(t,e)}))}initParams(){const t=this.player;this.params=new Map([new th({name:"attack",set:e=>t.attack=e}),new th({name:"release",set:e=>t.release=e,controlSpec:new Yc({default:2,min:0,max:5})}),new th({name:"curve",set:e=>t.curve=e})].map((t=>[t.name,t])))}setGain(t,e=0,s=0){this.channel.setGain(t,e,s)}connect(t){this.channel.connect(t)}getState(){return"started"}getActiveSources(){return this.player._activeSources}getNumberOfActiveSources(){let t=0;const e=this.getActiveSources();return e&&e.forEach((e=>{t+=e.length})),t}stopOldestNote(){const t=[],e=this.getActiveSources();if(e){e.forEach(((e,s)=>{e.forEach((e=>{t.push({key:s,note:e})}))}));const s=t.reduce(((t,e)=>t.note._stopTime<e.note._stopTime?t:e));this.player.triggerRelease(Qi(s.key))}}play(t={}){const{noReset:e=!1,options:s={}}=t;if("suspended"===Li().state)return!1;let{when:n=0}=t;const{note:i=60,velocity:o=1,exactTime:a=!1,duration:r=1}=s;!e&&this.channel.resetGain(),n=a?n:yc()+n,this.player.triggerAttackRelease(Qi(i),r,n,o)}stop(t={}){let{when:e=0}=t;const{options:s={}}=t,{note:n,exactTime:i=!1}=s;e=i?e:yc()+e,n?this.player.triggerRelease(Qi(n),e):this.player.releaseAll(e)}triggerModulators(t){this.channel.triggerModulators(t)}releaseAll(t=0){this.player.releaseAll(t)}fadeOut(t,e,s){this.channel.fadeOut(t,e),setTimeout((()=>{s&&s(this)}),1e3*(e+t))}setParam(t,e,s){this.params.get(t).set(e,s)}setRawParam(t,e,s){this.params.get(t).setRaw(e,s)}dispose(){this.player.dispose(),this.player.disconnect(),this.channel.dispose()}},bh=class{constructor(t,e){var s;this.params=new Map,this.retrigger=!1;const{name:n,loop:i=!1,loopStart:o,loopEnd:a,metadata:r={}}=e,c=new ha(t);this.retrigger=!i,this.uuid=ch(),c.loop=i,this.name=n,this.settings=e;const h=new mh(c,e);this.player=c,this.channel=h,this.metadata=r,this.duration=e.duration||(null===(s=this.player.buffer)||void 0===s?void 0:s.duration),o&&(c.loopStart=o),a?this.setLoopEnd(a):e.duration&&e.duration<=c.buffer.duration&&(c.loopEnd=e.duration),this.initParams()}initParams(){const t=this.player;var e;this.params=new Map([(e=this,new Hc({name:"gain",set:(t,{fadeTime:s=0,startTime:n}={})=>e.channel.setGain(t,s,n)})),Jc(this),Kc(this),new Hc({name:"loopStart",set:this.setLoopStart.bind(this)}),new Hc({name:"loopEnd",set:this.setLoopEnd.bind(this)}),new Hc({name:"loop",set:this.setLoop.bind(this),controlSpec:Yc.BOOLEAN}),new Hc({name:"reverse",set:e=>t.reverse=e,controlSpec:Yc.BOOLEAN}),new Hc({name:"seek",set:e=>t.seek=e}),new Hc({name:"seek",set:e=>t.seek=e})].map((t=>[t.name,t])))}setLoopStart(t){t<=this.player.buffer.duration&&(this.settings.loopStart=t,this.player.loopStart=t)}setLoopEnd(t){t<=this.player.buffer.duration&&(this.settings.loopEnd=t,this.player.loopEnd=t)}setLoop(t){this.settings.loop=t,this.player.loop=t}setGain(t,e=0,s=0){this.channel.setGain(t,e,s)}connect(t){this.channel.connect(t)}getState(){return this.player.state}play(t={}){const{noReset:e=!0,fadeIn:s=0,gain:n=1,exactTime:i=!1,offset:o=0}=t,{when:a=0}=t,r=i?a:_c()+a;try{if("started"!==this.player.state)!e&&this.channel.resetGain(),this.channel.fadeIn(s,a,n,{fadeFromZero:!0,exactTime:i}),this.player.start(r,o);else if(this.retrigger){const t=.01,e=.001;this.fadeOut(t,a,null,i),this.channel.fadeIn(e,a+t,n,{exactTime:i}),this.player.restart(r+t,o)}else this.channel.fadeIn(s,a,n,{exactTime:i})}catch(u){}}stop(t={}){const{retries:e=0,exactTime:s=!1}=t;let{when:n=0}=t;n=s?n:_c()+n,this.channel.getGain()>.1?(this.fadeOut(1,0,(()=>{})),e<5?setTimeout((()=>this.stop({retries:e+1})),1500):this.player.stop(n)):this.player.stop(n)}fadeOut(t,e,s,n=!1){0!==this.channel.getGain()&&this.channel.fadeOut(t,e,(()=>{s&&s(this)}),n)}setParam(t,e,s){this.params.get(t).set(e,s)}setRawParam(t,e,s){this.params.get(t).setRaw(e,s)}getDuration(){return this.duration}dispose(){this.player.dispose(),this.player.disconnect(),this.channel.dispose()}};let wh;const Th=class{constructor(t,e){this.params=new Map,this.onConnected=null,this.onDisconnected=null;const{name:s,outputDevices:n="all"}=e;this.name=s,this.outputDevices=n,this.outputs=[],this.uuid=ch(),this.settings=e,wh=i.e(359).then(i.bind(i,359)).then((t=>{t.enable((e=>{e||(this.availableOutputs=t.outputs,this.setOutputs(n),t.addListener("connected",(t=>{this.onConnected&&this.onConnected(t),this.setOutputs(this.outputDevices)})),t.addListener("disconnected",(t=>{this.onDisconnected&&this.onDisconnected(t),this.setOutputs(this.outputDevices)})))}))})),this.metadata=e.metadata||{}}setGain(t,e=0,s=0){}connect(t){}getState(){return"started"}getWebMidiEnabled(){return wh&&wh.enabled}getAvailableOutputs(){return this.availableOutputs}getOutputs(){return this.outputs}setConnectedCallback(t){this.onConnected=t}setDisconnectedCallback(t){this.onDisconnected=t}setOutputs(t){if(this.outputDevices=t,wh&&wh.enabled)if(this.outputs=[],t.length&&"all"===t)this.outputs=wh.outputs;else{const e=wh.getOutputByName(t.trim());e&&this.outputs.push(e)}}play({noReset:t=!0,when:e=0,options:s}){const{note:n,velocity:i}=s;this.outputs.forEach((t=>{t.playNote(n,"all",{velocity:i,time:"+"+1e3*e})}))}stop({when:t=0,options:e={note:null}}){e&&e.note&&this.outputs.forEach((s=>{s.stopNote(e.note,"all",{velocity:1,time:"+"+1e3*t})}))}allNotesOff(){this.outputs.forEach((t=>{t.sendChannelMode("allnotesoff")}))}sendReset(){this.outputs.forEach((t=>{t.sendReset()}))}fadeOut(t,e,s){}setParam(t,e,s){this.params.get(t).set(e,s)}dispose(){}},Sh={sampler:xh,player:bh,midi:Th,roundRobin:class{constructor(t,e){this.params=new Map,this.playIndex=0;const{name:s,mode:n="random"}=e;this.mode=n;const i=new lo(1);this.players=[],Object.values(t).forEach((t=>{const e=new ha(t);e.connect(i),this.players.push(e)}));const o=new mh(i,e);this.channel=o,"random"===this.mode&&this.advancePlayIndex(),"backwards"===this.mode&&(this.playIndex=this.players.length-1),"shuffle"===this.mode&&Uc(this.players),this.uuid=ch(),this.name=s,this.settings=e}advancePlayIndex(){switch(this.mode){case"random":if(this.players.length>1){let t=0;t=this.getRandomIndex(),this.playIndex=t}break;case"step":this.playIndex=++this.playIndex%this.players.length;break;case"backwards":this.playIndex=--this.playIndex%this.players.length,this.playIndex<0&&(this.playIndex=this.players.length-1);break;case"shuffle":this.playIndex===this.players.length-1&&Uc(this.players),this.playIndex=++this.playIndex%this.players.length}}getRandomIndex(){const t=new Array(this.players.length).fill(0).map(((t,e)=>e)).filter((t=>t!==this.playIndex));return t[Math.floor(Math.random()*t.length)]}setGain(t,e=0,s=0){this.channel.setGain(t,e,s)}connect(t){this.channel.connect(t)}getState(){let t=!1;return this.players.forEach((e=>{"started"===e.state&&(t=!0)})),t?"started":"stopped"}play(t={}){var e;const{exactTime:s=!1,offset:n=0}=t;if("suspended"===Li().state)return!1;const{when:i=0}=t,o=s?i:yc()+i;null===(e=this.players[this.playIndex])||void 0===e||e.start(o,n),this.advancePlayIndex()}stop(t={}){const{exactTime:e=!1}=t;let{when:s=0}=t;s=e?s:yc()+s,this.players.forEach((t=>{t.stop(s)}))}fadeOut(t,e,s,n=!1){0!==this.channel.getGain()&&this.channel.fadeOut(t,e,(()=>{s&&s(this)}),n)}setParam(t,e,s){this.params.get(t).set(e,s)}setRawParam(t,e,s){this.params.get(t).setRaw(e,s)}dispose(){this.players.forEach((t=>{t.dispose(),t.disconnect()})),this.channel.dispose()}}};var kh=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))};class Ah{constructor(t,e={}){const{sources:s}=t,{destination:n,bufferManager:i,busses:o}=e;this.config=t,this.bufferManager=i||new vh(s,Nc(t.basePath)),this.busses=o,this.instruments=new Map,this.masterGain=n||Tc(),this.soundSources=new Map,this.loadSourceConfigs(s)}loadSourceConfigs(t){t.forEach((t=>{this.soundSources.set(t.name,t)}))}trigger(t,e){e=e||{};const s=this.getInstrument(t);s&&s.play(e)}createInstrument(t,e){return kh(this,void 0,void 0,(function*(){const s=e.spatial;let n,i=null;if("object"==typeof e.sound){const s=[];n={},Object.keys(e.sound).forEach((o=>{i=this.soundSources.get(e.sound[o]);const a=this.bufferManager.getSoundBuffer(e.sound[o],t.localized).then((t=>{n[o]=t})).catch((()=>{}));s.push(a)})),yield Promise.all(s)}else e.sound&&(i=this.soundSources.get(e.sound),n=yield this.bufferManager.getSoundBuffer(e.sound,t.localized).catch((()=>{})));var o;i&&((e=Object.assign(Object.assign({},i),e)).spatial=Object.assign(Object.assign({},i.spatial),s)),e.type||(e.type="player");const a=new((o=e.type)?Sh[o]:bh)(n,e);e.bus?a.connect(this.busses.get(e.bus).input):(e.bus="",a.connect(this.masterGain)),e.sends&&this.busses&&e.sends.forEach((t=>{const e=this.busses.get(t.bus);e&&a.channel.addSend(e,{gain:t.gain,pre:t.pre})})),this.instruments.set(t.name?`${t.name}:${e.name}`:`${e.name}`,a)}))}getInstrument(t){return this.instruments.get(t)}getInstrumentKeysForScene(t){const e=[];return this.instruments.forEach(((s,n)=>{n.match(`${t}:`)&&e.push(n)})),e}stop(t,e){e=e||{};const{fadeOut:s=0,when:n=0,exactTime:i=!1}=e,o=this.instruments.get(t);Ah.stopInstrument(o,{fadeOut:s,when:n,onComplete:null==e?void 0:e.onComplete,exactTime:i})}static stopInstrument(t,e={}){const{onComplete:s}=e;e.onComplete=()=>{t.stop({when:1}),s&&s()},Ah.fadeOutInstrument(t,e)}fadeOut(t,e){const s=this.instruments.get(t);Ah.fadeOutInstrument(s,e)}static fadeOutInstrument(t,e={}){const{when:s,fadeOut:n,onComplete:i,exactTime:o}=e;null==t||t.fadeOut(n,s,i,o)}addInstrument({sound:t,sceneName:e,buffer:s}){return kh(this,void 0,void 0,(function*(){s&&(s=Array.isArray(s)?s:[s]).forEach((t=>{this.bufferManager.setSoundBuffer(t.name,t.buffer),this.config.sources.push({name:t.name,file:t.name})}));const n=t;return n.sound||(n.sound=t.name),this.getInstrument(`${e}:${n.name}`)&&this.deleteInstrument(`${e}:${n.name}`),this.config.scenes[e].sounds.push(n),this.createInstrument({name:e},n)}))}deleteInstrument(t){const e=t.split(":")[0],s=t.split(":")[1];this.config.sources=this.config.sources.filter((t=>t.name!==s)),this.config.scenes[e].sounds=this.config.scenes[e].sounds.filter((t=>t.name!==s)),this.disposeInstrument(this.instruments.get(t))}disposeAll(){this.instruments.forEach((t=>{this.disposeInstrument(t)}))}disposeInstrument(t){t.dispose(),this.instruments.forEach(((e,s)=>{e===t&&this.instruments.delete(s)}))}unloadScene(t){this.instruments.forEach(((e,s,n)=>{s.match(`${t}:`)&&(e.dispose(),n.delete(s))}))}static unloadInstruments(t){t.forEach((t=>t.dispose()))}}var Mh=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))};class Ch{constructor(t){this.audioIsInitialized=!1,this.utils=Qc,this.loadingState="initializing",this.disableBlur=!1;const{scenes:e,sources:s,busses:n=[{name:"master",parent:"$OUT"}],basePath:i="/"}=t;this.config={scenes:e,sources:s,busses:n,basePath:i};const o=Nc(i);this.scenes=new Map,this.loadSceneConfigs(e),this.bufferManager=new vh(s,o),this.busses=new Map,this.setupAudioGraph(n),this.instrumentManager=new Ah(t,{destination:this.masterGain.input,bufferManager:this.bufferManager,busses:this.busses}),this.listener=kc(),window&&(window.KLANG_SCENEMANAGER=this)}loadConfig(t,e){this.bufferManager.empty(),e.forEach((({name:t,buffer:e})=>this.bufferManager.setSoundBuffer(t,e)));const{scenes:s,sources:n,busses:i}=t;this.scenes=new Map,this.loadSceneConfigs(s),this.instrumentManager.loadSourceConfigs(n),this.busses=new Map,this.setupAudioGraph(i)}loadSceneConfigs(t){Object.entries(t).forEach((([t,e])=>{e.name=t,e.bus&&(e.sounds=e.sounds.map((t=>(t.bus||(t.bus=e.bus),t)))),this.scenes.set(e.name,e)}))}setupAudioGraph(t){this.instrumentManager&&this.instrumentManager.disposeAll(),this.busses&&this.busses.forEach(((t,e)=>{t.dispose(),this.busses.delete(e)})),this.masterGain=new lo(1).toDestination(),t.forEach((t=>{this.createBus(t)})),this.busses.forEach((t=>{this.connectBus(t)}))}createBus(t){const e=[];t.effects&&t.effects.forEach((t=>{var s;(null===(s=t.settings)||void 0===s?void 0:s.sound)&&e.push(t.settings.sound)}));const s=new _h(t,(()=>new Promise((t=>{e.length>0?Promise.all(e.map((t=>this.bufferManager.getSoundBuffer(t)))).then((e=>{t(e)})):t(!0)}))));return this.busses.set(t.name,s),s}connectBus(t){const e="$OUT"===t.settings.parent?this.masterGain:this.busses.get(t.settings.parent).input;t.connect(e),t.settings.sends&&t.settings.sends.forEach((e=>{const s=this.busses.get(e.bus);s&&t.channel.addSend(s,{gain:e.gain,pre:e.pre})}))}getNewBuffer(t){return this.bufferManager.addSource(t),this.bufferManager.getSoundBuffer(t.name)}initAudio(){return ji().then((()=>{Qc.unmuteIOS(!!Qc.isSafari(navigator.userAgent)),this.audioIsInitialized=!0,Ac.expiration=2}))}destroy(){this.instrumentManager.disposeAll(),this.busses.forEach((t=>t.dispose())),this.bufferManager.empty()}loadScene(t,e=!1,s){return Mh(this,void 0,void 0,(function*(){let n=this.scenes.get(t);n||(n=this.scenes.get("main")),e&&(this.currentScene=n,this.loadingState="loading");const i=n.sounds.map((t=>this.instrumentManager.createInstrument(n,t)));return Promise.all(i).then((()=>{n.sounds.forEach((t=>{var e,s,n;"3d"!==(null===(e=t.spatial)||void 0===e?void 0:e.mode)&&"mono"!==(null===(s=t.spatial)||void 0===s?void 0:s.mode)&&(null===(n=t.spatial)||void 0===n?void 0:n.doesNotMove)&&this.triggerForScene(t.name,{noReset:!0})})),this.loadingState="loaded",s&&s()}))}))}changeScene(t,e){var s,n;if(t===(null===(s=this.currentScene)||void 0===s?void 0:s.name))return!1;const{onLoaded:i}=e,o=null!==e.fadeOutTime?e.fadeOutTime:0,a=this.instrumentManager.getInstrumentKeysForScene(null===(n=this.currentScene)||void 0===n?void 0:n.name).map((t=>this.instrumentManager.getInstrument(t)));return Promise.all(a.map((t=>new Promise((e=>this.instrumentManager.stop(t.name,{fadeOut:o,when:0,onComplete:()=>e(!0)})))))).then((()=>{a.forEach((t=>this.instrumentManager.disposeInstrument(t)))})),this.loadScene(t,!0,i)}unloadScene(t){this.instrumentManager.unloadScene(t)}addScene(t){if(this.scenes.get(t))return;const e={name:t,sounds:[]};this.scenes.set(t,e),this.instrumentManager.config.scenes[t]||(this.instrumentManager.config.scenes[t]=Object.assign({},e))}getBusses(){return this.busses}getBus(t){return this.busses.get(t)}getInstrument(t){return this.instrumentManager.getInstrument(t)}getInstruments(){return this.instrumentManager.instruments}getInstrumentById(t){const e=this.getInstruments(),[s,n]=Array.from(e).find((([e,s])=>s.uuid===t));return n}getCurrentScene(){return this.currentScene}getScenes(){return this.scenes}getInstrumentForScene(t){var e;return this.instrumentManager.getInstrument(`${null===(e=this.currentScene)||void 0===e?void 0:e.name}:${t}`)}trigger(t,e){this.instrumentManager.trigger(t,e)}triggerForScene(t,e){var s;return!!this.currentScene&&(this.trigger(`${null===(s=this.currentScene)||void 0===s?void 0:s.name}:${t}`,e),!0)}triggerAllForScene(t,e){this.instrumentManager.getInstrumentKeysForScene(t).forEach((t=>{this.trigger(t,e)}))}stopForScene(t,e){var s;this.stop(`${null===(s=this.currentScene)||void 0===s?void 0:s.name}:${t}`,e)}stop(t,e){this.instrumentManager.stop(t,e)}fadeOut(t,e){this.instrumentManager.fadeOut(t,e)}setPositionForScene(t,e){if(!e||!this.currentScene)return!0;this.setPosition(`${this.currentScene.name}:${t}`,e)}setPosition(t,e){const s=this.instrumentManager.getInstrument(t);if(null==s)return!1;const{channel:n}=s;n.setPosition(e.x,e.y,e.z);const i=jc({x:e.x,y:e.z},{x:this.listener.positionX.value,y:this.listener.positionZ.value}),o=n.maxAudibleDistance;n.isPositional&&("stopped"===s.getState()&&i<o?this.trigger(t):"stopped"!==s.getState()&&i>o&&this.instrumentManager.stop(s.name,{fadeOut:0,when:0}))}setListenerPosition(t,e){return!t||(this.listener.set({positionX:t.x,positionY:t.y,positionZ:t.z,forwardX:Math.sin(-e.y),forwardY:0,forwardZ:-Math.cos(-e.y)}),this.listener)}setBusVolume(t,e,s=1,n=0){const i=this.busses.get(t);"$OUT"===t?this.masterGain.gain.rampTo(e,s,n):null==i||i.setGain(e,s,n)}setBusMute(t,e){var s;return"$OUT"===t?(this.masterGain.gain.value=e?0:1,Promise.resolve(!0)):null===(s=this.busses.get(t))||void 0===s?void 0:s.setMuteState(e)}cleanConfig(t){const e=JSON.parse(JSON.stringify(t));return e.sources=e.sources.map((t=>(t.file===t.name&&delete t.file,t))),e.scenes=Object.entries(e.scenes).reduce(((t,[e,s])=>{const n=s.bus;if(n){const i=s.sounds.map((t=>(t.bus===n&&delete t.bus,t)));s.sounds=i,t[e]=s}else t[e]=s;return t}),{}),e}getCurrentConfig(){return this.config.busses.forEach((t=>{const e=this.busses.get(t.name);1!==e.channel.initialGain&&e.channel.initialGain!==t.gain&&(t.gain=e.channel.initialGain)})),Object.entries(this.config.scenes).forEach((([t])=>{this.config.scenes[t].sounds.forEach((e=>{const s=this.getInstrument(`${t}:${e.name}`);"master"!==e.bus&&s.settings.bus!==e.bus&&(e.bus=s.settings.bus),1!==s.channel.initialGain&&s.channel.initialGain!==e.gain&&(e.gain=s.channel.initialGain),s.settings.loop&&(e.loop=!0),0!==s.settings.loopStart&&(e.loopStart=s.settings.loopStart),0!==s.settings.loopEnd&&(e.loopEnd=s.settings.loopEnd),e.type!==s.settings.type&&(e.type=s.settings.type),e.sound!==s.settings.sound&&(e.sound=s.settings.sound)}))})),JSON.stringify(this.cleanConfig(this.config))}getMasterGain(){return this.masterGain}addInstrument({sound:t,sceneName:e,buffer:s}){return Mh(this,void 0,void 0,(function*(){return this.instrumentManager.addInstrument({sound:t,sceneName:e,buffer:s})}))}deleteInstrument(t){this.instrumentManager.deleteInstrument(t)}connectMediaToBus(t,e){const s=Li().createMediaElementSource(e),n=this.getBus(t);return n&&co(s,n.input.output),e.muted=!1,s}setSupportedLanguages(t){this.bufferManager.setSupportedLanguages(t)}setDefaultLanguage(t){this.bufferManager.setDefaultLanguage(t)}setLanguage(t){this.bufferManager.setLanguage(t)}static now(){return _c()}}const Oh=t=>{const e={value:t.initialState,stash:{},transition(s,n=!1){var i,o;if(!n&&e.value===s)return e.value;const a=t.states[e.value],r=t.states[s];if(r){const t=(null==a?void 0:a.transitions)&&(null==a?void 0:a.transitions[s]);(null==t?void 0:t.action)&&t.action(e.value),(null===(i=null==a?void 0:a.actions)||void 0===i?void 0:i.onExit)&&a.actions.onExit(s,e.stash),e.stash=(null===(o=null==r?void 0:r.actions)||void 0===o?void 0:o.onEnter)&&r.actions.onEnter(e.value),e.value=s}return e.value},exit(){const s=t.states[e.value];s&&s.actions&&s.actions.onExit(null,e.stash)}};return e},Dh=({playerKeys:t=[],scene:e,sceneManager:s,fadeTime:n=1,gain:i=1,onEnter:o,onExit:a})=>{e&&(e+=":");const r=t.reduce(((t,r)=>{const c=$c(r),[h]=c;return t.states[h]={actions:{onEnter:o?()=>o(c):()=>{c.forEach((t=>{s.trigger(`${e}${t}`,{gain:i})}))},onExit:a?()=>a(c):()=>{c.forEach((t=>{s.fadeOut(`${e}${t}`,{fadeOut:n})}))}}},t}),{initialState:"silent",states:{silent:{}}});return Oh(r)},Eh=Oh;var Ph=i(540);class Ih{constructor({sceneManager:t,phrase:e={instruments:[{instrument:"",notes:[],noteLength:1}]}}){this.isPlaying=!1,this.synced=!0,this.sceneManager=t,this.phraseConfig=e,this.scheduledEvents=[],this.stopContextTime=Number.MAX_VALUE,this.state={params:{intensity:.5,tempo:1,spread:.5,walking:!1}}}play(){this.isPlaying=!0,this.stopContextTime=Number.MAX_VALUE;const{instruments:t=[]}=this.phraseConfig;t.forEach((t=>{t.sequence.reset&&t.sequence.reset(),this.scheduleNext(t)})),"started"!==vc.state&&vc.start()}scheduleNext(t){const{durationScale:e}=this.getParamModifiers(),{sequence:s,durations:n,velocities:i=(0,Ph.Pseq)([1])}=t,o=s.next(),a=n.next(),r=i.next(),c=o.value,h=a.value,l=this.synced?vc.nextSubdivision(h):Yi(h).toSeconds()*e,u=this.scheduleOnce(c,h,r.value/2,l,t);if(this.scheduledEvents.push(u),o.done&&(this.isPlaying=!1),this.synced)for(;h<.1&&this.isPlaying;)this.scheduleNext(t)}scheduleOnce(t,e,s,n,i){return vc.scheduleOnce((n=>{(Array.isArray(t)?t:[t]).forEach((t=>{window.KLANG_EVENT_CB&&window.KLANG_EVENT_CB({note:t,duration:e,velocity:s,when:n}),this.sceneManager.trigger(i.instrument,{options:{note:t,duration:i.noteLength,velocity:s,when:n}})})),this.isPlaying&&_c()<this.stopContextTime&&this.scheduleNext(i)}),this.synced?vc.getSecondsAtTime(n):vc.seconds+n)}stop(t,e){this.stopContextTime=_c()+t}getParamModifiers(){const{intensity:t,tempo:e,spread:s}=this.state.params;return{durationScale:e*(2*(1-t)),spreadScale:Math.round(2*s)}}setParams(t,e){this.state.params=Object.assign(Object.assign({},this.state.params),t),t.intensity&&this.setIntensity(t.intensity),t.sequence&&void 0!==e&&(this.phraseConfig.instruments[e].sequence=t.sequence),t.durations&&void 0!==e&&(this.phraseConfig.instruments[e].durations=t.durations),t.velocities&&void 0!==e&&(this.phraseConfig.instruments[e].velocities=t.velocities),t.instrument&&void 0!==e&&(this.phraseConfig.instruments[e].instrument=t.instrument),t.noteLength&&void 0!==e&&(this.phraseConfig.instruments[e].noteLength=t.noteLength)}getInstruments(){return this.phraseConfig.instruments}setIntensity(t){this.phraseConfig.backgroundLoops.forEach((e=>{this.sceneManager.getInstrument(e).setGain(Math.min(1,2*t+.1),1)}))}}class Rh{constructor({sceneManager:t,piece:e}){this.isPlaying=!1;const{id:s,bpm:n=120,sequence:i,phrases:o,durations:a}=e;this.id=s,this.scheduledEvents=[],this.durations=a,this.synced=!0,this.bpm=n,this.state={phraseIndex:null,params:{intensity:.5,tempo:1,spread:.5,walking:!1}},this.phrases=o.map((e=>new Ih({sceneManager:t,phrase:e}))),this.phraseSequence=i}changePhrase(t,e=!1){if((this.state.phraseIndex!==t||e)&&this.isPlaying){const e=this.phrases[this.state.phraseIndex];e&&e.stop(),this.state.phraseIndex=t,this.phrases[t].play()}}startLoop(){const t=(0,Ph.Prand)(this.phraseSequence),e=(s=!1)=>{let{durationScale:n}=this.getParamModifiers();s&&(n=1);const i=t.next().value%this.phrases.length,o=s?.1:this.durations.next().value,a=this.synced?vc.nextSubdivision(o):Yi(o).toSeconds()*n,r=vc.scheduleOnce((()=>{this.changePhrase(i,s),this.scheduledEvents=this.scheduledEvents.filter((t=>t!==r)),this.isPlaying&&e()}),this.synced?vc.getSecondsAtTime(a):vc.seconds+a);this.scheduledEvents.push(r)};e(!0)}getParamModifiers(){const{intensity:t,tempo:e}=this.state.params;return{durationScale:e*(2*(1-t))}}updateParams(){this.phrases.forEach((t=>{t.setParams(this.state.params)}))}play(){this.isPlaying||("started"!=vc.state&&(vc.bpm.value=this.bpm,vc.start()),this.startLoop()),this.isPlaying=!0}stop(t){this.isPlaying=!1,this.scheduledEvents.forEach((t=>vc.clear(t))),this.scheduledEvents=[],this.phrases.forEach((e=>e.stop(t)))}setParams(t){this.state.params=Object.assign(Object.assign({},this.state.params),t),this.updateParams()}getCurrentPhrase(){return this.phrases[this.state.phraseIndex]}}const qh=class{constructor(){this.mic=null,this.gain=new lo}open(){return function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function r(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){return navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}).then((t=>{this.mediaStream=t,this.mic=Wc().createMediaStreamSource(t),co(this.mic,this.gain)}))}))}close(){this.mic&&this.mediaStream&&this.mediaStream.getTracks().forEach((t=>{ho(this.mic,this.gain),t.stop()}))}connect(t){this.gain.connect(t)}},Fh=class{constructor(t={type:"fft",size:2048}){const{type:e,size:s}=t;this.analyser=new Yr(e,s)}connect(t){this.analyser.connect(t)}getNode(){return this.analyser}getDecibels(){const t=this.analyser.getValue();let e=0;for(let i=0;i<t.length;i++)e+=Math.pow(t[i],2);const s=10*Math.log10(e/t.length),n=this.getPeak(t);return{peak:10*Math.log10(n),average:s}}getPeak(t){t||(t=this.analyser.getValue());let e=0;for(let s=0;s<t.length;s++){const n=Math.pow(t[s],2);e=Math.max(n,e)}return e}},Vh=class{constructor(t){const{analyser:e}=t;this.analyser=e;const s=e.getNode()._analysers,[n]=s;this.rawAnalyser=n,this.magnitudes=new Uint8Array(this.rawAnalyser.frequencyBinCount),this.timeDomainBuffer=new Float32Array(this.rawAnalyser.fftSize),this.floatMagnitudes=new Float32Array(this.rawAnalyser.fftSize)}update(){this.getFrequencyData()}getFrequencyData(){return this.rawAnalyser.getByteFrequencyData(this.magnitudes),this.rawAnalyser.getFloatFrequencyData(this.floatMagnitudes),this.floatMagnitudes=this.floatMagnitudes.map((t=>t<=0?.01:t)),this.magnitudes}setNoiseFloor(t){}getPeak(){return this.analyser.getPeak()}getTimeDomainData(){return this.rawAnalyser.getFloatTimeDomainData(this.timeDomainBuffer),this.timeDomainBuffer}getRMS(){this.rawAnalyser.getFloatTimeDomainData(this.timeDomainBuffer);let t=this.timeDomainBuffer.reduce(((t,e)=>t+Math.pow(e,2)),0);return t/=this.timeDomainBuffer.length,t=Math.sqrt(t),t}getSpectralFlatness(){const t=Array.from(this.magnitudes).map((t=>Math.max(t/255,0))),e=t.reduce(((t,e)=>t+e),0)/t.length,s=t.reduce(((t,e)=>t*(e||1)),1);return Math.pow(s,1/t.length)/e}getSpectralCentroid(){const t=Wc().rawContext.sampleRate/2;let e=0,s=0;for(let i=0;i<this.magnitudes.length;i++)e+=i*this.magnitudes[i],s+=this.magnitudes[i];let n=0;return 0!==s&&(n=e/s),n*(t/this.magnitudes.length)}};window.TONE_SILENCE_LOGGING=!0})();var a=o.i$,r=o.bz,p=o.P6;class f{constructor(t,e,s){u(this,"config"),u(this,"timeoutId",0),u(this,"endTimeoutId",0),u(this,"sceneManager"),u(this,"currentIndex",0),u(this,"callback"),u(this,"currentKey"),this.config=t,this.sceneManager=e,this.callback=s}start(){this.triggerKey(this.currentIndex)}getCurrentIndex(){return this.currentIndex}stop(t={setCompleted:!1,stopImmediately:!0}){clearTimeout(this.timeoutId),clearTimeout(this.endTimeoutId),t.stopImmediately&&this.config.events.forEach((t=>{const e=this.sceneManager.getInstrument(`vo:${t.key}`);e&&"stopped"!==e.player.state&&this.sceneManager.stop(`vo:${t.key}`,{fadeOut:.1})})),this.currentKey&&this.callback&&this.callback({key:this.currentKey,action:"stop"}),t.setCompleted&&(this.currentIndex=this.config.events.length)}reset(){this.currentIndex=0}triggerKey(t,e=0){if(t<this.config.events.length){const s=this.config.events[t],n=this.sceneManager.getInstrument(`vo:${s.key}`),i=(null==n?void 0:n.getDuration())||0;this.timeoutId=setTimeout((()=>{this.sceneManager.trigger(`vo:${s.key}`),this.currentKey=s.key,this.callback&&this.callback({key:s.key,action:"start"}),this.endTimeoutId=setTimeout((()=>{this.currentKey="",this.callback&&this.callback({key:s.key,action:"stop"})}),1e3*i-50),this.currentIndex=this.currentIndex+1,this.triggerKey(this.currentIndex,i)}),1e3*(s.timeout+e))}}}const m=new a({scenes:{generic:{name:"generic",sounds:[{name:"typing",sound:["typing","typing","typing"],bus:"ui",type:"roundRobin"},{name:"typingDelete",sound:"typingDelete",bus:"ui"},{name:"hoverGeneric",sound:"hoverGeneric",bus:"ui"},{name:"hoverExpand",sound:"hoverExpand",bus:"ui"},{name:"clickGeneric",sound:"clickGeneric",bus:"ui",gain:.7},{name:"clickEnter",sound:"clickEnter",bus:"ui"},{name:"textAppear1",sound:"textAppear",bus:"textBus"},{name:"textAppear2",sound:"textAppear",bus:"textBus"},{name:"textAppear3",sound:"textAppear",bus:"textBus"},{name:"textAppear4",sound:"textAppear",bus:"textBus"},{name:"textRolling",sound:"textRolling",bus:"launchScene",loop:!0},{name:"musicMenu",sound:"musicMenu",bus:"master",loop:!0,loopEnd:35.624},{name:"ambMenu",sound:"ambMenu",bus:"master",loop:!0},{name:"rocketOneshot",sound:"rocketOneshot",gain:.3,bus:"master"},{name:"satelliteOneshot",sound:"satelliteOneshot",bus:"master"},{name:"spacejunkOneshot",sound:"spacejunkOneshot",bus:"master"},{name:"transmissionOneshot",sound:"transmissionOneshot",bus:"master"},{name:"hotspotHover",sound:["hotspotHover","hotspotHover","hotspotHover"],type:"roundRobin",gain:1.4,bus:"ui"}]},main:{name:"main",sounds:[{name:"clickMap",sound:"clickMap",bus:"ui"},{name:"ambLaunchPad1",sound:"ambLaunchPad1",bus:"mainBus",loop:!0,loopEnd:4.714},{name:"rocketDeploy",sound:"rocketDeploy",bus:"mainBus",gain:.4221},{name:"rocketFlight",sound:"rocketFlight",gain:.35,bus:"mainBus",loop:!0},{name:"ambSpace",sound:"ambSpace",bus:"mainBus",loop:!0},{name:"rocketLaunch",sound:"rocketLaunch",bus:"mainBus",gain:.4221},{name:"ambLaunchPad2",sound:"ambLaunchPad2",bus:"mainBus",loop:!0},{name:"ambMap",sound:"ambMap",bus:"map",loop:!0},{name:"terminalOut",sound:"terminalOut",bus:"ui"},{name:"terminalIn",sound:"terminalIn",bus:"ui"},{name:"guardianNotification",sound:"guardianNotification",bus:"ui"},{name:"zoomIn",sound:"zoomIn",bus:"ui",gain:1.3},{name:"zoomOut",sound:"zoomOut",bus:"ui",gain:1.3},{name:"ctaClick",sound:"ctaClick",bus:"ui"}],bus:"master"},vo:{name:"vo",sounds:[{name:"launchPadIdle2",sound:"launchPadIdle2"},{name:"launchPadIdle8",sound:"launchPadIdle8"},{name:"launchPadIdle10",sound:"launchPadIdle10"},{name:"launchPadIdle9",sound:"launchPadIdle9"},{name:"launchPadIdle6",sound:"launchPadIdle6"},{name:"launchPadIdle7",sound:"launchPadIdle7"},{name:"launchPad4",sound:"launchPad4"},{name:"launchPad5",sound:"launchPad5"},{name:"launchPadIdleExtra5",sound:"launchPadIdleExtra5"},{name:"launchPadIdleExtra4",sound:"launchPadIdleExtra4"},{name:"launchPadIdleExtra3",sound:"launchPadIdleExtra3"},{name:"launchPadIdleExtra6",sound:"launchPadIdleExtra6"},{name:"launchPad2",sound:"launchPad2"},{name:"launchPadIdleExtra10",sound:"launchPadIdleExtra10"},{name:"launchPadIdleExtra8",sound:"launchPadIdleExtra8"},{name:"launchPadIdleExtra2",sound:"launchPadIdleExtra2"},{name:"launchPad1",sound:"launchPad1"},{name:"launchPadIdle3",sound:"launchPadIdle3"},{name:"launchPadIdle4",sound:"launchPadIdle4"},{name:"launchPadIdleExtra7",sound:"launchPadIdleExtra7"},{name:"launchSequence7",sound:"launchSequence7"},{name:"launchPad3",sound:"launchPad3"},{name:"satelliteDeployed4",sound:"satelliteDeployed4"},{name:"launchSequence4",sound:"launchSequence4"},{name:"launchPadIdle1",sound:"launchPadIdle1"},{name:"satelliteDeployed2",sound:"satelliteDeployed2"},{name:"launchSequence6",sound:"launchSequence6"},{name:"satelliteDeployed1",sound:"satelliteDeployed1"},{name:"launchSequence5",sound:"launchSequence5"},{name:"launchPadIdleExtra1",sound:"launchPadIdleExtra1"},{name:"satelliteDeployed5",sound:"satelliteDeployed5"},{name:"satelliteDeployed3",sound:"satelliteDeployed3"},{name:"satelliteDeployed6",sound:"satelliteDeployed6"},{name:"launchSequence2",sound:"launchSequence2"},{name:"launchSequence3",sound:"launchSequence3"},{name:"launchPadIdle5",sound:"launchPadIdle5"},{name:"launchPadIdleExtra9",sound:"launchPadIdleExtra9"},{name:"launchSequence1",sound:"launchSequence1"},{name:"clearToLaunchPoll6",sound:"clearToLaunchPoll6"},{name:"clearToLaunchPoll4",sound:"clearToLaunchPoll4"},{name:"clearToLaunchPoll5",sound:"clearToLaunchPoll5"},{name:"clearToLaunchPoll13",sound:"clearToLaunchPoll13"},{name:"clearToLaunchPoll7",sound:"clearToLaunchPoll7"},{name:"clearToLaunchPoll19",sound:"clearToLaunchPoll19"},{name:"clearToLaunchPoll15",sound:"clearToLaunchPoll15"},{name:"clearToLaunchPoll9",sound:"clearToLaunchPoll9"},{name:"clearToLaunchPoll23",sound:"clearToLaunchPoll23"},{name:"clearToLaunchPoll17",sound:"clearToLaunchPoll17"},{name:"clearToLaunchPoll21",sound:"clearToLaunchPoll21"},{name:"clearToLaunchPoll33",sound:"clearToLaunchPoll33"},{name:"clearToLaunchPoll27",sound:"clearToLaunchPoll27"},{name:"clearToLaunchPoll31",sound:"clearToLaunchPoll31"},{name:"clearToLaunchPoll25",sound:"clearToLaunchPoll25"},{name:"clearToLaunchPoll11",sound:"clearToLaunchPoll11"},{name:"clearToLaunchPoll2",sound:"clearToLaunchPoll2"},{name:"clearToLaunchPoll29",sound:"clearToLaunchPoll29"},{name:"clearToLaunchPoll3",sound:"clearToLaunchPoll3"},{name:"clearToLaunchPoll1",sound:"clearToLaunchPoll1"}],bus:"vo"}},sources:[{name:"typingDelete"},{name:"typing"},{name:"hoverGeneric"},{name:"hoverExpand"},{name:"clickGeneric"},{name:"clickEnter"},{name:"clickCard"},{name:"clickMap"},{name:"textAppear"},{name:"textRolling"},{name:"ambLaunchPad1"},{name:"ambMenu"},{name:"rocketDeploy"},{name:"rocketFlight"},{name:"ambSpace"},{name:"musicMenu"},{name:"rocketLaunch"},{name:"ambLaunchPad2"},{name:"ambMap"},{name:"terminalOut"},{name:"terminalIn"},{name:"hotspotHover"},{name:"guardianNotification"},{name:"zoomIn"},{name:"zoomOut"},{name:"ctaClick"},{name:"launchPadIdle2"},{name:"launchPadIdle8"},{name:"launchPadIdle10"},{name:"launchPadIdle9"},{name:"launchPadIdle6"},{name:"launchPadIdle7"},{name:"launchPad4"},{name:"launchPad5"},{name:"launchPadIdleExtra5"},{name:"launchPadIdleExtra4"},{name:"launchPadIdleExtra3"},{name:"launchPadIdleExtra6"},{name:"launchPad2"},{name:"launchPadIdleExtra10"},{name:"launchPadIdleExtra8"},{name:"launchPadIdleExtra2"},{name:"launchPad1"},{name:"launchPadIdle3"},{name:"launchPadIdle4"},{name:"launchPadIdleExtra7"},{name:"launchSequence7"},{name:"launchPad3"},{name:"satelliteDeployed4"},{name:"launchSequence4"},{name:"launchPadIdle1"},{name:"satelliteDeployed2"},{name:"launchSequence6"},{name:"satelliteDeployed1"},{name:"launchSequence5"},{name:"launchPadIdleExtra1"},{name:"satelliteDeployed5"},{name:"satelliteDeployed3"},{name:"satelliteDeployed6"},{name:"launchSequence2"},{name:"launchSequence3"},{name:"launchPadIdle5"},{name:"launchPadIdleExtra9"},{name:"launchSequence1"},{name:"mapInRed"},{name:"mapInSattelite"},{name:"clearToLaunchPoll6"},{name:"clearToLaunchPoll4"},{name:"clearToLaunchPoll5"},{name:"clearToLaunchPoll13"},{name:"clearToLaunchPoll7"},{name:"clearToLaunchPoll19"},{name:"clearToLaunchPoll15"},{name:"clearToLaunchPoll9"},{name:"clearToLaunchPoll23"},{name:"clearToLaunchPoll17"},{name:"clearToLaunchPoll21"},{name:"clearToLaunchPoll33"},{name:"clearToLaunchPoll27"},{name:"clearToLaunchPoll31"},{name:"clearToLaunchPoll25"},{name:"clearToLaunchPoll11"},{name:"clearToLaunchPoll2"},{name:"clearToLaunchPoll29"},{name:"clearToLaunchPoll3"},{name:"clearToLaunchPoll1"},{name:"mapInSatellite"},{name:"rocketOneshot"},{name:"satelliteOneshot"},{name:"spacejunkOneshot"},{name:"transmissionOneshot"}],busses:[{name:"out",parent:"$OUT",gain:1},{name:"video",parent:"out",gain:1},{name:"master",parent:"video",gain:1},{name:"ui",parent:"master",gain:.7879},{name:"launchScene",parent:"master",gain:1},{name:"map",parent:"launchScene",gain:1},{name:"vo",parent:"launchScene",gain:1},{name:"mainBus",parent:"launchScene",gain:1},{name:"textBus",parent:"ui",gain:.5}],basePath:"/audio/"}),g=[],_=["Incoming signal...","close"],y=.5,v=[],x=["loader","launchComplex","launchSequence","deploySatellite","deploySatelliteSequence","exploreSatellite"];let b,w=!0,T=0;const S={"generic:rocketOneshot":!1,"generic:satelliteOneshot":!1,"generic:spacejunkOneshot":!1,"generic:transmissionOneshot":!1},k=t=>{b&&b(t)};[{name:"launchPad",events:[{key:"launchPad1",timeout:3},{key:"launchPad2",timeout:0},{key:"launchPad3",timeout:0},{key:"launchPad4",timeout:0},{key:"launchPad5",timeout:0},{key:"launchPadIdle1",timeout:10},{key:"launchPadIdle2",timeout:0},{key:"launchPadIdle3",timeout:0},{key:"launchPadIdle4",timeout:0},{key:"launchPadIdle5",timeout:0},{key:"launchPadIdle6",timeout:0},{key:"launchPadIdle7",timeout:0},{key:"launchPadIdle8",timeout:0},{key:"launchPadIdle9",timeout:0},{key:"launchPadIdle10",timeout:0},{key:"launchPadIdleExtra1",timeout:10},{key:"launchPadIdleExtra2",timeout:0},{key:"launchPadIdleExtra3",timeout:0},{key:"launchPadIdleExtra4",timeout:0},{key:"launchPadIdleExtra5",timeout:0},{key:"launchPadIdleExtra6",timeout:0},{key:"launchPadIdleExtra7",timeout:0},{key:"launchPadIdleExtra8",timeout:0},{key:"launchPadIdleExtra9",timeout:0},{key:"launchPadIdleExtra10",timeout:0},{key:"clearToLaunchPoll1",timeout:10},{key:"clearToLaunchPoll2",timeout:0},{key:"clearToLaunchPoll3",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll5",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll7",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll9",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll11",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll13",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll15",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll17",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll19",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll21",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll23",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll25",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll27",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll29",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll31",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll33",timeout:0},{key:"clearToLaunchPoll6",timeout:0}]},{name:"launchSequence",events:[{key:"launchSequence1",timeout:0},{key:"launchSequence2",timeout:0},{key:"launchSequence3",timeout:0},{key:"launchSequence4",timeout:0},{key:"launchSequence5",timeout:0},{key:"launchSequence6",timeout:0},{key:"launchSequence7",timeout:0}]},{name:"satelliteDeployed",events:[{key:"satelliteDeployed1",timeout:0},{key:"satelliteDeployed2",timeout:0},{key:"satelliteDeployed3",timeout:0},{key:"satelliteDeployed4",timeout:0},{key:"satelliteDeployed5",timeout:0},{key:"satelliteDeployed6",timeout:0}]},{name:"launchPadIdle",events:[{key:"launchPadIdle1",timeout:0},{key:"launchPadIdle2",timeout:0},{key:"launchPadIdle3",timeout:0},{key:"launchPadIdle4",timeout:0},{key:"launchPadIdle5",timeout:0},{key:"launchPadIdle6",timeout:0},{key:"launchPadIdle7",timeout:0},{key:"launchPadIdle8",timeout:0},{key:"launchPadIdle9",timeout:0},{key:"launchPadIdle10",timeout:0}]},{name:"launchPadIdleExtra",events:[{key:"launchPadIdleExtra1",timeout:0},{key:"launchPadIdleExtra2",timeout:0},{key:"launchPadIdleExtra3",timeout:0},{key:"launchPadIdleExtra4",timeout:0},{key:"launchPadIdleExtra5",timeout:0},{key:"launchPadIdleExtra6",timeout:0},{key:"launchPadIdleExtra7",timeout:0},{key:"launchPadIdleExtra8",timeout:0},{key:"launchPadIdleExtra9",timeout:0},{key:"launchPadIdleExtra10",timeout:0}]}].forEach((t=>{const e=new f(t,m,k);v[t.name]=e}));const A=r({initialState:"loading",states:{loader:{actions:{onEnter:()=>{},onExit:()=>{}}},launchComplex:{actions:{onEnter:()=>{m.trigger("main:ambMap",{fadeIn:y}),m.trigger("main:ambLaunchPad1",{fadeIn:y}),m.trigger("main:ambLaunchPad2",{fadeIn:y}),v.launchPadIdle.stop(),v.launchPadIdleExtra.stop(),v.launchPad.start()},onExit:()=>{m.fadeOut("main:ambLaunchPad1",{fadeOut:y}),m.fadeOut("main:ambLaunchPad2",{fadeOut:y}),v.launchPad.stop(),m.stop("generic:textRolling")}}},launchSequence:{actions:{onEnter:()=>{m.trigger("main:rocketLaunch"),v.launchPadIdle.stop(),v.launchPadIdleExtra.stop(),v.launchSequence.reset(),v.launchSequence.start(),v.satelliteDeployed.reset(),m.setBusVolume("vo",1.5,.5)},onExit:t=>{m.fadeOut("main:rocketLaunch",{fadeOut:y});const e="deploySatellite"!==t;v.launchSequence.stop({stopImmediately:e}),m.setBusVolume("vo",1,.1),m.stop("generic:textRolling")}}},deploySatellite:{actions:{onEnter:t=>{let e=!1;"launchSequence"===t&&v.launchSequence.getCurrentIndex()<5&&(e=!0),v.launchSequence.stop({stopImmediately:e}),v.launchSequence.reset(),m.trigger("main:rocketFlight",{fadeIn:y})},onExit:()=>{m.fadeOut("main:rocketFlight",{fadeOut:y})}}},deploySatelliteSequence:{actions:{onEnter:()=>{m.trigger("main:rocketDeploy"),m.trigger("main:ambSpace",{fadeIn:y}),v.launchSequence.stop(),v.satelliteDeployed.start()},onExit:t=>{m.fadeOut("main:rocketDeploy",{fadeOut:y}),m.fadeOut("main:ambSpace",{fadeOut:y});const e="exploreSatellite"!==t;v.satelliteDeployed.stop({stopImmediately:e})}}},exploreSatellite:{actions:{onEnter:()=>{m.trigger("main:ambSpace",{fadeIn:y})},onExit:()=>{m.fadeOut("main:ambSpace",{fadeOut:y})}}},becomeAGuardian:{actions:{onEnter:t=>{m.trigger("generic:musicMenu",{fadeIn:y}),m.trigger("generic:ambMenu",{fadeIn:y}),"launchComplex"!==t&&"launchSequence"!==t||(m.fadeOut("main:ambLaunchPad1",{fadeOut:y}),m.fadeOut("main:ambLaunchPad2",{fadeOut:y})),"deploySatelliteSequence"!==t&&"exploreSatellite"!==t||(m.fadeOut("main:ambSpace",{fadeOut:y}),m.fadeOut("main:rocketFlight",{fadeOut:y}))},onExit:()=>{m.fadeOut("generic:musicMenu",{fadeOut:y}),m.fadeOut("generic:ambMenu",{fadeOut:y})}}},menu:{actions:{onEnter:t=>{m.trigger("generic:musicMenu",{fadeIn:y}),m.trigger("generic:ambMenu",{fadeIn:y}),"launchComplex"!==t&&"launchSequence"!==t||(m.fadeOut("main:ambLaunchPad1",{fadeOut:y}),m.fadeOut("main:ambLaunchPad2",{fadeOut:y})),"deploySatelliteSequence"!==t&&"exploreSatellite"!==t||(m.fadeOut("main:ambSpace",{fadeOut:y}),m.fadeOut("main:rocketFlight",{fadeOut:y}))},onExit:()=>{m.fadeOut("generic:musicMenu",{fadeOut:y}),m.fadeOut("generic:ambMenu",{fadeOut:y})}}},silent:{actions:{onEnter:()=>{},onExit:()=>{}}}}});return class extends class{constructor({initializingElement:t,onInit:e,sceneManager:s,appFSM:n}){u(this,"initializingElement"),u(this,"onInit"),u(this,"appFSM"),u(this,"sceneManager"),this.initializingElement=t||window,this.init=this.init.bind(this),this.onInit=e,this.sceneManager=s,this.appFSM=n}init(){return d(this,null,(function*(){if(this.sceneManager)try{yield this.sceneManager.initAudio(),this.initializingElement.removeEventListener("touchend",this.init),this.initializingElement.removeEventListener("mousedown",this.init),p.setMuteOnBlur("out",.3,this.sceneManager)}catch(t){console.warn(t,"could not initialize audio")}}))}initAudio(){return d(this,null,(function*(){this.sceneManager.audioIsInitialized||(this.sceneManager.initAudio(),this.initializingElement.addEventListener("touchend",this.init),this.initializingElement.addEventListener("mousedown",this.init)),this.onInit&&(yield this.onInit())}))}setMute(t){this.sceneManager.setBusMute("master",t)}setBlurMute(t){this.sceneManager.setBusMute("out",t)}disableBlurMute(t){this.sceneManager.disableBlur=t}changeScene(t){var e;null==(e=this.appFSM)||e.transition(t)}trigger(t,e){if(this.sceneManager.audioIsInitialized){if(!t.match(":"))return void this.sceneManager.triggerForScene(t,e);this.sceneManager.trigger(t,e)}}triggerForScene(t,e){this.sceneManager.audioIsInitialized&&this.sceneManager.triggerForScene(t,e)}stopForScene(t,e){this.sceneManager.audioIsInitialized&&this.sceneManager.stopForScene(t,e)}stop(t,e){this.sceneManager.audioIsInitialized&&this.sceneManager.stop(t,e)}}{constructor(){super({initializingElement:window,onInit:()=>{const t=[m.loadScene("generic")];return Promise.all(t).then((()=>{this.setupTextScramble()}))},appFSM:A,sceneManager:m})}initHomePage(){const t=[m.loadScene("main",!0),m.loadScene("vo")];return m.getBus("map").setGain(0,1),Promise.all(t)}setupTextScramble(){return d(this,null,(function*(){g.push({text:"",time:0,instrument:m.getInstrument("generic:textAppear1")},{text:"",time:0,instrument:m.getInstrument("generic:textAppear2")})}))}getVoice(t,e=!1){let s=g.find((e=>e.text===t));if(!s){let t=g[0];g.reduce((function(t,s){let n=t.time<s.time?t:s;return e&&(n=t.time>s.time?t:s),n}),t),s=t}return s}changeScene(t){var e;return null==(e=this.appFSM)||e.transition(t),this.appFSM.stash||Promise.resolve()}setIsMapOpen(t){m.getBus("map").setGain(t?1:0,1),m.getBus("mainBus").setGain(t?0:1,1),this.trigger(t?"mapIn":"mapOut")}textScramble(t,e){if(t=t||"",!_.includes(t)&&this.sceneManager.audioIsInitialized){const s=this.getVoice(t);s&&(s.text=t,s.time=a.now()+(e||0),this.stopText(s),w&&s.instrument.play({options:{when:e||0}}))}}stopText(t){t&&t.instrument.fadeOut(0,0,(()=>{t.instrument.stop({})}))}stopTextScramble(t){if(t=t||"",!_.includes(t)&&this.sceneManager.audioIsInitialized){let e;e=t?g.find((e=>e.text===t)):this.getVoice("",!0),this.stopText(e)}}handleVoice(t,e){const s=`vo:${t.name}_${e}`.replace(/\s+/g,"_").replace(/\.+/g,"").toLowerCase();this.trigger(s)}setVOCallback(t){b=t}setVideoPlaying(t){this.sceneManager.setBusMute("video",t)}startTextRolling(){var t;x.includes(null==(t=this.appFSM)?void 0:t.value)&&this.trigger("generic:textRolling")}stopTextRolling(){this.stop("generic:textRolling")}setCapabilitiesScrollValue(t){var e,s,n,i;switch(T){case 0:if(t>800&&t<1700){const t="generic:spacejunkOneshot",s=this.sceneManager.getInstrument(t);"stopped"!==(null==(e=null==s?void 0:s.player)?void 0:e.state)||S[t]||(this.trigger(t),S[t]=!0)}else if(t>1700){const t="generic:satelliteOneshot",e=this.sceneManager.getInstrument(t);"stopped"!==(null==(s=null==e?void 0:e.player)?void 0:s.state)||S[t]||(this.trigger(t),S[t]=!0)}break;case 1:if(t>500){const t="generic:transmissionOneshot",e=this.sceneManager.getInstrument(t);"stopped"!==(null==(n=null==e?void 0:e.player)?void 0:n.state)||S[t]||(this.trigger(t),S[t]=!0)}break;case 2:if(t>500){const t="generic:rocketOneshot",e=this.sceneManager.getInstrument(t);"stopped"!==(null==(i=null==e?void 0:e.player)?void 0:i.state)||S[t]||(this.trigger(t),S[t]=!0)}}}setCapabilitiesStage(t){T=t}onPreloaderChange(t){if(w=t,t)for(const[e,s]of Object.entries(S))S[e]=!1}showGuardians(){m.setBusVolume("launchScene",.1,.5)}hideGuardians(){m.setBusVolume("launchScene",1,.5)}}}()}}]);