var Sl=Object.defineProperty;var $l=(e,t,s)=>t in e?Sl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var se=(e,t,s)=>($l(e,typeof t!="symbol"?t+"":t,s),s);import{o as I,c as B,F as ze,p as it,a as ot,b as E,d as tr,e as ie,n as G,f as Te,w as wt,T as zs,g as N,u as F,t as Ie,h as Ae,i as sr,r as Z,j as xe,k as Xe,l as Ke,m as Q,s as ae,q as pe,v as zt,x as Pe,y as Qe,z as He,A as ts,B as os,C as Tn,D as Ml,E as is,G as Cl,H as kl,I as nr,J as eo,K as Tl,L as En,R as El,M as Pl,N as as,O as to,P as yt,Q as Ll,S as So,U as Al,V as Ol,W as Pn,X as Rl,Y as Dl,Z as Il,_ as $o,$ as so,a0 as Ni,a1 as Mo,a2 as Co,a3 as zl,a4 as Fl,a5 as Ul,a6 as Nl,a7 as Bl,a8 as ir,a9 as Dt,aa as H,ab as or,ac as Vl,ad as Bi,ae as bt,af as As,ag as ar,ah as rr,ai as lr,aj as cs,ak as tt,al as te,am as ko,an as be,ao as V,ap as X,aq as he,ar as Zl,as as jl,at as Hl,au as cr,av as ur,aw as Hs,ax as no,ay as Gl,az as Wl,aA as ql,aB as Yl,aC as Kl,aD as Vi,aE as Zi,aF as Zn,aG as Ln,aH as Xl,aI as Ql,aJ as Jl,aK as ec,aL as tc,aM as Ee,aN as sc,aO as nc,aP as dr,aQ as k,aR as ye,aS as Ye,aT as J,aU as fe,aV as Lt,aW as _n,aX as ji,aY as hr,aZ as W,a_ as ic,a$ as Le,b0 as oc,b1 as we,b2 as ne,b3 as Re,b4 as It,b5 as Oe,b6 as Fe,b7 as Ce,b8 as ac,b9 as An,ba as Ts,bb as fr,bc as On,bd as io,be as rc,bf as lc,bg as Rn,bh as oo,bi as Fs,bj as Us,bk as pr,bl as Ot,bm as mr,bn as us,bo as cc,bp as ao,bq as uc,br as dc,bs as hc,bt as fc,bu as To,bv as pc,bw as mc,bx as Dn,by as Ns,bz as In,bA as gr,bB as zn,bC as gc,bD as vr,bE as vc,bF as _c,bG as Ve,bH as yc,bI as bc,bJ as xc,bK as _r,bL as Eo,bM as ro,bN as wc,bO as yr,bP as Sc,bQ as $c,bR as Nt,bS as Hi,bT as br,bU as Mc,bV as Cc,bW as Ct,bX as kc,bY as Tc,bZ as Po,b_ as Ec,b$ as Pc,c0 as je,c1 as yn}from"./vendors/vendors.a233fc08.js";import{_ as jn}from"./experience.js";let xr={};function Lc(e){xr=e.config.globalProperties}const M=new Proxy({},{get:(e,t)=>xr[t]});const q=(e,t)=>{const s=e.__vccOpts||e;for(const[i,n]of t)s[i]=n;return s},Ac=e=>(it("data-v-a27aad1a"),e=e(),ot(),e),Oc=Ac(()=>E("svg",{"aria-hidden":"true",focusable:"false",class:"hidden"},[E("symbol",{id:"copy",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 8 11"},[E("path",{d:"M4.7 4.2c-.5 0-1 .2-1.4.6l-.1.1c-.1.1 0 .2 0 .3 0 0 .1.1.2.1s.1 0 .2-.1c.3-.3.7-.5 1.1-.5.4 0 .8.2 1.1.4l.1-.1v.1c.3.3.5.7.5 1.1 0 .4-.2.8-.5 1.1L4 9.2c-.6.6-1.6.6-2.2 0v.1l.1-.1c-.4-.3-.5-.7-.5-1.1 0-.4.2-.8.5-1.1l.8-.8c.1-.1.1-.2 0-.3-.1-.1-.2-.1-.3 0l-.9.7c-.4.4-.6.9-.6 1.5 0 .5.2 1.1.6 1.5.4.4.9.6 1.4.6.5 0 1.1-.2 1.4-.6l1.8-1.8c.4-.4.6-.9.6-1.5s-.2-1.1-.6-1.5c-.4-.3-.9-.6-1.4-.6z"}),E("path",{d:"M7.4.9C6.6.1 5.3.1 4.6.9L2.8 2.7c-.4.4-.6.9-.6 1.5s.2 1.1.6 1.5c.3.3.9.5 1.4.5.5 0 1.1-.2 1.4-.6.1-.1.1-.2 0-.3-.1-.1-.2-.1-.3 0-.3.3-.7.5-1.1.5-.4 0-.8-.2-1.1-.5-.3-.3-.5-.7-.5-1.1 0-.4.2-.8.5-1.1l1.8-1.8C5.1 1 5.5.8 6 .8c.4 0 .8.2 1.1.4l.1-.1v.1c.6.6.6 1.6 0 2.3l-.9.9c-.1.1-.1.2 0 .3.1.1.2.1.3 0l.8-.8c.8-.9.8-2.1 0-3z"})]),E("symbol",{id:"cartier",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 86 24",fill:"#fff"},[E("path",{d:"M59.71 9.39c.59 0 1.06-.47 1.06-1.06 0-.59-.47-1.06-1.06-1.06-.59 0-1.06.47-1.06 1.06 0 .59.47 1.06 1.06 1.06Z"}),E("path",{d:"M83.78 11.86c-1.64-.04-4.83 2.53-5.21 2.93l1.67-2.86h-2.52c-3.24 5.48-9.99 10.82-13 10.93-2.71.2-2.91-1.74-2.01-4.04v.02c3.85.4 10.6-3.56 8.48-6.49-1.82-1.82-6.7.09-9.81 4.24l-.22.33-.47.68c-1.1 1.47-3.36 3.59-3.36 3.59-2.91 2.86-4.22 1.19-3-.88l4.8-8.32h-2.16c-.59.81-3.51 6.15-8.23 9.49-2.68 2.05-4.76 1.17-2.89-1.49l4.69-8 2.61-.02.34-.36h-2.68l2.84-4.96h-2.37c-1.26 2.14-4.21 7.12-7.15 8.38.52-.7.34-1.64.34-1.64-.22-1.08-1.42-1.18-1.42-1.18s-1.71-.25-3.65 1.47l1.04-1.73h-2.39c-2.09 3.7-7.62 11.57-10.64 10.82-.81-.36-.86-1.38-.02-2.77l4.78-8.09H29.8c-.32.49-1.29 2.34-1.28 2.3.09-.48.22-2.35-1.62-2.73-.36-.08-.73-.12-1.1-.11-2.03-.02-4.08 1.04-6.09 2.82-1.42 1.26-2.77 2.93-3.9 5.01-4.87 4.47-9.87 4.73-11.5 3.05-1.73-1.78-2.41-5.43.79-11.57C6.23 9.08 10.44 2.14 16.5.55c4.53-1.2 6.36 1.35 6.52 4.31 0 0 1.36-2.57 2.91-4.17-.95.39-3.04.88-4.01.29C18.99-.89 13.35-.6 6.12 6.12c-6.19 6.3-10.6 18.52 1.7 17.57 4.35-.54 8-4.01 8-4.01-.58 2.1.36 3.68 2.16 4.01.67.12 1.6-.05 2.39-.36.67-.27 2.07-.84 3.9-2.28-.57 2.3 2.99 5.73 9.55-2.37l-3.04 4.87 2.77-.02s4.62-8.16 5.46-8.98c1.8-2.39 5.1-2.84 5.05-1.17-.36-.18-.68-.23-.95-.18-.79.12-1.15 1.11-.99 1.8.09.23.22.47.59.65 0 0 1.55 1.08 5.27-3.58l-.54.95s-3.76 6.47-4.24 7.38c-1.91 3.65 2.61 3.99 5.3 1.67 0 0 2.19-1.62 4.69-4.35l-.09.18c-1.29 2.32-2.72 4.69-.88 5.71.52.23 1.94.4 3.7-.84 0 0 2.82-2.32 4.31-4.2-.63 1.46-1.21 3.85 1.35 4.92 1.44.45 2.61.16 4.04-.32 4.51-1.47 10.28-8.09 10.28-8.09s-4.89 8.12-5.05 8.43l2.48-.02s3.52-5.97 4.24-6.97c1.92-3.02 6.09-5.09 6.53-4.04-1.55-.31-1.92 1.98-.7 2.44 1.9.74 3-2.91.38-3.06Zm-14.98.17c.67.07.99.41.92 1.35-.22 2.01-3.16 5.3-6.94 5.19 1.31-3.09 4.44-6.69 6.02-6.54ZM23.45 21.2c-.72.61-1.6 1.1-1.6 1.1-3.61 1.82-4.42-.16-4.03-2 .34-1.58 1.74-3.9 2.89-5.32 1.04-1.17 2.14-2.07 3.54-2.75 3-1.48 4.83.38 3.59 3-.83 1.73-2.16 4.04-4.4 5.97h.01Z"})]),E("symbol",{id:"fadeCircle",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 72 72"},[E("circle",{cx:"36",cy:"36",r:"35.5",stroke:"url(#circleGradient)","vector-effect":"non-scaling-stroke"})]),E("symbol",{id:"tutoClick",xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 397 102"},[E("path",{d:"M383.5 6.5c-1.7-3.3-5.1-5.3-8.8-5.3h-353c-3.7 0-7.1 2-8.8 5.3l-6 11.3c-.8 1.4-1.2 3.1-1.2 4.7v68.8c0 2.7 1.1 5.2 2.9 7.1s4.4 2.9 7.1 2.9h365c2.7 0 5.2-1.1 7.1-2.9s2.9-4.4 2.9-7.1V22.4c0-.7 0-1.8-7.2-15.9zM18.2 11.1c0-2.8 2.2-5 5-5h350c1.3 0 2.6.5 3.5 1.5s1.5 2.2 1.5 3.5v60c0 1.3-.5 2.6-1.5 3.5-.9.9-2.2 1.5-3.5 1.5h-350c-2.8 0-5-2.2-5-5v-60z"}),E("path",{d:"M229.5 14.6H167c-1.4 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5H229.6c1.4 0 2.5-1.1 2.5-2.5s-1.3-2.5-2.6-2.5z"})]),E("symbol",{id:"tutoTouch",xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 28"},[E("path",{d:"M6.485 4.011a.308.308 0 0 0 .301.22c.028 0 .069 0 .096-.014a.327.327 0 0 0 .205-.41L5.91.22A.327.327 0 0 0 5.5.015a.327.327 0 0 0-.205.411l1.19 3.585Zm3.462.356a.276.276 0 0 0 .15.041.32.32 0 0 0 .288-.178l1.67-3.298a.33.33 0 0 0-.138-.438.33.33 0 0 0-.438.137L9.81 3.93a.308.308 0 0 0 .138.438Zm2.066 2.327a.308.308 0 0 0 .301.218c.028 0 .069 0 .096-.013l3.462-1.136a.327.327 0 0 0 .206-.41.327.327 0 0 0-.41-.206l-3.463 1.136a.338.338 0 0 0-.192.41Zm-7.594 2.49a.327.327 0 0 0-.411-.205l-3.64 1.19a.327.327 0 0 0-.205.41.308.308 0 0 0 .3.22c.028 0 .07 0 .097-.014l3.64-1.19a.33.33 0 0 0 .219-.41ZM.792 4.627l3.421 1.724a.276.276 0 0 0 .15.041.32.32 0 0 0 .288-.178.33.33 0 0 0-.137-.437l-3.42-1.725a.33.33 0 0 0-.439.137.308.308 0 0 0 .137.438Zm22.552 13.137-1.779-5.432c-.3-.931-1.218-1.52-2.12-1.369a1.881 1.881 0 0 0-1.342.89c-.014.027-.04.054-.055.082-.396-.684-1.176-1.095-1.943-.972a1.881 1.881 0 0 0-1.34.89.286.286 0 0 1-.056.082c-.396-.698-1.176-1.095-1.943-.972a1.881 1.881 0 0 0-1.34.89c0 .013-.015.027-.015.027L9.975 7.515c-.301-.93-1.218-1.52-2.122-1.369a1.881 1.881 0 0 0-1.34.89 1.959 1.959 0 0 0-.192 1.587L9.81 19.27l-1.766-1.328c-1.341-.971-2.6-1.122-3.859-.438a1.125 1.125 0 0 0-.233 1.807l7.089 6.746A7.66 7.66 0 0 0 16.146 28c.288 0 .575-.013.862-.055 2.19-.246 4.12-1.395 5.406-3.215 1.382-1.93 1.724-4.544.93-6.966Zm-1.45 6.61a6.97 6.97 0 0 1-4.954 2.942 7 7 0 0 1-5.447-1.738l-7.088-6.746a.528.528 0 0 1-.15-.425.49.49 0 0 1 .232-.355 2.566 2.566 0 0 1 1.26-.342c.615 0 1.244.246 1.901.725l2.587 1.943c.109.082.26.082.383 0a.333.333 0 0 0 .123-.356L6.937 8.404A1.292 1.292 0 0 1 7.06 7.35c.191-.314.52-.533.89-.588.601-.096 1.203.315 1.409.944l1.874 5.707v.013l.986 3.025c.055.164.232.26.41.205a.327.327 0 0 0 .206-.41l-1-3.039a1.26 1.26 0 0 1 .124-1.04c.191-.314.52-.533.89-.588.601-.096 1.204.315 1.409.93l1.286 3.914c.055.164.233.26.41.206a.327.327 0 0 0 .206-.411l-.985-2.997a1.292 1.292 0 0 1 .123-1.054c.191-.314.52-.533.89-.588.601-.096 1.204.315 1.409.93l1.272 3.873c.055.164.233.26.411.205a.327.327 0 0 0 .205-.41l-.971-2.97a1.292 1.292 0 0 1 .123-1.053c.191-.315.52-.534.89-.589.601-.095 1.203.315 1.409.944l1.779 5.433c.752 2.258.438 4.653-.821 6.432Z"})]),E("symbol",{id:"diamond",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 17 15"},[E("path",{d:"M2.281.021H14.67l.07.139 1.83 3.66.07.139-.095.124-8.052 10.615-.204.268-.198-.273L.403 4.078l-.089-.122.068-.136L2.212.16l.07-.139Zm.31.5-1.58 3.16H4.83L6.094.522H2.59Zm8.992 3.16H5.368L6.632.522h3.687l1.264 3.16Zm.539 0h3.818L14.36.522h-3.502l1.264 3.16Zm-7.305.5H1.096l6.691 9.242-2.97-9.241Zm.525 0 2.964 9.22 3.292-9.22H5.342Zm10.5 0-7.015 9.247 3.302-9.246h3.713Z","fill-rule":"evenodd","clip-rule":"evenodd"})]),E("symbol",{id:"star",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 25",fill:"currentColor"},[E("path",{d:"m12.7 2 2.2 8.3 8.3 2.2-8.3 2.2-2.2 8.3-2.2-8.3-8.3-2.2 8.3-2.2L12.7 2z"})]),E("symbol",{id:"circle",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[E("circle",{cx:"10",cy:"10",r:"9.5",stroke:"currentColor"})]),E("symbol",{id:"rotateArrow",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 53 16"},[E("path",{d:"M2.14 13.922c.421 0 .842-.126 1.214-.388C10.193 8.691 18.26 6.132 26.68 6.132c8.228 0 16.144 2.455 22.895 7.101a2.096 2.096 0 0 0 2.919-.54 2.099 2.099 0 0 0-.541-2.92c-7.451-5.128-16.192-7.84-25.274-7.84C17.386 1.934 8.48 4.76.92 10.113a2.095 2.095 0 0 0-.497 2.925c.41.579 1.055.885 1.717.885Z"}),E("path",{d:"M11.725 15.78c.984 0 1.864-.694 2.061-1.7a2.101 2.101 0 0 0-1.662-2.46L2.541 9.76a2.097 2.097 0 0 0-2.46 1.662 2.101 2.101 0 0 0 1.662 2.46l9.583 1.859a2 2 0 0 0 .4.038h-.001Z"}),E("path",{d:"M2.142 13.923a2.1 2.1 0 0 0 2.044-1.624l2.165-9.304A2.096 2.096 0 0 0 4.782.475a2.092 2.092 0 0 0-2.52 1.569L.097 11.348a2.096 2.096 0 0 0 2.045 2.575Z"})]),E("symbol",{id:"rotateMobile",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 93 55"},[E("path",{d:"M83.821 54.363h-73.8c-5.057 0-9.173-4.111-9.173-9.174V9.224C.848 4.167 4.964.051 10.02.051h73.806C88.884.05 93 4.167 93 9.224v35.965c-.005 5.063-4.122 9.174-9.178 9.174Zm-73.8-50.109a4.979 4.979 0 0 0-4.975 4.975v35.965a4.979 4.979 0 0 0 4.975 4.975h73.806a4.979 4.979 0 0 0 4.975-4.975V9.23a4.979 4.979 0 0 0-4.975-4.975H10.021Z"}),E("path",{d:"M14.672 34.064c-3.778 0-6.856-3.077-6.856-6.855 0-3.777 3.073-6.85 6.856-6.85 3.777 0 6.855 3.073 6.855 6.85 0 3.778-3.078 6.855-6.855 6.855Zm0-9.512a2.658 2.658 0 0 0-2.657 2.652 2.66 2.66 0 0 0 2.657 2.656 2.66 2.66 0 0 0 2.656-2.656 2.658 2.658 0 0 0-2.656-2.652Zm67.333 7.172a2.1 2.1 0 0 1-2.099-2.1v-11.2a2.1 2.1 0 0 1 4.199 0v11.2a2.1 2.1 0 0 1-2.1 2.1Zm0 6.381a2.1 2.1 0 0 1-2.099-2.099v-.672a2.1 2.1 0 0 1 4.199 0v.672a2.1 2.1 0 0 1-2.1 2.1Z"})]),E("symbol",{id:"lock",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 14 20"},[E("path",{d:"M10.764 8.35a.26.26 0 0 0 .057-.158V3.45C10.821 1.58 9.166 0 7.206 0h-.73c-1.96 0-3.615 1.58-3.615 3.45v4.742c0 .06.023.113.057.157a6.259 6.259 0 0 0-2.346 4.885 6.276 6.276 0 0 0 6.269 6.269 6.276 6.276 0 0 0 6.269-6.27 6.259 6.259 0 0 0-2.346-4.883Zm-7.372-4.9c0-1.583 1.412-2.92 3.084-2.92h.73c1.672 0 3.084 1.337 3.084 2.92v4.553a6.232 6.232 0 0 0-3.45-1.038c-1.273 0-2.458.383-3.448 1.038V3.45ZM6.84 18.971a5.744 5.744 0 0 1-5.738-5.738A5.745 5.745 0 0 1 6.84 7.496a5.745 5.745 0 0 1 5.738 5.738 5.744 5.744 0 0 1-5.738 5.738Z"}),E("path",{d:"M6.841 11.344c-.805 0-1.46.655-1.46 1.46 0 .496.251.949.664 1.217v1.038a.797.797 0 0 0 1.592 0V14.02c.413-.268.664-.721.664-1.218 0-.804-.655-1.46-1.46-1.46Zm.412 2.286a.266.266 0 0 0-.146.238v1.19a.266.266 0 0 1-.266.266.266.266 0 0 1-.265-.265v-1.191a.266.266 0 0 0-.147-.238.922.922 0 0 1-.517-.827.93.93 0 0 1 1.858 0c0 .35-.198.668-.517.827Z"})]),E("symbol",{id:"check",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 13 10"},[E("path",{stroke:"url(#checkGradient)",d:"M1 5.5 4.667 9 12.5 1"})])],-1)),Rc={"aria-hidden":"true",focusable:"false",style:{position:"absolute",width:"0",height:"0"}},Dc=tr('<linearGradient id="circleGradient" x1="15.429" x2="36" y1="-16.531" y2="42.98" gradientUnits="userSpaceOnUse" data-v-a27aad1a><stop stop-color="#fff" data-v-a27aad1a></stop><stop offset="1" stop-color="#fff" stop-opacity="0" data-v-a27aad1a></stop></linearGradient><linearGradient id="checkGradient" x1="-10.5" x2="60.864" y1="9.385" y2="-17.282" gradientUnits="userSpaceOnUse" data-v-a27aad1a><stop data-v-a27aad1a></stop><stop offset="0" stop-color="#fff" data-v-a27aad1a></stop><stop offset="1" stop-color="#fff" stop-opacity="0" data-v-a27aad1a></stop></linearGradient>',2),Ic=[Dc],zc={__name:"Icons",setup(e){return(t,s)=>(I(),B(ze,null,[Oc,(I(),B("svg",Rc,Ic))],64))}},Fc=q(zc,[["__scopeId","data-v-a27aad1a"]]);const Uc={__name:"Overlay",setup(e){const t=ie(()=>M.$store.isOverlayVisible||M.$store.isHeaderOpen);function s(){M.$store.isHeaderOpen=!1}return(i,n)=>(I(),B("div",{class:G(["overlay",{"is-visible":t.value||i.$store.isRegisterOpen,"is-form":i.$store.isRegisterOpen}]),"allow-touch-event":"",onClick:s},null,2))}},Nc=q(Uc,[["__scopeId","data-v-b4dcb93b"]]);const Bc=["href"],Vc={__name:"SvgIcon",props:{name:{type:String,default:null}},setup(e){const t=e;return(s,i)=>(I(),B("svg",{class:G(["icon",`icon-${t.name}`])},[E("use",{href:`#${t.name}`},null,8,Bc)],2))}},Ge=q(Vc,[["__scopeId","data-v-cc53b3bf"]]);const Zc={key:0,"allow-touch-event":"",class:"tutorial-notif"},jc={class:"tutorial-content"},Hc={class:"tutorial-icon"},Gc={class:"icon-action"},Wc=["textContent"],qc={__name:"Tutorial",setup(e){const t=M.$device.hasTouch?"tutoTouch":"tutoClick",s=ie(()=>M.$preloader.finished&&M.$store.isTutorialVisible);return(i,n)=>(I(),Te(zs,{duration:{enter:1500,leave:1500},appear:""},{default:wt(()=>[s.value?(I(),B("aside",Zc,[E("div",jc,[E("div",Hc,[N(Ge,{name:"fadeCircle"}),E("div",Gc,[N(Ge,{name:F(t)},null,8,["name"])])]),E("p",{class:"tutorial-text",textContent:Ie(F(M).$device.hasTouch?"":i.$l("TUTORIAL-one-desktop-alt-a"))},null,8,Wc)])])):Ae("",!0)]),_:1}))}},Yc=q(qc,[["__scopeId","data-v-a2bd4fcf"]]),rs=e=>(e==null&&(e=""),e.replace(/(^|[ >])([^ ><]+)?/gi,(s,i,n)=>{let o=i;if(n!==void 0){let a="";for(let r=0,l=n.length;r<l;r++){const c=n[r];c===" "||c==="Â "||c==="&nbsp;"?a+=c:a+='<span class="char">'+n[r]+"</span>"}o+='<span class="word">'+a+"</span>"}return o}));const Kc=["innerHTML"],Xc=["innerHTML"],Qc={__name:"RevealText",props:{text:{type:String,default:null},hoverable:{type:Boolean,default:!0},appear:{type:Boolean,default:!0},appearDelay:{type:String,default:"0s"},duration:{type:Number,default:.75}},setup(e,{expose:t}){const s=e;sr(p=>({"02776133":l.value,"0566e129":e.appearDelay}));const i=Z(),n=Z(),o=Z(),a=Z(!1),r=M.$l("ligation")?s.text:rs(s.text),l=ie(()=>`${s.duration}s`);let c=[];xe(()=>{M.$l("ligation")||(d(n.value),d(o.value))}),Xe(b);function u(){a.value=!0,s.hoverable&&f()}function h(){a.value=!1}function d(p){const m=p.querySelectorAll(".char");if(m.length){for(let g=0;g<m.length;g++){const y=m[g];y.style.setProperty("--i",g+1),c.push(y)}c[c.length-1].addEventListener("animationend",b)}}function f(){i.value&&i.value.classList.add("is-animating")}function b(){i.value&&i.value.classList.remove("is-animating")}return t({animate:f}),(p,m)=>(I(),B("span",{ref_key:"$$wrapper",ref:i,class:G(["wrapper",{"is-hoverable":s.hoverable,appear:s.appear}]),onMouseenter:u,onMouseleave:h},[E("span",{ref_key:"$$originalText",ref:n,class:"text",innerHTML:F(r)},null,8,Kc),E("span",{ref_key:"$$twinText",ref:o,class:"twin-text",innerHTML:F(r)},null,8,Xc)],34))}},ds=q(Qc,[["__scopeId","data-v-54c34f6d"]]);const wr=e=>(it("data-v-c314c0cd"),e=e(),ot(),e),Jc={class:"notification"},eu=wr(()=>E("span",{class:"explode"},null,-1)),tu={class:"circle"},su=wr(()=>E("span",{class:"red-circle"},null,-1)),nu={__name:"HeaderDiscoveryNotif",setup(e){return(t,s)=>(I(),B("span",Jc,[eu,E("span",tu,[N(Ge,{name:"circle"})]),su]))}},iu=q(nu,[["__scopeId","data-v-c314c0cd"]]);const ou={class:"stars"},au={__name:"HeaderDiscoveryBadge",setup(e,{expose:t}){const s=Z(),i=Z(!1);function n(){if(!s.value)return;s.value.classList.add("is-animating");const a=setTimeout(()=>{clearTimeout(a),i.value||o()},900)}function o(){s.value&&s.value.classList.remove("is-animating")}return t({animate:n}),(a,r)=>(I(),B("span",{ref_key:"wrapper",ref:s,class:"discovery-indicator"},[N(Ge,{name:"diamond"}),E("span",ou,[(I(),B(ze,null,Ke(3,l=>N(Ge,{key:l,name:"star",class:G(["star-"+l])},null,8,["class"])),64))]),N(zs,{name:"notification",appear:"",duration:{enter:2500,leave:1e3}},{default:wt(()=>[a.$store.hasNotification?(I(),Te(iu,{key:0})):Ae("",!0)]),_:1})],512))}},ru=q(au,[["__scopeId","data-v-54985273"]]);const lu=e=>(it("data-v-c4a804e2"),e=e(),ot(),e),cu={class:"header-discovery"},uu=["aria-label"],du=lu(()=>E("span",{class:"line"},null,-1)),hu={__name:"HeaderDiscoveryButton",setup(e){const t=Z(),s=Z();function i(o){o==null||o.target.blur(),M.$store.isPanelOpen=!0}async function n(){t.value.animate(),await Q(100),s.value.animate()}return(o,a)=>(I(),B("div",cu,[E("button",{class:"discovery-btn panel-button","aria-label":o.$l("DISCOVERY-title"),onClick:i,onMouseenter:n},[N(ru,{ref_key:"badge",ref:t},null,512),E("span",{class:G(["discovery-text",{bypassSystemFont:F(M).$i18n.locale==="ja_jp"}])},[N(ds,{ref_key:"discovery",ref:s,text:o.$l("DISCOVERY-title"),hoverable:!1,duration:1},null,8,["text"]),du],2)],40,uu)]))}},fu=q(hu,[["__scopeId","data-v-c4a804e2"]]),Lo=()=>{};function ct(e,t=Lo,{enabled:s=!0,once:i=!0}={}){const{keys:n}=M.$controls.keyboard,o=ae(s);if(Array.isArray(e)){let c=!0;for(let u=0;u<e.length;u++)n[e[u]]!==void 0&&(c=!1);if(c)return!1}let a=Lo;Array.isArray(e)?a=pe(()=>new Array(e.length).fill().map((c,u)=>n[e[u]]),c=>{o.value&&(t(e,c),i&&a())},{deep:!0}):a=pe(()=>n[e],c=>{o.value&&(t(e,c),i&&a())}),zt()&&Xe(a);function r(){o.value=!0}function l(){o.value=!1}return{unwatch:a,enable:r,disable:l}}function pu(e){const t=[],s=[],i=e.mount.bind(e);e.mount=a.bind(e),e.onBeforeMount=n,e.onAfterMount=o;function n(r,l){l?t.unshift(r):t.push(r)}function o(r,l){l?s.unshift(r):s.push(r)}async function a(r,l){for(const c of t)await c(e);i(r,l);for(const c of s)await c(e);s.length=t.length=0}}const mu=e=>e;function gu(e,t=Qe){const s={};for(const i in e)typeof e[i]=="function"?s[i]=Pe(e[i]):s[i]=e[i];return t(s)}function Gi(e,t,s){let i=mu;return xe(()=>i=e&&!t&&!s?e():pe(e,t,s)),Xe(i),i}const vu=e=>(it("data-v-939fba87"),e=e(),ot(),e),_u=["aria-label"],yu={class:"header-menu-text"},bu=vu(()=>E("span",{class:"line"},null,-1)),xu={__name:"HeaderMenuButton",setup(e){const{$store:t,$controls:{keyboard:s}}=M,i=Z();ct("Escape",a,{once:!1});const n=ie(()=>t.isMenuOpen?M.$l("ARIA-close"):"");function o(l){return l==null||l.target.blur(),t.isRegisterOpen?t.isRegisterOpen=!1:t.isAboutOpen?t.isAboutOpen=!1:t.isMenuOpen?t.isMenuOpen=!1:t.isMenuOpen=!0}function a(l){setTimeout(()=>{!t.isHeaderOpen&&!t.isPanelOpen&&!t.isAboutOpen&&!t.isRegisterOpen&&!t.isMenuOpen||l.keyCode===27&&o()},10)}async function r(){i.value.animate()}return(l,c)=>(I(),B("div",{class:G(["header-menu",{"is-cross":F(t).isMenuOpen||F(t).isRegisterOpen||F(t).isAboutOpen}])},[E("button",{class:"header-menu-btn","aria-label":n.value,onClick:o,onMouseenter:r},[E("span",yu,[N(ds,{ref_key:"$$menu",ref:i,text:l.$l("MENU-title"),hoverable:!1,duration:1},null,8,["text"]),bu]),E("span",{class:G(["bars",{"is-pause":F(t).isPauseVisible}])},[(I(),B(ze,null,Ke(2,u=>E("span",{key:"bar-"+u,class:G(["bar",["bar-"+u]])},null,2)),64))],2)],40,_u)],2))}},wu=q(xu,[["__scopeId","data-v-939fba87"]]);const Su={__name:"AppHeader",setup(e){const t=ie(()=>M.$store.hasVisitedHome||!M.$store.isOnHome);let s;(s=document.querySelector(".header-element__container"))?s.classList.add("mm-header-eu"):(s=document.querySelector(".header-container"))&&s.classList.add("mm-header-us");const i=ie(()=>!s);He(()=>{s&&s.classList.toggle("is-visible",!!M.$store.isHeaderOpen)});function n(){s&&(M.$store.isHeaderOpen=!0)}function o(){M.$trackEvent("openDiscoveriesPanel"),M.$store.hasNotification=!1}return(a,r)=>(I(),B("header",{class:G(["header-app",{"is-visible":t.value,"is-background":F(M).$store.isRegisterOpen||F(M).$store.isAboutOpen}])},[N(fu,{class:G({"is-visible":F(M).$store.isDiscoveryVisible}),"allow-touch-event":"",onClick:o},null,8,["class"]),E("button",{class:G(["btn-cartier",{"is-disabled":i.value}]),"allow-touch-event":"","aria-label":"Cartier",onClick:n},[N(Ge,{name:"cartier"})],2),N(wu,{"allow-touch-event":""})],2))}},$u=q(Su,[["__scopeId","data-v-6c626641"]]);const Mu={__name:"Vignetting",setup(e){return(t,s)=>(I(),B("div",{class:G(["vignetting",{darker:F(M).$store.isLookingUp||F(M).$store.isBigReadabilityNeeded}])},[E("div",{class:G(["center-glow",{"is-visible":F(M).$store.isLookingUp||F(M).$store.isReadabilityNeeded}])},null,2)],2))}},Cu=q(Mu,[["__scopeId","data-v-162b820c"]]);const ku=e=>(it("data-v-a64f11de"),e=e(),ot(),e),Tu=tr('<div class="zepellin-container" data-v-a64f11de><svg class="zepellin" viewBox="0 0 90 147" xmlns="http://www.w3.org/2000/svg" fill="none" data-v-a64f11de><path class="pathFill" d="M49.52 125.22c-.61 0-1.1-.49-1.1-1.1 0-.61.49-1.1 1.1-1.1.61 0 1.1.49 1.1 1.1 0 .61-.49 1.1-1.1 1.1ZM32.3 75.84h1.46l.12-.22h-1.7l.12.22ZM34.62 76.01c0-.21-.17-.38-.39-.38s-.39.17-.39.38.17.38.39.38.39-.17.39-.38ZM31.67 95.1h2.49s.05-.07-.1-.2H31.8s-.13.09-.13.2ZM31.85 75.63c-.22 0-.39.17-.39.38s.17.38.39.38.39-.17.39-.38-.17-.38-.39-.38ZM47.37 77.48l-.05 16.59h.28l-.02-16.59h-.21ZM46.91 77.47l-.09 16.6h.3V77.48h-.21v-.01ZM48.51 76.45c-.11-.11-.13-.48-.13-.48 0-.01-1.32 0-1.32 0 .1.16-.08.48-.08.48h1.53ZM46.62 94.4h2.05s.04-.07-.08-.2h-1.86s-.1.09-.1.2h-.01ZM46.73 76.93h1.84c.08 0 .15.07.15.15v.07c0 .08-.07.15-.15.15h-1.84c-.08 0-.15-.07-.15-.15v-.07c0-.08.07-.15.15-.15ZM46.82 76.58h1.75v.25h-1.75v-.25ZM31.93 94.5h2.02s.09.04.09.09v.08s-.04.09-.09.09h-2.02s-.09-.04-.09-.09v-.08s.04-.09.09-.09ZM33.8 76.45c-.11-.11-.13-.48-.13-.48 0-.01-1.32 0-1.32 0 .1.16-.08.48-.08.48h1.53Z" data-v-a64f11de></path><path class="pathFill" d="M75.24 95.18h4.37l-.36.42-63.14-.08-.36-.38h3.78V82.67c0-3.15 2.6-5.72 5.81-5.72 3.21 0 5.8 2.56 5.8 5.72v12.48h3.35V82.67c0-3.15 2.6-5.72 5.81-5.72 3.21 0 5.8 2.56 5.8 5.72v12.48h3.05V82.67c0-3.15 2.6-5.72 5.81-5.72 3.21 0 5.8 2.56 5.8 5.72v12.49h2.87V82.67c0-3.15 2.6-5.72 5.81-5.72 3.21 0 5.8 2.56 5.8 5.72v12.51Zm-11.25 0h.66V83.27h9.66v11.91h.58v-12.5c0-2.96-2.44-5.37-5.45-5.37-3.01 0-5.45 2.41-5.45 5.37v12.5Zm10.05-11.65h-2.22v3.26h2.22v-3.26Zm-2.22 3.37v2.26h2.22V86.9h-2.22Zm0 2.37v2.26h2.22v-2.26h-2.22Zm0 2.37v2.34h2.22v-2.34h-2.22Zm0 2.45v1.08h2.22v-1.08h-2.22Zm-.18-10.57h-1.98v3.26h1.98v-3.26Zm-1.98 3.37v2.26h1.98v-2.26h-1.98Zm0 2.37v2.26h1.98v-2.26h-1.98Zm0 2.37v2.34h1.98v-2.34h-1.98Zm0 2.45v1.08h1.98v-1.08h-1.98Zm-.37-10.57h-2.02v3.25h2.02v-3.25Zm-2.02 3.36v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm0 2.37v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm0 2.37v2.34h2.02v-2.33h-.05l-1.97-.01Zm0 2.45v1.09h2.02v-1.08h-.05l-1.97-.01Zm-.18-10.56h-2.18v3.25h2.18V83.5Zm-2.18 3.36v2.26h2.18v-2.26h-2.18Zm0 2.37v2.26h2.18v-2.26h-2.18Zm0 2.37v2.34h2.18V91.6h-2.18Zm0 2.45v1.09h2.18v-1.09h-2.18ZM49.5 95.13h.66v-11.9h9.66v11.91h.58V82.65c0-2.96-2.44-5.37-5.45-5.37-3.01 0-5.45 2.41-5.45 5.37v12.49-.01Zm10.05-11.64h-2.22v3.26h2.22v-3.26Zm-2.22 3.37v2.26h2.22v-2.26h-2.22Zm0 2.37v2.26h2.22v-2.26h-2.22Zm0 2.37v2.34h2.22V91.6h-2.22Zm0 2.45v1.07h2.22v-1.07h-2.22Zm-.18-10.57h-1.98v3.26h1.98v-3.26Zm-1.98 3.37v2.26h1.98v-2.26h-1.98Zm0 2.37v2.26h1.98v-2.26h-1.98Zm0 2.37v2.34h1.98v-2.34h-1.98Zm0 2.45v1.07h1.98v-1.07h-1.98Zm-.37-10.57h-2.02v3.25h2.02v-3.25Zm-2.02 3.36v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm0 2.37v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm0 2.37v2.34h2.02v-2.33h-.05l-1.97-.01Zm0 2.45v1.08h2.02v-1.07h-.05l-1.97-.01Zm-.18-10.56h-2.18v3.25h2.18v-3.25Zm-2.18 3.36v2.26h2.18v-2.26h-2.18Zm0 2.37v2.26h2.18v-2.26h-2.18Zm0 2.37v2.34h2.18v-2.34h-2.18Zm0 2.45v1.08h2.18v-1.08h-2.18Zm-15.58 1.07h.66V83.19h9.66v11.9h.58V82.61c0-2.96-2.44-5.37-5.45-5.37-3.01 0-5.45 2.41-5.45 5.37v12.48-.01Zm10.05-11.63h-2.22v3.26h2.22v-3.26Zm-2.22 3.37v2.26h2.22v-2.26h-2.22Zm0 2.37v2.26h2.22v-2.26h-2.22Zm0 2.37v2.34h2.22v-2.34h-2.22Zm0 2.45v1.06h2.22v-1.06h-2.22Zm-.18-10.57h-1.98v3.26h1.98v-3.26Zm-1.98 3.37v2.26h1.98v-2.26h-1.98Zm0 2.37v2.26h1.98v-2.26h-1.98Zm0 2.37v2.34h1.98v-2.34h-1.98Zm0 2.45v1.06h1.98V94h-1.98Zm-.37-10.57h-2.02v3.25h2.02v-3.25Zm-2.02 3.36v2.26h2.02v-2.24h-2.02v-.02Zm0 2.37v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm0 2.37v2.34h2.02v-2.33h-.05l-1.97-.01Zm0 2.45v1.07h2.02v-1.06h-2.02v-.01Zm-.18-10.56h-2.18v3.25h2.18v-3.25Zm-2.18 3.36v2.26h2.18v-2.26h-2.18Zm0 2.37v2.26h2.18v-2.26h-2.18Zm0 2.37v2.34h2.18v-2.34h-2.18Zm0 2.45v1.07h2.18v-1.07h-2.18Zm-15.88 1.06h.66V83.15h9.66v11.89h.58V82.57c0-2.96-2.44-5.37-5.45-5.37-3.01 0-5.45 2.41-5.45 5.37v12.47-.01Zm.92-8.26v2.26h2.18v-2.26H20.8Zm2.18-.11v-3.25H20.8v3.25h2.18Zm-2.18 2.48v2.26h2.18v-2.26H20.8Zm0 2.37v2.34h2.18v-2.34H20.8Zm0 2.45v1.06h2.18v-1.06H20.8Zm2.36-7.2v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm2.02-.11V83.4h-2.02v3.25h2.02Zm-2.02 2.48v2.26h2.02v-2.24h-.05l-1.97-.01v-.01Zm0 2.37v2.34h2.02v-2.33h-.05l-1.97-.01Zm0 2.45v1.06h2.02v-1.05h-.05l-1.97-.01Zm2.39-7.18v2.26h1.98v-2.26h-1.98Zm1.98-.11V83.4h-1.98v3.26h1.98Zm-1.98 2.48v2.26h1.98v-2.26h-1.98Zm0 2.37v2.34h1.98v-2.34h-1.98Zm0 2.45v1.05h1.98v-1.05h-1.98Zm2.16-7.2v2.26h2.22v-2.26h-2.22Zm2.22-.11v-3.26h-2.22v3.26h2.22Zm-2.22 2.48v2.26h2.22v-2.26h-2.22Zm0 2.37v2.34h2.22V91.5h-2.22Zm0 2.45V95h2.22v-1.05h-2.22Z" data-v-a64f11de></path><path class="pathFill" d="M74.22 82.95h-9.57v-.21h.02c.03-2.57 2.16-4.66 4.78-4.66s4.79 2.11 4.79 4.71h-.02v.16Zm-2.2-3.48-1.12 1.5c.25.19.46.42.62.68l1.66-.87a4.25 4.25 0 0 0-1.15-1.31h-.01Zm-1.67-.76-.38 1.84c.31.07.6.19.86.37l1.12-1.5a4.29 4.29 0 0 0-1.6-.71Zm-1.83 0 .44 1.83c.16-.04.33-.06.51-.06.14 0 .28.02.41.04l.38-1.84a4.081 4.081 0 0 0-1.74.03Zm-1.6.73 1.16 1.5c.24-.17.51-.3.8-.37l-.44-1.84c-.56.14-1.07.38-1.52.71Zm.18 3.29c.02-.35.11-.68.27-.98l-1.67-.87.04-.08 1.67.87c.15-.26.36-.49.6-.68l-1.16-1.5c-.98.76-1.62 1.92-1.63 3.24h1.88Zm1.93-.11-1.58-.83c-.15.28-.24.6-.26.94h1.82s0-.08.02-.11Zm.12-.16-1.08-1.4c-.23.18-.43.4-.57.65l1.58.83s.04-.06.07-.09v.01Zm.17-.09-.41-1.72c-.28.07-.54.19-.77.35l1.09 1.4s.06-.03.1-.04h-.01v.01Zm.19 0 .36-1.75c-.13-.02-.26-.04-.39-.04-.17 0-.33.02-.49.05l.42 1.73h.03s.05 0 .07.01Zm.18.07 1.09-1.46c-.24-.17-.52-.29-.82-.35l-.37 1.75s.07.04.1.06Zm.11.12 1.64-.87c-.15-.26-.36-.48-.6-.66l-1.09 1.46s.03.04.05.07Zm1.96.18c-.02-.35-.12-.68-.28-.97l-1.64.87s.02.07.02.1h1.9Zm1.94 0c0-.68-.18-1.32-.48-1.88l-1.65.87c.17.3.27.64.29 1.01h1.85-.01ZM32.12 76.58h1.75v.25h-1.75v-.25ZM18.08 75.91h.54v19.37h-.54V75.91ZM32.04 76.93h1.84c.08 0 .15.07.15.15v.07c0 .08-.07.15-.15.15h-1.84c-.08 0-.15-.07-.15-.15v-.07c0-.08.07-.15.15-.15ZM32.21 77.47l-.09 16.6h.29V77.48l-.2-.01ZM33.13 77.48v16.59l.32-.01-.12-16.58h-.2ZM32.67 77.48l-.05 16.59h.28l-.03-16.59h-.2ZM31.92 94.4h2.05s.04-.07-.08-.2h-1.86s-.1.09-.1.2h-.01ZM33.74 77.49h-.2l.02 16.55h.32l-.14-16.55ZM30.11 82.95h-9.57v-.21h.02c.03-2.57 2.16-4.66 4.78-4.66s4.79 2.11 4.79 4.71h-.02v.16Zm-2.2-3.48-1.12 1.5c.25.19.46.42.62.68l1.66-.87a4.25 4.25 0 0 0-1.15-1.31h-.01Zm-1.67-.76-.38 1.84c.31.07.6.19.86.37l1.12-1.5a4.29 4.29 0 0 0-1.6-.71Zm-1.83 0 .44 1.83c.16-.04.33-.06.51-.06.14 0 .28.02.41.04l.38-1.84a4.081 4.081 0 0 0-1.74.03Zm-1.6.73 1.16 1.5c.24-.17.51-.3.8-.37l-.44-1.84c-.56.14-1.07.38-1.52.71Zm.18 3.29c.02-.35.11-.68.27-.98l-1.67-.87.04-.08 1.67.87c.15-.26.36-.49.6-.68l-1.16-1.5c-.98.76-1.62 1.92-1.63 3.24h1.88Zm1.93-.11-1.58-.83c-.15.28-.24.6-.26.94h1.82s0-.08.02-.11Zm.12-.16-1.08-1.4c-.23.18-.43.4-.57.65l1.58.83s.04-.06.07-.09v.01Zm.17-.09-.41-1.72c-.28.07-.54.19-.77.35l1.09 1.4s.06-.03.1-.04h-.01v.01Zm.19 0 .36-1.75c-.13-.02-.26-.04-.39-.04-.17 0-.33.02-.49.05l.42 1.73h.03s.05 0 .07.01Zm.18.07 1.09-1.46c-.24-.17-.52-.29-.82-.35l-.37 1.75s.07.04.1.06Zm.11.12 1.64-.87c-.15-.26-.36-.48-.6-.66l-1.09 1.46s.03.04.05.07Zm1.96.18c-.02-.35-.12-.68-.28-.97l-1.65.87s.02.07.02.1h1.91Zm1.94 0c0-.68-.18-1.32-.48-1.88l-1.65.87c.17.3.27.64.29 1.01h1.85-.01ZM61.24 75.63c-.22 0-.39.17-.39.38s.17.38.39.38.39-.17.39-.38-.17-.38-.39-.38ZM61.7 75.84h1.47l.12-.22h-1.71l.12.22ZM61.34 94.5h2.02s.09.04.09.09v.08s-.04.09-.09.09h-2.02s-.09-.04-.09-.09v-.08s.04-.09.09-.09ZM63.15 77.49h-.21l.02 16.55h.33l-.14-16.55ZM64.02 76.01c0-.21-.17-.38-.39-.38s-.39.17-.39.38.17.38.39.38.39-.17.39-.38ZM61.08 95.1h2.49s.05-.07-.1-.2h-2.26s-.13.09-.13.2ZM59.74 82.95h-9.57v-.21h.02c.03-2.57 2.16-4.66 4.78-4.66s4.79 2.11 4.79 4.71h-.02v.16Zm-2.2-3.48-1.12 1.5c.25.19.46.42.62.68l1.66-.87a4.25 4.25 0 0 0-1.15-1.31h-.01Zm-1.67-.76-.38 1.84c.31.07.6.19.86.37l1.12-1.5a4.29 4.29 0 0 0-1.6-.71Zm-1.83 0 .44 1.83c.16-.04.33-.06.51-.06.14 0 .28.02.41.04l.38-1.84a4.081 4.081 0 0 0-1.74.03Zm-1.6.73 1.16 1.5c.24-.17.51-.3.8-.37l-.44-1.84c-.56.14-1.07.38-1.52.71Zm.18 3.29c.02-.35.11-.68.27-.98l-1.67-.87.04-.08 1.67.87c.15-.26.36-.49.6-.68l-1.16-1.5c-.98.76-1.62 1.92-1.63 3.24h1.88Zm1.93-.11-1.58-.83c-.15.28-.24.6-.26.94h1.82s0-.08.02-.11Zm.12-.16-1.08-1.4c-.23.18-.43.4-.57.65l1.58.83s.04-.06.07-.09v.01Zm.17-.09-.41-1.72c-.28.07-.54.19-.77.35l1.09 1.4s.06-.03.1-.04h-.01v.01Zm.19 0 .36-1.75c-.13-.02-.26-.04-.39-.04-.17 0-.33.02-.49.05l.42 1.73h.03s.05 0 .07.01Zm.18.07 1.09-1.46c-.24-.17-.52-.29-.82-.35l-.37 1.75s.07.04.1.06Zm.11.12 1.64-.87c-.15-.26-.36-.48-.6-.66l-1.09 1.46s.03.04.05.07Zm1.96.18c-.02-.35-.12-.68-.28-.97l-1.64.87s.02.07.02.1h1.9Zm1.94 0c0-.68-.18-1.32-.48-1.88l-1.65.87c.17.3.27.64.29 1.01h1.85-.01ZM45.08 82.95h-9.57v-.21h.02c.03-2.57 2.16-4.66 4.78-4.66s4.79 2.11 4.79 4.71h-.02v.16Zm-2.2-3.48-1.12 1.5c.25.19.46.42.62.68l1.66-.87a4.25 4.25 0 0 0-1.15-1.31h-.01Zm-1.67-.76-.38 1.84c.31.07.6.19.86.37l1.12-1.5a4.29 4.29 0 0 0-1.6-.71Zm-1.83 0 .44 1.83c.16-.04.33-.06.51-.06.14 0 .28.02.41.04l.38-1.84a4.081 4.081 0 0 0-1.74.03Zm-1.6.73 1.16 1.5c.24-.17.51-.3.8-.37l-.44-1.84c-.56.14-1.07.38-1.52.71Zm.18 3.29c.02-.35.11-.68.27-.98l-1.67-.87.04-.08 1.67.87c.15-.26.36-.49.6-.68l-1.16-1.5c-.98.76-1.62 1.92-1.63 3.24h1.88Zm1.93-.11-1.58-.83c-.15.28-.24.6-.26.94h1.82s0-.08.02-.11Zm.12-.16-1.08-1.4c-.23.18-.43.4-.57.65l1.58.83s.04-.06.07-.09v.01Zm.17-.09-.41-1.72c-.28.07-.54.19-.77.35l1.09 1.4s.06-.03.1-.04l-.01.01Zm.19 0 .36-1.75c-.13-.02-.26-.04-.39-.04-.17 0-.33.02-.49.05l.42 1.73h.03s.05 0 .07.01Zm.18.07 1.09-1.46c-.24-.17-.52-.29-.82-.35l-.37 1.75s.07.04.1.06Zm.11.12 1.64-.87c-.15-.26-.36-.48-.6-.66l-1.09 1.46s.03.04.05.07Zm1.96.18c-.02-.35-.12-.68-.28-.97l-1.65.87s.02.07.02.1h1.91Zm1.94 0c0-.68-.18-1.32-.48-1.88l-1.65.87c.17.3.27.64.29 1.01h1.85-.01ZM24.92 113.99h.21l-.02-17.63h.11l.12 17.63h.2V96.36h.23L25.8 114h.21l.04-17.64h.21V114h.21l.09-17.64h10.47l.14 17.63h.21l-.02-17.63h.11l.11 17.63h.21V96.36h.23l.03 17.64h.21l.04-17.64h.21V114h.21l.09-17.64H52.2l.13 17.63h.21l-.02-17.62h.12l.11 17.62h.21V96.37h.23l.02 17.63h.21l.05-17.63h.21V114h.2l.09-17.63h14.17l.13 17.62h.21l-.02-17.61h.12l.11 17.61h.21V96.38h.23l.02 17.62h.21l.05-17.62h.21V114h.2l.1-17.62h10.77l-.37-.37-16.65-.02-.18-.24h-2.37l-.18.23H48.95l-.16-.23h-2.38l-.16.22-12.01-.02-.15-.2h-2.38l-.15.2-15.99-.02-.37.42h9.58l.14 17.64ZM46.64 94.5h2.02s.09.04.09.09v.08s-.04.09-.09.09h-2.02s-.09-.04-.09-.09v-.08s.04-.09.09-.09ZM49.32 76.01c0-.21-.17-.38-.39-.38s-.39.17-.39.38.17.38.39.38.39-.17.39-.38ZM62.53 77.48v16.59l.32-.01-.11-16.58h-.21ZM46.38 95.1h2.49s.05-.07-.1-.2h-2.26s-.13.09-.13.2ZM47.83 77.48v16.59l.32-.01-.12-16.58h-.2ZM48.45 77.49h-.21l.02 16.55h.32l-.13-16.55ZM47 75.84h1.47l.12-.22h-1.71l.12.22ZM61.61 77.47l-.09 16.6h.3V77.48h-.21v-.01ZM62.06 77.48l-.04 16.59h.27l-.02-16.59h-.21ZM61.33 94.4h2.05s.04-.07-.08-.2h-1.86s-.1.09-.1.2h-.01ZM63.21 76.45c-.11-.11-.13-.48-.13-.48 0-.01-1.32 0-1.32 0 .1.16-.08.48-.08.48h1.53ZM46.55 75.63c-.22 0-.39.17-.39.38s.17.38.39.38.39-.17.39-.38-.17-.38-.39-.38ZM61.44 76.93h1.84c.08 0 .15.07.15.15v.07c0 .08-.07.15-.15.15h-1.84c-.08 0-.15-.07-.15-.15v-.07c0-.08.07-.15.15-.15ZM61.53 76.58h1.75v.25h-1.75v-.25Z" data-v-a64f11de></path><path class="pathFill" d="M30.84 113.47h2.76l-.19-.26h-2.38l-.19.26ZM23.51 113.75h48.03v.6H23.51v-.6ZM76.96 76.02h.54v18.71h-.54V76.02ZM45.53 113.47h2.76l-.19-.26h-2.37l-.2.26ZM22.8 116.02l49.66.03-.28-.38-49.1-.07-.28.42ZM22.52 116.4l-.29.42 50.73.04-.29-.39-50.15-.07ZM23.48 114.7h48.06v.41H23.48v-.41ZM17.23 73.97h61.48v.79H17.23v-.79ZM17.19 75.24h61.52v.54H17.19v-.54ZM60.24 113.47h2.77l-.2-.26h-2.37l-.2.26ZM52.34 121.66h-.02v.13h-9.57v-.18h.02c.03-2.21 2.16-4 4.78-4s4.79 1.81 4.79 4.04v.01Zm-3.89-3.5-.38 1.58c.31.06.6.17.86.31l1.12-1.28a4.67 4.67 0 0 0-1.6-.61Zm-1.83 0 .44 1.57c.16-.03.33-.05.51-.05.14 0 .28.02.41.04l.38-1.58a4.731 4.731 0 0 0-1.74.02Zm-1.6.63 1.16 1.28c.24-.15.51-.25.8-.32l-.44-1.57c-.56.12-1.07.33-1.52.61Zm.18 2.82c.02-.3.11-.59.27-.84l-1.67-.75.04-.07 1.67.75c.15-.23.36-.42.6-.58l-1.16-1.29c-.98.65-1.62 1.65-1.63 2.78h1.88Zm1.93-.1-1.58-.71c-.15.24-.24.52-.26.81h1.82s0-.07.02-.1Zm.12-.14-1.08-1.2c-.23.15-.43.34-.57.56l1.58.71s.04-.05.07-.08v.01Zm.17-.08-.41-1.47c-.28.06-.54.16-.77.3l1.09 1.2s.06-.03.1-.04l-.01.01Zm.19 0 .36-1.5c-.13-.02-.26-.03-.39-.03-.17 0-.33.02-.49.05l.42 1.48h.03s.05 0 .07.01v-.01Zm.18.06 1.09-1.25c-.24-.14-.52-.25-.82-.3l-.37 1.5s.07.03.1.05Zm.11.1 1.64-.74c-.15-.22-.36-.41-.6-.56l-1.09 1.25s.03.04.05.06v-.01Zm1.96.15c-.02-.3-.12-.58-.28-.83l-1.65.74s.02.06.02.09h1.91Zm1.45-1.61-1.65.75c.17.26.27.55.29.86h1.85c0-.58-.18-1.13-.48-1.61h-.01Zm-.04-.07c-.29-.44-.68-.82-1.15-1.12L49 120.09c.25.16.46.36.62.59l1.66-.75-.01-.01ZM61.76 119.17h.72v.51h-.72v-.51ZM55.66 118.11h6.97v.19h-6.97v-.19ZM55.66 118.67l6.89.03v.28l-6.89-.03v-.28ZM61.67 130.76h1.06v.25h-1.06v-.25ZM62.78 117.62v.19l-7.27.03v-.19l7.27-.03ZM33.07 123.73h5v.13h-5v-.13ZM32.11 118.11h6.97v.19h-6.97v-.19ZM39.25 117.63v.19l-7.27.03v-.19l7.27-.03ZM38.26 119.87h.66v10.79h-.66v-10.79ZM38.14 130.76h1.06v.25h-1.06v-.25ZM24.29 132.97h45.52v.54H24.29v-.54ZM23.54 134.72l47.07.05-.26-.55-46.55-.11-.26.61ZM38.24 119.17h.72v.51h-.72v-.51ZM33.06 124.02h5.03v.33h-5.03v-.33ZM38.06 120.44v3.13h-4.98v-3.13h4.98Zm-.13.13h-4.72v2.87h4.72v-2.87ZM56.66 119.17h4.88v.48h-4.88v-.48ZM33.02 120.01h5.11v.3h-5.11v-.3ZM33.11 119.17h4.88v.48h-4.88v-.48ZM32.12 118.66l6.89.03v.28l-6.89-.03v-.28ZM32.22 119.87h.66v10.79h-.66v-10.79ZM32.16 119.17h.72v.51h-.72v-.51ZM61.8 119.87h.66v10.79h-.66v-10.79Z" data-v-a64f11de></path><path class="pathFill" d="M26.6 117.16v14.92h-2.32v.54h45.53v-.54h-3.36v-14.92h-.54v14.92h-.62v-14.92h-.54v14.92H28.3v-14.92h-.54v14.92h-.62v-14.92h-.54Z" data-v-a64f11de></path><path class="pathFill" d="M56.62 123.73h5v.13h-5v-.13ZM61.61 120.44v3.13h-4.98v-3.13h4.98Zm-.13.13h-4.72v2.87h4.72v-2.87ZM56.6 124.02h5.03v.33H56.6v-.33ZM55.7 119.17h.72v.51h-.72v-.51ZM55.75 119.87h.66v10.79h-.66v-10.79ZM56.56 120.01h5.11v.3h-5.11v-.3ZM55.53 130.76h1.06v.25h-1.06v-.25ZM32 130.76h1.06v.25H32v-.25ZM42.3 132.6l-.57-.34v-10.68c0-2.7 2.6-4.9 5.81-4.9 3.21 0 5.8 2.2 5.8 4.9v10.69m-8.15-.9h-2.18v.9h2.18v-.9Zm0-2.11h-2.18v2.01h2.18v-2.01Zm0-2.03h-2.18v1.94h2.18v-1.94Zm0-2.03h-2.18v1.94h2.18v-1.94Zm0-2.88h-2.18v2.79h2.18v-2.79Zm2.2 9.07h-2.02v.89h2.02v-.89Zm0-2.11h-2.02v2h2.02v-2Zm0-2.03h-2.02v1.94h2.02v-1.94Zm0-2.03h-2.02v1.93h2.02v-1.93Zm0-2.89h-2.02v2.79h2.02v-2.79Zm2.35 9.07h-1.98v.89h1.98v-.89Zm0-2.11h-1.98v2.01h1.98v-2.01Zm0-2.03h-1.98v1.94h1.98v-1.94Zm0-2.03h-1.98v1.94h1.98v-1.94Zm0-2.89h-1.98v2.8h1.98v-2.8Zm2.4 9.07h-2.22v.89h2.22v-.89Zm0-2.11h-2.22v2.01h2.22v-2.01Zm0-2.03h-2.22v1.94h2.22v-1.94Zm0-2.03h-2.22v1.94h2.22v-1.94Zm0-2.89h-2.22v2.8h2.22v-2.8Zm.85-.73c0-2.54-2.44-4.6-5.45-4.6-3.01 0-5.45 2.06-5.45 4.6v10.68h.66v-10.18h9.66v10.18h.58v-10.69.01Z" data-v-a64f11de></path><path class="pathStroke" d="m21.2 136.44 26.02 9.67 25.5-9.73" stroke-width=".61" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathStroke" d="m21.2 135.35 26.02 9.67 25.5-9.73" stroke-width=".26" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathStroke" d="M88.69 25.68S82.33-.18 47.66.36c0 0-31.47.46-47.26 25.19 0 0 9.15 23.83 48.21 25.59 0 0 32.36 1.35 40.08-25.46Z" stroke-width=".71" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathStroke" d="M47.74 10.51s-31.12.28-46.73 15.23c0 0 9.05 14.4 47.67 15.47 0 0 32 .82 39.64-15.39 0 0-6.29-15.64-40.57-15.31h-.01Z" stroke-width=".58" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathStroke" d="M87.94 25.94s-6.22-5.41-40.12-5.29c0 0-30.77.1-46.21 5.26 0 0 8.95 4.98 47.13 5.35 0 0 31.64.28 39.19-5.32h.01Z" stroke-width=".46" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathFill" d="M43.79 26.83s-.02-.03-.02-.04c0 0 .01.03.02.04ZM50.81 24.64c.15 0 .27-.12.27-.27 0-.15-.12-.27-.27-.27-.15 0-.27.12-.27.27 0 .15.12.27.27.27Z" data-v-a64f11de></path><path class="pathFill" d="m43.79 26.83-.02-.04s.02.03.02.04Z" data-v-a64f11de></path><path class="pathFill" d="M57.01 25.28c-.42-.01-1.25.65-1.34.75l.43-.74h-.65c-.83 1.42-2.57 2.79-3.35 2.81-.7.05-.75-.45-.52-1.04.99.11 2.73-.91 2.19-1.66-.47-.47-1.72.02-2.53 1.09l-.06.08-.12.17c-.28.38-.86.92-.86.92-.75.74-1.09.31-.77-.23l1.24-2.14h-.56c-.15.21-.9 1.58-2.12 2.45-.69.53-1.22.3-.75-.39l1.21-2.06h.67l.09-.09h-.69l.73-1.28h-.61c-.32.55-1.08 1.83-1.84 2.16.14-.18.09-.42.09-.42-.06-.28-.36-.3-.36-.3s-.44-.07-.94.38l.27-.44h-.61c-.54.95-1.96 2.98-2.74 2.79-.21-.09-.22-.36 0-.71l1.23-2.08h-.61c-.09.13-.3.52-.33.6v.01c.02-.13.06-.62-.42-.71-.1-.02-.18-.03-.28-.03-.52 0-1.05.27-1.57.73-.37.32-.71.75-1 1.29-1.25 1.15-2.54 1.22-2.96.79-.45-.46-.62-1.4.21-2.98.29-.42 1.37-2.2 2.93-2.62 1.16-.31 1.64.35 1.68 1.11 0 0 .35-.66.75-1.07-.24.1-.78.23-1.03.08-.75-.48-2.21-.41-4.07 1.32-1.6 1.62-2.73 4.77.43 4.52 1.12-.14 2.06-1.03 2.06-1.03-.15.54.09.95.55 1.03.17.03.41-.01.62-.09.17-.07.53-.22 1.01-.59-.15.59.77 1.48 2.46-.61l-.78 1.26h.71s1.19-2.1 1.41-2.32c.46-.62 1.31-.73 1.3-.3a.402.402 0 0 0-.25-.05c-.2.03-.29.29-.25.46.02.06.06.12.15.17 0 0 .4.28 1.35-.92l-.14.25s-.97 1.66-1.09 1.9c-.49.94.67 1.03 1.36.43 0 0 .57-.41 1.21-1.12 0 .01-.02.03-.02.04-.33.6-.7 1.21-.23 1.47.14.06.5.1.95-.22 0 0 .73-.6 1.11-1.08-.16.38-.31.99.35 1.27.37.12.67.04 1.04-.08 1.16-.38 2.65-2.08 2.65-2.08s-1.26 2.09-1.3 2.17h.64s.91-1.54 1.09-1.8c.5-.78 1.57-1.31 1.68-1.04-.4-.08-.5.51-.18.63.49.19.78-.75.1-.79l-.02-.02Zm-3.85.04c.17.02.25.11.24.35-.05.52-.82 1.36-1.78 1.34.33-.79 1.14-1.72 1.55-1.68h-.01v-.01Zm-11.68 2.36c-.18.16-.41.28-.41.28-.93.47-1.14-.04-1.04-.51.09-.41.45-1.01.74-1.37.27-.3.55-.53.91-.71.77-.38 1.24.1.92.77-.21.44-.55 1.04-1.13 1.53l.01.01Z" data-v-a64f11de></path><path class="pathStroke" d="m65.2 73.88 18.02-38.43M27.9 73.61 7.74 35.32M38.03 74.29l-8.54-39.23" stroke-width=".44" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathFill" d="M63.67 35.63c-.34 0-.61-.27-.61-.61 0-.34.27-.61.61-.61.34 0 .61.27.61.61 0 .34-.27.61-.61.61ZM83.15 36.15c-.34 0-.61-.27-.61-.61 0-.34.27-.61.61-.61.34 0 .61.27.61.61 0 .34-.27.61-.61.61ZM29.32 35.28c-.34 0-.61-.27-.61-.61 0-.34.27-.61.61-.61.34 0 .61.27.61.61 0 .34-.27.61-.61.61ZM7.61 35.5c-.34 0-.61-.27-.61-.61 0-.34.27-.61.61-.61.34 0 .61.27.61.61 0 .34-.27.61-.61.61Z" data-v-a64f11de></path><path class="pathStroke" d="m54.99 74.03 8.68-38.84" stroke-width=".44" stroke-miterlimit="10" data-v-a64f11de></path><path class="pathStroke" d="m2.71 51.71-.6 1.86 4.91 9.28 2.06.41 8.89-4.91.71-1.85-4.86-9.25-1.79-.42-9.32 4.88Z" stroke-width=".62" stroke-miterlimit="10" data-v-a64f11de></path></svg></div>',1),Eu=["innerHTML"],Pu=ku(()=>E("div",{class:"spinner-container"},[E("div",{class:"spinner-shape"})],-1)),Lu={__name:"Spinner",setup(e){return(t,s)=>(I(),B("aside",{class:G(["spinner",{visible:F(M).$store.isSpinnerVisible}])},[Tu,E("div",{class:"spinner-counter",innerHTML:t.$store.percentLoaded},null,8,Eu),Pu],2))}},Au=q(Lu,[["__scopeId","data-v-a64f11de"]]),Sr=Symbol("form");function Fn(){return os(Sr)}function Ou({submit:e,afterSubmit:t}={}){const s=Pe({}),i=ae(!1),n=ae(!1),o=ae(!1);let a=0;return ts(Sr,{hasError:n,isSubmitting:o,field:l,submit:u,validate:c}),{fields:s,hasError:n,isSubmitting:o,field:l,isSuccessful:i};function l({name:d,default:f,format:b,postformat:p,validate:m}){const g=ae(f),y=ae(f),x=ae(!1);return s[d]={name:d,source:g,formatted:y,format:b,postformat:p,validate:m,hasError:x},{name:d,source:g,hasError:x}}async function c(){const d={};let f=!1,b=++a;if(await Promise.all(Object.values(s).map(async p=>{let m=await p.format(p.source.value);if(b!==a)return;const g=await p.validate(m);b===a&&(p.postformat&&(m=await p.postformat(m)),p.hasError.value=!g,p.formatted.value=m,f=f||!g,d[p.name]=m)})),b===a)return n.value=!!f,f?null:d}async function u(){o.value||(o.value=!0,await h(),await Q(250),o.value=!1)}async function h(){try{const d=await c();if(d===null)return;e&&await e(d),t&&await t(d)}catch{n.value=!0}}}const Ru=80,Hn=1,Gs=Ru,Du=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;const Iu=["for","textContent"],zu=["id","name","type","minlength","maxlength","required","autocomplete","inputmode"],Fu=["textContent"],Uu={__name:"FormText",props:{name:{type:String,default:null},type:{type:String,default:"name",validator(e){return["name","email"].includes(e)}},label:{type:String,default:"Field"},autocomplete:{type:String,default:"off"},required:{type:Boolean,default:!1}},setup(e){const t=e,s=ae(!1),i=ae("This field is mandatory."),{field:n}=Fn(),{name:o,source:a,hasError:r}=n({name:t.name,format:c=>(c??"").trim(),validate(c){switch(t.type){case"name":if(t.required&&!c)return i.value=M.$l("REGISTER-error-required"),!1;if(c.length<Hn||c.length>Gs)return i.value=M.$l("REGISTER-error-length"),!1;break;case"email":if(t.required&&!c)return i.value=M.$l("REGISTER-error-required"),!1;if(c.length<Hn||c.length>Gs)return i.value=M.$l("REGISTER-error-length"),!1;if(!Du.test(c))return i.value=M.$l("REGISTER-error-email"),!1;break}return!0}});function l(){s.value=!1,window.scrollTo(0,0)}return(c,u)=>(I(),B("fieldset",{class:G(["form-text",{hasError:F(r),"is-focus":s.value,"is-filled":F(a),"is-required":e.required}])},[E("label",{for:F(o),textContent:Ie(e.label)},null,8,Iu),Tn(E("input",{id:F(o),"onUpdate:modelValue":u[0]||(u[0]=h=>is(a)?a.value=h:null),name:F(o),type:e.type==="email"?"email":"text",placeholder:"",minlength:F(Hn),maxlength:e.type==="email"?F(Gs):F(Gs)/2,required:e.required,autocomplete:e.autocomplete,inputmode:e.type==="email"?"email":"text",onFocus:u[1]||(u[1]=h=>s.value=!0),onBlur:l},null,40,zu),[[Ml,F(a)]]),E("small",{class:G(["error",{"is-visible":F(r)}]),textContent:Ie(i.value)},null,10,Fu)],2))}},Gn=q(Uu,[["__scopeId","data-v-b4032b60"]]);const Nu=e=>(it("data-v-abe5f6cd"),e=e(),ot(),e),Bu=["id","name"],Vu=["for","innerHTML"],Zu=Nu(()=>E("span",{class:"checkmark"},null,-1)),ju={__name:"FormCheckbox",props:{name:{type:String,default:null},label:{type:String,default:"Field"},required:{type:Boolean,default:!1}},setup(e){const t=e,{field:s}=Fn(),{name:i,source:n,hasError:o}=s({name:t.name,default:!1,format:a=>a?1:0,validate:a=>!t.required||a});return(a,r)=>(I(),B("fieldset",{class:G(["form-checkbox",{hasError:F(o),"is-required":e.required}]),"allow-touch-event":""},[Tn(E("input",{id:F(i),"onUpdate:modelValue":r[0]||(r[0]=l=>is(n)?n.value=l:null),name:F(i),type:"checkbox",autocomplete:"off"},null,8,Bu),[[Cl,F(n)]]),E("label",{for:F(i),innerHTML:e.label},null,8,Vu),Zu],2))}},Hu=q(ju,[["__scopeId","data-v-abe5f6cd"]]);const Gu=["for"],Wu=["id","name","value"],Wn="0004",qu={__name:"FormTitles",setup(e){const t=["0002","0005","0004"],{field:s}=Fn(),i=t.map(r=>({id:"title-"+r,value:r,autocomplete:r===Wn?null:"off",checked:r===Wn,label:M.$l(`REGISTER-title-${r}`)})),{name:n,source:o,hasError:a}=s({name:"title",default:Wn,format:r=>r,validate:r=>t.includes(r)});return(r,l)=>(I(),B("fieldset",{class:G(["form-titles",{hasError:F(a)}]),"allow-touch-event":""},[(I(!0),B(ze,null,Ke(F(i),c=>(I(),B("div",{key:c.id,class:"item"},[E("label",{for:c.id},[Tn(E("input",{id:c.id,"onUpdate:modelValue":l[0]||(l[0]=u=>is(o)?o.value=u:null),type:"radio",name:F(n),value:c.value},null,8,Wu),[[kl,F(o)]]),nr(" "+Ie(c.label),1)],8,Gu)]))),128))],2))}},Yu=q(qu,[["__scopeId","data-v-bdc305bc"]]);const Ku=e=>(it("data-v-b865a036"),e=e(),ot(),e),Xu=Ku(()=>E("span",{class:"spinner"},null,-1)),Qu={key:1,class:"line"},Ju={__name:"CallToAction",props:{to:{type:[String,Object],default:null},href:{type:String,default:null},text:{type:String,default:null},external:{type:String,default:null},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},variant:{type:String,default:"default",validator(e){return["default","underline"].includes(e)}},color:{type:String,default:"white",validator(e){return["white","outline"].includes(e)}}},setup(e){const t=e,s=ae(),i=Qe({});let n="button";pe(t,()=>{t.to?(n=El,i.to=t.to):t.href&&(n="a",i.href=t.href,t.external&&(i.target="_blank",i.rel="noopener"))},{immediate:!0});function o(){t.variant==="underline"&&!s.value||s.value.animate()}return(a,r)=>(I(),Te(En(F(n)),Tl(i,{disabled:F(n)==="button"&&(e.disabled||e.loading)?!0:null,class:[{"is-loading":e.loading},{"is-disabled":e.disabled},e.variant==="underline"?"underline":"cta",e.color],onMouseenter:o}),{default:wt(()=>[e.icon?(I(),Te(Ge,{key:0,name:e.icon},null,8,["name"])):Ae("",!0),eo(a.$slots,"default",{},void 0,!0),N(ds,{ref_key:"$$ctaText",ref:s,text:e.text,class:"cta-text"},null,8,["text"]),Xu,e.variant==="underline"?(I(),B("span",Qu)):Ae("",!0)]),_:3},16,["disabled","class"]))}},xt=q(Ju,[["__scopeId","data-v-b865a036"]]);const ed={class:"form-submit"},td={__name:"FormSubmit",setup(e){const{submit:t}=Fn();return(s,i)=>(I(),B("fieldset",ed,[N(xt,{type:"submit",text:s.$l("REGISTER-cta"),variant:"underline",loading:s.$store.formIsSubmitting,onClick:F(t)},null,8,["text","loading","onClick"])]))}},sd=q(td,[["__scopeId","data-v-65a3e853"]]);const nd={class:"fields-group"},id={class:"fields-group"},od={class:"checkboxes"},ad=["innerHTML"],rd={__name:"RegisterForm",setup(e){const t=ae(null),{hasError:s,isSubmitting:i,field:n}=Ou({async submit(h){const d=JSON.stringify(h);fetch("https://we2jukmg6h.execute-api.eu-west-3.amazonaws.com/Dev/eoy23",{method:"POST",body:d}).then(b=>{b.ok&&b.status===200?(t.value=!0,M.$user.saveData(),M.$trackEvent("formSent")):t.value=!1}).catch(b=>{console.error("CATCH ERROR:",b),t.value=!1})}});He(()=>M.$store.formIsSubmitting=i.value),He(()=>M.$store.formHasError=s.value),He(()=>M.$store.formIsSuccessful=t.value);const o=M.$store.finishedLevels,a=ie(()=>o.starry_night?3:o.frozen_lake?2:o.sea_of_clouds?1:0),r=M.$l("REGISTER-legals-msg"),l=new RegExp("{{LEGALS}}","g"),c=`
		<a href="${M.$l("REGISTER-legal-url")}"
		target="_blank" rel="noopener">
			${M.$l("REGISTER-legal-link")}
		</a>`,u=r.replace(l,c);return n({name:"language",default:null,format:()=>M.$l("locale").slice(0,2).toUpperCase()||"EN",validate:h=>typeof h=="string"}),n({name:"countryOfOrigin",default:null,format:()=>M.$l("country")||"USA",validate:h=>typeof h=="string"}),n({name:"acceptLegals",default:null,format:()=>1,validate:h=>typeof h=="number"}),n({name:"score",default:null,format:()=>M.$store.totalScore||0,validate:h=>typeof h=="string"||typeof h=="number"}),n({name:"chapter",default:null,format:()=>a.value||0,validate:h=>typeof h=="string"||typeof h=="number"}),(h,d)=>(I(),B("form",{class:G(["register-form",{hasError:F(s),isSubmitting:F(i)}]),novalidate:"",onSubmit:d[0]||(d[0]=Pl(()=>{},["prevent"]))},[E("div",nd,[N(Yu),N(Gn,{name:"firstName",type:"name",label:h.$l("REGISTER-firstname"),required:""},null,8,["label"])]),E("div",id,[N(Gn,{name:"lastName",type:"name",label:h.$l("REGISTER-lastname"),required:""},null,8,["label"]),N(Gn,{name:"email",type:"email",label:h.$l("REGISTER-email"),required:""},null,8,["label"])]),E("div",od,[N(Hu,{name:"canBeContacted",label:F(u)},null,8,["label"])]),N(zs,{name:"error"},{default:wt(()=>[t.value===!1?(I(),B("p",{key:0,class:"request-error",innerHTML:h.$l("REGISTER-500")||"Sorry, something went wrong... Please try again."},null,8,ad)):Ae("",!0)]),_:1}),N(sd)],34))}},ld=q(rd,[["__scopeId","data-v-4bda32d5"]]);const cd={class:"form-section"},ud={class:"content"},dd=["innerHTML"],hd={__name:"FormContainer",setup(e){return(t,s)=>(I(),B("section",cd,[E("div",ud,[E("h1",{class:"title",innerHTML:t.$l("REGISTER-title")},null,8,dd)]),N(ld)]))}},fd=q(hd,[["__scopeId","data-v-0466a3df"]]);const pd={class:"confirmation"},md={class:"validate"},gd=["textContent"],vd={class:"cta-wrapper"},_d={__name:"FormConfirmation",setup(e){function t(){M.$store.isRegisterOpen=!1}return(s,i)=>(I(),B("section",pd,[E("div",md,[N(Ge,{name:"fadeCircle"}),N(Ge,{name:"check"})]),E("h1",{class:"title",textContent:Ie(s.$l("CONFIRMATION-title"))},null,8,gd),E("div",vd,[N(xt,{text:s.$l("REGISTER-back"),variant:"underline",onClick:t},null,8,["text"])])]))}},yd=q(_d,[["__scopeId","data-v-0615440f"]]);const bd={__name:"AppForm",setup(e){const{$store:t,$user:s}=M,i=ie(()=>t.formIsSuccessful||s.isRegistered?yd:fd),n=ct("Escape",()=>t.isRegisterOpen=!1,{once:!1});return pe(()=>t.isRegisterOpen,o=>{o?n.enable():n.disable()},{immediate:!0}),(o,a)=>(I(),B("section",{class:G(["register",{"is-visible":F(t).isRegisterOpen}]),"allow-touch-event":""},[N(zs,{appear:"",duration:1500,name:"form",mode:"out-in"},{default:wt(()=>[F(t).isRegisterOpen?(I(),Te(En(i.value),{key:0})):Ae("",!0)]),_:1})],2))}},xd=q(bd,[["__scopeId","data-v-00ab5278"]]),Un={sea_of_clouds:1,frozen_lake:2,starry_night:3};function bn(e){let t=Math.floor(e/10),s=e%10;return[t,s]}const wd=["innerHTML"],Sd=["innerHTML"],$d={__name:"RevealTextInOut",props:{text:{type:String,default:null},appear:{type:Boolean,default:!0},appearDelay:{type:String,default:"0s"},duration:{type:[String,Number],default:.9}},setup(e,{expose:t}){const s=e;sr(u=>({a35921a8:e.appearDelay,c417be14:r.value}));const i=!M.$l("ligation"),n=Z(),o=Z(),a=Z(i?rs(s.text):s.text),r=ie(()=>`${s.duration}s`);xe(()=>{l(n.value),l(o.value)});function l(u){if(!i)return;const h=u.querySelectorAll(".char");if(h.length)for(let d=0;d<h.length;d++)h[d].style.setProperty("--i",d+1)}async function c(u){if(u=u??s.text,!i)return a.value=u;a.value=rs(u),as(()=>{l(n.value),l(o.value)})}return t({computeSplittedText:c}),(u,h)=>(I(),B("span",{class:G(["wrapper",{appear:s.appear}])},[E("span",{ref_key:"$$originalText",ref:n,class:"text",innerHTML:a.value},null,8,wd),E("span",{ref_key:"$$twinText",ref:o,class:"twin-text",innerHTML:a.value},null,8,Sd)],2))}},Md=q($d,[["__scopeId","data-v-2f3b2308"]]);const Cd=5,kd={__name:"Separator",props:{isMenu:{type:Boolean,default:!1}},setup(e){const t=e,s=Z(),i=Z(0),n=Z(320);return xe(()=>{n.value=s.value.getBoundingClientRect().width}),pe(()=>M.$viewport.width,()=>{i.value=Math.floor(n.value/(Cd*2)),s.value&&(n.value=s.value.getBoundingClientRect().width)},{immediate:!0}),(o,a)=>(I(),B("div",{ref_key:"separator",ref:s,class:G(["separator",{"is-menu":t.isMenu}])},[(I(!0),B(ze,null,Ke(i.value,r=>(I(),B("div",{key:r,class:G(["bar",["bar-"+r]])},null,2))),128))],2))}},lo=q(kd,[["__scopeId","data-v-d0e76938"]]);const Td=["textContent"],Ao="https://www.cartier.com/thefabulouscartierjourney",Ed={__name:"Share",props:{score:{type:[String,Number],default:0}},setup(e){const t=e,s=M.$l("COPY-LINK-text"),i=new RegExp("{{SCORE}}","g"),n=new RegExp("{{URL}}","g"),o=Z(!1),a=ie(()=>M.$store.isMenuOpen?"menu":M.$store.isLastLevelScoreVisible?"endGame":"loose"),r=ie(()=>{const c=t.score,u=Ao;return s.replace(i,c).replace(n,u)});async function l(){M.$device.type.mobile&&navigator.share?(navigator.share({title:M.$l("SITE-title")||"The Fabulous Cartier Journey",url:Ao}),M.$trackEvent("shareMobile",{fromPage:a.value})):(navigator.clipboard&&navigator.clipboard.writeText(r.value),o.value=!0,M.$trackEvent("shareDesktop",{fromPage:a.value}),await Q(2e3),o.value=!1)}return(c,u)=>(I(),Te(xt,{color:"outline",text:F(M).$device.type.desktop?c.$l("END-share-desktop"):c.$l("END-share-mobile"),icon:"copy",class:G(["share-btn",{"is-copied":o.value}]),onClick:l},{default:wt(()=>[E("span",{class:"copied",textContent:Ie(c.$l("END-share-copied"))},null,8,Td)]),_:1},8,["text","class"]))}},co=q(Ed,[["__scopeId","data-v-7524880c"]]);const Pd=["aria-label"],Ld={class:"bar-container"},Ad={__name:"SoundButton",setup(e,{expose:t}){const s=Z(),i=[],n=Z(0),o=Z(!1);let a,r=0;const l=ie(()=>M.$store.isAudioMuted?M.$l("ARIA-enable-sound"):M.$l("ARIA-disable-sound"));He(()=>{}),xe(()=>{for(let d=0;d<s.value.length;d++)i.push(Math.random()+1*10);c(1e3)}),Xe(()=>{s.value.length=0});function c(d){r+=d;for(let f=0;f<s.value.length;f++){const b=s.value[f],p=i[f];n.value=to(n.value,M.$store.isAudioMuted?0:1,.01,d),a=(Math.sin(r*(.007+p*6e-5)+p*30)+1)*.6,b.style.transform=`scaleY(${.5+a*n.value})`}}function u(d){d!==o.value&&(o.value=d,d?yt.add(c):yt.remove(c))}function h(){M.$store.isAudioMuted=!M.$store.isAudioMuted}return t({toggleAnimation:u}),(d,f)=>(I(),B("button",{class:"button-sound","aria-label":l.value,onClick:h},[E("span",Ld,[(I(),B(ze,null,Ke(5,b=>E("span",{key:b,ref_for:!0,ref_key:"soundBars",ref:s,class:G(["sound-bar",`bar-${b}`])},null,2)),64))])],8,Pd))}},Od=q(Ad,[["__scopeId","data-v-f32aa0c6"]]);const Rd={class:"menu-list"},Dd={class:"share-container"},Id={class:"menu-utilities"},zd=["href","onClick"],Fd=["innerHTML"],Ud={__name:"AppMenu",setup(e){const{$webgl:t,$store:s,$router:i,$l:n}=M,o=m=>s.currentGameState===m,a=ae(null),r=ie(()=>s.currentScore+s.totalScore),l=ae(),c=ae("");He(async()=>{const m=o("Game")||o("Score")||o("EndGame")||o("Cinematic"),g=o("Lose");s.currentGameState?m?c.value=n("MENU-resume"):g?c.value=n("MENU-restart"):c.value=n("MENU-play"):c.value=n("MENU-play")}),Gi(()=>s.isMenuOpen,m=>{m&&l.value.computeSplittedText(c.value)},{immediate:!0});const u=[{text:n("MENU-terms"),url:n("MENU-terms-url"),onClick:()=>p("terms")},{text:n("MENU-legals"),url:n("MENU-legals-url"),onClick:()=>p("legals")}],h=[ct("Space",b,{once:!1}),ct("Escape",b,{once:!1})];pe(()=>s.isMenuOpen,m=>{m?h.forEach(g=>g.enable()):h.forEach(g=>g.disable())},{immediate:!0}),pe(()=>s.isMenuOpen,async m=>{await Q(m?0:500),a.value.toggleAnimation(m)});function d(m){if(m!=null&&m.target&&(m.target.blur(),m.target.disabled=!0,setTimeout(()=>{m.target.disabled=!1},3e3)),f(),!t.$store.hasStartedGameOnce)if(t.$store.savedChapter){const g=t.$store.savedChapter,y=t.getRouteFromLevel(g.name);return i.push({name:y||"Sea of Clouds"})}else return i.push({name:"Sea of Clouds"});if(o("Lose")){M.$store.currentScore=0,M.$store.isGameOverOpen=!1,requestAnimationFrame(()=>{M.$webgl.$game.state.set("Game",{force:!0});const x=bn(M.$store.totalScore);M.$store.previousScoreTensDigit=x[0],M.$store.previousScoreOnesDigit=x[1]});const g=t.$game.currentChapter.name,y=Un[g];M.$trackEvent("restartChapter",{chapter:`chapter${y}`,fromPage:"menu"})}}function f(m){m!=null&&m.target&&(m.target.blur(),m.target.disabled=!0,setTimeout(()=>{m.target.disabled=!1},3e3)),setTimeout(()=>{s.isMenuOpen=!1},20)}function b(m){s.isMenuOpen&&(m==="Space"&&d(),m==="Escape"&&f())}function p(m){const g=m==="terms"?"Terms":"Legals";M.$trackEvent(`access${g}`)}return(m,g)=>(I(),B("aside",{class:G(["menu",{"is-visible":F(s).isMenuOpen}]),"allow-touch-event":""},[E("div",Rd,[E("button",{class:"menu-link",onClick:d},[N(Md,{ref_key:"$$playButton",ref:l,text:c.value,appear:F(s).isMenuOpen},null,8,["text","appear"])]),N(lo,{"is-menu":!0}),E("div",Dd,[N(co,{score:r.value},null,8,["score"])]),E("div",Id,[(I(),B(ze,null,Ke(u,y=>E("a",{key:y.text,href:y.url,target:"_blank",rel:"noopener",class:"legals",onClick:y.onClick},[E("span",{class:"link-text",innerHTML:y.text},null,8,Fd)],8,zd)),64))])]),N(Od,{ref_key:"$$soundButton",ref:a},null,512)],2))}},Nd=q(Ud,[["__scopeId","data-v-98796e82"]]);const Bd=e=>(it("data-v-e42933b4"),e=e(),ot(),e),Vd={class:"panel-header"},Zd=["aria-label"],jd=Bd(()=>E("span",{class:"cross"},null,-1)),Hd=[jd],Gd={class:"panel-content"},Wd={__name:"Panel",props:{title:{type:String,default:null}},setup(e){const t=e,s=ae(null),i=ae(!1),n=ct("Escape",o,{once:!1});pe(()=>M.$store.isPanelOpen,l=>{l?n.enable():n.disable()},{immediate:!0}),pe(()=>M.$store.isPanelOpen,l=>{if(!l)return;const c=s.value.offsetWidth===window.innerWidth;M.$store.panelWidth=c?0:s.value.offsetWidth}),xe(()=>{i.value=!0,document.addEventListener("click",l=>a(l))}),Xe(()=>{document.removeEventListener("click",l=>a(l))});function o(l,c){c&&M.$store.isPanelOpen&&r()}function a(l){const c=s.value;if(!c)return;const u=c==l.target||c.contains(l.target),h=l.target.classList.contains("panel-button");!u&&!h&&r()}function r(l){l==null||l.target.blur(),M.$store.isPanelOpen=!1}return(l,c)=>i.value?(I(),Te(Ll,{key:0,to:".ui"},[E("aside",{ref_key:"panel",ref:s,class:G(["panel",{"is-open":l.$store.isPanelOpen}]),"allow-touch-event":""},[E("header",Vd,[E("button",{class:"button-close","aria-label":F(M).$l("ARIA-close"),onClick:r},Hd,8,Zd),E("h2",{class:G(["panel-title",{bypassSystemFont:F(M).$i18n.locale==="ja_jp"}])},[N(ds,{text:t.title,hoverable:!1,duration:2,appear:l.$store.isPanelOpen},null,8,["text","appear"])],2)]),E("div",Gd,[eo(l.$slots,"content",{},void 0,!0)])],2)])):Ae("",!0)}},qd=q(Wd,[["__scopeId","data-v-e42933b4"]]);const Yd={class:"discovery"},Kd={class:"container"},Xd=["src"],Qd={class:"lock"},Jd=["textContent"],eh={__name:"Discovery",props:{discovery:{type:Object,default:()=>({})},chapterIndex:{type:Number,default:1}},setup(e){const t=e;function s(i,n){const o=(t.chapterIndex-1)*2+n+1;t.discovery.isLocked||(window.open(i,"_blank"),M.$trackEvent("accessDiscovery",{discovery:o.toString()}))}return(i,n)=>(I(),B("div",{class:G(["discovery-wrapper",{"is-unlocked":!e.discovery.isLocked}]),onClick:n[0]||(n[0]=o=>s(e.discovery.link,e.discovery.index))},[E("div",Yd,[E("div",Kd,[E("figure",{class:G(["image",{"is-visible":!e.discovery.isLocked}])},[E("img",{src:e.discovery.image,alt:"Discovery"},null,8,Xd)],2),E("div",Qd,[E("div",{class:G(["lock-icon-wrapper",{"is-unlocked":!e.discovery.isLocked}])},[N(Ge,{name:"lock"})],2),E("div",{class:G(["lock-background",{"is-visible":e.discovery.isLocked}])},null,2)])])]),E("h4",{class:"discovery-title",textContent:Ie(e.discovery.name)},null,8,Jd)],2))}},th=q(eh,[["__scopeId","data-v-22f14dd3"]]);const $r=e=>(it("data-v-b7aabfe4"),e=e(),ot(),e),sh={class:"chapter-header"},nh=$r(()=>E("span",{class:"line line-left"},null,-1)),ih=["textContent"],oh=$r(()=>E("span",{class:"line line-right"},null,-1)),ah={class:"discoveries"},rh={__name:"DiscoveryChapter",props:{index:{type:Number,default:1}},setup(e){var a;const t=e,s=ie(()=>["I","II","III"][t.index-1]),i=ie(()=>M.$store.discoveries[`chapter${t.index}`]),n=(t.index-1)*2,{resolveUrl:o}=window.MM_EXPERIENCE_CONFIG;if(i.value.length===0)for(let r=0;r<2;r++)i.value.push({index:r,name:M.$l(`DISCOVERY-${n+r+1}`),image:o((a=M.$baluchon.get(`achievements/achievements-assets/achievement-${n+r+1}`))==null?void 0:a.url),link:M.$l(`DISCOVERY-${n+r+1}-url`),isLocked:!M.$user.discoveries[`chapter${t.index}`][r]});return(r,l)=>(I(),B("section",{class:G(["discovery-chapter","chapter-"+e.index])},[E("header",sh,[nh,E("h3",{textContent:Ie(s.value)},null,8,ih),oh]),E("div",ah,[(I(!0),B(ze,null,Ke(i.value,c=>(I(),Te(th,{key:c,discovery:c,"chapter-index":e.index},null,8,["discovery","chapter-index"]))),128))])],2))}},lh=q(rh,[["__scopeId","data-v-b7aabfe4"]]),ch={__name:"PanelDiscovery",setup(e){return(t,s)=>(I(),Te(qd,{title:t.$l("DISCOVERY-title")},{content:wt(()=>[(I(),B(ze,null,Ke(3,i=>N(lh,{key:i,index:i},null,8,["index"])),64))]),_:1},8,["title"]))}},uh=ch;const dh={class:"ui"},hh={__name:"App",setup(e){const{$store:s,$trackEvent:i,$webgl:n,$controls:o}=M;return xe(()=>{"orientation"in screen&&document.body&&(window.screen.orientation.onchange=function(){this.type.startsWith("landscape")&&document.documentElement.classList.contains("android")?document.body.webkitRequestFullscreen({navigationUI:"hide"}):document.webkitCancelFullScreen&&document.webkitExitFullscreen()}),o.listen()}),He(()=>{const a=document.querySelector(".xp-wrapper");a&&(s.isRegisterOpen||s.isAboutOpen||s.isMenuOpen?a.classList.add("is-content-hidden"):a.classList.remove("is-content-hidden"),s.isRegisterOpen||s.isAboutOpen?(a.classList.add("is-scrollable"),a.scrollTop=0):a.classList.remove("is-scrollable"),s.isRegisterOpen&&i("pageview",{page:"form"}),s.isAboutOpen&&i("pageview",{page:"about"}))}),He(()=>{var r;const a=(s.isOverlayVisible||s.isMenuOpen||s.isHeaderOpen||s.isAboutOpen)&&((r=n==null?void 0:n.$game)==null?void 0:r.state.is("Game"));as(()=>{var l;return(l=n==null?void 0:n.$game)==null?void 0:l.paused.set(a)})}),(a,r)=>{const l=So("NiceRouterView"),c=So("WebGL");return I(),B(ze,null,[E("div",dh,[N(l),N($u),N(Nd),N(xd),N(Fc),N(uh),N(Yc),N(Nc),N(Au)]),N(Cu),N(c),(I(),Te(En(F(null))))],64)}}},fh=q(hh,[["__scopeId","data-v-5c7061a0"]]),ph=typeof window<"u";function mh(e){if(!ph)e();else if(!window.isOldBrowser){const t=document;t.readyState[0]==="l"?t.addEventListener("DOMContentLoaded",e):e()}}function gh(e){const t=Al(e),s=t.config.globalProperties;Lc(t),pu(t),t.provide("appProps",s),t.provide("plugins",s);async function i(n){for(let o=0;o<n.length;o++){const a=Array.isArray(n[o])?n[o]:[n[o]],[r,l={}]=a;t.use(r(l),l)}return t.config.globalProperties}return Object.assign(t,{onDOMReady:mh,installPlugins:i,plugins:s}),t}const vh={},_h={class:"debug"};function yh(e,t){return Tn((I(),B("aside",_h,[eo(e.$slots,"default")],512)),[[Ol,e.$debug.active.value]])}const bh=q(vh,[["render",yh]]);function xh(e){if(!e.$viewport||!e.$gui)return;const t=(getComputedStyle(document.documentElement).getPropertyValue("--vitevue-debug-breakpoints")??"").split("|").reduce((n,o)=>{const[a,r]=o.split("=");return a.length>1&&r.length>1&&n.push([a,parseFloat(r)]),n},[]).sort((n,o)=>n[1]-o[1]);if(!t.length)return;const s=ie(()=>{const{width:n,height:o}=e.$viewport;return`${~~n}px x ${~~o}px`}),i=ie(()=>{const n=e.$viewport.width;for(let o=0;o<t.length;o++){const a=t[o];if(n<a[1])return o===0?`< ${a[0]}`:`[${t[o-1][0]} - ${a[0]}]`}return`>= ${t[t.length-1][0]}`});requestAnimationFrame(()=>{const n=e.$gui.app.addFolder({title:"CSS Breakpoints",index:0});n.addMonitor(s,"value",{label:"Dimensions"}),n.addMonitor(i,"value",{label:"Breakpoint"})})}function wh(e,t,s){const i=e[t].bind(e);e[t]=(...n)=>s(i,...n)}function fn(e,t){for(const s in t)e[s]&&wh(e,s,t[s])}function kt(e){!e.controller_.viewProps||e.onDispose||(e.onDispose=s=>e.controller_.viewProps.handleDispose((...i)=>s(e,...i)),e.onDispose(s=>s.disposed=s.destroyed=!0),Sh(e))}function Oo(e,t,s){s||(s=()=>e.refresh());const i=pe(t,s);e.onDispose(i)}function Ro(e,t,s){let i=!0;const n=a=>{s.value=a,i=!1,e.refresh()};e.on("change",a=>{t.set(a.value,i),i=!0});const o=t.watch(n);e.onDispose(()=>o.owner&&o.owner.unwatch(o))}function Sh(e){e.dispose&&zt()&&Pn(()=>e.dispose())}const $h="debug_folder_",Mh="debug_tab_";let Ch=0;const pn={addFolder(e,...t){const s=t[0]||{},i=s.title,n=$h+i.toLowerCase().replace(/\W/g,"");i&&(s.expanded=!!(localStorage.getItem(n)|0));const o=e(...t);return kt(o),i&&o.on("fold",a=>localStorage.setItem(n,+a.expanded)),o.setBackground=a=>o.element.style.backgroundColor=a,s.bg&&o.setBackground(s.bg),fn(o,pn),o},addInput(e,...t){const s=t[0],i=t[1];t[2]||(t[2]={});const n=t[2],o=s[i]&&s[i]._isStoreSignal;o&&(t[0]={value:s[i].value},t[1]="value",n.label||(n.label=i));const a=e(...t);return kt(a),n.reactive?$o(s)&&Oo(a,()=>s[t[1]]):o&&Ro(a,s[i],t[0]),a},addMonitor(e,...t){t[1]==null&&(t[1]="value"),t[2]||(t[2]={});const s=t[0],i=t[1],n=t[2],o=n.interval!=null,a=s[i],r=!o&&a&&a._isStoreSignal;r&&(n.interval=0,t[0]={value:a.value},t[1]="value",n.label||(n.label=i));let l=!r&&!o&&($o(a)||is(a)||is(s));!r&&!o&&is(s[i])&&(n.label||(n.label=i),t[0]=s[i],t[1]="value"),l&&(n.interval=0);const c=e(...t);return kt(c),r?Ro(c,a,t[0]):l&&Oo(c,()=>t[0][t[1]]),c},addButton(e,...t){const s=e(...t);return kt(s),s},addTab(e,...t){const s=++Ch,i=Mh+s,n=e(...t);kt(n);for(const p of n.pages)fn(p,pn);const o=localStorage.getItem(i)|0;n.pages[o]&&(n.pages[o].selected=!0);let a=new Set,r=!1;d();const l=n.addPage.bind(n),c=n.removePage.bind(n);n.addPage=p=>{const m=l(p);return fn(m,pn),d(),m},n.removePage=p=>{const m=c(p);return d(),m},n.onDispose(()=>{for(const p of a)h(p);for(const p of n.pages)h(p)});function u(p){a.has(p)||(a.add(p),p.controller_.props.value("selected").emitter.on("change",f))}function h(p){a.delete(p),p.controller_.props.value("selected").emitter.off("change",f)}function d(){for(const p of n.pages)!a.has(p)&&u(p);for(const p of a)!n.pages.includes(p)&&h(p)}function f(){r||(r=!0,Promise.resolve().then(b))}function b(){r=!1;for(let p=0;p<n.pages.length;p++)if(n.pages[p].selected)return localStorage.setItem(i,p)}return n},addSeparator(e,...t){const s=e(...t);return kt(s),s},addBlade(e,...t){const s=e(...t);return kt(s),s}};function kh(e){const t=new Rl.Pane(e);return t.registerPlugin(Dl),t.registerPlugin(Il),fn(t,pn),t}const Th={class:"debug-gui"},Eh={__name:"GUI",setup(e){const t=Z(),s=os("gui");return xe(()=>{s&&(s.container.classList.add("debug-gui-container"),t.value.appendChild(s.container))}),(i,n)=>(I(),B("aside",Th,[E("div",{ref_key:"base",ref:t,class:"debug-gui-scr"},null,512)]))}},Ph=Eh,Do=["addFolder","addInput","addMonitor","addButton","addTab","addSeparator","addBlade"];function Lh(){let e,t;const s={install:i,methods:Do,get pane(){return t},get container(){return e}};return s;function i(n){n.config.globalProperties.$gui=s,n.provide("gui",s),n.component("GUI",Ph),e=document.createElement("div"),t=kh({container:e});const o=t.addTab({pages:[{title:"MAIN"},{title:"APP"},{title:"WEBGL"}]}),a=o.pages;s.tab=o,s.mainPage=s.main=a[0],s.appPage=s.app=a[1],s.webglPage=s.webgl=a[2],Do.forEach(r=>{a[0][r]&&(s[r]=a[0][r].bind(a[0]))}),n.onBeforeMount(()=>{n.config.globalProperties.$webgl||s.tab.removePage(2)}),delete s.install}}const Io="debug_active";function Ah(){const e=Lh(),t=Z(),s={gui:e,active:t};function i(o){const a=o.target&&o.target.tagName;a==="INPUT"||a==="TEXTAREA"||o.key!=="t"||(t.value=!t.value)}function n(o){!o.touches||o.touches.length<3||(t.value=!t.value)}return function(a){a.config.globalProperties.$debug=s,a.provide("debug",s),a.component("Debug",bh),t.value=!!(localStorage.getItem(Io)|0),He(()=>localStorage.setItem(Io,+t.value)),window.addEventListener("keydown",i),window.addEventListener("touchstart",n),e.install(a),a.onBeforeMount(()=>xh(a.config.globalProperties))}}const Oh="force_locale",Rh=localStorage;function Dh(){const e="en_gb",t={},s=(window==null?void 0:window.MM_EXPERIENCE_CONFIG)??{},i=Rh.getItem(Oh),n={locale:null,current:null,locales:t,translate:r,getLocale:a,init:o};async function o(){n.locale=i??(s==null?void 0:s.lang)??e,n.locale=n.locale.replace("-","_"),n.current=await a(n.locale),n.current||(console.warn(`Locale ${n.locale} not found, fallback to ${e}`),s.lang=n.locale=e,n.current=await a(e))}async function a(l){if(t[l])return t[l];const c=`locales/${l}.json`,u=s.resolveUrl(c),h=await fetch(u).then(d=>d.json());return t[l]=h,h}function r(l,c=!1){const h=l.split(".").reduce((d,f)=>d?d[f]:null,n.current);return h||(c?h:"")}return function(c){c.provide("i18n",n);const u=c.config.globalProperties;u.$i18n=n,u.$l=n.translate}}const Ih=(e,t)=>(e.aliasOf||e)===(t.aliasOf||t),fs=e=>e,Mr=async({exitPrevious:e,toggleClass:t})=>{await e(),await t()},Cr=async({toggleClass:e,done:t})=>{e(),t()},zh={enter:1e3,leave:500,done:0},Bs=Symbol("CurrentNRV"),kr=Symbol("NRVComponentKey"),st=e=>{var t;return e===void 0?e=zt():e=(e==null?void 0:e.component)??e,(t=e==null?void 0:e.provides)==null?void 0:t[kr]},Fh=(e,{context:t,name:s}={})=>{const i={prefix:e,name:s??"",context:t,classes:{"enter-from":!1,"enter-active":!1,"enter-to":!1,"leave-active":!1}};return i.classes[e]=!0,s!=null&&(i.classes[e+`-${s}`]=!0),i},Uh=so({name:"NiceViewContainer",props:{tag:{type:String,default:"section"},name:{type:String,default:null},duration:{type:[Object,Number],default:null}},setup(e,{slots:t}){const s=zt(),i=s==null?void 0:s.provides[Bs],n=st();return e.name!=null&&(n.classes[n.prefix+"-"+n.name]=!1,n.name=e.name,n.classes[n.prefix+"-"+n.name]=!0),i&&n&&(n.containerInstance=s,e.duration!=null&&i.assignDurations(n.durations,e.duration),Xe(()=>{n.containerInstance===s&&(n.containerInstance=null)})),()=>Ni(e.tag,{class:n.classes??null},t.default())}}),Tr=so({name:"NRVComponentWrapper",inheritAttrs:!1,props:["context","name","duration"],setup(e,{slots:t}){const s=os(Bs),i=Fh(s.prefix,Nl(e));return ts(kr,i),Xe(()=>{i.enterCallback=Mr,i.leaveCallback=Cr,i.context=null}),t.default}}),Nh=so({name:"NiceViewManager",inheritAttrs:!1,props:{name:{type:String,default:"default"},customKey:{type:Function,default:null},useKeyIndex:{type:Boolean,default:!0},prefix:{type:String,default:"view"},route:{type:Object,default:null}},setup(e,{attrs:t}){const s=os(Mo),i=ie(()=>e.route||s.value),n=os(Co,0),o=ie(()=>{const{matched:v}=i.value;let $=F(n),P;for(;(P=v[$])&&!P.components;)$++;return $}),a=ie(()=>i.value.matched[o.value]);ts(Co,ie(()=>o.value+1)),ts(Bl,a),ts(Mo,i);const r=Z();pe(()=>[r.value,a.value,e.name],([v,$,P],[T,L,O])=>{$&&($.instances[P]=v,L&&L!==$&&v&&v===T&&($.leaveGuards.size||($.leaveGuards=L.leaveGuards),$.updateGuards.size||($.updateGuards=L.updateGuards))),v&&$&&(!L||!Ih($,L)||!T)&&($.enterCallbacks[P]||[]).forEach(D=>D(v))},{flush:"post"});const l=ae([]);let c=null,u={},h=0,d=null,f=0;zl(v=>(console.error(v),!1)),pe(()=>[i.value],([v])=>{var oe;const $=e.name,P=a.value,T=P&&((oe=P.components)==null?void 0:oe[$]);if(!P||!T)return;const L=p(v,P);if(L===c)return;c=L;const O=P.props[$],D=O?O===!0?v.params:typeof O=="function"?O(v):O:null,U=ue=>{var K;(K=ue.component)!=null&&K.isUnmounted&&(P.instances[$]=null)},A=Fl(P.name??T.__name),R=Pe({route:v,matchedRoute:P});let z=null;const Y=x(),ce=Ni(Tr,{name:A,context:R,key:L},()=>z=z||Ni(T,{...D,...t,onVnodeBeforeMount:Y.setup,onVnodeMounted:Y.mounted,onVnodeBeforeUnmount:Y.dispose,onVnodeUnmounted:U,ref:r}));l.value=[...l.value,ce]},{flush:"pre",immediate:!0});function b(){return l.value}function p(v,$){let P="",T=0;for(;T<v.matched.length;T++){const D=v.matched[T];if(P+=D.path,D===$)break}let L=v.fullPath;if(T<v.matched.length-1){u[P]||(u[P]=Ul([{name:"_",path:P}],{}).getRoutes()[0]);const D=u[P];L=D.stringify(D.params)}return L!==d&&(f=f+1|0),d=L,e.customKey?e.customKey({route:v,matchedRoute:$,computedFullPath:L,keyIndex:f}):e.useKeyIndex?f+"|"+L:L}function m(){let v=!1;const $=[];for(let P=0;P<l.value.length;P++){const T=l.value[P],L=T==null?void 0:T.component,O=st(T);T.__nrv_removable&&!O||L.isUnmounted||O!=null&&O.hasLeft?v=!0:$.push(T)}v&&(l.value=$)}function g(v={}){if(!Er())return{};const $=st();$.queueOptions=v}function y(v,$){if($!=null)if(typeof $=="number")for(let P in v)v[P]=$;else typeof $=="object"&&Object.assign(v,$)}function x(){let v,$,P=null;return{setup:T,mounted:L,dispose:O};function T(D){if(v=D==null?void 0:D.component,!!v){if($=st(v),!$)return{};if(!$.creating&&(as().then(()=>$.creating=!1),$.creating=!0,Object.assign($,{enterCallback:Mr,leaveCallback:Cr,setCSSEnterClass:fs,setCSSLeaveClass:fs,exitLastOnly:!1,durations:{...zh},isHMR:!!$.initialized,initialized:!0}),$.queueOptions)){const U=$.queueOptions;y($.durations,U.duration),U.exitLastOnly!=null&&($.exitLastOnly=!!exitLastOnly),typeof U.onEnter=="function"&&($.enterCallback=U.onEnter),typeof U.onLeave=="function"&&($.leaveCallback=U.onLeave),$.queueOptions=null}}}async function L(D,U){var $t,ut,Mt,Ut,js;if(!$||$.mounting)return;as().then(()=>$.mounting=!1),$.mounting=!0;const A=((ut=($t=$==null?void 0:$.containerInstance)==null?void 0:$t.vnode)==null?void 0:ut.el)??((Mt=v==null?void 0:v.vnode)==null?void 0:Mt.el);S(A,$.classes,{"enter-from":!0,"enter-active":!1}),A&&ir(A);const R=++h,z=l.value;let Y=-1,ce=z.length;for(let de=0;de<ce;de++){const et=z[de];if(st(et)===$){Y=de;break}}$.entering=!0;const oe=z[Y],ue=z.slice(0,Y);let K=!1;const ve=({lastOnly:de,params:et={}}={})=>{if(K)return;de=de??$.exitLastOnly,K=!0;const hs=ue.map(Vn=>C(Vn,oe,et));return de?hs[hs.length-1]:Promise.all(hs)},j=()=>R!==h||$.leaving||$.hasLeft||v.isUnmounted,ee=()=>{v.isUnmounted||S(A,$.classes,{"enter-from":!1,"enter-active":!1})};let Se=!1,Ue=null;$.setCSSEnterClass=({duration:de}={})=>Ue||(Ue=new Promise(et=>{de==null&&(de=$.durations.enter),Se=!0,$.setCSSEnterClass=fs,S(A,$.classes,{"enter-from":!1,"enter-active":!0}),de>0?setTimeout(()=>{v.isUnmounted||(ee(),et())},de):ee()}));let Je=null;$.setCSSLeaveClass=({duration:de}={})=>Je||(Je=new Promise(et=>{de==null&&(de=$.durations.leave),de=Math.max($.durations.done,de),$.cssLeftAt=performance.now(),$.cssLeftDuration=de,$.setCSSLeaveClass=fs,ee(),S(A,$.classes,{"leave-to":!0,"leave-active":!0}),de>0?setTimeout(()=>!v.isUnmounted&&et(),de):et()}));const Ft=((Ut=ue[ue.length-1])==null?void 0:Ut.component)??null,Zs=((js=st(Ft))==null?void 0:js.context)??null,We={el:A,from:Zs,to:$.context,isCancelled:j,exitPrevious:ve,toggleClass:$.setCSSEnterClass};await 0,!j()&&(await $.enterCallback(We),Se||ee(),$.enterCallback===fs&&ve())}function O(){$&&clearTimeout(P)}}function S(v,$,P){if(Object.assign($,P),!!(v!=null&&v.classList))for(let T in P)P[T]?v.classList.add(T):v.classList.remove(T)}function C(v,$,P){if(!v)return;let T=v.__nrv_removable;v.__nrv_removable=!0;const L=v.component;if(!L||L.isUnmounted)return m();const O=st(v);return!O||O.hasLeft?m():(O.leavingPromise||T||(O.leavingPromise=w(v,$,P)),O.leavingPromise)}async function w(v,$,P={}){var z,Y,ce;const T=v.component,L=st(v);L.leaving=!0;const O=((Y=(z=L==null?void 0:L.containerInstance)==null?void 0:z.vnode)==null?void 0:Y.el)??((ce=T==null?void 0:T.vnode)==null?void 0:ce.el);let D=!1;const U=Dt(),A={el:O,from:L.context,to:st($).context,toggleClass:L.setCSSLeaveClass,isCancelled:()=>T.isUnmounted,params:P,done:({delay:oe,duration:ue}={})=>(D||(D=!0,oe=oe??ue??L.durations.done,oe?Q(oe).then(U.resolve):U.resolve()),U)},R=Promise.resolve().then(()=>L.leaveCallback(A)).then(()=>{if(L.cssLeftAt){const oe=performance.now()-L.cssLeftAt,ue=L.cssLeftDuration-oe;if(ue>0)return new Promise(K=>setTimeout(K,ue))}});return R.then(()=>{L.hasLeft=!0,m()}),Promise.race([R,U])}return ts(Bs,{prefix:e.prefix,setNiceViewOptions:g,assignDurations:y}),b}});function Er(){const e=zt();return!(!(e==null?void 0:e.provides[Bs])||!((e==null?void 0:e.parent.vnode.type)===Tr)||!st())}function zo(e={}){const t=zt(),s=t==null?void 0:t.provides[Bs];return s?s.setNiceViewOptions(e):{}}function Bh(e,t){e.component("NiceViewContainer",Uh),t.setNiceViewOptions=zo,t.nrv=zo,t.isNiceView=Er}const Fo=(e,t=[],s=!1)=>{const i=e.querySelectorAll(".char");if(i.length)for(let n=0;n<i.length;n++){const o=i[n];if(s){const a=H.randomInt(0,i.length);o.style.setProperty("--i",a+1)}else o.style.setProperty("--i",n+1);t.push(o)}};const Vh={class:"fabulous"},Zh=["innerHTML"],jh=["innerHTML"],Hh={__name:"HomeTitle",setup(e,{expose:t}){const s=rs("The fabulous Cartier"),i=rs("Journey"),n=Z(),o=Z(),a=Z(!1),r=Z(!1),l=[],c=[];xe(()=>{Fo(n.value,l,!0),Fo(o.value,c,!0),M.$trackEvent("pageview",{page:"landing"})});function u(){a.value=!0}function h(){r.value=!0}return t({showTitle:u,hideTitle:h}),(d,f)=>(I(),B("h1",{class:G([{"is-visible":a.value,"is-hidden":r.value},"title"])},[E("span",Vh,[E("span",{ref_key:"fabText",ref:n,class:"text",innerHTML:F(s)},null,8,Zh)]),E("span",{class:G(["journey",{"has-subtitle":F(M).$l("LANDING-subtitle")}])},[E("span",{ref_key:"journeyText",ref:o,class:"text",innerHTML:F(i)},null,8,jh)],2)],2))}},Gh=q(Hh,[["__scopeId","data-v-79bab021"]]);const Wh={class:"home-subtitle"},qh=["innerHTML"],Yh={__name:"HomeSubtitle",setup(e){return(t,s)=>(I(),B("small",Wh,[E("span",{innerHTML:t.$l("LANDING-subtitle")},null,8,qh)]))}},Kh=q(Yh,[["__scopeId","data-v-2323a751"]]);const Xh={class:"page page-home","allow-touch-event":""},Qh={class:"home-content"},Jh={class:"content-description"},ef=["aria-label","innerHTML"],tf={__name:"Home",setup(e){const{$router:t,$store:s,$webgl:i,$audio:n,$l:o,$trackEvent:a}=M,r=ae(!1),l=ae(!1),c=ae(),u=o("LANDING-text"),h=o("LANDING-text"),d=o("ligation")?h:rs(h);t.nrv({onEnter:p,onLeave:m,duration:{enter:2500,leave:1500}}),or(()=>{l.value=!1}),xe(async()=>{i.$game.state.set("Intro",{force:!0})});const{unwatch:f}=ct(["Space","Enter"],b,{once:!1});function b(y,x){s.isHeaderOpen||s.isPanelOpen||s.isAboutOpen||s.isRegisterOpen||s.isMenuOpen||x.includes(!0)&&l.value&&g()}async function p({isCancelled:y,exitPrevious:x,toggleClass:S}){if(x({lastOnly:!0}),!s.hasVisitedHome){if(y())return;await Q(1e3),s.isReadabilityNeeded=!0,r.value=!0,await Q(3e3),r.value=!1,await Q(750)}c.value.showTitle(),await Q(2200),s.hasVisitedHome=!0,await S(),l.value=!0}async function m({toggleClass:y}){y(),await Q(500),c.value.hideTitle(),s.isReadabilityNeeded=!1}function g(){t.push({name:"Sea of Clouds"}),n.playSound("sfx_Result_Exit"),f(),a("startGame",{fromPage:"landing"})}return(y,x)=>(I(),B("section",Xh,[N(ds,{class:G(["home-presentation",{bypassSystemFont:F(M).$i18n.locale==="ja_jp"}]),text:F(o)("LANDING-intro"),appear:r.value,hoverable:!1,duration:1.5},null,8,["class","text","appear"]),E("div",Qh,[N(Gh,{ref_key:"title",ref:c},null,512),E("div",Jh,[E("p",{ref_key:"description",ref:h,class:"description","aria-label":F(u),innerHTML:F(d)},null,8,ef),N(xt,{text:F(o)("LANDING-cta"),variant:"underline",class:"start",onClick:g},null,8,["text"])]),N(Kh)])]))}},sf=q(tf,[["__scopeId","data-v-8bef17bd"]]);const nf=["textContent"],of={__name:"Subtitle",props:{text:{type:String,default:null}},setup(e,{expose:t}){const s=e,i=ae(),n=Z(!0);function o(){n.value=!1}function a(){n.value=!0}function r(l){n.value=!l}return t({show:o,hide:a,toggle:r}),(l,c)=>(I(),B("small",{ref_key:"subtitle",ref:i,class:G(["subtitle",{"is-hidden":n.value}]),textContent:Ie(s.text)},null,10,nf))}},uo=q(of,[["__scopeId","data-v-8423665e"]]),af={autostart:!0,standalone:!0,selfdestruct:!0};function Nn(){const e=[],t=[];return zt()&&Xe(a),{setTimeout:s,setInterval:i,wait:o,timer:n,clearTimers:a};function s(r,l){const c=window.setTimeout(r,l);return e.push(c),c}function i(r,l){const c=window.setInterval(r,l);return t.push(c),c}function n(r,l,c){if(c){const u=Vl(r,l,af);return e.push(u),u}else{const u=s(l,r);return e.push(u),u}}function o(r,l){return new Promise(c=>n(r,c,l))}function a(){for(let r=0,l=e.length;r<l;r++){const c=e[r];c.dispose?c.dispose():clearTimeout(c)}for(let r=0,l=t.length;r<l;r++)clearInterval(t[r]);t.length=0,e.length=0}}let Xt=new WeakMap,Uo=new ResizeObserver(rf),vt;function Pr(e){const t=e[1];t.w===vt.w&&t.h===vt.h||(e[1].width=vt.w,e[1].height=vt.h,e[0]&&e[0](e[1]))}function rf(e){for(let t=0;t<e.length;t++){const s=e[t],i=s.target,n=Xt.get(i),o=s.contentRect.width,a=s.contentRect.height;n.w===o&&n.h===a||(vt=n,vt.w=o,vt.h=a,n.items.forEach(Pr))}}function lf(e={}){typeof e=="function"&&(e={cb:e});const t=e.cb,s=e.ref??ae(),i=Qe({width:0,height:0}),n=[t,i];let o=null;return xe(()=>{s.value&&(o=s.value,Xt.has(o)?(Xt.get(o).items.add(n),vt=n,Pr(n)):(Xt.set(o,{items:new Set([n]),w:0,h:0}),Uo.observe(o)))}),Xe(()=>{if(!o)return;const a=Xt.get(o);a.items.delete(n),a.items.size||(Xt.delete(o),Uo.unobserve(o))}),{ref:s,size:i}}const cf=e=>(it("data-v-55d3f7bd"),e=e(),ot(),e),uf={class:"score-counter-wrapper"},df={key:0,class:"score-counter-target"},hf=cf(()=>E("span",{class:"divider"},"/",-1)),ff={class:"text"},pf={__name:"ScoreCounter",props:{score:{type:Number,default:0},isMaxScoreVisible:{type:Boolean,default:!1}},setup(e,{expose:t}){const s=e;let i=null;const{wait:n}=Nn(),o=Array(20).fill().map((p,m)=>m%10),{$store:a}=M,r=a.maxScore,l=Math.min(a.previousTotalScore,r),c=ae(),u=ae(),h=Z(),d=Z(a.previousScoreTensDigit),f=Z(a.previousScoreOnesDigit);async function b(){ir(h.value);const p=bn(l),m=Math.min(s.score||a.totalScore,r),g=bn(m);(g[1]<p[1]||g[1]===p[1]&&m>l||g[0]>p[0]&&p[0]!==0)&&u.value.classList.add("force-tour"),d.value=a.previousScoreTensDigit=g[0],f.value=a.previousScoreOnesDigit=g[1],await n(3e3)}return pe(()=>M.$viewport.width,()=>{h.value&&(h.value.classList.add("resize-animation-stopper"),i=setTimeout(()=>{h.value.classList.remove("resize-animation-stopper")},100))}),t({show:b}),Xe(()=>{clearTimeout(i),i=null}),(p,m)=>(I(),B("div",{ref_key:"$$base",ref:h,class:"score-counter",style:Bi({"--tensDigitTranslate":`calc(${+d.value}0% / 2)`,"--onesDigitTranslate":`calc(${+f.value}0% / 2)`})},[E("div",uf,[E("div",{ref_key:"$$tensContainer",ref:c,class:"score-counter-container"},[(I(!0),B(ze,null,Ke(F(o),(g,y)=>(I(),B("span",{key:y},Ie(g),1))),128))],512),E("div",{ref_key:"$$onesContainer",ref:u,class:"score-counter-container"},[(I(!0),B(ze,null,Ke(F(o),(g,y)=>(I(),B("span",{key:y},Ie(g),1))),128))],512)]),e.isMaxScoreVisible?(I(),B("div",df,[hf,E("span",ff,Ie(F(r)),1)])):Ae("",!0)],4))}},ho=q(pf,[["__scopeId","data-v-55d3f7bd"]]);const mf=["innerHTML"],gf=["textContent"],vf={class:"buttons"},_f={class:"end-replay"},yf={__name:"ScoreWrapperEnd",props:{end:{type:Boolean,default:!1}},setup(e){const t=e,{$store:s,$audio:i,$webgl:n,$l:o,$trackEvent:a}=M,{wait:r}=Nn(),l=Z(),c=Z(),u=Z(""),h=Z(""),d=Z();let f=0;const b=ct("Space",g,{enabled:!1});or(()=>{t.end?(u.value=o("WIN-title"),h.value=o("WIN-text"),f=s.totalScore):(u.value=o("LOOSE-title"),h.value=o("LOOSE-text"),f=s.totalScore+s.currentScore,a("loseScore",{score:`${f}`}))}),xe(async()=>{await r(100),s.isGameOverOpen=!0,t.end&&n.$game.state.set("EndGame",{force:!0}),await r(1e3),await l.value.show(),b.enable()});async function p(y){if(n.$game.state.is("Game"))return;s.isBigReadabilityNeeded=!1,y!=null&&y.target&&(y.target.blur(),y.target.disabled=!0,setTimeout(()=>{y.target.disabled=!1},3e3)),t.end?(s.totalScore=0,s.currentScore=0,M.$router.push({name:"Sea of Clouds"}),s.previousTotalScore=0,Object.values(s.finishedLevels).map(()=>!1),s.previousScoreTensDigit=0,s.previousScoreOnesDigit=0,s.isGameOverOpen=!1):(s.currentScore=0,s.isGameOverOpen=!1,i.playSound("sfx_Result_Exit"),requestAnimationFrame(()=>{n.$game.state.set("Game",{force:!0});const C=bn(s.totalScore);s.previousScoreTensDigit=C[0],s.previousScoreOnesDigit=C[1]}));const x=n.$game.currentChapter.name,S=Un[x];M.$trackEvent("restartChapter",{chapter:`chapter${S}`,fromPage:"loose"})}function m(y){var x;(x=y==null?void 0:y.target)==null||x.blur(),s.isRegisterOpen=!0}function g(){s.isHeaderOpen||s.isPanelOpen||s.isAboutOpen||s.isRegisterOpen||s.isMenuOpen||p()}return(y,x)=>(I(),B("div",{class:G(["gameover",{"is-end":t.end,"is-visible":F(s).isGameOverOpen}])},[E("h1",{ref_key:"endTitle",ref:d,class:"end-title"},[N(ds,{ref_key:"title",ref:c,class:G(["end-title-reveal-text",{colored:t.end}]),text:u.value,hoverable:!1,appear:t.end&&F(s).isGameOverOpen},null,8,["class","text","appear"])],512),E("p",{class:"end-subtitle",innerHTML:h.value},null,8,mf),N(ho,{ref_key:"$$scoreCounter",ref:l,score:F(f),"is-max-score-visible":!0},null,8,["score"]),E("p",{class:"wish",textContent:Ie(t.end?F(o)("END-text-alt"):F(o)("END-text"))},null,8,gf),E("div",vf,[N(co,{score:F(f)},null,8,["score"]),N(xt,{color:"outline",text:F(o)("END-participate"),class:"participate-btn",onClick:m},null,8,["text"])]),E("div",_f,[N(lo,{count:25}),N(xt,{variant:"underline",text:F(o)("END-replay"),class:"replay-btn",onClick:p},null,8,["text"])])],2))}},bf=q(yf,[["__scopeId","data-v-565ce456"]]);const xf={key:0,class:"lose-screen"},wf={__name:"Lose",setup(e,{expose:t}){const s=ae(!1);function i(){s.value=!0}function n(){s.value=!1}function o(r){var l;(l=r.querySelector(".end-title-reveal-text"))==null||l.classList.add("appear")}function a(r){var l;(l=r.querySelector(".end-title-reveal-text"))==null||l.classList.remove("appear")}return t({show:i,hide:n}),(r,l)=>(I(),Te(zs,{name:"lose",duration:{enter:2500,leave:2500},appear:"",onEnter:o,onLeave:a},{default:wt(()=>[s.value?(I(),B("section",xf,[N(bf)])):Ae("",!0)]),_:1}))}},fo=q(wf,[["__scopeId","data-v-6922a15e"]]);const Sf={class:"score-result-wrapper"},$f={class:"score-result-container"},Mf=["innerHTML"],Cf={class:"infos"},kf=["innerHTML"],Tf={class:"desc"},Ef=["innerHTML"],Pf=["innerHTML"],Lf={class:"next-chapter"},Af={__name:"ScoreResult",setup(e,{expose:t}){const{wait:s,setTimeout:i}=Nn(),{$store:n,$audio:o,$webgl:a,$trackEvent:r}=M,l=Z(!1),c=a.$game.currentChapter.name,u=Un[c],h=ae();xe(()=>{r("reachEndChapter",{chapter:`chapter${u}`})});const d=ct("Space",m,{once:!1,enabled:!1});function f(g,y=!1){g!=null&&g.target&&(g.target.blur(),g.target.disabled=!0,i(()=>{g!=null&&g.target&&(g.target.disabled=!1)},3e3)),!(!l.value&&!y)&&(l.value=!1,n.isBigReadabilityNeeded=!1,d.unwatch(),o.playSound("sfx_Result_Exit"),a.$game.goToNextLevel())}function b(){n.isRegisterOpen=!0}async function p(){if(n.isOnLastLevel)return d.unwatch(),await s(800),f(null,!0);l.value=!0,await h.value.show(),d.enable()}function m(g,y){setTimeout(()=>{n.isHeaderOpen||n.isPanelOpen||n.isAboutOpen||n.isRegisterOpen||n.isMenuOpen||!y&&f()},50)}return t({show:p,continueChapter:f}),(g,y)=>(I(),B("div",{class:G(["score-result",{"is-visible":l.value}])},[N(Ge,{name:"fadeCircle"}),E("div",Sf,[E("div",$f,[E("p",{class:"score-result-container-text",innerHTML:g.$l("CHAPTER-END-score")},null,8,Mf),N(ho,{ref_key:"$$scoreCounter",ref:h},null,512)]),E("div",Cf,[E("p",{class:"title",innerHTML:g.$route.name=="Sea of Clouds"?g.$l("CHAPTER-END-1-title"):g.$l("CHAPTER-END-2-title")},null,8,kf),E("div",Tf,[E("a",{class:"register-link",onClick:b},[E("span",{class:"register-text",innerHTML:g.$l("CHAPTER-END-textA")},null,8,Ef)]),nr("Â Â "),E("span",{class:"infos-text",innerHTML:g.$l("CHAPTER-END-textB")},null,8,Pf)])])]),E("div",Lf,[N(lo),N(xt,{variant:"underline",text:g.$l("CHAPTER-END-cta"),class:"next-btn",onClick:f},null,8,["text"])])],2))}},Of=q(Af,[["__scopeId","data-v-ec16f032"]]);const Rf=["src"],Df={__name:"ScoreDialDiscovery",props:{type:{type:String,default:"top",validator(e){return["top","bottom"].includes(e)}}},setup(e,{expose:t}){const s=e,i=M.$webgl.$game.currentChapter.name,n=Un[i],o=M.$store.discoveries[`chapter${n}`],a=(n-1)*2,r=ie(()=>o[s.type==="bottom"?0:1].image),l=ie(()=>o[s.type==="bottom"?0:1].isLocked);function c(h){o[h].isLocked=!0}function u(h){if(!o.includes(o[h]))return;const d=o.indexOf(o[h]),f=a+d+1;M.$trackEvent("unlockDiscovery",{discovery:f.toString()}),M.$user.discoveries[`chapter${n}`][h]=!0,o[h].isLocked=!1,M.$store.isPanelOpen||(M.$store.hasNotification=!0)}return t({unlockDiscovery:u,lockDiscovery:c}),(h,d)=>(I(),B("div",{class:G(["score-dial-discovery",s.type])},[E("div",{class:G(["lock",{"is-unlocked":!l.value}])},[N(Ge,{name:"lock"})],2),E("figure",{class:G(["image",{"is-unlocked":!l.value}])},[E("img",{src:r.value,alt:""},null,8,Rf)],2)],2))}},If=q(Df,[["__scopeId","data-v-c524dbd7"]]);let qn,zf=1;function Ff({format:e=ar,name:t,depth:s=!0,stencil:i=null,width:n,height:o,scale:a=1,srgb:r=!1,colorSpace:l=rr,generateMipmaps:c=!1}={}){qn||(qn=St());const u=qn.$renderer.drawingBufferSize;t==null&&(t=`RenderTarget.${zf++}`);let h=!1,d=!1,f;n&&o&&g(n,o),(!n||!o)&&y(a),r&&(l=lr),f=new bt(n,o,{minFilter:As,magFilter:As,format:e,colorSpace:l,depthBuffer:!!s,stencilBuffer:!!(i??s)}),f.texture.generateMipmaps=!!c;const b=f.setSize.bind(f);f.setSize=g,f.setScale=y;const p=f.dispose.bind(f);f.dispose=v,f.texture.name=t,f.clone=m;function m(){console.warn("clone() is disabled for RTs created with createBuffer()")}function g($=0,P=0){P||(P=$),!($<=0)&&(n=$,o=P,S(),f&&C())}function y($=0){$<=0||(a=$,x(),w())}function x(){d||(d=!0,u.watch(w))}function S(){d&&(d=!1,u.unwatch(w))}function C(){f.texture.width===n&&f.texture.height===o||(h=!0,b(n,o),h=!1)}function w(){n=Math.floor(u.value.x*a),o=Math.floor(u.value.y*a),f&&C()}function v(){p(),!h&&S()}return f}const Uf=new Int8Array([-1,-1,4,-1,-1,4]),po=new cs;po.setAttribute("position",new tt(Uf,2));const No=()=>{};function Nf(){const e={createBuffer:t,registerBuffer:No,unregisterBuffer:No};function t(s){return Ff(s)}return function(i){i.$fbo=e}}function Bf(){const e="webgl_quality";let o=58,a=52,r=30,l=300,c=300,u=0,h=0,d=!1,f=!1,b=5,p=5,m=10;const g=new Float64Array(3);let y=0;const x=new Float64Array([-1,-1,-1]);let S=0,C=0,w=!1;const v=te(60),$=te(60),P=te(1);_.hooks.afterInit.watchOnce(R),_.hooks.beforeStart.watchOnce(z);const T={get pingPongScore(){return S},get bigPingPongScore(){return C},fps:v,fpsAverage:$,quality:P,current:P,pause:U,resume:A,reset:(j=300)=>Y(!1,j),hardReset:(j=300)=>Y(!0,j),updateQuality:ve,limitQuality:j=>{p=be(j,0,5),ve()},setThresholds:L};function L(j={}){j.high&&(o=j.high),j.low&&(a=j.low),j.critical&&(r=j.critical)}function O(){const j=localStorage.getItem(e);return j!=null&&!isNaN(j)?j|0:null}function D(j){localStorage.setItem(e,j)}function U(){w=!0}function A(j=150){w=!1,Y(!1,j)}function R(){const j=_.$app.$device,ee=j&&j.gpu?j.gpu.qualityIndex:3,Se=O(),Ue=Se??ee;P.watch(Je=>{j&&j.updateQuality(Je),D(Je)}),K(Ue),_.hooks.beforeFrame.watch(oe)}async function z(){_.$viewport.visible.watch(()=>Y());const j=_.$viewport.size.value;let ee=j.x*j.y;_.$viewport.changed.watch(()=>{const Se=_.$viewport.size.value,Ue=Se.x*Se.y;Math.abs(ee-Ue)<2e5?Y(!1,300):(ee=Ue,Y(!0,300))})}function Y(j,ee){d=!0,f=f||j,ee&&(l=ee)}function ce(){u=0,h=0,f&&(b=5,y=0,S=0,C=0),c=l||300,d=f=!1,l=300}function oe(){if(m>0)return m--;const j=_.$time.qualityDt;if(d&&ce(),c>0)return c-=j;u+=j,h++,u>=1e3&&ue()}function ue(){w||(g[y++]=h,y=y%(g.length+1)),v.set(h),h=0,u=u%1e3,!w&&y==g.length&&ve()}function K(j){x[2]=x[1],x[1]=x[0],x[0]=j,P.set(j)}function ve(j){let ee=x[0];const Se=ko(g);j?ee=j:Se<=r?ee-=2:Se<a?ee-=1:Se>o&&(ee+=1),ee=be(ee,0,Math.min(p,b)),ee===x[0]?(S=Math.max(0,S-.2),C=Math.max(0,C-.2)):ee!==x[0]&&ee!==x[1]?S=0:ee===x[1]&&(S+=1),ee===x[2]&&ee<x[0]&&C++,S>=2&&(b=Math.min(x[1],x[0],b,p),S=0),C>=2&&(b=Math.min(ko(x),b,p),C=0),ee=Math.min(ee,b,p),ee!==P.value&&K(ee),$.set(Se)}return function(ee){ee.$quality=T}}const Bo={"720p":1280*720,"1080p":1920*1080,"1440p":2560*1440,"2k":2560*1440,"3k":2880*1620,"4k":3840*2160,"5k":5120*2880,"8k":7680*4320};function Vf(){let e;const t=new V(16777215),s=te(new X),i=te(1);let n=1,o=2,a=Bo["3k"];const r={antialias:!1,alpha:!1,depth:!0,stencil:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"},l={beforeInit:he(),afterInit:he()},c={init:u,options:r,hooks:l,clearColor:t,resize:m,setMinPixelRatio:h,setMaxPixelRatio:d,setMaxPixelCount:f,drawingBufferSize:s,pixelRatio:i,forceWebGL1:!1};function u(){r.canvas=_.canvas,l.beforeInit.emit();const y=c.forceWebGL1?Zl:jl;e=new y(r),e.debug={checkShaderErrors:!1},_.$renderer.instance=e,_.threeRenderer=e,c.isWebGL2=!!e.capabilities.isWebGL2,e.getDrawingBufferSize(s.value),m(),e.setClearColor(t,1),e.autoClear=!1,e.shadowMap.enabled=!1,e.shadowMap.type=Hl,e.info.autoReset=!1,_.hooks.beforeFrame.watch(()=>e.info.reset()),l.afterInit.emit(),_.$viewport.changed.watch(m)}function h(y){n!==y&&(n=y,p())}function d(y){o!==y&&(o=y,p())}function f(y){if(typeof y=="string"){if(y=Bo[y.toLowerCase()],!y)return}else y==null&&(y=0);a=y,p()}let b=!1;function p(){b||(b=!0,_.hooks.beforeFrame.watchOnce(m))}function m(){b=!1;let y=be(_.$viewport.pixelRatio.value,n,o);const x=_.$viewport.size.value,S=X.get();let C=y*x.x*x.y;a>0&&C>a&&(y/=C/a),e.getSize(S),e.getPixelRatio()!==y&&e.setPixelRatio(y),S.equals(x)||e.setSize(x.x,x.y),g(),S.release()}function g(){const y=s.value,x=X.get();e.getDrawingBufferSize(x),cr(),x.equals(y)||s.set(y.copy(x),!0),i.set(e.getPixelRatio()),x.release(),ur()}return function(x){x.$renderer=c,x.threeRenderer=e}}const Zf=Number.MAX_SAFE_INTEGER,Vo=[30,60,120,144,240].map(e=>(e=1e3/e,[e+.75,e,e-.75]));function jf(){const e=Hs(20),t=Hs(6);let s=!1,i=performance.now();const n=Hs(20);let o=0,a=0,r=0;const l=Hs(6);_.hooks.afterInit.watchOnce(()=>{_.$viewport&&_.$viewport.visible.watch(()=>s=!0)}),_.hooks.afterFrame.watchOnce(()=>{s=!0});const c={dt:0,qualityDt:0,clampedDt:0,averageDt:16.6667,stableDt:16.6667,elapsed:0,stableEt:0,pausedElapsed:0,frameNum:0,isPaused:!0,isStarted:!0,timeScale:1,clampFps:0,set clampTo60Fps(m){c.clampFps=m?60:0},init:u,start:f,stop:b,resume:h,pause:d,customLoop:null};function u(){c.customLoop?c.customLoop(p):yt.add(p),c.isStarted=!0,c.isPaused=!1}function h(){c.isPaused=!1}function d(){c.isPaused=!0}function f(){c.isStarted=!0}function b(){c.isStarted=!1}function p(m){const g=i;if(i=performance.now(),m=i-g,m===0&&(m=16.6667),s&&(s=!1,m=16.6667,e.reset(),t.reset(),l.reset(),a=o=r=0,n.reset()),c.clampFps>0){const x=n.push(m),S=1e3/c.clampFps,C=Math.max(0,S-x);if(a+=C,a>=S){o=0,a=Math.max(0,a-S),r+=m;return}o>=10?a=o=0:o+=1,m+=r,r=0}c.qualityDt=l.push(m),c.clampedDt=be(m===void 0?16.6667:m,1,130),c.averageDt=e.push(m);let y=c.averageDt;for(let x=0,S=Vo.length;x<S;x++){const C=Vo[x];if(y>=C[2]){y<=C[0]&&(y=C[1]);break}}c.stableDt=t.push(y)*c.timeScale,c.dt=m*c.timeScale,c.frameNum=(c.frameNum+1)%Zf,c.elapsed+=m*c.timeScale,c.stableEt+=c.stableDt,c.isStarted&&(c.isPaused||(c.pausedElapsed+=m*c.timeScale),_.frame())}return function(g){g.$time=c}}function Hf(){const e=_.$app.$viewport,t=te(new X(e.width,e.height)),s=te(t.value.x/t.value.y),i=te(e.pixelRatio),n=te(e.visible),o=he(),a={size:t,visible:n,ratio:s,pixelRatio:i,changed:o,resize:h,useManualResize:!1,frame:f};let r=0,l=0,c=0;const u=no(()=>d(),150);pe(e,()=>{a.useManualResize||h(e.width,e.height)},{immediate:!0}),Gl(()=>{n.set(e.visible)});function h(b=null,p=null){_.canvas.style.width=(b??e.width)+"px",_.canvas.style.height=(p??e.height)+"px",u()}function d(){r=e.width,l=e.height,c=e.pixelRatio}_.hooks.beforeFrame.watch(f);function f(){const b=t.value,p=b.x!==r||b.y!==l,m=i.value!==c;!p&&!m||(cr(),p&&(b.set(r,l),t.set(b,!0),s.set(b.x/b.y)),m&&i.set(c),o.emit(),ur())}return function(p){p.$viewport=a}}function Gf(e){const t=_.threeRenderer.capabilities.isWebGL2,s=new Wl(e.img);return e.flipY!==void 0&&(s.flipY=e.flipY),e.mipmaps!==void 0&&(s.generateMipmaps=e.mipmaps??!0),e.red&&(e.format=t?ql:Yl),e.alpha&&(e.format=Kl),e.nearest&&(s.magFilter=s.minFilter=Vi),e.linear&&(s.magFilter=s.minFilter=As),e.magFilter&&(s.magFilter=e.magFilter),e.minFilter&&(s.minFilter=e.minFilter),e.encoding&&(s.encoding=e.encoding),e.colorSpace&&(s.encoding=e.colorSpace),e.data&&(e.srgb=!1),e.srgb===!0?s.colorSpace=lr:(e.srgb===!1||e.data)&&(s.colorSpace=rr),e.mapping&&(s.mapping=e.mapping),e.premultiplyAlpha&&(s.premultiplyAlpha=!0),e.repeat?(s.wrapS=Zi,s.wrapT=Zi):(e.wrapS&&(s.wrapS=e.wrapS),e.wrapT&&(s.wrapT=e.wrapT)),e.format&&(s.format=e.format),e.type&&(s.type=e.type),s.needsUpdate=!0,s}function Zo(e,t,s,i=0){const n=t.size,o=t.scale,a={},r=e.anchor||e.pivot||{x:.5,y:.5};s.split("_")[0]==="hint"&&(r.x=0,r.y=0);const u=e.frame,h=e.sourceSize,d=e.spriteSourceSize;a.id=s;const f=s.split("/");a.sequence=f.pop(),a.group=f.join("/"),a.frameIndex=i,a.texCoords=new Float32Array([u.x/n.w,(n.h-u.y-u.h)/n.h,u.w/n.w,u.h/n.h]),a.meshCoords=new Float32Array([d.w*.5+d.x-h.w*r.x,-(d.h*.5+d.y-h.h*r.y),d.w,d.h]);for(let b=0,p=a.meshCoords.length;b<p;b++)a.meshCoords[b]*=o;return a.anchor=r,a.sourceSize=e.sourceSize,a.spriteSourceSize=e.spriteSourceSize,e.vertices&&(a.vertices=e.vertices,a.verticesUV=e.verticesUV,a.triangles=e.triangles,a.geo=qf({frame:u,size:n,...a})),a}function Wf(e,t={}){const s={sprites:{},meta:e.meta},i=e.frames,n=t.keepRatio==null?!0:t.keepRatio;e.animations||(e.animations={});for(const o in e.animations){const a=e.animations[o],r=s.sprites[o]=[];for(let l=0,c=a.length;l<c;l++){const u=i[a[l]];u.keepRatio=n,delete i[a[l]],r.push(Zo(u,e.meta,o,l))}}for(const o in i){const a=i[o];a.keepRatio=n;const l=(a.filename?a.filename.toString():o).replace(/[^a-zA-Z0-9-_-]/g,"").replace("png",""),c=s.sprites[l]=[];delete i[o],c.push(Zo(a,e.meta,l,0))}return s}function qf(e){const t=new cs,{vertices:s,verticesUV:i,triangles:n,frame:o,spriteSourceSize:a,texCoords:r,size:l}=e,c=e.anchor||e.pivot||{x:.5,y:.5},u=[],h=[],d=[],f=[],b=a.w>a.h?a.w/a.h:1,p=a.h>a.w?a.h/a.w:1;for(let m=0;m<s.length;m+=1){let[g,y]=s[m];g-=a.x+a.w*c.x,y-=a.y+a.h*c.y,g=g/a.w,y=1-y/a.h,g*=b,y*=p,u.push(g,y,0),d.push(0,0,1)}for(let m=0;m<i.length;m+=1){let[g,y]=i[m];g=g/l.w,y=1-y/l.h,f.push(g,y)}for(let m=0;m<n.length;m+=1){const[g,y,x]=n[m];h.push(g,x,y)}return t.setAttribute("position",new Zn(u,3)),t.setAttribute("normal",new Zn(d,3)),t.setAttribute("uv",new Zn(f,2)),t.setIndex(h),t}let Yf=new Xl;async function Wi(e,{onLoad:t}){return new Promise((s,i)=>{Yf.load(e,n=>{Ln.add(e,n),t&&t(n),s(n)},()=>{},i)})}Wi.loader={name:"exr",extensions:[".exr"],function:Wi};const Lr=new Ql;async function Os(e,t={}){return new Promise((s,i)=>{Lr.load(e,n=>{Ln.add(e,n),t.onLoad&&t.onLoad(n),s(n)},()=>{},i)})}Os.initDRACOLoader=()=>{const e=new Jl,{resolveUrl:t}=window.MM_EXPERIENCE_CONFIG;e.setDecoderPath(t("vendors/draco/")),e.preload(),Lr.setDRACOLoader(e)};Os.loader={name:"gltf",extensions:[".gltf",".glb"],function:Os};function qi(e,t){return new Promise(s=>{const i=new Image;i.loading="eager";const n=setTimeout(()=>{},1),o=()=>{clearTimeout(n);const r={node:i,url:e};t.onLoad&&t.onLoad(r),Ln.add(e,r),s(r)},a=r=>{};e.indexOf(location.host)===-1&&(i.crossOrigin="anonymous"),i.onload=o,i.onerror=a,i.decoding="async",i.src=e})}qi.loader={name:"image",extensions:[".jpg",".png",".webp",".avif",".gif",".jpeg"],function:qi};let ps;function Ar(){if(ps)return ps;ps=new ec;const e=tc("vendors/basis/");return ps.setTranscoderPath(e),ps}async function Rs(e,t={}){return new Promise((s,i)=>{Ar().load(e,n=>{Ln.add(e,n),t.onLoad&&t.onLoad(n),s(n)},()=>{},i)})}Rs.detectSupport=e=>Ar().detectSupport(e);Rs.loader={name:"ktx2",extensions:[".ktx2"],function:Rs};function Kf(){Ee.registerLoader(qi),Ee.registerLoader(sc),Ee.registerLoader(Rs),Ee.registerLoader(Os),Ee.registerLoader(nc),Ee.registerLoader(Wi);const{resolveUrl:e}=window.MM_EXPERIENCE_CONFIG;_.hooks.afterInit.watchOnce(()=>{Rs.detectSupport(_.threeRenderer),Os.initDRACOLoader()});let t=null;const s={},i={black:new dr(new Uint8Array([0,0,0,255]),1,1)},n={},o={},a=new Map,r=new Map,u={spritesheets:o,data:s,textures:i,objects:n,load:b,pgen:t,materials:{get:T=>a.get(T),register:$},geometries:{get:T=>r.get(T),register:P}},h=T=>T,d={ktx2:y,tex:g,obj:S,gltf:C,spritesheet:w,exr:x,json:v};d.avif=d.webp=d.jpg=d.png=d.tex,d.glb=d.gltf;const f=[];function b(T,L){return f[T]?f[T]:f[T]=m(T,L)}function p(T,L="/b/"){function O(D){if(typeof D=="string"&&D.startsWith(L))return e(D);if(Array.isArray(D))return D.map(O);if(typeof D=="object"){for(const U in D)D[U]=O(D[U]);return D}return D}return O(T)}function m(T,{onLoad:L,type:O,id:D,...U}={}){var ue;const A=_.$app.$preloader,R=A.finished?h:A.task;let z=_.$app.$baluchon.get(T);if(Array.isArray(z)&&(z=(ue=z[0])==null?void 0:ue.value),!z)return;z=p(z);let Y=typeof z=="string"?z:z.url;if(D=D||T.split("/").pop(),!O&&T.includes("sprites")&&(O="spritesheet"),O)return R(d[O]({id:D,file:z,onLoad:L,opts:U}));const ce=Y.split(".").pop(),oe=d[ce];if(oe)return R(oe({id:D,file:z,url:Y,onLoad:L,opts:U}))}async function g({id:T,file:L,opts:O}){return Ee.load(L.url,{onLoad:({node:D})=>{let U=Gf({id:T,img:D,flipY:!0,...O});i[T]=U}})}async function y({id:T,file:L,opts:O}){return Ee.load(L.url,{onLoad:D=>{let U=D;O.repeat&&(U.wrapS=U.wrapT=Zi),O.flipY!==void 0&&(U.flipY=O.flipY),O.linear!==void 0&&(U.minFilter=U.magFilter=As),O.srgb!==void 0?U.colorSpace=O.srgb?"srgb":"srgb-linear":U.colorSpace="",U.needsUpdate=!0,i[T]=U,D.userData.file=L}})}async function x({id:T,file:L,opts:O}){return Ee.load(L,{onLoad:D=>{i[T]=D}})}async function S({id:T,file:L}){return Ee.load(L,{onLoad:O=>{n[T]=O}})}async function C({id:T,file:L}){return Ee.load(L,{onLoad:O=>{n[T]=O}})}async function w({id:T,file:L,...O}){const D="spritesheet-"+T,[U]=await Promise.all([Ee.load(L.data),g({id:D,file:L,flipY:!1,...O}),L.normal?g({id:D+"-normal",file:L.normal,...O,data:!0,flipY:!1,linear:!0}):null]),A=u.spritesheets[T]=Wf(U,O.opts);A.texture=i[D],L.normal&&(A.normal=i[D+"-normal"])}async function v({id:T,file:L}){return Ee.load(L,{onLoad:O=>{s[T]=O}})}function $(T,L,...O){if(a.has(T))return a.get(T);const D=new L(...O);return a.set(T,D),D}function P(T,L,...O){if(r.has(T))return r.get(T);const D=new L(...O);return r.set(T,D),D}return function(L){L.$assets=u}}class Or{constructor(){this.timer=null,this.callback=null,this.remaining=null,this.delay=null}start(t,s){this.callback=t,this.remaining=s,this.delay=s,this.init()}stop(){clearTimeout(this.timer)}pause(){clearTimeout(this.timer),this.remaining-=Date.now()-this.startTime,this.paused=!0}init(t=this.delay){clearTimeout(this.timer),this.startTime=Date.now(),this.timer=setTimeout(this.callback,t),this.paused=!1}resume(){this.init(this.remaining)}}const Ds=new Or,Xf=[4,6];let mn=0,Bn=!1;const jo=[new V(16761133),new V(16741687),new V(3922873),new V(15794198),new V(1332991)];new V("white");new V("black");const Qf=new V,Yn=new X,Jf=new k,ep=new k,tp=new k;let Rr=null;function sp(){Rr=pe(()=>{var e;return(e=M.$viewport)==null?void 0:e.visible},e=>{Bn&&(e?Ds.resume():Ds.pause())})}function np(){Bn=!1,Ds.stop(),Rr()}async function Dr(e=ep.set(H.randomFloat(_.scene.camera.base.position.x-15,_.scene.camera.base.position.x+15),H.randomFloat(5,15),H.randomFloat(-10,-20)),t=Jf.set(_.scene.camera.base.position.x,_.$store.upFireworks?-5:2,0),s=jo[H.randomInt(0,jo.length-1)]){Bn=!0;const[i,n]=Xf,o=_.$quality.current.value,a=ye(o,0,5,i,n);mn>a||(mn+=1,M.$audio.playSound("sfx_Fireworks_Launch"),_.$particles.emit("fireworksTrail",{position:e,origin:t,color:s,sprite:"sparkleB",batcher:"fireworksTrail",gravity:-8,thickness:.2,forceAngle:_.$store.upFireworks?Math.PI/2+.04:0,onComplete:r=>{if(_.$app.$store.runningTransition)return;mn-=1;const l=Ye(e.z,-20,-10,.5,1),c=.1,[u,h]=[ye(_.$quality.current.value,0,5,20,60),ye(_.$quality.current.value,0,5,40,160)],d=H.randomInt(u,h);M.$audio.playSound("sfx_FireworksEnd",{volume:l}),_.$particles.emit("fireworksFlash",{amount:1,position:r.position,scale:Yn.set(220,220).setScalar(.01*2),duration:1600,power:.6,depthTest:!0,powerMult:.9,glowMult:.1,color:s,sprite:"smoke",delay:c,batcher:"gem_emissive"}),_.$particles.emit("fireworksFlash",{amount:1,position:r.position,scale:Yn.set(220,220).setScalar(.024*12),duration:500,power:.2,depthTest:!0,powerMult:.9,glowMult:.1,color:s,sprite:"flash",delay:c,batcher:"fake_lights"}),_.$particles.emit("fireworksFlash",{amount:1,position:r.position,scale:Yn.set(220,220).setScalar(.024*2),duration:500,power:.2,depthTest:!0,powerMult:.9,glowMult:.1,color:s,sprite:"flash",delay:c,batcher:"gem_emissive"}),_.$particles.emit("sparkles",{amount:1,position:r.position,scale:0,scaleTo:.08,sprite:"flash",batcher:"gem_emissive",duration:.15,color:s,alpha:.05,delay:c});const f=H.randomFloat(30,50);_.$particles.emit("sparkles",{amount:d,position:r.position,duration:4,durationRandom:.5,delay:c,batcher:"gem_emissive",sprite:"glow-denser",scale:.004,scaleTo:0,scaleRandom:.6,velocity:f,velocityRandom:.4,damping:.93,spread:Math.PI*2,gravity:tp.set(0,-3,0),color:s,onStart:b=>{_.$particles.emit("sparkles",{amount:1,position:b.position,duration:4,durationRandom:.5,batcher:"fireworksTrail",sprite:"sparkleA",color:b.colorFrom,colorFrom:b.colorFrom,colorTo:Qf.copy(b.colorFrom).offsetHSL(0,.5,.5),hueVariation:20,alpha:1,alphaTo:0,trailDamping:6,thickness:.2,onProgress:p=>{p.position.copy(b.position)}}),_.$particles.emit("sparkles",{amount:1,position:b.position,duration:b.duration/1e3,batcher:"gem_emissive",sprite:"flash",scale:6e-4,scaleFrom:0,alphaTo:0,alphaFrom:1,color:s,onProgress:p=>{const m=Math.sin(p.progress*Math.PI*2*3)*(1-p.progress);p.position.copy(b.position),p.color.copy(b.color),p.alpha=m}})}})}}))}function Ir(e=2,t=4){Ds.start(()=>{const s=H.randomInt(1,3);for(let i=0;i<s;i++)Dr();Ir(e,t)},H.randomFloat(e,t)*1e3)}function ip(){Ds.stop(),Bn=!1,mn=0}const Ne={start:sp,stop:np,reset:ip,resetTimer:Ir,emit:Dr};let Kn=0,ms=!1;function zr(e,t){e.onEnter=async()=>{const s=t.uid,{$game:i,$store:n,$app:o,$transition:a}=_,{currentLevel:r,currentChapter:l}=i;r==null||r.endEvent.emit(),i.currentChapter.title&&(i.currentChapter.title.alpha=0),o.$audio.bgm.setState("results"),a.outSimple();const c=l.zeppelin;ms=_.scene.name==="starry_night",ms&&i.currentChapter.fireworks&&(i.currentChapter.fireworks.isActive=!0);for(let f=0;f<n.collectedGems.length;f++){const b=c.wire.points[f];!b.orb&&b.sync||(b.orb.scaleMult=.6,b.pos.x=0,b.pos.y=0)}const u=c.base;u.position.y=5,u.position.x=0,u.visible=!0;const h=l.environment;h.visible=!0;const d=l.temple;d&&(d.freeze=!0,d.position.x=0,d.position.z=5,d.position.y=9.5,d.rotation.z=0,d.rotation.y=0,d.rotation.x=0,d.scale.setScalar(12),d.visible=!0),_.scene.sky.uniforms.needsRotate.value=1,l.camera.setState("end",{force:!0}),Kn=0,await Q(ms?1e4:6e3),t.uid===s&&(await _.$transition.inSimple(),i.state.set("Score"))},e.onUpdate=()=>{if(_.$game.isPaused())return;const{$time:s,$game:i}=_,{currentChapter:n}=i,o=n.zeppelin,a=o.base;Kn+=s.stableDt,Kn>(ms?5e3:0)&&(a.position.x+=s.stableDt/1e3);const r=n.temple.temple;r&&(r.rotation.y=0,r.rotation.z=0,r.rotation.x=0),J.Body.setPosition(o.body.base,a.position)},e.onLeave=()=>{const{temple:s={}}=_.$game.currentChapter;ms&&_.$game.currentChapter.fireworks&&(_.$game.currentChapter.fireworks.isActive=!1),s.freeze=!1,s.visible=!1}}Object.defineProperty(zr,"name",{value:"Cinematic"});const op=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"}));let gn=0,Xn=!1,rt=0;gn=rt;let Qn=!1,Jn=!1;new k(0,0,-1);function Fr(e,t){e.onEnter=async s=>{const i=t.uid,{$game:n,$app:o,$time:a}=_,{currentLevel:r,currentChapter:l}=n;Xn=_.scene.name==="starry_night",n.currentChapter.title&&(n.currentChapter.title.alpha=0),r==null||r.endEvent.emit(),Xn&&n.currentChapter.fireworks&&(n.currentChapter.fireworks.isActive=!0),l.camera.setState("endGame",{force:!0});const c=l.environment;_.$store.upFireworks=!0;const u=l.temple;Ne.emit(),Ne.emit(),Q(20).then(Ne.emit()),Q(50).then(Ne.emit()),Q(50).then(Ne.emit()),Q(100).then(Ne.emit()),Q(200).then(Ne.emit()),u&&(u.visible=!0),await Q(3e3),t.uid===i&&(Ne.emit(),Ne.emit(),Ne.emit(),Ne.emit(),Ne.resetTimer(),Jn=!0,_.scene.congratulationsTextParent&&(_.scene.congratulationsTextParent.position.copy(_.scene.camera.base.position),_.scene.congratulationsTextParent.rotation.copy(_.scene.camera.base.rotation),l.congratulationsText&&(l.congratulationsText.material.uniforms.progress.value=0)),c.visible=!0,u&&(u.visible=!0,u.position.x=_.scene.camera.base.position.x),Qn=!0,rt=0,u.rotation.y=Math.PI,u.position.y=-3,gn=0,Q(2e3).then(()=>{t.uid===i&&(_.$store.upFireworks=!1)}),Q(8e3).then(()=>{var h,d,f;t.uid===i&&(_.$app.$store.isLastLevelScoreVisible=!0,(f=(d=(h=_.scene)==null?void 0:h.fireworks)==null?void 0:d.lighterCursor)==null||f.toggle(!0))}))},e.onUpdate=()=>{if(_.$game.isPaused())return;const{$game:s,$time:i}=_,{currentChapter:n,currentLevel:o}=s,a=n.zeppelin;rt+=i.stableDt/2e3;const r=a.base;if(Qn){r.position.x=_.scene.camera.base.position.x+Math.cos(rt)*6,r.position.z=Math.sin(rt)*6+4,r.position.y=Math.sin(rt)*3+3,r.rotation.y=-rt-Math.PI/2,a.addPosition(i.stableDt/1e3,Math.sin(rt)*12-Math.sin(gn)*12);const l=n.temple;l.position.x=_.scene.camera.base.position.x,l.rotation.y=fe(l.rotation.y,0,.003),l.position.y=fe(l.position.y,10,.007)}else{const l=n.temple;l.position.y-=i.stableDt/200,l.position.x-=i.stableDt/500}n.congratulationsText&&(n.congratulationsText.material.uniforms.progress.value=fe(n.congratulationsText.material.uniforms.progress.value,Jn?1:0,.01)),gn=rt},e.onLeave=()=>{var r,l;const{$game:s}=_;Xn&&((l=(r=s.currentChapter)==null?void 0:r.fireworks)==null||l.unMount());const{currentChapter:i}=s,o=i.zeppelin.base;_.$app.$store.isLastLevelScoreVisible=!1,i.congratulationsText&&(i.congratulationsText.material.uniforms.progress.value=0),o.position.x=0,o.position.z=0,o.position.y=0,o.rotation.y=0,Jn=!1;const a=i.temple;a.rotation.y=0,Qn=!1,_.$store.upFireworks=!1}}Object.defineProperty(Fr,"name",{value:"EndGame"});const ap=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"}));let gs=0;const Ho=new X,Ur=-.35,Nr=.2;let ei=Ur,ti=Nr,si=0,Go,Bt=!1,Wo=1,Ws=!1,ni=null,rp=.2,ii=!1,oi=!1;const lp=60,cp=W(.51,.8,.53,.99),up=new Or,vs=(e,t=!0)=>new Promise(s=>e.value===t?s():e.watchOnce(i=>i===t&&s()));function Br(e,t){e.onEnter=async r=>{t.log("Game start");const l=t.uid,{$app:c,$game:u,$store:h}=_;c.$audio.bgm.resetState();const{currentLevel:d,currentChapter:f}=u,b=u.currentChapter.environment;if(b.visible=!0,!d)return;h.hasStartedGameOnce=!0,c.$store.finishedLevels[d.name]=!1,c.$store.inGame=!0,c.$store.previousTotalScore=c.$store.totalScore,c.$store.totalScore=f.currentScore,c.$store.currentScore=0,ii=!1;const p=f.zeppelin;if(f.ld.toggleVisibility(!0),f.title.visible=!0,!p)return;for(let y=0;y<h.collectedGems.length;y++){const x=p.wire.points[y];x.orb&&(x.orb.scaleMult=1)}const m=p.base;m.visible=!1,p.setPosition(_.$store.game.basePos.x-1.3,5),m.pos=new k().copy(m.position),J.Body.setPosition(p.body.base,m.pos),a(),p.reset(),d.reset(),f==null||f.reset(),f.camera.setState("game"),f.camera.state.reset((r==null?void 0:r.id)=="Score"||(r==null?void 0:r.id)=="End");const g=h.camera.game;g.lerpZoom=0,g.zoomOut=0,g.lerp=.04,d.firstTouch=!1,d.mayFirstTouch=!1,f.title.alpha=0,d.canLose=!1,d.hasTutorial="tutorial"in f,d.isTuto=!0,f.safeZone.reset(),h.game.tutoProgress=d.isTuto?1:0,c.$store.isGameStarted=!d.isTuto,h.levelEndReached=!1,Ws=!1,rp=.2,oi=!1,up.start(()=>oi=!0,500),d.hasTutorial&&(f.tutorial.reset(),f.tutorial.start()),c.$audio.playSound("sfx_StartLevel_Transition"),gs=0,Bt=!1,ni=null,u.events.start.emit(),u.slowdownTimer=u.durationSlowdown.value,u.beforeSlowdownTimer=u.durationBeforeSlowdown.value,u.isSlowingDown=!1,t.uid===l&&(m.visible=!0,await Q(1e3),await vs(u.paused,!1),t.uid===l&&(_.$store.game.countdown.set(3),await Q(1e3),await vs(u.paused,!1),t.uid===l&&(_.$store.game.countdown.set(2),await Q(1e3),await vs(u.paused,!1),t.uid===l&&(_.$store.game.countdown.set(1),await Q(1e3),await vs(u.paused,!1),t.uid===l&&(_.$store.game.countdown.set(0),await Q(50),await vs(u.paused,!1),t.uid===l&&(ii=!0,d.hasTutorial||(d.firstTouch=!0,_.$app.$store.isGameStarted=!0),await Q(500),t.uid===l&&(_.$store.game.countdown.set(null),d.mayFirstTouch=!0,d.canLose=!0,_.scene.sky.uniforms.needsRotate.value=0)))))))};let s=0;e.onUpdate=()=>{var ut,Mt;if(_.$game.isPaused()||!_.scene.prerendered)return;const{$time:r,$game:l,$store:c}=_,{currentLevel:u,currentChapter:h,boostFactor:d,boostDuration:f,boostInitialDuration:b,gravity:p,speed:m,vel:g,acc:y,elevationForce:x,slowdownFactor:S,slowdownTimer:C,durationSlowdown:w,limitSlowdownMalus:v,limitThreshold:$}=l;if(!u||!h)return;const{start:P=0,end:T=100}=u||{},L=h.zeppelin,O=L.base;if(!O)return;const D=r.stableDt,U=D/1e3,A=oi&&_.$controls.pressed,R=c.game,z=u.isTuto=u.hasTutorial&&gs<lp,Y=(z?R.tuto.limits.min:R.main.limits.min)+.7,ce=z?R.tuto.limits.max:R.main.limits.max,oe=((ut=O.pos)==null?void 0:ut.y)<=Y||((Mt=O.pos)==null?void 0:Mt.y)>=ce,ue=Bt,K=O.pos.y>=ce;if(O.pos.y<=Y,Bt=(O.pos.y<=Y+$.value||O.pos.y>=ce-$.value)&&!z,ti=Lt(ti,Nr,.1),ei=Lt(ei,Ur,.2),l.slowdownFactor=be(Lt(S,1-C/w.value,.02)),c.game.tutoProgress=Lt(c.game.tutoProgress,ii?0:1,.01),u.isEnded?u.endedProgress+=r.stableDt/5e3:u.endedProgress=0,u.endedProgress=be(u.endedProgress,0,1),u.endedProgressEased=cp(u.endedProgress),c.cloudsVelocity=c.baseCloudsvelocity,(A&&!u.firstTouch||u.hasTutorial&&!z)&&(u.firstTouch=!0),z!==ni&&u.hasTutorial&&(_.$app.$store.isGameStarted=!z),u.canLose&&(!l.currentLevel.hasTutorial||l.currentLevel.hasTutorial&&u.firstTouch&&!z)){if(l.beforeSlowdownTimer>0?(l.beforeSlowdownTimer-=U,l.isSlowingDown=!1):(l.beforeSlowdownTimer=0,l.isSlowingDown=!0),l.isSlowingDown){const Ut=Bt?Math.max(U,U*v.value*Wo):U;l.slowdownTimer-=z?0:Ut}else l.slowdownTimer=Lt(l.slowdownTimer,l.durationSlowdown.value,.03);l.slowdownTimer=be(l.slowdownTimer,0,l.durationSlowdown.value)}const ve=_n(O.pos.y,Y,Y+$.value),j=_n(O.pos.y,ce-$.value,ce);Wo=1-(ve-j),Bt!==ue&&Bt&&(c.boosting=!1,l.beforeSlowdownTimer=0),c.boosting&&si<f?si+=U:(si=0,c.boosting=!1,l.boostFactor=0,l.boostDuration=b);const ee=A&&!K?ye(g.y,-.3,.1,2,1)*x.value:0,Se=D*.16;Ho.copy(g).normalize(),y.x=m.value,y.y=ee+(c.boosting?d*Ho.y:0),g.x=Lt(g.x,(c.boosting?d:y.x)*Se,c.boosting?.05:.02),g.x=O.visible?g.x:c.cameraVelocity,Ws=Ws||!!A,p.value=Ws?-.3:-.05;const Ue=u.firstTouch?1:0;s=g.y*U+.5*y.y*U*U,s*=Ue,z&&!u.firstTouch&&(s=Math.sin(r.elapsed*.002)*3e-4);const Je=y.y+p.value;g.y+=Je*U;const Ft=Math.sign(g.y);oe!==Go&&oe&&(g.y=-g.y*.5+Ft*.1),g.y=be(g.y,oe?-.05:ei,ti),g.y=u.firstTouch?g.y:0,u.progress=gs,u.progressNormalized=ji(u.progress,P,T),L.mesh.visible=!0,O.pos.y+=s*20,O.pos.x+=g.x,L.addPosition(g.x,s*20),c.velocity.x=g.x,gs=O.pos.x,J.Body.setPosition(L.body.base,O.pos),O.pos.y=be(O.pos.y,Y,ce),O.position.copy(O.pos),L.updateSpeedLines(),!z&&u.firstTouch&&u.canLose&&O.position.x<h.camera.cam.position.x-c.game.camera.camWidth/2-2&&i(),h.title.alpha=fe(h.title.alpha,1,.01),Go=oe;let We=2*Math.tan(hr(_.$game.currentChapter.camera.base.fov)/2)*_.$store.game.camera.main.limits.max*_.$game.currentChapter.camera.base.aspect;!u.endReached&&u.progress>u.end-We*2&&n();const $t=h==null?void 0:h.temple;$t&&u.endReached&&($t.visible=!0),ni=z};function i(){var u;const{$game:r}=_,{currentLevel:l,currentChapter:c}=r;l.lose||((u=c.tutorial)==null||u.stop(),r.events.lose.emit())}function n(){const r=_.$game.currentLevel;_.$app.$store.finishedLevels[r.name]=r.endReached=!0,_.$store.levelEndReached=!0,_.$app.$audio.bgm.setState("results"),o()}function o(){const l=_.$game.currentChapter.temple;l&&(l.position.x=_.$game.currentLevel.end+1,l.position.y=6,l.position.z=5,l.rotation.z=0,l.rotation.y=0,l.rotation.x=0,l.scale.setScalar(12),l.visible=!0)}function a(){const l=_.$game.currentChapter.temple;l&&(l.visible=!1)}e.onLeave=()=>{const{$store:r,$game:l,scene:c}=_;gs=0,r.game.camera.baseOffset=0,r.cameraVelocity=0,r.velocity.x=0,c.sky.uniforms.needsRotate.value=1,l.currentLevel.isEnded=!1,l.currentLevel.endReached=!1,l.currentChapter.ld.toggleVisibility(!1),l.currentChapter.title.visible=!1,l.currentLevel.lost=!1,l.currentChapter.title.alpha=0,r.levelEndReached=!1,_.$store.deathProgress=0,_.$store.game.countdown.set(null),l.currentLevel.stormy.emit(!1),t.log("Game end"),l.currentLevel.hasTutorial&&l.currentChapter.tutorial.stop()}}Object.defineProperty(Br,"name",{value:"Game"});const dp=Object.freeze(Object.defineProperty({__proto__:null,default:Br},Symbol.toStringTag,{value:"Module"}));function Vr(e,t){e.onEnter=async()=>{const{$game:s,$app:i}=_;t.log("Intro start"),s.currentChapter&&(s.currentChapter.progress=0),i.$audio.bgm.resetState();const n=s.currentChapter.environment;n.visible=!0;const{zeppelin:o}=s.currentChapter;o.base.visible=!1,s.currentLevel.reset(),s.currentChapter.reset(),s.currentChapter.title.alpha=0,s.currentChapter.camera.setState("home")},e.onUpdate=()=>{if(_.$game.isPaused()||(_.$store.cloudsVelocity=_.$store.baseCloudsVelocity,!_.$game.currentChapter))return;const{zeppelin:s}=_.$game.currentChapter;_.scene.prerendered&&(s.base.visible=!1,s.setPosition(_.$store.game.basePos.x-1.3,5),s.base.pos=new k().copy(s.base.position),J.Body.setPosition(s.body.base,s.base.pos))},e.onLeave=()=>{t.log("Intro Leave");const{zeppelin:s}=_.$game.currentChapter;s.base.visible=!0}}Object.defineProperty(Vr,"name",{value:"Intro"});const hp=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"}));function Zr(e,t){e.onEnter=()=>{const{$game:s,$app:i,$transition:n}=_,{currentLevel:o,currentChapter:a}=s;i.$audio.bgm.setState("results",{duration:2e3,delay:0}),i.$store.inGame=!1,o==null||o.endEvent.emit(),n.outSimple("black");const r=a.zeppelin;r.wire.softReset();const l=a.zeppelin.base;r.setPosition(_.$store.game.basePos.x-1.3,5),l.pos=new k().copy(l.position),J.Body.setPosition(r.body.base,l.pos),l.visible=!1,s.currentChapter.title&&(s.currentChapter.title.alpha=0),_.scene.sky.uniforms.needsRotate.value=1,a.camera.setState("lose",{force:!0});const c=a.environment;c.visible=!0;const u=a.temple;u&&(u.visible=!1)}}Object.defineProperty(Zr,"name",{value:"Lose"});const fp=Object.freeze(Object.defineProperty({__proto__:null,default:Zr},Symbol.toStringTag,{value:"Module"}));let ai=0,_s=0,qs=!1;function jr(e,t){e.onEnter=async()=>{const{$game:s,$app:i,$transition:n,playSound:o}=_,{currentLevel:a,currentChapter:r}=s;s.events.score.emit(),a==null||a.endEvent.emit(),n.outSimple(),o("sfx_Result_Enter");const l=r.zeppelin,c=l.base;qs=_.scene.name==="starry_night",qs&&(_.$game.currentChapter.fireworks.isActive=!0),c.visible=!0,s.currentChapter.title&&(s.currentChapter.title.alpha=0),J.Body.setPosition(l.body.base,c.position),i.$store.totalScore+=i.$store.currentScore,i.$user.score=i.$store.totalScore;let u=s.levels.next();i.$user.currentLevel=_.getRouteFromLevel(u||s.levels.first()),i.$user.score=qs?0:i.$store.totalScore,r.camera.setState("score",{force:!0});const h=r.environment;h.visible=!0;const d=r.temple;d&&(d.freeze=!0,d.position.x=0,d.position.z=5,d.position.y=9.5,d.rotation.z=0,d.rotation.y=0,d.rotation.x=0,d.scale.setScalar(12),d.visible=!0),_s=0,ai=0},e.onUpdate=()=>{const{$time:s,$game:i,scene:n}=_;if(i.isPaused())return;const o=n.zeppelin,a=o.base;a.position.x+=s.stableDt/1e3,_s+=s.stableDt/5e3,o.addPosition(s.stableDt/1e3,Math.sin(_s*Math.PI)*2-Math.sin(ai*Math.PI)*2),a.position.y=5+Math.sin(_s*Math.PI)*2,J.Body.setPosition(o.body.base,a.position),ai=_s},e.onLeave=()=>{qs&&(_.$game.currentChapter.fireworks.isActive=!1)}}Object.defineProperty(jr,"name",{value:"Score"});const pp=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"}));let qo=0;function Hr(e,t){e.onEnter=async()=>{const s=t.uid,{$game:i,$store:n,$app:o,$transition:a}=_,{currentLevel:r,currentChapter:l}=i;if(t.uid!==s)return;i.currentChapter.title&&(i.currentChapter.title.alpha=0),o.$audio.bgm.setState("results"),a.outSimple("white",.5),r==null||r.endEvent.emit(),o.$store.totalScore+=o.$store.currentScore,o.$user.score=o.$store.totalScore;const c=l.zeppelin;for(let b=0;b<n.collectedGems.length;b++){const p=c.wire.points[b];!p.orb&&p.sync||(p.orb.scaleMult=.6,p.pos.x=0,p.pos.y=0)}let u=i.levels.next();o.$user.currentLevel=_.getRouteFromLevel(u||i.levels.first()),o.$user.score=0,c.wire.softReset();const h=c.base;h.position.y=5,h.position.x=2.5,h.visible=!0;const d=l.environment;d.visible=!1;const f=l.temple;f&&(f.position.x=0,f.position.z=5,f.position.y=9.5,f.rotation.z=0,f.rotation.y=0,f.rotation.x=0,f.scale.setScalar(12),f.visible=!0),_.scene.sky.uniforms.needsRotate.value=1,l.camera.setState("scoreLastLevel",{force:!0}),qo=0,await Q(3e3),t.uid===s&&i.events.score.emit()},e.onUpdate=()=>{if(_.$game.isPaused())return;const{$time:s,$game:i}=_,{currentChapter:n}=i,o=n.zeppelin,a=o.base;qo+=s.stableDt,a.position.x+=s.stableDt/900,J.Body.setPosition(o.body.base,a.position)},e.onLeave=()=>{const{temple:s={},fireworks:i}=_.$game.currentChapter;s.freeze=!1,s.visible=!1}}Object.defineProperty(Hr,"name",{value:"ScoreLastLevel"});const mp=Object.freeze(Object.defineProperty({__proto__:null,default:Hr},Symbol.toStringTag,{value:"Module"})),dt=e=>e,Yo={};function gp({states:e={},routines:t={},context:s=null,initial:i,...n}={}){let o=0,a=0,r=null,l=!1,c={};const u={},h={},d={get time(){return o},get current(){return r},uid:0,hasReached:x=>o>=x&&a<x,start:y,logger:dt,log:dt,is:f,set:p,get:b,states:u,routines:h,update:m,resize:g};for(let x in t)h[x]=t[x].bind(s,d,s);for(let x in e){let S=e[x];const C=dt,w={machine:d,id:x,isActive:!1,time:0,data:{},prevTime:-1,log:C.log??dt,logger:C,onEnter:dt,onUpdate:dt,onLeave:dt,onResize:dt,isReached:v=>w.time>=v&&w.prevTime<v,schedule:(v,$)=>{const P={startsAt:w.time+v,finished:!1};P.callback=T=>{if(!w.isActive||P.finished)return;const L=w.time-P.startsAt;$.call(s,L,T,w)&&(P.finished=!0)},w._scheduledActions.push(P)},_scheduledActions:[],_update:v=>{if(!w.isActive)return;w.prevTime=w.time,w.time+=v;const $=w._scheduledActions;for(let P=0;P<$.length;P++){const T=$[P];if(!(T.finished||T.startsAt>w.time)&&(T.callback(v),!T.isActive))return}w.onUpdate&&w.onUpdate(v)}};typeof S=="function"&&(S=S.call(s,w,d,s)),Object.assign(w,{...n}),w.onEnter=w.onEnter.bind(s),w.onUpdate=w.onUpdate.bind(s),w.onLeave=w.onLeave.bind(s),u[x]=w}i&&p(i);function f(x){return r&&r.id===x}function b(x){return u[x]}function p(x,{force:S,...C}={}){var $;if(!l){c.id=x,c.params={force:S,...C};return}if(!u[x]||!S&&(r==null?void 0:r.id)===x)return;const w=r,v=u[x];w&&(w.onLeave&&w.isActive&&w.onLeave(v.id,C),w.isActive=!1,w.params=Yo,w.data=Yo),d.uid=++d.uid%Number.MAX_SAFE_INTEGER,r=u[x],v.isActive=!0,v.prevTime=-1,v._scheduledActions.length=0,v.time=0,v.params=C,v.data={},v.onEnter&&v.onEnter(w,C),($=_==null?void 0:_.$app)!=null&&$.$store&&(_.$app.$store.currentGameState=x)}function m(x){a=o,o+=x,r&&r._update(x)}function g(){r&&r.isActive&&r.onResize()}function y(){l||(l=!0,c.id&&(p(c.id,c.params),c.id=null,c.params=null))}return d}function vp(e,t){const{hooks:s,defaultDepthMaterial:i}=t,n=e.threeRenderer,o={},a=e.$viewport.size,{width:r,height:l}=a.get(),c=new bt(r,l,{depthBuffer:!0});c.originalSize=new X(r,l),a.watchImmediate(({width:u,height:h})=>{c.setSize(u*t.qualityScale.value,h*t.qualityScale.value),c.originalSize.set(u,h)}),t.buffers.push(c),t.depthPrepass.value=c.texture,e.hooks.beforeRender.watch(()=>{if(!e.scene||t.skipRenderEnvironment)return;s.beforeDepthPass.emit(),t.isDepthPrepass=!0,e.scene.base.traverse(h=>{(h.isMesh||h.isLine)&&(h.uuid in o?(o[h.uuid].visible=h.visible,o[h.uuid].material=h.material):o[h.uuid]={visible:h.visible,material:h.material},h.renderToDepthPrepass?h.material=h.customDepthMaterial||i:h.visible=!1)});const u=n.getRenderTarget();n.setRenderTarget(c),n.clear(),e.scene.render(),n.setRenderTarget(u),e.scene.base.traverse(h=>{if(h.isMesh||h.isLine){const d=o[h.uuid];h.renderToDepthPrepass&&(h.material=d.material),h.visible=d.visible}}),t.isDepthPrepass=!1,s.afterDepthPass.emit()})}function _p(e,t){const{afterLevelStarted:s}=t.hooks,{$store:i,$renderer:n}=e,o=t.cubeRT,a=e.threeRenderer,r=n.drawingBufferSize,{width:l,height:c}=r.get(),u=new ic(1,1e3,o);u.layers.set(e.$store.layers.ENVMAP);const h=new bt(l,c,{depthBuffer:!1});h.originalSize=new X(l,c),t.bgTexture.value=h.texture,r.watchImmediate(({width:b,height:p})=>{h.setSize(b,p),h.originalSize.set(b,p),Le.fog.fogUVTexture.value.set(b,p)}),s.watch(()=>{d()}),e.hooks.beforeRender.watchOnce(()=>{d()}),e.hooks.beforeRender.watch(()=>{t.registerBackground&&f()}),e.$game.hooks.skyHasChanged.watch(()=>{requestAnimationFrame(()=>{d()})});function d(){var p,m;const b=(m=(p=e.scene)==null?void 0:p.camera)==null?void 0:m.base;b&&(u.position.copy(b.position),u.position.z-=100,u.update(a,e.scene.base))}function f(){if(!e.scene)return;t.hooks.beforeBgPass.emit();const{cam:b}=e.scene.getCurrentCamera(),p=a.getRenderTarget(),m=b.layers.mask;b.layers.disableAll(),b.layers.set(i.layers.ENVMAP),a.setRenderTarget(h),a.clear(),e.scene.render(),a.setRenderTarget(p),b.layers.mask=m,t.hooks.afterBgPass.emit(),Le.fog.fogTexture.value=h.texture}}function yp(e,t){const{zeppelin:s,$store:i,$renderer:n}=e,{playerTexture:o,playerDepthTexture:a}=t,r=e.threeRenderer,l=n.drawingBufferSize,{width:c,height:u}=l.get(),h=new oc,d=new bt(c,u,{depthTexture:h});d.originalSize=new X(c,u),l.watchImmediate(({width:b,height:p})=>{d.setSize(b,p),d.originalSize.set(b,p)}),o.value=d.texture,a.value=d.depthTexture;function f(){if(!e.scene)return;const{cam:b}=e.scene.getCurrentCamera(),p=r.getRenderTarget(),m=b.layers.mask;b.layers.disableAll(),b.layers.set(i.layers.PLAYER),r.setRenderTarget(d),r.clear(),e.scene.render(),r.setRenderTarget(p),b.layers.mask=m}e.hooks.beforeRender.watch(()=>{f()})}function Vs(e,t,s,i,n,o=!0){o&&t.updateMatrixWorld();const a=_.$viewport.size.value,r=k.get().set(e.x/a.x*2-1,-(e.y/a.y)*2+1,0);r.unproject(t);const l=r.sub(t.position).normalize(),c=(s-(n??15))/l.z;return r.release(),i||(i=new k),i.copy(t.position).add(l.multiplyScalar(c)),i}function bp(e,t){const{$store:s,$viewport:i,$app:n}=e,{cloudsTexture:o,cloudsDepthTexture:a,cloudsAlphaTexture:r}=t,l=e.threeRenderer,c=i.size,{width:u,height:h}=c.get(),d=n.$device.type.phone?.15:.25,f=new bt(u*d,h*d,{depthBuffer:!1});f.originalSize=new X(u*d,h*d);const b=new bt(u,h,{depthBuffer:!1});c.watchImmediate(({width:m,height:g})=>{f.setSize(m*t.qualityScale.value*d,g*t.qualityScale.value*d),b.setSize(m,g),f.originalSize.set(m*d,g*d)}),t.buffers.push(f),o.value=f.texture,a.value=f.texture,r.value=b.texture;function p(){if(!e.scene||t.skipRenderEnvironment)return;const{cam:m}=e.scene.getCurrentCamera(),g=l.getRenderTarget(),y=m.layers.mask,x=e.scene.clouds;m.layers.disableAll(),m.layers.set(s.layers.CLOUDS),l.setRenderTarget(f),l.clear(),e.scene.render(),x.clouds.material=x.alphaMaterial,l.setRenderTarget(b),l.clear(),e.scene.render(),x.clouds.material=x.material,l.setRenderTarget(g),m.layers.mask=y}e.hooks.beforeRender.watch(()=>{p()})}const Gr=Math.sqrt(2);class xp{constructor(t=512,s=512,i=512,n=4,o=30,a=Math){this.r=n,this.k=o,this.cellSize=this.r/Gr,this.width=t,this.height=s,this.depth=i,this.cols=Math.max(1,Math.round(this.width/this.cellSize)),this.rows=Math.max(1,Math.round(this.height/this.cellSize)),this.slices=Math.max(1,Math.round(this.depth/this.cellSize)),this.grid=[],this.activeList=[],this.rng=a;for(let d=0;d<this.rows*this.cols*this.slices;d++)this.grid[d]=null;const r=this.rng.random()*t,l=this.rng.random()*s,c=this.rng.random()*i,u=this.cellIndex(r,l,c),h=new k(r,l,c);this.grid[u.index]=h,this.activeList.push(h)}cellIndex(t,s,i){const n=Math.floor(t/this.cellSize),o=Math.floor(s/this.cellSize),a=Math.floor(i/this.cellSize);return{col:n,row:o,slice:a,index:n+o*this.cols+a*this.rows*this.cols}}calculate(){for(;this.activeList.length;)this.calculatePoint();return this.grid.filter(t=>t!==null)}calculatePoint(){if(this.activeList.length>0){const t=Math.floor(this.rng.random()*this.activeList.length),s=this.activeList[t];let i=!1;for(let n=0;n<this.k;n++){const o=new k;o.set(we.randFloat(-1,1),we.randFloat(-1,1),we.randFloat(-1,1)),o.setLength(we.randFloat(this.r,2*this.r)),o.add(s);const a=this.cellIndex(o.x,o.y,o.z);if(a.col>-1&&a.row>-1&&a.slice>-1&&a.col<this.cols&&a.row<this.rows&&a.slice<this.slices&&this.grid[a.col+a.row*this.cols+a.slice*this.rows*this.cols]==null){let r=!0;for(let l=-1;l<=1;l++)for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++){const h=a.col+l+(a.row+c)*this.cols+(a.slice+u)*this.cols*this.rows,d=this.grid[h];d&&d.distanceTo(o)<this.r&&(r=!1)}r&&(i=!0,this.grid[a.col+a.row*this.cols+a.slice*this.rows*this.cols]=o,this.activeList.push(o))}}i||this.activeList.splice(t,1)}}}class wp{constructor(t=512,s=512,i=4,n=30,o=Math){this.r=i,this.k=n,this.cellSize=this.r/Gr,this.width=t,this.height=s,this.cols=Math.floor(this.width/this.cellSize),this.rows=Math.floor(this.height/this.cellSize),this.grid=[],this.activeList=[],this.rng=o;for(let u=0;u<this.rows*this.cols;u++)this.grid[u]=null;const a=this.rng.random()*t,r=this.rng.random()*s,l=this.cellIndex(a,r),c=new X(a,r);this.grid[l.index]=c,this.activeList.push(c)}cellIndex(t,s){const i=Math.floor(t/this.cellSize),n=Math.floor(s/this.cellSize);return{col:i,row:n,index:i+n*this.cols}}calculate(){for(;this.activeList.length;)this.calculatePoint();return this.grid.filter(t=>t!==null)}calculatePoint(){if(this.activeList.length>0){const t=Math.floor(this.rng.random()*this.activeList.length),s=this.activeList[t],i=this.rng===Math?we.randFloat:this.rng.randomFloat;let n=!1;for(let o=0;o<this.k;o++){const a=new X;a.set(i(-1,1),i(-1,1)),a.setLength(i(this.r,2*this.r)),a.add(s);const r=this.cellIndex(a.x,a.y);if(r.col>-1&&r.row>-1&&r.col<this.cols&&r.row<this.rows&&this.grid[r.col+r.row*this.cols]==null){let l=!0;for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++){const h=r.col+c+(r.row+u)*this.cols,d=this.grid[h];d&&d.distanceTo(a)<this.r&&(l=!1)}l&&(n=!0,this.grid[r.col+r.row*this.cols]=a,this.activeList.push(a))}}n||this.activeList.splice(t,1)}}}const Wr=e=>{for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}},Sp={checkpointEmit:Ep,checkpointUpdate:Pp,checkpointComplete:Lp},Vt=new k,$p=new wp(40,15,8),Ys=$p.calculate(),Mp=new X,Cp=new k,kp=H.randomInt,ys=H.random,Tp=W(ne.outSwift);function Ep({camera:e,scene:t}){if(!t.hotairballoon)return;this.manualComplete=!0;const s=[20,60],i=kp(3,4);this.balloons=t.hotairballoon.getBalloonInstances(i),this.pool=t.hotairballoon.pool;const{width:n}=_.$viewport.size.value;Wr(Ys),t.hotairballoon.needsUpdate=!0;let o=1/0;this.balloons.forEach((a,r)=>{if(r>Ys.length||!Ys[r])return;const{x:l,y:c}=Ys[r];Vt.copy(t.zeppelin.base.position),Vt.y-=5,Vt.z-=Ye(Tp(ys()),0,1,s[0],s[1]);const u=Vs(Mp.set(n,0),e.base,Vt.z,Cp,t.camera.cam.position.z);Vt.x=u.x,a.position.copy(Vt),a.position.x+=l,a.position.y+=ys()*10-5,a.position.z+=c,a.position.x<o&&(o=a.position.x);const h=(.8+ys()*.2)*.6,d=ye(a.position.z,-80,-20,h*.3,h);a.scale.setScalar(d),a.data.initialPosition=a.position.clone(),a.data.randomOffset=ys()*1e3,a.data.randomSpeed=ys()*.5+.5}),this.balloons.forEach((a,r)=>{a.position.x-=o,a.position.x+=a.scale.x*2})}function Pp({scene:e}){if(!(e!=null&&e.hotairballoon))return;const t=_.$time.dt*.001,s=_.$time.elapsed*6e-5;let i=0;e.hotairballoon.needsUpdate=!0,this.balloons.forEach(n=>{const o=_.noise(n.position.x*.01+s,n.position.z*.02+n.data.randomOffset)*5,a=_.noise(n.position.x*.05+s,n.position.z*.03+n.data.randomOffset)*5;n.position.x=n.data.initialPosition.x+o*t*n.data.randomSpeed,n.position.y+=t*n.data.randomSpeed*.5,n.position.z=n.data.initialPosition.z+a*t*n.data.randomSpeed,this.progress>10&&!n.isInViewport&&(i+=1)}),i===this.balloons.length&&this.done()}function Lp(){var e;(e=this.balloons)==null||e.forEach(t=>{this.pool.remove(t)})}const Ap=Object.freeze(Object.defineProperty({__proto__:null,default:Sp},Symbol.toStringTag,{value:"Module"})),Ko=16.67,Tt=()=>{};class qr{constructor({atlas:t,id:s,group:i,sequence:n,loop:o,autoplay:a,standBy:r,frame:l,onPause:c,onStart:u,onUpdate:h,onEnd:d,onEndOnce:f,onEndLoop:b,frameDuration:p,category:m,parent:g,isBackwards:y,timeElapsed:x=0}){this.frames=[],this.onUpdate=h||Tt,this.onPause=c||Tt,this.onStart=u||Tt,this.onEndOnce=f||Tt,this.onEnd=d||Tt,this.onEndLoop=b||Tt,this.id=s!==void 0?s:i+"/"+n,this.group="",this.sequence="",this.parent=g||null,this.standBy=!!r,this.isBackwards=!!y,this.loop=!!o,this.autoplay=!!a,this.frame=l||0,this.frameCount=0,this.frameDuration=p||Ko,this.timeElapsed=x,this.currentFrameIndex=0,this.paused=!1,this.ended=!1,this.category=m||"atlas",this.atlas=t,t&&(this.setAtlas(t),this.change({id:this.id,frameDuration:this.frameDuration,autoplay:this.autoplay,loop:this.loop,frame:this.frame}))}setAtlas(t){t&&(this.sprites=t.sprites||t)}swap(t){this.change({id:t,frame:this.currentFrameIndex,frameDuration:this.frameDuration,autoplay:this.autoplay,loop:this.loop})}change({id:t="circle",group:s,sequence:i,frame:n,frameDuration:o,timeElapsed:a=0,autoplay:r,loop:l}){if(this.sprites[t]){if(t!==void 0){this.id=t;const c=this.id.split("/");this.sequence=c.pop(),this.group=c.join("/")}else i!==void 0&&(s!==void 0&&(this.group=s),this.sequence=i,this.id=this.group+"/"+this.sequence);this.frames=this.sprites[this.id],this.frameCount=this.frames.length,this.currentFrameIndex=Math.min(n||0,this.frameCount-1),this.frame=this.frames[this.currentFrameIndex],this.loop=!!l,this.autoplay=!!r,this.frameDuration=o||Ko,this.timeElapsed=a,this.paused=!this.autoplay,this.frameCount<2?this.end():this.ended=!1,this.onUpdate(this.frame)}}end(t=0){this.ended=!0,this.onEndOnce(this.frame,t),this.onEndOnce=Tt,this.onEnd(this.frame,t)}play(){this.standBy||(this.onStart(this.frame),this.paused=!1,this.isBackwards=!1,this.ended=!1)}playBackwards(){this.paused=!1,this.isBackwards=!0,this.ended=!1}reset(){this.standBy||(this.ended=!1,this.paused=!1,this.currentFrameIndex=0)}resetFrame(){this.currentFrameIndex=0,this.frame=this.frames[this.currentFrameIndex]}pause(){this.onPause(this.frame),this.paused=!0}nextFrame(t){let s=this.currentFrameIndex+1;if(s>=this.frameCount)if(this.loop)this.onEndLoop&&this.onEndLoop(this.parent),s=0;else return this.end(t),!0;if(s!==this.currentFrameIndex&&(this.currentFrameIndex=s,this.frame=this.frames[this.currentFrameIndex],!this.loop&&s+1>=this.frameCount))return this.end(t),!0}previousFrame(t){let s=this.currentFrameIndex-1;if(s<0)if(this.loop)s=this.frameCount;else return this.end(t),!0;if(s!==this.currentFrameIndex&&(this.currentFrameIndex=s,this.frame=this.frames[this.currentFrameIndex],!this.loop&&s-1<0))return this.end(t),!0}setFrame(t){t=Math.max(0,Math.min(t,this.frameCount-1)),t!==this.currentFrameIndex&&(this.currentFrameIndex=t,this.frame=this.frames[this.currentFrameIndex],!this.loop&&(this.isBackwards&&t===0?this.end(0):!this.isBackwards&&t===this.frameCount-1&&this.end(0)))}update(t){if(!(this.ended||this.paused)&&(this.timeElapsed+=t,this.timeElapsed>=this.frameDuration)){let s=this.timeElapsed;const i=Math.floor(this.timeElapsed/this.frameDuration);this.timeElapsed=this.timeElapsed-i*this.frameDuration;for(let n=0;n<i&&(s-=this.frameDuration,!(this.isBackwards?this.previousFrame(s):this.nextFrame(s)));n++);}}destroy(){this.sprites=this.frames=this.frame=this.onUpdate=null}}const Op="string",Rp=new Oe;class _t{constructor(t){this.webgl=St(),this.isSprite=!0,this.zIndex=t.zIndex||0,t.batcher&&(this.batcher=typeof t.batcher===Op?this.webgl.$particles.batchers[t.batcher]:t.batcher,this.atlas=t.atlas=this.batcher.atlas),this.dummy=Rp,this.position=new k,this.scale=new X(1,1),this.quaternion=new Re,this.color=new V(16777215),t.rotation?(this.useEuler=!0,this.rotation=new It,this.rotation.copy(t.rotation)):t.useEuler&&(this.useEuler=!0,this.rotation=new It),this.alpha=t.alpha!=null?t.alpha:1,this.initialAlpha=this.alpha,this.parent=t.parent||null,this.fx=t.fx||0,this.fx2=t.fx2||0,this.billboard=!!t.billboard,this.angle=t.angle||0,t.position&&(t.position instanceof k?this.position.copy(t.position):Array.isArray(t.position)?this.position.fromArray(t.position):(this.position.x=t.position.x||0,this.position.y=t.position.y||0,this.position.z=t.position.z||0)),t.color!=null&&(typeof t.color=="number"?this.color.set(t.color):this.color.copy(t.color)),t.scale&&(typeof t.scale=="number"?this.scale.setScalar(t.scale):this.scale.copy(t.scale)),t.flipX&&(this.scale.x*=-1),t.flipY&&(this.scale.y*=-1),this.initialScale=this.scale.clone(),t.quaternion&&this.quaternion.copy(t.quaternion),this.sprite=new qr({...t,id:t.sprite||t.id,parent:this}),this.visible=t.visible??!0,this.addToBatcher(),this.sprite.update(1)}addToBatcher(){this.addedToBatcher||!this.batcher||(this.batcher.addInstance(this),this.addedToBatcher=!0)}removeFromBatcher(){!this.addedToBatcher||!this.batcher||(this.batcher.removeInstance(this),this.addedToBatcher=!1)}is(t){return this===t}update(){if(this.webgl.$game.isPaused())return;const t=this.webgl.$time.stableDt;this.sprite.update(t)}destroy(){this.removeFromBatcher(),this.parentComponent&&this.parentComponent.removeComponent(this),this.sprite&&this.sprite.destroy(),this.sprite=this.batcher=null,this.props=null}}const Dp={checkpointEmit:Fp,checkpointUpdate:Up,checkpointComplete:Np},Et=new k,Ip=new k,zp=new X,Xo=new Fe;function Fp({camera:e,scene:t}){if(!t||!("birds_normal"in _.$particles.batchers))return;this.manualComplete=!0;const{rng:s,noise:i}=_;this.geese=[];const n=s.randomInt(15,25),o=20+s.randomFloat(-10,5),a=10+s.randomFloat(0,20),{width:r}=_.$viewport.size.value;Et.copy(t.zeppelin.base.position),Et.y=s.randomFloat(6,-2),Et.z-=s.randomFloat(20,30);const l=Vs(zp.set(r,0),e.base,Et.z,Ip);Et.x=l.x+a*.5,this.speed=s.randomFloat(1,3);for(let c=0;c<n;c++){const u=c/(n-1),h=Math.abs(u-.5)*a,d=Ye(u,0,1,-o,0),f=s.randomFloat(0,1);let b=s.randomFloat(.0045,.0055);const p=new _t({batcher:"birds_normal",id:"goose",flipX:!0,fx2:1,frameDuration:8+s.randomFloat(-2,2),timeElapsed:s.randomFloat(0,10),autoplay:!0,color:6969167,scale:b,position:Et,loop:!0});p.position.x+=h,p.position.z+=d;const m=i(p.position.x*.1+f*3287.12,p.position.z*.3)*.06,g=i(p.position.y*.06+f*287.76,p.position.x*2)*.1+i(Et.y*2452,d)*.3,y=i(p.position.x*.1+f*327.632,p.position.z*.3)*.06;p.position.x+=m*2,p.position.y+=g*2,p.position.z+=y*2,p.scale.multiplyScalar(ye(p.position.z,-60,-20,.5,1)),this.geese.push(p),p.speed=s.randomFloat(.9,1.05)}}function Up({scene:e}){if(!e||!this.geese)return;const{$game:t,$time:s}=_,i=s.dt*.001;let n=0;const o=this.progress>10;this.geese.forEach((a,r)=>{a.position.x-=this.speed*i*a.speed,a.update(),o&&(Xo.compose(a.position,a.quaternion,a.scale),t.fc.isInViewport(Xo)||(n+=1))}),o&&n===this.geese.length&&this.done()}function Np(){this.geese&&(this.geese.forEach(e=>{e.destroy()}),this.geese.length=0)}const Bp=Object.freeze(Object.defineProperty({__proto__:null,default:Dp},Symbol.toStringTag,{value:"Module"})),Vp={checkpointEmit:Zp,checkpointComplete:jp};function Zp({scene:e}){this.duration=10}async function jp(){}const Hp=Object.freeze(Object.defineProperty({__proto__:null,default:Vp},Symbol.toStringTag,{value:"Module"})),Gp={checkpointEmit:Yp,checkpointUpdate:Kp,checkpointComplete:Xp},bs=new k,Wp=new xp(20,3,20,.65,2),Ks=Wp.calculate(),qp=new X,ri=new k;let xn=0;function Yp({camera:e,scene:t}){if(!t.lanterns)return;this.manualComplete=!0,t.lanterns.needsUpdate=!0,this.pickedPoints=[],Wr(Ks);const s=[0,20,40],i=Math.floor(Math.random()*70+50);this.lanterns=t.lanterns.getLanternInstances(i),this.pool=t.lanterns.pool;const{width:n}=_.$viewport.size.value;bs.copy(t.zeppelin.base.position),bs.y=-5,bs.z-=s[Math.floor(Math.random()*s.length)];let o=1/0;this.lanterns.forEach((r,l)=>{if(l>Ks.length-1||xn>=Ks.length-1)return;let c=null;for(;!c;)c=Qp(Ks),c.__isPicked&&(c=null);const{x:u,y:h,z:d}=c;c.__isPicked=!0,xn+=1,this.pickedPoints.push(c),ri.set(u,h,d);const f=ri.length(),b=Ce(0,20,f),p=(1-b)*2-1;r.position.copy(bs),r.position.x+=u,r.position.y+=h*(1-b)*4-h*2,r.position.z+=(d*2-d)*Ye(p,0,1,.2,1);const m=ye(r.position.z,-60,-20,.03,.1)*(Math.random()*.5+.5);r.scale.setScalar(m),r.position.z<o&&(o=r.position.z),r.data.initialPosition=r.position.clone(),r.data.randomOffset=Math.random()*1e3,r.data.randomSpeed=Math.random()*.5+.5});const a=Vs(qp.set(n,0),e.base,o,ri);a.x-=bs.x,this.lanterns.forEach(r=>{r.position.x+=a.x})}function Kp({scene:e}){if(!(e!=null&&e.lanterns))return;const t=_.$time.dt*.001;_.$time.elapsed*.001,e.lanterns.needsUpdate=!0;let s=0;this.lanterns.forEach((i,n)=>{const o=_.noise(i.position.x*.1*10+i.data.randomOffset,i.position.z*.2*10+i.data.randomOffset),a=_.noise(i.position.y*.5*1+i.data.randomOffset,i.position.x*.1*1+i.data.randomOffset)*.5+.5,r=_.noise(i.position.x*.3*10+i.data.randomOffset,i.position.z*.3*10+i.data.randomOffset)*.5;i.position.x=fe(i.position.x,i.position.x+o*t-t*i.data.randomSpeed,.6),i.position.y=fe(i.position.y,i.position.y+a*t,.5),i.position.z=fe(i.position.z,i.position.z+r*t,.2),i.rotation.z=Ye(o,-1,1,-.3,.3)*Math.PI*-.3,this.progress>10&&!i.isInViewport&&(s+=1)}),s===this.lanterns.length&&this.done()}function Xp(){var e;(e=this.lanterns)==null||e.forEach(t=>{this.pool.remove(t)}),this.pickedPoints.forEach(t=>delete t.__isPicked),xn-=this.pickedPoints.length}const Qp=(e,t=Math)=>e[Math.floor(t.random()*e.length)],Jp=Object.freeze(Object.defineProperty({__proto__:null,default:Gp},Symbol.toStringTag,{value:"Module"})),em={checkpointEmit:tm,checkpointUpdate:sm,checkpointComplete:nm};let _e,Yi=0;const At=new k,ss=new k;new k;function tm({scene:e}){var s,i,n;const{$game:t}=_;(s=t.currentLevel)!=null&&s.endReached||(this.duration=40,Yi=(((n=(i=e.clouds)==null?void 0:i.offsetY)==null?void 0:n.get())||0)+3,_e=e.temple,_e.scale.setScalar(25),_e.visible=!0,_e.amplitude=.6,At.copy(e.zeppelin.base.position),At.x+=5,At.y=_e.size.y*-2,At.z-=170,_e.position.copy(At),_e.rotation.y=.3,ss.copy(At),ss.y=Yi)}function sm({scene:e}){var d;if(!e||this.over)return;const{$particles:t,rng:s,$game:i}=_;if((d=i.currentLevel)!=null&&d.endReached){this.done();return}const n=_.$time.dt*.001,o=this.progress/this.duration,a=ye(o,.5,1,0,1);i.paused.value||(_e.position.x+=n*4*(1-a)+n*-6*a,_e.position.y=At.y+Math.sin(Math.min(1,o+a*.2)*Math.PI)*_e.size.y*2.3,_e.rotation.z=Math.cos(o*Math.PI*1.1+.03)*-.1-.1,_e.rotation.y=.3+Math.cos(Math.min(1,o+a*.1)*Math.PI)*-.3);const r=_n(_e.position.y,-60,-6),l=_n(_e.position.y,-6,10),u=W("inOutSine")((r>.5?1-r:r)*2)*_e.size.x*.4+_e.size.x*.2;ss.copy(_e.position),ss.x+=_e.size.x*.2+(-.5+r)*-_e.size.x*.3,ss.y=Yi;const h=fe(0,.3,r+l);s.random()>h||t.emit("smoke",{batcher:"smoke",count:1,alphaFrom:0,duration:[3,6],alphaInOut:!0,position:ss,spawnRadius:u,spread:Math.PI*.5,scale:[.02,.034],scaleFrom:[.005,.015],velocity:[.4,.6],gravity:-.5})}function nm(){this.over=!0}const im=Object.freeze(Object.defineProperty({__proto__:null,default:em},Symbol.toStringTag,{value:"Module"})),om={checkpointEmit:am,checkpointUpdate:rm};function am(e){const t=_.$store;t.camera.game.zoomOut=0,t.camera.game.lerp=.01}function rm(){}const lm=Object.freeze(Object.defineProperty({__proto__:null,default:om},Symbol.toStringTag,{value:"Module"})),cm={checkpointEmit:um,checkpointUpdate:dm};function um(e){const t=_.$store;t.camera.game.zoomOut=1,t.camera.game.lerp=.01}function dm(){}const hm=Object.freeze(Object.defineProperty({__proto__:null,default:cm},Symbol.toStringTag,{value:"Module"})),fm=Object.assign({"../../components/CheckpointPresets/airBalloon.js":Ap,"../../components/CheckpointPresets/birds.js":Bp,"../../components/CheckpointPresets/fireflies.js":Hp,"../../components/CheckpointPresets/lantern.js":Jp,"../../components/CheckpointPresets/templeReveal.js":im,"../../components/CheckpointPresets/unzoom.js":lm,"../../components/CheckpointPresets/zoom.js":hm}),Xs=Object.entries(fm).reduce((e,[t,s])=>(e[t.match(/\/([^\/]+)\.js$/)[1]]=s.default,e),{}),wn=new Map,pm=e=>e.isActive&&e.update(),mm=()=>wn.forEach(pm),gm=()=>{wn.forEach(e=>{e.done(),e.active&&e._isDone&&e.checkpointComplete&&e.checkpointComplete({type:e.type}),e.update()})};let vm=0;function _m(e){const t={emit:l,listen:a,trigger:r,updateCheckpoints:mm,reset:gm,types:Object.keys(Xs)},s=new Map;return t;function i(u,h={}){if(!Xs[u])return;const d={};return Object.assign(d,{...Xs[u],uid:`${u}_${vm++}`,instance:null,type:u,progress:0,duration:0,isActive:!1,manualComplete:!1,...h,_isDone:!1,update:n.bind(d),emit:o.bind(d),done:()=>{d._isDone=!0,wn.delete(d.uid)}}),d}function n(){if(e.paused.value)return;const u=_.$time.dt*.001;this.progress+=u,this.checkpointUpdate&&this.checkpointUpdate({type:this.type,...c()}),(!this.manualComplete&&this.progress>=this.duration||this._isDone)&&(this.isActive=!1,this.checkpointComplete&&this.checkpointComplete({type:this.type,...c()}))}function o(u={}){wn.set(this.uid,this),this._isDone=!1,this.duration=u.duration??0,this.manualComplete=u.manualComplete??!1,this.checkpointEmit&&this.checkpointEmit({type:this.type,...c()}),this.progress=0,this.isActive=!0}function a(u,h){s.has(u)||s.set(u,[]),s.get(u).push(h)}function r(u){s.has(u)&&s.get(u).forEach(h=>h())}function l(u,h={}){u in Xs&&i(u,h).emit(),r(u)}function c(){var u,h;return{game:e,currentProgress:((u=e.currentChapter)==null?void 0:u.progress)??0,camera:((h=e.currentChapter)==null?void 0:h.camera)??null,scene:e.currentChapter??null}}}const Yr=Math.PI*2,ym=new V(1,1,1),bm=new k,xm={beforeAlloc:wm,particleEmitted:Sm,particleUpdated:$m};function wm(e={}){e.position||(e.position=bm),e.scale=e.scale||1,e.angOffset=H.randomFloat(0,Yr),e.batcherName=e.batcher||"gem_emissive"}function Sm(e,{angOffset:t,position:s,scale:i,velDrag:n,sprite:o,color:a,amount:r,billboard:l,duration:c=1e3,velocity:u=8*H.randomFloat(.6,1.1),velocityVec:h=new k,opacity:d,delay:f=0,gravity:b=0,isGlowy:p=!1,phi:m=0,theta:g=0}){const y=Yr/r;e.index*y+H.randomFloat(-.2,.2)+t,e.v=u,e.delay=H.randomFloat(0,20),e.billboard=l||!0,e.angVelocity=0,e.spriteId=o,m=m||H.randomFloat(0,Math.PI),g=g||H.randomFloat(0,Math.PI*2),e.phi=m,e.theta=g,e.velocity.x+=u*Math.sin(m)*Math.cos(g),e.velocity.y+=u*Math.sin(g)*Math.sin(m),e.velocity.z+=u*Math.cos(m),p&&e.velocity.copy(h),e.velocityDrag.setScalar(n||.9),e.useVelocityDragMult=!0,e.gravity.y=-.03,e.position.copy(s),p?e.duration=c:e.duration=c*H.randomFloat(.8,1);let x=i.x||i,S=i.y||i;const C=H.randomFloat(.8,1.7);x*=C,S*=C,p||_.$particles.emit("collectibleBurst",{amount:1,position:e.position,scale:new X(x,S).copy(i).multiplyScalar(3),duration:e.duration,delay:e.delay,opacity:.3,velocity:u,velocityVec:e.velocity,isGlowy:!0,depthTest:!0,sprite:"glow",batcher:"gem_emissive",color:a,phi:m,theta:g}),i=i||1,e.scaleFrom.set(x,S),e.scaleTo.setScalar(0),e.alpha=p?.01:1,d=e.alpha,e.colorFrom.copy(a||ym).multiplyScalar(d),e.colorTo.copy(e.colorFrom)}function $m(e,t){const s=e.phi+_.noise(1,_.$time.elapsed*.0015+e.v)*1.5,i=e.theta+_.noise(2,_.$time.elapsed*.0015+e.v)*1.5;e.velocity.x=e.v*Math.sin(s)*Math.cos(i),e.velocity.y=e.v*Math.sin(i)*Math.sin(s),e.velocity.z=e.v*Math.cos(s)}const Mm=Object.freeze(Object.defineProperty({__proto__:null,default:xm},Symbol.toStringTag,{value:"Module"})),Kr=Math.PI*2,Cm=new V(1,1,1),Xr=new k,km=new V,Tm={beforeAlloc:Em,particleEmitted:Pm};function Em(e={}){e.position||(e.position=Xr.setScalar(0)),e.scale=e.scale||1,e.angOffset=H.randomFloat(0,Kr),e.batcherName=e.batcher||"gem_emissive"}function Pm(e,{angOffset:t,position:s,scale:i,velDrag:n,sprite:o,color:a,amount:r,billboard:l,duration:c=1e3,velocity:u=35,velocityVec:h=new k,opacity:d,delay:f=0,gravity:b=0,isGlowy:p=!1}){const m=Kr/r;e.index*m+H.randomFloat(-.2,.2)+t,u*=H.randomFloat(.8,2.5),e.delay=H.randomFloat(0,20),e.billboard=l||!0,e.angVelocity=0,e.spriteId=o;const g=H.randomFloat(0,Math.PI),y=H.randomFloat(0,Math.PI*2);e.velocity.x+=u*Math.sin(g)*Math.cos(y),e.velocity.y+=u*Math.sin(y)*Math.sin(g),e.velocity.z+=u*Math.cos(g),p&&e.velocity.copy(h),e.velocityDrag.setScalar(n||.9),e.useVelocityDragMult=!0,e.gravity.y=-.03,e.position.copy(s),p?e.duration=c:e.duration=c*H.randomFloat(.8,1),p||_.$particles.emit("fireworksBurst",{amount:1,position:e.position,scale:new X(.01,.01),duration:e.duration,delay:e.delay,opacity:.3,velocityVec:e.velocity,isGlowy:!0,depthTest:!0,sprite:"glow",batcher:"gem_emissive",color:a}),i=i||1;const x=i.x||i,S=i.y||i;e.scaleFrom.set(x,S),e.scaleTo.setScalar(0),e.alpha=p?.01:1,d=e.alpha,e.colorFrom.copy(a||Cm).multiplyScalar(d),e.colorTo.copy(e.colorFrom),_.$particles.emit("sparkles",{amount:1,position:e.position,duration:e.duration/1e3,delay:e.delay/1e3,batcher:"fireworksTrail",sprite:"sparkleB",color:e.colorFrom,colorFrom:e.colorFrom,colorTo:km.copy(e.colorFrom).offsetHSL(0,1,.5),alpha:1,hueVariation:10,alphaTo:0,velocity:u,damping:n??.9,direction:Xr.copy(e.velocity).normalize(),trailDamping:10,gravity:e.gravity,thickness:.06})}const Lm=Object.freeze(Object.defineProperty({__proto__:null,default:Tm},Symbol.toStringTag,{value:"Module"})),Qr=Math.PI*2,Am=new V(1,1,1),Jr=new k,Om=Qr,Rm={beforeAlloc:Dm,particleEmitted:Im};function Dm(e={}){e.position||(e.position=Jr),e.scale=e.scale||1,e.angOffset=Qr*.6,e.batcherName=e.batcher||"gem_emissive"}function Im(e,{angOffset:t,position:s,scale:i,velDrag:n,sprite:o,color:a,amount:r,billboard:l,duration:c,velocity:u=1,opacity:h,gravity:d=0}){const f=Om/r,b=e.index*f+H.randomFloat(-.2,.2)+t;u*=H.randomFloat(.8,1.2),e.billboard=l||!0,e.delay=H.randomFloat(20,100),e.angVelocity=0,e.spriteId=o,e.velocity.x+=u*Math.cos(b),e.velocity.y+=u*Math.sin(b),e.angle=-b+Math.PI/16,e.velocityDrag.setScalar(n||.98),e.useVelocityDragMult=!0,e.gravity.y=-.2*H.randomFloat(.2,2.5),e.position.copy(s),e.position.add(Jr.copy(e.velocity).multiplyScalar(2.5)),e.duration=c*H.randomFloat(.8,1),i=i||1;const p=i.x||i,m=i.y||i;e.scaleFrom.set(p,m),e.scaleTo.setScalar(0),e.alpha=.9,e.colorFrom.copy(a||Am).multiplyScalar(h),e.colorTo.copy(e.colorFrom)}const zm=Object.freeze(Object.defineProperty({__proto__:null,default:Rm},Symbol.toStringTag,{value:"Module"})),Fm={beforeAlloc:Um,particleEmitted:jm};function Um(e={}){e.position||(e.position=el),e.scale=e.scale||1,e.angOffset=Nm*.6,e.batcherName=e.batcher||"gem_emissive"}const Nm=Math.PI*2,Bm=new V(1,1,1),Qo=new V(0,0,0);new Oe;const el=new k,Vm=[0,.815,.145,1],Zm=[0,.485,.465,1];function jm(e,{position:t,scale:s,sprite:i,duration:n,rotation:o=0,power:a,gravityY:r=0,powerMult:l=1,color:c,delay:u=0,glowMult:h=1}){e.billboard=!0,e.spriteId=i,e.position.copy(t||el),e.duration=n||1e3,e.delay=u*1e3,s=s||1;const d=s.x||s,f=s.y||s;e.scaleFrom.set(d,f),e.scaleTo.copy(e.scaleFrom).multiplyScalar(1.1),e.gravity.y=r,e.angle=o,e.alphaEase=W(Zm),e.alphaFrom=1,e.alphaTo=1,e.colorEase=W(Vm),e.colorFrom.lerpColors(Qo,c||Bm,(.5+a*.5)*l),e.colorTo.copy(Qo)}const Hm=Object.freeze(Object.defineProperty({__proto__:null,default:Fm},Symbol.toStringTag,{value:"Module"})),Gm=Math.PI*.5,mo=new k,Wm=new k,qm=new k,Ym=new k,Km=new V;W(ne.cubicIn);W(ne.expoIn);const Xm=W(ne.expoOut);W(ne.cubicOut);new V(0,0,0);new V("white");const Qm=new k(0,0,-1),Jm=new k(0,1,0);new k(-1,0,0);new k(1,0,0);const Jo=new Re,e0=()=>{},t0=1.5,s0={beforeAlloc:n0,particleEmitted:i0,particleUpdated:o0,particleKilled:a0};function n0(e={}){e.position||(e.position=mo.setScalar(0)),e.scale=e.scale||1,e.batcherName=e.batcher||"gem_emissive"}function i0(e,{sprite:t,position:s,origin:i,thickness:n,gravity:o=-5,fk:a,color:r,onComplete:l=e0,forceAngle:c=0}){e.spriteId=t,e.targetPosition=s.clone(),e.origin=i.clone(),e.position.copy(i),e.colorFrom.copy(r),e.colorTo.copy(r),e.scaleFrom.setScalar(.01),e.scaleTo.copy(e.scaleFrom),e.gravity.set(0,o,0),e.thickness=n,e.fksolver=a,e.prevPosition=e.position.clone(),e.trailDamping=60,e.duration=5e3,e.velocity.copy(r0(e.position,e.targetPosition,Math.abs(e.gravity.y),c)),e.velocityDrag.setScalar(1),e.random=H.randomFloat(0,1),e.direction=e.targetPosition.clone().sub(e.position),e.distance=e.direction.length(),e.direction.normalize(),e.glow=new _t({batcher:"gem_emissive",id:"flash",scale:.001,alpha:.2,color:r,fx:0}),e.glowDense=new _t({batcher:"gem_emissive",id:"flash",scale:.006,alpha:.03,color:r,fx:0}),e.useVelocityDragMult=!0,e.onComplete=l}function o0(e,t){const s=_.$time.elapsed*.01,i=_.rng.randomFloat(.2,1)*t0;(e.position.distanceToSquared(e.targetPosition)<i**2||e.progress>.5&&e.position.y<e.random*10-1)&&(e.killable=!0);const n=Math.sin(e.progress*Math.PI),o=_.noise((e.progress+s*.01)*n*.2,e.random*4354)*.03*n,a=_.noise((e.progress+s*.01)*n*.2,e.random*1535.5)*.03*n;e.position.x+=o,e.position.y+=a;const r=mo.copy(e.position).sub(e.prevPosition).normalize();e.glow.position.copy(e.position),e.glowDense.position.copy(e.position);for(let l=0;l<e.points.length;l++){const c=Xm(l/(e.points.length-1)),u=e.points[l];u.x+=r.y*Math.sin((s*.1+l*.5)*30+e.random*31.45)*.1*c,u.y+=r.x*Math.sin((s*.1+l*.5)*30+e.random*1031.45)*.1*c}H.randomFloat()<.2&&!_.$app.$store.runningTransition&&_.$particles.emit("sparkles",{amount:3,batcher:"fireworks",sprite:"flash",position:e.position,color:Km.copy(e.color).offsetHSL(0,.1,.2),colorTo:e.color,colorEase:ne.outExpo,alpha:1,alphaTo:0,spread:.2,velocity:3,velocityRandom:1,hueVariation:10,scale:6e-4,scaleFrom:0,scaleInOut:!0,direction:r,scaleRandom:.5,duration:1,durationRandom:.8,alphaRandom:1,gravity:e.gravity,onProgress:l=>{const c=_.noise(l.position.x*.1+s,l.position.y*.1)*.1,u=_.noise(l.position.x*.1,l.position.y*.1+s)*.1;l.velocity.x+=c,l.velocity.y+=u}}),e.prevPosition.copy(e.position)}function a0(e,t){e.glow.destroy(),e.glowDense.destroy()}const r0=(e,t,s,i=0)=>{const n=t.x<e.x?-1:1,o=Math.PI*.25-Math.random()*Math.PI*.1,a=i||Math.abs(Gm-Math.atan2(t.x-e.x,(t.y-e.y)*n))+o,r=Wm.set(t.x,0,0),l=qm.set(e.x,0,0),c=Math.abs(r.x-l.x),u=e.y-t.y,h=1/Math.cos(a)*Math.sqrt(Math.abs(.5*s*c**2/(c*Math.tan(a)+u))),d=Ym.set(0,h*Math.sin(a),h*Math.cos(a)),f=Qm.angleTo(mo.copy(r).sub(l));return Jo.setFromAxisAngle(Jm,f),d.applyQuaternion(Jo),d.x*=n,d.y=Math.abs(d.y),d.clampLength(12,30),d},l0=Object.freeze(Object.defineProperty({__proto__:null,default:s0},Symbol.toStringTag,{value:"Module"})),c0={beforeAlloc:f0,particleEmitted:p0,particleUpdated:m0},u0=new k,Qt=new k,d0=new k,ea=new k,h0=new k(1,0,0),li=new k(0,1,0);function f0(e){e.amount=1,e.batcherName=e.batcher||"emissive"}function p0(e,{count:t=1,position:s,scale:i=1,scaleFrom:n=i,scaleTo:o=i,color:a=16777215,colorFrom:r=a,colorTo:l=a,scaleEase:c,duration:u=1,alpha:h=1,alphaFrom:d=h,alphaTo:f=h,alphaInOut:b,angularVelocity:p=0,velocity:m=[1,1],spawnRadius:g=1,gravity:y=-3,spread:x=0}){const{rng:S}=_,C=S.random()<.1;e.count=t,e.spriteId=C?"smoke":"cloud-blurred";const w=e.batcher.atlas.sprites[e.spriteId].length;e.spriteFrame=Math.floor(w*S.random()),e.billboard=!0,e.duration=(Array.isArray(u)?S.randomFloat(u[0],u[1]):u)*1e3,e.alphaInOut=b,Qt.copy(s);const v=S.randomFloat(0,Math.PI*2),$=S.random()**.5*g,P=1-Ce(0,g,$);Qt.x+=Math.cos(v)*$,Qt.z+=Math.sin(v)*$,e.position.copy(Qt);const[T,L]=m,O=u0.copy(e.position).sub(s).add(li).normalize(),D=Qt.copy(O).normalize(),U=ea.copy(li).lerp(h0,D.dot(li)),A=d0.copy(D).cross(U),R=ea.copy(A).cross(D),z=S.randomFloat(-x/2,x/2),Y=S.randomFloat(-x/2,x/2);D.applyAxisAngle(A,z),D.applyAxisAngle(R,Y),D.normalize(),e.velocity.copy(D).setLength(S.randomFloat(T,L)),e.velocity.y+=C?P*4:P*2,e.velocityDrag.setScalar(.995),e.angle=O.x*P*-.04,e.useVelocityDragMult=!0,e.angVelocity=Array.isArray(p)?S.randomFloat(p[0],p[1]):p,n=Array.isArray(n)?S.randomFloat(n[0],n[1]):n,o=Array.isArray(o)?S.randomFloat(o[0],o[1]):o,e.scaleFrom.setScalar(n),e.scaleTo.setScalar(o),e.scaleEase=W(c),e.alphaFrom=d,e.alphaTo=f,e.colorFrom.copy(r),e.colorTo.copy(l),e.gravity.y=y}function m0(e,t){const s=1-Ce(.8,1,e.progress),i=Qt.copy(e.scale).multiplyScalar(s);e.scale.lerp(i,.1)}const g0=Object.freeze(Object.defineProperty({__proto__:null,default:c0},Symbol.toStringTag,{value:"Module"}));new V(1,1,1);new V(0,0,0);const Ki=new k,v0=new k,ta=new k,_0=new k,sa=new k,ci=new k(0,1,0),y0=new k(1,0,0),na=new k(0,0,1),Zt=new V,ia=new Re,ui=()=>{},tl={beforeAlloc:b0,particleEmitted:x0,particleUpdated:w0};function b0(e){e.amount=1,e.batcherName=e.batcher}function x0(e,{amount:t=1,sprite:s="circle-blur",position:i=sa,frame:n=0,direction:o=ci,velocity:a=0,velocityRandom:r=0,delay:l=0,delayRandom:c=0,duration:u=.5,durationRandom:h=0,spread:d=0,spawnRadius:f=0,scale:b=1,scaleTo:p=b,damping:m=.99,alpha:g=1,alphaRandom:y=0,alphaTo:x=g,scaleRandom:S=0,color:C=new V("white"),colorFrom:w,colorTo:v,hueVariation:$=0,scaleEase:P=ne.outSine,alphaEase:T=ne.outCubic,colorEase:L=ne.outCubic,gravity:O=sa,zLock:D=!1,alphaInOut:U=!1,scaleInOut:A=!1,rotation:R=0,yAligned:z=!1,angVelocity:Y=0,fx:ce=0,fx2:oe=0,timeScale:ue=1,onStart:K=ui,onProgress:ve=ui,onComplete:j=ui,parent:ee,...Se}){const Ue=_0.set(0,1,0).applyAxisAngle(na,Math.random()*Math.PI*2).multiplyScalar(f*Math.random()**2),Je=Array.isArray(s)?s[Math.floor(Math.random()*s.length)]:s;e.spriteId=Je,e.alphaInOut=U,e.scaleInOut=A,e.delay=l*1e3*(1-c*Math.random()),e.amount=t,e.onStart=K,e.onProgress=ve,e.onComplete=j,e.parent=ee,e.randomFloat=Math.random(),e.spriteFrame=n,e.angVelocity=Y,e.fx=ce,e.fx2=oe,e.timeScale=ue,e.billboard=e.isParticle,e.duration=u*1e3*(1-h*Math.random()),e.initialAngle=R,e.yAligned=z,ia.setFromUnitVectors(na,o),e.gravity.copy(O),e.position.copy(i).add(Ue.applyQuaternion(ia));const Ft=1-S*Math.random(),Zs=b*Ft;e.scaleFrom.setScalar(Zs),typeof p=="number"?e.scaleTo.setScalar(p):e.scaleTo.copy(p),e.scaleTo.multiplyScalar(Ft),e.scaleEase(P),e.alphaEase(T),e.colorEase(L);const We=Ki.copy(o).normalize(),$t=ta.copy(ci).lerp(y0,We.dot(ci)*.5+.5).normalize(),ut=v0.copy(We).cross($t),Mt=ta.copy(ut).cross(We),Ut=we.randFloat(-d/2,d/2),js=we.randFloat(-d/2,d/2);We.applyAxisAngle(ut,Ut),We.applyAxisAngle(Mt,js),We.normalize(),e.velocity.copy(We).setLength(a*(1-Math.random()*r)),e.velocityDrag.setScalar(m),e.useVelocityDragMult=!0,D&&(e.velocityDrag.z=0),Array.isArray(C)?Zt.set(C[Math.floor(Math.random()*C.length)]):typeof C=="number"||typeof C=="string"?Zt.set(C):Zt.copy(C),Zt.offsetHSL($/360*Math.random()%1,0,0),e.colorFrom.copy(w??Zt),e.colorTo.copy(v??Zt),e.alphaFrom=g*(1-y*Math.random()),e.alphaTo=x;const de=Ki.copy(e.velocity).normalize(),et=Math.atan2(de.y,de.x);if(e.angle=et+e.initialAngle,e.isTrailParticle){const{trailDamping:hs=e.trailDamping,thickness:Vn=e.thickness,trailLength:xl=e.trailLength,fk:wl=e.fksolver}=Se;e.trailDamping=hs,e.thickness=Vn,e.trailLength=xl,e.fksolver=wl}}function w0(e,t){if(!e.yAligned)return;const s=_.$time.dt*.001,i=Ki.copy(e.velocity).normalize(),n=Math.atan2(i.y,i.x)+e.initialAngle;e.angle=ac(e.angle,n,1-Math.exp(-s*1e3))}const S0=Object.freeze(Object.defineProperty({__proto__:null,default:tl},Symbol.toStringTag,{value:"Module"})),{beforeAlloc:$0,particleEmitted:M0,particleUpdated:oa}=tl,C0={beforeAlloc:sl,particleEmitted:nl,particleUpdated:T0},k0=new k;function sl(e){$0.apply(sl,[e])}function nl(e,{...t}){M0.apply(nl,[e,t]);const{rng:s}=_,i=k0.copy(e.velocity).normalize(),n=s.randomFloat(.3,1);e.position.add(i.multiplyScalar(n))}function T0(e,t){oa.apply(oa,[e,t])}const E0=Object.freeze(Object.defineProperty({__proto__:null,default:C0},Symbol.toStringTag,{value:"Module"})),P0={beforeAlloc:D0,particleEmitted:I0,particleUpdated:z0},L0=new k,A0=new k,aa=new k,O0=new k,di=new k(0,1,0),R0=new k(1,0,0);function D0(e){e.amount=1,e.batcherName=e.batcher||"emissive"}function I0(e,{amount:t=1,position:s=new k,scale:i=1,scaleFrom:n=i,scaleTo:o=i,color:a=new V,velocity:r=[1,1],sprite:l,duration:c=1,alpha:u=1,alphaFrom:h=u,spread:d=0,alphaTo:f=u}){const{rng:b}=_;e.spriteId=l,e.duration=c*1e3,e.amount=t,e.position.copy(s),e.scaleFrom.setScalar(n),e.scaleTo.setScalar(o),e.alphaFrom=h,e.alphaTo=f,e.colorFrom.copy(a),e.colorTo.copy(a),e.gravity.set(0,-1,0);const[p,m]=r,g=O0.copy(e.position).sub(s).add(di).normalize(),y=L0.copy(g).normalize(),x=aa.copy(di).lerp(R0,y.dot(di)),S=A0.copy(y).cross(x),C=aa.copy(S).cross(y),w=b.randomFloat(-d/2,d/2),v=b.randomFloat(-d/2,d/2);y.applyAxisAngle(S,w),y.applyAxisAngle(C,v),y.normalize(),e.velocity.copy(y).setLength(b.randomFloat(p,m)),e.velocityDrag.setScalar(.995),e.useVelocityDragMult=!0}function z0(e,t){}const F0=Object.freeze(Object.defineProperty({__proto__:null,default:P0},Symbol.toStringTag,{value:"Module"})),U0={beforeAlloc:N0,particleEmitted:B0,particleUpdated:V0};new k;new k;new k;new k;new k(0,1,0);new k(1,0,0);function N0(e){e.amount=1,e.batcherName=e.batcher||"emissive"}function B0(e,{amount:t=1,position:s=new k,scale:i=1,scaleFrom:n=i,scaleTo:o=i,color:a=new V,colorFrom:r=a,colorTo:l=a,velocity:c=[1,1],sprite:u,duration:h=1,alpha:d=1,alphaFrom:f=d,spread:b=0,alphaTo:p=d,velX:m=0}){e.spriteId=u,e.duration=h*1e3,e.amount=t,e.position.copy(s),e.scaleFrom.copy(n),e.scaleTo.copy(o),e.alphaFrom=f,e.alphaTo=0,e.velocity.x=-m||-H.randomFloat(70,100),e.useVelocityDrag=!1,e.colorFrom.copy(a),e.colorTo.copy(a)}function V0(e,t){}const Z0=Object.freeze(Object.defineProperty({__proto__:null,default:U0},Symbol.toStringTag,{value:"Module"}));let hi=!1,j0=!0;const ra="string",xs={};let H0=0;class ke{constructor(t={}){this.isComponent=!0,this.props=t;const s=this.usedMixins=[];s.dynamic=[],this.static=!1,this.webgl=St(),this.scene=null,this.parent=null,this.base=null;const i=this.children=[];if(i.dynamic=[],this.isInit=!1,this.isDestroyed=!1,this.uid=++H0,this.name||(this.props.name?this.name=this.props.name:this.props.id?this.name=this.props.id:(this.name=this.constructor.name,xs[this.name]?++xs[this.name]:xs[this.name]=1,xs[this.name]>1&&(this.name+="_"+(xs[this.name]-1)))),hi&&(this.guiItems=new Set,window.debugWebglComponentCount++),j0){const n=An("GL."+this.name,"#000","#5cb182");this.log=n.log,this.warn=n.warn,this.error=n.error}else this.log=this.warn=this.error=()=>{}}triggerInit(){if(!this.isInit){if(this.beforeInit&&this.beforeInit(),this.mixins){const t=this.mixins;if(Array.isArray(t))for(let s=0;s<t.length;s++){let i=t[s],n;Array.isArray(i)&&(n=i[1],i=i[0]),this.useMixin(i,n)}}this.init&&this.init(),this.isInit=!0,this.afterInit&&this.afterInit(),hi&&this.devtools&&this.devtools()}}bind(t,s=0){return this[t]=Ts(t,this,s),this[t]}useMixin(t,s={}){typeof t===ra&&(t=this.webgl.collection.mixins[t]),t&&(t.isMixin?t:new t(s)).use(this)}unuseMixin(t){t&&t.unuse()}addObject3D(t){return this.base&&this.base.add(t),t}removeObject3D(t){return this.base&&this.base.remove(t),null}add(t,s={},i){if(typeof t===ra&&(t=this.webgl.collection.components[t]),!t)return;if(~this.children.indexOf(t))return t;t.isComponent||(t=new t(s));const n=t.parent;return n&&n.remove(t),t.parent=this,this.scene?t.scene=this.scene:this.isScene&&(t.scene=this),t.isInit||t.triggerInit(s),t.static||this.children.dynamic.push(t),this.children.push(t),t.base&&(i?i.add(t.base):this.base&&this.base.add(t.base)),t.destroyed?(this.remove(t),t):(this.isAttached&&go(this.scene,t),t)}removeFromParent(){this.parent&&this.parent.remove(this)}remove(t){const s=this.children.indexOf(t);if(!~s)return;this.children.splice(s,1);const i=this.children.dynamic.indexOf(t);return~i&&this.children.dynamic.splice(i,1),t.parent=null,t.base&&t.base.removeFromParent(),vo(t),null}triggerUpdate(){if(!this.isInit)return;this.beforeUpdate&&this.beforeUpdate();const t=this.usedMixins.dynamic;for(let i=0,n=t.length;i<n;i++){const o=t[i];if(o&&o.update(),this.isDestroyed)break;o.isDestroyed&&(n--,i--)}if(this.isDestroyed||(this.update&&this.update(),this.isDestroyed))return;const s=this.children.dynamic;for(let i=0,n=s.length;i<n;i++){const o=s[i];o&&o.triggerUpdate(),o.isDestroyed&&(n--,i--)}!this.isDestroyed&&this.afterUpdate&&this.afterUpdate()}destroy(){if(!this.isDestroyed){this.beforeDestroy&&this.beforeDestroy();for(let t=this.usedMixins.length-1;t>=0;t--)this.usedMixins[t].destroy();this.parent&&this.parent.remove(this);for(let t=this.children.length-1;t>=0;t--)this.children[t].destroy();if(this.base){for(let t=this.base.children.length-1;t>=0;t--)this.base.remove(this.base.children[t]);this.base.removeFromParent()}this.props=null,this.usedMixins=null,this.webgl=null,this.scene=null,this.parent=null,this.base=null,this.children=null,this.isDestroyed=!0,hi&&(this.guiItems.forEach(t=>t.dispose&&t.dispose()),this.guiItems.clear(),this.guiItems=null,window.debugWebglComponentCount--)}}}ke.triggerAttached=go;function go(e,t){const s=t.children,i=t.usedMixins;if(!t.isAttached){t.isAttached=!0,t.scene=e,t.attached&&t.attached();for(let n=i.length-1;n>=0;n--)i[n].componentAttached(t);for(let n=s.length-1;n>=0;n--)go(e,s[n])}}ke.triggerDetached=vo;function vo(e){const t=e.children,s=e.usedMixins;if(!e.isAttached){e.scene=null;return}for(let i=t.length-1;i>=0;i--)vo(t[i]);for(let i=s.length-1;i>=0;i--)s[i].componentDetached(e);e.isAttached=!1,e.detached&&e.detached(),e.scene=null}const G0=new k(-.5,-.5,-.5),W0=new k(.5,.5,.5),q0=new k;class il{constructor(){this.frustum=new fr,this.planes=this.frustum.planes,this.bbox3=new On(G0,W0),this.sphere=new io,this.cam=null}computeProjection(){var i;const t=(i=_.scene)==null?void 0:i.getCurrentCamera().base;if(!t)return;const s=Fe.get();t.updateMatrixWorld(),this.frustum.setFromProjectionMatrix(s.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),s.release()}isInViewport(t,s){return s&&s.isBox3?(this.bbox3.copy(s),this.bbox3.applyMatrix4(t),this.frustum.intersectsBox(this.bbox3)):s&&s.isSphere?(this.sphere.copy(s),this.sphere.applyMatrix4(t),this.frustum.intersectsSphere(this.sphere)):(this.sphere.set(q0,1),this.sphere.applyMatrix4(t),this.frustum.intersectsSphere(this.sphere))}}const fi=()=>{};class ol{constructor(t=new rc,s=new lc,i=100){this.geometry=t,this.material=s,this._count=i,this._maxCount=i,this.geometry.computeBoundingBox(),this.fc=new il,this.init(),this.updateInstancesState()}init(){this.base=new Rn(this.geometry,this.material,this._count+1),this.base.frustumCulled=!1,this.base.matrixAutoUpdate=!1,this.base.manualMatrixUpdate=!0,this.base.instanceMatrix.setUsage(oo),this.instanceNeedsUpdate=!1,this.instanceData=Array(this._count).fill(()=>null).map(()=>Y0(this)),this.visibleInstances=[],this.alivedInstances=[],this.deadInstances=[]}forEach(t=fi){this.visibleInstances.forEach((s,i)=>{this.setMatrixAt(i,t)}),this.instanceNeedsUpdate=!0}forEachInstance(t=fi){this.instanceData.forEach((s,i)=>{this.setMatrixAt(i,t,this.instanceData)}),this.instanceNeedsUpdate=!0}setMatrixAt(t,s=fi,i=this.visibleInstances){const n=i[t];if(!n)return this;const{pool:o,position:a,scale:r,rotation:l,quaternion:c,isInViewport:u,color:h,matrix:d}=n;return s({position:a,scale:r,rotation:l,data:n.data,instance:n,color:h,pool:o,isInViewport:u},t,i),c.setFromEuler(l),d.compose(a,c,r),this.instanceNeedsUpdate=!0,this}getInstanceAt(t){const s=this.alivedInstances[t];return s||null}add(t=1){const s=Math.min(this._maxCount,this._count+t)-this._count;let i=[];for(let n=0;n<s;n++)this.deadInstances[n]&&(this.deadInstances[n].isAlive.set(!0),i.push(this.deadInstances[n]));return this.instanceNeedsUpdate=!0,i}remove(t){const s=this.alivedInstances.indexOf(t);return s<0?this:this.removeAt(s)}removeAt(t=Math.max(0,this.alivedInstances.length-1)){return t>this.alivedInstances.length-1||t<0?this:("onBeforeRemove"in this.alivedInstances[t]&&this.alivedInstances[t].onBeforeRemove(),this.alivedInstances[t].isAlive.set(!1),this.instanceNeedsUpdate=!0,this)}updateInstancesState(){this.visibleInstances.length=0,this.alivedInstances.length=0,this.deadInstances.length=0,this.fc.computeProjection(),this.instanceData.forEach((t,s)=>{const{isAlive:i,matrix:n,position:o,quaternion:a,rotation:r,scale:l,visible:c}=t;i.value&&(a.setFromEuler(r),n.compose(o,a,l));const u=this.fc.isInViewport(n,this.geometry.boundingBox);t.isInViewport=u,u&&i.value&&c&&this.visibleInstances.push(t),i.value?this.alivedInstances.push(t):this.deadInstances.push(t)}),this.base.count=this.visibleInstances.length,this._count=this.base.count,this.instanceNeedsUpdate=!1}refresh(t=this.instanceNeedsUpdate){t&&this.updateInstancesState();for(let s=0;s<this.base.count;s++){const{matrix:i,color:n}=this.visibleInstances[s];this.base.setMatrixAt(s,i),this.base.setColorAt(s,n)}t&&(this.base.instanceMatrix.needsUpdate=!0,this.base.instanceColor&&(this.base.instanceColor.needsUpdate=!0))}reset(){for(let t=this.deadInstances.length-1;t>=0;t--){const s=this.deadInstances[t];s.isAlive.set(!0),s.isInViewport=!1}this.instanceNeedsUpdate=!0,this.refresh(!0)}dispose(){this.base.dispose(),this.base.geometry.dispose(),this.base.material.dispose()}getInstances(){return this.instanceData}getLivingInstances(){return this.alivedInstances}getDeadInstances(){return this.deadInstances}}const Y0=e=>({isAlive:te(!1),isInViewport:!1,visible:!0,data:{},pool:e.base,color:new V,matrix:new Fe,position:new k,scale:new k(1,1,1),quaternion:new Re,rotation:new It});let K0=0;function re(e,t,s){const i=()=>{};return{c:++K0,shader:e,use:o=>{const a=o.material||o;return a[t]=e,a.needsUpdate=!0,o},unuse:i,clear:i}}const X0=`#define STANDARD
varying vec3 vViewPosition;
attribute vec2 randomOffsetUV;
#define MAX_TEXTURE 2.
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <ascendfog_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#ifdef USE_MAP
vMapUv.xy += randomOffsetUV;
vMapUv *= .5;
vMapUv = fract(vMapUv);
#endif
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = - mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#include <ascendfog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition = worldPosition.xyz;
#endif
}`,Q0=re(X0,"vertexShader"),J0=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float lightIntensity;
#ifdef IOR
uniform float ior;
#endif
#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif
#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;
#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <ascendfog_pars_fragment>
#include <lighten>
#include <saturate>
#include <luma>
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
vec3 vNorm = normalize(vNormal);
vec3 norm = normalize(normal);
vec3 sLightPosition = vec3(-.2, .1, 1.);
sLightPosition = normalize(sLightPosition);
float sLightPower = .5 * lightIntensity;
float sLighting = dot(norm, sLightPosition);
sLighting += dot(vNorm, sLightPosition);
sLighting = pow(sLighting, sLightPower);
float fresnelPower = .6 * lightIntensity;
float _sFresnel = smoothstep(-.2, 1., sLighting);
_sFresnel = pow(_sFresnel, fresnelPower);
_sFresnel = 1. - smoothstep(.2, .65, _sFresnel);
vec3 sFresnel = (directLight.color + vec3(.7)) * _sFresnel * _sFresnel;
vec3 wLightPosition = vec3(-.2, -.3, 1.7);
wLightPosition = normalize(wLightPosition);
float wLightPower = .8 * lightIntensity;
float wLighting = dot(norm * .1, wLightPosition);
wLighting += dot(vNorm, wLightPosition) * .2;
wLighting = smoothstep(.0, .7, wLighting);
wLighting = pow(wLighting, wLightPower);
float wFresnelPower = .55 * lightIntensity;
float _wFresnel = smoothstep(-.2, .9, wLighting);
_wFresnel = pow(_wFresnel, wFresnelPower);
_wFresnel = 1. - smoothstep(.2, .65, _wFresnel);
vec3 wFresnel = (directLight.color + vec3(.5)) * _wFresnel * _wFresnel;
vec3 fresnel = (wFresnel * .8) + (sFresnel * .7);
#include <aomap_fragment>
vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
outgoingLight *= ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
#endif
#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <ascendfog_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,e1=re(J0,"fragmentShader");class t1 extends Fs{constructor({uniforms:s={},defines:i={},...n}){super(n);se(this,"name","HotAirBalloonMaterial");this.type="StandardMaterial",this.uniforms={...Us.standard.uniforms,...Le.fog,...s},this.defines||(this.defines={}),Object.assign(this.defines,i),Q0.use(this),e1.use(this)}}const la=16,s1=4;class n1 extends ke{static async load(){const{load:t}=_.$assets;await Promise.all([t("hab-model"),t("hab-diffuse"),t("hab-normal",{data:!0,flipY:!1})])}init(){var h,d;const{$assets:t,$game:s,$store:i}=this.webgl,{"hab-diffuse":n,"hab-normal":o}=t.textures,a=t.objects["hab-model"].scene,r=[];a.traverse(f=>{f.isMesh&&r.push(f.geometry.clone())});const l=pr(r),c=this.mat=new t1({transparent:!1,fog:!0,map:n,normalMap:o,normalScale:{x:1.75,y:.95},envMap:s.envMap,uniforms:{...this.webgl.uniforms,roughness:{value:.6},metalness:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:.65},lightIntensity:{value:0},...this.scene.ascendFog.uniforms},defines:{...this.webgl.defines,...this.scene.ascendFog.defines}});this.pool=new ol(l,c,la),this.base=this.pool.base,this.base.renderOrder=i.z.environment,this.base.renderToDepthPrepass=!0;const u=[];for(let f=0;f<la;f++)u.push(0,0);this.base.geometry.setAttribute("randomOffsetUV",new Ot(new Float32Array(u),2)),this.pool.forEachInstance(({data:f})=>{const b=Math.floor(s1*Math.random());f.randomOffsetUV=new X(b%2,Math.floor(b/2))}),this.pool.refresh(!0),(h=this.parent)==null||h.prerenderTextures.push(n),(d=this.parent)==null||d.prerenderTextures.push(o),this.instance=this.getBalloonInstances(1),this.needsUpdate=!0,this.instance[0].scale.set(2,2,2),this.webgl.hooks.beforePrerender.watch(this.beforePrerender,this),this.webgl.hooks.afterPrerender.watch(this.afterPrerender,this)}getBalloonInstances(t){return this.pool.add(t)}beforePrerender(){this.base.count=1}afterPrerender(){this.base.count=0,this.pool.remove(this.instance[0])}destroy(){this.webgl.hooks.beforePrerender.unwatch(this.beforePrerender,this),this.webgl.hooks.afterPrerender.unwatch(this.afterPrerender,this),super.destroy()}update(){this.base.visible=this.base.count>0;const{randomOffsetUV:t}=this.base.geometry.attributes;this.pool.refresh(!0),this.pool.forEach((s,i)=>{t.setXY(i,s.data.randomOffsetUV.x,s.data.randomOffsetUV.y)}),t.needsUpdate=!0}dispose(){this.pool.dispose()}}const i1=`#define STANDARD
attribute float random;
varying vec3 vViewPosition;
varying vec3 vPosition;
varying float vRandom;
#define MAX_TEXTURE 2.
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <ascendfog_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
vRandom = random;
#include <uv_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
vPosition = transformed;
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = - mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#include <ascendfog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition = worldPosition.xyz;
#endif
}`,o1=re(i1,"vertexShader"),a1=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float time;
uniform float opacity;
varying vec3 vPosition;
varying float vRandom;
#ifdef IOR
uniform float ior;
#endif
#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif
#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;
#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <ascendfog_pars_fragment>
#include <lighten>
#include <saturate>
#include <luma>
#include <rgbhsv>
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;
float emissiveFromCenter = 1. - dot(vPosition, vPosition) * .4;
totalEmissiveRadiance *= vMapUv.y + sin(time * 0.0001 * (vRandom * .5 + .5) + vRandom * 2932.45) * .2 + .5;
totalEmissiveRadiance *= sin(time * 0.0002 * (1. + vRandom * .4) + vRandom * 239.) * .4 + 1.;
totalEmissiveRadiance = rgb2hsv(totalEmissiveRadiance);
totalEmissiveRadiance.r += sin(time * .0003 + vRandom * 2154.) * 0.035;
totalEmissiveRadiance = hsv2rgb(totalEmissiveRadiance);
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#ifdef USE_EMISSIVEMAP
vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
totalEmissiveRadiance *= emissiveColor.rgb;
#endif
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
outgoingLight *= ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
#endif
#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <ascendfog_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,r1=re(a1,"fragmentShader");class l1 extends Fs{constructor({uniforms:t={},defines:s={},...i}){super(i),this.type="StandardMaterial",this.uniforms={...Us.standard.uniforms,...Le.fog,...t},this.defines||(this.defines={}),Object.assign(this.defines,s),o1.use(this),r1.use(this)}}const ca=400;class c1 extends ke{static async load(){const{load:t}=_.$assets;await Promise.all([t("lantern-model"),t("lantern-diffuse",{linear:!0,flipY:!1})])}init(){const{$assets:t,$particles:s}=this.webgl,{position:i,speed:n,scale:o,ascendFog:a}=this.props,{"lantern-diffuse":r}=t.textures,l=t.objects["lantern-model"].scene,c=[];l.traverse(b=>{b.isMesh&&c.push(b.geometry.clone())});const u=pr(c),h=this.mat=new l1({map:r,emissive:16764757,side:mr,uniforms:{time:this.webgl.uniforms.time,...a==null?void 0:a.uniforms},defines:{...a==null?void 0:a.defines}});this.pool=new ol(u,h,ca),this.base=this.pool.base,this.base.visible=!1,this.base.renderToDepthPrepass=!0;const d=[];for(let b=0;b<ca;b++)d.push(0);this.base.geometry.setAttribute("random",new Ot(new Float32Array(d),1));const f=[16764757,16751701,15834490];this.pool.forEachInstance(({base:b,data:p},m)=>{p.random=Math.random(),p.color=new V(Math.floor(Math.random()*f.length)),this.base.setColorAt(m,p.color)}),this.pool.refresh(!0),this.webgl.hooks.beforePrerender.watch(()=>{this.base.count=1}),this.webgl.hooks.afterPrerender.watch(()=>{this.base.count=0})}getLanternInstances(t){const s=this.pool.add(t);return s.forEach(i=>{const n=Math.random(),{matrix:o,data:a}=i;a.halo=new _t({batcher:"city",sprite:"flash",color:16764757,alpha:.5,fx:0,fx2:Math.random(),scale:{x:.01+n*.01,y:.01+n*.01},parent:{matrixWorld:o}}),i.onBeforeRemove=()=>{a.halo.destroy()}}),s}update(){if(this.base.visible=this.base.count>0,!this.needsUpdate)return;this.needsUpdate=!1;const{random:t}=this.base.geometry.attributes;this.pool.refresh(!0),this.pool.forEach((s,i)=>{t.setX(i,s.data.random),this.base.setColorAt(i,s.data.color)}),t.needsUpdate=!0,this.base.instanceColor.needsUpdate=!0}dispose(){this.pool.dispose()}}const u1=`varying vec2 vUv;
#include <ascendfog_pars_vertex>
#include <fog_pars_vertex>
varying float vSize;
varying vec3 vNormal;
void main() {
vec3 transformed = position;
vUv = uv;
mat4 m = instanceMatrix;
vec3 scale = vec3(
length(vec3(m[0][0], m[0][1], m[0][2])),
length(vec3(m[1][0], m[1][1], m[1][2])),
length(vec3(m[2][0], m[2][1], m[2][2]))
);
vNormal = normal;
vSize = scale.y;
#include <project_vertex>
#include <fog_vertex>
#include <ascendfog_vertex>
}`,d1=re(u1,"vertexShader"),h1=`uniform vec3 color;
uniform vec3 aoColor;
uniform float alpha;
varying vec2 vUv;
varying float vSize;
varying vec3 vNormal;
#include <fog_pars_fragment>
#include <ascendfog_pars_fragment>
void main() {
float s = vUv.y * vSize;
float ao = smoothstep(0.2, 0.5, s) - smoothstep(vSize - .5, vSize, s);
vec3 col = mix(aoColor, color, ao);
gl_FragColor = vec4(col, alpha);
vec3 normal = normalize(vNormal);
#include <ascendfog_fragment>
#include <fog_fragment>
}`,f1=re(h1,"fragmentShader");class p1 extends us{constructor({color:s=16777215,aoColor:i=0,alpha:n=1,uniforms:o={},defines:a={},...r}){super(r);se(this,"name","StrokeMaterial");this.fog=!0,this.uniforms={alpha:{value:n},color:{value:new V(s)},aoColor:{value:new V(i)},resolution:_.$renderer.drawingBufferSize,...Le.fog,...o},this.defines||(this.defines={}),Object.assign(this.defines,a),d1.use(this),f1.use(this)}get color(){return this.uniforms.color.value}set color(s){this.uniforms.color.value.set(s)}get aoColor(){return this.uniforms.aoColor.value}set aoColor(s){this.uniforms.aoColor.value.set(s)}get alpha(){return this.uniforms.alpha.value}set alpha(s){this.uniforms.alpha.value=s}}const Qs=new k,jt=new k,Js=new Re,Ht=new Fe;class al extends Rn{constructor({thickness:t=1,...s},i=1){super(new cc(1,1,1,5,1,!1),new p1({side:ao,...s}),i),this.start=new k(0,0,0),this.end=new k(0,1,0),this._thickness=t,this.thickness=t,this.instanceMatrix.setUsage(oo),this.geometry.translate(0,.5,0)}setPoints(t,s,i){this.start.copy(s),this.end.copy(i);const n=this.end.distanceTo(this.start);Qs.copy(this.end).sub(this.start).normalize(),Js.setFromUnitVectors(jt.set(0,1,0),Qs),Ht.compose(this.start,Js,jt.set(this.thickness,n,this.thickness)),this.setMatrixAt(t,Ht),this.instanceMatrix.needsUpdate=!0}get thickness(){return this._thickness}set thickness(t){this._thickness=t;for(let s=0;s<this.count;s++)this.getMatrixAt(s,Ht),Ht.decompose(Qs,Js,jt),jt.x*=t,jt.z*=t,Ht.compose(Qs,Js,jt),this.setMatrixAt(s,Ht);this.instanceMatrix.needsUpdate=!0}}const m1=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform vec2 res;
uniform sampler2D tFakeLights;
uniform sampler2D tDepth;
#ifdef IOR
uniform float ior;
#endif
#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif
#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;
#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif
uniform vec3 emissiveWindows;
uniform sampler2D emissiveWindowsMap;
uniform float emissiveWindowsIntensity;
uniform float emissiveLightsProgress;
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <ascendfog_pars_fragment>
float calc_depth(float z, float near, float far) {
return (2.0 * near) / (far + near - z * (far - near));
}
float fresnelFunc(vec3 viewDirection, vec3 worldNormal, float bias, float scale, float power) {
    return bias + scale * pow( 1.0 - dot( viewDirection, worldNormal), power );
}
void main() {
vec2 st = gl_FragCoord.xy / res.xy;
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>
vec3 fakeLights = texture2D(tFakeLights, st).rgb * 2.;
float depth = unpackRGBAToDepth(texture2D(tDepth, st));
float viewZ = calc_depth(depth, .08, 800.);
float f = fresnelFunc(normalize(vViewPosition), normal, .5, 2., 10.);
viewZ *= f;
viewZ = smoothstep(.01, .06, viewZ);
fakeLights *= viewZ;
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance + fakeLights;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
#endif
#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <ascendfog_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,g1=re(m1,"fragmentShader"),v1=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <ascendfog_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = - mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#include <ascendfog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition = worldPosition.xyz;
#endif
}`,_1=re(v1,"vertexShader");class ua extends Fs{constructor({uniforms:s={},defines:i={},emissiveWindows:n=0,emissiveWindowsIntensity:o=1,emissiveWindowsMap:a=null,emissiveLightsProgress:r=0,...l}){super(l);se(this,"name","TempleMaterial");this.uniforms={...Us.standard.uniforms,...Le.fog,...s,tFakeLights:_.$game.fireworksTexture,tDepth:_.$game.depthPrepass,res:_.$renderer.drawingBufferSize,emissiveWindows:{value:new V(n)},emissiveWindowsMap:{value:a},emissiveWindowsIntensity:{value:o},emissiveLightsProgress:{value:r}},this.type="StandardMaterial",this.dithering=!0,this.lights=!0,this.fog=!0,this.defines||(this.defines={}),Object.assign(this.defines,i),_1.use(this),g1.use(this)}get emissiveWindows(){return this.uniforms.emissiveWindows.value}set emissiveWindows(s){this.uniforms.emissiveWindows.value.set(s)}get emissiveWindowsIntensity(){return this.uniforms.emissiveWindowsIntensity.value}set emissiveWindowsIntensity(s){this.uniforms.emissiveWindowsIntensity.value=s}get emissiveLightsProgress(){return this.uniforms.emissiveLightsProgress.value}set emissiveLightsProgress(s){this.uniforms.emissiveLightsProgress.value=s}}const Gt=new Fe,Wt=new k,y1=new k,qt=new Re,b1=new On;class x1 extends ke{static async load(){const{load:t}=_.$assets;await Promise.all([t("temple"),t("temple_diffuse",{id:"temple_diffuse",linear:!0,data:!0,flipY:!1}),t("temple_normal",{id:"temple_normal",data:!0,flipY:!1}),t("temple_metalness",{id:"temple_metalness",data:!0,flipY:!1}),t("temple_roughness",{id:"temple_roughness",data:!0,flipY:!1}),t("temple_emissive",{id:"temple_emissive",data:!0,flipY:!1}),t("temple_emissive_lights",{id:"temple_emissive_lights",data:!0,flipY:!1}),t("temple_ao",{id:"temple_ao",data:!0,flipY:!1})])}init(){var u,h,d,f,b,p,m,g;const{$assets:t,$game:s}=this.webgl,{temple_diffuse:i,temple_normal:n,temple_metalness:o,temple_roughness:a,temple_ao:r,temple_emissive_lights:l}=t.textures,{scene:c}=t.objects.temple;r.channel=1,r.needsUpdate=!0,this.speed=.2,this.amplitude=1,this.casesArray=[],this.anchors=[],this.anchorRefs=[],this.caseGeometry=null,this.base=new Oe,this.inner=new Oe,this.templePosition=new k,this.casePosition=new k,this.elapsed=0,this.base.scale.setScalar(15),this.base.add(this.inner),this.position=this.base.position,this.scale=this.base.scale,this.rotation=this.base.rotation,c.traverse(y=>{y.isMesh&&y.name==="Temple"&&(this.temple=y.clone(),this.temple.renderToDepthPrepass=!0)}),this.temple.traverse(y=>{y.isMesh&&y.name.includes("case")&&(this.caseGeometry||(this.caseGeometry=y.geometry.clone()),this.casesArray.push({object:y,position:y.position.clone().add(y.parent.position),quaternion:y.quaternion.clone(),scale:y.scale.clone(),amplitude:s.rng.randomFloat(.05,.08),frequency:s.rng.randomFloat(.5,1.5),anchor:y.parent}))}),this.casesArray.forEach(y=>{y.object.removeFromParent()}),this.templeMaterial=new ua({emissiveIntensity:0,map:i,aoMap:r,normalMap:n,metalnessMap:o,normalScale:new X(-.2,.2),roughnessMap:a,emissive:16777215,emissiveMap:l,envMap:s.envMap,envMapIntensity:.5}),this.temple.material=this.templeMaterial,this.templeMaterialCases=new ua({emissiveIntensity:0,map:i,normalMap:n,metalnessMap:o,normalScale:new X(-.2,.2),roughnessMap:a,emissive:16777215,emissiveMap:l,envMap:s.envMap,envMapIntensity:.5}),this.cases=new Rn(this.caseGeometry,this.templeMaterialCases,this.casesArray.length),this.cases.renderToDepthPrepass=!0,this.casesArray.forEach(({position:y,quaternion:x,scale:S},C)=>{Gt.compose(y,x,S),this.cases.setMatrixAt(C,Gt)}),this.cases.instanceMatrix.needsUpdate=!0,this.templePosition.copy(this.temple.position),this.casePosition.copy(this.cases.position),this.strokes=new al({thickness:.002,color:8944497,aoColor:7496281,alpha:.8},this.casesArray.length),this.strokes.renderToDepthPrepass=!0,this.inner.add(this.temple,this.cases,this.strokes),this.size=b1.expandByObject(this.base).getSize(new k),this.base.visible=!1,(h=(u=this.parent)==null?void 0:u.prerenderTextures)==null||h.push(i),(f=(d=this.parent)==null?void 0:d.prerenderTextures)==null||f.push(n),(p=(b=this.parent)==null?void 0:b.prerenderTextures)==null||p.push(o),(g=(m=this.parent)==null?void 0:m.prerenderTextures)==null||g.push(a),this.webgl.hooks.beforePrerender.watch(()=>{this.base.visible=!0,this.base.position.x=0,this.base.position.y=0,this.base.position.z=0,this.base.position.set(0,0,0)}),this.webgl.hooks.afterPrerender.watch(()=>{this.base.visible=!1})}addTo(t){return t.add(this),t.ascendFog&&(Object.assign(this.strokes.material.uniforms,{...t.ascendFog.uniforms}),Object.assign(this.templeMaterial.uniforms,{...t.ascendFog.uniforms}),Object.assign(this.strokes.material.defines,{...t.ascendFog.defines}),Object.assign(this.templeMaterial.defines,{...t.ascendFog.defines})),this}update(){if(!this.visible||this.webgl.$game.isPaused())return;this.base.visible=!0;const t=this.webgl.$time.dt*.001;this.elapsed+=t*this.speed,this.inner.position.x=Math.cos(this.elapsed*2)*.03*this.amplitude,this.inner.position.y=Math.sin(this.elapsed*2)*.1*this.amplitude,this.freeze||(this.temple.rotation.x=Math.sin(this.elapsed*2*Math.PI*.3)*.06*this.amplitude,this.temple.rotation.z=Math.cos(this.elapsed*2*Math.PI*.15)*.03*this.amplitude,this.temple.position.y=(Math.sin(this.elapsed*2+.1)*-.15+.1)*.2*this.amplitude),this.casesArray.forEach(({position:s,quaternion:i,scale:n,amplitude:o,frequency:a,anchor:r},l)=>{this.cases.getMatrixAt(l,Gt),Wt.setFromMatrixPosition(Gt),Wt.y=s.y+Math.sin(this.elapsed*a)*o*this.amplitude,Wt.x=s.x+Math.cos(this.elapsed*a)*o*.5*this.amplitude,Wt.z=s.z+Math.sin(this.elapsed*a)*o*.3*this.amplitude,qt.copy(i),qt.x=i.x+Math.sin(this.elapsed*a)*o*.1*this.amplitude,qt.y=i.y+Math.sin(this.elapsed*a*2)*o*.2*this.amplitude,qt.z=i.z+Math.sin(this.elapsed*a*1.5)*o*.3*this.amplitude,qt.normalize(),Gt.compose(Wt,qt,n),this.cases.setMatrixAt(l,Gt),this.strokes.setPoints(l,y1.copy(r.position),Wt)}),this.cases.instanceMatrix.needsUpdate=!0}dispose(){const{temple_diffuse:t,temple_normal:s,temple_metalness:i,temple_roughness:n,temple_emissive:o,temple_emissive_lights:a}=this.webgl.$assets.textures;[t,s,i,n,o,a].forEach(r=>r==null?void 0:r.dispose()),this.temple.geometry.dispose(),this.temple.material.dispose(),this.cases.dispose(),this.cases.geometry.dispose(),this.cases.material.dispose(),this.strokes.dispose(),this.strokes.geometry.dispose(),this.strokes.material.dispose()}get visible(){return this.base.visible}set visible(t){this.base.visible=t}}function w1(e){e.reset=function(){J.Body.reset(this)}}function S1(e){["position","velocity","angularVelocity","angle"].forEach(s=>{Object.defineProperty(e,"initial"+uc(s),{value:JSON.parse(JSON.stringify(e[s])),writable:!1})})}let $1=0;class M1{constructor({x:t,y:s,z:i=0,width:n,height:o=n,label:a="body",shape:r="rectangle",enabled:l=!0,type:c=null}){this.webgl=St();const{$physics:u}=this.webgl,{engine:h,world:d,detector:f}=u;this.uuid=$1++,this.engine=h,this.world=d,this.detector=f,this.isMounted=!1,this.isCollided=!1,this.type=c,this.indexRef=null,this._isEnabled=l,this.size={width:n,height:o},r==="rectangle"?this.base=J.Bodies.rectangle(t,s,n,o,{label:a,isStatic:(a=="zeppelin",!0)}):this.base=J.Bodies.circle(t,s,n,{label:a,isStatic:(a=="zeppelin",!0)}),this.base.collide=this.collide.bind(this),this.base.size=this.size,this._collisionCallbacks=[],this.base.position.z=i,Object.defineProperty(this.base,"_instance",{value:this,writable:!1}),w1(this.base),S1(this.base),this.enabled=l}setType(t){this.type=t}setIndexReference(t){this.indexRef=t}addToWorld(){const{addToWorld:t}=this.webgl.$physics;this.base.label=="zeppelin"&&(this.webgl.$physics.zep=this.base),t(this.base),this.detector.add(this.base)}removeFromWorld(){const{removeFromWorld:t}=this.webgl.$physics;t(this.base),this.detector.remove(this.base)}reset(){this.base.reset(),this.detector.remove(this.base),this.detector.add(this.base),this.enabled=!0}destroy(){this.removeFromWorld()}onCollide(t=()=>{}){this._collisionCallbacks.push(t)}collide(t){this._collisionCallbacks.forEach(s=>s(t))}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.base.collisionFilter.category=t?1:65536,t?this.addToWorld():this.removeFromWorld()}}const C1=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float lightIntensity;
uniform float fresnelIntensity;
uniform vec2 res;
uniform sampler2D tFakeLights;
uniform sampler2D tDepth;
#ifdef IOR
uniform float ior;
#endif
#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif
#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;
#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <lighten>
#include <saturate>
float calc_depth(float z, float near, float far) {
return (2.0 * near) / (far + near - z * (far - near));
}
float fresnelFunc(vec3 viewDirection, vec3 worldNormal, float bias, float scale, float power) {
    return bias + scale * pow( 1.0 - dot( viewDirection, worldNormal), power );
}
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>
vec2 st = gl_FragCoord.xy / res.xy;
vec3 fakeLights = texture2D(tFakeLights, st).rgb * 1.;
float viewZ = calc_depth(gl_FragCoord.z, .08, 300.);
viewZ *= fresnelFunc(normalize(vViewPosition), normal, .12, 1., 2.);
viewZ = smoothstep(.01, .08, viewZ);
fakeLights *= viewZ;
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance + fakeLights;
float f = saturate(fresnelFunc(normalize(vViewPosition), normalize(normal), 0.15, 2., 6.));
outgoingLight += f * totalSpecular * 5. * fresnelIntensity;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
#endif
#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,k1=re(C1,"fragmentShader"),T1=`varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = - mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition = worldPosition.xyz;
#endif
}`,E1=re(T1,"vertexShader");class da extends Fs{constructor({uniforms:t={},defines:s={},...i}={}){super(i),this.uniforms={...t},this.defines||(this.defines={}),Object.assign(this.defines,{...s}),E1.use(this),k1.use(this),this.type="StandardMaterial"}get fresnelIntensity(){return this.uniforms.fresnelIntensity.value}set fresnelIntensity(t){this.uniforms.fresnelIntensity.value=t}}const P1=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif
#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;
#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <lighten>
#include <saturate>
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
vec3 vNorm = vNormal;
vNorm = normalize(vNorm);
vec3 norm = normalize(normal);
vec3 lightPosition = vec3(-.2, -.3, -1.7);
lightPosition = normalize(lightPosition);
float lightPower = .1;
float lighting = dot(norm, lightPosition);
lighting += dot(vNorm, lightPosition);
lighting = pow(lighting, lightPower);
float fresnelPower = .1;
float _fresnel = smoothstep(-.2, 1., lighting);
_fresnel = pow(_fresnel, fresnelPower);
_fresnel = 1. - smoothstep(.2, .65, _fresnel);
vec3 fresnel = (directLight.color + vec3(.4)) * _fresnel;
#include <aomap_fragment>
vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
#endif
#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,L1=re(P1,"fragmentShader"),A1=`varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = - mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition = worldPosition.xyz;
#endif
}`,O1=re(A1,"vertexShader");class R1 extends Fs{constructor({uniforms:t={},defines:s={},...i}={}){super(i),this.uniforms={...t},this.defines||(this.defines={}),Object.assign(this.defines,{...s}),O1.use(this),L1.use(this),this.type="StandardMaterial"}}const D1=()=>{const{$assets:e,$game:t}=_,s={sea_of_clouds:.75,frozen_lake:.6,starry_night:.6},{"zeppelin-diffuse":i,"zeppelin-normal":n,"zeppelin-roughness":o,"zeppelin-metalness":a}=e.textures,r={fog:!0,envMap:t.envMap,map:i,normalMap:n,roughnessMap:o,metalnessMap:a},l={..._.uniforms,...Us.standard.uniforms,...Le.fog,fresnelIntensity:{value:1},diffuse:{value:new V(16777215),debug:!0},lightIntensity:{value:1,debug:!0},tFakeLights:_.$game.fireworksTexture,tDepth:_.$game.depthPrepass,res:_.$renderer.drawingBufferSize},c={..._.defines};r.uniforms=l,r.defines=c;const u=new da({name:"BalloonMaterial",normalScale:{x:3,y:3},...r}),h=new R1({name:"RingMaterial",metalness:1,emissive:7105111,roughness:0,...r}),d=new da({name:"TempleMaterial",...r});return{materials:{Ballon:u,Ring:h,Temple:d},updateUniformsByScene:m=>{m=m.name??m,s[m]&&(l.lightIntensity.value=s[m])},devtools:()=>{}}},ha=new k;function pi(e){return Array.isArray(e)?_.rng.randomFloat(e[0],e[1]):e}function _o(e,t,s){const i=ha.subVectors(e,t),n=ha.length();e.addScaledVector(i.normalize(),s-n)}const mi=new k,ws=new k;class fa{constructor(t,s,{stiffness:i=.5,restLength:n=.2,damping:o=.1,mass:a=1,locked:r,type:l="vec3"}={}){this.targetPosition=t,this.VectorClass=l==="vec3"?k:X,this.currentPosition=s,this.velocity=new this.VectorClass,this.delta=new this.VectorClass,this.locked=r,this.dir=new this.VectorClass,this.setStiffness(i),this.setRestLength(n),this.setDamping(o),this.setMass(a)}solve(t){const{velocity:s,targetPosition:i,currentPosition:n}=this;ws.subVectors(i,n);const o=ws.length()-this.restLength;this.dir.copy(ws).normalize(),ws.setLength(o*this.invMass*this.stiffness),s.addScaledVector(ws,1),n.addScaledVector(s,t),s.multiplyScalar(this.damping)}reset(){const t=this.targetPosition,s=this.currentPosition;this.velocity.multiplyScalar(0),mi.copy(s).sub(t),mi.setLength(this.restLength),s.copy(t).add(mi)}setStiffness(t){this.stiffness=t}setRestLength(t){this.restLength=t}setDamping(t){this.damping=t}setMass(t){this.mass=t,this.invMass=1/this.mass}}const I1=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
varying float vProgress;
uniform float progress;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
if ( mod( vLineDistance, totalSize ) > dashSize ) {
discard;
}
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, opacity );
float visualProgress = smoothstep(progress + 0.001, progress, vProgress);
if (visualProgress <= 0.0001) discard;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
outgoingLight = diffuseColor.rgb;
#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
}`,z1=re(I1,"fragmentShader"),F1=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
varying float vProgress;
attribute float aProgress;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
vLineDistance = scale * lineDistance;
#include <uv_vertex>
vProgress = aProgress;
#include <color_vertex>
#include <morphcolor_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <fog_vertex>
}`,U1=re(F1,"vertexShader");class N1 extends dc{constructor({uniforms:s={},defines:i={},...n}={}){super(n);se(this,"name","WireMaterial");this.uniforms={...Le.common,...Le.fog,...Le.line,...s},this.defines||(this.defines={}),Object.assign(this.defines,i),this.type="LineMaterial",this.transparent=!0,z1.use(this),U1.use(this)}}const Pt=()=>{};class B1{constructor({manualUpdate:t=!1,selfDestruct:s=!0,onStart:i=Pt,onComplete:n=Pt,onUpdate:o=Pt}={}){this._tweenCache=new Map,this._updateTween=Ts(this._updateTween,this,1),this._resetTween=Ts(this._resetTween,this,1),this._destroyTween=Ts(this._destroyTween,this,1),this._manualUpdate=t,this._selfDestruct=s,this._destroyed=!1,this._started=!1,this._dt=0,this.onStart=i,this.onComplete=n,this.onUpdate=o,this._paused=!1,this.tweens=new Set,this.activeTweens=new Set,this.finished=Dt(),this.scheduleStart=hc(this.start,this),this.update=Ts(this.update,this,1)}from(t,s={}){return this.triggerTween(t,s,null)}fromTo(t,s={},i={}){return this.triggerTween(t,s,i)}to(t,s={}){return this.triggerTween(t,null,s)}triggerTween(t,s,i){const n=i||s,{duration:o=1e3,easing:a="inOutCubic",delay:r=0,onStart:l=Pt,onProgress:c=Pt,onComplete:u=Pt,manualUpdate:h,selfDestruct:d,...f}=n,b=n===i?s:f,p=n===i?f:i;this._tweenCache.has(t)||this._tweenCache.set(t,new Map);for(const m in f){const g=fc({target:t,property:m,from:s?b[m]:void 0,to:i?p[m]:t[m],delay:r,duration:o,easing:a,manualUpdate:!1,selfDestruct:this._selfDestruct,onStart:l,onProgress:c,onComplete:u}),y=this._tweenCache.get(t).get(m);y&&(this._completeTween(y),this._selfDestruct&&y.destroy()),this._tweenCache.get(t).set(m,g),this.tweens.add(g),this.activeTweens.add(g)}return this._started||this.scheduleStart(),this}start(){this._started||(this._started=!0,this.onStart(),this._manualUpdate||yt.add(this.update))}play(){this._paused=!1}pause(){this._paused=!0}update(t){this._paused||this._destroyed||(this._dt=t,this.tweens.forEach(this._updateTween),this.onUpdate())}onCompleted(){this.finished.resolve(),this.onComplete(),this._manualUpdate||yt.remove(this.update)}reset(){this._selfDestruct||this._destroyed||(this._started=!1,this.finished=Dt(),this.activeTweens.clear(),this._tweenCache.clear(),this.tweens.forEach(this._resetTween),this.scheduleStart())}destroy(){this._destroyed||(this._destroyed=!0,this.tweens.forEach(this._destroyTween),this.onStart=this.onComplete=Pt,this._tweenCache.clear(),this.activeTweens.clear(),this.tweens.clear())}_updateTween(t){t.update(this._dt),t.ended&&this._completeTween(t)}_completeTween(t){this._selfDestruct&&this.tweens.delete(t),this.activeTweens.delete(t);const s=t.target,i=this._tweenCache.get(s);i&&i.delete(t.property),i&&i.size===0&&this._tweenCache.delete(s),this.activeTweens.size===0&&this.onCompleted()}_resetTween(t){this.activeTweens.add(t),t.reset()}_destroyTween(t){t.destroy()}}const le=e=>new B1(e);class V1{constructor({position:t=new k,isCollected:s=!1}={}){this.webgl=St();const{$store:i}=this.webgl;this.base=new Oe,this.matrix=new Fe,this.position=new k().copy(t),this.scale=new k(1,1,1),this.scaleMult=1,this.quaternion=new Re,this.parent={matrixWorld:this.matrix.compose(this.position,this.quaternion,this.scale)},this.glow=new _t({batcher:"gem_normal",sprite:"base",billboard:!0,scale:.004,color:15709743,parent:this.parent}),this.glowLarge=new _t({batcher:"gem_emissive",sprite:"flash",billboard:!0,scale:.002,alpha:.4,color:15709743,parent:this.parent}),this.dense=new _t({batcher:"gem_normal",sprite:"flash",billboard:!0,scale:4e-4,alpha:.5,parent:this.parent}),this.elements=[this.glow,this.glowLarge,this.dense],this.isCollected=te(s),this.isCollected.watch(n=>{if(n){if(i.collectedGems.includes(this))return;i.collectedGems.push(this)}else{const o=i.collectedGems.indexOf(this);if(o===-1)return;i.collectedGems.splice(o,1)}}),this.reset()}collected(t=0){if(this.isCollected.value)return;const{$particles:s}=this.webgl;this.isCollected.set(!0),s.emit("sparkles",{batcher:"gem_emissive",sprite:"flash",scale:0,scaleTo:.006,alpha:.5,alphaTo:0,duration:.4,delay:t,parent:this.parent}),s.emit("sparkles",{batcher:"gem_emissive",sprite:"wave-glow",scale:0,scaleTo:.006,alpha:.15,alphaTo:0,duration:1,delay:t,parent:this.parent}),s.emit("sparkles",{batcher:"gem_emissive",sprite:"wave-glow",scale:0,scaleTo:.009,alpha:.11,alphaTo:0,duration:.9,delay:t+.2,parent:this.parent}),s.emit("sparkles",{amount:13,batcher:"gem_emissive",sprite:"sparkle_a",velocity:2,velocityRandom:.4,scale:0,scaleTo:.0035,alpha:.5,alphaTo:0,yAligned:!0,rotation:Math.PI/2,spread:Math.PI*2,duration:.9,durationRandom:.5,color:16770984,damping:.98,delay:t,parent:this.parent}),le().fromTo(this.glow.scale,{x:0,y:0,z:0},{x:.004,y:.004,z:.004,delay:t,ease:"expoOut",duration:350}),le().fromTo(this.glow,{alpha:0},{alpha:1,delay:t,ease:"expoOut",duration:350}),le().fromTo(this.glowLarge.scale,{x:0,y:0,z:0},{x:.0014,y:.0014,z:.0014,delay:t,ease:"expoOut",duration:350}),le().fromTo(this.glowLarge,{alpha:0},{alpha:.3,delay:t,ease:"expoOut",duration:350}),le().fromTo(this.dense.scale,{x:0,y:0,z:0},{x:4e-4,y:4e-4,z:4e-4,delay:t,ease:"expoOut",duration:350}),le().fromTo(this.dense,{alpha:0},{alpha:.5,delay:t,ease:"expoOut",duration:350})}release(t=0){this.isCollected.value&&(this.isCollected.set(!1),le().to(this.glow.scale,{x:0,y:0,z:0,delay:t,ease:"expoOut",duration:200}),le().to(this.glow,{alpha:0,delay:t,ease:"expoOut",duration:200}),le().to(this.glowLarge.scale,{x:0,y:0,z:0,delay:t,ease:"expoOut",duration:200}),le().to(this.glowLarge,{alpha:0,delay:t,ease:"expoOut",duration:200}),le().to(this.dense.scale,{x:0,y:0,z:0,delay:t,ease:"expoOut",duration:200}),le().to(this.dense,{alpha:0,delay:t,ease:"expoOut",duration:200}))}update(){this.matrix.compose(this.position,this.quaternion,this.scale);const{state:t}=this.webgl.$game,s=t.is("Game")||t.is("Score")||t.is("ScoreLastLevel")||t.is("Cinematic");for(let i=0;i<this.elements.length;i++){const n=this.elements[i],o=X.get().copy(n.initialScale).multiplyScalar(this.scaleMult);n.scale.lerp(o,1-this.scaleMult),n.alpha=s?1:0,o.release()}}attach(){this.parent={matrixWorld:this.matrix},this.elements.forEach(t=>{t.parent=this.parent,t.position.set(0,0,0),t.scale.copy(t.initialScale)})}detach(){this.parent=null,this.elements.forEach(t=>{t.parent=null,t.position.copy(this.position),t.scale.copy(t.initialScale).multiply(this.scale),t.quaternion.copy(this.quaternion)})}mount(){this.elements.forEach(t=>{t.addToBatcher()})}unMount(){this.elements.forEach(t=>{t.removeFromBatcher()})}reset(){this.isCollected.set(!1),this.elements.forEach(t=>{t.scale.setScalar(0),t.alpha=0}),this.scaleMult=1}destroy(){this.elements.forEach(t=>{t.destroy()})}}const Z1=[new k(0,0,0),new k(-.5,-.7,0),new k(-2,-.95,0),new k(-3,-2,0),new k(-4.5,-1.9,0)],en=new k,Ss=36,pa=W(ne.inCubic);W(ne.outSine);class j1 extends ke{init(){const{attachPoint:t=new k,collected:s=0,maxPoints:i=12}=this.props;this.transform=new Oe,this.transform.renderOrder=this.webgl.$store.z.player,this.maxPoints=i,this.position=new k,this.prevPos=new k,this.vel=new k,this.dir=new k,this.accVel=0,this.attachPoint=t,this.collected=s,this.position.copy(t),this.prevPos.copy(t),this.gems=[],this.anchorPoints=Z1.map(a=>a.clone()),this.curve=new To(this.anchorPoints,!1,"catmullrom",.6),this.curvePoints=[],this.points=[],this.startProgress=.05,this.endProgress=.65,this.uniformProgress={value:0},this.amount=0,this.curvePoints.push(this.attachPoint);const n=this.maxPoints+1;for(let a=0;a<n;a++){const r=a/(n-1),l=ye(r,0,1,this.startProgress,this.endProgress),c=this.curve.getPointAt(l),u=a===0?this.attachPoint:this.points[a-1].pos,h=a===0?0:c.distanceTo(u);let d=null;a<this.maxPoints&&(d=new V1(c));const f=c,b=c.clone(),p=c.clone();this.curvePoints.push(f),this.points.push({prevPoint:u,pos:f,basePos:p,anchor:b,isActive:!1,linearProgress:r,progress:l,vel:new k,len:h,isOverriding:!1,scoreAnimProgress:0,spring:new fa(u,f,{stiffness:30,damping:.3,restLength:h,type:"vec2"}),orb:d})}for(let a=this.points.length-2;a>0;a--){const r=this.points[a+1].pos,{pos:l}=this.points[a],c=l.distanceTo(r);Object.assign(this.points[a],{nextPoint:r,invspring:new fa(r,l,{stiffness:30,damping:.3,restLength:c,type:"vec2"})})}this.visualCurve=new To(this.curvePoints,!1,"catmullrom",.6),this.cachedPoints=this.visualCurve.getSpacedPoints(Ss-1),this.stroke=new pc(new cs().setFromPoints(this.cachedPoints),new N1({transparent:!0,color:7496281,uniforms:{progress:this.uniformProgress}})),this.stroke.frustumCulled=!1,this.stroke.renderOrder=this.webgl.$store.z.player;const o=[];for(let a=0;a<Ss;a++)o.push(a/(Ss-1));this.stroke.geometry.setAttribute("aProgress",new tt(new Float32Array(o),1)),this.transform.add(this.stroke),this.scene.addObject3D(this.transform),this.useFK=!1,this.webgl.$quality.current.watchImmediate(a=>{this.useFK=a<=3})}reset(){this.collected=0,this.webgl.$store.collectedGems.length=0,this.points.forEach(t=>{var s;(s=t.orb)==null||s.release(),t.isOverriding=!1,t.scoreAnimProgress=0,t.sync&&(t.sync.destroy(),delete t.sync)}),this.update(!0,!0)}mount(){this.reset(),this.points.forEach(t=>{var s;(s=t.orb)==null||s.mount()})}unMount(){this.points.forEach(t=>{var s;(s=t.orb)==null||s.unMount()})}softReset(){for(let t=0;t<this.points.length;t++){const{prevPoint:s,pos:i}=this.points[t];i.set(0,0,0),s.set(0,0,0)}}update(t,s){if(this.stroke.visible=this.collected>0,this.webgl.$game.isPaused()&&!t)return;const{$time:i}=this.webgl,n=i.stableDt*.001,o=i.elapsed*.001;this.position.copy(this.attachPoint),this.vel.subVectors(this.position,this.prevPos);const a=Math.hypot(this.vel.x,this.vel.y)/n,r=ye(a,4.8,9,1,0);this.accVel+=a*.001;for(let d=0;d<this.points.length;d++){const{anchor:f,basePos:b,sync:p,scoreAnimProgress:m,orb:g,pos:y,len:x,prevPoint:S,spring:C,isOverriding:w}=this.points[d],v=d/Math.max(4,this.collected),$=ye(v,0,.5,.9,0);f.add(this.vel),this.useFK?_o(y,S,x):C.solve(.016667),y.z=0,p&&w&&p.update(),en.copy(y),en.y+=d===0?0:Math.sin(o*-2-this.accVel+d*.3)*.012*r*(1-pa($)),en.lerp(f,pa($)),y.copy(en),b.copy(y),p&&b.lerp(p.position,m);const P=this.collected>=d+1;g&&(P?g.collected(.3):g.release(),g.position.copy(b),g.position.z+=.1,g.update())}this.updatePoints();for(let d=0;d<this.cachedPoints.length;d++){const f=this.cachedPoints[d];this.stroke.geometry.attributes.position.setXYZ(d,f.x,f.y,f.z)}this.stroke.geometry.attributes.position.needsUpdate=!0,this.prevPos.copy(this.position);const l=1/(this.maxPoints-1),c=this.collected/(this.maxPoints-1),u=ye(c,0,this.startProgress,0,l)+ye(this.collected,this.maxPoints-1,this.maxPoints,0,l),h=ye(c,this.startProgress,1,0,1-l*2)+u;this.uniformProgress.value=to(this.uniformProgress.value,h,s?1e4:100,n)}updatePoints(){for(let t=0;t<Ss;t++){const s=this.cachedPoints[t];this.visualCurve.getPointAt(t/Ss,s)}}}let gi=null,vi=0,_i=0;const yi=new k(-1,0,0);new X;const bi=new k,tn=new k,xi=J.Vector.create(),ma=()=>{},wi=new Oe;class H1 extends ke{constructor(s={}){super(s);se(this,"type",gt.Player);this.base=new Oe,this.base.frustumCulled=!1,this.base.renderOrder=_.$store.z.player,this.body=null,this.mesh=null,this.currentScene=null,this.world=this.webgl.$physics.world,this.isAttached=!1}static async load(){const{load:s}=_.$assets;await Promise.all([s("zeppelin-model"),s("zeppelin-diffuse",{data:!0,srgb:!0}),s("zeppelin-roughness",{data:!0}),s("zeppelin-metalness",{data:!0}),s("zeppelin-normal",{data:!0,flipY:!1})])}createMesh(){const{$assets:s,$store:i}=this.webgl,n=new Oe;gi||(gi=D1());const{materials:o}=gi;return this.materials=o,this.ropesData=[],this.ropes=new al({thickness:.003,color:8944497,aoColor:7496281},6),this.ropes.frustumCulled=!1,this.ropes.layers.enable(i.layers.PLAYER),this.ropes.renderOrder=i.z.player,s.objects["zeppelin-model"].scene.traverse(a=>{if(a.name==="AirBalloon"){const r=a.clone();n.add(r)}}),n.add(this.ropes),n.traverse(a=>{if(a.isLineSegments&&a.name.includes("Rope")){const{position:r}=a.geometry.attributes,l=bi.fromBufferAttribute(r,0).clone(),c=tn.fromBufferAttribute(r,1).clone(),u=l.y>c.y?l:c,h=l.y>c.y?c:l;u.add(a.position),h.add(a.position),this.ropesData.push({start:u,end:h,el:a})}if(a.isMesh)switch(a.frustumCulled=!1,a.material.dispose(),a.layers.enable(i.layers.PLAYER),a.name){case"Ring":a.material=o.Ring,this.ring=a;break;case"Ballon":a.material=o.Ballon,this.balloon=a;break;case"Temple":a.material=o.Temple,this.temple=a,this.templePosition=a.position.clone();break;case"Fin":a.material=o.Ballon,this.fin=a;break}}),this.finProgress=0,this.ropesData.forEach(({el:a})=>a.removeFromParent()),n.visible=!0,n}createBody(s){const{size:i,pos:n={}}=s??{},o=new M1({x:n.x??0,y:n.y??0,width:i??.8,height:i??.8,shape:"circle",label:"zeppelin",type:gt.Player});let a=J.Bodies.rectangle(0,0,40,40,{mass:10,isSensor:!0,collisionFilter:{group:-1}});return this.b2=a,this.contraint=J.Constraint.create({bodyB:a,pointA:{x:-100,y:0},pointB:{x:-18,y:18},stiffness:.004,damping:.04}),this.contraint2=J.Constraint.create({bodyB:a,pointA:{x:100,y:0},pointB:{x:18,y:18},stiffness:.004,damping:.04}),Object.defineProperty(o.base,"isZeppelin",{value:!0,writable:!1}),o}init(){const{$app:s,$renderer:i,$store:n}=this.webgl;i.drawingBufferSize,this.isZeppelin=!0,this.pos=new k,this.mesh=this.createMesh(),this.attachPoint=new k,this.offsetAttachPoint=new k(0,-.25,0),this.speedLineTimer=10,this.zeppelinSmokeTimer=30,this.speedLineSpawn=new k,this.offsetspeedLineSpawn=new k(1,0,0),this.smokeSpawn=new k,this.offsetSmokeSpawn=new k(-1,0,0),this.vel=new k,this.wire=this.add(j1,{attachPoint:this.attachPoint}),this.wire.static=!0,this.wire.transform.layers.enable(n.layers.PLAYER),this.body=this.createBody(),this.base.add(this.mesh),wi.position.copy(this.offsetAttachPoint),this.temple.add(wi),pe(()=>s.$store.currentScore,o=>{this.wire.collected=o})}afterInit(){}onMounted(){const{addToWorld:s}=this.webgl.$physics;s(this.b2),s(this.contraint),s(this.contraint2),this.wire.mount(),this.body.enabled=!0,this.isAttached=!0}onUnMounted(){const{removeFromWorld:s}=this.webgl.$physics;s(this.contraint),s(this.contraint2),s(this.b2),this.body.enabled=!1,this.wire.unMount(),this.isAttached=!1}attach(s){s.add(this),this.currentScene=s}detach(){this.currentScene=null}set({size:s,position:i}){this.base.scale.setScalar(s),this.base.position.set(i.x,i.y,0),this.body.destroy(),this.body=this.createBody({size:s,pos:i})}async triggerScoreResult(s){if(!s.length)return;const{points:i,transform:n}=this.wire;n.visible=!1;for(let o=0;o<i.length;o++){const a=i[o];if(!a.orb||!a.orb.isCollected.value)return;a.isOverriding=!0;const r=s[o];if(!r)return;a.sync=hl(r.value),le({onComplete:r.onComplete??ma}).to(a,{scoreAnimProgress:1,easing:ne.longKeyframe,duration:1500,delay:150+o*50,onStart:r.onStart??ma})}}reset(){xi.x=this.base.position.x,xi.y=this.base.position.y,J.Body.setPosition(this.body.base,xi),this.temple.rotation.x=this.temple.rotation.z=0,this.balloon.rotation.z=0,this.b2.velocity.x=this.b2.velocity.y=0,this.wire.reset(),this.update()}setPosition(s=0,i=0,n=0){this.pos.set(s,i,n),this.base.position.set(s,i,n)}addPosition(s=0,i=0,n=0){this.pos.x+=s,this.pos.y+=i,this.pos.z+=n}update(){const{$viewport:s,$time:i,$game:n,$particles:o}=this.webgl,{dt:a,stableEt:r}=i;if(n.isPaused()||(this.contraint.pointA.x=-100+this.pos.x*5,this.contraint.pointA.y=this.pos.y*20,this.contraint2.pointA.x=100+this.pos.x*5,this.contraint2.pointA.y=this.pos.y*20,!this.temple))return;const l=this.b2.velocity.x,c=this.b2.velocity.y,u=this.b2.angle,h=Math.sin(r*.002)*.06;this.temple.rotation.z=u*2+c*.2+h*(.2-c),this.temple.position.x=this.templePosition.x+-l+Ce(.02,.1,l)*-.1+c*.2,this.temple.position.y=this.templePosition.y+-c*.2+Ce(.01,.2,l)*.1+h*(.2-c),wi.getWorldPosition(this.attachPoint),this.finProgress+=a*.001,this.fin.rotation.y=Math.sin(this.b2.velocity.y*Math.PI*2+this.finProgress)*Math.PI*.1,this.balloon.rotation.z=this.b2.velocity.y*Math.PI*.1,this.ropesData.forEach(({start:d,end:f,el:b},p)=>{const m=bi.copy(d),g=tn.copy(f);m.applyMatrix4(this.balloon.matrix),g.sub(this.templePosition),g.applyMatrix4(this.temple.matrix),this.ropes.setPoints(p,m,g)})}updateSmoke(){const{$particles:s,$game:i}=this.webgl,n=Ce(0,i.elevationForce.value,i.vel.y),o=ji(i.vel.x-i.speed.value,0,.1)*n;if(this.zeppelinSmokeTimer=fe(100,30,o*100),_i>0){_i-=this.webgl.$time.stableDt;return}const a=k.get();_i=this.zeppelinSmokeTimer,this.smokeSpawn.copy(this.offsetSmokeSpawn).applyMatrix4(this.balloon.matrixWorld),this.smokeSpawn.x+=i.vel.x,this.smokeSpawn.y+=i.vel.y,s.emit("sparkles",{batcher:"smoke",sprite:"smoke",frame:Math.floor(Math.random()*4)+3,position:this.smokeSpawn,duration:3,durationRandom:.2,velocity:-2-o*4,direction:yi,spread:Math.PI*.2,fx:1,damping:.98,scale:.01,scaleTo:.02,scaleRandom:.5,angVelocity:.1,alpha:0,alphaTo:Ce(0,.05,n*10)*.5,alphaInOut:!0}),a.release()}updateSpeedLines(){const s=this.webgl.$time.stableDt,{$particles:i,$game:n,$store:o}=this.webgl,a=ji(n.vel.x-n.speed.value,0,.1);if(this.speedLineTimer=fe(1e3,800,a),(vi>0||a<.2)&&!o.boosting){vi-=s;return}if(Math.random()>.2)return;vi=this.speedLineTimer,this.offsetspeedLineSpawn.x=fe(1.3,1.5,a),this.speedLineSpawn.copy(this.offsetspeedLineSpawn).applyMatrix4(this.balloon.matrix),this.speedLineSpawn.y+=this.b2.velocity.y*s*.03;const r=tn.copy(yi).applyMatrix4(this.balloon.matrix).normalize(),l=fe(Math.PI*.7,Math.PI*.5,a);i.emit("speedline",{batcher:"trail",sprite:"wind",position:this.speedLineSpawn,thickness:.2,trailDamping:14,amount:1,velocity:Math.max(3.5,n.vel.x*60),direction:r,duration:.8,durationRandom:.2,damping:1,spread:l,scale:0,scaleTo:.003,parent:this.balloon,onProgress:c=>{const u=Ce(.2,.4,c.progress)-Ce(.7,.95,c.progress);c.alpha=u*(this.parent.name==="starry_night"?.5:.9),c.thickness=fe(0,.5,Ce(0,.5,c.progress)-Ce(.6,1,c.progress));const h=bi.copy(c.velocity).normalize().sub(tn.copy(yi).applyQuaternion(this.balloon.quaternion)),d=fe(.06,.6,Ce(.3,.4,c.progress));c.velocity.addScaledVector(h,-d)}})}beforeDestroy(){this.body.destroy()}dispose(){const{"zeppelin-diffuse":s,"zeppelin-roughness":i,"zeppelin-metalness":n,"zeppelin-normal":o}=this.webgl.$assets.textures;[s,i,n,o].forEach(a=>a==null?void 0:a.dispose()),this.ropes.dispose(),this.ropes.geometry.dispose(),this.ropes.material.dispose(),this.ring.geometry.dispose(),this.ring.material.dispose(),this.balloon.geometry.dispose(),this.balloon.material.dispose(),this.temple.geometry.dispose(),this.temple.material.dispose(),this.fin.geometry.dispose(),this.fin.material.dispose()}}function G1(){const e=window.innerWidth/window.innerHeight;return new Dn(39,e,.1,100)}class rl extends ke{constructor(t={}){super(t),this.isCamera=!0,this.isUsed=!1}afterInit(){this.cam&&!this.base?this.base=this.cam:this.cam||(this.cam=G1()),this.base||(this.base=this.cam);const t=this.webgl.$renderer.drawingBufferSize;this.resizeSignal=t.watchImmediate(this.resize,this)}used(){}unused(){}resize(t){this.cam.aspect=t.x/t.y,this.cam.updateProjectionMatrix()}destroy(){mc(this.resizeSignal),super.destroy()}}class W1 extends rl{init(){this.name="TransitionCamera",this.base=this.cam=new Dn(37,1,.1,100),this.base.position.z=10,this.base.position.y=0,this._shakeAmount=0,this.position=this.base.position,this.currentLookAt=new k,this.base.lookAt(this.currentLookAt)}update(){}}const q1=`precision highp float;
uniform vec4 res;
uniform sampler2D tBlueNoise;
uniform sampler2D tNoise;
uniform float uTransition;
uniform float uTransitionProgress;
uniform float uTransitionSimpleProgress;
uniform float uTranstion;
uniform float time;
uniform float uAdditive;
uniform vec3 colorSimple;
uniform vec3 colorInLight;
uniform vec3 colorInDark;
uniform vec3 colorOutLight;
uniform vec3 colorOutDark;
void main() {
vec2 uv= gl_FragCoord.xy / res.xy / 2.;
float transitionProgress = uTransitionProgress;
float offset = transitionProgress ;
float width = mix(.7, .55, uAdditive);
float progress= ((1.)- offset*(1.+width + mix(0., .0, uAdditive)));
vec4 noisePerlin = texture2D(tBlueNoise, uv/3. + vec2(time/10. , -time/50. ) );
vec4 noise = texture2D(tNoise, uv/8. + vec2(time/6. , time/40. )+ noisePerlin.r*0.005);
vec4 noise2 = texture2D(tNoise, uv/10.8 + vec2(time/12., -time/50. )+ noisePerlin.g*0.01);
vec4 noise3 = texture2D(tNoise, uv/6.8 + vec2(time/8. , -time/80. )+ noisePerlin.g*0.01);
vec4 noisePerlinAlpha = texture2D(tBlueNoise, uv/3. + vec2(transitionProgress/8. - time/30. , -time/50. ) );
vec4 noiseAlpha = texture2D(tNoise, uv/12. + vec2( transitionProgress/8., -time/20.) + noisePerlinAlpha.r * 0.012);
vec4 noiseAlpha2 = texture2D(tNoise, uv/15.8 + vec2( transitionProgress/15.8, time/10.) + noisePerlinAlpha.r * 0.01);
vec4 noiseAlpha3 = texture2D(tNoise, uv/10.8 + vec2(transitionProgress/10.8, -time/20.) + noisePerlinAlpha.r * 0.005);
float mask = smoothstep(progress, progress+width, uv.x);
mask = mix(smoothstep(.43, .6, noise.r), 1., mask) *mask;
vec3 col = mix(
mix(colorInLight*1., colorInDark,  1.-(noise.g + noise2.b + noise3.g + noisePerlin.g)/4.),
mix(colorOutLight, colorOutDark, 1.-(noise2.g + noise.b + noise3.g + noisePerlin.r)/4.),
smoothstep(.0, 1.5,(uv.x *(noise2.r+ noisePerlin.g + noise2.g)/3.) + transitionProgress -1.5)
);
gl_FragColor = vec4(
col,
1.);
width= 1.;
float noiseWidth = 1.;
offset = (1.+width + noiseWidth) - (transitionProgress * (1.+width + noiseWidth)) ;
float prog = offset ;
prog-= (
+(1.-noiseAlpha3.r)
+(1.-noiseAlpha2.b)
+(1.-noiseAlpha.r)
+(1.-noiseAlpha3.g))/4.
* noiseWidth;
mask = smoothstep(prog - width, prog   ,uv.x );
width= 1.;
noiseWidth =1.;
float offsetOut = (1. + width + noiseWidth) - (( 1.-smoothstep(2.5, 4., transitionProgress)) * (1. +width + noiseWidth));
float progOut = (offsetOut - (width + noiseWidth)) +(noiseAlpha2.r + noiseAlpha2.g + noiseAlpha.r + noiseAlpha.b + noiseAlpha3.r)/5. * noiseWidth;
float maskOut = smoothstep(progOut, progOut + width ,1.- uv.x );
gl_FragColor.w = smoothstep(.0, 1., maskOut) * mask * .994 ;
gl_FragColor.xyz = mix(gl_FragColor.xyz, colorSimple,uTransition);
gl_FragColor.a = mix(gl_FragColor.a, uTransitionSimpleProgress,uTransition);
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,Y1=re(q1,"fragmentShader"),K1=`varying vec2 vUv;
void main() {
vUv = position.xy * 0.5 + 0.5;
gl_Position =  vec4(position.xy, 0., 1);
}`,X1=re(K1,"vertexShader"),sn={sea_of_clouds:{light:new V(16439996).convertLinearToSRGB(),dark:new V(13672078).convertLinearToSRGB()},frozen_lake:{light:new V(12380925).convertLinearToSRGB(),dark:new V(10535665).convertLinearToSRGB()},starry_night:{light:new V(4878509).convertLinearToSRGB(),dark:new V(5995438).convertLinearToSRGB()}};class Q1 extends us{constructor({additive:s=!1}={}){super();se(this,"name","TransitionBackgroundMaterial");const{$assets:i}=_;this.uniforms={res:_.uniforms.resolution,tBlueNoise:{value:i.textures.perlinNoise},tNoise:{value:i.textures.worleyNoise},uTransitionProgress:{value:0},uTransitionSimpleProgress:{value:0},uTransition:{value:0},colorSimple:{value:new V},colorInLight:{value:sn.sea_of_clouds.light},colorInDark:{value:sn.sea_of_clouds.dark},colorOutLight:{value:sn.frozen_lake.light},colorOutDark:{value:sn.frozen_lake.dark},time:{value:_.$time.elapsed},uAdditive:{value:s?1:0}},s&&(this.blending=Ns),Y1.use(this),X1.use(this)}}class J1 extends ke{init(){const t=new Q1({additive:this.props.additive});t.transparent=!0,this.base=new In(po,t),this.base.frustumCulled=!1,this.base.renderOrder=this.props.renderOrder??1,this.base.matrixAutoUpdate=!1,this.props.additive&&(this.base.visible=!1)}}function $s(e,t){!e||e.isUsed==t||(e.isUsed=!!t,e.isUsed?e.used():e.unused())}class eg extends ke{constructor(t={}){t.autoAttach=!!(t.autoAttach??!0),super(t,!0),this.isScene=!0,this._cam={current:!1,forced:!1},this.props||(this.props=t)}triggerInit(){this.isInit||(this.base=new gr,super.triggerInit(),this.camera||(this.camera=this.add(rl)),this.props.autoAttach&&this.attach())}attach(){ke.triggerAttached(this,this)}detach(){ke.triggerDetached(this,this)}update(){}init(){}get camera(){return this._cam.current}set camera(t){(!t||!t.isCamera)&&(t=!1);const s=this._cam;s.current!==t&&($s(s.current,!1),s.current=t,s.forced||$s(s.current,!1))}get overrideCamera(){return this._cam.forced}set overrideCamera(t){(!t||!t.isCamera)&&(t=!1);const s=this._cam;s.forced!==t&&($s(s.forced,!1),$s(s.current,!1),s.forced=t,$s(s.forced,!0))}getCurrentCamera(){return this._cam.forced||this._cam.current}compile(){this._isCompiled||(this._isCompiled=!0,this.webgl.threeRenderer.compile(this.base,this.getCurrentCamera().base))}render(){const t=this.webgl.threeRenderer,s=this.getCurrentCamera();s&&t.render(this.base,s.cam)}triggerRender(){this.beforeRender&&this.beforeRender(),this.render(),this.afterRender&&this.afterRender()}destroy(){this.detach(),super.destroy()}}const me={white:new V(16777215),black:new V(0),base:{light:new V(16777215),dark:new V(16777215)},"Sea of Clouds":{light:new V(7033178).convertLinearToSRGB(),dark:new V(7031642).convertLinearToSRGB()},"Frozen Lake":{light:new V(4479876).convertLinearToSRGB(),dark:new V(5995438).convertLinearToSRGB()},"Starry Night":{light:new V(4878509).convertLinearToSRGB(),dark:new V(5995438).convertLinearToSRGB()},Register:{light:new V(12380925).convertLinearToSRGB(),dark:new V(10535665).convertLinearToSRGB()}},nn=W(ne.linear);class tg extends eg{static async load(){}get mixins(){return["debugCamera"]}init(){this.camera=this.add(W1),this.background=this.add(J1),this.outOver=te(!1),this.inOver=te(!1),this.outSimpleOver=te(!1),this.inSimpleOver=te(!1),this.time=0,this.timeOut=0,this.timeSimple=0}async open(){}triggerRender(t){this.webgl.$store.isTransitioning&&(this.webgl.threeRenderer.clearDepth(),super.triggerRender())}async inSimple(t="white",s=.4){me[t]||(t="white"),this.simpleDuration=s,this.reset(),this.background.base.material.uniforms.uTransition.value=1,this.background.base.material.uniforms.colorSimple.value=me[t],this.inSimpleRunning=!0,this.webgl.$quality.pause(),await new Promise(i=>this.inSimpleOver.watch(n=>{n&&(i(),this.inSimpleOver.unwatchAll(),this.webgl.$quality.resume())}))}async outSimple(t="white",s=.4){me[t]||(t="white"),this.simpleDuration=s,this.reset(),this.background.base.material.uniforms.uTransition.value=1,this.background.base.material.uniforms.colorSimple.value=me[t],this.outSimpleRunning=!0,this.webgl.$quality.pause(),await new Promise(i=>this.outSimpleOver.watch(n=>{n&&(i(),this.outSimpleOver.unwatchAll(),this.webgl.$quality.resume())}))}reset(){this.time=0,this.timeOut=0,this.timeSimple=0,this.inOver.unwatchAll(),this.outOver.unwatchAll(),this.inSimpleOver.unwatchAll(),this.outSimpleOver.unwatchAll(),this.inOver.set(!1),this.outOver.set(!1),this.inSimpleOver.set(!1),this.outSimpleOver.set(!1),this.outRunning=!1,this.inRunning=!1,this.inSimpleRunning=!1,this.outSimpleRunning=!1,this.background.base.material.uniforms.uTransition.value=0,this.background.base.material.uniforms.uTransitionProgress.value=0,this.background.base.material.uniforms.uTransitionSimpleProgress.value=0}async in(t="sea_of_clouds",s="frozen_lake"){const i=this.background.base.material.uniforms;i.colorInLight.value=me[me[t]?t:"base"].light,i.colorInDark.value=me[me[t]?t:"base"].dark,i.colorOutLight.value=me[me[s]?s:"base"].light,i.colorOutDark.value=me[me[s]?s:"base"].dark,this.reset(),this.inRunning=!0,this.webgl.$quality.pause(),await new Promise(n=>this.inOver.watch(o=>{o&&(n(),this.inOver.unwatchAll(),this.webgl.$quality.resume())}))}async out(t="sea_of_clouds",s="frozen_lake"){const i=this.background.base.material.uniforms;i.colorInLight.value=me[me[t]?t:"base"].light,i.colorInDark.value=me[me[t]?t:"base"].dark,i.colorOutLight.value=me[me[s]?s:"base"].light,i.colorOutDark.value=me[me[s]?s:"base"].dark,this.reset(),this.time=1,await Q(1e3),this.outRunning=!0,this.webgl.$quality.pause(),await new Promise(n=>this.outOver.watch(o=>{o&&(n(),this.outOver.unwatchAll(),this.webgl.$quality.resume())}))}update(){this.inRunning&&(this.time+=this.webgl.$time.stableDt/1e3/2.5),this.time=be(this.time,0,1),this.outRunning&&(this.timeOut+=this.webgl.$time.stableDt/1e3/1.5),this.timeOut=be(this.timeOut,0,1),(this.inSimpleRunning||this.outSimpleRunning)&&(this.timeSimple+=this.webgl.$time.stableDt/(1e3*this.simpleDuration)),this.timeSimple=be(this.timeSimple,0,1);const t=nn(this.timeSimple),s=1-nn(this.timeSimple),i=nn(this.time),n=nn(this.timeOut);this.webgl.$store.isTransitioning=i-n>0||t-n>0,this.background.base.material.uniforms.uTransitionProgress.value=i*2.5+n*1.5,this.background.base.material.uniforms.time.value+=this.webgl.$time.stableDt/1e3,this.background.base.material.uniforms.uTransitionSimpleProgress.value=this.inSimpleRunning?t:s,n&&this.outOver.set(!0),i===1&&this.inOver.set(!0),t===1&&this.inSimpleOver.set(!0),s===0&&this.outSimpleOver.set(!0)}}const sg=`precision highp float;
attribute vec4 texCoords;
attribute vec4 meshCoords;
attribute vec3 spritePos;
attribute vec4 spriteQt;
attribute vec4 spriteColor;
attribute vec2 decorators;
uniform vec3 lightPosition;
varying vec2 vUv;
varying vec4 vColor;
varying vec3 vWorldPosition;
varying vec3 vNormal;
varying float vLightDistance;
varying vec2 vDecorators;
#include <fog_pars_vertex>
#include <get_instance_matrix>
#include <envmap_pars_vertex>
void main() {
vec4 zero = vec4(0., 0., 0., 1.);
vColor = spriteColor;
vUv = uv * texCoords.zw + texCoords.xy;
vec3 transformed = position;
transformed.xy = transformed.xy * meshCoords.zw + (meshCoords.xy * 0.5);
transformed.xy += meshCoords.xy * 0.5;
mat4 instanceMatrix = getInstanceMatrix(spritePos, spriteQt, vec3(1.) );
vec4 mvPosition = modelViewMatrix * instanceMatrix * vec4(transformed, 1.);
vec4 bbPosition = modelViewMatrix * instanceMatrix * zero;
bbPosition.x += cos(spriteQt.x) * transformed.x - sin(spriteQt.x) * transformed.y;
bbPosition.y += sin(spriteQt.x) * transformed.x + cos(spriteQt.x) * transformed.y;
mvPosition = bbPosition;
vWorldPosition = (mvPosition).xyz;
vDecorators = decorators;
vLightDistance = distance(lightPosition, bbPosition.xyz - (modelViewMatrix * zero).xyz);
gl_Position = projectionMatrix * mvPosition;
#include <fog_vertex>
vNormal = vec3(0, 0, 1);
}`,ng=re(sg,"vertexShader"),ig=`precision highp float;
uniform sampler2D atlas;
uniform sampler2D tDepth;
uniform sampler2D tPlayer;
uniform vec3 lightColor;
uniform vec3 color;
varying vec2 vUv;
varying vec4 vColor;
varying vec3 vWorldPosition;
varying vec3 vNormal;
varying float vLightDistance;
varying vec2 vDecorators;
uniform vec2 res;
uniform float zNear;
uniform float zFar;
uniform float depthTransition;
uniform float density;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <fog_pars_fragment>
#include <luma>
#ifdef USE_ENVMAP
uniform samplerCube envMap;
uniform float envMapIntensity;
uniform float reflectivity;
#endif
const vec3 fogCol = vec3(0.9, 1.0, 1.0);
float getDistanceAttenuation( const in float lightDistance, const in float decayExponent ) {
float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
return distanceFalloff;
}
float cubicIn(float t) {
  return t * t * t;
}
float calc_depth(float z) {
float near = zNear;
float far = zFar;
return (2.0 * near) / (far + near - z * (far - near));
}
vec3 computeEnvMap(vec3 _d, float _envmapFactor) {
vec3 diffuseColor = _d;
#ifdef USE_ENVMAP
vec3 cameraToFrag = normalize(vWorldPosition - cameraPosition);
vec3 worldNormal = inverseTransformDirection( vNormal, viewMatrix );
vec3 reflectVec = reflect( cameraToFrag, worldNormal );
vec4 envColor = textureCube( envMap, vec3( -1. * reflectVec.x, reflectVec.yz ) );
diffuseColor.rgb = mix( diffuseColor.rgb, diffuseColor.rgb + envColor.rgb * envMapIntensity, reflectivity * _envmapFactor );
#endif
return diffuseColor;
}
void main() {
vec2 uv = vUv;
vec4 diffuseColor = texture2D(atlas, uv);
vec2 st = (gl_FragCoord.xy / res);
vec4 depth = texture2D(tDepth, st);
vec4 playerLayer = texture2D(tPlayer, st);
float geometryZ = calc_depth(unpackRGBAToDepth(depth));
float sceneZ = calc_depth(gl_FragCoord.z);
float softAlpha = smoothstep(0., depthTransition, saturate(geometryZ - sceneZ)) + 1.1 - depth.a - playerLayer.a * .1;
float alpha = diffuseColor.a * vColor.a * softAlpha;
alpha = saturate(alpha * alpha * alpha);
vec3 col = color.rgb;
col = computeEnvMap(col, 1.2);
col = col + lightColor * getDistanceAttenuation(vLightDistance, .3);
gl_FragColor = vec4(mix(col, vColor.rgb, vDecorators.y), alpha );
if (gl_FragColor.a <= 0.0001) discard;
vec3 normal = vec3(0., .1, 0.);
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,og=re(ig,"fragmentShader");class ag extends us{constructor({count:s,atlas:i,renderOrder:n,useAlphaSDF:o,blending:a,uniforms:r={},defines:l={},...c}){super(c);se(this,"name","SmokeSpriteMaterial");this.uniforms={...r,...Le.fog,atlas:{value:i.texture,type:"t"},res:_.$renderer.drawingBufferSize},this.defines={USE_ALPHA_SDF:!!o,...l},this.fog=!0,this.transparent=!0,r.envMap&&(this.defines.USE_ENVMAP=""),ng.use(this),og.use(this)}}const rg=`#include <common>
#include <logdepthbuf_pars_vertex>
attribute mat4 instanceMatrix;
attribute vec3 instanceColor;
attribute vec4 texCoords;
attribute vec4 meshCoords;
attribute vec2 uv;
attribute float side;
attribute float alpha;
attribute float indexes;
attribute float counters;
attribute float width;
attribute float thickness;
uniform vec2 res;
uniform vec2 texSize;
uniform float sizeAttenuation;
uniform sampler2D curve;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
varying vec2 vUv;
varying vec4 vColor;
varying float vCounters;
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
  vCounters = counters;
    return res;
  }
void main() {
    float aspect = res.x / res.y;
    vColor = vec4( instanceColor, alpha );
    vUv = uv.yx * texCoords.zw + texCoords.xy;
    float stp         = 1. / texSize.x;
float stpY        = 1. / texSize.y;
    float instanceIdx = indexes / (texSize.y - stpY);
    vec3 curvePos     = texture2D(curve, vec2(counters, instanceIdx)).xyz;
    vec3 prevCurvePos = texture2D(curve, vec2(max(0., counters - stp), instanceIdx)).xyz;
    vec3 nextCurvePos = texture2D(curve, vec2(min(1., counters + stp), instanceIdx)).xyz;
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 originPositon = m * vec4( vec3(0), 1.0 );
    vec4 finalPosition = m * vec4( curvePos, 1.0 );
    vec4 prevPos       = m * vec4( prevCurvePos, 1.0 );
    vec4 nextPos       = m * vec4( nextCurvePos, 1.0 );
    vec2 originP  = fix( originPositon, aspect );
    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP    = fix( prevPos, aspect );
    vec2 nextP    = fix( nextPos, aspect );
    mat4 im = instanceMatrix;
    vec3 scale = vec3(
      length(vec3(im[0][0], im[0][1], im[0][2])),
      length(vec3(im[1][0], im[1][1], im[1][2])),
      length(vec3(im[2][0], im[2][1], im[2][2]))
    );
    float w = thickness * width;
    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );
        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
    }
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(res.xy, 0., 1.) * projectionMatrix).xy;
    }
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
}`,lg=re(rg,"vertexShader"),cg=`precision highp float;
#define saturate(t) clamp(t, 0., 1.)
#define PI 3.141592653589793
uniform sampler2D atlas;
uniform sampler2D tDepth;
uniform vec3 uGradientColor;
uniform vec2 res;
varying vec2 vUv;
varying vec4 vColor;
float calc_depth(float z) {
float near = 1.;
float far = 100.;
return (2.0 * near) / (far + near - z * (far - near));
}
#include <packing>
void main() {
vec2 uv = vUv;
vec2 st = gl_FragCoord.xy / res;
vec4 depth = texture2D(tDepth, st);
vec4 color = texture2D(atlas, uv);
float geometryZ = calc_depth(unpackRGBAToDepth(depth));
float sceneZ = calc_depth(gl_FragCoord.z);
float softAlpha = smoothstep(0., 0.003, saturate(geometryZ - sceneZ)) + (1. - depth.a);
float alpha = color.a * vColor.a * softAlpha;
if (alpha == 0.0) discard;
vec3 outputColor = vColor.rgb * color.rgb;
gl_FragColor = vec4(outputColor, alpha);
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,ug=re(cg,"fragmentShader");let dg=class extends zn{constructor(s={}){const{uniforms:i,...n}=s;super({...n});se(this,"name","TrailMaterial");this.uniforms={...i||{},res:_.$renderer.drawingBufferSize},this.dithering=!0,this.transparent=!0,lg.use(this),ug.use(this)}};const ga=new k,ht=new On,Ms=new On,at=new k,Si=Math.PI*2;function hg(e,t,s,i,n,o){e.prototype.damp=function(r,l,c){return this.lerp(r,1-Math.exp(-l*c))},e.prototype.dampVectors=function(r,l,c,u){return this.x=we.lerp(r.x,l.x,1-Math.exp(-c*u)),this.y=we.lerp(r.y,l.y,1-Math.exp(-c*u)),this},t.prototype.damp=function(r,l,c){return this.lerp(r,1-Math.exp(-l*c))},t.prototype.dampVectors=function(r,l,c,u){return this.x=we.lerp(r.x,l.x,1-Math.exp(-c*u)),this.y=we.lerp(r.y,l.y,1-Math.exp(-c*u)),this.z=we.lerp(r.z,l.z,1-Math.exp(-c*u)),this},i.prototype.damp=function(r,l,c){return this.x=we.lerp(this.x,r.x,1-Math.exp(-l*c)),this.y=we.lerp(this.y,r.y,1-Math.exp(-l*c)),this.z=we.lerp(this.z,r.z,1-Math.exp(-l*c)),this},i.prototype.lerp=function(r,l){return this.x+=(r.x-this.x)*l,this.y+=(r.y-this.y)*l,this.z+=(r.z-this.z)*l,this},i.prototype.subEulers=function(r,l){return this.x=we.euclideanModulo(r._x-l._x,Si),this.y=we.euclideanModulo(r._y-l._y,Si),this.z=we.euclideanModulo(r._z-l._z,Si),this},s.prototype.sdamp=function(r,l,c){return this.slerp(r,1-Math.exp(-l*c))},s.prototype.subQuats=function(r,l){return this.x=r.x-l.x,this.y=r.y-l.y,this.z=r.z-l.z,this.w=r.w-l.w,this},n.prototype.lookAt=function(r,l,c){const u=k.get(),h=k.get(),d=Fe.get(),f=Re.get();r.isVector3?u.copy(r):u.set(r,l,c);const b=this.parent;return this.updateWorldMatrix(!0,!1),h.setFromMatrixPosition(this.matrixWorld),d.lookAt(h,u,this.up),this.quaternion.setFromRotationMatrix(d),b&&(d.extractRotation(b.matrixWorld),f.setFromRotationMatrix(d),this.quaternion.premultiply(f.invert())),u.release(),h.release(),d.release(),f.release(),this},io.prototype.isSphere=!0,o.prototype.devtools=function(){}}function fg(e){e.prototype.updateMatrixWorld=function(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);const i=this.children;for(let n=0,o=i.length;n<o;n++)(!i[n].manualMatrixUpdate||s)&&i[n].updateMatrixWorld(s)},e.prototype.updateWorldMatrix=function(s,i){const n=this.parent;if(s===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const o=this.children;for(let a=0,r=o.length;a<r;a++)o[a].manualMatrixUpdate||o[a].updateWorldMatrix(!1,!0)}}}function pg(e){e.prototype.computeBoundingSphere=function(){this.boundingSphere===null&&(this.boundingSphere=new io);const s=this.attributes.position,i=this.morphAttributes.position;if(s&&s.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new k,1/0);return}if(s){const n=this.boundingSphere.center;if(ht.setFromBufferAttribute(s),i)for(let a=0,r=i.length;a<r;a++){const l=i[a];Ms.setFromBufferAttribute(l),this.morphTargetsRelative?(at.addVectors(ht.min,Ms.min),ht.expandByPoint(at),at.addVectors(ht.max,Ms.max),ht.expandByPoint(at)):(ht.expandByPoint(Ms.min),ht.expandByPoint(Ms.max))}ht.getCenter(n);let o=0;for(let a=0,r=s.count;a<r;a++)at.fromBufferAttribute(s,a),o=Math.max(o,n.distanceToSquared(at));if(i)for(let a=0,r=i.length;a<r;a++){const l=i[a],c=this.morphTargetsRelative;for(let u=0,h=l.count;u<h;u++)at.fromBufferAttribute(l,u),c&&(ga.fromBufferAttribute(s,u),at.add(ga)),o=Math.max(o,n.distanceToSquared(at))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)}}}function mg(e,t){const s={fogTexture:{value:null},fogUVTexture:{value:new X},fogFarDensity:{value:1}};Object.assign(e.fog,s);for(const i of Object.values(t))Object.assign(i.uniforms,s)}const gg=`#ifdef USE_ASCEND_FOG
vec3 objPos = vObjectPosition;
float n = texture2D(tNoise, (objPos.xz + vec2(ascendFogTime)) * ascendFogFrequency).r * ascendFogAmplitude;
n += texture2D(tNoise, (objPos.xz + vec2(ascendFogTime)) * ascendFogFrequency * ascendFogLacunarity).g * ascendFogAmplitude * ascendFogGain;
n += texture2D(tNoise, (objPos.xz + vec2(ascendFogTime)) * ascendFogFrequency * ascendFogLacunarity * ascendFogLacunarity).b * ascendFogAmplitude * ascendFogGain * ascendFogGain;
float yOffset = smoothstep(objPos.y + normal.y - ascendFogDensity / 2., objPos.y + normal.y + ascendFogDensity / 2., ascendFogOffset - n + ascendFogAmplitude);
gl_FragColor.rgb = mix(gl_FragColor.rgb, ascendFogColor, yOffset);
#endif`,vg=Object.freeze(Object.defineProperty({__proto__:null,default:gg},Symbol.toStringTag,{value:"Module"})),_g=`#ifdef USE_ASCEND_FOG
varying vec3 vObjectPosition;
varying vec3 vObjectNormal;
varying float vAscendFogDepth;
uniform sampler2D tNoise;
uniform float ascendFogDensity;
uniform float ascendFogOffset;
uniform float ascendFogFrequency;
uniform float ascendFogAmplitude;
uniform float ascendFogTime;
uniform float ascendFogGain;
uniform float ascendFogLacunarity;
uniform vec3 ascendFogColor;
#endif`,yg=Object.freeze(Object.defineProperty({__proto__:null,default:_g},Symbol.toStringTag,{value:"Module"})),bg=`#ifdef USE_ASCEND_FOG
varying float vAscendFogDepth;
varying vec3 vObjectPosition;
varying vec3 vObjectNormal;
#endif`,xg=Object.freeze(Object.defineProperty({__proto__:null,default:bg},Symbol.toStringTag,{value:"Module"})),wg=`#ifdef USE_ASCEND_FOG
vec4 objsetPos = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
objsetPos = instanceMatrix * objsetPos;
#endif
objsetPos = modelMatrix * objsetPos;
vObjectPosition = objsetPos.xyz;
vObjectNormal = vec3(modelMatrix * vec4(normal, 0.0));
#endif`,Sg=Object.freeze(Object.defineProperty({__proto__:null,default:wg},Symbol.toStringTag,{value:"Module"})),$g=`float blendLighten(float base, float blend) {
return max(blend, base);
}
vec3 blendLighten(vec3 base, vec3 blend) {
return vec3(blendLighten(base.r, blend.r), blendLighten(base.g, blend.g), blendLighten(base.b, blend.b));
}
vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}
float blendOverlay(float base, float blend) {
return base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend));
}
vec3 blendOverlay(vec3 base, vec3 blend) {
return vec3(blendOverlay(base.r, blend.r), blendOverlay(base.g, blend.g), blendOverlay(base.b, blend.b));
}
vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {
return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));
}
float blendSoftLight(float base, float blend) {
return (blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend));
}
vec3 blendSoftLight(vec3 base, vec3 blend) {
return vec3(blendSoftLight(base.r, blend.r), blendSoftLight(base.g, blend.g), blendSoftLight(base.b, blend.b));
}
vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {
return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));
}
float blendLinearBurn(float base, float blend) {
return max(base + blend - 1.0, 0.0);
}
vec3 blendLinearBurn(vec3 base, vec3 blend) {
return max(base + blend - vec3(1.0), vec3(0.0));
}
vec3 blendLinearBurn(vec3 base, vec3 blend, float opacity) {
return (blendLinearBurn(base, blend) * opacity + base * (1.0 - opacity));
}`,Mg=Object.freeze(Object.defineProperty({__proto__:null,default:$g},Symbol.toStringTag,{value:"Module"})),Cg=`float cubicIn(float t) {
  return t * t * t;
}
#ifndef HALF_PI
#define HALF_PI 1.5707963267948966
#endif
float sineIn(float t) {
  return sin((t - 1.0) * HALF_PI) + 1.0;
}`,kg=Object.freeze(Object.defineProperty({__proto__:null,default:Cg},Symbol.toStringTag,{value:"Module"})),Tg=`#ifdef USE_FOG
vec3 fogTextureColor = texture2D( fogTexture, gl_FragCoord.xy / fogUVTexture ).rgb;
#ifdef FOG_EXP2
float fogFactor = 1. - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
#else
float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
#endif
vec3 fogColorFinal = mix( fogColor, fogTextureColor, smoothstep(0.5, .99, fogFactor) );
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Eg=Object.freeze(Object.defineProperty({__proto__:null,default:Tg},Symbol.toStringTag,{value:"Module"})),Pg=`#ifdef USE_FOG
uniform vec3 fogColor;
uniform sampler2D fogTexture;
uniform vec2 fogUVTexture;
uniform float fogFarDensity;
varying float vFogDepth;
#ifdef FOG_EXP2
uniform float fogDensity;
#else
uniform float fogNear;
uniform float fogFar;
#endif
#endif`,Lg=Object.freeze(Object.defineProperty({__proto__:null,default:Pg},Symbol.toStringTag,{value:"Module"})),Ag=`mat4 getInstanceMatrix( vec3 p, vec4 q, vec3 s ) {
    mat4 m;
    float x = q.x;
    float y = q.y;
    float z = q.z;
    float w = q.w;
    float x2 = x + x;
    float y2 = y + y;
    float z2 = z + z;
    float xx = x * x2;
    float xy = x * y2;
    float xz = x * z2;
    float yy = y * y2;
    float yz = y * z2;
    float zz = z * z2;
    float wx = w * x2;
    float wy = w * y2;
    float wz = w * z2;
    float sx = s.x;
    float sy = s.y;
    float sz = s.z;
    m[ 0 ][ 0 ] = ( 1. - ( yy + zz ) ) * sx;
    m[ 0 ][ 1 ] = ( xy + wz ) * sx;
    m[ 0 ][ 2 ] = ( xz - wy ) * sx;
    m[ 0 ][ 3 ] = 0.;
    m[ 1 ][ 0 ] = ( xy - wz ) * sy;
    m[ 1 ][ 1 ] = ( 1. - ( xx + zz ) ) * sy;
    m[ 1 ][ 2 ] = ( yz + wx ) * sy;
    m[ 1 ][ 3 ] = 0.;
    m[ 2 ][ 0 ] = ( xz + wy ) * sz;
    m[ 2 ][ 1 ] = ( yz - wx ) * sz;
    m[ 2 ][ 2 ] = ( 1. - ( xx + yy ) ) * sz;
    m[ 2 ][ 3 ] = 0.;
    m[ 3 ][ 0 ] = p.x;
    m[ 3 ][ 1 ] = p.y;
    m[ 3 ][ 2 ] = p.z;
    m[ 3 ][ 3 ] = 1.;
    return m;
}`,Og=Object.freeze(Object.defineProperty({__proto__:null,default:Ag},Symbol.toStringTag,{value:"Module"})),Rg=`vec2 invLerp(vec2 from, vec2 to, vec2 v) {
return clamp((v - from) / (to - from), from, to);
}`,Dg=Object.freeze(Object.defineProperty({__proto__:null,default:Rg},Symbol.toStringTag,{value:"Module"})),Ig=`vec3 lighten(vec3 color, float amount) {
return color * (color + (1. - color) * amount);
}
vec4 lighten(vec4 color, float amount) {
return (color * (color + (1. - color) * amount)) * color.a;
}`,zg=Object.freeze(Object.defineProperty({__proto__:null,default:Ig},Symbol.toStringTag,{value:"Module"})),Fg=`float luma(vec3 color, float amount) {
return dot(color, vec3(0.299, 0.587, 0.114)) * amount;
}
float luma(vec3 color) {
return dot(color, vec3(0.299, 0.587, 0.114));
}`,Ug=Object.freeze(Object.defineProperty({__proto__:null,default:Fg},Symbol.toStringTag,{value:"Module"})),Ng=`vec4 lookup(sampler2D lut, vec4 color) {
  #ifndef LUT_NO_CLAMP
    color = clamp(color, 0.0, 1.0);
  #endif
  mediump float blueColor = color.b * 63.0;
  mediump vec2 quad1;
  quad1.y = floor(floor(blueColor) / 8.0);
  quad1.x = floor(blueColor) - (quad1.y * 8.0);
  mediump vec2 quad2;
  quad2.y = floor(ceil(blueColor) / 8.0);
  quad2.x = ceil(blueColor) - (quad2.y * 8.0);
  highp vec2 texPos1;
  texPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * color.r);
  texPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * color.g);
  #ifdef LUT_FLIP_Y
    texPos1.y = 1.0 - texPos1.y;
  #endif
  highp vec2 texPos2;
  texPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * color.r);
  texPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * color.g);
  #ifdef LUT_FLIP_Y
    texPos2.y = 1.0 - texPos2.y;
  #endif
  lowp vec4 color1 = texture2D(lut, texPos1);
  lowp vec4 color2 = texture2D(lut, texPos2);
  return mix(color1, color2, fract(blueColor));
}`,Bg=Object.freeze(Object.defineProperty({__proto__:null,default:Ng},Symbol.toStringTag,{value:"Module"})),Vg=`float remap(float value, float min1, float max1, float min2, float max2) {
return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
}
vec2 remap(vec2 value, vec2 min1, vec2 max1, vec2 min2, vec2 max2) {
return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
}`,Zg=Object.freeze(Object.defineProperty({__proto__:null,default:Vg},Symbol.toStringTag,{value:"Module"})),jg=`vec3 rgb2hsv(vec3 c)
{
    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
    float d = q.x - min(q.w, q.y);
    float e = 1.0e-10;
    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}
vec3 hsv2rgb(vec3 c)
{
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}`,Hg=Object.freeze(Object.defineProperty({__proto__:null,default:jg},Symbol.toStringTag,{value:"Module"})),Gg=`vec2 rotateUv(vec2 uv, float angle) {
uv -= .5;
uv = vec2(
uv.x * cos(angle) - uv.y * sin(angle),
uv.x * sin(angle) + uv.y * cos(angle)
);
uv += .5;
return uv;
}`,Wg=Object.freeze(Object.defineProperty({__proto__:null,default:Gg},Symbol.toStringTag,{value:"Module"})),qg=`vec4 _saturate(vec4 color, float amount) {
vec3 gray = vec3(dot(vec3(.2126, .7152, .0722), color.rgb));
return vec4(mix(gray, color.rgb, amount) * color.a, color.a);
}
vec3 _saturate(vec3 color, float amount) {
vec3 gray = vec3(dot(vec3(.2126, .7152, .0722), color));
return mix(gray, color, amount);
}
float _saturate(float color, float amount) {
float gray = dot(vec3(.2126, .7152, .0722), vec3(color));
return mix(gray, color, amount);
}`,Yg=Object.freeze(Object.defineProperty({__proto__:null,default:qg},Symbol.toStringTag,{value:"Module"})),Kg=`float sdSegment( in vec2 p, in vec2 a, in vec2 b )
{
vec2 pa = p-a, ba = b-a;
float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );
return length( pa - ba*h );
}`,Xg=Object.freeze(Object.defineProperty({__proto__:null,default:Kg},Symbol.toStringTag,{value:"Module"})),Qg=`float cro(in vec2 a, in vec2 b ) { return a.x*b.y - a.y*b.x; }
float sdUnevenCapsule( in vec2 p, in vec2 pa, in vec2 pb, in float ra, in float rb )
{
    p  -= pa;
    pb -= pa;
    float h = dot(pb,pb);
    vec2  q = vec2( dot(p,vec2(pb.y,-pb.x)), dot(p,pb) )/h;
    q.x = abs(q.x);
    float b = ra-rb;
    vec2  c = vec2(sqrt(h-b*b),b);
    float k = cro(c,q);
    float m = dot(c,q);
    float n = dot(q,q);
         if( k < 0.0 ) return sqrt(h*(n            )) - ra;
    else if( k > c.x ) return sqrt(h*(n+1.0-2.0*q.y)) - rb;
                       return m                       - ra;
}`,Jg=Object.freeze(Object.defineProperty({__proto__:null,default:Qg},Symbol.toStringTag,{value:"Module"})),ev=`float wrap(float _min, float _max, float _value) {
float range = _max - _min;
return _min + mod(mod(_value - _min, range) + range, range);
}`,tv=Object.freeze(Object.defineProperty({__proto__:null,default:ev},Symbol.toStringTag,{value:"Module"})),sv=`vec2 zoom(vec2 uv, float zoom) {
uv -= .5;
uv /= zoom;
uv += .5;
return uv;
}
vec2 zoom(vec2 uv, vec2 zoom) {
uv -= .5;
uv /= zoom;
uv += .5;
return uv;
}`,nv=Object.freeze(Object.defineProperty({__proto__:null,default:sv},Symbol.toStringTag,{value:"Module"})),va=Object.assign({"./ascendfog_fragment.glsl":vg,"./ascendfog_pars_fragment.glsl":yg,"./ascendfog_pars_vertex.glsl":xg,"./ascendfog_vertex.glsl":Sg,"./blending_pars_fragment.glsl":Mg,"./easings.glsl":kg,"./fog_fragment.glsl":Eg,"./fog_pars_fragment.glsl":Lg,"./get_instance_matrix.glsl":Og,"./invlerp.glsl":Dg,"./lighten.glsl":zg,"./luma.glsl":Ug,"./lut.glsl":Bg,"./map.glsl":Zg,"./rgbhsv.glsl":Hg,"./rotateUv.glsl":Wg,"./saturate.glsl":Yg,"./sd_segment.glsl":Xg,"./sd_unevencapsule.glsl":Jg,"./wrap.glsl":tv,"./zoom.glsl":nv});function iv(){for(const e in va){const t=e.split("/").pop().slice(0,-5);gc[t]=va[e].default}}const Yy=e=>typeof e=="number"?new X(e,e):Array.isArray(e)?new X(...e):e,ov=e=>typeof e=="number"?new k(e,e,e):Array.isArray(e)?new k(...e):e,Ky=e=>typeof e=="number"?[e,e]:e,av=`precision highp float;
uniform float uProgress;
varying vec2 vUv;
void main() {
vec2 uv = vUv;
float scale_from = 0.;
float scale_to = 1.;
float alpha_from = 1.;
float alpha_to = 0.;
float scale = mix(scale_from, scale_to, uProgress);
float alpha = mix(alpha_from, alpha_to, uProgress);
float radius = .49 * scale;
float dist = distance(uv, vec2(0.5));
float circle = 1. - step(radius, dist);
vec3 color = vec3(1.) * circle;
gl_FragColor = vec4(color, smoothstep(.0, .5, circle * alpha));
}`,rv=re(av,"fragmentShader");class lv{constructor(){this.webgl=St(),this.progress=0;const t=this.webgl.$assets.geometries.register("plane",vr),s=this.mat=new us({name:"ShockWaveMaterial",vertexShader:`
				varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
				}`,uniforms:{...this.webgl.uniforms,uProgress:{value:this.progress}},depthWrite:!1,transparent:!0});rv.use(s),this.base=new In(t,s),this.base.visible=!1,this.base.renderOrder=this.webgl.$store.z.player}update(){this.mat.uniforms.uProgress.value=this.progress}async emit({to:t=null,reset:s=!0,force:i=!0,scale:n=1,delay:o=0,duration:a=1e3,position:r=[0,0,0]}={}){const{base:l}=this;l.scale.setScalar(n),this.tween&&i&&(this.tween.destroy(),this.tween=null),s&&(this.progress=0,this.update()),this.tween=le({onStart:()=>{const c=ov(r);l.position.copy(c),l.visible=!0,t&&(t==null||t.add(l))},onComplete:()=>{var c;l.visible=!1,(c=l.parent)==null||c.remove(l),l.position.setScalar(0),this.tween=null},onUpdate:this.update.bind(this)}).to(this,{progress:1,duration:a,delay:o,ease:ne.outSwift})}}const cv=`precision highp float;
attribute vec4 texCoords;
attribute vec4 meshCoords;
attribute vec3 spritePos;
attribute vec4 spriteQt;
attribute vec4 spriteColor;
attribute vec2 decorators;
varying vec2 vUv;
varying vec4 vColor;
#include <fog_pars_vertex>
#include <get_instance_matrix>
void main() {
vColor = spriteColor;
vUv = uv * texCoords.zw + texCoords.xy;
vec3 transformed = position;
transformed.xy = transformed.xy * meshCoords.zw + (meshCoords.xy);
mat4 instanceMatrix = getInstanceMatrix(spritePos, spriteQt, vec3(1.) );
vec4 mvPosition = modelViewMatrix * instanceMatrix * vec4(transformed, 1.);
#include <fog_vertex>
vec4 bbPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
bbPosition.x += cos(spriteQt.x) * transformed.x - sin(spriteQt.x) * transformed.y;
bbPosition.y += sin(spriteQt.x) * transformed.x + cos(spriteQt.x) * transformed.y;
mvPosition = mix(mvPosition, bbPosition, decorators.x);
gl_Position = projectionMatrix * mvPosition;
}`,ll=re(cv,"vertexShader"),uv=`precision highp float;
uniform sampler2D atlas;
varying vec2 vUv;
varying vec4 vColor;
#include <common>
#include <dithering_pars_fragment>
#include <fog_pars_fragment>
#include <luma>
const vec3 fogCol = vec3(0.9, 1.0, 1.0);
void main() {
vec2 uv = vUv;
vec4 color = texture2D(atlas, uv);
float shape = color.r;
#ifdef USE_ALPHA_SDF
#ifdef IS_ADDITIVE_BLENDING
float l = vColor.a * luma(vColor.rgb) * 1.;
shape = max(smoothstep(0.48, 0.52, shape), shape * l);
#else
shape = smoothstep(0.9, 0.92, shape);
#endif
#endif
float alpha = color.a * vColor.a;
vec3 col = vColor.rgb;
#ifdef USE_ALPHA_PREMULTIPLY
col *= vColor.a;
#endif
gl_FragColor = vec4(col * color.rgb, alpha );
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,dv=re(uv,"fragmentShader");class cl extends us{constructor({count:s,atlas:i,renderOrder:n,useAlphaSDF:o,blending:a,...r}){super(r);se(this,"name","SpriteMaterial");typeof a=="function"?a(this):this.blending=a,this.uniforms={...Le.fog,...r.uniforms||{},atlas:{value:i.texture,type:"t"}};const l=this.blending===Ns;this.defines={IS_ADDITIVE_BLENDING:!!l,USE_ALPHA_SDF:!!o},this.extensions={derivatives:!0},this.fog=!0,this.dithering=!0,this.transparent=!0,ll.use(this),dv.use(this)}}const hv=`precision highp float;
uniform sampler2D atlas;
varying vec2 vUv;
varying vec4 vColor;
#include <common>
#include <dithering_pars_fragment>
#include <fog_pars_fragment>
#include <luma>
const vec3 fogCol = vec3(0.9, 1.0, 1.0);
void main() {
vec2 uv = vUv;
vec4 color = texture2D(atlas, uv);
float shape = color.r;
#ifdef USE_ALPHA_SDF
#ifdef IS_ADDITIVE_BLENDING
float l = vColor.a * luma(vColor.rgb) * 1.;
shape = max(smoothstep(0.48, 0.52, shape), shape * l);
#else
shape = smoothstep(0.48, 0.52, shape);
#endif
#endif
float alpha = color.a * vColor.a;
vec3 col = vColor.rgb;
#ifdef USE_ALPHA_PREMULTIPLY
col *= vColor.a;
#endif
gl_FragColor = vec4(col * color.rgb, alpha );
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,fv=re(hv,"fragmentShader");class pv extends cl{constructor(s={}){super(s);se(this,"name","BirdsMaterial");this.side=ao,ll.use(this),fv.use(this)}}const mv=`precision highp float;
attribute vec4 texCoords;
attribute vec4 meshCoords;
attribute vec3 spritePos;
attribute vec4 spriteQt;
attribute vec4 spriteColor;
attribute vec2 decorators;
varying vec2 vOriginalUv;
varying vec2 vUv;
varying vec4 vColor;
varying vec2 vDecorators;
#include <fog_pars_vertex>
#include <get_instance_matrix>
void main() {
vDecorators = decorators;
vColor = spriteColor;
vUv = uv * texCoords.zw + texCoords.xy;
vOriginalUv = uv * texCoords.zw;
vec3 transformed = position;
transformed.xy = transformed.xy * meshCoords.zw + (meshCoords.xy);
mat4 instanceMatrix = getInstanceMatrix(spritePos, spriteQt, vec3(1.) );
vec4 mvPosition = modelViewMatrix * instanceMatrix * vec4(transformed, 1.);
#include <fog_vertex>
vec4 bbPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
bbPosition.x += cos(spriteQt.x) * transformed.x - sin(spriteQt.x) * transformed.y;
bbPosition.y += sin(spriteQt.x) * transformed.x + cos(spriteQt.x) * transformed.y;
mvPosition = bbPosition;
gl_Position = projectionMatrix * mvPosition;
}`,gv=re(mv,"vertexShader"),vv=`precision highp float;
#define saturate(a) clamp( a, 0.0, 1.0 )
uniform sampler2D atlas;
uniform sampler2D tWorley;
uniform sampler2D tNoise;
uniform float time;
varying vec2 vUv;
varying vec2 vDecorators;
varying vec4 vColor;
varying vec2 vOriginalUv;
#include <common>
#include <dithering_pars_fragment>
#include <fog_pars_fragment>
#include <luma>
const vec3 fogCol = vec3(0.9, 1.0, 1.0);
float Cloud(vec2 uv) {
vec3 noise   = texture2D(tNoise, (uv + vec2(time * .00004, 0.))).rgb;
float worley = (texture2D(tWorley, uv * .125).b + noise.b) * .625;
worley -= (texture2D(tWorley, uv * .125).g + noise.g) * .25;
worley -= (texture2D(tWorley, uv * .125).r + noise.r) * .25;
return saturate(1. - worley) * 2. - 1.;
}
void main() {
vec2 uv = vUv;
vec4 color = texture2D(atlas, uv);
float shape = color.r;
#ifdef USE_ALPHA_SDF
#ifdef IS_ADDITIVE_BLENDING
float l = vColor.a * luma(vColor.rgb) * 1.;
shape = max(smoothstep(0.48, 0.52, shape), shape * l);
#else
shape = smoothstep(0.9, 0.92, shape);
#endif
#endif
float alpha = color.a * vColor.a;
vec3 col = vColor.rgb;
#ifdef USE_ALPHA_PREMULTIPLY
col *= vColor.a;
#endif
alpha -= 1. - (saturate(Cloud(vOriginalUv) * 2.) + smoothstep(-.5, .5, vOriginalUv.x) - (1. - vDecorators.y) * 2.);
gl_FragColor = vec4(col * color.rgb, alpha );
#ifdef USE_ALPHA_SDF
gl_FragColor = vec4(col , alpha * shape);
#endif
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,_v=re(vv,"fragmentShader");class yv extends us{constructor({count:s,atlas:i,renderOrder:n,useAlphaSDF:o,blending:a,...r}){super(r);se(this,"name","ChapterTitleMaterial");typeof a=="function"?a(this):this.blending=a,this.uniforms={...Le.fog,...r.uniforms||{},time:_.uniforms.time,tWorley:{value:_.$assets.textures.worleyNoise},tNoise:{value:_.$assets.textures.perlinNoise},atlas:{value:i.texture,type:"t"}};const l=this.blending===Ns;this.defines={IS_ADDITIVE_BLENDING:!!l,USE_ALPHA_SDF:!!o},this.extensions={derivatives:!0},this.fog=!0,this.dithering=!0,this.transparent=!0,gv.use(this),_v.use(this)}}pg(cs);fg(Oe);mg(Le,Us);hg(X,k,Re,It,Oe,vc);const bv=Object.assign({"/webgl/components/ParticlePresets/collectibleBurst.js":Mm,"/webgl/components/ParticlePresets/fireworksBurst.js":Lm,"/webgl/components/ParticlePresets/fireworksBurstFall.js":zm,"/webgl/components/ParticlePresets/fireworksFlash.js":Hm,"/webgl/components/ParticlePresets/fireworksTrail.js":l0,"/webgl/components/ParticlePresets/smoke.js":g0,"/webgl/components/ParticlePresets/sparkles.js":S0,"/webgl/components/ParticlePresets/speedline.js":E0,"/webgl/components/ParticlePresets/wind.js":F0,"/webgl/components/ParticlePresets/windBlur.js":Z0});let $i=!1,_a=Dt();const Xi={sea_of_clouds:()=>jn(()=>import("./SeaOfCloudsScene.f997cf80.js"),[window.MM_EXPERIENCE_CONFIG.resolveUrl("SeaOfCloudsScene.f997cf80.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("vendors/vendors.a233fc08.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("BaseLevel.3cf717b5.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("TextMaterial.a6b46cf7.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("experience.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("experience.css")],import.meta.url),frozen_lake:()=>jn(()=>import("./FrozenLakeScene.5377b000.js"),[window.MM_EXPERIENCE_CONFIG.resolveUrl("FrozenLakeScene.5377b000.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("vendors/vendors.a233fc08.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("BaseLevel.3cf717b5.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("experience.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("experience.css")],import.meta.url),starry_night:()=>jn(()=>import("./StarryNightScene.c9cd746e.js"),[window.MM_EXPERIENCE_CONFIG.resolveUrl("StarryNightScene.c9cd746e.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("vendors/vendors.a233fc08.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("BaseLevel.3cf717b5.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("TextMaterial.a6b46cf7.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("experience.js"),window.MM_EXPERIENCE_CONFIG.resolveUrl("experience.css")],import.meta.url)};let ya=!0;const xv=new Dn(45,1,.1,1e3);xv.position.z=100;function wv(e){iv();let t=!1;const s={},i={},n={};let o=null;e.hooks.beforePrerender=he(),e.hooks.afterPrerender=he(),Object.assign(e,{init:a,preload:l,start:c,update:S,render:C,resize:y,prerender:x,switchScene:m,getCurrentScene:f,getRouteFromLevel:h,getZeppelin:d});function a(){const{$renderer:w,$time:v,$particles:$}=e,{task:P}=e.$app.$preloader;P(_a),v.clampTo60fps=!1,Object.assign(w.options,{antialias:!1}),e.bgm=M.$audio.bgm,e.playSound=M.$audio.playSound,e.stopSound=M.$audio.stopSound,w.init(),w.instance.setClearColor(0,0),$.setPresets(bv),$.init(),e.loadScene=u}function r(){const{$particles:w,$assets:v,$game:$,$store:P}=e;w.registerBatcher("gem_normal",{atlas:v.spritesheets.gems,depthTest:!0,count:500,renderOrder:P.z.particles}),w.registerBatcher("fake_lights",{atlas:v.spritesheets.gems,depthTest:!1,depthWrite:!1,blending:"additive",count:500}),w.registerBatcher("gem_emissive",{atlas:v.spritesheets.gems,blending:"additive",depthTest:!0,count:500,renderOrder:P.z.particles}),w.registerBatcher("titles",{atlas:v.spritesheets["sprites-titles"],useAlphaSDF:!0,depthTest:!0,depthWrite:!0,material:yv,renderOrder:P.z.particles}),w.registerBatcher("trail",{atlas:e.$assets.spritesheets.trailWind,trails:!0,material:dg,depthWrite:!0,count:2e3,renderOrder:P.z.particles,uniforms:{tDepth:$.depthPrepass}}),w.registerBatcher("birds_normal",{atlas:v.spritesheets["sprites-birds"],material:pv,count:300,depthTest:!0,depthWrite:!0,renderOrder:P.z.environment}),w.registerBatcher("wind",{atlas:v.spritesheets.trailWind,depthTest:!1,count:500,renderOrder:P.z.particles}),w.registerBatcher("smoke",{count:1e3,depthTest:!0,depthWrite:!0,atlas:v.spritesheets.smoke,material:ag,renderOrder:-1})}async function l(){const{load:w}=e.$assets,{task:v}=e.$app.$preloader;await Promise.all([v(w("dirtyNoise",{repeat:!0,data:!0,nearest:!0})),v(w("perlinNoise",{repeat:!0,data:!0})),v(w("blueNoise",{repeat:!0,data:!0})),v(w("worleyNoise",{repeat:!0,data:!0})),v(w("sprites-clouds",{id:"clouds",linear:!0})),v(w("sprites-smoke",{id:"smoke",linear:!0})),v(w("sunset-horizon",{linear:!0,srgb:!0})),v(w("boost-matcap",{repeat:!1,flipY:!1,data:!0})),v(w("boost-alpha",{repeat:!1,flipY:!1,data:!0})),v(w("boost-halo",{repeat:!1,flipY:!1,data:!0})),v(w("sprites-wind",{id:"trailWind",linear:!0,srgb:!1})),v(w("sprites-gems",{id:"gems",linear:!0,srgb:!1})),v(w("sprites-titles"+(e.$app.$l("CHAP1-subtitle").length?"":"-alt"),{id:"sprites-titles",linear:!0,srgb:!1})),v(w("sprites-terrain",{srgb:!1})),v(w("sprites-birds",{linear:!0,srgb:!1})),v(w("snow"),{repeat:!1,srgb:!1}),v(w("hdri")),v(w("lut",{linear:!0,data:!0,flipY:!1})),v(H1.load()),v(x1.load()),v(n1.load()),v(c1.load())]);const $=[],P=e.$app._sceneQueue??[];$.push(...Array.from(P).map(T=>v(u(T)))),await Promise.all($)}async function c(){const{$viewport:w,$renderer:v,$time:$,$physics:P,$app:T,$fx:L,$quality:O,$game:D}=e;r(),v.resize(),$.init(),L.init(),P.start(),e.shockWave=new lv,o=e.transitionScene=new tg,o.triggerInit(),t=!0,e.$app.$preloader;for(const U in s)s[U]===!1&&await b(U);pe(()=>T.$route.name,m,{immediate:!0}),O.current.watchImmediate(g),D.hooks.afterLevelStarted.watch(()=>{O.pause(),setTimeout(()=>O.resume(),5e3)}),y(),w.changed.watch(y),w.resize()}async function u(w){var T;if(!w||w==((T=e.scene)==null?void 0:T.name))return;if(n[w])return t&&await b(w),n[w];const v=n[w]=Dt(),$=await Xi[w]();return await(i[w]=$.default).load(),s[w]=!1,t&&await b(w),v.resolve()}function h(w){switch(w){case"sea_of_clouds":return"Sea of Clouds";case"frozen_lake":return"Frozen Lake";case"starry_night":return"Starry Night"}}function d(){return e.scene.zeppelin}function f(w){switch(w||e.$app.$route.name){case"Home":case"Sea of Clouds":return s.sea_of_clouds;case"Frozen Lake":return s.frozen_lake;case"Starry Night":return s.starry_night;default:return e.scene}}async function b(w){e.hooks.beforePrerender.unwatchAll(),e.hooks.afterPrerender.unwatchAll(),e.$game.hooks.beforeBgPass.unwatchAll(),e.$game.hooks.afterBgPass.unwatchAll();const v=s[w]=new i[w];v&&(v.triggerInit(),await p(w,v))}async function p(w,v){if(!v.prerendered){e.hooks.beforePrerender.emit(),$i=!0,e.scene&&e.scene.triggerOut(),e.scene&&e.scene.destroy(),e.$particles.reset(),e.scene&&(e.scene=null),await Q(500),e.scene=v,e.$app.$user.currentLevel=h(e.scene.name),v.camera.base.updateMatrixWorld(!0),v.triggerIn(),await Q(100),e.$game.started||await e.$game.start(),v.zeppelin.base.visible=!0,v.triggerUpdate(),v.triggerPrerender&&v.triggerPrerender(),e.$fx.render(v),o&&o.triggerRender(),await Q(250),ya&&(v.prerenderTextures.push(e.$assets.spritesheets.trailWind.texture),v.prerenderTextures.push(e.$assets.spritesheets["sprites-titles"].texture),v.prerenderTextures.push(e.$assets.spritesheets["sprites-birds"].texture),v.prerenderTextures.push(e.$assets.spritesheets.gems.texture));for(let $=0;$<v.prerenderTextures.length;$++){if($!==v.prerenderTextures.length-1)continue;const P=v.prerenderTextures[$];await Q(50),v.prerenderPlane.material.map=P,v.triggerUpdate(),v.triggerPrerender&&v.triggerPrerender(),e.$fx.render(v),o&&o.triggerRender()}await Q(250),v.prerenderPlane.visible=!1,e.$game.hooks.skyHasChanged.emit(),v.prerendered=!0,e.hooks.afterPrerender.emit(),ya=!1,$i=!1,_a.resolve()}}function m(w){e.scene&&e.scene!==f(w)&&e.scene.triggerOut(),e.scene=f(w),e.scene&&(e.$app.$user.currentLevel=h(e.scene.name),e.scene.triggerIn(),e.$game.started||e.$game.start())}function g(w){const v=e.$renderer,$=e.$game;switch(w){case 5:v.setMaxPixelRatio(2),v.setMinPixelRatio(1.5),$.updateQuality("high");break;case 4:v.setMaxPixelRatio(2),v.setMinPixelRatio(1.5),$.updateQuality("high");break;case 3:v.setMaxPixelRatio(2),v.setMinPixelRatio(1),$.updateQuality("high");break;case 2:v.setMaxPixelRatio(1.8),v.setMinPixelRatio(1),$.updateQuality("high");break;case 1:v.setMaxPixelRatio(1.8),v.setMinPixelRatio(1),$.updateQuality("medium");break;default:v.setMaxPixelRatio(1.5),v.setMinPixelRatio(1),$.updateQuality("medium")}}function y(){const{$viewport:w,uniforms:v}=e;w&&v.resolution.value.set(...w.size.value,1/w.pixelRatio.value,w.ratio.value)}function x(){}function S(){var O;const{uniforms:w,$time:v,$physics:$,$game:P,$particles:T,$app:L}=e;L.$controls.poll(),w.time.value=v.elapsed,!$i&&(P==null||P.update(),$==null||$.update(),T==null||T.update(),(O=e==null?void 0:e.scene)==null||O.triggerUpdate(),o&&o.triggerUpdate())}function C(){const{$fx:w}=e,v=e.scene;v&&v.prerendered&&(w.render(v),o&&o.triggerRender())}}const ul={tuto:-1,birds:0,airBalloon:1,fireflies:2,templeReveal:3,zoom:4,unzoom:5,lantern:6},Sv=Object.entries(ul).reduce((e,[t,s])=>(e[s]=t,e),{}),gt={Tuto:-1,Checkpoint:0,Boost:1,Collectible:2,Obstacle:3,Player:4,Combos:5};Object.entries(gt).reduce((e,[t,s])=>(e[s]=t,e),{});function $v(e){const t=te(null),s={types:{level:gt,event:ul},events:he(),init:i,get:l,create:p,mount:h,reload:b,change:f,clear:d,first:c,next:u,list:new Map};return s;function i(){t.set(null)}function n({p:x,type:S},C){return{position:x,id:C,isCheckpoint:!0,hasBeenReached:!1,event:Sv[S],type:gt.Checkpoint}}function o({pos:x,body:S,scl:C}){Array.isArray(x)||(x=[x]),x[1]=x[1]??x[0];const w=new k;w.set(x[0],x[1],0);const v=_c(S.size)*C,$=new X().fromArray(S.size).multiplyScalar(C);return{position:w,size:v,hitbox:$,hasBeenTaken:!1,type:gt.Boost,isBoost:!0}}function a({pos:x,body:S,gfx:C,scl:w}){Array.isArray(x)||(x=[x]),x[1]=x[1]??x[0];const v=new k;v.set(x[0],x[1],0);const $=C.scl,P=S.radius;return{position:v,size:$,hitbox:P,hasBeenCollected:!1,type:gt.Collectible,isCollectible:!0}}function r({hitbox:x,pos:S}){const C=new k;C.fromArray(S);const w=x.radius,v=w*.5;return{position:C,size:w,hitbox:v,type:gt.Player,isZeppelin:!0}}function l(x){return s.list.get(x)}function c(){return Object.keys(Xi)[0]}function u(){const{currentLevel:x}=e,S=Object.keys(Xi),C=S.indexOf(x.name);if(C===-1)return!1;const w=S[C+1];return w||!1}function h(x){e.currentLevel&&e.currentLevel.unMount();const S=l(x);return S?(e.hooks.beforeMounted.emit(S),S.reset(),e.hooks.mounted.emit(S),S.isMounted=!0,S.needUpdate=!0,t.set(S,!0),e.currentLevel=S,e.hooks.afterMounted.emit(S),S):!1}function d(){const x=e.currentLevel;x&&(e.hooks.beforeUnMounted.emit(x),e.hooks.unMounted.emit(x),x.isMounted=!1,x.needUpdate=!1,t.set(null),e.currentLevel=null,e.hooks.afterUnMounted.emit(x))}function f(x){return d(),h(x)}function b(){return e.currentLevel?f(e.currentLevel.name):!1}function p(x,{data:S,scene:C}){const{checkpoints:w,boosts:v,collectibles:$,obstacles:P,combos:T,player:L,game:O,storm:D,empty_area:U,limits:A,tutoLimit:R}=S,z=[...w.map(n),...v.map(o),...$.map(a)].filter(Boolean),Y=[],ce=[],oe=[];z.forEach(ve=>{ve.isBoost&&Y.push(ve),ve.isCollectible&&ce.push(ve),ve.isCheckpoint&&oe.push(ve)});const ue=r(L),K={};return Object.assign(K,{name:x,isMounted:!1,needUpdate:!1,progress:0,progressNormalized:0,start:O.start[0],end:O.end[0],isEnded:!1,lose:!1,totalLength:O.chapter_length,cameraPosition:O.camera_pos,zeppelin:ue,collectibles:ce,boosts:Y,combos:T,checkpoints:oe,empty_area:U,game:O,limits:A,tutoLimit:R,isZooming:0,datas:z,_rawDatas:S,lastCheckpoint:null,isStormy:!1,stormy:he(),endEvent:he(),storm:D,_stormManual:!1,update:m.bind(K),reset:y.bind(K),onEnd:g.bind(K),mount:()=>h(x),unMount:()=>d()&&K.reset(),scene:C,...An("level â¢ "+x,"#357fbc","#000")}),K.stormy.watch(ve=>K.isStormy=ve),K.endEvent.watch(K.onEnd),s.list.set(x,K),K.log(K),K}function m(){if(!this.needUpdate)return;const{checkpoints:x,scene:S,storm:C}=this;if(this.isEnded)return;S.progress=this.progress,S.progressNormalized=this.progressNormalized;for(let v=0;v<x.length;v++){const $=x[v],P=this.progressNormalized>=$.position;P!==$.hasBeenReached&&($.hasBeenReached=P,this.lastCheckpoint=$,P&&(e.checkpoints.emit($.event),this.log("Checkpoint reached",$)))}_.$game.checkpoints.updateCheckpoints();let w=this._stormManual||this.progressNormalized>=C.nstart&&this.progressNormalized<=C.nend;if(w!==this.isStormy){const v=w?"Storm started":"Storm ended";this.stormy.emit(w),this.log(v)}_.$store.game.progress=this.progress,this.progressNormalized>=(this.name!=="starry_night"?.995:.994)&&!this.isEnded&&(this.needUpdate=!1,this.isEnded=!0,e.events.end.emit())}function g(){this.log("Level finished"),this.needUpdate=!1,this.isEnded=!0,_.$game.checkpoints.reset()}function y(){const{checkpoints:x}=this;this.progress=0,this.progressNormalized=0,this.lastCheckpoint=null,this.isEnded=!1,this.lose=!1,this.needUpdate=!0,this.isEndReached=!1;for(let S=0;S<x.length;S++)x[S].hasBeenReached=!1;e.events.reset.emit()}}const Mv=Object.assign({"./states/stateCinematic.js":op,"./states/stateEndGame.js":ap,"./states/stateGame.js":dp,"./states/stateIntro.js":hp,"./states/stateLose.js":fp,"./states/stateScore.js":pp,"./states/stateScoreLastLevel.js":mp}),Cv=Object.values(Mv).reduce((e,t)=>(e[t.default.name]=t.default,e),{}),qe=new Dn(60,1,1,2);qe.rotation.x=.06;qe.position.setScalar(0);qe.position.setZ(15);qe.resize=e=>{e=e??_.$renderer.drawingBufferSize.value,qe.aspect=e.x/e.y,qe.updateProjectionMatrix()};const ft=new k;new X;const kv=new k(0,1,0);let ba=!1,xa=!1;const Cs=(e=[],t=!0,s=!0,i=!0)=>e.reduce((n,o)=>(t&&(n[`before${Eo(o)}`]=he()),s&&(n[o]=he()),i&&(n[`after${Eo(o)}`]=he()),n),{}),Tv={high:{scale:1},medium:{scale:.75},low:{scale:.5}};function Ev(){const e={...Cs(["depthPass"],!0,!1,!0),...Cs(["envPass"],!0,!1,!0),...Cs(["bgPass"],!0,!1,!0),...Cs(["reflectPass"],!0,!1,!0),...Cs(["mounted","unMounted"]),afterCameraResize:he(),afterGameStarted:he(),afterLevelStarted:he(),skyHasChanged:he()},t={start:he(),lose:he(),end:he(),reset:he(),score:he(),toEnd:he()},s={x:[-.05,.3],y:[0,1]},i=.6,n={seed:Ve(te(0),"game_seed"),rng:null,noise:null,paused:te(!1),replay:he(),isPaused:()=>!!n.paused.value,isPlaying:()=>!n.paused.value&&!n.needFirstTouch.value,needFirstTouch:te(!1),currentChapter:null,currentLevel:null,qualityScale:te(1),levels:{},score:te(0),player:null,playerLimits:{norm:{x:Ve(te(s.x),"game__playerLimit_normX"),y:Ve(te(s.y),"game__playerLimit_normY")},world:{x:[null,null],y:[null,null]}},cameraBounds:{x:[0,0],y:[0,0]},tutoCameraBounds:{x:[0,0],y:[0,0]},fc:new il,state:null,setState:null,utils:{worldToScreen:f,screenToWorld:Vs,toNDC:b,toSC:p,computePlayerWorldLimits:g,unitWorldToScreen:te(1),screen:{top:0,right:0,bottom:0,left:0}},gravity:Ve(te(-.3),"game_gravity"),speed:Ve(te(.03),"game_speed"),elevationForce:Ve(te(1),"game_elevationForce"),vel:new X,acc:new X,slowdownTimer:0,slowdownFactor:0,beforeSlowdownTimer:0,limitThreshold:Ve(te(2),"game_limitThreshold"),limitSlowdownMalus:Ve(te(3),"game_limitSlowdownMalus"),durationBeforeSlowdown:Ve(te(2.5),"game_durationBeforeSlowdown"),durationSlowdown:Ve(te(10),"game_durationBeforeSlowdown"),isSlowingDown:!1,defaultDepthMaterial:new yc({depthPacking:bc,name:"DefaultDepthMaterial"}),depthPrepass:{value:null},bgTexture:{value:null},isDepthPrepass:!1,sceneTexture:{value:null},cloudsTexture:{value:null},cloudsAlphaTexture:{value:null},cloudsDepthTexture:{value:null},playerTexture:{value:null},playerDepthTexture:{value:null},collidableTexture:{value:null},fireworksTexture:{value:null},isStormy:!1,stormProgressUniform:{value:0},skipRenderEnvironment:!1,registerBackground:!1,isRenderingBackground:!1,envMap:null,cubeRT:new xc(32,{depthBuffer:!1}),matcaps:{env:new bt(128,128,{minFilter:As,depthBuffer:!1})},hooks:e,events:t,start:o,resize:a,update:l,reset:r,boost:h,boostFactor:0,boostDuration:.5,boostInitialFactor:.01,boostInitialDuration:.3,speedUp:d,goToNextLevel:u,updateQuality:c,buffers:[],...An("game","#f9ba56","#000")};async function o(){_.$viewport.changed.watch(a),a(),!ba&&(ba=!0,n.started=!0,n.levels.init(),n.state.init(),vp(_,n),_p(_,n),yp(_,n),bp(_,n),e.afterGameStarted.emit(),n.events.lose.watch(async()=>{var S;const{currentLevel:y,state:x}=n;y.lose=!0,await((S=_.transition)==null?void 0:S.inSimple("black")),n.state.set("Lose",{force:!0})}),n.events.end.watch(async()=>{var y;n.currentLevel.name!=="starry_night"?(await _.$transition.inSimple(),n.state.set("Cinematic",{force:!0})):(await((y=_.transition)==null?void 0:y.inSimple("white",.5)),n.state.set("ScoreLastLevel",{force:!0}))}))}function a(){qe.resize(),m(),g(),n.state.resize()}function r(){n.needFirstTouch.set(!0)}function l(){if(n.paused.value)return;const{currentLevel:y,state:x}=n;n.fc.computeProjection();const S=_.$time.dt*.001;x&&x.update(S),y&&y.update()}function c(y="high"){const{scale:x}=Tv[y];n.qualityScale.set(x),n.buffers.forEach(S=>{const{width:C,height:w}=S.originalSize||S;S.setSize(C*x,w*x)})}n.envMap=n.cubeRT.texture,_.rng=n.rng=H.create(n.seed.value),_.noise=n.noise=_r(n.rng.random),n.state=gp({initial:"Intro",game:n,states:Cv}),n.setState=n.state.set,n.state.init=()=>{var y,x;for(let S in n.state.states)(x=(y=n.state.states[S])==null?void 0:y._init)==null||x.call(y);as(n.state.start)};function u(y){let x=n.levels.next();if(y&&(x=n.levels.first()),!x)return;const S=x?_.getRouteFromLevel(x):"End";_.$app.$router.push({name:S})}function h(y=n.boostInitialFactor,x=n.boostInitialDuration){_.$store.boosting=!0,n.beforeSlowdownTimer=fe(n.durationBeforeSlowdown.value,.5,_.$game.isStormy),n.isSlowingDown=!1,n.boostFactor=y,n.boostFactor=Math.min(n.boostFactor,i),n.boostDuration=x}function d(y=1){n.beforeSlowdownTimer=be(.5+n.beforeSlowdownTimer,0,fe(2.5,.8,_.$game.isStormy)),n.slowdownTimer+=y}function f(y){return ft.copy(y),ft.z=Math.max(Number.EPSILON,ft.z),_.scene.camera.cam.updateMatrixWorld(),ft.project(_.scene.camera.cam),p(ft)}function b(y){const{width:x,height:S}=_.$viewport.size.value,C=Ye(y.x,0,x,-1,1),w=Ye(y.y,0,S,1,-1);return{x:C,y:w}}function p(y){const x=_.$viewport.size.value,S=Ye(y.x,-1,1,0,x.width),C=Ye(y.y,-1,1,x.height,0);return{x:S,y:C}}function m(){const{height:y}=_.$viewport.size.value;qe.resize(),qe.updateMatrixWorld(),ft.set(0,0,-qe.position.z),ft.add(kv).applyMatrix4(qe.matrixWorld);const x=f(ft),S=y/2-x.y;n.utils.unitWorldToScreen.set(S)}function g(){const{playerLimits:y,cameraBounds:x,tutoCameraBounds:S}=n;_.$viewport.size.value;const C=_.$game.currentChapter.camera.cam;let w=hr(C.fov),v=2*Math.tan(w/2)*_.$store.game.camera.main.limits.min,$=v*C.aspect,P=2*Math.tan(w/2)*_.$store.game.camera.main.limits.max,T=P*C.aspect;x.x=[$/2,T/2],x.y=[v/2,P/2];let L=2*Math.tan(w/2)*_.$store.game.camera.tuto.limits.min,O=L*C.aspect,D=2*Math.tan(w/2)*_.$store.game.camera.tuto.limits.max,U=D*C.aspect;S.x=[O/2,U/2],S.y=[L/2,D/2]}return e.afterCameraResize.watch(a),n.replay.watch(()=>{n.state.set("Game",{force:!0})}),_.$viewport.visible.watch(y=>{y?n.paused.set(xa):(xa=n.paused.value,n.paused.set(!0))}),e.mounted.watch(()=>requestAnimationFrame(()=>{m(),g()})),function(){n.levels=$v(n),n.checkpoints=_m(n),_.$game=n}}let Sn,wa;const Pv=()=>Sn=!1;function Sa(){Sn=!0,clearTimeout(wa),wa=setTimeout(Pv,200)}function Lv(){_.hooks.afterPreload.watchOnce(i),_.hooks.beforeFrame.watch(a);let e=!1;const t={Space:!1,ArrowUp:!1},s={active:!1,turn:0,pressed:!1,keyboard:!0};Object.keys(t).reduce((r,l)=>(r[l]=1,r),{});function i(){_.$viewport.visible.watchImmediate(()=>s.needsReset=!0);const r=document.querySelector(".xp-wrapper"),l="addEventListener",c={passive:!1};r[l]("mouseleave",o,c),r[l]("touchstart",n,c),r[l]("touchend",o,c),r[l]("touchcancel",o,c),r[l]("mousedown",n,c),r[l]("mouseup",o,c)}function n(r){const l=!!r.changedTouches;if(l)Sa();else if(Sn)return;!l&&r.button!==0||(e=!0)}function o(r){const l=!!r.changedTouches;if(l)Sa();else if(Sn)return;!l&&r.button!==0||(e=!1)}function a(){const{$store:r}=_.$app,{keyboard:l}=_.$app.$controls,c=r.isOverlayVisible||r.isMenuOpen||r.isHeaderOpen,u=(e||l.keys.Space||l.keys.ArrowUp)&&!c;s.needsReset&&!u&&(s.needsReset=!1),s.pressed=u&&!s.needsReset}return function(){_.$controls=s}}function Av(){_.hooks.afterPreload.watchOnce(t),_.hooks.beforeFrame.watch(a);const e=_.transition={in:n,out:o,inSimple:s,outSimple:i};function t(){}async function s(r,l=.4){await _.transitionScene.inSimple(r,l)}async function i(r,l=.4){await _.transitionScene.outSimple(r,l)}async function n(r,l){await _.transitionScene.in(r,l)}async function o(r,l){await _.transitionScene.out(r,l)}function a(){}return function(){_.$transition=e}}function Ov(){const{$viewport:e}=_,t={camBoundaries:{horizontal:Ve(te(new X(-100,100)),"camBoundariesX"),vertical:Ve(te(new X(-250,30)),"camBoundariesY")},cloudsVelocity:0,velocity:new X,cameraVelocity:0,baseCloudsVelocity:.01,minGameVelocity:.04,maxGameVelocity:.1,upFireworks:!1,isTransitioning:!1,hasStartedGameOnce:!1,savedChapter:null,obstacleCollide:!1,boosting:!1,camera:{fov:39,game:{lerpZoom:0,zoomOut:0,lerp:.04,z:{min:12,max:24}}},deathProgress:0,game:{progress:0,countdown:te(null),basePos:{x:-30,y:0},tutoProgress:0,tuto:{limits:{min:-5,max:14}},main:{limits:{min:-5.4,max:16}},camera:{baseOffset:0,tuto:{limits:{min:12,max:24}},main:{limits:{min:16,max:32}},game:{zoomOut:0,lerpZoom:0,lerp:.04,shakeAmount:0,shakeFreq:0,shakeAmpl:0}}},collectedGems:[],safeZoneSize:5,layers:{SCENE:0,CLOUDS:1,COLLIDABLE:5,PLAYER:10,ENVMAP:11,MATCAPS:12},z:{scene:0,environment:2,storm:4,ld:5,player:6,particles:8,clouds:10},boundariesUniforms:null},{x:s,y:i}=t.camBoundaries.horizontal.get(),{x:n,y:o}=t.camBoundaries.vertical.get();t.boundariesUniforms={value:new ro(s,n,i,o)},t.desktopInfluence=te(0);const a=Math.PI/180*t.camera.fov,r=t.game.tuto.limits.max-t.game.tuto.limits.min+1;return t.game.camera.tuto.limits.max=r/2/Math.tan(a/2),e.ratio.watchImmediate(l=>{const c=ye(l,.8,1.3,0,1);t.desktopInfluence.set(c),t.game.main.limits.max=fe(16,10,c);const u=t.game.main.limits.max-t.game.main.limits.min+1;t.game.camera.main.limits.max=u/2/Math.tan(a/2)}),e.size.watchImmediate(({width:l})=>{const c=ye(l,375,1440,20,100),u=ye(l,375,1440,15,30);t.camBoundaries.horizontal.set({x:-c,y:c}),t.camBoundaries.vertical.set({x:t.camBoundaries.vertical.value.x,y:u})}),function(c){c.$store=t}}const Rv=H.random,De=H.randomFloat,Dv=H.randomInt,$a=new V(1,1,1),Ps=new k(0,0,1),$n=new wc,Ma=["wind_strip_blur_a","wind_strip_blur_b"],Iv={beforeAlloc:zv,particleEmitted:Fv,particleUpdated:Uv};function zv(e){e.batcherName=e.batcherName||e.batcherID||"trail"}function Fv(e,{position:t,duration:s=2e3,alpha:i=1,amplitude:n,speed:o,radius:a,amplitudeMult:r=1,speedMult:l=1,thicknessMult:c=1,trailLengthMult:u=1}){e.fksolver=!0,e.seed=Rv(),e.spriteId=Ma[Dv(0,Ma.length-1)],e.billboard=!0,e.duration=s+De(-500,500),e.delay=De(0,500),e.angle=De(0,Math.PI*2),e.amplitude=n??De(.1,.3),e.amplitude*=r,e.speed=o??De(1.2,3.25),e.speed*=l,e.radius=a??De(1.15,1.5),e.thickness=De(.05,.15),e.thickness*=c,e.trailLength=De(.05,.2),e.trailLength*=u,t?e.position.copy(t):e.position.set(0,0,0),$n.set(e.radius,e.angle,e.amplitude),Ps.setFromSpherical($n),e.position.add(Ps),e.position.x+=-3-De(0,.5),e.position.y+=De(-.5,.5),e.position.x+=De(-.7,.7),e.position.z+=De(-.3,.3),e.basePosition=e.position.clone(),e.randAlpha=De(.05,.5)*i,e.colorFrom.copy($a),e.colorTo.copy($a)}function Uv(e,t){const s=_.$time.dt*.001,i=_.$time.elapsed*.001,{progress:n,radius:o,angle:a,amplitude:r,speed:l,seed:c,position:u,basePosition:h}=e,d=ye(n,0,1,1,.1)*o;$n.set(d,a,r),Ps.setFromSpherical($n),u.y=h.y-Ps.y*.75,u.z=h.z-Ps.z*.75;const f=i*l+c*r+Math.PI*2*n,b=r*Ce(0,.5,n);u.y+=Math.sin(f)*b,u.z+=Math.cos(f)*b,u.x+=l*s,e.alpha=(Ce(.2,.4,e.progress)-Ce(.7,1,e.progress))*e.randAlpha}const Nv=Object.freeze(Object.defineProperty({__proto__:null,default:Iv},Symbol.toStringTag,{value:"Module"})),Bv=_r(),Ca=H.random,Jt=H.randomFloat,Vv=H.tossCoin,ka=e=>Jt(-e,e),Zv=new V(0,0,0),jv=new V(1,1,1),Hv=new k,Gv=new k,Wv=new k,qv=W(ne.inOutExpo),Yv=W(ne.inOutSine),Kv=W(ne.inOutExpo),Xv=W(ne.inOutSine),Qv=W(ne.inOutExpo),Jv=1,e2={beforeAlloc:t2,particleEmitted:s2,particleUpdated:n2};function t2(e){e.batcherName=e.batcherName||e.batcherID||"gem_emissive",e.brightness=e.brightness??.1}function s2(e,{color:t,position:s,duration:i=2500,delay:n=0}){e.seed=Ca()*100,e.spriteId="sparkle_"+(Vv(Ca())?"a":"c"),e.billboard=!0,e.duration=Math.max(0,i+Jt(-250,250)),e.delay=n,e.speedFactor=.2,e.alphaFrom=1,e.alphaTo=1,e.progressEase=Xv,e.alphaEase=qv,e.scaleEase=Yv,e.colorEase=Kv;const o=k.get();s&&Array.isArray(s)?o.fromArray(s):o.copy(s||Hv);const a=.1;e.position.set(ka(a),ka(a),0).add(o),o.release();const l=(e.angle=Jt(0,Math.PI*2))+Math.PI*.5,c=Math.sin(l)*.03;e.velocity=Gv.set(50,5.15,1),e.velocityDrag=Wv.set(c*.1,-c*.5,.1),e.useVelocityDragMult=!0;const u=Jt(.15,.35)*.75*.15;e.scaleFrom.setScalar(u),e.scaleFrom.multiplyScalar(Jt(.8,1.2)*.15),e.scaleTo=e.scaleFrom.clone().multiplyScalar(Jt(.6,.7)*.15);const h=V.get();t?h.set(t):h.copy(jv),e.colorFrom.copy(h),e.colorTo.copy(Zv),h.release()}function n2(e,t){const n=_.$time.dt*.0015,o=_.$time.pausedElapsed*.001;e.speedFactor+=n;const a=Jv*Qv(e.speedFactor);e.angle+=Bv(e.seed,o*.2)*.08;const r=e.angle+Math.PI*.5;e.position.x+=Math.cos(r)*.03*a*n*83;const l=Math.sin(r)*.03;e.position.y+=l*a*n*83,e.colorFrom.offsetHSL(0,0,t.brightness*n)}const i2=Object.freeze(Object.defineProperty({__proto__:null,default:e2},Symbol.toStringTag,{value:"Module"}));H.random;const ks=H.randomFloat;H.tossCoin;const o2=new V(1,1,1);new V(0,0,0);const Ta=new k,a2=W(ne.inOutCubic),r2={beforeAlloc:l2,particleEmitted:c2,particleUpdated:u2};function l2(e){e.batcherName=e.batcherName||e.batcherID||"gem_emissive",e.brightness=e.brightness??.2}function c2(e,{color:t,position:s,duration:i=500+ks(0,1e3),alpha:n=1,newAlpha:o=1,baseScale:a=0,isGlowy:r=!1,vel:l=0,spriteId:c="glow-denser"}){e.spriteId=c,e.billboard=!0,e.duration=i,s&&Array.isArray(s)?e.position.fromArray(s):e.position.copy(s||Ta);const u=ks(-.1,.25);e.position.y+=u,e.position.x+=ks(-.25*.1,.25*.1)*10,e.position.z+=ks(-.25*.1,.25*.1)*20,r&&e.position.copy(s||Ta),e.baseScale=a=a||ks(.01*.15,.015*.15),e.scaleFrom.setScalar(a),e.scaleTo.copy(e.scaleFrom).multiplyScalar(0),e.velocity.y=l||H.randomFloat(.15,.3),r||_.$particles.emit("gem_idle",{batcher:"gem_emissive",amount:1,billboard:!0,position:e.position,vel:e.velocity.y,isGlowy:!0,duration:i,baseScale:a*1,spriteId:"flash"}),e.alphaFrom=0,e.alphaTo=r?.1:1;const h=V.get();t?h.set(t):h.copy(o2),e.colorEase=a2,h.release()}function u2(e,t){const s=_.noise(1,e.baseScale*10+_.$time.elapsed*e.baseScale*.3);e.velocity.x=Math.sin(s)*1,e.velocity.y=Math.cos(s)*.8}const d2=Object.freeze(Object.defineProperty({__proto__:null,default:r2},Symbol.toStringTag,{value:"Module"})),h2="string";class f2{constructor({thickness:t=.1,trailDamping:s=60,trailLength:i=.1,fk:n=!1,color:o=16777215,alpha:a=1,parent:r=null,position:l=new k,scale:c=1,visible:u=!0,amountPoints:h=8,...d}){se(this,"isTrail",!0);if(this.webgl=St(),d.batcher){const f=typeof d.batcher===h2?this.webgl.$particles.batchers[d.batcher]:d.batcher;f.isTrailBatcher?(this.batcher=f,this.atlas=d.atlas=this.batcher.atlas):console.warn("TrailInstance: batcher is not a TrailBatcher")}this.position=new k().copy(l),this._prevPosition=this.position.clone(),this.scale=typeof c=="number"?new k().setScalar(c):new k().copy(c),this.quaternion=new Re,this.color=new V().set(o),this.alpha=a,this.initialAlpha=this.alpha,this.parent=r,this.matrix=new Fe,this.amountPoints=h,this.thickness=t,this.trailDamping=s,this.trailLength=i,this.fksolver=n,this.points=Array(this.amountPoints).fill().map(()=>new k),this.sprite=new qr({...d,id:d.sprite||d.id,parent:this}),this.visible=u,this.addToBatcher(),this.resetTrail(),this.update()}resetTrail(){if(!this.batcher)return;const{data:t}=this.batcher.dataCurve.source.data,s=this.index*this.amountPoints*4;this.points.forEach(i=>i.copy(this.position));for(let i=0;i<this.amountPoints;i++)t[s+i*4+0]=this.position.x,t[s+i*4+1]=this.position.y,t[s+i*4+2]=this.position.z,t[s+i*4+3]=1}addToBatcher(){this.addedToBatcher||!this.batcher||(this.batcher.add(this),this.addedToBatcher=!0)}removeFromBatcher(){!this.addedToBatcher||!this.batcher||(this.batcher.remove(this),this.addedToBatcher=!1)}is(t){return this===t}update(){if(this.webgl.$game.isPaused())return;const t=this.webgl.$time.stableDt,s=this.batcher,{data:i}=s.dataCurve.source.data,n=s.currentCount,o=s.currentCount*this.amountPoints*4;this.index=s.currentCount;const{meshCoords:a,texCoords:r}=this.sprite.frame,{texCoords:l,meshCoords:c,alpha:u,indexes:h,thickness:d}=s.geo.attributes;this.matrix.compose(this.position,this.quaternion,this.scale),this.parent&&this.matrix.multiply(this.parent.matrixWorld);for(let f=0;f<this.amountPoints;f++){const b=Ea.copy(f===0?this.position:this.points[f-1]),p=this.points[f];if(this.fksolver)_o(p,b,this.trailLength/this.amountPoints);else{const g=this.trailDamping;p.damp(b,g,this.webgl.$time.dt*.001)}const m=Ea.copy(p);this.parent&&m.applyMatrix4(this.parent.matrixWorld),i[o+f*4+0]=m.x,i[o+f*4+1]=m.y,i[o+f*4+2]=m.z,i[o+f*4+3]=1}u.setX(n,this.alpha),l.setXYZW(n,...r),c.setXYZW(n,...a),d.setX(n,this.thickness),h.setX(n,this.index),s.base.setMatrixAt(n,this.matrix),s.base.setColorAt(n,this.color),this.sprite.update(t),this._prevPosition.setFromMatrixPosition(this.matrix)}destroy(){this.removeFromBatcher(),this.sprite&&this.sprite.destroy(),this.sprite=this.batcher=null,this.props=null}}const Ea=new k;new k;new Fe;class p2 extends f2{constructor(s){super(s);se(this,"isTrailParticle",!0);this.batcher&&this.batcher.remove(this),this.spriteId=null,this.spriteFrame=0,this.spriteFrameDuration=50,this.spriteLoop=!1,this.spriteAutoplay=!1,this.rotation=new It,this.delay=0,this.duration=0,this.age=0,this.timeScale=1,this.progress=0,this.onStart=null,this.onProgress=null,this.onComplete=null,this.onEnd=null,this.angVelocity=0,this.angVelocityDrag=0,this.velocity=new k,this.velocityDrag=new k,this.velocityDragMult=new k,this.useVelocityDragMult=!1,this.scaleWithVel=!1,this.gravity=new k,this.scaleFrom=new X,this.scaleTo=new X,this.colorFrom=new V,this.colorTo=new V,this.alphaFrom=1,this.alphaTo=1,this.alive=!1,this.killable=!1,this.progressEase=W(),this.scaleEase=W(),this.alphaEase=W(),this.colorEase=W(),this.scaleVelEase=W([0,1,.5,1])}reset(){this.alive&&this.onRelease&&this.onRelease(),this.preset&&this.preset.particleReleased&&this.preset.particleReleased(this,this.presetOptions),this.parent=null,this.preset=Mi,this.spriteId=null,this.spriteFrame=0,this.timeScale=1,this.spriteFrameDuration=50,this.spriteLoop=!1,this.spriteAutoplay=!1,this.billboard=!1,this.angle=0,this.quaternion.copy(m2),this.rotation.set(0,0,0),this.position.setScalar(0),this.scale.setScalar(1),this.delay=0,this.duration=1e3,this.age=0,this.progress=0,this.onStart=null,this.onProgress=null,this.onComplete=null,this.onRelease=null,this.angVelocity=0,this.angVelocityDrag=0,this.velocity.setScalar(0),this.velocityDrag.setScalar(0),this.useVelocityDragMult=!1,this.scaleWithVel=!1,this.scaleInOut=!1,this.gravity.setScalar(0),this.scaleFrom.setScalar(1),this.scaleTo.setScalar(1),this.colorFrom.setRGB(255,255,255,"srgb-linear"),this.colorTo.setRGB(255,255,255,"srgb-linear"),this.alphaFrom=1,this.alphaTo=1,this.alphaInOut=!1,this.progressEase=W(),this.scaleEase=W(),this.alphaEase=W(),this.colorEase=W(),this.scaleVelEase=W([.7,.3,.2,.2]),this.resetTrail()}emit(s,i={},n={},o){this.reset();const{parent:a=this.parent,trailDamping:r=this.trailDamping,thickness:l=this.thickness,trailLength:c=this.trailLength,fk:u=this.fksolver}=n;this.batcher=s,this.spriteId=this.killable=!1,this.alive=!0,this.timeScale=1,this.index=o,this.parent=a,this.preset=i??Mi,this.presetOptions=n??Mi,this.trailDamping=pi(r),this.thickness=pi(l),this.trailLength=pi(c),this.fksolver=u,this.preset.particleEmitted&&this.preset.particleEmitted(this,this.presetOptions),this.sprite.setAtlas(this.batcher.atlas),this.sprite.change({id:this.spriteId,frame:this.spriteFrame,frameDuration:this.spriteFrameDuration,loop:this.spriteLoop,autoplay:this.spriteAutoplay}),this.resetTrail(),this.batcher.add(this),this.sprite.update(1),this.update(),this.onStart&&this.onStart(this)}update(){if(!this.alive||this.killable||this.webgl.$game.isPaused())return;const s=this.batcher,i=s.currentCount,n=s.currentCount*this.amountPoints*4,{data:o}=s.dataCurve.source.data;this.index=s.currentCount;const{meshCoords:a,texCoords:r}=this.sprite.frame,{texCoords:l,meshCoords:c,alpha:u,indexes:h,thickness:d}=s.geo.attributes;Ci.compose(this.position,this.quaternion,this.scale);const f=this.isDelaying||this.killable;f&&this.resetTrail(),this.parent&&Ci.multiply(this.parent.matrixWorld);for(let b=0;b<this.amountPoints;b++){const p=Pa.copy(b===0||f?this.position:this.points[b-1]),m=this.points[b];if(this.fksolver)_o(m,p,this.trailLength);else{const y=f?1e3:this.trailDamping;m.damp(p,y,this.webgl.$time.stableDt*.001*this.timeScale)}const g=Pa.copy(m);this.parent&&g.applyMatrix4(this.parent.matrixWorld),o[n+b*4+0]=g.x,o[n+b*4+1]=g.y,o[n+b*4+2]=g.z,o[n+b*4+3]=1}u.setX(i,this.alpha),l.setXYZW(i,...r),c.setXYZW(i,...a),d.setX(i,this.thickness),h.setX(i,this.index),s.base.setMatrixAt(i,Ci),s.base.setColorAt(i,this.color),this.updatePhysics()}updatePhysics(){if(!this.alive||this.killable)return;if(this.progress>=1)return this.killable=!0;let s=this.webgl.$time.dt;if(this.delay>0)if(this.delay-=s,this.delay>0){this.alpha=0,this.scale.setScalar(g2);return}else s=Math.max(0,s+this.delay);this.sprite.update(s);const i=this.webgl.$time.dt*.001*this.timeScale;if(this.age+=s,this.progress=this.progressEase(be(this.age/this.duration,0,1)),this.preset.particleUpdate)this.preset.particleUpdate(this,this.presetOptions);else{if(this.useVelocityDragMult)this.velocity.multiply(this.velocityDrag),this.velocity.lengthSq()<1e-4&&this.velocity.setScalar(0);else{if(this.velocity.x){const n=Math.sign(this.velocity.x);this.velocity.x-=n*this.velocityDrag.x*i,Math.sign(this.velocity.x)!==n&&(this.velocity.x=0)}if(this.velocity.y){const n=Math.sign(this.velocity.y);this.velocity.y-=n*this.velocityDrag.y*i,Math.sign(this.velocity.y)!==n&&(this.velocity.y=0)}if(this.velocity.z){const n=Math.sign(this.velocity.z);this.velocity.z-=n*this.velocityDrag.z*i,Math.sign(this.velocity.z)!==n&&(this.velocity.z=0)}}if(this.velocity.addScaledVector(this.gravity,i),this.angVelocity){const n=Math.sign(this.angVelocity);this.angVelocity-=n*this.angVelocityDrag*i,Math.sign(this.angVelocity)!==n&&(this.angVelocity=0)}this.position.x+=this.velocity.x*i,this.position.y+=this.velocity.y*i,this.position.z+=this.velocity.z*i,this.billboard?(this.angle+=this.angVelocity*i,this.angleTo&&(this.angle=fe(this.angleFrom,this.angleTo,this.progress))):this.rotation.z+=this.angVelocity*i,this.scaleWithVel?this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleVelEase(this.progress)):this.scaleInOut?this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleEase((this.progress>.5?1-this.progress:this.progress)*2)):this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleEase(this.progress)),this.color.copy(this.colorFrom).lerp(this.colorTo,this.colorEase(this.progress)),this.alphaInOut?this.alpha=fe(this.alphaFrom,this.alphaTo,this.alphaEase((this.progress>.5?1-this.progress:this.progress)*2)):this.alpha=fe(this.alphaFrom,this.alphaTo,this.alphaEase(this.progress))}this.preset.particleUpdated&&this.preset.particleUpdated(this,this.presetOptions),this.onProgress&&this.onProgress(this,this.progress)}kill(){this.killable&&this.preset.particleKilled&&this.preset.particleKilled(this,this.presetOptions),this.killable&&this.onComplete&&this.onComplete(this),this.batcher&&(this.batcher.remove(this),this.batcher=null),this.reset(),this.progress=1,this.alive=!1,this.killable=!1}}const m2=new Re,g2=1/Number.MAX_SAFE_INTEGER,Mi={},Pa=new k,Ci=new Fe,v2=new Re,_2=1/Number.MAX_SAFE_INTEGER,ki={};new Oe;let on;class y2 extends _t{constructor(s){s.useEuler=!0;super(s);se(this,"isParticle",!0);on||(on=St()),this.batcher&&this.batcher.removeInstance(this),this.spriteId=null,this.isParticle=!0,this.spriteFrame=0,this.spriteFrameDuration=50,this.spriteLoop=!1,this.spriteAutoplay=!1,this.rotation=new It,this.delay=0,this.duration=0,this.age=0,this.progress=0,this.onStart=null,this.onProgress=null,this.onComplete=null,this.onEnd=null,this._started=!1,this.angVelocity=0,this.angVelocityDrag=0,this.velocity=new k,this.velocityDrag=new k,this.velocityDragMult=new k,this.useVelocityDragMult=!1,this.scaleWithVel=!1,this.timeScale=1,this.gravity=new k,this.scaleFrom=new X,this.scaleTo=new X,this.colorFrom=new V,this.colorTo=new V,this.alphaFrom=1,this.alphaTo=1,this.alive=!1,this.killable=!1,this.progressEase=W(),this.scaleEase=W(),this.alphaEase=W(),this.colorEase=W(),this.scaleVelEase=W([0,1,.5,1])}reset(){this.alive&&this.onRelease&&this.onRelease(),this.preset&&this.preset.particleReleased&&this.preset.particleReleased(this,this.presetOptions),this.parent=null,this.preset=ki,this.spriteId=null,this.spriteFrame=0,this.timeScale=1,this.spriteFrameDuration=50,this.spriteLoop=!1,this.spriteAutoplay=!1,this.billboard=!1,this.angle=0,this.quaternion.copy(v2),this.rotation.set(0,0,0),this.position.setScalar(0),this.scale.setScalar(1),this.delay=0,this.duration=1e3,this.age=0,this.progress=0,this.onStart=null,this.onProgress=null,this.onComplete=null,this.onRelease=null,this.angVelocity=0,this.angVelocityDrag=0,this.velocity.setScalar(0),this.velocityDrag.setScalar(0),this.useVelocityDragMult=!1,this.scaleWithVel=!1,this.scaleInOut=!1,this.gravity.setScalar(0),this.scaleFrom.setScalar(1),this.scaleTo.setScalar(1),this.colorFrom.setRGB(255,255,255,"srgb-linear"),this.colorTo.setRGB(255,255,255,"srgb-linear"),this.alphaFrom=1,this.alphaTo=1,this.alphaInOut=!1,this.progressEase=W(),this.scaleEase=W(),this.alphaEase=W(),this.colorEase=W(),this.scaleVelEase=W([.7,.3,.2,.2])}emit(s,i={},n={},o){this.reset(),this.batcher=s,this.spriteId=this.killable=!1,this.alive=!0,this.timeScale=1,this.index=o,this.billboard=n.billboard??!1,this.parent=n.parent,this._started=!1,this.preset=i??ki,this.presetOptions=n??ki,this.zIndex=n.zIndex??0,this.preset.particleEmitted&&this.preset.particleEmitted(this,this.presetOptions),this.sprite.setAtlas(this.batcher.atlas),this.sprite.change({id:this.spriteId,frame:this.spriteFrame,frameDuration:this.spriteFrameDuration,loop:this.spriteLoop,autoplay:this.spriteAutoplay}),this.batcher.addInstance(this),this.sprite.update(1),this.update(0)}kill(){this.killable&&this.preset.particleKilled&&this.preset.particleKilled(this,this.presetOptions),this.killable&&this.onComplete&&this.onComplete(this),this.batcher&&(this.batcher.removeInstance(this),this.batcher=null),this.reset(),this.progress=1,this.alive=!1,this.killable=!1}update(){if(!this.alive||this.killable||this.webgl.$game.isPaused())return;if(this.progress>=1)return this.killable=!0;let s=on.$time.dt;if(this.delay>0)if(this.delay-=s,this.delay>0){this.alpha=0,this.scale.setScalar(_2),this._started=!1;return}else s=Math.max(0,s+this.delay);this._started||(this._started=!0,this.onStart&&this.onStart(this)),super.update(s);const i=on.$time.dt*.001*this.timeScale;if(this.age+=s,this.progress=this.progressEase(be(this.age/this.duration,0,1)),this.preset.particleUpdate)this.preset.particleUpdate(this,this.presetOptions);else{if(this.useVelocityDragMult)this.velocity.multiply(this.velocityDrag),this.velocity.lengthSq<1e-4&&this.velocity.setScalar(0);else{if(this.velocity.x){const n=Math.sign(this.velocity.x);this.velocity.x-=n*this.velocityDrag.x*i,Math.sign(this.velocity.x)!==n&&(this.velocity.x=0)}if(this.velocity.y){const n=Math.sign(this.velocity.y);this.velocity.y-=n*this.velocityDrag.y*i,Math.sign(this.velocity.y)!==n&&(this.velocity.y=0)}if(this.velocity.z){const n=Math.sign(this.velocity.z);this.velocity.z-=n*this.velocityDrag.z*i,Math.sign(this.velocity.z)!==n&&(this.velocity.z=0)}}if(this.velocity.addScaledVector(this.gravity,i),this.angVelocity){const n=Math.sign(this.angVelocity);this.angVelocity-=n*this.angVelocityDrag*i,Math.sign(this.angVelocity)!==n&&(this.angVelocity=0)}this.position.x+=this.velocity.x*i,this.position.y+=this.velocity.y*i,this.position.z+=this.velocity.z*i,this.billboard?(this.angle+=this.angVelocity*i,this.angleTo&&(this.angle=fe(this.angleFrom,this.angleTo,this.progress))):this.rotation.z+=this.angVelocity*i,this.scaleWithVel?this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleVelEase(this.progress)):this.scaleInOut?this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleEase((this.progress>.5?1-this.progress:this.progress)*2)):this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleEase(this.progress)),this.color.copy(this.colorFrom).lerp(this.colorTo,this.colorEase(this.progress)),this.alphaInOut?this.alpha=fe(this.alphaFrom,this.alphaTo,this.alphaEase((this.progress>.5?1-this.progress:this.progress)*2)):this.alpha=fe(this.alphaFrom,this.alphaTo,this.alphaEase(this.progress))}this.preset.particleUpdated&&this.preset.particleUpdated(this,this.presetOptions),this.onProgress&&this.onProgress(this,this.progress)}}const b2=150,dl={};let x2=0,Ti=0;function w2(e,t){t||(t={}),dl[e]=t}class La extends ke{constructor(t){super(t),t.batcher&&(t.batchers={default:t.batcher}),this.count=t.count||b2;const s=t.trails?p2:y2;this.dead=new Array(this.count).fill(0).map(()=>new s({})),this.alive=[],this.batchers=t.batchers||{},this.paused=!1,x2++}emit(t,s={},i){typeof s=="number"&&(s={amount:s});const n=s.amount=s.amount||1,o=dl[t];if(!o||(o.beforeAlloc&&o.beforeAlloc(s),s.amount<=0))return;const a=this.batchers[i]||this.batchers.default,r=this.alloc(n);o.beforeEmit&&o.beforeEmit(s,r);for(let l=r.length-1;l>=0;l--)r[l].alive||Ti++,this.alive.push(r[l]),r[l].emit(a,o,s,l);return r}update(t){if(this.paused)return;const s=[];for(let i=this.alive.length-1;i>=0;i--){const n=this.alive[i];n.update(t),n.killable&&(s.push(n),this.alive.splice(i,1),this.dead.push(n),Ti--)}for(let i=s.length-1;i>=0;i--)s[i].kill()}alloc(t){const s=this.dead,i=this.alive;let n=[],o=t;return s.length>0&&(n=s.splice(0,o)),o-=n.length,o>0&&(n=n.concat(i.splice(0,o))),n}killAll(){for(let t=this.alive.length-1;t>=0;t--)this.alive[t].kill(),this.dead.push(this.alive[t]),this.alive.splice(t,1),Ti--}registerPreset(t,s){w2(t,s)}}let S2=0;const $2=new vr,Ei=new Map,es=new Oe,M2=new Re,C2=new k;es.matrixAutoUpdate=!1;const Aa={default:Hi,normal:Hi,additive:Ns},Oa={double:mr,front:br,back:ao};class k2 extends ke{init(){const{atlas:t,count:s=200,geometry:i=$2,skipDepthPrepass:n=!0}=this.props;this.needsUpdate=!0,this.atlas=t,this.count=s,this.geo=new yr,this.geo.index=i.index,this.geo.attributes.position=i.attributes.position,this.geo.attributes.uv=i.attributes.uv,this.initAttributes(),this.layers=[],window.layers=this.layers,this.setDynamic(this.props.dynamic);const o=this.getMaterial(this.props);this.base=new In(this.geo,o),this.props.renderOrder&&(this.base.renderOrder=this.props.renderOrder),this.base.frustumCulled=!!this.props.frustumCulled,this.currentCount=0,this.updateAttributes=this.updateAttributes.bind(this),this.webgl.$game.hooks.beforeDepthPass.watch(()=>{n&&(this.base.visible=!1)}),this.webgl.$game.hooks.afterDepthPass.watch(()=>{n&&(this.base.visible=!0)})}setDynamic(t){this.dynamic=t==null?!0:!!t,this.interleavedBuffer.setUsage(this.dynamic?oo:Sc),this.interleavedBuffer.needsUpdate=!0,this.needsUpdate=!0}getMaterial({atlas:t,count:s,renderOrder:i,material:n,skipDepthPrepass:o,...a}){const r=n??cl;if(!r)return;Ei.has(r)||Ei.set(r,{});const l=Ei.get(r);if(!t)return;t.meta.atlasIndex==null&&(t.meta.atlasIndex=++S2);const c=[t.meta.atlasIndex,...Object.keys(a).sort().map(u=>u+":"+a[u])].join("|");return l[c]?l[c]:l[c]=new r({...a,atlas:t,side:Oa[a.side]??Oa.front,blending:typeof a.blending=="function"?a.blending:Aa[a.blending]??Aa.default,depthWrite:!!a.depthWrite,depthTest:!!a.depthTest,transparent:!!a.transparent,alphaTest:!!a.alphaTest})}initAttributes(){this.stride=4+4+3+2+4+4,this.buffer=new Float32Array(this.count*this.stride);const t=this.geo,s=this.interleavedBuffer=new $c(this.buffer,this.stride);t.setAttribute("texCoords",new Nt(s,4,0,!1)),t.setAttribute("meshCoords",new Nt(s,4,4,!1)),t.setAttribute("spritePos",new Nt(s,3,8,!1)),t.setAttribute("decorators",new Nt(s,2,11,!1)),t.setAttribute("spriteQt",new Nt(s,4,13,!1)),t.setAttribute("spriteColor",new Nt(s,4,17,!1)),s.needsUpdate=!0}updateAttributes(t){if(!t||!t.visible||t.alpha<.001)return;const s=t.billboard>0,i=this.currentCount++,n=this.buffer,o=this.stride,a=t.sprite.frame;let r=i*o;t.useEuler&&t.quaternion.setFromEuler(t.rotation);let l=t.position,c=t.quaternion,u=t.scale;if(t.parent){const d=t.parent;es.matrix.compose(l,s?M2:c,C2.set(u.x,u.y,1)),es.applyMatrix4(d.matrixWorld),l=es.position,c=es.quaternion,u=es.scale}const h=s?t.angle:c.x;n[r++]=a.texCoords[0],n[r++]=a.texCoords[1],n[r++]=a.texCoords[2],n[r++]=a.texCoords[3],n[r++]=a.meshCoords[0]*u.x,n[r++]=a.meshCoords[1]*u.y,n[r++]=a.meshCoords[2]*u.x,n[r++]=a.meshCoords[3]*u.y,n[r++]=l.x,n[r++]=l.y,n[r++]=l.z,n[r++]=s?t.billboard:t.fx2,n[r++]=t.fx,n[r++]=h,n[r++]=c.y,n[r++]=c.z,n[r++]=c.w,n[r++]=t.color.r,n[r++]=t.color.g,n[r++]=t.color.b,n[r++]=t.alpha}createLayers(t){for(let s=this.layers.length;s<=t;s++)this.layers[s]||(this.layers[s]=new Set)}addInstance(t){const s=t.zIndex||0;this.layers[s]==null&&this.createLayers(s);const i=this.layers[s];i.has(t)||i.add(t)}removeInstance(t){const s=t.zIndex||0;this.layers[s]==null&&this.createLayers(s);const i=this.layers[s];i.has(t)&&i.delete(t)}update(){if(this.dynamic){this.currentCount=0;for(let t=0;t<this.layers.length;t++)this.layers[t].forEach(this.updateAttributes);this.geo.instanceCount=this.currentCount,this.interleavedBuffer.needsUpdate=!0,this.base&&(this.base.visible=!!this.currentCount)}}clearInstances(){for(let t=0;t<this.layers.length;t++)this.layers[t].clear()}destroy(){this.clearInstances(),this.geo.dispose(),super.destroy()}}const T2=k2;function Pi(e,t,s,i,n){let o,a=e.subarray||e.slice?e:e.buffer;const r=s.subarray||s.slice?s:s.buffer;if(a=t?a.subarray?a.subarray(t,n&&t+n):a.slice(t,n&&t+n):a,r.set)r.set(a,i);else for(o=0;o<a.length;o++)r[o+i]=a[o];return r}function E2(e){return e instanceof Float32Array?e:e instanceof cs?e.getAttribute("position").array:e.map(t=>{const s=Array.isArray(t);return t instanceof k?[t.x,t.y,t.z]:t instanceof X?[t.x,t.y,0]:s&&t.length===3?[t[0],t[1],t[2]]:s&&t.length===2?[t[0],t[1],0]:t}).flat()}class P2 extends cs{constructor(){super();se(this,"type","MeshLine");se(this,"isMeshLine",!0);se(this,"positions",[]);se(this,"previous",[]);se(this,"next",[]);se(this,"side",[]);se(this,"width",[]);se(this,"indices_array",[]);se(this,"uvs",[]);se(this,"counters",[]);se(this,"widthCallback",null);se(this,"_points",[]);se(this,"points");se(this,"matrixWorld",new Fe);Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(s){this.setPoints(s,this.widthCallback)}}})}setMatrixWorld(s){this.matrixWorld=s}setPoints(s,i){const n=E2(s);if(this._points=n,this.widthCallback=i??null,this.positions=[],this.counters=[],n.length&&n[0]instanceof k)for(let o=0;o<n.length;o++){const a=n[o],r=o/(n.length-1);this.positions.push(a.x,a.y,a.z),this.positions.push(a.x,a.y,a.z),this.counters.push(r),this.counters.push(r)}else for(let o=0;o<n.length;o+=3){const a=o/(n.length-1);this.positions.push(n[o],n[o+1],n[o+2]),this.positions.push(n[o],n[o+1],n[o+2]),this.counters.push(a),this.counters.push(a)}return this.process(),this}compareV3(s,i){const n=s*6,o=i*6;return this.positions[n]===this.positions[o]&&this.positions[n+1]===this.positions[o+1]&&this.positions[n+2]===this.positions[o+2]}copyV3(s){const i=s*6;return[this.positions[i],this.positions[i+1],this.positions[i+2]]}process(){const s=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let i,n;this.compareV3(0,s-1)?n=this.copyV3(s-2):n=this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let o=0;o<s;o++){if(this.side.push(1),this.side.push(-1),this.widthCallback?i=this.widthCallback(o/(s-1)):i=1,this.width.push(i),this.width.push(i),this.uvs.push(o/(s-1),0),this.uvs.push(o/(s-1),1),o<s-1){n=this.copyV3(o),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const a=o*2;this.indices_array.push(a,a+1,a+2),this.indices_array.push(a+2,a+1,a+3)}o>0&&(n=this.copyV3(o),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}this.compareV3(s-1,0)?n=this.copyV3(1):n=this.copyV3(s-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),!this._attributes||this._attributes.position.count!==this.positions.length?this._attributes={position:new tt(new Float32Array(this.positions),3),previous:new tt(new Float32Array(this.previous),3),next:new tt(new Float32Array(this.next),3),side:new tt(new Float32Array(this.side),1),width:new tt(new Float32Array(this.width),1),uv:new tt(new Float32Array(this.uvs),2),index:new tt(new Uint16Array(this.indices_array),1),counters:new tt(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:s,y:i,z:n}){const o=this._attributes.position.array,a=this._attributes.previous.array,r=this._attributes.next.array,l=o.length;Pi(o,0,a,0,l),Pi(o,6,o,0,l-6),o[l-6]=s,o[l-5]=i,o[l-4]=n,o[l-3]=s,o[l-2]=i,o[l-1]=n,Pi(o,6,r,0,l-6),r[l-6]=s,r[l-5]=i,r[l-4]=n,r[l-3]=s,r[l-2]=i,r[l-1]=n,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const L2=`#include <common>
#include <logdepthbuf_pars_vertex>
attribute mat4 instanceMatrix;
attribute vec3 instanceColor;
attribute vec4 texCoords;
attribute vec4 meshCoords;
attribute vec2 uv;
attribute float side;
attribute float alpha;
attribute float indexes;
attribute float counters;
attribute float width;
attribute float thickness;
uniform vec2 resolution;
uniform vec2 texSize;
uniform float sizeAttenuation;
uniform sampler2D curve;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
varying vec2 vUv;
varying vec4 vColor;
varying float vCounters;
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
  vCounters = counters;
    return res;
  }
void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4( instanceColor, alpha );
    vUv = uv * texCoords.zw + texCoords.xy;
    float stp         = 1. / texSize.x;
float stpY        = 1. / texSize.y;
    float instanceIdx = indexes / (texSize.y - stpY);
    vec3 curvePos     = texture2D(curve, vec2(counters, instanceIdx)).xyz;
    vec3 prevCurvePos = texture2D(curve, vec2(max(0., counters - stp), instanceIdx)).xyz;
    vec3 nextCurvePos = texture2D(curve, vec2(min(1., counters + stp), instanceIdx)).xyz;
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 originPositon = m * vec4( vec3(0), 1.0 );
    vec4 finalPosition = m * vec4( curvePos, 1.0 );
    vec4 prevPos       = m * vec4( prevCurvePos, 1.0 );
    vec4 nextPos       = m * vec4( nextCurvePos, 1.0 );
    vec2 originP  = fix( originPositon, aspect );
    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP    = fix( prevPos, aspect );
    vec2 nextP    = fix( nextPos, aspect );
    mat4 im = instanceMatrix;
    vec3 scale = vec3(
      length(vec3(im[0][0], im[0][1], im[0][2])),
      length(vec3(im[1][0], im[1][1], im[1][2])),
      length(vec3(im[2][0], im[2][1], im[2][2]))
    );
    float w = thickness * width;
    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );
        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
    }
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution.xy, 0., 1.) * projectionMatrix).xy;
    }
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
}`,A2=re(L2,"vertexShader"),O2=`precision highp float;
#define PI 3.141592653589793
uniform sampler2D atlas;
uniform vec3 uGradientColor;
varying vec2 vUv;
varying vec4 vColor;
float sineInOut(float t) {
  return -0.5 * (cos(PI * t) - 1.0);
}
void main() {
vec2 uv = vUv;
vec4 color = texture2D(atlas, uv);
float alpha = color.a * vColor.a;
if (alpha == 0.0) discard;
vec3 outputColor = vColor.rgb * color.rgb;
gl_FragColor = vec4(outputColor, alpha);
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,R2=re(O2,"fragmentShader");class D2 extends zn{constructor(s={}){const{uniforms:i,...n}=s;super({...n});se(this,"name","TrailMaterial");this.uniforms={...i||{}},this.dithering=!0,A2.use(this),R2.use(this)}}let Li=0;const Ra=new Map,I2={normal:Hi,additive:Ns};class z2 extends ke{constructor(){super(...arguments);se(this,"isTrailBatcher",!0)}init(){const{atlas:s,material:i=D2,maxLength:n=8,count:o=100,skipDepthPrepass:a,renderOrder:r,...l}=this.props;this.baseMaterial=i,this.atlas=s,this.maxLength=n,this.instances=[],this.maxCount=o,this.currentCount=0,this.initTexture(),this.initGeometry(),this.initMaterial(),this.base=new Rn(this.geo,this.mat,o),this.base.frustumCulled=!1,this.base.instanceMatrix.needsUpdate=!0,r&&(this.base.renderOrder=r),this.webgl.$game.hooks.beforeDepthPass.watch(()=>this.base.visible=!a),this.webgl.$game.hooks.afterDepthPass.watch(()=>this.base.visible=a)}initTexture(){const s=this.maxLength*this.maxCount,i=new Float32Array(4*s);this.dataCurve=new dr(i,this.maxLength,this.maxCount,ar,Mc),this.dataCurve.minFilter=Vi,this.dataCurve.magFilter=Vi,this.dataCurve.needsUpdate=!0}initGeometry(){const s=[];for(let l=0;l<this.maxLength;l++){const c=l/(this.maxLength-1);s.push(new k(c,0,0))}this.baseGeometry=new P2,this.baseGeometry.setPoints(s),this.geo=new yr().copy(this.baseGeometry);const i=[],n=[],o=[],a=[],r=[];for(let l=0;l<this.maxCount;l++)n.push(0,0,0,0),o.push(0,0,0,0),a.push(1),i.push(1),r.push(0);this.geo.setAttribute("thickness",new Ot(new Float32Array(i),1)),this.geo.setAttribute("alpha",new Ot(new Float32Array(a),1)),this.geo.setAttribute("texCoords",new Ot(new Float32Array(n),4)),this.geo.setAttribute("meshCoords",new Ot(new Float32Array(o),4)),this.geo.setAttribute("indexes",new Ot(new Float32Array(r),1)),this.geo.deleteAttribute("position"),this.geo.deleteAttribute("next"),this.geo.deleteAttribute("previous")}initMaterial(){var f;const{depthWrite:s=!1,depthTest:i=!1,blending:n="normal",transparent:o=!0,alphaTest:a=0,uniforms:r={},side:l=br}=this.props,{texture:c=null,json:u}=this.atlas;((f=u==null?void 0:u.meta)==null?void 0:f.atlasIndex)===null&&(Li+=1,u.meta.atlasIndex=Li);const h=[Li,s.toString(),i.toString(),n.toString(),o.toString(),a.toString(),l.toString(),JSON.stringify(r)].join("_"),d=this.baseMaterial;this.mat=Ra.get(h)??new d({blending:I2[n],depthWrite:s,depthTest:i,transparent:o,alphaTest:a,side:l,uniforms:{curve:{value:this.dataCurve},atlas:{value:c},sizeAttenuation:{value:1},texSize:{value:[this.maxLength,this.maxCount]},time:this.webgl.uniforms.time,resolution:this.webgl.$viewport.size,...r}}),Ra.set(h,this.mat)}add(...s){return s.forEach(i=>{this.instances.includes(i)||this.instances.push(i),this.sortInstances()}),s}remove(...s){return s.forEach(i=>{const n=this.instances.indexOf(i);n!==-1&&this.instances.splice(n,1),this.sortInstances()}),s}update(){const{texCoords:s,meshCoords:i,alpha:n,thickness:o,indexes:a}=this.geo.attributes;this.currentCount=0,this.instances.forEach(r=>this.updateInstance(r)),this.base.instanceMatrix.needsUpdate=!0,this.base.instanceColor&&(this.base.instanceColor.needsUpdate=!0),n.needsUpdate=!0,s.needsUpdate=!0,i.needsUpdate=!0,o.needsUpdate=!0,a.needsUpdate=!0,this.count=this.currentCount,this.dataCurve.needsUpdate=!0,this.base&&(this.base.visible=!!this.currentCount)}updateInstance(s){!s||!s.visible||s.alpha<.001||(s.update(),this.currentCount+=s.instanceCount??1)}get count(){return this._count}set count(s){this._count=Math.min(this.maxCount,s),this.base.count=this._count}clearInstances(){this.instances.length=0,this.count=0,this.update()}sortInstances(){this.instances.sort((s,i)=>s.renderOrder-i.renderOrder)}destroy(){this.clearInstances(),this.geo.dispose(),super.destroy()}}const F2={blending:"normal",transparent:!0,depthWrite:!1,depthTest:!1,useAlphaSDF:!0,count:100};function U2(){let e,t,s=!1,i=!1,n=[];const o={};let a=[],r=[];const l={init:c,emit:d,update:C,addTo:b,removeFromParent:p,registerBatcher:h,paused:S,batchers:o,getBatcher:g,getBatchers:y,setPresets:u,reset:f,dispose:m};_.hooks.beforeStart.watchOnce(c);function c(){if(s)return;s=!0,r=Object.values(o),a=Object.keys(o);for(let v in o)o[v].triggerInit(o[v].props);e=new La({batchers:o,count:3e3}),t=new La({batchers:o,trails:!0,count:3e3}),u(Object.assign({"./presets/boost_trail.js":Nv,"./presets/gem_collected.js":i2,"./presets/gem_idle.js":d2})),x(),_.$game.paused.watch(S)}function u(w){n.push(...Object.entries(w).map(([v,$])=>({id:v.split("/").pop().split(".js").shift(),module:$.default})))}function h(w,{trails:v,...$}={}){if(o[w])return o[w];const P=v?z2:T2;return o[w]=new P({...F2,...$}),a=Object.keys(o),r=Object.values(o),o[w].triggerInit(o[w].props),o[w]}function d(w,v={}){if(!e&&!t)return;const $=v.batcher||"default";return(o[$].isTrailBatcher?t:e).emit(w,v,$)}function f(){e.killAll(),t==null||t.killAll()}function b(w,v){v=v??a,p(v);for(let $=0,P=v.length;$<P;$++){const T=v[$],L=o[T].base;w.add(L),L.manualMatrixUpdate=!0,L.updateMatrixWorld()}}function p(w){var v;w=w??a;for(let $=0,P=w.length;$<P;$++){const T=w[$],L=o[T];(v=L==null?void 0:L.base)!=null&&v.parent&&(L.base.material.dispose(),L.base.removeFromParent())}f()}function m(w){w=w??a;for(let v=0,$=w.length;v<$;v++){const P=w[v],T=o[P];T&&("dispose"in T.base&&T.base.dispose(),T.base.geometry.dispose(),T.base.material.dispose())}}function g(w){return w in o?o[w]:null}function y(w){const v=[];for(let $=0,P=w.length;$<P;$++)o[w[$]]&&v.push(o[w[$]]);return v}function x(){n.forEach(w=>{e.registerPreset(w.id,w.module),t==null||t.registerPreset(w.id,w.module)})}function S(w){w!==i&&(i=w,e.paused=i,t.paused=i)}function C(){if(s){for(let w=0,v=r.length;w<v;w++)r[w].update();e.update(),t==null||t.update()}}return function(v){v.$particles=l}}function N2(){J.Composite.clone=function(t){const s=t.bodies.map(i=>{const n=J.Bodies.rectangle(i.position.x,i.position.y,i.width,i.height);return Object.assign(n,i),n});return J.Composite.create({bodies:s})},J.Body.offset=function(t,{x:s,y:i}){const n={...t.initialPosition};J.Body.setPosition(t,{x:n.x+s,y:n.y+i})},J.Body.reset=function(t){J.Body.setPosition(t,t.initialPosition),J.Body.setVelocity(t,t.initialVelocity),J.Body.setAngularVelocity(t,t.initialAngularVelocity),J.Body.setAngle(t,t.initialAngle)}}const B2=new k;function V2(e){const t={instance:null,get bodies(){return a()},init:s,clear:i,add:n,remove:o,checkCollision:l};return t;function s(){t.instance=J.Detector.create()}function i(){J.Detector.clear(t.instance)}function n(c=[]){Array.isArray(c)||(c=[c]);const u=a();u.push(...c.filter(h=>!u.includes(h))),J.Detector.setBodies(t.instance,u)}function o(c=[]){Array.isArray(c)||(c=[c]);const u=a();for(let h=0;h<c.length;h++){const d=c[h],f=u.indexOf(d);f!==-1&&u.splice(f,1)}J.Detector.setBodies(t.instance,u)}function a(){return t.instance.bodies}function r(c){const u=c.find(d=>d.isZeppelin);let h=c.filter(d=>!d.isZeppelin);return h&&h.length===1&&(h=h[0]),{others:h,zep:u}}function l(){const{$game:c}=_;if(!c.state.is("Game"))return;_.$store.obstacleCollide=!1;const u=r(t.instance.bodies).zep;if(!u)return;const h=J.Query.collides(u,t.instance.bodies);if(h.length)for(let d=0;d<h.length;d++){const{bodyA:f,bodyB:b,supports:p}=h[d];if(f.label===b.label)continue;const{others:m}=r([f,b]);if(!m||Array.isArray(m))continue;const[g]=p;m.collide(B2.set(g.x,g.y,0))}}}const{log:Z2,error:j2}=An("physics","#fcac56","#000");N2();function H2(){const e=J.Engine.create({valocityIterations:20,constraintIterations:20,gravity:{x:0,y:-1},render:{visible:!1}}),t=e.world;let s=J.Runner.create({isFixed:!0});J.Runner.run(s,e);const i={engine:e,world:t,addToWorld:n,removeFromWorld:o,init:a,start:r,resize:l,update:c,log:Z2,error:j2};i.detector=V2(),_.hooks.afterInit.watchOnce(()=>a()),_.$viewport.size.watch(l);function n(u){t.bodies.includes(u)||J.Composite.add(t,u)}function o(u){!t.bodies.includes(u)&&!t.constraints.includes(u)||J.Composite.remove(t,u)}async function a(){i.detector.init()}function r(){}function l(){}function c(){if(s.enabled=!_.$game.isPaused(),_.$game.isPaused())return;const{stableDt:u,dt:h}=_.$time,d=_.$game.state.is("Game")?32:16.667;J.Engine.update(e,be(u,10,d)),i.detector.checkCollision()}return function(h){h.$physics=i}}const G2=new Cc,W2=`
	precision highp float;
	attribute lowp vec2 position;

	void main() {
		gl_Position = vec4(position, 0., 1);
	}
`,ns=class ns{constructor(t,s=new gr,i=G2){if(this.webgl=_,this.enabled=!0,this.name=t,this.scene=s,this.camera=i,this.size=this.webgl.$renderer.drawingBufferSize,this.shouldSwap=!0,this.shouldRenderToScreen=!1,this.screen=new In(ns.geometry,new zn({name:t,vertexShader:ns.defaultVertexShader})),this.screen.frustumCulled=!1,this.uniforms={res:this.size,tScreen:{value:null}},this.scene){const n=this.scene.isComponent?"addObject3D":"add";this.scene[n](this.screen)}}render(t,s,i){}get material(){var t;return((t=this.screen)==null?void 0:t.material)||null}set material(t){this.screen.material&&this.screen.material.dispose(),this.screen.material=t,this.screen.material.needsUpdate=!0}};se(ns,"geometry",po),se(ns,"defaultVertexShader",W2);let Is=ns;class q2 extends Is{constructor(t){super("RenderPass",t),this.shouldSwap=!1,this.screen.material.dispose(),this.screen.removeFromParent()}render(t,s,i){const n=this.shouldRenderToScreen?null:s;t.setRenderTarget(n),t.clear(),this.scene.triggerRender()}}const Y2=`precision highp float;
#define saturate(t) clamp(t, 0., 1.)
uniform float lutProgress;
uniform vec2 res;
uniform float time;
uniform sampler2D tLUT;
uniform sampler2D tScreen;
uniform sampler2D tBlueNoise;
uniform sampler2D tRandom;
uniform sampler2D tLUTStorm;
uniform float deathProgress;
uniform float vignetteVisibility;
uniform float vignetteDarkVisibility;
#include <lut>
#include <colorspace_pars_fragment>
#include <blending_pars_fragment>
const vec3 vignette_color = vec3(.051);
void main() {
vec2 uv = gl_FragCoord.xy / res.xy;
vec2 st = uv;
float aspect = res.x / res.y;
vec4 screen = texture2D(tScreen, uv);
float grey = 0.21 * screen.r + 0.71 * screen.g + 0.07 * screen.b;
uv.x *= aspect;
vec3 diffuse = screen.rgb;
diffuse += (texture2D(tRandom, uv * 10.).r * 2. - 1.) * .1;
vec4 color = vec4(diffuse, 1.);
float vignette = length(st - vec2(.5, .5));
color.rgb = mix(
color.rgb,
color.rgb * vignette_color,
(.013
+ smoothstep(.7, 1., vignette) * 1.
+ smoothstep(.0, 1., vignette) * 1.) * clamp(deathProgress*1.5, 0., 1.)
);
vec4 baseLUT = lookup(tLUT, color);
vec4 stormLUT = lookup(tLUTStorm, baseLUT);
gl_FragColor = mix(baseLUT, stormLUT, lutProgress) ;
gl_FragColor = LinearTosRGB(gl_FragColor) ;
gl_FragColor = vec4(mix(vec3(gl_FragColor.rgb), vec3(dot( gl_FragColor.rgb, vec3(.3))), deathProgress*1.) , 1.0);
}`,Da=re(Y2,"fragmentShader");class K2 extends Is{constructor(){super("CompositePass"),this.material=new zn({vertexShader:Is.defaultVertexShader,fragmentShader:Da,uniforms:{tLUT:{value:_.$assets.textures.lut},tLUTStorm:{value:_.$assets.textures.lut},lutProgress:{value:0},deathProgress:{value:0},tBlueNoise:{value:_.$assets.textures.blueNoise},tRandom:{value:_.$assets.textures.dirtyNoise},time:{value:0},...this.uniforms}}),Da.use(this.material)}render(t,s,i){const n=this.shouldRenderToScreen?null:s;this.uniforms.tScreen.value=i.texture,this.material.uniforms.tLUT.value=_.scene.lut??_.$assets.textures.lut,this.material.uniforms.tLUTStorm.value=_.scene.lutStorm??_.$assets.textures.lut,this.material.uniforms.deathProgress.value=_.$store.deathProgress,this.material.uniforms.lutProgress.value=_.$game.stormProgressUniform.value,this.material.uniforms.time.value+=_.$time.stableDt,t.setRenderTarget(n),t.render(this.scene,this.camera)}}function X2(){let e=null,t=0;const s=[],i={},n={buffers:i,passes:s,addPass:a,setScene:r,init:o,render:c};async function o(){const{$renderer:u}=_;i.read=new bt(1,1,{stencilBuffer:!0}),i.write=i.read.clone(),e=a(new q2(_.scene)),a(new K2),u.drawingBufferSize.watchImmediate(({width:h,height:d})=>{i.read.setSize(h,d),i.write.setSize(h,d)})}function a(u){return s.push(u),t+=1,u}function r(u){e.scene=u}function l(){const u=i.read;i.read=i.write,i.write=u}function c(u){const h=_.threeRenderer;r(u),s.forEach((d,f)=>{d.enabled&&(d.shouldSwap&&l(),d.shouldRenderToScreen=f===t-1,d.render(h,i.write,i.read))})}return function(h){h.$fx=n}}const Ia=[Vf,!1,!1,Bf,jf,Hf,Nf,Kf,H2,Ev,Lv,Av,U2,Ov,X2].filter(Boolean);function Q2(e){e.uniforms={time:{type:"f",value:0},resolution:{type:"v4",value:new ro}},e.defines={USE_FOG:""}}function J2(){Ct(Re,e=>e.set(0,0,0,0)),Ct(V,e=>e.setRGB(0,0,0)),Ct(X,e=>e.setScalar(0)),Ct(k,e=>e.setScalar(0)),Ct(ro,e=>e.setScalar(0)),Ct(It,e=>e.set(0,0,0,"XYZ")),Ct(Fe)}const Mn=e=>e.charAt(0).toUpperCase()+e.slice(1),Yt=()=>{},Ai=["init","start","preload","update","render","frame","resize"].reduce((e,t)=>(e[`before${Mn(t)}`]=he(),e[`after${Mn(t)}`]=he(),e),{});let _;function e_(e){e=e||document.createElement("canvas");const t=_={canvas:e,ctx:null,collection:{components:{},mixins:{}},scene:null,camera:null,renderer:null,hooks:Ai,install:n,installPlugins:s,registerMixin:i,init:Yt,start:Yt,preload:Yt,resize:Yt,update:Yt,render:Yt,frame:a,destroy:r};return J2(),Q2(t),wv(t),o("init",!0,!0),o("preload",!0,!0),o("start",!0,!0),o("update"),o("render"),o("frame"),o("resize"),t;async function s(){for(let l=0;l<Ia.length;l++)await Ia[l].call()(t)}function i(...l){for(let c=0;c<l.length;c+=2){const u=l[c],h=l[c+1];if(!h)continue;const d=t.collection.mixins;d[u]||(d[u]=h)}}async function n(){await s(),t.init(),await t.preload(),t.start()}function o(l,c=!1,u=!1){const h=Ai[`before${Mn(l)}`],d=Ai[`after${Mn(l)}`],f=t[l];c?t[l]=async function(b,p,m,g){h.emit(),await f(b,p,m,g),d.emit(),u&&(h.unwatchAll(),d.unwatchAll())}:t[l]=function(b,p,m,g){h.emit(),f(b,p,m,g),d.emit(),u&&(h.unwatchAll(),d.unwatchAll())}}function a(){t.update(),t.render()}function r(){t.decorator.destroy&&t.decorator.destroy();for(let l=0;l<Object.values(t.components);l++){const c=Object.values(t.components)[l];c&&c.isComponent&&c.triggerDestroy()}}}function St(){return _}const an=new k,za=new fr,Oi=new Oe;function hl(e,t=!1){if(!e)return;const s={},i={},n=()=>{const{top:l,left:c,width:u,height:h}=e.getBoundingClientRect(),d=c+u/2,f=l+h/2;return{x:d,y:f,width:u,height:h}},o=no(()=>{Object.assign(s,n())},200);return _.hooks.afterResize.watch(o),o(),Object.assign(e,{sync:i}),Object.assign(i,{node:e,nodeBounds:s,position:new k,isInViewport:!1,force:t,resize:o,update:r,destroy:a});function a(){_.hooks.afterResize.unwatch(o),delete e.sync}function r(){var h,d;const{instance:l}=_.$renderer,c=(d=(h=_.$game.currentChapter)==null?void 0:h.camera)==null?void 0:d.base;if(!c||!l)return;Oi.updateMatrix(),Oi.updateMatrixWorld(!1),i.force&&Object.assign(s,n()),Vs({x:s.x,y:s.y},c,0,an,c.position.z),Oi.localToWorld(an);const u=Fe.get();za.setFromProjectionMatrix(u.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse)),u.release(),i.position.copy(an),i.isInViewport=za.containsPoint(an)}}const t_={class:"score-dial-wrapper"},rn=12,s_={__name:"ScoreDial",setup(e,{expose:t}){const{wait:s,setTimeout:i}=Nn(),n=()=>{},o=Z(),a=Z(0),r=Z(0),l=Qe([...Array(rn).keys()]);function c(d){return d===6?"bottom":d===12?"top":null}const u=Z(!1);async function h(){await s(20),u.value=!0;const d=M.$webgl.getZeppelin(),f=M.$webgl.$store.collectedGems.length;for(let p=0;p<f;p++){const m=d.wire.points[p];!m.orb&&m.sync||(m.orb.scaleMult=.6)}if(f){let p=Dt();const m=[...o.value].map((x,S)=>{const C=x.$el??x;C.classList.remove("animComplete");const w=C.classList.contains("score-dial-discovery");return{value:C,onStart:async()=>{const v=d.wire.points[S];if(v.orb&&v.sync&&le().to(v.orb,{scaleMult:1,duration:300,easing:ne.outSwift,delay:800}),await s(600),w){const $=C.classList.contains("bottom")?0:1;x==null||x.unlockDiscovery($)}M.$user.isRegistered&&M.$user.saveData(),await s(200),w?M.$audio.playSound("sfx_Result_Unlock_Discovery",{variation:S===5?1:2}):M.$audio.playSound("sfx_Result_Circle_Increment"),C.classList.add("animComplete")},onComplete:()=>{S===f-1&&p.resolve()}}}),{points:g,transform:y}=d.wire;y.visible=!1;for(let x=0;x<g.length;x++){const S=g[x];if(!S.orb||!S.orb.isCollected.value)continue;S.isOverriding=!0;const w=x/(g.length-1)*1200,v=m[x];v&&(S.sync=hl(v.value),le({onComplete:v.onComplete??n}).to(S,{scoreAnimProgress:1,easing:ne.outSwift,duration:1150,delay:150+w,onStart:v.onStart??n}))}await p,await s(1700)}else M.$user.isRegistered&&M.$user.saveData(),await s(1250);M.$audio.playSound("sfx_Result_Circle_Close");for(let p=0;p<d.wire.points.length;p++){const m=d.wire.points[p];m.sync&&(m.sync.force=!0,le().to(m.orb,{scaleMult:.6,duration:1400,easing:ne.outSwift}))}for(let p=0;p<[...o.value].length;p++)le().to(l,{[p]:rn,duration:1400,easing:ne.outSwift});le().to(r,{value:1,duration:1300,easing:ne.longKeyframe}),await s(250),le().to(a,{value:1,duration:2300,easing:ne.inOutQuint});const b=ye(M.$viewport.width,400,1200,6,8);M.$webgl.shockWave.emit({to:d.base,scale:b,position:[0,0,-1],duration:1200,delay:800}),await s(1150),M.$audio.playSound("sfx_Result_DropOnZeppelin");for(let p=0;p<[...o.value].length;p++)(o.value[p].$el??o.value[p]).classList.add("forceHiding");i(()=>{for(let p=0;p<d.wire.points.length;p++){const m=d.wire.points[p];m.sync&&(m.orb.elements.forEach(g=>g.alpha=0),m.sync.force=!1,m.orb.scaleMult=1)}},400)}return Pn(()=>{var b;const d=M.$webgl.getZeppelin(),{points:f}=d.wire;for(let p=0;p<f.length;p++){const m=f[p];(b=m==null?void 0:m.sync)==null||b.destroy()}}),t({show:h}),(d,f)=>(I(),B("div",{class:G(["score-dial",[u.value?"active":""]])},[E("div",t_,[E("div",{class:"dots",style:Bi({"--total":rn})},[(I(),B(ze,null,Ke(rn,b=>N(En(c(b)?If:"div"),{ref_for:!0,ref_key:"$$dotsNodes",ref:o,key:b,class:"dot",style:Bi({"--i":l[b]??0,"--centerProgress":1-a.value,"--scaleProgress":1-r.value}),type:c(b)},null,8,["style","type"])),64))],4)])],2))}},n_=q(s_,[["__scopeId","data-v-c0667f18"]]),i_={class:"score-screen"},o_={__name:"ScoreWrapper",props:{end:{type:Boolean,default:!1}},setup(e){const t=e,s=Z(),i=Z(),n=Z(!1);return xe(async()=>{M.$store.inGame=!1,await s.value.show(),n.value=!0,await Q(100),t.end&&M.$webgl.$game.state.set("EndGame",{force:!0}),!t.end&&!M.$store.isOnLastLevel&&(M.$store.isBigReadabilityNeeded=!0),i.value&&await i.value.show()}),Xe(()=>{n.value=!1}),(o,a)=>(I(),B("section",i_,[N(n_,{ref_key:"$$scoreDial",ref:s},null,512),F(M).$store.isOnLastLevel?Ae("",!0):(I(),Te(Of,{key:0,ref_key:"$$scoreResult",ref:i},null,512))]))}},yo=o_;const a_={class:"chapter sea-of-clouds"},r_={__name:"SeaOfClouds",setup(e){const{$router:t,$webgl:s,$trackEvent:i,$store:n}=M;t.nrv({onEnter:f,onLeave:b,duration:{enter:2500,leave:3e3,done:100}});const o=Z(),a=Z(!1),r=Z();xe(()=>{i("pageview",{page:"chapter1"})}),pe(()=>n.displaySubtitle,p=>{var m;(m=r.value)==null||m.toggle(p)});function l(){var p;d(),(p=o.value)==null||p.show()}async function c(){d()}function u(){d()}function h(){d(),a.value=!0}function d(){var p;(p=o.value)==null||p.hide(),a.value=!1}async function f({isCancelled:p,exitPrevious:m,toggleClass:g}){m({lastOnly:!0}),!p()&&(s.$game.events.lose.watch(l),s.$game.events.end.watch(u),s.$game.events.score.watch(h),s.$game.events.reset.watch(c),s.$game.state.set("Game",{force:!0}),await Q(7500),g())}async function b({done:p,toggleClass:m}){s.$game.events.lose.unwatch(l),s.$game.events.end.unwatch(u),s.$game.events.score.unwatch(h),s.$game.events.reset.unwatch(c),p({duration:3e3}),m()}return(p,m)=>(I(),B("div",a_,[a.value?(I(),Te(yo,{key:0})):Ae("",!0),N(fo,{ref_key:"$$lose",ref:o},null,512),N(uo,{ref_key:"subtitle",ref:r,text:p.$l("CHAP1-subtitle")},null,8,["text"])]))}},l_=q(r_,[["__scopeId","data-v-9c3ff3a6"]]);const c_={class:"numbers"},u_=["innerHTML"],d_=["innerHTML"],h_=["innerHTML"],f_=["innerHTML"],p_={__name:"Countdown",setup(e){const t=Z(),s=Z(),i=Z(),n=Z(),o={3:t,2:s,1:i},a=Z(!1),r=M.$device.type.mobile?M.$l("COUNTDOWN-gomobile"):M.$l("COUNTDOWN-godesktop");xe(()=>{M.$webgl.$store.game.countdown.watch(l),M.$webgl.$game.events.reset.watch(c)});function l(u){var h,d,f;if(u===null){a.value=!1;return}else a.value=!0;for(const b in o){const p=o[b];b==u?(h=p.value)==null||h.classList.add("show"):(d=p.value)!=null&&d.classList.contains("show")&&((f=p.value)==null||f.classList.add("hide"))}}function c(){var u,h;a.value=!1;for(const d in o){const f=o[d];(u=f.value)==null||u.classList.remove("show"),(h=f.value)==null||h.classList.remove("hide")}}return Pn(()=>{M.$webgl.$store.game.countdown.unwatch(l),M.$webgl.$game.events.reset.unwatch(c)}),(u,h)=>(I(),B("div",{class:G(["countdown",{show:a.value&&!F(M).$store.isMenuOpen}])},[E("div",c_,[E("div",{ref_key:"number3",ref:t,class:"number number-3",innerHTML:u.$l("COUNTDOWN-three")},null,8,u_),E("div",{ref_key:"number2",ref:s,class:"number number-2",innerHTML:u.$l("COUNTDOWN-two")},null,8,d_),E("div",{ref_key:"number1",ref:i,class:"number number-1",innerHTML:u.$l("COUNTDOWN-one")},null,8,h_),E("div",{ref_key:"number0",ref:n,class:"number go",innerHTML:F(r)},null,8,f_)])],2))}},fl=q(p_,[["__scopeId","data-v-dd506ca9"]]);const m_={class:"chapter frozen-lake"},g_={__name:"FrozenLake",setup(e){const{$router:t,$webgl:s,$trackEvent:i,$store:n}=M;t.nrv({onEnter:f,onLeave:b,duration:{enter:5e3,leave:3e3,done:100}});const o=Z(),a=Z(!1),r=Z();xe(()=>{i("pageview",{page:"chapter2"})}),pe(()=>n.displaySubtitle,p=>{var m;(m=r.value)==null||m.toggle(p)});function l(){var p;d(),(p=o.value)==null||p.show()}async function c(){d()}function u(){d()}function h(){d(),a.value=!0}function d(){var p;(p=o.value)==null||p.hide(),a.value=!1}async function f({isCancelled:p,exitPrevious:m,toggleClass:g}){m({lastOnly:!0}),!p()&&(s.$game.events.lose.watch(l),s.$game.events.end.watch(u),s.$game.events.score.watch(h),s.$game.events.reset.watch(c),s.$game.state.set("Game",{force:!0}),await Q(6500),g())}async function b({done:p,toggleClass:m}){s.$game.events.lose.unwatch(l),s.$game.events.end.unwatch(u),s.$game.events.score.unwatch(h),s.$game.events.reset.unwatch(c),p({duration:3e3}),m()}return(p,m)=>(I(),B("div",m_,[a.value?(I(),Te(yo,{key:0})):Ae("",!0),N(fo,{ref_key:"$$lose",ref:o},null,512),N(fl),N(uo,{ref_key:"subtitle",ref:r,text:p.$l("CHAP2-subtitle")},null,8,["text"])]))}},v_=q(g_,[["__scopeId","data-v-ce2cf411"]]);const __={class:"chapter starry-night"},y_={class:"buttons"},b_={__name:"StarryNight",setup(e){const{$router:t,$webgl:s,$trackEvent:i,$store:n}=M;t.nrv({onEnter:x,onLeave:S,duration:{enter:5e3,leave:1e3,done:100}});const o=Z(),a=Z(!0),r=ct("Space",f,{enabled:!1});function l(C){a.value&&(a.value=!1,n.isBigReadabilityNeeded=!1,C!=null&&C.target&&(C.target.blur(),C.target.disabled=!0,setTimeout(()=>{C.target.disabled=!1},3e3)),n.totalScore=0,n.currentScore=0,t.push({name:"Sea of Clouds"}),n.previousTotalScore=0,Object.values(n.finishedLevels).map(()=>!1),n.isLastLevelScoreVisible=!1,n.previousScoreTensDigit=0,n.previousScoreOnesDigit=0,n.isGameOverOpen=!1,M.$trackEvent("restartChapter",{chapter:"chapter3",fromPage:"endGame"}))}Gi(()=>n.isLastLevelScoreVisible,async()=>{var C;n.isLastLevelScoreVisible&&(await((C=o.value)==null?void 0:C.show()),r.enable())}),Gi(()=>n.totalScore,()=>{i("finalScore",{score:`${n.totalScore}`})});const c=Z(),u=Z(!1),h=Z(),d=Z(!1);xe(()=>{i("pageview",{page:"chapter3"}),a.value=!0}),pe(()=>n.displaySubtitle,C=>{var w;(w=h.value)==null||w.toggle(C)});function f(){n.isHeaderOpen||n.isPanelOpen||n.isAboutOpen||n.isRegisterOpen||n.isMenuOpen||l()}function b(){var C;y(),(C=c.value)==null||C.show()}async function p(){y(),d.value=!1}function m(){y(),requestAnimationFrame(()=>d.value=!0),i("reachEndChapter",{chapter:"chapter3"})}function g(){y(),requestAnimationFrame(()=>u.value=!0)}function y(){var C;(C=c.value)==null||C.hide(),u.value=!1,n.isGameOverOpen=!1}async function x({isCancelled:C,exitPrevious:w,toggleClass:v}){w({lastOnly:!0}),!C()&&(s.$game.events.lose.watch(b),s.$game.events.end.watch(m),s.$game.events.score.watch(g),s.$game.events.reset.watch(p),s.$game.state.set("Game",{force:!0}),await Q(6e3),!C()&&v())}async function S({done:C,toggleClass:w}){s.$game.events.lose.unwatch(b),s.$game.events.end.unwatch(m),s.$game.events.score.unwatch(g),s.$game.events.reset.unwatch(p),C({duration:3e3}),w()}return(C,w)=>(I(),B("div",__,[u.value?(I(),Te(yo,{key:0,end:!0})):Ae("",!0),N(fo,{ref_key:"$$lose",ref:c},null,512),N(fl),N(uo,{ref_key:"$$subtitle",ref:h,text:C.$l("CHAP3-subtitle")},null,8,["text"]),d.value?(I(),B("div",{key:1,class:G(["end-score",{visible:F(n).isLastLevelScoreVisible}])},[N(ho,{ref_key:"$$scoreCounter",ref:o,score:F(n).totalScore,"is-max-score-visible":!0,class:G({"is-end":d.value})},null,8,["score","class"]),E("div",y_,[N(co,{score:F(n).totalScore},null,8,["score"]),N(xt,{text:C.$l("END-replay"),class:"replay-btn",onClick:l},null,8,["text"])])],2)):Ae("",!0)]))}},x_=q(b_,[["__scopeId","data-v-73cb5c94"]]),w_={};function S_(e,t){return null}const $_=q(w_,[["render",S_]]),M_=[{name:"Home",path:"/",component:sf},{name:"Sea of Clouds",path:"/sea-of-clouds",component:l_},{name:"Frozen Lake",path:"/frozen-lake",component:v_},{name:"Starry Night",path:"/starry-night",component:x_},{name:"Wip",path:"/wip",component:$_}];function C_(){const e=kc(),t=Tc({history:e,routes:M_}),s=t.install;return t.install=function(n){n.provide("router",t),n.component("NiceRouterView",Nh),s.call(this,n),Bh(n,t);const o=n.config.globalProperties;o.$router.previousRoute=ae(),o.$previousRoute=null,t.firstRoute=ae(),t.beforeEach((a,r)=>{t.firstRoute.value={to:a,from:r}}),t.afterEach((a,r,l)=>{l||(t.firstRoute.value=null,o.$previousRoute=r,o.$router.previousRoute.value=r)}),delete t.install},t}const k_=()=>{const e=Qe({isSpinnerVisible:!1,isReadabilityNeeded:!1,isBigReadabilityNeeded:!1,isHeaderOpen:!1,isPanelOpen:!1,isMenuOpen:!1,isAboutOpen:!1,isRegisterOpen:!1,isGameStarted:!1,isAudioMuted:!1,isLookingUp:!1,isGameoverOpen:!1,hasVisitedHome:!1,hasNotification:!1,displaySubtitle:!1,isLastLevelScoreVisible:!1,runningTransition:null,finishedLevels:{sea_of_clouds:!1,frozen_lake:!1,starry_night:!1},currentGameState:null,isOnHome:ie(()=>M.$route.name==="Home"),isOnLastLevel:ie(()=>M.$route.name==="Starry Night"),isOverlayVisible:ie(()=>e.isPanelOpen&&!e.isMenuOpen),isRTL:ie(()=>document.documentElement.dir==="rtl"),isTutorialVisible:ie(()=>e.inGame&&!e.isMenuOpen&&!e.isAboutOpen&&!e.isOverlayVisible&&!e.isGameStarted),isPauseVisible:ie(()=>(M.$route.name==="Sea of Clouds"||M.$route.name==="Frozen Lake"||M.$route.name==="Starry Night")&&!M.$store.isLookingUp&&!M.$store.isLastLevelScoreVisible),isDiscoveryVisible:ie(()=>(M.$route.name==="Sea of Clouds"||M.$route.name==="Frozen Lake"||M.$route.name==="Starry Night")&&!M.$store.isMenuOpen&&!M.$store.isRegisterOpen&&!M.$store.isAboutOpen),isAnyOverlayVisible:ie(()=>e.isOverlayVisible||e.isMenuOpen||e.isHeaderOpen),inGame:!1,panelWidth:0,percentLoaded:0,discoveries:{chapter1:[],chapter2:[],chapter3:[]},previousTotalScore:0,previousScoreTensDigit:0,previousScoreOnesDigit:0,currentScore:0,totalScore:0,maxScore:36,resetFormState(){e.formIsSubmitting=e.formHasError=e.formIsSuccessful=!1}});return e.isAudioMuted=!!+localStorage.getItem("audio-muted"),He(()=>localStorage.setItem("audio-muted",+!!e.isAudioMuted)),pe(()=>e.isAudioMuted,t=>M.$audio.isMuted=t),pe(()=>e.isAnyOverlayVisible,t=>{M.$audio.bgm.volume(t?.3:1)}),e},T_=Object.freeze(Object.defineProperty({__proto__:null,default:k_},Symbol.toStringTag,{value:"Module"})),Fa=Object.assign({"/app/store/index.js":T_}),Ua=e=>typeof e=="object"&&!Array.isArray(e)&&e!==null;function E_(){let e;return function(s){const i={};for(const n in Fa){const o=n.split("/").pop().slice(0,-3);i[o]=Fa[n].default,typeof i[o]=="function"&&(i[o]=i[o](s))}e=Ua(i.index)?i.index:{};for(const n in i)n==="index"||!Ua(i[n])||(e[n]=i[n]);e=Qe(e),s.config.globalProperties.$store=e,s.provide("store",e)}}const ln=document.documentElement;let Be;function P_(){Be=document.createElement("div"),Object.assign(Be.style,{position:"fixed",top:0,left:0,width:"200px",height:"10px",overflowY:"scroll",pointerEvents:"none",userSelect:"none",zIndex:-1,opacity:0});function e(){const s=document.createElement("div"),i={width:"1px",height:"100%",overflowY:"hidden"};Object.assign(Be.style,{width:"200px",height:"10px",overflowY:"scroll"}),Object.assign(s.style,{width:"100%",height:"150%"}),Be.appendChild(s),document.body.appendChild(Be);const n=parseFloat(getComputedStyle(ln).zoom),o=isNaN(n)?1:n,a=Math.round((200-Be.clientWidth)*o);return ln.style.setProperty("--mm-scrollbar-width",a+"px"),document.body.removeChild(Be),Be.removeChild(s),Object.assign(Be.style,i),a}function t(){document.body.appendChild(Be);const i=Be.getBoundingClientRect().height;return document.body.removeChild(Be),ln.style.setProperty("--mm-inner-height",window.innerHeight+"px"),ln.style.setProperty("--mm-vp-height",i+"px"),i}return{measureScrollbarWidth:e,measureViewportHeight:t}}function L_(){const e=no(n,500,{trail:!1});let t=null;const s=Qe({width:10,height:10,viewportRatio:1,pixelRatio:1,visible:!0});function i(){t=P_(),t.measureScrollbarWidth(),document.addEventListener("visibilitychange",a,!1),setInterval(o,5e3),window.addEventListener("resize",()=>{n(),e()},!1),n(),e(),o(),a()}function n(){s.width=window.innerWidth,s.height=t.measureViewportHeight(),s.viewportRatio=s.width/s.height}function o(){s.pixelRatio=window.devicePixelRatio||1}function a(){s.visible=!document.hidden,n()}return function(l){l.config.globalProperties.$viewport=s,l.provide("viewport",s),i()}}const A_={__name:"Webgl",props:{useResizeObserver:{type:Boolean,default:!1}},setup(e,{expose:t}){const s=e,i=ae(),n=os("webgl",null);let o=ae();if(n&&s.useResizeObserver){let l=function(){n.$viewport.useManualResize=!0,n.$viewport.resize(r.width,r.height)},a=!1;const{size:r}=lf({ref:i,cb:()=>{if(!n.$viewport)return a=!0;l()}});n.hooks.afterInit.watchOnce(async()=>{a&&(await as(),l())})}return xe(()=>{n.canvas&&(o.value=n.canvas,o.value.classList.add("webgl-canvas"),i.value.appendChild(o.value))}),Pn(()=>{o.value&&o.value.parentNode===i.value&&i.value.removeChild(o.value),o.value=null}),t({wrapper:i,canvas:o}),(a,r)=>r[0]||(Po(-1),r[0]=E("aside",{ref_key:"wrapper",ref:i,class:"webgl-wrapper"},null,512),Po(1),r[0])}},O_=A_;function R_(){const e=document.createElement("canvas"),t=e_(e);return function(i){i.component("WebGL",O_),i.provide("webgl",t);const n=i.config.globalProperties;n.$webgl=t,t.$app=n;const o=n.$preloader;o&&o.task(async()=>{await t.installPlugins(),await t.init(),await t.preload(),await t.start()},{weight:3})}}function D_(e,t){let s=t.querySelector(".preloader-background-top");s||(s=document.createElement("figure"),s.classList.add("preloader-background-top"),t.appendChild(s));let i=t.querySelector(".preloader-background-bot");i||(i=document.createElement("figure"),i.classList.add("preloader-background-bot"),t.appendChild(i));let n=t.querySelector(".preloader-counter");n||(n=document.createElement("p"),n.classList.add("preloader-counter"),t.appendChild(n));const o=t.querySelector(".preloader-composition"),a=Dt();let r=0,l=0;function c(){yt.add(h),n.style.transition="opacity 1000ms cubic-bezier(0.55, 0, 0.1, 1)",n.style.opacity=1,o.style.transition="opacity 1000ms cubic-bezier(0.55, 0, 0.1, 1)",o.style.opacity=1}function u(b){r=b}function h(b){b=be(b,5,300);let p=to(l,r,.17,b);p>.99&&(p=1),p!==l&&(l=p,n.textContent=Math.floor(l*100).toString().padStart(2,"0"),l>=1&&a.resolve())}async function d(b){await a,n.style.transition="opacity 1000ms cubic-bezier(0.55, 0, 0.1, 1)",n.style.opacity=0,o.style.transition="opacity 1000ms cubic-bezier(0.55, 0, 0.1, 1)",o.style.opacity=0,await Q(1500),s.style.transition="transform 2000ms cubic-bezier(0.55, 0, 0.1, 1)",s.style.transform="translateY(-110%)",i.style.transition="transform 2000ms cubic-bezier(0.55, 0, 0.1, 1)",i.style.transform="translateY(110%)",b(),await Q(2100)}function f(){yt.remove(h)}return{enter:c,onProgress:u,exit:d,beforeDestroy:f}}function I_(){let e=!1,t=2,s=0,i,n,o,a=!1,r,l,c,u,h=Promise.resolve();const d=[],f=new Promise(A=>c=A);let b=null;const p=Pe(new Promise(A=>b=A));let m=null;const g=Pe(new Promise(A=>m=A)),y=Qe({progress:0,taskCount:0,taskFinished:0,finished:!1,hidden:!1,hiddenPromise:p,destroyed:!1,destroyedPromise:g,task:D,createTask:O,setMinimumTaskCount:U,beforeExit:x});function x(A){a?A():d.push(A)}function S(){a||(a=!0,Promise.resolve().then(()=>u).then(()=>d.reduce((A,R)=>A.then(R),Promise.resolve())).then(()=>d.length=0).then(()=>y.finished=!0).then(()=>i.exit&&i.exit(w)).then(v).catch(A=>{console.error(A),v()}))}function C(){const A=y.progress;i.onProgress&&i.onProgress(A),A>=1&&S()}function w(){y.hidden||y.destroyed||(y.hidden=!0,b(),l&&l(),l=null,c())}function v(){y.destroyed||(w(),n.parentNode&&n.parentNode.removeChild(n),i.beforeDestroy&&i.beforeDestroy(),m(),n=null,i=null,y.destroyed=!0)}function $(A,R,z){e||(o.$router.beforeResolve(P),e=!0),z()}async function P(A,R,z){r.finish(),await f,z()}function T(A){y.taskFinished+=A;const R=y.taskFinished/y.taskCount;y.progress=Math.max(0,Math.min(1,Math.max(y.progress,R)))}function L(A){s+=A,y.taskCount=Math.max(t,s)}function O({weight:A=1}={}){let R=!1;return L(A),{get finished(){return R},finish(){R||(R=!0,T(A))}}}function D(A,{weight:R=1,graceful:z=!0}={}){return L(R),h.then(()=>typeof A=="function"?A():A).then(Y=>(T(R),Y)).catch(Y=>{console.error(Y),z&&T(R)})}function U(A){t=A,y.taskCount=Math.max(t,s)}return function(R){if(r=O(),o=R.config.globalProperties,o.$router.beforeEach($),o.$preloader=y,R.provide("preloader",y),n=document.getElementById("mm-preloader-wrapper"),i=D_(R,n),i.init&&i.init(),i.enter&&(u=i.enter()),l=Ec(()=>C(y.progress)),R&&R.onAfterMount){let z;h=new Promise(Y=>z=Y),R.onAfterMount(z)}}}const z_=["Sea of Clouds","Frozen Lake","Starry Night"];function F_(){const e=gu({init:t,register:d,resetLocalData:u,saveData:h,currentLevel:null,score:0,isRegistered:!1});function t(){s()}function s(){let f=l();f||(f=JSON.stringify({}));let b=JSON.parse(f);b=i(b),e.currentLevel=b.currentLevel,e.currentLevel&&(e.isRegistered=!0),e.discoveries=b.discoveries,e.score=b.score,M.$store.totalScore=e.score}function i(f){return n(f),o(f),a(f),f}function n(f){return!f.currentLevel||!z_.includes(f.currentLevel)?null:f.currentLevel}function o(f){if(!f.currentLevel||!f.score||typeof f.score!="number"||f.score<0)return f.score=0;if(f.score>36)return f.score=36}function a(f){if(!f.currentLevel)return f.discoveries=r();const b=f.discoveries;if(!b)return f.discoveries=r();let p=!0;const m=r();for(const g in b){const y=b[g];if(!m[g]){p=!1;break}if(!Array.isArray(y)){p=!1;break}y.forEach(x=>{if(typeof x!="boolean")return p=!1})}if(!p)return f.discoveries=r()}function r(){return{chapter1:[!1,!1],chapter2:[!1,!1],chapter3:[!1,!1]}}function l(){return localStorage.getItem("cartier-eoy-23")}function c(f){localStorage.setItem("cartier-eoy-23",f)}function u(){localStorage.removeItem("cartier-eoy-23")}async function h(){const f={currentLevel:e.currentLevel,discoveries:e.discoveries,score:e.score};e.isRegistered=!0,c(JSON.stringify(f))}async function d(){}return function(b){b.config.globalProperties.$user=e,b.provide("user",e)}}const Ri=["KeyS","KeyW","KeyD","KeyA","Enter","Space","Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].reduce((e,t)=>(e[t]=1,e),{}),U_=["TEXTAREA","INPUT","BUTTON","A","SELECT"].reduce((e,t)=>(e[t]=1,e),{});function N_(e){if(!e)return!1;const t=e.tagName;return!!(U_[t]||e.dataset&&e.dataset.bypassKeyboard!=null)}function B_(e){return e?e.target?!N_(e.target):!0:!1}function V_(){const e=Object.keys(Ri).reduce((l,c)=>(l[c]=!1,l),{}),t=Qe({pressedCount:0,keys:e,unpressAllKeys:Pe(r),listen:Pe(s)});return r(),t.pressedCount=0,t;function s(){const l={passive:!1};window.addEventListener("keydown",i,l),window.addEventListener("keyup",n,l),window.addEventListener("blur",r,!1),window.addEventListener("contextmenu",r,!1)}function i(l){Ri[l.code]&&B_(l)&&(l.preventDefault(),o(l.code))}function n(l){Ri[l.code]&&a(l.code)}function o(l){t.keys[l]||(t.keys[l]=!0,t.pressedCount++)}function a(l){t.keys[l]&&(t.keys[l]=!1,t.pressedCount=Math.max(t.pressedCount-1,0))}function r(){for(let l in e)a(l)}}const Z_=["INPUT","SELECT","TEXTAREA","A","BUTTON"].reduce((e,t)=>(e[t]=1,e),{}),j_=[""].reduce((e,t)=>(e[t]=1,e),{});function H_(e){if(!e)return!1;const t=e.tagName;return!!(j_[M.$route.name]||M.$store.isPanelOpen||Z_[t]||e.dataset&&e.dataset.bypassTouch!=null)}function Na(e){return e?e.target?!H_(e.target):!0:!1}let Rt,Ba;const G_=()=>Rt=!1;function Va(){Rt=!0,clearTimeout(Ba),Ba=setTimeout(G_,200)}function W_(){const e={x:0,y:0},t={x:0,y:0},s={x:0,y:0},i={x:0,y:0},n={x:0,y:0},o={x:0,y:0},a={x:0,y:0};let r=!1,l=!1;const c=Qe({clickIn:!1,clickOut:!1,useTouch:!1,canHover:!1,pressed:!1,firstPos:e,prevPos:t,pos:s,relativePos:i,delta:n,normalizePos:o,normalizeRelativePos:a,listen:Pe(m),poll:Pe(p)});return c;function u(g){return g.changedTouches[0]}function h(g){if(g.target.closest("[allow-touch-event]"))return;const y=!!g.changedTouches;if(y)Va();else if(Rt)return;if(!y&&g.button!==0)return;if(Na(g))g.preventDefault();else return;const x=y?u(g):g;c.useTouch=!!(y||Rt),c.useTouch&&(c.canHover=!1),c.pressed=!0,n.x=n.y=0,s.x=t.x=e.x=x.clientX,s.y=t.y=e.y=x.clientY,l=!1,r=!0,b()}function d(g){if(g.target.closest("[allow-touch-event]"))return;const y=!!g.changedTouches,x=y?u(g):g;c.useTouch=!!(y||Rt),c.useTouch?c.canHover=!1:c.pressed||(c.canHover=!0),s.x=x.clientX||0,s.y=x.clientY||0,b()}function f(g){if(g.target.closest("[allow-touch-event]"))return;const y=!!g.changedTouches;if(y)Va();else if(Rt)return;if(!y&&g.button!==0)return;if(Na(g))g.preventDefault();else if(!c.pressed)return;const x=y?u(g):g;c.useTouch=y||Rt,c.useTouch&&(c.canHover=!1),c.pressed=!1,s.x=x.clientX||0,s.y=x.clientY||0,b(),l=!0,r=!1}function b(){c.pressed?(i.x=s.x-e.x,i.y=s.y-e.y):i.x=i.y=0;const g=M.$viewport.width,y=M.$viewport.height;o.x=Ye(s.x,0,g,-1,1),o.y=Ye(s.y,0,y,1,-1),a.x=i.x/g,a.y=i.y/y}function p(){n.x=s.x-t.x,n.y=s.y-t.y,t.x=s.x,t.y=s.y,c.clickIn=r,c.clickOut=l,r=l=!1}function m(){const g=document.querySelector(".xp-wrapper"),y=g,x="addEventListener",S={passive:!1};y[x]("touchstart",h,S),y[x]("touchmove",d,S),y[x]("touchend",f,S),y[x]("touchcancel",f,S),g[x]("mousedown",h,S),g[x]("mousemove",d,S),g[x]("mouseup",f,S),y[x]("gesturestart",C=>C.preventDefault(),S)}}function q_(){const e={listen:t,poll:s,touch:W_(),keyboard:V_()};function t(){e.touch.listen(),e.keyboard.listen()}function s(){e.touch.poll()}return function(n){n.config.globalProperties.$controls=e,n.provide("controls",e)}}const Y_={ultra:[["not-mobile","ge","geforce gtx",1050],["is","radeon vii"],["ge","radeon rx vega",64],["is","geforce titan"],["ge","radeon rx",5e3],["is","apple m"],["ge","apple a",12,100],["ge","apple a",13]],veryhigh:[["is","geforce rtx"],["is","quadro gtx"],["ge","apple a",12],["mobile","ge","geforce gtx",780],["not-mobile","ge","geforce gtx",680],["ge","quadro p",400],["is","radeon r10"],["is","radeon r9"],["ge","radeon r7",370],["ge","radeon rx",570],["ge","radeon rx vega",56]],high:[["is","geforce gtx"],["ge","geforce mx",250],["ge","radeon pro",450],["not-mobile","ge","radeon hd",5570],["ge","adreno",418],["ge","apple a",11],["ge","mali g",71],["ge","mali t",760,8],["ge","mali t",880]],medium:[["brand","nvidia"],["brand","amd"],["brand","apple"],["is","intel iris plus"],["is","intel iris pro"],["ge","intel hd",630],["le","intel hd",2e3],["ge","adreno",430],["is","mali g"],["ge","mali t",800,2],["ge","mali t",860]]},Za=typeof VV_GPU_TESTS<"u"?VV_GPU_TESTS:Y_,Cn="unknown",ls=(e,t)=>t.reduce((s,i)=>s||!!e.match(i),!1),bo=(e,t)=>{for(const s in t)if(ls(e,t[s]))return s},pl={edge:["edge","edg"],chrome:["chrome","crios"],firefox:["firefox","fxios"],ie:["msie","trident","rv:"],ucbrowser:["ucbrowser"],safari:["safari","ios"],opera:["opera","opios"]},K_={0:"verylow",1:"low",2:"medium",3:"high",4:"veryhigh",5:"ultra"};function X_(e,t=!1){const s={};if(t)return Object.assign(s,{type:{desktop:!0},os:"windows",browser:"chrome",browserVersion:"77",gpu:Ls("low")});s.userAgent=typeof e=="string"?e:navigator.userAgent.toLowerCase(),s.hasTouch=Q_(),s.type=J_(s),s.os=ey(s),s.browser=ty(s),s.browserVersion=sy(s);let i=ja(s,!0);const n=!i;return Ha(),i=ja(s,!1),s.majorPerformanceCaveat=i&&n,s.webgl=i?iy(s,i):null,Ha(),i=null,s.gpu=Ls("low"),s.gpuDetectionFinished=s.webgl?ny(s).then(o=>Object.assign(s.gpu,o)):Promise.resolve(s.gpu),s}function Q_(){return"ontouchstart"in window||navigator.maxTouchPoints>1}function ml(e,t){const s=ls(e,["ipad","mac","macos"]),i=ls(e,["iphone"]),n=navigator.platform==="MacIntel";return!!(!i&&s&&n&&t)}function J_({hasTouch:e,userAgent:t}){const s=["ios","iphone","ipad","phone","android","blackberry"],i=Math.max(screen.width,screen.height)>900,n=ml(t,e),o=!!(n||e&&ls(t,s)),a=!!(o&&(n||i)),r=!o;return{desktop:r,mobile:o,tablet:a,phone:!r&&!a}}function ey({hasTouch:e,type:t,userAgent:s}){if(ml(s,e))return"ios";const i={desktop:{windows:["windows","iemobile"],linux:["linux"],macos:["mac os"]},mobile:{android:["android"],ios:["ipad","iphone"],blackberry:["blackberry"]}},n=t.desktop?i.desktop:i.mobile;return bo(s,n)||Cn}function ty({userAgent:e,os:t}){const s=bo(e,pl);return s||(t==="ios"?"safari":Cn)}function sy({userAgent:e,browser:t}){const s=i=>{const n=e.split(i)[1];if(!n||n.length<=0)return;const o=parseFloat(n.split(" ")[0].split(".")[0].replace(/[^.0-9]/g,""));if(!isNaN(o))return o};switch(t){case"chrome":case"firefox":pl[t].forEach(n=>{const o=s(n);if(o!==null||o!==void 0)return o});return;case"safari":let i=e.match(/version\/([.\d]+)/i);return i&&i[1]?parseFloat(i[1]):(i=e.match(/os ([0-9_]+)/i),i&&i[1]?parseFloat(i[1].split("_")[0]):void 0);case"ie":case"edge":return ls(e,["msie"])?s("msie"):ls(e,["rv:"])?s("rv:"):s("edge/");default:return}}async function ny({os:e,webgl:t}){const s={string:null,quality:{low:!0},qualityIndex:1,type:null,series:null,version:null,numbers:[],isMobile:null},i={intel:["intel"],nvidia:["nvidia","geforce"],amd:["amd","radeon"],adreno:["adreno"],apple:["apple"],mali:["mali"],swiftshader:["swiftshader"]},n=t&&t.rendererInfos,o=t&&t.rendererUnmasked||"";return!n||!o.length||(s.string=Ga(o),s.type=bo(s.string,i)||Cn,s.type===Cn)||(e==="ios"&&s.string==="apple gpu"&&(s.string=await ry(),s.string=Ga(s.string)),s.isMobile=s.string[s.string.length-1]==="m",Object.assign(s,oy(s.string)),s.series=ay(s.string),Object.assign(s,ly(n,s))),s}function iy(e,t){const s=["WEBKIT_","MOZ_"];let i=t.getSupportedExtensions()||[];i=i.reduce((l,c)=>{for(let u=0;u<s.length;u++)if(!c.indexOf(s[u]))return l[c.substring(s[u].length)]=c,l;return l[c]=c,l},{});const n="WEBGL_compressed_texture_",o=["s3tc","astc","etc","pvrtc"].reduce((l,c)=>(l[c]=!!i[n+c],l),{}),a=t.getExtension(i.WEBGL_debug_renderer_info),r=a?t.getParameter(a.UNMASKED_RENDERER_WEBGL):"";return{renderer:(t.getParameter(t.RENDERER)||"").toLowerCase(),rendererInfos:a,rendererUnmasked:r,version:(t.getParameter(t.VERSION)||"").toLowerCase(),glsl:(t.getParameter(t.SHADING_LANGUAGE_VERSION)||"").toLowerCase(),extensions:i,compressedTextures:o}}function ja(e,t){const s=document.createElement("canvas");let i;try{const n={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e.browser==="safari"&&e.browserVersion===12&&e.type.desktop&&delete n.powerPreference,i=s.getContext("webgl",n)||s.getContext("webgl-experimental",n)||s.getContext("experimental-webgl",n)}catch{}return i}function Ha(e){!e||!e.getExtension("WEBGL_lose_context")||e.getExtension("WEBGL_lose_context").loseContext()}function oy(e){const t=e.split(" "),s=t.map(n=>n.replace(/[\D]/g,"")).filter(n=>n.length>0).map(n=>parseFloat(n)),i=s[0]||null;if(e.startsWith("apple a")){const n=t[1]&&t[1][t[1].length-1];n==="z"?s[1]=100:n==="x"?s[1]=10:s[1]=1}return{numbers:s,version:i}}function ay(e){const t={swiftshader:"swiftshader","apple a":"apple a","apple m2":"apple m2","apple m1":"apple m1","apple m":"apple m","apple gpu":"apple gpu","geforce gtx":"geforce gtx","geforce rtx":"geforce rtx","geforce mx":"geforce mx",titan:"geforce titan","quadro fx":"quadro fx","quadro p":"quadro p","quadro rtx":"quadro rtx","quadro ":"quadro","geforce ":"geforce","tegra ":"tegra","radeon vii":"radeon vii","radeon r7":"radeon r7","radeon r9":"radeon r9","radeon r10":"radeon r10","radeon rx":"radeon rx","radeon pro vega":"radeon pro vega","radeon rx vega":"radeon rx vega","radeon hd":"radeon hd","radeon pro ":"radeon pro","radeon ":"radeon","intel iris ":"intel iris","intel iris plus ":"intel iris plus","intel iris pro ":"intel iris pro","intel hd ":"intel hd","intel uhd ":"intel uhd",adreno:"adreno","mali-t":"mali t","mali-g":"mali g",mali:"mali"},s={};for(const i in t)e.indexOf(i)>-1&&(s[t[i]]=!0);return s}function Ga(e){let t=e.toLowerCase();return t=t.replace(/(\(tm\)|\(r\))/g,""),t=t.trim(),t.includes("angle (")&&t.includes("direct3d")&&(t=t.replace("angle (","").split(" direct3d")[0]),t.includes("nvidia")&&t.includes("gb")&&(t=t.split(/\dgb/)[0]),t}function ry(){return new Promise(e=>e("apple gpu"))}function ly({type:e,browser:t},s){if(!s||!s.type||s.type==="swiftshader")return t==="firefox"&&e.desktop?Ls("medium"):Ls("low");const i=s.isMobile,n=s.type,o=s.series,a=s.version||0;let r=s.numbers[1]||1;const l=s.string.match(/(?:^| )mp(\d)+(?: |$)/i);l&&(r=parseFloat(l[1]));const c=p=>o[p],f={is:c,le:(p,m,g)=>c(p)&&m<=a&&(g===void 0||r<=g),ge:(p,m,g)=>c(p)&&a>=m&&(g===void 0||r>=g),brand:p=>p===n};let b="low";for(let p in Za){const m=Za[p];for(let g=0,y=m.length;g<y;g++){const x=m[g];let S=x.shift();if(S==="mobile"&&!i)continue;if(S==="not-mobile"&&i)continue;f[S]||(S=x.shift());const C=f[S];if(C&&C(...x)){b=p;break}}if(b!=="low")break}return Ls(b)}function Ls(e){const t=K_,s=Math.max(0,Object.values(t).indexOf(e));return{qualities:t,qualityIndex:s,detectedQualityIndex:s}}function cy(e={}){const t={init:s,updateQuality:i};function s(){const o=X_(e.userAgent);Object.assign(t,o),n(t)}function i(o){const a=document.documentElement;if(!t.gpu)return;t.gpu.qualityIndex=o;const r=t.gpu.qualities;for(const l in r)t.gpu&&t.gpu.quality&&(t.gpu.quality[r[l]]=l<=o),a.classList.toggle(r[l],o==l)}function n(o){const a=document.documentElement;o.hasTouch&&a.classList.add("touch");for(const r in o.type)o.type[r]&&a.classList.add(r.toLowerCase());o.browser&&o.browser.length>0&&a.classList.add(o.browser.toLowerCase()),o.os&&o.os.length>0&&o.os!=="Unknown"&&a.classList.add(o.os.toLowerCase())}return function(a){a.config.globalProperties.$device=t,a.provide("device",t),a.onBeforeMount(async()=>{await t.gpuDetectionFinished,i(t.gpu.qualityIndex)})}}function uy(){const e={trackEvent:t};function t(s,i={}){typeof window.tc_events_19<"u"?setTimeout(()=>{window.tc_events_19(this,s,i)},60):typeof window.dataLayer<"u"&&setTimeout(()=>{window.dataLayer.push({event:s,...i})},60)}return function(i){i.provide("analytics",e);const n=i.config.globalProperties;n.$analytics=e,n.$trackEvent=e.trackEvent}}function dy(){}const Di={},cn={},kn={};let hy=0,fy=window.navigator.vendor.includes("Apple");function py(e,t,s,i){try{return e.start(t,s,i),!1}catch{return!0}}function Wa(e){try{return e.stop(),!1}catch{return!0}}function qa(e){return Di[e]||(Di[e]=new Promise(t=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=async()=>{t(s.response)},s.send()})),Di[e]}function gl(e,t){return e?kn[t]?Promise.resolve(t):(cn[t]||(cn[t]=new Promise(s=>{qa(t).then(i=>{e.decodeAudioData(i,n=>{kn[t]=n,s(t),cn[t]=null})})})),cn[t]):qa(t)}class nt{constructor(t){this.onEnded=this.onEnded.bind(this),this.onLoaded=this.onLoaded.bind(this),this.controller=t,this.context=t.getContext(),this.input=null,this.output=this.context.createGain()}reset(t={}){this.onStop=null,this.stop(),this.pausedProgress=0,this.fadein=t.fadein||0,this.fadeout=t.fadeout||0,this.fadeinTimer=0,this.fadeoutTimer=0,this.fadeinActive=!1,this.fadeoutActive=!1,this.needsPlay=!1,this.isPlaying=!1,this.isStopping=!1,this.hasEnded=!1,this.loaded=!1,this.stopped=!1,this.fixedTimeStep=0,this.id=t.id||null,this.clearBuffer(),this.source=null,this.buffer=null,this.loop=!!t.loop,this.autoplay=!!t.autoplay,this.playbackRate=t.playbackRate||1,this.volume=t.volume!=null?t.volume:1,this.realvolume=-1,this.loopStart=t.loopStart||0,this.loopEnd=t.loopEnd||0,this.onStop=t.onStop||dy,this.baseOffset=t.start||t.baseOffset||0,this.duration=t.duration;const s=t.input||this.controller.getInput();s!==this.input&&(this.input&&this.output.disconnect(this.input),this.input=s,this.output.connect(this.input)),this.path=t.path;let i=this.requestID=++hy;kn[this.path]?this.onLoaded(this.path):gl(this.context,t.path).then(n=>{(this.requestID=i)&&this.onLoaded(n)}),this.autoplay&&this.play()}onLoaded(t){if(this.isStopping||this.stopped)return this.realstop();if(this.stopped)return this.realstop();const s=kn[t];this.loaded=!0,this.buffer=s,this.needsPlay&&this.play()}onEnded(){this.loop||(this.hasEnded=!0,this.stop())}getOutput(){return this.output}update(t){if(!this.source)return;this.fixedTimeStep&&(t=this.fixedTimeStep);let s=this.volume;if(this.fadeinActive){this.fadeinTimer+=t;const i=be(this.fadeinTimer/this.fadein,0,1);s*=i,i===1&&(this.fadeinActive=!1)}if(this.fadeoutActive){this.fadeoutTimer+=t;const i=be(1-this.fadeoutTimer/this.fadeout,0,1);s*=i,i===0&&this.realstop()}s!==this.realvolume&&this.setVolume(s)}play(){if(this.source&&this.stop(),!this.loaded){this.needsPlay=!0;return}const t=this.source=this.context.createBufferSource();if(t.buffer=this.buffer,t.onended=this.onEnded,this.startTime=this.context.currentTime,this.isPlaying=!0,this.needsPlay=!1,!t||!t.buffer)return this.stop();this.progressStart=this.startTime-this.offset,this.duration||(this.duration=t.buffer.duration);const s=Math.max(this.duration-this.offset,.01);if(this.connect(),this.setLoop(this.loop),!this.isStopping&&py(this.source,this.startTime,(this.baseOffset+this.offset)%t.buffer.duration,this.loop?void 0:s)){requestAnimationFrame(()=>this.stop());return}this.fadein&&this.fadeinTimer===0?this.setVolume(0,!0):this.setVolume(this.volume,!0),this.fadein&&(this.fadeinActive=!0),this.setPlaybackRate(this.playbackRate)}getCurrentTime(){return this.getProgress()*this.duration}getProgress(){return this.isPlaying?(this.context.currentTime-this.progressStart)/this.duration:this.pausedProgress}connect(){this.source.connect(this.getOutput())}disconnect(){this.source.disconnect(this.getOutput())}clearBuffer(){if(this.context&&this.context.clearBufferSource?this.source&&this.context.clearBufferSource(this.source):this.source&&(this.source.onended=null,this.source.disconnect(0)),fy)try{this.buffer=this.context.scratchBuffer}catch{}this.source=null}pause(){this.pausedProgress=this.getProgress(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.needsPlay=!1,this.isPlaying=!1,this.source&&(Wa(this.source),this.clearBuffer())}realstop(){this.onStop&&this.onStop(this),this.onStop=null,this.offset=0,this.needsPlay=!1,this.isPlaying=!1,this.isStopping=!1,this.fadeinActive=!1,this.fadeoutActive=!1,this.stopped=!0,this.source&&(Wa(this.source),this.clearBuffer())}stop(t={}){if(!this.isStopping){if(this.isStopping=!0,!this.source||!this.loaded)return this.realstop();t.fadeout&&(this.fadeout=t.fadeout),this.fadeout?this.fadeoutActive=!0:this.realstop()}}getPlaybackRate(){return this.playbackRate}setPlaybackRate(t){this.playbackRate=t,!(!this.isPlaying||!this.source)&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01)}getLoop(){return this.loop}setLoop(t){this.loop=t,!(!this.isPlaying||!this.source)&&(this.source.loop=this.loop,this.source.loopStart=this.loopStart,this.source.loopEnd=this.loopEnd)}getVolume(){return this.output.gain.value}setVolume(t,s,i=.01){this.realvolume=t,s&&(this.output.gain.value=this.realvolume),this.output.gain.setTargetAtTime(this.realvolume,this.context.currentTime,i)}release(){nt.release(this)}}nt.pool=[];nt.get=function(t,s){const i=nt.pool.pop()||new nt(t);return i.reset(s),i};nt.release=function(t){t.clearBuffer(),t.buffer=null,t.onStop=null,nt.pool.length<50&&nt.pool.push(t)};const xo=window.performance||window.Date,vl=["click","touchstart","touchend","keydown"],Ya=window.AudioContext||window.webkitAudioContext,my=44100;let Ze=null,gy=!1;const ge={initialized:!1,unlocked:!1,unlockerListening:!0,lastStuckCheck:xo.now(),stuckTimer:0,previousWebAudioTime:0},lt={onContextCreation:null,onUnlock:null,onStuck:null};function vy(e){const t=new ArrayBuffer(10),s=new DataView(t);return s.setUint32(0,e,!0),s.setUint32(4,e,!0),s.setUint16(8,1,!0),`data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA${window.btoa(String.fromCharCode(...new Uint8Array(t))).slice(0,13)}AgAZGF0YQcAAACAgICAgICAAAA=`}let _y=window.navigator.vendor.includes("Apple");function yy(){try{return new Ya().close(),new Ya}catch{return null}}function wo(){ge.unlocked||(xy(),Ze.suspend(),window.setTimeout(()=>Ze.resume(),10),by(),ge.unlocked=!0,ge.stuckTimer=-800,ge.lastStuckCheck=xo.now(),lt.onUnlock&&lt.onUnlock())}function _l(){ge.unlocked=!1,ge.unlockerListening=!0;for(const e of vl)document.addEventListener(e,wo,{passive:!0,capture:!0})}function by(){ge.unlockerListening=!1;for(const e of vl)document.removeEventListener(e,wo,{passive:!0,capture:!0})}function xy(){if(Ze)return;Ze=yy();const e=Ze.scratchBuffer=Ze.createBuffer(1,1,22050);Ze.clearBufferSource=t=>{if(t&&(t.onended=null,t.disconnect(0),_y))try{t.buffer=e}catch{}},ge.initialized=!0,lt.onContextCreation&&lt.onContextCreation(Ze),yl()}async function wy(){await void 0&&wo()}function Sy(){ge.initialized||(vy(my),_l(),wy())}function yl(){window.requestAnimationFrame(yl);const e=xo.now(),t=e-ge.lastStuckCheck;if(!ge.initialized||!Ze||t<400)return;const s=Ze.currentTime,i=s===ge.previousWebAudioTime;ge.stuckTimer=i?ge.stuckTimer+t:0,ge.previousWebAudioTime=s,ge.lastStuckCheck=e,ge.stuckTimer>400&&ge.unlocked&&!ge.unlockerListening&&(_l(),lt.onStuck&&lt.onStuck())}function $y(e){return e.gain.value}function My(e,t){e.gain.setValueAtTime(t,Ze.currentTime)}const pt={init:Sy,getVolume:$y,setVolume:My,getContext:()=>Ze,isUnlocked:()=>ge.unlocked,set debug(e){gy=e},set onContextCreation(e){lt.onContextCreation=e},set onUnlock(e){lt.onUnlock=e},set onStuck(e){lt.onStuck=e}},{resolveUrl:Cy}=window.MM_EXPERIENCE_CONFIG,ky=0,Ty=Math.log(10)*.05,Ka=e=>Math.exp((e+ky)*Ty);function Ey(){const e=M.$baluchon.get("audio");for(const n in e)e[n].path=Cy(e[n].path);const t=(n,o)=>e[n]&&Object.assign(e[n],o),s={volume:Ka(0),loop:!0,fadein:1e3,fadeout:1e3},i={volume:Ka(-9),loop:!1};return t("Music_Shared_Intro_Result_Drone",{...s}),t("01/Music_Chap1_Layer1",{...s}),t("01/Music_Chap1_Layer2",{...s}),t("01/Music_Chap1_Layer3",{...s}),t("01/Music_Chap1_Layer4",{...s}),t("02/Music_Chap2_Layer1",{...s}),t("02/Music_Chap2_Layer2",{...s}),t("02/Music_Chap2_Layer3",{...s}),t("02/Music_Chap2_Layer4",{...s}),t("03/Music_Chap3_Layer1",{...s}),t("03/Music_Chap3_Layer2",{...s}),t("03/Music_Chap3_Layer3",{...s}),t("03/Music_Chap3_Layer4",{...s}),t("bgm_Amb_Chap1_Loop",{...s}),t("sfx_Pickup_Small_Combo",{...i}),e}const un=W(ne.linear),$e=W(ne.outSine),Ii=W(ne.inCubic);W(ne.outQuint);W(ne.outCubic);const zi=W(ne.outExpo);W(ne.inOutQuad);let Xa=null;const mt={intro:{sample:"Music_Shared_Intro_Result_Drone",inEase:$e,outEase:$e,inDuration:5,outDuration:6},wind:{sample:"bgm_Amb_Chap1_Loop",outEase:$e,inDuration:3,outDuration:3},soc_layer_1:{sample:"01/Music_Chap1_Layer1",inEase:zi,outEase:$e,inDuration:8,outDuration:20},soc_layer_2:{sample:"01/Music_Chap1_Layer2",outEase:$e,inDelay:8,inDuration:10,outDuration:10},soc_layer_3:{sample:"01/Music_Chap1_Layer3",outEase:$e,inDelay:14,inDuration:10,outDuration:17},soc_storm:{sample:"01/Music_Chap1_Layer4",outEase:$e,inEase:Ii,inDuration:3,outDuration:9,isStorm:!0},fl_layer_1:{sample:"02/Music_Chap2_Layer1",inEase:zi,outEase:$e,inDuration:8,outDuration:20},fl_layer_2:{sample:"02/Music_Chap2_Layer2",outEase:$e,inDelay:8,inDuration:10,outDuration:10},fl_layer_3:{sample:"02/Music_Chap2_Layer3",outEase:$e,inDelay:14,inDuration:10,outDuration:17},fl_storm:{sample:"02/Music_Chap2_Layer4",outEase:$e,inEase:Ii,inDuration:3,outDuration:9,isStorm:!0},sn_layer_1:{sample:"03/Music_Chap3_Layer1",inEase:zi,outEase:$e,inDuration:8,outDuration:20},sn_layer_2:{sample:"03/Music_Chap3_Layer2",outEase:$e,inDelay:8,inDuration:10,outDuration:10},sn_layer_3:{sample:"03/Music_Chap3_Layer3",outEase:$e,inDelay:14,inDuration:10,outDuration:17},sn_storm:{sample:"03/Music_Chap3_Layer4",outEase:$e,inEase:Ii,inDuration:3,outDuration:9,isStorm:!0}},Kt=Object.entries(mt).map(([e,t])=>({name:e,...t}));let Qa="",Fi={value:1},dn=null;const Qi={home:["intro","soc"],soc:["soc_layer_1","soc_layer_2","soc_layer_3","soc_storm","wind"],fl:["fl_layer_1","fl_layer_2","fl_layer_3","fl_storm","wind"],sn:["sn_layer_1","sn_layer_2","sn_layer_3","sn_storm","wind"],results:["intro"]},Py=Object.keys(Qi);function Ly(e){async function t(){Kt.forEach(u=>{if(!u.isStorm)return;const h=M.$device.type.mobile;u.originSample||(u.originSample=u.sample),u.sample=h?mt.soc_storm.sample:u.originSample}),c()}function s(){}async function i(u,h={}){Qa=u;const d=Qi[Qa];Xa=d,await n(),Kt.forEach((f,b)=>{var y,x;const p=d.includes(f.name);f.isActive=p;let m=!1;const g={...h};if(p){if(!f.instance){if(f.instance=e.playSound(f.sample,{autoplay:!1}),!f.instance)return;f.baseVolume=f.instance.volume,f.instance.volume=0}(y=f.name)!=null&&y.includes("storm")&&(g.volume=0,m=!0)}f.currentVolume=((x=f.instance)==null?void 0:x.volume)||0,o(f.name,f.isActive,{force:!0,reset:!0,instant:m,...g})})}async function n(){let u=[];if(!mt.intro.instance&&!mt.intro.isPromised&&(mt.intro.isPromised=!0,u.push(e.preloadSound(mt.intro.sample))),Xa.forEach(h=>{if(h!=="intro")if(Py.includes(h))Qi[h].forEach(d=>{const f=mt[d];!f||f.instance||f.isPromised||(f.isPromised=!0,u.push(e.preloadSound(f.sample)))});else{const d=mt[h];if(!d||d.instance||d.isPromised)return;d.isPromised=!0,u.push(e.preloadSound(d.sample))}}),u.length)return await Promise.all(u)}function o(u,h,{force:d=!1,reset:f=!1,instant:b=!1,volume:p,...m}={}){var O;const g=Kt.find(D=>D.name===u);if(!g||!g.instance||g.isActive===h&&!d)return;g.tween&&g.tween.destroy(),g.isActive=h,h&&f&&((O=g.instance)==null||O.realstop(),g.instance=e.playSound(g.sample),g.instance.volume=0,g.currentVolume=0);const{inDelay:y=0,outDelay:x=0,inDuration:S=1,outDuration:C=1,inEase:w=un,outEase:v=un}=g,$=g.isActive?p??g.baseVolume:0,P=b?0:(h?y:x)*1e3,T=b?un:h?w:v,L=b?1:(h?S:C)*1e3;$===g.currentVolume&&!d||(g.tween=le({onComplete:()=>{g.instance.volume<=.001&&!h&&f&&(g.instance.realstop(),g.instance=null)}}).to(g,{currentVolume:$,duration:L,ease:T,delay:P,onProgress:()=>{g.instance.volume=g.currentVolume*Fi.value},...m}))}function a(u={}){Kt.forEach(h=>{!h.isActive||!h.instance||o(h.name,!1,{...u})})}function r({force:u=!1,...h}={}){Kt.forEach(d=>{if(!d.isActive||!d.instance)return;const f=!d.name.includes("storm");o(d.name,f,{force:u,...h})})}function l(u){dn==null||dn.destroy(),dn=le().to(Fi,{value:u,duration:500,ease:un,onProgress:()=>{Kt.forEach(h=>{!h.isActive||!h.instance||(h.instance.volume=h.currentVolume*Fi.value)})}})}function c(){const u=M.$router.currentRoute.value.name;if(u)switch(u){case"Home":i("home");break;case"Sea of Clouds":i("soc");break;case"Frozen Lake":i("fl");break;case"Starry Night":i("sn");break}}return{onUnlock:t,setState:i,restart:s,toggle:o,enter:r,exit:a,resetState:c,volume:l}}const Me=(e,t)=>e!==void 0?e:t,Ay=(e,t)=>Math.random()*(t-e)+e;function Oy(){let e=!1,t=!1,s,i,n,o=Pe({});const a={},r={},l=new Set,c=A=>A.update(n),u=A=>{(A.timer-=n)>0||(l.delete(A),L(A.id,A.opts))};let h=1;const d={main:1,visible:1,mute:1,smoothMute:1},f={list:o,init:p,play:$,pause:P,stop:T,playSound:L,stopSound:O,preloadSound:U,getContext:()=>s,getInput:()=>i,getMasterVolume:()=>h};for(let A in f)f[A]=Pe(f[A]);const b=Qe(Object.assign(f,{isUnlocked:!1,isMuted:!1}));b.bgm=Pe(Ly(b)),b.setBgm=Pe(A=>b.bgm.setState(A));function p(){t||(t=!0,Object.assign(o,Ey()),pt.debug=!0,pt.onUnlock=S,pt.onContextCreation=g,pt.onStuck=y,pt.init(),yt.add(v),b.isMuted=!!+localStorage.getItem("audio-muted"),He(()=>x(b.isMuted)),He(()=>m(M.$viewport.visible)))}function m(A){s&&(A?($(),d.visible=1):(P(),d.visible=0),w())}function g(A){s=A,i=A.createGain(),i.connect(A.destination)}function y(){T(),b.isUnlocked=!1}function x(A){localStorage.setItem("audio-muted",+!!A),d.mute=A?0:1}function S(){b.isUnlocked=!0,b.bgm.onUnlock(s),M.$webgl&&M.$webgl.quality&&M.$webgl.quality.reset(1e3)}let C=-1;function w(){const A=d;A.smoothMute=Lt(A.smoothMute,A.mute,.1,.001),h=A.main*A.visible*A.smoothMute,h!==C&&(C=h,pt.setVolume(i,h))}function v(A){if(pt.isUnlocked()&&(n=A,l.forEach(u),w(),!e))for(const R in r)r[R].forEach(c)}function $(){if(e){e=!1;for(const A in r)r[A].forEach(R=>{R.loop||R.play()})}}function P(){if(!e){e=!0;for(const A in r)r[A].forEach(R=>{R.loop||R.pause()})}}function T(){for(const A in r)r[A].forEach(R=>R.stop())}function L(A,R={}){if(R.delay,!pt.isUnlocked())return;const z=o[A];if(!z)return;if(R.delay){const K=R.delay;delete R.delay,l.add({id:A,opts:R,timer:K});return}const Y=performance.now();if(R.throttle&&(a[A]||(a[A]=0),Y-a[A]<R.throttle))return;a[A]=Y;const ce=R.unique||z.unique;if(r[A]||(r[A]=new Set),ce&&r[A].size>0){const K=r[A].values().next().value;if(!K.isPlaying||K.isStopping)K.realstop();else if(K)return K}if(R.id=A,R.path=z.path,R.onStop=D,R.autoplay=R.autoplay??!0,R.loop=Me(R.loop,!!z.loop),R.fadein=R.fadein||z.fadein,R.fadeout=R.fadeout||z.fadeout,z.variations){let K=R.variation&&z.variations[R.variation-1];K||(K=Pc(z.variations)),R.start=Me(R.start,K.start),R.duration=Me(R.duration,K.duration),R.loopStart=Me(R.loopStart,Me(K.loopStart,R.start)),R.loopEnd=Me(R.loopEnd,Me(K.loopEnd,R.start+R.duration))}else R.start=Me(R.start,z.start),R.duration=Me(R.duration,z.duration),R.loopStart=Me(R.loopStart,Me(z.loopStart,R.start)),R.loopEnd=Me(R.loopEnd,Me(z.loopEnd,R.start+R.duration));R.volume=Me(R.volume,Me(z.volume,1));const oe=z.randomRate??R.randomRate;R.playbackRate=oe?Ay(oe[0],oe[1]):R.playbackRate!=null?R.playbackRate:1;const ue=nt.get(b,R);return r[A].add(ue),ue}function O(A,R={}){const z=r[A];z&&z.forEach(Y=>Y.stop(R))}function D(A){const R=r;A.release();const z=R[A.id];z&&z.delete(A)}function U(A){const R=o[A];if(!R)return;const z=R.path;return gl(s,z)}return function(R){R.config.globalProperties.$audio=b,R.provide("audio",b)}}function Ry({manifestURL:e,urlResolver:t=null,processorHelpers:s=null,basepath:i="/"}){const n={},o={},a={},r={};let l,c=!1,u={},h={},d={};t===null&&(t=function(S=""){return S.startsWith("/")&&(S=S.slice(1)),i+S});const f=Pe({init:b,basepath:i,manifest:h,composites:d,processors:u,registerComposite:y,get:p});async function b(){if(c||!i)return;c=!0;const[S,C]=await Promise.all([e?fetch(e).then(v=>v.json()):{},s]);s=C.default??C,Object.assign(h,S);let w=new Map;for(const v in S){const P=S[v].type;if(!s[P]||u[P])continue;const T=s[P];if(w.has(T))u[P]=w.get(T);else{const L=u[P]=T(l,f);w.set(T,L)}}w=Array.from(w.values()),await Promise.all(w.map(v=>{if(v.setup)return v.setup()}));for(const v in S){const $=S[v],P=$.type,T=u[P];for(const L in $.files){const O=g(v,L),D=g(null,L);let U=$.files[L];T&&T.preformat&&(U=T.preformat(U,L,$,P,v)??U),typeof U=="string"&&(U=x(U,!1)),$.files[L]=U,o[D]=[v,L],a[O]=v,n[O]?Array.isArray(n[O])?n[O].push(U):n[O]=[n[O],U]:n[O]=U}}await Promise.all(w.map(v=>{if(v.postsetup)return v.postsetup()}))}function p(S="",C={}){if(l.$device.type.phone&&!S.endsWith("-mobile")){const D=p(S+"-mobile",C);if(D)return D}const w=g(null,S);let v=0,$,P,T=a[w];if(T!=null&&(v=T.length,$=h[T],P=S.slice(v+1)),$==null&&h[S]&&!C.forceArray){T=S,$=h[T];const D=r[S]??(r[S]=Object.keys($.files));D.length===1&&(v=S.length,P=D[0])}if($==null){const D=o[w];D&&(T=D[0],$=h[T],v=T==null?void 0:T.length,P=D[1])}if($==null){const D=d[T]??d[S];return D?P?typeof D=="function"?D(P,C):D[P]??null:D:null}if(P==null||P.length===0)return m($);let L=null;if($[P])L=$[P];else{const D=g(T,P);n[D]&&(L=n[D])}const O=u[$.type];return O&&O.getter?O.getter(L,C,P,T,$.type)??L:L}function m(S){if(S.filesArray)return S.filesArray;const C=S.filesArray=[],w=Object.entries(S.files);for(let v=0;v<w.length;v++){const[$,P]=w[v],T=$.lastIndexOf("."),L=T<0?$.length:T;C.push(je({id:$.slice(0,L),value:P}))}return C}function g(S,C){const w=C.lastIndexOf("."),v=w<0?C.length:w;return S=S==null?"":S+"/",(S+C.slice(0,v)).toLowerCase()}function y(S,C){return h[S]?null:d[S]?d[S]:d[S]=C}function x(S,C=!0){if(S==null||S.startsWith("http://")||S.startsWith("https://"))return S;if(C||S.split("/").pop().includes("."))return t(S)}return function(C){l=C.config.globalProperties,l.$baluchon=f}}function Dy(e,t){const s=t.basepath;return{setup:i,preformat:n};async function i(){await yn.test()}function n(o){const a=yn.supports,r=s+o[0],l={};for(let u=0;u<o[3].length;u++){let h=o[3][u];const d=h==="png"||h==="jpg"?"default":h;l[d]=r+"."+h}let c=l.default;return a.avif&&l.avif?c=l.avif:a.webp&&l.webp&&(c=l.webp),je({url:c,width:o[1]??0,height:o[2]??0,ratio:o[1]/o[2],offsetLeft:o[4]??0,offsetTop:o[5]??0,urls:je(l)})}}function Iy(e,t){const s=t.basepath;return{preformat:i};function i(n){return je({url:s+n[0],width:n[1]??0,height:n[2]??0})}}function zy(e,t){const s=t.basepath;return{preformat:i};function i(n){let o=n[1];return o=n[1],s+o}}function Ja(e,t){let s={};return{preformat:n,postsetup:i};function i(){s=je(s),t.registerComposite("audio",s)}function n(o,a,r,l,c){const u=e.$device.type.mobile,h=u&&c.startsWith("m_")||!u&&!c.startsWith("m_");if(l==="bgm"&&h){const d=a.replace(/\.(wav|aiff)$/,"");return s[d]=je({id:d,path:o,loop:!0,unique:!0}),s[d]}else if(l==="sfx"&&h){const d=o[0],f=o[1],b={};for(let p=0;p<f.length;p++){const[m,g,y,x]=f[p];b[m]=s[m]=je(Array.isArray(g)?{id:m,path:d,variations:je(g.map(S=>({id:m,start:S[0],end:S[1],duration:S[2]})))}:{id:m,path:d,start:g,end:y,duration:x})}return je(b)}}}function Fy(e,t){const s=t.basepath;return{setup:i,preformat:n};async function i(){await yn.test()}function n(o){const a=s+o[0],[r,l]=er(a,o[3]),c={url:r,data:a+".json",width:o[1]??0,height:o[2]??0,ratio:o[1]/o[2],urls:je(l)};if(o.length>4){const u=s+o[4],[h,d]=er(u,o[7]);c.normal={url:h,data:u+".json",width:o[5]??0,height:o[6]??0,ratio:o[5]/o[6],urls:je(d)}}return je(c)}}const er=(e,t)=>{const s={},i=yn.supports;for(let o=0;o<t.length;o++){let a=t[o];const r=a==="png"||a==="jpg"?"default":a;s[r]=e+"."+a}let n=s.default;return i.avif&&s.avif?n=s.avif:i.webp&&s.webp&&(n=s.webp),[n,s]},Uy={img:Dy,basis:Iy,gltf:zy,bgm:Ja,sfx:Ja,texturePacker:Fy},Ji=window.MM_EXPERIENCE_CONFIG.resolveUrl;Ee.setBasepath(Ji(""));const Ny=[Ah,C_,F_,I_,L_,E_,q_,cy,R_,Dh,uy,Oy,[Ry,{manifestURL:Ji("baluchon-3yxmgdh.manifest.json"),urlResolver:Ji,processorHelpers:Uy}]],By=()=>!0,vn=8456153,hn={Default:{enter:"default",color:vn,async load(e,t,s){await M.$loadChapter("sea_of_clouds")}},Home:{enter:"none",color:vn,async load(e,t,s){await M.$loadChapter("sea_of_clouds")}},"Frozen Lake":{enter:"default",color:vn,async load(e,t,s){await M.$loadChapter("frozen_lake")}},"Sea of Clouds":{enter:"default",color:8456153,async load(e,t,s){await M.$loadChapter("sea_of_clouds")}},"Starry Night":{enter:"default",color:8456153,async load(){await M.$loadChapter("starry_night")}}};async function Vy(){const e=M.$router;e.beforeEach(l),e.afterEach(c);let t=!0,s=null,i=0;const n={type:null,color:null,uid:-1},{from:o,to:a}=e.firstRoute.value??{},r=await l(a,o);typeof r=="object"&&e.push(r);async function l(u,h){const d=t,f=M.$user.currentLevel,p=!1;if(!f&&u.name!=="Home"&&!p)return{name:"Home"};if(f&&u.name!==M.$user.currentLevel&&!p)return{name:M.$user.currentLevel};if(s)return!1;const m=M.$webgl.$transition,g=hn[h.name]??hn.Default,y=hn[u.name]??hn.Default;if(y!=null&&y.guard){const v=y.guard(u,h,p,d);if(v instanceof Object||v===!1)return v}M.$store.runningTransition=s=!0;const x=++i;let S=h.name==="Home"&&u.name==="Sea of Clouds"?"none":y==null?void 0:y.enter;S==null&&(S="default"),d&&(S="none"),u.name===h.name&&(S="none");const C=(g==null?void 0:g.color)??vn;if(S==="simple"?await(m==null?void 0:m.inSimple(C)):S==="default"&&await(m==null?void 0:m.in(h.name,u.name)),S!=="none"){M.$store.isSpinnerVisible=!0;const v=Math.random()*500+500;M.$store.percentLoaded=0,await Q(1e3),le().to(M.$store,{percentLoaded:H.randomInt(28,46),duration:v,delay:1e3,onProgress:Ui}),await Q(v+1e3),le().to(M.$store,{percentLoaded:H.randomInt(63,72),duration:Math.random()*500+500,onProgress:Ui})}let w=!0;try{w=await(y.load??By)(u,h,p,d)}catch{w=!1}return n.type=S,n.colorFrom=h.name,n.colorTo=u.name,n.uid=x,M.$store.runningTransition=s=null,w??!0}async function c(){if(t=!1,n.uid!==i)return;const{type:u,colorFrom:h,colorTo:d}=n,f=M.$webgl.$transition;n.uid=-1,u!=="none"&&le().to(M.$store,{percentLoaded:100,duration:Math.random()*200+100,onProgress:Ui,onComplete:()=>{M.$store.isSpinnerVisible=!1}}),u==="simple"?await(f==null?void 0:f.outSimple()):u==="default"&&await(f==null?void 0:f.out(h,d))}}const Ui=(e,t)=>{M.$store.percentLoaded=Math.ceil(M.$store.percentLoaded)},Zy="20231114-170930";window.VV_VERSION=Zy;const bl=document.createElement("style");bl.innerHTML=`
	html, body, .xp-wrapper * {
		padding: 0;
		margin: 0;
		box-sizing: border-box;
	}
`;document.head.insertBefore(bl,document.head.firstChild);let Es=document.querySelector("meta[name=viewport]");Es||(Es=document.createElement("meta"),Es.setAttribute("name","viewport"),document.head.appendChild(Es));Es.setAttribute("content","width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover");document.addEventListener("contextmenu",e=>{e.target.closest(".xp-wrapper")&&e.preventDefault()});async function jy(){var o,a;const e=gh(fh),t=await e.installPlugins(Ny);await t.$device.init(),await t.$baluchon.init(),await t.$i18n.init(),await t.$audio.init();const s=document.getElementById("mm-experience-wrapper");if(s.classList.add("xp-wrapper"),((o=t.$i18n.current.systemfont)==null?void 0:o.length)&&s.classList.add("use-system-fonts"),((a=t.$i18n.current.ligation)==null?void 0:a.length)&&s.classList.add("use-ligation"),!s)throw new Error("Missing #mm-experience-wrapper");await t.$user.init(),t.$loadChapter=r=>{if(t.$webgl.loadScene)return t.$webgl.loadScene(r);t._sceneQueue||(t._sceneQueue=new Set),t._sceneQueue.add(r)},await Vy(),e.mount(s),setTimeout(()=>{const r=document.documentElement;r==null||r.classList.add("preload-finished")},1e4)}const Xy=Object.freeze(Object.defineProperty({__proto__:null,default:jy},Symbol.toStringTag,{value:"Module"}));export{ke as B,Ne as E,n1 as H,c1 as L,P2 as M,wp as P,_t as S,Or as T,H1 as Z,M as a,dg as b,po as c,St as d,rl as e,ov as f,Ky as g,re as h,_ as i,Yy as j,M1 as k,ol as l,f2 as m,eg as n,x1 as o,Xy as p,le as w};
