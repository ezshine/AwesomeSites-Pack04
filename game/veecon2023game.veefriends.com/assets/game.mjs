import{B as Ms,a as Ls,C as Is,M as wt,R as Fs,S as xt,W as As,L as ft,b as Ds,V as E,O as J,c as x,Q as ri,d as A,E as Y,T as Bs,e as Ps,f as Rs,A as Os,N as Us,g as gi,s as Gs,P as Ke,I as zs,D as Ns,h as js,i as Vs,j as Ae,k as Yt,l as is,m as qs,F as Hs,n as Ws,o as Ys,p as Ks,G as ke,q as Qs,r as Xs,t as Zs,u as Js,v as en,w as _t,x as bi}from"./vendor-ae99e4cc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function ss(){let i,e;const t=new Promise((s,n)=>{i=s,e=n});return t.resolve=i,t.reject=e,t}function H(i){return new Promise(e=>setTimeout(e,i))}function tn(i,e=1,t={},s){const n=t.bind||null,o=t.trail!=null?!!t.trail:!0,r=t.tail!=null?!!t.tail:!0;let a,l,c,h=null,d=o,u=!1;function p(){h=null,o&&!u&&(d=!0),i.call(n,a,l,c),s&&u&&r&&(u=!1,h=setTimeout(p,e))}return function(g,_,M){s||(clearTimeout(h),h=null),a=g,l=_,c=M,o&&d&&(d=!1,i.call(n,a,l,c)),h===null?h=setTimeout(p,e):s&&(u=!0)}}function St(){let i=0;return()=>{const e=i=i+1|0;return()=>e!==i}}const V={usePlugins:nn};function sn(i){if(!window.isOldBrowser){const e=document,t="DOMContentLoaded";e.readyState[0]==="l"?e.addEventListener(t,i):i()}}function nn(i=[]){Array.isArray(i)||(i=[i]);const e=[];return i.forEach(t=>{if(typeof t!="function")return;const s=t(V);typeof s=="function"&&e.push(s)}),e.forEach(t=>t(V)),V}function vi(i,e,t,s){this.fn=e,this.ctx=t||null,this.owner=i,this.once=!!s}function Et(i){if(!i||!i.owner)return;i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev);const e=i.owner;i.ctx=i.fn=i.owner=null,i===e._first&&(e._first=i.next),i===e._last&&(e._last=i.prev)}class pt{constructor(){this._first=this._last=null,this._isStoreSignal=!0}emit(e,t,s){let n=this._first;for(;n;)n.fn.call(n.ctx,e,t,s),n.once&&this.unwatch(n),n=n.next}watch(e,t,{once:s=!1,immediate:n=!1,force:o=!1}={}){if(!o&&this.checkStack(e,t))return e;const r=new vi(this,e,t,s);return this._first?(this._last.next=r,r.prev=this._last,this._last=r):(this._first=r,this._last=r),n&&e.call(t,this.value),r}watchOnce(e,t){return this.watch(e,t,{once:!0})}watchImmediate(e,t){return this.watch(e,t,{immediate:!0})}unwatch(e,t){if(e instanceof vi)return Et(e);t||(t=null);let s=this._first;for(;s;)s.fn===e&&s.ctx===t&&Et(s),s=s.next}unwatchAll(){let e=this._first;for(this._first=this._last=null;e;)Et(e),e=e.next}checkStack(e,t){let s=this._first;for(;s;){if(s.fn===e&&s.ctx===t)return t.warn,s;s=s.next}return!1}}pt.prototype.destroy=pt.prototype.unwatchAll;function $e(){return new pt}const Kt=new Set,Xe={stack:Kt,isFrozen:!1,holdEmits:ns,releaseEmits:os,batchUpdates:rn};function ns(){Xe.isFrozen=!0}function os(){Xe.isFrozen=!1,Kt.forEach(on),Kt.clear()}function on(i){i._emit()}function rn(i){return function(e,t,s){ns(),i(e,t,s),os()}}class rs extends pt{constructor(e){super(),this.previous=null,this.value=e}get(){return this.value}set(e,t,s=!1){if(!(!t&&this.value===e)){if(this.previous=this.value,this.value=e,Xe.isFrozen)return Xe.stack.add(this);!s&&this._emit()}}_emit(){let e=this._first;for(;e;)e.fn.call(e.ctx,this.value,this.previous),e.once&&this.unwatch(e),e=e.next;//! Ça déconne ça
}update(e,t){const s=e(this.value);this.set(s!==void 0?s:this.value,t)}}function D(i){return new rs(i)}function an(i,e){const t=new rs,s=t.set.bind(t);delete t.set,i=Array.isArray(i)?i:[i];const n=new Array(i.length);let o=[];for(let l=0,c=i.length;l<c;l++){const h=i[l],d=function(u){n[l]=u,r()};n[l]=h.value,h.watch(d),o.push(h,d)}t.destroy=a,r();function r(){const l=e.apply(null,n);l&&l.then?l.then(s):s(l)}function a(){for(let l=0,c=o.length;l<c;l+=2)o[l].unwatch(o[l+1]);o=null,t.unwatchAll()}return t}const{holdEmits:ln,releaseEmits:cn,batchUpdates:Dl}=Xe,kt=()=>{},yi={},wi=1e3,hn=i=>{try{return JSON.parse(i)}catch{return null}};let xi={};function un(){const i="https://api-games.veefriends.com/v1/games/3a9dd9f9-22b0-40ee-a2f1-f2d7f57e816a";let e,t=wi,s={gameId:null,loginUrl:null,sessionId:null,displayName:"",jwt:null,totp:null,connected:D(!1)};const n={getLeaderboard:u,createSession:r,closeSession:d,updateScore:g,isConnected:s.connected,get session(){return s},waitFirstConnection(){return new Promise(k=>{const v=s.connected.watch(b=>{b&&(s.connected.unwatch(v),k())})})}};let o=St();async function r(){try{h();const k=o(),v=await fetch(`${i}/sessions`);if(k())return yi;const b=await v.json();return k()?yi:(s.gameId=b.data.id,s.loginUrl=b.data.loginUrl,s.sessionId=b.data.sessionId,l(),{session:s})}catch(k){throw console.error(k),k}}let a;function l(){!s||!(s!=null&&s.sessionId)||(h(),e=new EventSource(`${i}/sessions/${s.sessionId}`),e.addEventListener("get-session",c),e.onopen=()=>{t=wi},e.onerror=()=>{h(),a=setTimeout(l,t),t=Math.min(t*2,3e4)})}function c(k){var b;const v=((b=hn(k.data)??{})==null?void 0:b.data)||{};v.jwt&&(s.jwt=v.jwt,s.totp=v.totp,s.userId=v.userId,v.displayName&&(s.displayName=v.displayName),s.connected.set(!0))}function h(){clearTimeout(a),s.connected.set(!1),e&&(e.removeEventListener("get-session",c),e.onmessage=kt,e.onopen=kt,e.onerror=kt,e.close(),e=null)}function d(){o(),h()}async function u(){try{return(await(await fetch(`${i}/scores`)).json()).data.map(m=>({score:m.score,name:m.displayName})).slice(0,10)}catch{return[]}}async function p(k){try{const v=xi[s.userId]??0;if(k<=v)return{status:"no-update"};const b=await _(k);return b===null?{status:"no-update"}:(xi[s.userId]=k,(await fetch(`${i}/scores`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.jwt}`},body:JSON.stringify({score:b,sessionId:s.sessionId})})).status===202?{status:"updated"}:{status:"no-update"})}catch(v){return console.error(v),{status:"no-update"}}}async function g(k=0){const v=H(1100),b=await p(k);return await v,b}async function _(k){if(s.jwt==null)return null;const v=M(k.toString()),b=M(s.totp.padEnd(16,"0"),16),m=await crypto.subtle.importKey("raw",M(s.sessionId.padEnd(16,"0"),16),{name:"AES-CBC"},!1,["encrypt","decrypt"]),w=await crypto.subtle.encrypt({name:"AES-CBC",iv:b},m,v);let T="";const C=new Uint8Array(w);for(let L=0;L<C.length;L++)T+=String.fromCharCode(C[L]);return window.btoa(T)}function M(k,v=null){const b=new TextEncoder;if(v===null)return b.encode(k);const m=new Uint8Array(v);return b.encodeInto(k,m),m.buffer.slice(m.byteOffset,m.byteLength+m.byteOffset)}return function(v){v.$api=n}}const dn=(i,e)=>Math.floor(Math.random()*(e-i))+i;function fn(i){return i[dn(0,i.length)]}function $t(){}const pn={log:$t,warn:$t,error:$t};let as;as=()=>pn;const Ue=as,Si=Math.PI*2;function oe(i,e=0,t=1){return Math.min(Math.max(i,e),t)}function mn(i,e,t,s,n){const o=s+(n-s)*((i-e)/(t-e));let r=s,a=n;return s>n&&(r=n,a=s),Math.max(r,Math.min(a,o))}function Se(i,e=0,t=1){return Math.max(0,Math.min(1,(i-e)/(t-e)))}const ie=Q;function Q(i,e,t){return i*(1-t)+e*t}function ls(i,e,t,s=.001){const n=i*(1-t)+e*t;return Math.abs(e-n)<s?e:n}function Ee(i,e,t,s){return Q(i,e,1-Math.exp(-t*.05*s))}function cs(i,e,t,s,n){return ls(i,e,1-Math.exp(-t*.05*s),n)}function gn(i,e){let t=(e-i)%Si;return 2*t%Si-t}function bn(i,e,t,s){return t=1-Math.exp(-t*.05*s),i+gn(i,e)*t}const je=(3-Math.sqrt(3))/6,Mt=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[1,0],[-1,0],[0,1],[0,-1],[0,1],[0,-1]];function hs(i=Math.random){const e=new Uint8Array(256);for(let r=0;r<256;r++)e[r]=r;let t,s;for(let r=255;r>0;r--)t=Math.floor((r+1)*i()),s=e[r],e[r]=e[t],e[t]=s;const n=new Uint8Array(512),o=new Uint8Array(512);for(let r=0;r<512;r++)n[r]=e[r&255],o[r]=n[r]%12;return(r,a)=>{const l=(r+a)*.5*(Math.sqrt(3)-1),c=Math.floor(r+l),h=Math.floor(a+l),d=(c+h)*je,u=c-d,p=h-d,g=r-u,_=a-p,M=g>_?1:0,k=g>_?0:1,v=g-M+je,b=_-k+je,m=g-1+2*je,w=_-1+2*je,T=c&255,C=h&255,L=Mt[o[T+n[C]]],z=Mt[o[T+M+n[C+k]]],N=Mt[o[T+1+n[C+1]]],B=.5-g*g-_*_,$=B<0?0:Math.pow(B,4)*(L[0]*g+L[1]*_),y=.5-v*v-b*b,F=y<0?0:Math.pow(y,4)*(z[0]*v+z[1]*b),te=.5-m*m-w*w,Fe=te<0?0:Math.pow(te,4)*(N[0]*m+N[1]*w);return 70.14805770653952*($+F+Fe)}}const us="MM"+(Math.floor(Math.random()*1e13)+Date.now());function vn(i){return typeof i=="function"&&(i=i()),function(){i|=0,i=i+1831565813|0;let t=Math.imul(i^i>>>15,1|i);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}function yn(i){let e=1779033703^i.length;for(let t=0;t<i.length;t++)e=Math.imul(e^i.charCodeAt(t),3432918353),e=e<<13|e>>>19;return function(){return e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),(e^=e>>>16)>>>0}}function ds(i=us,e=vn){let t;return s(i),{setSeed:s,random:n,randomFloat:r,randomInt:a,tossCoin:o};function s(l){t=e(yn(l+"")),t()}function n(){return t()}function o(l=.5){return t()<l}function r(l=0,c=1){return t()*(c-l)+l}function a(l=0,c=100){return Math.floor(t()*(c-l+1))+l}}const I=ds(us);I.create=ds;function fs(i=6){const e=new Float64Array(i),t={value:0,push:r,reset:a};let s,n,o;return s=n=o=0,t;function r(l){s<i&&s++,o=(o+1)%i;const c=e[o];return e[o]=l,n+=l-c,t.value=n/s}function a(){s=n=o=0;for(let l=0;l<i;l++)e[l]=0}}const Tt=typeof window>"u"?globalThis:window,Te=[],Ge=[],ze=[];let ve=null,Ce=null,Qe=!1,ai=!1,li,me;function mt(){const i=performance.now();Ce===null&&(Ce=i),me=i-Ce,li+=me,Ce=i,ve=Qe?null:Tt.requestAnimationFrame(mt),Qe&&(Qe=!1);let e;if(ai){for(e=0;e<ze.length;e++)ze[e](me);for(e=0;e<Te.length;e++)Te[e](me);for(e=0;e<Ge.length;e++)Ge[e](me)}else for(e=0;e<Te.length;e++)Te[e](me)}function Ct(){ai=Ge.length>0||ze.length>0}function ci(i,e,t){return!e||!i||~i.indexOf(e)?!1:(t=!!t,t?i.unshift(e):i.push(e),!0)}function hi(i,e){if(!e)return!1;const t=i.indexOf(e);return~t?(i.splice(t,1),i.length===0):!1}function wn(i,e){ci(ze,i,e)&&Ct()}function xn(i,e){ci(Ge,i,e)&&Ct()}function Sn(i,e){ci(Te,i,e)&&ps()}function Tn(i){hi(ze,i)&&Ct()}function Cn(i){hi(Ge,i)&&Ct()}function _n(i){hi(Te,i)&&ui()}function ps(i){Qe=!1,!ve&&(i=!!i,Ce=null,i?mt():ve=Tt.requestAnimationFrame(mt))}function En(){ve||(Qe=!0,Ce=null,ve=Tt.requestAnimationFrame(mt))}function ui(){ve&&(Tt.cancelAnimationFrame(ve),ve=null)}function kn(){ui(),Te.length=0,Ge.length=0,ze.length=0,ai=!1,Ce=null,li=0,me=0}const ms={add:Sn,addAfter:xn,addBefore:wn,remove:_n,removeAfter:Cn,removeBefore:Tn,start:ps,stop:ui,time:li,dt:me,requestOnce:En,dispose:kn},$n=()=>{},Lt={},nt={},gt={};let Mn=0;function Ln(i,e,t,s){try{return i.start(e,t,s),!1}catch{return!0}}function Ti(i){try{return i.stop(),!1}catch{return!0}}function Ci(i){return Lt[i]||(Lt[i]=new Promise(e=>{const t=new XMLHttpRequest;t.open("GET",i,!0),t.responseType="arraybuffer",t.onload=async()=>{e(t.response)},t.send()})),Lt[i]}function gs(i,e){return i?gt[e]?Promise.resolve(e):(nt[e]||(nt[e]=new Promise(t=>{Ci(e).then(s=>{i.decodeAudioData(s,n=>{gt[e]=n,t(e),nt[e]=null})})})),nt[e]):Ci(e)}class ee{constructor(e){this.onEnded=this.onEnded.bind(this),this.onLoaded=this.onLoaded.bind(this),this.controller=e,this.context=e.getContext(),this.input=null,this.output=this.context.createGain()}reset(e={}){this.onStop=null,this.stop(),this.pausedProgress=0,this.fadein=e.fadein||0,this.fadeout=e.fadeout||0,this.fadeinTimer=0,this.fadeoutTimer=0,this.fadeinActive=!1,this.fadeoutActive=!1,this.needsPlay=!1,this.isPlaying=!1,this.isStopping=!1,this.hasEnded=!1,this.loaded=!1,this.stopped=!1,this.fixedTimeStep=0,this.id=e.id||null,this.clearBuffer(),this.source=null,this.buffer=null,this.loop=!!e.loop,this.autoplay=!!e.autoplay,this.playbackRate=e.playbackRate||1,this.volume=e.volume!=null?e.volume:1,this.realvolume=-1,this.loopStart=e.loopStart||0,this.loopEnd=e.loopEnd||0,this.onStop=e.onStop||$n,this.baseOffset=e.start||e.baseOffset||0,this.duration=e.duration;const t=e.input||this.controller.getInput();t!==this.input&&(this.input&&this.output.disconnect(this.input),this.input=t,this.output.connect(this.input)),this.path=e.path;let s=this.requestID=++Mn;gt[this.path]?this.onLoaded(this.path):gs(this.context,e.path).then(n=>{(this.requestID=s)&&this.onLoaded(n)}),this.autoplay&&this.play()}onLoaded(e){if(this.isStopping||this.stopped)return this.realstop();if(this.stopped)return this.realstop();const t=gt[e];this.loaded=!0,this.buffer=t,this.needsPlay&&this.play()}onEnded(){this.loop||(this.hasEnded=!0,this.stop())}getOutput(){return this.output}update(e){if(!this.source)return;this.fixedTimeStep&&(e=this.fixedTimeStep);let t=this.volume;if(this.fadeinActive){this.fadeinTimer+=e;const s=oe(this.fadeinTimer/this.fadein,0,1);t*=s,s===1&&(this.fadeinActive=!1)}if(this.fadeoutActive&&this.isStopping){this.fadeoutTimer+=e;const s=oe(1-this.fadeoutTimer/this.fadeout,0,1);t*=s,s===0&&this.realstop()}t!==this.realvolume&&this.setVolume(t)}play(){if(this.source&&this.stop(),!this.loaded){this.needsPlay=!0;return}const e=this.source=this.source||this.context.createBufferSource();if(this.isStopping||(e.buffer=this.buffer,e.onended=this.onEnded),this.startTime=this.context.currentTime,this.isPlaying=!0,this.needsPlay=!1,!e||!e.buffer)return this.stop();this.progressStart=this.startTime-this.offset,this.duration||(this.duration=e.buffer.duration);const t=Math.max(this.duration-this.offset,.01);if(!this.isStopping&&Ln(this.source,this.startTime,(this.baseOffset+this.offset)%e.buffer.duration,this.duration?t:void 0)){requestAnimationFrame(()=>this.stop());return}this.fadein&&this.fadeinTimer===0?this.setVolume(0,!0):this.setVolume(this.volume,!0),this.fadein&&(this.fadeinActive=!0),this.setPlaybackRate(this.playbackRate),this.connect(),this.setLoop(this.loop),this.isStopping=!1}getCurrentTime(){return this.getProgress()*this.duration}getProgress(){return this.isPlaying?(this.context.currentTime-this.progressStart)/this.duration:this.pausedProgress}connect(){this.source.connect(this.getOutput())}disconnect(){this.source.disconnect(this.getOutput())}clearBuffer(){this.context&&this.context.clearBufferSource?this.source&&this.context.clearBufferSource(this.source):this.source&&(this.source.disconnect(0),this.source.onended=null),this.source=null}pause(){this.pausedProgress=this.getProgress(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.needsPlay=!1,this.isPlaying=!1,this.source&&(Ti(this.source),this.clearBuffer())}realstop(){this.onStop&&this.onStop(this),this.onStop=null,this.offset=0,this.needsPlay=!1,this.isPlaying=!1,this.isStopping=!1,this.fadeinActive=!1,this.fadeoutActive=!1,this.stopped=!0,this.source&&(Ti(this.source),this.clearBuffer())}stop(e={}){if(!this.isStopping){if(this.isStopping=!0,!this.source||!this.loaded)return this.realstop();e.fadeout&&(this.fadeout=e.fadeout),this.fadeout?this.fadeoutActive=!0:this.realstop()}}getPlaybackRate(){return this.playbackRate}setPlaybackRate(e){this.playbackRate=e,!(!this.isPlaying||!this.source)&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01)}getLoop(){return this.loop}setLoop(e){this.loop=e,!(!this.isPlaying||!this.source)&&(this.source.loop=this.loop,this.source.loopStart=this.loopStart,this.source.loopEnd=this.loopEnd)}getVolume(){return this.output.gain.value}setVolume(e,t,s=.01){this.realvolume=e,t&&(this.output.gain.value=this.realvolume),this.output.gain.setTargetAtTime(this.realvolume,this.context.currentTime,s)}release(){ee.release(this)}}ee.pool=[];ee.get=function(e,t){const s=ee.pool.shift()||new ee(e);return s.reset(t),s};ee.release=function(e){e.clearBuffer(),e.buffer=null,e.onStop=null,ee.pool.length<50&&ee.pool.push(e)};const di=window.performance||window.Date,bs=["click","touchstart","touchend","keydown"],_i=window.AudioContext||window.webkitAudioContext,In=44100;let Z=null;const O={initialized:!1,unlocked:!1,unlockerListening:!0,lastStuckCheck:di.now(),stuckTimer:0,previousWebAudioTime:0},ce={onContextCreation:null,onUnlock:null,onStuck:null};function Fn(i){const e=new ArrayBuffer(10),t=new DataView(e);return t.setUint32(0,i,!0),t.setUint32(4,i,!0),t.setUint16(8,1,!0),`data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA${window.btoa(String.fromCharCode(...new Uint8Array(e))).slice(0,13)}AgAZGF0YQcAAACAgICAgICAAAA=`}let An=window.navigator.vendor.includes("Apple");function Dn(){try{return new _i().close(),new _i}catch{return null}}function fi(){O.unlocked||(Pn(),Z.suspend(),window.setTimeout(()=>Z.resume(),10),Bn(),O.unlocked=!0,O.stuckTimer=-800,O.lastStuckCheck=di.now(),ce.onUnlock&&ce.onUnlock())}function vs(){O.unlocked=!1,O.unlockerListening=!0;for(const i of bs)document.addEventListener(i,fi,{passive:!0,capture:!0})}function Bn(){O.unlockerListening=!1;for(const i of bs)document.removeEventListener(i,fi,{passive:!0,capture:!0})}function Pn(){if(Z)return;Z=Dn();const i=Z.scratchBuffer=Z.createBuffer(1,1,22050);Z.clearBufferSource=e=>{if(e&&(e.onended=null,e.disconnect(0),An))try{e.buffer=i}catch{}},O.initialized=!0,ce.onContextCreation&&ce.onContextCreation(Z),ys()}async function Rn(){await void 0&&fi()}function On(){O.initialized||(Fn(In),vs(),Rn())}function ys(){window.requestAnimationFrame(ys);const i=di.now(),e=i-O.lastStuckCheck;if(!O.initialized||!Z||e<400)return;const t=Z.currentTime,s=t===O.previousWebAudioTime;O.stuckTimer=s?O.stuckTimer+e:0,O.previousWebAudioTime=t,O.lastStuckCheck=i,O.stuckTimer>400&&O.unlocked&&!O.unlockerListening&&(vs(),ce.onStuck&&ce.onStuck())}function Un(i){return i.gain.value}function Gn(i,e){i.gain.setValueAtTime(e,Z.currentTime)}const he={init:On,getVolume:Un,setVolume:Gn,getContext:()=>Z,isUnlocked:()=>O.unlocked,set debug(i){},set onContextCreation(i){ce.onContextCreation=i},set onUnlock(i){ce.onUnlock=i},set onStuck(i){ce.onStuck=i}},Ei=""+new URL("audiosprites-3e783937.m4a",import.meta.url).href,zn=""+new URL("Music_8bit_Loop-0face704.m4a",import.meta.url).href,Oe={},Nn=JSON.parse('[["Countdown",0,0.8333,0.8333],["Countdown_Go",0.9333,1.9,0.9667],["Game_Over",2,4.6,2.6],["Pickup_Bonus",4.7,5.9667,1.2667],["Pickup_LevelUp",6.0667,9.3,3.2333],["Pickup_Normal",[[9.4,10.6667,1.2667],[10.7667,12.0333,1.2667],[12.1333,13.2667,1.1333],[13.3667,14.5,1.1333],[14.6,15.7333,1.1333]]],["Snake_Turn",[[15.8333,16.0551,0.2217],[16.1551,16.3768,0.2217],[16.4768,16.6985,0.2217],[16.7985,17.0203,0.2217],[17.1202,17.342,0.2217],[17.442,17.6637,0.2217]]],["UI_Click",17.7637,18.1637,0.4]]');Nn.forEach(([i,e,t,s])=>{Oe[i]=Array.isArray(e)?{id:i,path:Ei,variations:e.map(n=>({id:i,start:n[0],end:n[1],duration:n[2]}))}:{id:i,path:Ei,start:e,end:t,duration:s}});Oe.Music_8bit_Loop={path:zn,unique:!0};const jn=Math.log(10)*.05;function Vn(i){return Math.exp(i*jn)}const qn=0,Me=i=>Vn(i+qn),Le=(i,e)=>Object.assign(Oe[i],e);Le("Music_8bit_Loop",{loop:!0,fadein:500,fadeout:500,volume:Me(-6)});Le("Pickup_LevelUp",{volume:Me(-4)});Le("Pickup_Bonus",{volume:Me(-4)});Le("Pickup_Normal",{volume:Me(-4)});Le("Countdown",{volume:Me(-3)});Le("Countdown_Go",{volume:Me(-3)});Le("Snake_Turn",{volume:Me(-2)});const{log:Hn}=Ue("AUDIO","#fff","#de215b",1),j=(i,e)=>i!==void 0?i:e,Wn=(i,e)=>Math.random()*(e-i)+i;function Yn(){const i=D(!1);let e=!1,t,s,n,o=!1;const r=$=>$.update(n),a={},l=new Set;let c=1;const h={main:1,fade:1,smoothMute:1,mute:1},d={muted:i,init:u,unlocked:D(!1),activeSamples:a,get masterVolume(){return c},getContext:()=>t,getInput:()=>s,list:Oe,play:w,pause:T,stop:C,playSound:L,stopSound:z,preloadSound:B,onSiteVisible:p};function u(){e||(e=!0,he.debug=!0,he.onUnlock=M,he.onContextCreation=g,he.onStuck=_,he.init(),ms.add(v),V.$vp.signal.watchImmediate(()=>p(V.$vp.visible)),d.muted.watchImmediate(k))}function p($){t&&($?(w(),h.fade=1):(T(),h.fade=0),m())}function g($){t=$,s=$.createGain(),s.connect($.destination);for(let y=0;y<20;y++)new ee(d).release()}function _(){C(),d.unlocked.set(!1)}function M(){d.unlocked.set(!0)}function k($){h.mute=$?0:1}function v($){if(he.isUnlocked()){n=$;for(const y of l)y.timer-=$,y.timer<=0&&(l.delete(y),L(y.id,y.opts));if(m(),!o)for(const y in a)a[y].forEach(r)}}let b=-1;function m(){const $=h;$.smoothMute=ls($.smoothMute,$.mute,.1,.001),c=$.main*$.fade*$.smoothMute,c!==b&&(b=c,he.setVolume(s,c))}function w(){if(o){o=!1;for(const $ in a)a[$].forEach(y=>{y.loop||y.play()})}}function T(){if(!o){o=!0;for(const $ in a)a[$].forEach(y=>{y.loop||y.pause()})}}function C(){for(const $ in a)a[$].forEach(y=>y.stop())}function L($,y={}){if(y.delay||Hn("Play sound",$),!he.isUnlocked())return;const F=Oe[$];if(!F)return;if(y.delay){const W=y.delay;delete y.delay,l.add({id:$,opts:y,timer:W});return}if(a[$]||(a[$]=new Set),F.unique&&a[$].size>0){const W=a[$].values().next().value;return W.play(),W}if(y.id=$,y.path=F.path,y.onStop=N,y.autoplay=y.autoplay??!0,y.loop=j(y.loop,!!F.loop),y.fadein=y.fadein||F.fadein,y.fadeout=y.fadeout||F.fadeout,F.variations){let W=y.variation&&F.variations[y.variation-1];W||(W=fn(F.variations)),y.start=j(y.start,W.start),y.duration=j(y.duration,W.duration),y.loopStart=j(y.loopStart,j(W.loopStart,y.start)),y.loopEnd=j(y.loopEnd,j(W.loopEnd,y.start+y.duration))}else y.start=j(y.start,F.start),y.duration=j(y.duration,F.duration),y.loopStart=j(y.loopStart,j(F.loopStart,y.start)),y.loopEnd=j(y.loopEnd,j(F.loopEnd,y.start+y.duration));y.volume=j(y.volume,j(F.volume,1));const te=F.randomRate??y.randomRate;y.playbackRate=te?Wn(te[0],te[1]):y.playbackRate!=null?y.playbackRate:1;const Fe=ee.get(d,y);return a[$].add(Fe),Fe}function z($,y={}){const F=a[$];F&&F.forEach(te=>te.stop(y))}function N($){const y=a;$.release();const F=y[$.id];F&&F.delete($)}function B($){const y=Oe[$];if(!y)return;const F=y.path;return gs(t,F)}return function(y){y.$audio=d,y.$playSound=L,d.init()}}const dt=["KeyS","KeyW","KeyD","KeyA"].reduce((i,e)=>(i[e]=1,i),{}),Kn=["TEXTAREA","INPUT","BUTTON"].reduce((i,e)=>(i[e]=1,i),{});function Qn(){try{return window.self!==window.top}catch{return!0}}Qn()||Object.assign(dt,{ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1});function Xn(i){if(!i)return!1;const e=i.tagName;return!!(Kn[e]||i.dataset&&i.dataset.bypassKeyboard!=null)}function Zn(i){return i?i.target?!Xn(i.target):!0:!1}function Jn(){const i=Object.keys(dt).reduce((c,h)=>(c[h]=!1,c),{}),e=$e(),t={pressedCount:0,keys:i,unpressAllKeys:l,listen:s,signal:e};return l(),t.pressedCount=0,t;function s(){const c={passive:!1};window.addEventListener("keydown",n,c),window.addEventListener("keyup",o,c),window.addEventListener("mousedown",l,{passive:!0}),window.addEventListener("blur",l,!1),window.addEventListener("contextmenu",l,!1)}function n(c){dt[c.code]&&Zn(c)&&(c.preventDefault(),r(c.code))}function o(c){dt[c.code]&&a(c.code)}function r(c){i[c]||(i[c]=!0,t.pressedCount++,e.emit(c,{isPressed:!0}))}function a(c){i[c]&&(i[c]=!1,t.pressedCount=Math.max(t.pressedCount-1,0),e.emit(c,{isPressed:!1}))}function l(){for(let c in i)a(c)}}function eo(){const i=Jn(),e={keyboard:i,listen:t,poll:s};function t(){i.listen()}function s(){}return function(o){o.$controls=e,o.$keyboard=i}}function to(i,{remove:e,app:t}){return{async hide(){document.body.classList.add("preloader-hidden"),i.classList.add("hidden"),H(200).then(()=>t.$webgl.$pp.glitch()),H(450).then(()=>t.$webgl.$pp.glitch()),await H(1500),e()}}}const io=Object.freeze(Object.defineProperty({__proto__:null,default:to},Symbol.toStringTag,{value:"Module"}));function so(i){return i.offsetHeight}function no(i,e={},t=[],s){const n=document.createElement(i);for(let o in e)if(o==="data"){for(let r in e[o])n.dataset[r]=e[o][r];continue}else if(o==="class")n.className=e[o];else if(o==="style")Object.assign(n.style,e[o]);else if(o==="text")n.textContent=e[o];else if(o==="props"){for(let r in e[o]){const a=r[0].toUpperCase()+r.slice(1);n.dataset["prop"+a]=e[o][r]}continue}else o==="component"||!(o in n)?n.dataset[o]=e[o]:n.setAttribute(o,e[o]);for(let o=0;o<t.length;o++){const r=t[o];r.nodeType?n.appendChild(r):typeof r=="string"&&n.appendChild(document.createTextNode(r))}return s&&s.appendChild(n),n}function oo(i,{app:e}){const{authQrContainer:t}=e.$refs;function s(r){i.classList.toggle("loading",r)}const n=St();async function o(){var h;const r=n();s(!0),t.classList.remove("loaded"),(h=t.querySelector("img"))==null||h.remove();const{session:a}=await e.$api.createSession();if(r())return;if(!a)return s(!1);const l=no("img");t.appendChild(l);const c=ss();l.onload=c.resolve,l.src=a.loginUrl,l.draggable=!1,l.alt="Veefriend auth QR code",await c,!r()&&(so(t),t.classList.add("loaded"),s(!1),await e.$api.waitFirstConnection(),e.$view.push("GameOver"))}return{onEnter(){i.classList.add("visible"),i.classList.remove("hidden"),o()},onLeave(){i.classList.remove("visible"),i.classList.add("hidden")}}}const ro=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"})),Qt=i=>i.charAt(0).toUpperCase()+i.slice(1),ge=i=>i,Xt=["init","preload","start","update","render","frame"].reduce((i,e)=>(i[`before${Qt(e)}`]=$e(),i[`after${Qt(e)}`]=$e(),i),{});function ao(i=[]){return Array.isArray(i)||(i=[i]),i.forEach(e=>typeof e=="function"&&e(f)(f)),f}function pi(){return f}const f={canvas:null,collection:{},$app:null,hooks:Xt,usePlugins:ao};let bt=[];function lo(i){if(bt)bt.push(i);else return i(f)}function co(i,e){return f.$app=i,f.canvas=e,f.init=ge,f.preload=ge,f.start=ge,f.update=ge,f.render=ge,f.frame=(t,s)=>{f.update(t,s),f.render(t,s)},bt.forEach(t=>t(f)),bt=null,De("init",{useAsync:!0,once:!0}),De("preload",{useAsync:!0,once:!0}),De("start",{useAsync:!0,once:!0}),De("update"),De("render"),De("frame"),f.hooks.afterInit.watchOnce(async()=>{await f.preload(),f.$time.signal.watch(f.frame)}),f.hooks.afterPreload.watchOnce(f.start),f}function De(i,{useAsync:e=!1,once:t=!1}={}){const s=f[i]||ge,n=Qt(i),o=Xt[`before${n}`]||ge,r=Xt[`after${n}`]||ge;f[i]=e?async function(a){o.emit(),await s(a),r.emit(),t&&(o.unwatchAll(),r.unwatchAll())}:function(a){o.emit(),s(a),r.emit(),t&&(o.unwatchAll(),r.unwatchAll())}}const It=Math.PI,S={up:1,down:2,left:3,right:4},Zt={[S.up]:It*.5,[S.down]:It*1.5,[S.left]:It,[S.right]:0},Jt={[S.up]:{x:0,y:-1},[S.down]:{x:0,y:1},[S.left]:{x:-1,y:0},[S.right]:{x:1,y:0}},Ft={KeyS:S.down,KeyW:S.up,KeyD:S.right,KeyA:S.left,ArrowUp:S.up,ArrowDown:S.down,ArrowLeft:S.left,ArrowRight:S.right};function ho(){let i=null,e=S.up,t=[null,null];const s=f.$app.$keyboard,n=D(e),o={get prev(){return i},get dir(){return e},get directions(){return S},isPressed:!1,poll:k,hasTurned:M,hasBuffer:l,get bufferSize(){return c()},force:v=>e=v,getOppositeDirection:p,isOppositeDirection:_,isSameDirection:g,is:u,canBuffer:!1,reset:d,bufferInput:a,lastPressedDirection:n,kbPress:$e()};r();function r(){s.signal.watch((v,{isPressed:b})=>{!b||!Ft[v]||(o.kbPress.emit(Ft[v]),a(Ft[v]))})}function a(v){if(!f.$game.isRunning||!o.canBuffer)return;let b=c();if(b===0){const m=e;if(g(v,m)||_(v,m))return;t[0]=v,n.set(v),o.isPressed=!0}else if(b===1){const m=t[0];if(g(v,m)||_(v,m))return;t[1]=v,n.set(v),o.isPressed=!0}else return}function l(){return t[0]!==null}function c(){return t[0]===null?0:t[1]===null?1:2}function h(){const v=t[0];return t[0]=t[1],t[1]=null,v}function d(v){i=null,e=v||S.up,n.set(e),t[0]=null,t[1]=null}function u(v){return e===v}function p(v){switch(v){case S.up:return S.down;case S.down:return S.up;case S.left:return S.right;case S.right:return S.left}}function g(v,b){return v===b}function _(v,b){return p(v)===b}function M(){return i!==e}function k(){if(i=e,!l())return;const v=h();v!=null&&(_(e,v)||(e=v))}return o}function uo(i,{app:e,webgl:t,log:s}){const{gameBtnUp:n,gameBtnDown:o,gameBtnLeft:r,gameBtnRight:a,gamePad:l}=e.$refs;n.addEventListener("click",p=>{p.target.blur()}),o.addEventListener("click",p=>{p.target.blur()}),r.addEventListener("click",p=>{p.target.blur()}),a.addEventListener("click",p=>{p.target.blur()}),l.addEventListener("click",p=>{c(p)});function c(p){p.target.blur();const g=l.getBoundingClientRect(),_=p.clientX-g.left,M=p.clientY-g.top,k=_/g.width*2-1,v=M/g.height*2-1,b=t.$snake.controls,m=b.lastPressedDirection.value;m===S.up||m===S.down?Math.abs(k)>.15&&(k<0?b.bufferInput(S.left):b.bufferInput(S.right)):Math.abs(k)<.55&&(v<0?b.bufferInput(S.up):b.bufferInput(S.down))}function h(p){const g=p===S.up||p===S.down;i.classList.toggle("vertical",!!g),i.classList.toggle("horizontal",!g)}function d(p){if(!p)return;const{$audio:g}=e;u&&u.realstop(),u=null,u=g.playSound("Music_8bit_Loop")}let u=null;return{onEnter(){const{$audio:p}=e,{$snake:g}=t;i.classList.add("visible"),i.classList.remove("hidden"),g.controls.lastPressedDirection.watchImmediate(h),p.unlocked.watchImmediate(d)},onLeave(){const{$audio:p}=e;i.classList.remove("visible"),i.classList.add("hidden");const{$snake:g}=t;g.controls.lastPressedDirection.unwatch(h),p.unlocked.unwatch(d),u&&u.stop(),u=null}}}const fo=Object.freeze(Object.defineProperty({__proto__:null,default:uo},Symbol.toStringTag,{value:"Module"}));function po(i,{target:e=document.body}={}){if(typeof i!="string")throw new TypeError(`Expected parameter \`text\` to be a \`string\`, got \`${typeof i}\`.`);const t=document.createElement("textarea"),s=document.activeElement;t.value=i,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";const n=document.getSelection(),o=n.rangeCount>0&&n.getRangeAt(0);e.append(t),t.select(),t.selectionStart=0,t.selectionEnd=i.length;let r=!1;try{r=document.execCommand("copy")}catch{}return t.remove(),o&&(n.removeAllRanges(),n.addRange(o)),s&&s.focus(),r}function mo(i,{app:e,webgl:t}){e.$refs.endBtnHome.addEventListener("click",()=>{e.$view.push("Home")}),e.$refs.endBtnShare.addEventListener("click",()=>{if(i.classList.contains("loading")||e.$webgl.$store.copyNotifVisible.value)return;e.$webgl.$store.copyNotifVisible.set(!0);const a=`I scored ${e.$webgl.$game.score.value} at the VeeCon Viper mini-game, can you beat me?
https://opensea.io/collection/veecon-2023-tickets`;navigator.clipboard.writeText(a).catch(()=>po(a))});const s=St();let n=!1;async function o(){const r=s();i.classList.add("loading");const a=await e.$api.updateScore(t.$game.score.value);if(!r()){switch(a&&a.status){case"updated":const l=e.$api.session.displayName;t.$store.gameOverText.set(`Congratulations ${l}. Your score has been submitted.`);break;case"no-update":t.$store.gameOverText.set("Not so bad… Try again if you think you can do better!");break}i.classList.remove("loading")}}return{async onEnter(){const r=e.$api.isConnected.value;i.classList.add("visible"),i.classList.remove("hidden"),i.classList.toggle("connected",!!r),(!n||e.$view.previous.value==="Game"||e.$view.previous.value==="Auth")&&(n=!0,t.$store.gameOverText.set(""),r&&o())},onLeave(){i.classList.remove("visible"),i.classList.add("hidden")}}}const go=Object.freeze(Object.defineProperty({__proto__:null,default:mo},Symbol.toStringTag,{value:"Module"}));function bo(i,{app:e,log:t}){return{onEnter(){i.classList.add("visible"),i.classList.remove("hidden")},onLeave(){i.classList.remove("visible"),i.classList.add("hidden")}}}const vo=Object.freeze(Object.defineProperty({__proto__:null,default:bo},Symbol.toStringTag,{value:"Module"}));function yo(i,{app:e}){const t=St();async function s(){const n=t();f.$store.leaderboard.set([]);const o=await e.$api.getLeaderboard();n()||f.$store.leaderboard.set(o)}return{onEnter(){i.classList.add("visible"),i.classList.remove("hidden"),s()},onLeave(){i.classList.remove("visible"),i.classList.add("hidden")}}}const wo=Object.freeze(Object.defineProperty({__proto__:null,default:yo},Symbol.toStringTag,{value:"Module"})),xo=i=>i,So=Object.entries(Object.assign({"../../components/preloader.js":io,"../../components/viewAuth.js":ro,"../../components/viewGame.js":fo,"../../components/viewGameOver.js":go,"../../components/viewHome.js":vo,"../../components/viewLeaderboard.js":wo})).reduce((i,[e,t])=>{const s=e.split("/").pop().split(".").shift();return i[s]=t.default??xo,i},{});function ki({object:i={},attr:e="data-ref",transformer:t}){return Object.defineProperties(i,{get:{value(s){return i[s]??null},enumerable:!1},add:{value(s,n=null){n||(n=document.querySelector(`[${e}="${s}"]`)),!(!n||i[s])&&(t&&(n=t(s,n)),n&&(i[s]=n))},enumerable:!1},remove:{value(s){const n=i[s];n&&(n.remove&&n.remove(),delete i[s])},enumerable:!1},addAll:{value(s){s||(s=document);const n=s.nodeType;if(n===1||n===9)s.querySelectorAll(`[${e}]`).forEach(r=>i.add(r.getAttribute(e),r));else if(typeof s=="object")for(let o in s)i.add(o,s[o])},enumerable:!1},clear:{value(){for(let s in i)i.remove(s)},enumerable:!1}}),i}function To(){const{log:i}=Ue("DOM","#035f6c","#fff");return function(t){const s=ki({attr:"data-component",transformer:(o,r)=>{const a=So[o];if(!a)return;let l;function c(){!l||l.isRemoved||(l.isRemoved=!0,l.beforeRemove&&l.beforeRemove(r),r.remove())}return l=a(r,{app:t,webgl:f,remove:c,log:i})??{},l.name=o,l.remove=c,l}}),n=ki({attr:"data-ref"});t.$refs=n,t.$components=s,n.addAll(),s.addAll()}}function Co(){const i={};return function(t){t.$store=i}}function _o(){const i={start:n,current:D(null),previous:D(null),push:s,back:t,is:e};function e(o){return i.current.value===o}function t(o=!1){s(i.previous.value??"Home",o)}function s(o,r=!1){var c,h;if(!r&&i.current.value===o)return;const a=V.$components["view"+i.current.value],l=V.$components["view"+o];i.previous.set(i.current.value,r),i.current.set(o,r),a&&((c=a.onLeave)==null||c.call(a)),l&&((h=l.onEnter)==null||h.call(l))}function n(){i.current;let o="Home";V.$components["view"+o]||(o="Home"),s(o,!0)}return function(r){r.$view=i}}function Eo(){const i=tn(s,200,{trail:!1}),e={width:10,height:10,aspect:1,dpr:1,visible:!0,signal:$e()};function t(){document.addEventListener("visibilitychange",o,!1),window.addEventListener("resize",i,!1),o()}function s(){n(),e.width=window.innerWidth,e.height=window.innerHeight,e.aspect=e.width/e.height,e.signal.emit();let r=0,a=0;e.width>e.height?a=(e.width-e.height)/2:r=(e.height-e.width)/2,document.documentElement.style.setProperty("--size-mult",(Math.min(e.width,e.height)/1e3).toFixed(4)),document.documentElement.style.setProperty("--top-offset",`${r}px`),document.documentElement.style.setProperty("--left-offset",`${a}px`)}function n(){e.dpr=window.devicePixelRatio||1}function o(){e.visible=!document.hidden,s()}return function(a){a.$vp=e,t()}}const ko=new Int8Array([-1,-1,4,-1,-1,4]),ws=new Ms;ws.setAttribute("position",new Ls(ko,2));const $o=["precision highp float;","attribute lowp vec2 position;","varying highp vec2 vUv;","void main() {","vUv = position * 0.5 + 0.5;","gl_Position =  vec4(position, 0., 1);","}"].join(""),$i=new Is,Mo="precision highp float;varying vec2 vUv;void main(){gl_FragColor=vec4(vUv,0.,1.);}";let ue;function Lo({renderer:i,useRawShader:e=!0,vertexShader:t,fragmentShader:s,...n}={}){if(!i)throw new Error("WebGL Renderer is required");const o=e?Fs:xt,r=new o(Object.assign({},{vertexShader:$o,fragmentShader:Mo,depthTest:!1,depthWrite:!1,transparent:!0},n));return t&&(t.use?t.use(r):r.vertexShader=t),s&&(s.use?s.use(r):r.fragmentShader=s),ue||(ue=new wt(ws,r),ue.frustumCulled=!1,ue.matrixAutoUpdate=!1,ue.matrixWorldAutoUpdate=!1),{cam:$i,screen:ue,material:r,uniforms:r.uniforms,u:r.uniforms,render(){const l=i.sortObjects,c=i.shadowMap.enabled,h=i.autoclear;i.sortObjects=!1,i.shadowMap.enabled=!1,i.autoclear=!1,ue.material=r,i.render(ue,$i),i.sortObjects=l,i.shadowMap.enabled=c,i.autoclear=h}}}let Io=1;function Fo({drawingBufferSize:i,format:e=Ds,name:t="Buffer",depth:s=!0,stencil:n=null,width:o,height:r,scale:a=1,generateMipmaps:l=!1}={}){const c=i;if(!c)throw new Error("renderer.drawingBufferSize is required");t==null&&(t=`RenderTarget.${Io++}`);let h=!1,d=!1,u;o&&r&&M(o,r),(!o||!r)&&k(a),u=new As(o,r,{minFilter:ft,magFilter:ft,format:e,depthBuffer:!!s,stencilBuffer:!!(n??s)}),u.texture.generateMipmaps=!!l;const p=u.setSize.bind(u);u.setSize=M,u.setScale=k;const g=u.dispose.bind(u);return u.dispose=T,u.texture.name=t,u.name=t,u.disposed=$e(),u.clone=_,u;function _(){console.warn("clone() is disabled for RTs created with createBuffer()")}function M(C=0,L=0){L||(L=C),!(C<=0)&&(o=C,r=L,b(),u&&m())}function k(C=0){C<=0||(a=C,v(),w())}function v(){d||(d=!0,c.watch(w))}function b(){d&&(d=!1,c.unwatch(w))}function m(){u.texture.width===o&&u.texture.height===r||(h=!0,p(o,r),h=!1)}function w(){o=Math.floor(c.value.x*a),r=Math.floor(c.value.y*a),u&&m()}function T(){g(),!h&&(b(),u.disposed.emit())}}const Mi=()=>{};function Ao(){const i={init:t,create:e,createBuffer:e,registerBuffer:Mi,unregisterBuffer:Mi};function e(s){return s.drawingBufferSize=f.renderer.drawingBufferSize,Fo(s)}async function t(){}return function(n){n.$fbo=i}}function Do(i){i.stageScore.watch(r=>i.isRunning&&e.body.addPart());const e={headPosition:new E,body:null,controls:null,create:s,start:n,poll:o},t=e.controls=ho();return e;function s(r,a,l){t.reset(l);const c=e.body.createBaseSnake(r,a,l);e.body.register(c)}function n(){e.body.play()}function o(){return t.poll(),t.hasTurned()&&f.$playSound("Snake_Turn"),{hasTurned:t.hasTurned(),prevDir:t.prev,nextDir:t.dir,nextPos:Jt[t.dir],nextRot:Zt[t.dir]}}}const Bo={DIFFICULTY:1,PATTERN:`
..................
..................
..#............#..
..................
..................
............$.....
..0001............
..................
..................
..#............#..
..................
..................
		`},Po=Object.freeze(Object.defineProperty({__proto__:null,default:Bo},Symbol.toStringTag,{value:"Module"})),Ro={DIFFICULTY:1,PATTERN:`
..................
..................
..#.....##.....#..
..................
..$..#......#.....
..................
..0001............
.....#......#..$..
..................
..#.....##.....#..
..................
..................
		`},Oo=Object.freeze(Object.defineProperty({__proto__:null,default:Ro},Symbol.toStringTag,{value:"Module"})),Uo={DIFFICULTY:3,PATTERN:`
..................
..................
..................
.#...#..####.####.
.#...#..$....$....
.#...#..###..###..
.#...#..#....#....
..$.#...#....#....
...#..1.####.####.
......0...........
......0...........
......0...........
		`},Go=Object.freeze(Object.defineProperty({__proto__:null,default:Uo},Symbol.toStringTag,{value:"Module"})),zo={DIFFICULTY:3,PATTERN:`
..................
..####.####.####..
..#$.#......#.$#..
........##........
....#....#...#....
.........#........
..0001............
........#.........
........#.........
..#$.#..##..#.$#..
..####......####..
..................
		`},No=Object.freeze(Object.defineProperty({__proto__:null,default:zo},Symbol.toStringTag,{value:"Module"})),jo={DIFFICULTY:3,PATTERN:`
##....###........#
#......#...$..#...
...#.$.......###..
..###.....#...#...
...#.....###.....#
..........#.....##
..0001...........#
.......#......$...
..#...###...#.....
.###...#...###....
..#......$..#....#
................##
		`},Vo=Object.freeze(Object.defineProperty({__proto__:null,default:jo},Symbol.toStringTag,{value:"Module"})),qo={DIFFICULTY:3,PATTERN:`
..................
...#..............
...##.......#.$#..
...#.......#..#...
..........#..#....
..................
..0001............
.....#..#.........
....#..#.....#....
...#$.#......##...
.............#....
..................
		`},Ho=Object.freeze(Object.defineProperty({__proto__:null,default:qo},Symbol.toStringTag,{value:"Module"})),Wo={DIFFICULTY:2,PATTERN:`
..................
.###..#....#..###.
.###.....$....###.
........##........
..#............#..
........$.........
..0001...$........
..#............#..
........##........
.###....$.....###.
.###..#....#..###.
..................
		`},Yo=Object.freeze(Object.defineProperty({__proto__:null,default:Wo},Symbol.toStringTag,{value:"Module"})),Ko={DIFFICULTY:2,PATTERN:`
..................
...$..............
..#............#..
...###.####.###...
...#..........#...
...#......$.......
..0001........#...
...#..........#...
...###.####.###...
..#............#..
..............$...
..................
		`},Qo=Object.freeze(Object.defineProperty({__proto__:null,default:Ko},Symbol.toStringTag,{value:"Module"})),Xo=Object.entries(Object.assign({"./easy_1_tuto.js":Po,"./easy_2_blocks.js":Oo,"./hard_1_vee.js":Go,"./hard_2_corners.js":No,"./hard_3_flowers.js":Vo,"./hard_4_stairs.js":Ho,"./medium_1_blocks.js":Yo,"./medium_2_square.js":Qo})).reduce((i,[e,t])=>{const[s]=e.split("/").pop().split(".");return i[s]=t.default,i},{});function Zo(i){let e=new Date().getTime();return"xxxxxxxx-xxxx-yxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let n=(i+e+Math.random()*16)%16|0;return e=Math.floor(e/16),(s=="x"?n:n&3|8).toString(16)})}const At={};class R{constructor(e={}){this.props=e,this.isComponent=!0,this.isInitialized=!1,this.isDestroyed=!1,this.autoUpdate=!1,this.updateChildren=!0,this.children=[],this.webgl=pi(),this._watchers=[],this._sprites=[],this.parent=e.parent||null;const t=e.name??e.id??this.constructor.name??"Component";this.uid=At[t]=At[t]!=null?At[t]+1:0,this.name=this.uid?`${t}#${this.uid}`:t,this.uuid=Zo(this.uid);const{log:s,warn:n,error:o}=Ue("GL·"+this.name,"#000","#FED9B7");Object.assign(this,{log:s,warn:n,error:o})}triggerInit(){if(this.isInitialized)return!1;this.beforeInit&&this.beforeInit(),this.init&&this.init(),this.afterInit&&this.afterInit(),!this.parent&&this.autoUpdate&&(this.webgl.hooks.beforeUpdate.watch(this.triggerUpdate,this),this.webgl.hooks.beforeRender.watch(this.triggerRender,this)),this.isInitialized=!0}triggerUpdate(){if(this.isInitialized){if(this.beforeUpdate&&this.beforeUpdate(),this.children.length&&this.updateChildren)for(let e=0;e<this.children.length;e++)this.children[e].isInitialized&&this.children[e].triggerUpdate();this.update&&this.update(),this.afterUpdate&&this.afterUpdate()}}triggerRender(){if(this.isInitialized){if(this.beforeRender&&this.beforeRender(),this.children.length&&this.updateChildren)for(let e=0;e<this.children.length;e++)this.children[e].isInitialized&&this.children[e].triggerRender();this.render&&this.render(),this.afterRender&&this.afterRender()}}watch(e,t,s){const n=e.watch(t,s||this);this._watchers.push(n)}watchImmediate(e,t,s){const n=e.watchImmediate(t,s||this);this._watchers.push(n)}triggerDestroy(){this.isInitialized&&(this.beforeDestroy&&this.beforeDestroy(),this.children.forEach(e=>e.triggerDestroy()),this.children.length=0,this.destroy&&this.destroy(),this.webgl.hooks.beforeUpdate.unwatch(this.triggerUpdate,this),this.webgl.hooks.beforeRender.unwatch(this.triggerRender,this),this._watchers.forEach(e=>{e&&e.owner&&e.owner.unwatch(e)}),this._sprites.forEach(e=>e.destroy()),this._watchers.length=0,this._sprites.length=0,this.gui&&this.gui.dispose(),this.afterDestroy&&this.afterDestroy(),this.isDestroyed=!0)}add(e,t={}){let s=e;if(!s.isComponent)s=new s({...t,parent:this});else if(!s.parent)s.parent=this,this.webgl.hooks.beforeUpdate.unwatch(s.triggerUpdate,s),this.webgl.hooks.beforeRender.unwatch(s.triggerRender,s);else return!1;return!s.isInitialized&&s.triggerInit(),s.base&&this.base&&this.base instanceof J&&s.base instanceof J&&this.base.add(s.base),this.children.push(s),s}addSprite(e){const t=new this.webgl.SpriteInstance(e);return t.iPos=t.position.clone(),t.iScale=t.scale.clone(),this._sprites.push(t),t}addObject3D(e){return!this.base||!e||!this.base instanceof J||!e instanceof J?!1:(this.base.add(e),e)}remove(e,t=!0){e.triggerDestroy(),e.isComponent&&e.parent===this&&this.children.splice(this.children.indexOf(e),1),t&&this.base instanceof J&&e instanceof J&&this.base.remove(e)}removeFromParent(e=!0){if(!this.parent)return!1;this.parent.remove(this),e&&this.base instanceof J&&this.parent.base instanceof J&&this.parent.base.remove(this.base)}get(e){return this.children.find(t=>t.name===e)}}const Jo=()=>{};class mi extends R{constructor(e){super(e),this.byPassAlloc=!1,this.artboard=this.webgl.$artboard,this.position=e.position||new x,this.onCollision=(this.onCollision||Jo).bind(this),this.spriteId=e.spriteId||null,this.tile=null}afterInit(){!this.byPassAlloc&&this.artboard.allocate(this)}beforeDestroy(){!this.byPassAlloc&&this.artboard.release(this)}}const Li=16.67,we=()=>{};class er{constructor({atlas:e,id:t,group:s,sequence:n,loop:o,autoplay:r,standBy:a,frame:l,onPause:c,onStart:h,onUpdate:d,onEnd:u,onEndOnce:p,onEndLoop:g,frameDuration:_,category:M,parent:k,isBackwards:v,timeElapsed:b=0}){this.frames=[],this.onUpdate=d||we,this.onPause=c||we,this.onStart=h||we,this.onEndOnce=p||we,this.onEnd=u||we,this.onEndLoop=g||we,this.id=t!==void 0?t:s+"/"+n,this.group="",this.sequence="",this.parent=k||null,this.standBy=!!a,this.isBackwards=!!v,this.loop=!!o,this.autoplay=!!r,this.frame=l||0,this.frameCount=0,this.frameDuration=_||Li,this.timeElapsed=b,this.currentFrameIndex=0,this.paused=!1,this.ended=!1,this.category=M||"atlas",this.atlas=e,e&&(this.setAtlas(e),this.change({id:this.id,frameDuration:this.frameDuration,autoplay:this.autoplay,loop:this.loop,frame:this.frame}))}setAtlas(e){e&&(this.sprites=e.sprites||e)}swap(e){this.change({id:e,frame:this.currentFrameIndex,frameDuration:this.frameDuration,autoplay:this.autoplay,loop:this.loop})}change({id:e="circle",group:t,sequence:s,frame:n,frameDuration:o,timeElapsed:r=0,autoplay:a,loop:l}){if(this.sprites[e]){if(e!==void 0){this.id=e;const c=this.id.split("/");this.sequence=c.pop(),this.group=c.join("/")}else s!==void 0&&(t!==void 0&&(this.group=t),this.sequence=s,this.id=this.group+"/"+this.sequence);this.frames=this.sprites[this.id],this.frameCount=this.frames.length,this.currentFrameIndex=Math.min(n||0,this.frameCount-1),this.frame=this.frames[this.currentFrameIndex],this.loop=!!l,this.autoplay=!!a,this.frameDuration=o||Li,this.timeElapsed=r,this.paused=!this.autoplay,this.frameCount<2?this.end():this.ended=!1,this.onUpdate(this.frame)}}end(e=0){this.ended=!0,this.onEndOnce(this.frame,e),this.onEndOnce=we,this.onEnd(this.frame,e)}play(){this.standBy||(this.onStart(this.frame),this.paused=!1,this.isBackwards=!1,this.ended=!1)}playBackwards(){this.paused=!1,this.isBackwards=!0,this.ended=!1}reset(){this.standBy||(this.ended=!1,this.paused=!1,this.currentFrameIndex=0)}resetFrame(){this.currentFrameIndex=0,this.frame=this.frames[this.currentFrameIndex]}pause(){this.onPause(this.frame),this.paused=!0}nextFrame(e){let t=this.currentFrameIndex+1;if(t>=this.frameCount)if(this.loop)this.onEndLoop&&this.onEndLoop(this.parent),t=0;else return this.end(e),!0;if(t!==this.currentFrameIndex&&(this.currentFrameIndex=t,this.frame=this.frames[this.currentFrameIndex],!this.loop&&t+1>=this.frameCount))return this.end(e),!0}previousFrame(e){let t=this.currentFrameIndex-1;if(t<0)if(this.loop)t=this.frameCount;else return this.end(e),!0;if(t!==this.currentFrameIndex&&(this.currentFrameIndex=t,this.frame=this.frames[this.currentFrameIndex],!this.loop&&t-1<0))return this.end(e),!0}setFrame(e){e=Math.max(0,Math.min(e,this.frameCount-1)),e!==this.currentFrameIndex&&(this.currentFrameIndex=e,this.frame=this.frames[this.currentFrameIndex],!this.loop&&(this.isBackwards&&e===0?this.end(0):!this.isBackwards&&e===this.frameCount-1&&this.end(0)))}update(e){if(!(this.ended||this.paused)&&(this.timeElapsed+=e,this.timeElapsed>=this.frameDuration)){let t=this.timeElapsed;const s=Math.floor(this.timeElapsed/this.frameDuration);this.timeElapsed=this.timeElapsed-s*this.frameDuration;for(let n=0;n<s&&(t-=this.frameDuration,!(this.isBackwards?this.previousFrame(t):this.nextFrame(t)));n++);}}destroy(){this.sprites=this.frames=this.frame=this.onUpdate=null}}const tr="string",ir=new J;class Ie{constructor(e){this.isSprite=!0,this.zIndex=e.zIndex|0,e.layer&&(this.zIndex=f.$store.z[e.layer]??this.zIndex),e.batcher&&(this.batcher=typeof e.batcher===tr?f.$particles.batchers[e.batcher]:e.batcher,e.atlas=this.batcher.atlas,e.batcher=null),this.dummy=ir,this.position=new x,this.scale=new E(1,1),this.quaternion=new ri,this.color=new A(16777215),e.rotation?(this.useEuler=!0,this.rotation=new Y,this.rotation.copy(e.rotation)):e.useEuler&&(this.useEuler=!0,this.rotation=new Y),this.alpha=e.alpha!=null?e.alpha:1,this.initialAlpha=this.alpha,this.visible=!0,this.parent=e.parent||null,this.fx=e.fx||0,this.billboard=!!e.billboard,this.angle=e.angle||0,e.position&&this.position.copy(e.position),e.color!=null&&(typeof e.color=="number"?this.color.set(e.color):this.color.copy(e.color)),e.scale&&(typeof e.scale=="number"?this.scale.setScalar(e.scale):this.scale.copy(e.scale)),e.flipX&&(this.scale.x*=-1),e.flipY&&(this.scale.y*=-1),e.quaternion&&this.quaternion.copy(e.quaternion),this.sprite=new er({...e,id:e.sprite||e.id,parent:this}),this.batcher&&this.batcher.addInstance(this),this.sprite.update(1)}is(e){return this===e}update(e){if(this.standBy)return this.sprite.frame=this.sprite.frames[0];this.sprite.update(e)}destroy(){this.batcher&&this.batcher.removeInstance(this),this.parentComponent&&this.parentComponent.removeComponent(this),this.sprite&&this.sprite.destroy(),this.sprite=this.batcher=null,this.props=null}}f.SpriteInstance=Ie;const xs=new A(16637761),ei=new A(8649799),ti=new A(16711797),sr=new A(16777215),ii={mic:{sprite:"collectableMic",isNormal:!0},headphone:{sprite:"collectableHeadphone",isNormal:!0},lightning:{sprite:"collectableLightning",isNormal:!0},heart:{sprite:"collectableHeart",isNormal:!0},phone:{sprite:"collectablePhone",isNormal:!0},battery:{sprite:"collectableBattery",isNormal:!0},vc:{sprite:"collectableVC",isLevelUp:!0}},le=[],se=[],_e=[];for(const i in ii){const e=ii[i];e.id=i,e.isNormal?(le.push({...e,color:xs.clone()}),se.push({...e,isNormal:!1,isBonus:!0,color:ei.clone()})):e.isBonus?(e.color=ei.clone(),se.push(e)):e.isLevelUp&&(e.color=ti.clone(),_e.push(e))}le.baseIdx=Math.random()*le.length|0;se.baseIdx=Math.random()*se.length|0;_e.baseIdx=Math.random()*_e.length|0;let ot=null,Ve=0;class Re extends mi{constructor(e){if(e.position=e.position||null,super(e),this.isCollectable=!0,this.type=ii[e.type],!this.type)if(e.useLevelUpType){let t=_e.baseIdx;this.type=_e[t],t=(t+1)%_e.length,_e.baseIdx=t}else if(e.useBonusType){let t=se.baseIdx;this.type=se[t],ot===this.type.id&&(t=(t+1)%se.length,this.type=se[t]),t=(t+1)%se.length,se.baseIdx=t,ot=this.type.id}else{let t=le.baseIdx;this.type=le[t],ot===this.type.id&&(t=(t+1)%le.length,this.type=le[t]),t=(t+1)%le.length,le.baseIdx=t,ot=this.type.id}this.baseColor=this.type.color.clone(),this.type.isLevelUp&&(this.webgl.$game.uniqueCoinHasPoped=!0)}init(){const{parent:e,...t}=this.props,s=this.webgl.$artboard.getFreeTile();if(!s){this.removeFromParent();return}this.position.set(...this.props.position||s.pos),this.base=new Ie({...t,layer:"collectable",batcher:"normal",id:this.type.sprite,color:this.type.color,position:this.position,useEuler:!0}),this.scale=1e-5,this.floating=0}onCollision(){const{$pp:e,$game:t,$setState:s,$playSound:n,$particles:o}=this.webgl,{score:r,stageScore:a,collectablesEaten:l}=t,c=Date.now(),h=t.speedIncrement.value;let d=0,u=!1,p=0,g=xs;l.set(l.value+1),this.type.isLevelUp&&(n("Pickup_LevelUp"),Ve=c,e.miniGlitch({amplitude:.2,colorGlitch:.19}),t.isNextLevelPending=!0,g=ti),this.type.isBonus?(n("Pickup_Bonus"),c-Ve>250&&(Ve=c,e.miniGlitch({amplitude:.045})),this.parent.normalCoinCombo=0,p=t.bonusPoints,u=!0,g=ei,d=h):this.type.isNormal&&(n("Pickup_Normal"),c-Ve>250&&(Ve=c,e.miniGlitch({amplitude:.033})),this.parent.normalCoinCombo++,p=1,u=!0,d=h),p&&(r.set(r.value+p),a.set(a.value+p)),d&&t.speed.set(t.speed.value+d),u&&this.parent.addCoin(),p&&o.emit("bonus",{position:this.position,point:p,color:g});for(let _=0;_<oe(p,1,2);_++)o.emit("radialWave",{position:this.position,type:this.type,delay:_*130,color:g});this.removeFromParent()}play(){this.base.sprite.reset(),this.base.sprite.play()}is(e){return e=e.base||e,this.base.is(e)}update(){const{position:e,scale:t,rotation:s,color:n}=this.base,{et:o,stableDt:r}=this.webgl.$time,a=this.type.isLevelUp,l=a?-1:1;if(this.floating=Math.sin(o*.015*l)*2,e.y=this.position.y+this.floating,this.scale=cs(this.scale,1,.15,r),t.setScalar(this.scale),t.y+=Math.cos(o*.015*l)*.07,t.x-=Math.cos(o*.015*l)*.04,s.z=Math.cos(o*.01*l)*.04,a){const c=1-Math.min(1,o*.0045%2.5);n.lerpColors(ti,sr,c),this.scale+=c*.044,t.y+=c*.015,t.x+=c*.015}this.base&&this.base.update(r),this.tile.ref!==this&&this.removeFromParent()}destroy(){this.base&&this.base.destroy()}}class si extends mi{constructor(e){super(e),this.isCollider=!0,this.spriteId=e.spriteId||"block"}init(){const{parent:e,...t}=this.props;this.base=new Ie({...t,batcher:"normal",layer:"collider",id:this.spriteId,position:this.position,scale:1e-5})}onCollision(){this.log("onCollision")}play(){this.base.sprite.reset(),this.base.sprite.play()}is(e){return e=e.base||e,this.base.is(e)}removeFromParent(){this.parent.remove(this)}async scaleIn(e=0,t=!1){await H(e),this.scaleTarget=1,this.scale=t?this.scaleTarget:1e-5,t&&this.base.scale.setScalar(this.scale)}async scaleOut(e=0,t=!1){await H(e),this.scaleTarget=1e-5,this.scale=t?this.scaleTarget:1,t&&this.base.scale.setScalar(this.scale)}update(){const{scale:e}=this.base,{et:t,stableDt:s}=this.webgl.$time;this.scale=cs(this.scale,this.scaleTarget,.15,s),e.setScalar(this.scale),this.base&&this.base.update(s)}destroy(){this.base&&this.base.destroy()}}function Ii(i,e){if(i.x===e.x){if(i.y>e.y)return S.up;if(i.y<e.y)return S.down}if(i.y===e.y){if(i.x>e.x)return S.right;if(i.x<e.x)return S.left}return null}function nr(i){const e={lastBodyPartPosition:null,headPosition:null,length:0,direction:null},t=[],s=[],n=i.split(`
`);n.shift(),n.pop();for(let o=0;o<n.length;o++){const r=n[o].split("");for(let a=0;a<r.length;a++){const l=r[a],c=new x().fromTile(a,o);switch(l){case"#":t.push([si,{position:c}]);break;case"$":s.push([Re,{position:c}]);break;case"1":e.headPosition=c,e.length++,e.lastBodyPartPosition&&(e.direction=Ii(c,e.lastBodyPartPosition));break;case"0":e.length++,e.headPosition?e.direction||(e.direction=Ii(e.headPosition,c)):e.lastBodyPartPosition=c;break}}}return{snake:e,colliders:t,collectables:s}}const Fi=()=>{},or=new E;function rr(i){const{TOP:e,TILE_SIZE:t,GRID_ROW:s,GRID_COL:n,GRID_WIDTH:o,GRID_HEIGHT:r}=f.$store,a=[],l=D(0);let c=new Array(s).fill().map(()=>new Array(n).fill());c=c.reduce((w,T,C)=>(T.reduce((L,z,N)=>{const B={},$=new E().fromTile(C,N),y=ye=>(B.ref=ye,ye.tile=B,B.isCollider=!!ye.isCollider,B.isCollectable=!!ye.isCollectable,a.includes(B)&&a.splice(a.indexOf(B),1),B),F=ye=>(B.ref=null,ye&&(ye.tile=null),B.isCollider=B.isCollectable=!1,a.includes(B)||a.push(B),l.set(a.length),B),te=()=>!!B.ref,Fe=Fi;let W=null;return Object.assign(B,{get tilePos(){return{i:C,j:N}},get pos(){return $},get ref(){return W},isBorder:m(C,N),isCollider:!1,isCollectable:!1,onCollision:Fe,alloc:y,release:F,isAllocated:te}),F(),L[C][N]=B,L},w),w),c),l.watchImmediate(w=>i.stopPopingCoins=w<=5);const h={},d=i.levels=new Map,u={get TILES(){return c},get FREE_TILES(){return a},levels:d,levelsPerDifficulty:{},getFreeTile:M,getTileFromPos:b,allocate:k,release:v,reset:p,getLevelByLevelCount:g,loadLevels:_};return u;function p(){for(let w in h)h[w]=0}function g(w){let T,C;for(const z in u.levelsPerDifficulty)if(T=z,C=u.levelsPerDifficulty[z],w-=C.length,w<0)break;const L=C[h[T]];return h[T]=(h[T]+1)%C.length,L}async function _(){const w=Object.entries(Xo).map(async([T,C])=>{const{DIFFICULTY:L,PATTERN:z}=C,N={name:T,difficulty:L,rawPatTern:z,pattern:nr(z)};if(!u.levelsPerDifficulty[L]){const B=[];u.levelsPerDifficulty[L]=B,h[L]=0}return u.levelsPerDifficulty[L].push(N),d.set(T,N),N});for(const T in u.levelsPerDifficulty)u.levelsPerDifficulty[T].sort();return w}function M(){if(!a.length)return!1;const w=i.snake.headPosition,T=I.randomInt(0,a.length-1),C=a[T];return w.equals(C.pos)||w.equals(C.tilePos)?M():C}function k(w){const T=w.position;if(!T)return!1;const C=b(T);if(!C)return!1;C.alloc(w),w.onCollision&&(C.onCollision=w.onCollision)}function v(w){const T=w.position;if(!T)return!1;const C=b(T);if(!C)return!1;C.release(),C.onCollision=Fi}function b(w){var C;if(!w)return null;const T=or.copy(w);return w.isThreeCoords&&T.toTile(),(C=c==null?void 0:c[T.x])==null?void 0:C[T.y]}function m(w,T){return w===0||T===0||w===s-1||T===n-1}}function ar(i){const{log:e}=Ue("Game","#a4f2b2","#000"),t=D(5),s=D(0),n=D(2),o=D(1),r=D(2),a=D(0),l=D(0),c=D(0),h=D(3),d=D([]),u=D(null),p={maxCollectablesBeforeUp:t,collectablesEaten:s,speed:n,speedIncrement:o,maxSpeed:r,bonusPoints:0,score:a,stageScore:l,levelsCount:c,countdown:h,history:d,currentLevel:u,isActive:!1,isRunning:!1,isReady:!1,stopPopingCoins:!1,uniqueCoinHasPoped:!1,disableCollision:!1,artboard:null,snake:null,changeLevel:M,changeLevelByLevelCount:_,init:g,update:v,reset:k,log:e};p.artboard=rr(p),p.snake=Do(p),i.$app.$view.current.watchImmediate(b=>p.isActive=b==="Game");function g(){u.set(p.levels.get("test"))}function _(){const b=c.value,m=p.artboard.getLevelByLevelCount(b);p.currentLevel.set(m)}function M(b){const m=p.levels.get(b);p.currentLevel.set(m)}function k(){d.set([],!0),a.set(0),l.set(0),c.set(0),s.set(0),p.artboard.reset(),_()}function v(){p.isActive&&i.$state.update()}return function(m){m.$game=p,m.$artboard=p.artboard,m.$snake=p.snake}}function lr(){let i={};return{get:t,add:s,clear:n,list:e};function e(){return i}function t(o,r=!0){if(i[o])return i[o];if(r){for(const a in i)if(a.match(o))return i[a]}}function s(o,r){i[o]=r}function n(){i={}}}const st=lr();function cr(i,e={}){return new Promise((t,s)=>{const n=new XMLHttpRequest;n.responseType=e.responseType||"arraybuffer",n.onreadystatechange=()=>{n.readyState===4&&(n.readyState===4&&n.status===200?(e.noCache||st.add(i,n.response),e.onLoad&&e.onLoad(n.response),t(n.response,n.status)):s(n.status))},n.open("GET",i,!0),n.send()})}const Ze={},rt={};function hr(){return st.list()}function ur(i,e){return st.get(i,e)}function dr(i,e={}){if(st.get(i))return Promise.resolve();if(rt[i])return rt[i];!i.startsWith("http")&&!i.startsWith("/")&&(i=(typeof VV_PROJECT_BASEPATH<"u"?VV_PROJECT_BASEPATH:"")+i);let t;return e.loader&&Ze[e.loader]?t=Ze[e.loader].function(i,e):t=pr(i,e),t&&(rt[i]=t,t.then(()=>rt[i]=null)),t}function fr(i){i.loader&&(i=i.loader),Ze[i.name]=i}function pr(i,e){for(const t in Ze){const s=Ze[t];if(s.extensions){const n=s.extensions;for(let o=0;o<n.length;o++){const r=n[o];if(i.endsWith(r))return s.function(i,e)}}else if(s.test&&s.test(i,e))return s.function(i,e)}return cr(i,e)}const at={get:ur,list:hr,load:dr,registerLoader:fr},vt={default:!0,webp:!1,avif:!1};async function Ai(i){const e="image/"+i,t=document.createElement("picture"),s=document.createElement("img"),n=document.createElement("source");n.srcset="data:,x",n.type=e,t.appendChild(n),t.appendChild(s),await 0;const o=!!s.currentSrc;return vt[i]=o,o}const mr=Promise.all([Ai("webp"),Ai("avif")]);function gr(){return mr}function Di(i,e,t){return typeof i=="object"&&(t=i.avif,e=i.webp,i=i.url??i.default??i),vt.avif&&t?t:vt.webp&&e?e:i}const Ss=["jpeg","png","jpg","gif"],br=[...Ss,"avif","webp"];function vr(i,e){let t={};for(let s in i){const n=i[s],o=n.default??n,r=s.split("/").pop().split(".");let a=r.pop();if(!br.includes(a))continue;Ss.includes(a)&&(a="url");const l=r.join("."),c=t[l]=t[l]||{};c[a]=o}return Object.values(t).length===1&&!e&&(t=Object.values(t)[0]),t}const yr={test:gr,list:vr,select:Di,get:Di,supports:vt};function ni(i,e){return new Promise(t=>{const s=new Image,n=()=>{const o={node:s,url:i};e.onLoad&&e.onLoad(o),st.add(i,o),t(o)};s.crossOrigin="anonymous",s.onload=n,s.decoding="async",s.setAttribute("decoding","async"),s.src=i})}ni.loader={name:"image",extensions:[".jpg",".png",".webp",".avif",".gif",".jpeg"],function:ni};function yt(i){const e=f.threeRenderer.capabilities.isWebGL2,t=new Bs(i.img);return i.linear&&(i.magFilter=ft,i.minFilter=ft),i.flipY!==void 0&&(t.flipY=i.flipY),i.mipmaps!==void 0&&(t.generateMipmaps=!!i.mipmaps),i.red&&(i.format=e?Ps:Rs),i.alpha&&(i.format=Os),i.nearest&&(t.magFilter=t.minFilter=Us),i.magFilter&&(t.magFilter=i.magFilter),i.minFilter&&(t.minFilter=i.minFilter),i.encoding&&(t.encoding=i.encoding),i.mapping&&(t.mapping=i.mapping),i.premultiplyAlpha&&(t.premultiplyAlpha=!0),i.repeat?(t.wrapS=gi,t.wrapT=gi):(i.wrapS&&(t.wrapS=i.wrapS),i.wrapT&&(t.wrapT=i.wrapT)),i.format&&(t.format=i.format),i.type&&(t.type=i.type),t.needsUpdate=!0,t}function Bi(i,e,t,s=0){const n=e.size,o=e.scale*(f.$store.TILE_SIZE/50),r={},a=i.anchor||i.pivot||{x:.5,y:.5};t.split("_")[0]==="hint"&&(a.x=0,a.y=0);const h=i.frame,d=i.sourceSize,u=i.spriteSourceSize;r.id=t;const p=t.split("/");r.sequence=p.pop(),r.group=p.join("/"),r.frameIndex=s,r.texCoords=new Float32Array([h.x/n.w,(n.h-h.y-h.h)/n.h,h.w/n.w,h.h/n.h]),r.meshCoords=new Float32Array([u.w*.5+u.x-d.w*a.x,-(u.h*.5+u.y-d.h*a.y),u.w,u.h]);for(let g=0,_=r.meshCoords.length;g<_;g++)r.meshCoords[g]*=o;return r.anchor=a,r.sourceSize=i.sourceSize,r.spriteSourceSize=i.spriteSourceSize,r.vertices=i.vertices,r.verticesUV=i.verticesUV,r.triangles=i.triangles,r}function wr(i){const e={sprites:{},meta:i.meta},t=i.frames;i.animations||(i.animations={});for(const s in i.animations){const n=i.animations[s],o=e.sprites[s]=[];for(let r=0,a=n.length;r<a;r++){const l=t[n[r]];delete t[n[r]],o.push(Bi(l,i.meta,s,r))}}for(const s in t){const n=t[s];let o=n.filename?n.filename.toString():s;o=o.split("/").pop();const r=o.replace(/[^a-zA-Z0-9-_-]/g,"").replace("png",""),a=e.sprites[r]=[];delete t[s],a.push(Bi(n,i.meta,r))}return e}const xr=""+new URL("sprites-b2fca029.png",import.meta.url).href,Sr=""+new URL("sprites-856fa547.json",import.meta.url).href,Tr=""+new URL("perlin-956753cf.png",import.meta.url).href,Cr=""+new URL("perlin2-2a021036.png",import.meta.url).href,_r=""+new URL("logo-dd6b13cb.png",import.meta.url).href,Er=""+new URL("square-0dde0cfc.png",import.meta.url).href;function kr(){const i={atlas:null,textures:null,init:e,preload:t,loadImage:s,loadTexture:n,loadAtlas:o};async function e(){await yr.test(),at.registerLoader(ni)}async function t(){await Promise.all([n(Tr,"perlin",{repeat:!0}),n(Cr,"perlin2",{repeat:!0}),n(xr,"sprites",{linear:!0,mipmaps:!1}),n(_r,"logo",{linear:!0,mipmaps:!1}),n(Er,"square",{linear:!0,mipmaps:!1}),o(Sr)]),i.atlas.meta.image=i.textures.sprites,i.atlas.texture=i.textures.sprites}function s(r){at.load(r).then(({node:a})=>a)}async function n(r,a="",l){if(i.textures[a])return i.textures[a];const c=await at.load(r,l);return i.textures[a]=yt({img:c==null?void 0:c.node,...l})}async function o(r){const a=await at.load(r,{responseType:"json"});return Object.assign(i.atlas,wr(a))}return function(a){a.$loader=i;const{collection:l}=a;l.textures||(l.textures={}),l.atlas||(l.atlas={}),i.textures=l.textures,i.atlas=l.atlas}}const oi={linear:[.25,.25,.75,.75],inSine:[.47,0,.745,.715],outSine:[.39,.575,.565,1],inOutSine:[.445,.05,.55,.95],inQuad:[.55,.085,.68,.53],outQuad:[.25,.46,.45,.94],inOutQuad:[.455,.03,.515,.955],inCubic:[.55,.055,.675,.19],outCubic:[.215,.61,.355,1],inOutCubic:[.645,.045,.355,1],inQuart:[.895,.03,.685,.22],outQuart:[.165,.84,.44,1],inOutQuart:[.77,0,.175,1],inQuint:[.755,.05,.855,.06],outQuint:[.23,1,.32,1],inOutQuint:[.86,0,.07,1],inExpo:[.95,.05,.795,.035],outExpo:[.19,1,.22,1],inOutExpo:[1,0,0,1],inCirc:[.6,.04,.98,.335],outCirc:[.075,.82,.165,1],inOutCirc:[.785,.135,.15,.86],outSwift:[.55,0,.1,1],snap2:[0,.975,0,1],bounce:[.18,.89,.34,1.76],bounce2:[.865,-.005,0,1.47],bounce3:[.865,-.005,0,1.64],bounce4:[0,1.49,.105,.94],hardBounce:[.07,1.525,.36,.935],longKeyframe:[.49,.05,.32,1.04],elastic:[0,.49,.205,1]},Dt={},Pi=i=>i;function P(i,e,t,s){if(i||(i="linear"),Array.isArray(i))if(i.length==4){const o=i;i=o[0],e=o[1],t=o[2],s=o[3]}else i="linear";if(typeof i=="string"){if(i==="linear")return Pi;const o=oi[i];if(!o)return Pi;i=o[0],e=o[1],t=o[2],s=o[3]}const n=[i,e,t,s].join("_");return Dt[n]?Dt[n]:Dt[n]=new Gs(i,e,t,s)}const Ri=function(){};class $r{constructor(e){this.selfDestruct=e.selfDestruct===void 0?!0:e.selfDestruct,this.onProgress=e.onProgress||Ri,this.onComplete=e.onComplete||Ri,this.time=0,this.progress=0,this.delay=e.delay||0,this.duration=e.duration||1e3,this.initialDelay=this.delay,this.initialDuration=this.duration,this.target=e.target,this.property=e.property,this.method=e.method,this.from=this.to=this.delta=this.current=0,this.setFromTo(e.from,e.to),e.bezier?this.ease=e.bezier:this.ease=e.easing?Array.isArray(e.easing)?P(e.easing):P(oi[e.easing]):P(oi.inOutQuart),this.paused=!!e.paused,this.ended=!1,this.finished=new Promise(t=>this.resolve=t)}setFromTo(e,t){this.from=e!==void 0?e:this.target[this.property],this.to=t!==void 0?t:e,this.delta=this.to-this.from,this.current=this.from}reset(){this.time=0,this.progress=0,this.delay=this.initialDelay,this.duration=this.initialDuration,this.ended=!1,this.finished=new Promise(e=>this.resolve=e),this.play()}play(){this.paused=!1}pause(){this.paused=!0}update(e){this.paused||this.ended||this.destroyed||(this.delay>0&&(this.delay-=e,e=this.delay<0?Math.abs(this.delay):0),this.time+=e,this.progress=Math.max(0,Math.min(this.time/this.duration,1)),this.progress===0?this.current=this.from:this.progress===1?this.current=this.to:this.current=this.from+this.delta*this.ease(this.progress),this.target&&(this.property?this.target[this.property]=this.current:this.method&&this.target[this.method](this.current)),this.onProgress(this.progress,this.current,e),this.progress>=1&&(this.paused=!0,this.ended=!0,this.resolve(),this.onComplete&&this.onComplete(),this.selfDestruct&&this.destroy()))}destroy(){this.destroyed||(this.destroyed=!0,this.paused=!0,this.onProgress=void 0,this.finished=void 0,this.cb=void 0)}}function Oi(i){return new $r(i)}const qe=I.randomFloat;I.tossCoin;const Bt=new A(1,1,1),Mr=new x,Lr=P("outQuad"),Ir={beforeAlloc:Fr,particleEmitted:Ar,particleUpdated:Dr};function Fr(i){i.amount=1,i.batcherName="emissive",i.batcherID="emissive"}function Ar(i,{position:e,color:t,point:s=1,brightness:n=.65,alpha:o=1,delay:r=0}){i.spriteId=`${s}Bonus`,i.seed=qe(0,100),i.billboard=!0,i.progressEase=P("outQuint"),i.alphaEase=P("longKeyframe"),i.scaleEase=P("linear"),i.colorEase=P("outSwift"),i.delay=r,i.duration=800;const a=e||Mr;i.positionFrom.copy(a),i.positionFrom.y+=10,i.position.copy(i.positionFrom),i.positionTo.copy(i.positionFrom),i.positionTo.y+=30;const l=.9;i.scaleFrom.setScalar(l),i.scaleFrom.multiplyScalar(qe(.5,.65)),i.scaleTo.setScalar(l),i.scaleTo.multiplyScalar(qe(.65,.75));const c=t||Bt,h=n;i.colorFrom.copy(c),h&&i.colorFrom.lerp(Bt,qe(h*.25,h)),i.colorTo.copy(c),h&&i.colorTo.lerp(Bt,qe(h,h*1.25)),i.alphaFrom=1,i.alphaTo=1}function Dr(i,e){const t=f.$time.stableDt;i.alpha=i.age>500?~~(i.age/66)&1:1,i.positionFrom.y+=.01*t,i.positionTo.y+=.01*t,i.position.lerpVectors(i.positionFrom,i.positionTo,Lr(i.progress))}const Br=Object.freeze(Object.defineProperty({__proto__:null,default:Ir},Symbol.toStringTag,{value:"Module"})),re=I.randomFloat,Pt=new A(1,1,1),Pr=new x,Rr={beforeAlloc:Or,particleEmitted:Ur};function Or(i){i.amount=1,i.batcherName="emissive",i.batcherID="wave"}function Ur(i,{position:e,color:t,type:s={isNormal:!1,isBonus:!1,isLevelUp:!1},minDuration:n=1e3,maxDuration:o=1200,brightness:r=.5,alpha:a=1,delay:l=0}){i.spriteId="radialWave",i.speedFactor=1,i.duration=re(n,o),s.isLevelUp&&(i.duration+=re(400,500)),i.delay=l,s.isLevelUp&&(i.delay+=re(20,40)),i.alphaInOut=!0,i.progressEase=P("outExpo"),i.alphaEase=P("outExpo"),i.scaleEase=P("linear"),i.colorEase=P("outSwift");const c=e||Pr;i.position.copy(c);const h=.7;i.scaleFrom.setScalar(h),i.scaleFrom.multiplyScalar(re(.1,.15)),i.scaleTo.setScalar(h),s.isNormal?i.scaleTo.multiplyScalar(re(1.15,1.25)):s.isBonus?i.scaleTo.multiplyScalar(re(1.45,1.65)):i.scaleTo.multiplyScalar(re(1.8,2));const d=t||Pt,u=r;i.colorFrom.copy(d),u&&i.colorFrom.lerp(Pt,re(u*.25,u)),i.colorTo.copy(d),u&&i.colorTo.lerp(Pt,re(u,u*1.25)),i.alphaFrom=a,i.alphaTo=0}const Gr=Object.freeze(Object.defineProperty({__proto__:null,default:Rr},Symbol.toStringTag,{value:"Module"}));hs();const q=I.randomFloat,lt=I.tossCoin,Ui=(i,e)=>q(i*(1-e),i*(1+e)),Rt=new A(1,1,1),zr=new x,He=new x,Nr=P("outExpo"),Gi=q(2,3.5),jr=Math.PI,zi=jr*2,Ni=35,Vr={beforeAlloc:qr,particleEmitted:Hr,particleUpdated:Wr};function qr(i){let e=6,t=13;t=Math.max(e,t),e=Math.min(e,t),i.amount=I.randomInt(e,t),i.batcherName="emissive",i.batcherID="emissive"}function Hr(i,{position:e,minDuration:t=300,maxDuration:s=500,alpha:n=1,delay:o=0,brightness:r=.25,color:a}){i.seed=q(0,100),i.speed=q(Gi*.5,Gi*1.5);const l=lt(.2);if(l)i.spriteId="point";else{const _=lt(.5)?"circle":"triangle",M=lt(.5)?"stroke":"fill";i.spriteId=`${_}_${M}`}const c=i.spriteId.includes("fill");i.billboard=!0,i.angVelocity=.075*(lt(.35)?-1:1),i.progressEase=P("outSwift"),i.alphaEase=P("inExpo"),i.scaleEase=P("outExpo"),i.scaleEase=P(0,.965,.17,.985),i.colorEase=P("longKeyframe"),i.delay=o,i.speedFactor=1,i.duration=q(t,s),i.duration+=i.seed*q(.5,1.5);const h=e||zr,d=I.random();He.set(Math.sin(Ui(d,.15)*zi),Math.cos(Ui(d,.15)*zi),0).multiplyScalar(Ni*.45),i.positionFrom.copy(He).add(h),i.position.copy(i.positionFrom),i.positionTo.copy(He).multiplyScalar(Ni*.15).add(h),Math.atan2(He.y,He.x);let u=l?q(.35,.5):c?q(.25,.3):q(.35,.45);u*=q(1.3,1.6)*2,i.scaleFrom.setScalar(u),i.scaleFrom.multiplyScalar(q(.3,.45)),i.scaleTo.setScalar(u),i.scaleTo.multiplyScalar(q(.9,1));const p=a||Rt,g=r;i.colorFrom.copy(p),g&&i.colorFrom.lerp(Rt,q(1-g,1-g*.5)),i.colorTo.copy(p),g&&i.colorTo.lerp(Rt,q(g*.5,g)),i.alphaFrom=n,i.alphaTo=0}function Wr(i,e){const{stableDt:t}=f.$time;i.speedFactor+=.0016*t,i.speedFactor=Math.min(1,i.speedFactor);const s=i.speed*Nr(i.speedFactor);let n=i.progress*s;n=mn(n,0,i.speed,0,1),i.position.lerpVectors(i.positionFrom,i.positionTo,n)}const Yr=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"})),de=()=>{},fe=i=>oe(i,0,1),ji=P(.7,.3,.2,.2),Kr=new ri,Qr=1/Number.MAX_SAFE_INTEGER,Ot={};class Xr extends Ie{constructor(e){e.useEuler=!0,super(e),this.webgl=pi(),this.batcher&&this.batcher.removeInstance(this),this.spriteId=null,this.spriteFrame=0,this.spriteFrameDuration=50,this.spriteLoop=!1,this.spriteAutoplay=!1,this.rotation=new Y,this.delay=0,this.duration=0,this.age=0,this.progress=0,this.onProgress=de,this.onComplete=de,this.onRelease=de,this.onEnd=de,this.angVelocity=0,this.angVelocityDrag=0,this.positionFrom=new x,this.positionTo=new x,this.velocity=new x,this.velocityDrag=new x,this.velocityDragMult=new x,this.useVelocityDragMult=!1,this.scaleWithVel=!1,this.gravity=new x,this.scaleFrom=new E,this.scaleTo=new E,this.colorFrom=new A,this.colorTo=new A,this.alphaFrom=1,this.alphaTo=1,this.alive=!1,this.killable=!1,this.progressEase=fe,this.scaleEase=fe,this.alphaEase=fe,this.colorEase=fe,this.scaleVelEase=ji}reset(){this.alive&&this.onRelease&&this.onRelease(),this.preset&&this.preset.particleReleased&&this.preset.particleReleased(this,this.presetOptions),this.parent=null,this.preset=Ot,this.spriteId=null,this.spriteFrame=0,this.spriteFrameDuration=50,this.spriteLoop=!1,this.spriteAutoplay=!1,this.billboard=!1,this.fx=0,this.angle=0,this.quaternion.copy(Kr),this.rotation.set(0,0,0),this.position.setScalar(0),this.scale.setScalar(1),this.delay=0,this.duration=1e3,this.age=0,this.progress=0,this.onProgress=de,this.onComplete=de,this.onRelease=de,this.onEnd=de,this.angVelocity=0,this.angVelocityDrag=0,this.velocity.setScalar(0),this.velocityDrag.setScalar(0),this.useVelocityDragMult=!1,this.scaleWithVel=!1,this.scaleInOut=!1,this.gravity.setScalar(0),this.scaleFrom.setScalar(1),this.scaleTo.setScalar(1),this.colorFrom.set(16777215),this.colorTo.set(16777215),this.alphaFrom=1,this.alphaTo=1,this.alphaInOut=!1,this.progressEase=fe,this.scaleEase=fe,this.alphaEase=fe,this.colorEase=fe,this.scaleVelEase=ji}emit(e,t,s,n){this.reset(),this.batcher=e,this.spriteId=this.killable=!1,this.alive=!0,this.index=n,this.billboard=s.billboard||!1,this.fx=s.fx||0,this.parent=s.parent,this.preset=t||Ot,this.presetOptions=s||Ot,this.preset.particleEmitted&&this.preset.particleEmitted(this,this.presetOptions),this.sprite.setAtlas(this.batcher.atlas),this.sprite.change({id:this.spriteId,frame:this.spriteFrame,frameDuration:this.spriteFrameDuration,loop:this.spriteLoop,autoplay:this.spriteAutoplay}),this.batcher.addInstance(this),this.sprite.update(1),this.update(0)}kill(){this.killable&&this.preset.particleKilled&&this.preset.particleKilled(this,this.presetOptions),this.killable&&this.onComplete&&this.onComplete(),this.batcher&&(this.batcher.removeInstance(this),this.batcher=null),this.reset(),this.progress=1,this.alive=!1,this.killable=!1}update(){if(!this.alive||this.killable)return;if(this.progress>=1)return this.killable=!0;let e=this.webgl.$time.stableDt;if(this.delay>0)if(this.delay-=e,this.delay>0){this.alpha=0,this.scale.setScalar(Qr);return}else e=Math.max(0,e+this.delay);super.update(e);const t=Math.max(Math.min(e/16.666666667,1.5),.5);if(this.age+=e,this.progress=this.progressEase(oe(this.age/this.duration,0,1)),this.preset.particleUpdate)this.preset.particleUpdate(this,this.presetOptions);else{if(this.useVelocityDragMult)this.velocity.multiply(this.velocityDrag),this.velocity.lengthSq<1e-4&&this.velocity.setScalar(0);else{if(this.velocity.x){const s=Math.sign(this.velocity.x);this.velocity.x-=s*this.velocityDrag.x*t,Math.sign(this.velocity.x)!==s&&(this.velocity.x=0)}if(this.velocity.y){const s=Math.sign(this.velocity.y);this.velocity.y-=s*this.velocityDrag.y*t,Math.sign(this.velocity.y)!==s&&(this.velocity.y=0)}if(this.velocity.z){const s=Math.sign(this.velocity.z);this.velocity.z-=s*this.velocityDrag.z*t,Math.sign(this.velocity.z)!==s&&(this.velocity.z=0)}}if(this.angVelocity){const s=Math.sign(this.angVelocity);this.angVelocity-=s*this.angVelocityDrag*t,Math.sign(this.angVelocity)!==s&&(this.angVelocity=0)}this.position.x+=(this.velocity.x+this.gravity.x)*t,this.position.y+=(this.velocity.y+this.gravity.y)*t,this.position.z+=(this.velocity.z+this.gravity.z)*t,this.billboard?(this.angle+=this.angVelocity*t,this.angleTo&&(this.angle=Q(this.angleFrom,this.angleTo,this.progress))):(this.rotation.z+=this.angVelocity*t,this.rotation.y+=this.angVelocity*t,this.rotation.x+=this.angVelocity*t),this.scaleWithVel?this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleVelEase(this.progress)):this.scaleInOut?this.scale.copy(this.scaleFrom).lerp(this.scaleTo,1-Math.sin(this.scaleEase(this.progress)*Math.PI)):this.scale.copy(this.scaleFrom).lerp(this.scaleTo,this.scaleEase(this.progress)),this.color.copy(this.colorFrom).lerp(this.colorTo,this.colorEase(this.progress)),this.alphaInOut?this.alpha=Q(this.alphaFrom,this.alphaTo,1-Math.sin(this.progress*Math.PI)):this.alpha=Q(this.alphaFrom,this.alphaTo,this.alphaEase(this.progress))}this.preset.particleUpdated&&this.preset.particleUpdated(this,this.presetOptions),this.onProgress&&this.onProgress(this,this.progress)}}const Zr=150,Ts=new Map;function Jr(i,e){e||(e={}),Ts.set(i,e)}class ea extends R{constructor(e){super(e),e.batcher&&(e.batchers={default:e.batcher}),this.count=e.count||Zr,this.dead=new Array(this.count).fill(0).map(()=>new Xr({})),this.alive=[],this.batchers=e.batchers||{}}emit(e,t={},s){typeof t=="number"&&(t={amount:t}),t.amount=t.amount||1;const n=Ts.get(e);if(!n||(n.beforeAlloc&&(n.beforeAlloc(t),t.batcherName&&(s=t.batcherName)),t.amount<=0))return;const o=this.batchers[s]||this.batchers.default,r=this.alloc(t.amount);n.beforeEmit&&n.beforeEmit(t,r);for(let a=r.length-1;a>=0;a--)r[a].alive,this.alive.push(r[a]),r[a].emit(o,n,t,a)}update(e){const t=[];for(let s=this.alive.length-1;s>=0;s--){const n=this.alive[s];n.update(e),n.killable&&(t.push(n),this.alive.splice(s,1),this.dead.push(n))}for(let s=t.length-1;s>=0;s--)t[s].kill()}alloc(e){const t=this.dead,s=this.alive;let n=[],o=e;return t.length>0&&(n=t.splice(0,o)),o-=n.length,o>0&&(n=n.concat(s.splice(0,o))),n}killAll(){for(let e=this.alive.length-1;e>=0;e--)this.alive[e].kill(),this.dead.push(this.alive[e]),this.alive.splice(e,1)}registerPreset(e,t){Jr(e,t)}}let ta=0;const Ut=new Ke,Gt=new Map,pe=new J,ia=new ri,Vi={default:Yt,normal:Yt,additive:is},qi={double:qs,front:Hs,back:Ws};class zt extends R{init(){this.needsUpdate=!0,this.atlas=this.props.atlas,this.count=this.props.count||200,this.geo=new zs,this.geo.index=Ut.index,this.geo.attributes.position=Ut.attributes.position,this.geo.attributes.uv=Ut.attributes.uv,this.initAttributes(),this.layers=[],window.layers=this.layers,this.setDynamic(this.props.dynamic);const e=this.getMaterial(this.props);this.base=new wt(this.geo,e),this.props.renderOrder&&(this.base.renderOrder=this.props.renderOrder),this.base.frustumCulled=!!this.props.frustumCulled,this.currentCount=0,this.updateAttributes=this.updateAttributes.bind(this)}setDynamic(e){this.dynamic=e==null?!0:!!e,this.interleavedBuffer.setUsage(this.dynamic?Ns:js),this.interleavedBuffer.needsUpdate=!0,this.needsUpdate=!0}getMaterial({atlas:e,count:t,renderOrder:s,material:n,...o}){const r=n;if(!r)return;Gt.has(r)||Gt.set(r,{});const a=Gt.get(r);if(!e)return;e.meta.atlasIndex==null&&(e.meta.atlasIndex=++ta);const l=[e.meta.atlasIndex,...Object.keys(o).sort().map(c=>c+":"+o[c])].join("|");return a[l]?a[l]:a[l]=new r({...o,atlas:e,side:qi[o.side]??qi.front,blending:typeof o.blending=="function"?o.blending:Vi[o.blending]??Vi.default,depthWrite:!!o.depthWrite,depthTest:!!o.depthTest,transparent:!!o.transparent,alphaTest:!!o.alphaTest})}initAttributes(){this.stride=4+4+3+2+4+4,this.buffer=new Float32Array(this.count*this.stride);const e=this.geo,t=this.interleavedBuffer=new Vs(this.buffer,this.stride);e.setAttribute("texCoords",new Ae(t,4,0,!1)),e.setAttribute("meshCoords",new Ae(t,4,4,!1)),e.setAttribute("spritePos",new Ae(t,3,8,!1)),e.setAttribute("decorators",new Ae(t,2,11,!1)),e.setAttribute("spriteQt",new Ae(t,4,13,!1)),e.setAttribute("spriteColor",new Ae(t,4,17,!1)),t.needsUpdate=!0}updateAttributes(e){if(!e||!e.visible||e.alpha<.001)return;const t=this.currentCount++,s=this.buffer,n=this.stride,o=e.sprite.frame;let r=t*n;e.useEuler&&e.quaternion.setFromEuler(e.rotation);let a=e.position,l=e.quaternion,c=e.scale;if(e.parent){const d=e.parent;pe.position.copy(a),pe.quaternion.copy(e.billboard?ia:l),pe.scale.set(c.x,c.y,1),pe.applyMatrix4(d.matrixWorld),pe.updateMatrixWorld(),a=pe.position,l=pe.quaternion,c=pe.scale}const h=e.billboard?e.angle:l.x;s[r++]=o.texCoords[0],s[r++]=o.texCoords[1],s[r++]=o.texCoords[2],s[r++]=o.texCoords[3],s[r++]=o.meshCoords[0]*c.x,s[r++]=o.meshCoords[1]*c.y,s[r++]=o.meshCoords[2]*c.x,s[r++]=o.meshCoords[3]*c.y,s[r++]=a.x,s[r++]=a.y,s[r++]=a.z,s[r++]=e.billboard?1:0,s[r++]=e.fx,s[r++]=h,s[r++]=l.y,s[r++]=l.z,s[r++]=l.w,s[r++]=e.color.r,s[r++]=e.color.g,s[r++]=e.color.b,s[r++]=e.alpha}createLayers(e){for(let t=this.layers.length;t<=e;t++)this.layers[t]==null&&(this.layers[t]=new Set)}addInstance(e){const t=e.zIndex|0;this.layers[t]==null&&this.createLayers(t);const s=this.layers[t];s.has(e)||s.add(e)}removeInstance(e){const t=e.zIndex|0;this.layers[t]==null&&this.createLayers(t);const s=this.layers[t];s.has(e)&&s.delete(e)}update(){if(this.dynamic){this.currentCount=0;for(let e=0;e<this.layers.length;e++)this.layers[e].forEach(this.updateAttributes);this.geo.instanceCount=this.currentCount,this.interleavedBuffer.needsUpdate=!0,this.base&&(this.base.visible=!!this.currentCount)}}clearInstances(){for(let e=0;e<this.layers.length;e++)this.layers[e].clear()}destroy(){this.clearInstances(),this.geo.dispose(),super.destroy()}}const sa=`precision highp float;
uniform sampler2D atlas;
uniform float time;
#ifdef USE_GAME_AREA_MASK
uniform vec4 areaMask;
#endif
varying vec2 vUv;
varying vec4 vColor;
varying float vY;
void main() {
vec2 uv = vUv;
vec4 tex = texture2D(atlas, uv);
vec3 color = vec3(0.);
float alpha = 1.;
color = vColor.rgb * tex.rgb;
alpha = vColor.a * tex.a;
#ifdef USE_GAME_AREA_MASK
alpha *= step(areaMask.x, gl_FragCoord.x)
* step(gl_FragCoord.x, areaMask.y)
* step(areaMask.z, gl_FragCoord.y)
* step(gl_FragCoord.y, areaMask.w)
;
#endif
gl_FragColor = vec4(color, alpha);
}`,na=`precision highp float;
attribute vec4 texCoords;
attribute vec4 meshCoords;
attribute vec3 spritePos;
attribute vec4 spriteQt;
attribute vec4 spriteColor;
attribute vec2 decorators;
varying vec2 vUv;
varying vec4 vColor;
uniform float time;
mat4 getInstanceMatrix(vec3 p, vec4 q, vec3 s) {
mat4 m;
float x = q.x;
float y = q.y;
float z = q.z;
float w = q.w;
float x2 = x + x;
float y2 = y + y;
float z2 = z + z;
float xx = x * x2;
float xy = x * y2;
float xz = x * z2;
float yy = y * y2;
float yz = y * z2;
float zz = z * z2;
float wx = w * x2;
float wy = w * y2;
float wz = w * z2;
float sx = s.x;
float sy = s.y;
float sz = s.z;
m[0][0] = (1. - (yy + zz)) * sx;
m[0][1] = (xy + wz) * sx;
m[0][2] = (xz - wy) * sx;
m[0][3] = 0.;
m[1][0] = (xy - wz) * sy;
m[1][1] = (1. - (xx + zz)) * sy;
m[1][2] = (yz + wx) * sy;
m[1][3] = 0.;
m[2][0] = (xz + wy) * sz;
m[2][1] = (yz - wx) * sz;
m[2][2] = (1. - (xx + yy)) * sz;
m[2][3] = 0.;
m[3][0] = p.x;
m[3][1] = p.y;
m[3][2] = p.z;
m[3][3] = 1.;
return m;
}
void main() {
vColor = spriteColor;
vec2 signs = sign(meshCoords.zw);
vUv = ((uv.xy - 0.5) * signs.xy + 0.5) * texCoords.zw + texCoords.xy;
vec3 transformed = position;
transformed.xy = transformed.xy * meshCoords.zw * signs + (meshCoords.xy * 0.5);
transformed.xy += meshCoords.xy * 0.5;
mat4 instanceMatrix = getInstanceMatrix(spritePos, spriteQt, vec3(1.));
vec4 mPosition = modelMatrix * instanceMatrix * vec4(transformed, 1.);
vec4 mvPosition = viewMatrix * mPosition;
vec4 bbPosition = modelViewMatrix * instanceMatrix * vec4(0.0, 0.0, 0.0, 1.0);
bbPosition.x += cos(spriteQt.x) * transformed.x - sin(spriteQt.x) * transformed.y;
bbPosition.y += sin(spriteQt.x) * transformed.x + cos(spriteQt.x) * transformed.y;
mvPosition = mix(mvPosition, bbPosition, decorators.x);
gl_Position = projectionMatrix * mvPosition;
}`;class oa extends xt{constructor({uniforms:e,atlas:t,defines:s,blending:n,...o}={}){super(),this.uniforms={...e||{},atlas:{value:t.texture,type:"t"}},o.gameAreaMask&&(this.uniforms.areaMask=f.uniforms.areaMask);const r=this.defines={...f.defines,...s||{}};o.gameAreaMask&&(r.USE_GAME_AREA_MASK=!0),this.transparent=!0,this.depthTest=!1,this.depthWrite=!1,this.vertexShader=na,this.fragmentShader=sa}}const ra=Object.assign({"/webgl/plugins/particles/presets/bonus.js":Br,"/webgl/plugins/particles/presets/radialWave.js":Gr,"/webgl/plugins/particles/presets/sparkle.js":Yr}),aa=Object.entries(ra).map(([i,e])=>({id:i.split("/").pop().split(".js").shift(),module:e.default})),la=i=>i.update();function ca(){let i,e;const t={},s={batchers:t,init:n,emit:o,update:c,addTo:a,removeFromParent:l};function n(){const h={renderOrder:2,material:oa,atlas:f.collection.atlas,transparent:!0,depthTest:!1,depthWrite:!1,blending:"normal"};Object.assign(t,{normal:new zt({...h,count:300}),emissive:new zt({...h,count:40,transparent:!0,blending:"additive"}),top:new zt({...h,count:10,renderOrder:4})}),i=Object.values(t),i.forEach(d=>d.triggerInit()),e=new ea({batchers:t,count:3e3}),aa.forEach(d=>e.registerPreset(d.id,d.module))}function o(h,d={}){if(!e)return;const u=d.batcherID||"default";return e.emit(h,d,u)}function r(){e.killAll()}function a(h){this.removeFromParent();for(let d=0,u=i.length;d<u;d++){const p=i[d];h.add(p.base),p.base.manualMatrixUpdate=!0,p.base.updateMatrixWorld()}}function l(){for(let h=0,d=i.length;h<d;h++){const u=i[h];u.base.parent&&u.base.parent.remove(u.base)}r()}function c(){i.forEach(la),e&&e.update()}return function(d){d.$particles=s}}let ha=0;function Ne(i,e,t){const s=()=>{};return{c:++ha,shader:i,use:o=>{const r=o.material||o;return r[e]=i,r.needsUpdate=!0,o},unuse:s,clear:s}}const ua=`precision highp float;
uniform float time;
uniform vec4 resolution;
uniform sampler2D inputTexture;
uniform sampler2D noise;
uniform sampler2D noise2;
uniform float colorGlitchStr;
uniform float glitchTime;
uniform vec2 slicesMult;
uniform float colorGlitch;
uniform float amplitude;
uniform vec4 uvContain;
uniform vec2 containMult;
varying vec2 vUv;
varying float stepTime;
const float warpStrength  = 1. / 40.;
float luma(vec3 rgb) {
return dot(vec3(0.2126, 0.7152, 0.0722), rgb);
}
vec2 warp(vec2 pos) {
vec2 scale = containMult;
pos = (pos*2.0-1.0) * scale;
pos *= 1.0 + vec2(pos.y * pos.y, pos.x * pos.x) * warpStrength;
return pos / scale * 0.5 + 0.5;
}
void main() {
vec2 uv = gl_FragCoord.xy * uvContain.xy + uvContain.zw;
vec2 wuv = warp(vUv);
float t2 = glitchTime * 0.03;
float vslices = slicesMult.x + abs(floor(sin(cos(t2 * 10.) * 10. - t2 * 22.) * 5.));
float pxy = smoothstep(0., 1., floor(wuv.y * vslices) / vslices);
float so = texture2D(noise, vec2(t2 * 20.1, pxy * 2.0 + t2 * -20.1)).g;
float hslice = floor(2. + so * 2. + smoothstep(0.2, 0.9, so) * so * 5.) * slicesMult.y;
float pxx = floor(wuv.x * hslice) / hslice;
vec3 n = smoothstep(0., 1., texture2D(noise, t2 * -15. + vec2(pxx, pxy)).rgb) * 2. - 1.;
vec2 bsuv = wuv;
vec2 suv;
float amp = amplitude;
suv = bsuv;
suv.x += n.g * amp * 0.2;
suv.x -= 0.001;
suv.x += smoothstep(0.5, 0.7, n.g) * 0.2 * amp;
vec2 red = texture2D(inputTexture, suv).ra;
suv = bsuv;
suv.x += n.r * amp * 0.29;
suv.y += 0.001;
suv.y += smoothstep(0.5, 0.7, n.r) * 0.04 * amp;
vec2 green = texture2D(inputTexture, suv).ga;
suv = bsuv;
suv.x += n.g * amp * 0.8;
suv.y += 0.001;
suv.x += smoothstep(0.5, 0.7, n.b) * 0.2 * amp;
vec2 blue = texture2D(inputTexture, suv).ba;
vec3 base = vec3(red.x * red.y, green.x * green.y, blue.x * blue.y);
float t3 = glitchTime * 1.16;
float vslices2 = vslices * 17.;
float pxy2 = floor(bsuv.y * vslices2) / vslices2;
float so2 = texture2D(noise2, vec2(t2 + 20.1, pxy2 * 2.0 - t3 * 10.)).g;
float hslice2 = floor(2. + so2 * 2. + smoothstep(0.2, 0.9, so2) * 0.1);
float pxx2 = floor(suv.x * hslice2) / hslice2;
vec3 n2 = texture2D(noise2, n.y + vec2(pxx2, pxy2 - t3)).rgb * 2. - 1.;
float glitchColorMix = smoothstep(-1., -0.7, colorGlitch);
base = mix(
base,
vec3(0.482, 0.98, 0.984),
step(colorGlitch, n2.b) * mix(1., n.b * 3., glitchColorMix)
);
base = mix(
base,
vec3(0.918, 0.204, 0.969),
step(colorGlitch, n2.r) * mix(1., n.r * 3., max(glitchColorMix, 0.3))
);
float alpha = red.y + green.y + blue.y;
vec3 color = base;
gl_FragColor = vec4(color, 1.);
}`,da=Ne(ua,"fragmentShader"),fa=`precision highp float;
attribute lowp vec2 position;
uniform float time;
varying highp vec2 vUv;
varying float stepTime;
void main() {
vUv = position * 0.5 + 0.5;
float freq = 14.;
stepTime = floor(time * freq) / freq;
gl_Position =  vec4(position, 0., 1);
}`,pa=Ne(fa,"vertexShader"),ma=i=>i.render();function ga(){const i={},e={},t={},s={},n={enabled:D(!0),buffers:i,filters:e,uniforms:t,defines:s,registerPass:r,register:r,registerFilter:r,registerEffect:r,init:o,update:_,render:b,glitch:M,miniGlitch:k};async function o(){i.main=f.$fbo.createBuffer({name:"Main",renderer:f.threeRenderer,scale:1}),Object.assign(t,{...f.uniforms,inputTexture:{value:i.main.texture},noise:{value:f.collection.textures.perlin},noise2:{value:f.collection.textures.perlin2},glitchTime:{value:0},slicesMult:{value:new E(1,1)},amplitude:{value:0},colorGlitch:{value:.8}}),Object.assign(s,f.defines),e.main=Lo({renderer:f.threeRenderer,vertexShader:pa,fragmentShader:da,uniforms:t,defines:s,transparent:!0})}function r(m,w){e[m]=w}let a=0,l=0,c=0,h=0,d=0,u=0,p=0,g=0;function _(){const m=f.$time.et,w=f.$time.stableDt,T=20;l=Math.floor(m*.001*T)/T%1e3;const C=f.$app.$view.current.value;d+=w,d>15.5&&(d=0,u*=.96,p*=.92,g*=.945,C==="GameOver"?(c*=.93,h*=.93):(c*=.87,h*=.91)),l-a>.001&&v()}function M(m={}){e.main.uniforms,u=m.slices??-90,c=m.amplitude??2,h=m.colorGlitch??.8,v()}function k(m={}){p=m.amplitude??.1,g=m.colorGlitch??.14,v()}function v(){const m=e.main.uniforms,w=f.$app.$view.current.value;a=l,m.glitchTime.value=l,m.amplitude.value=c,m.colorGlitch.value=(h+g)*-2+1,m.slicesMult.value.x=2,w!=="Game"&&(m.amplitude.value=Math.max(0,m.amplitude.value),m.colorGlitch.value=Math.min(.9,m.colorGlitch.value)),(w==="Home"||w==="Auth")&&(m.slicesMult.value.x=Math.max(30,m.slicesMult.value.x),m.amplitude.value=Math.max(.007,m.amplitude.value),m.colorGlitch.value=Math.min(.85,m.colorGlitch.value)),w==="GameOver"&&(m.slicesMult.value.x=Math.max(90,m.slicesMult.value.x),m.amplitude.value=Math.max(.014,m.amplitude.value),m.colorGlitch.value=Math.min(.79,m.colorGlitch.value)),n.continuousGlitch&&(m.slicesMult.value.x=Math.max(20,m.slicesMult.value.x),m.amplitude.value=Math.max(.03,m.amplitude.value),m.colorGlitch.value=Math.min(.75,m.colorGlitch.value)),f.baseGame&&f.baseGame.viper&&(m.slicesMult.value.x=Math.max(20,m.slicesMult.value.x),m.amplitude.value=Math.max(.05,m.amplitude.value),m.colorGlitch.value=Math.min(.7,m.colorGlitch.value)),m.amplitude.value+=p,m.slicesMult.value.x=Math.max(2,m.slicesMult.value.x+u)}function b(){Object.values(e).forEach(ma)}return function(w){w.$pp=n}}const ba=i=>{i.onEnter=e=>{const{$app:t,$pp:s,$snake:n,$setState:o,$game:r,$playSound:a}=f;if(e&&!e.is("GameStart"))return o("GameStart");f.baseGame.removeViperOverlay(),s.continuousGlitch=!1,r.countdown.set(4);let l=r.levelsCount.value===0?1e3:700;const c=r.levelsCount.value===0?750:600;for(let h=0;h<4;h++)i.schedule(l+h*c,()=>{const d=3-h;if(!(d>3))return r.countdown.set(d),d===0&&t.$view.is("Game")?(s.miniGlitch({colorGlitch:.19,amplitude:.074}),a("Countdown_Go"),f.$setState("GameRunning")):d<=3&&(s.miniGlitch({colorGlitch:.1,amplitude:.03}),a("Countdown")),!0})},i.onUpdate=()=>{},i.onLeave=e=>{if(e!=="GameRunning")return;const{$game:t,$playSound:s}=f;t.isReady=!0}},va=Object.freeze(Object.defineProperty({__proto__:null,default:ba},Symbol.toStringTag,{value:"Module"})),ya=i=>{i.onEnter=async()=>{const{$pp:e,$app:t,$game:s,$snake:n,$camShake:o}=f,{$audio:r}=t;s.countdown.set(4),s.isGameOverSnakeVisible=!1;const a=i.uid,l=()=>!i.isActive||a!==i.uid||!t.$view.is("Game");f.$snake.controls.canBuffer=!1,s.isReady=!1,r.playSound("Game_Over"),r.stopSound("Music_8bit_Loop"),o(),e.miniGlitch({amplitude:.4,colorGlitch:.36}),e.continuousGlitch=!0,await H(700),s.isGameOverSnakeVisible=!0,f.baseGame.playerViperOverlay(),await H(1700),!l()&&t.$view.push("GameOver")},i.onUpdate=()=>{},i.onLeave=()=>{const{$pp:e}=f;e.continuousGlitch=!1,f.baseGame&&f.baseGame.removeViperOverlay()}},wa=Object.freeze(Object.defineProperty({__proto__:null,default:ya},Symbol.toStringTag,{value:"Module"})),xa=i=>{i.onEnter=async e=>{const{$pp:t,$game:s,$snake:n,$setState:o}=f;if(!s.isReady)return o("GameStart");s.countdown.set(4),f.baseGame.removeViperOverlay(),t.continuousGlitch=!1,s.isRunning=!0,n.start(),n.controls.canBuffer=!0},i.onUpdate=()=>{},i.onLeave=e=>{const{$game:t}=f;t.isRunning=!1,t.isNextLevelPending=!1}},Sa=Object.freeze(Object.defineProperty({__proto__:null,default:xa},Symbol.toStringTag,{value:"Module"})),Ta=i=>{i.onEnter=async e=>{const{$pp:t,$app:s,$game:n,$snake:o,$setState:r,scene:a}=f;if(e!=null&&e.is("GameStart"))return r("Countdown");if((!e||e!=null&&e.is("GameOver"))&&n.reset(),n.countdown.set(4),f.baseGame&&f.baseGame.removeViperOverlay(),t.continuousGlitch=!1,s.$view.push("Game"),await a.isGameBaseReady,!i.isActive)return;n.isReady=!1,n.isNextLevelPending=!1,o.controls.canBuffer=!1,a.snake.head.prevDirection=-1;const l=f.scene.gameGrid,c=n.currentLevel.value,h=f.$store.difficultySettings[c.difficulty];let d=h.maxCollectablesBeforeUp;typeof d=="function"&&(d=d()),n.maxCollectablesBeforeUp.set(d);let u=h.baseSpeed;typeof u=="function"&&(u=u()),n.speed.set(u),n.speedIncrement.set(h.speedIncrement),n.maxSpeed.set(h.maxSpeed),n.bonusPoints=h.bonusPoints,l.normalCoinCombo=0,n.collectablesEaten.set(0,!0,!0),n.uniqueCoinHasPoped=!1;const{headPosition:p,length:g,direction:_}=c.pattern.snake;o.create(p,g,_),l.load(c),r("Countdown")},i.onUpdate=()=>{},i.onLeave=()=>{}},Ca=Object.freeze(Object.defineProperty({__proto__:null,default:Ta},Symbol.toStringTag,{value:"Module"})),_a=i=>{i.onEnter=async(e,{forceLevel:t=null}={})=>{const{$pp:s,$game:n,$snake:o,$setState:r,$playSound:a}=f;if(!n.isActive)return;n.countdown.set(4),f.baseGame.removeViperOverlay(),s.continuousGlitch=!1;const l=i.uid;i.log("Next Level"),await H(500),!(!i.isActive||i.uid!==l||!n.isActive)&&(f.$pp.glitch({amplitude:.6,colorGlitch:.5}),n.isNextLevelPending=!1,n.history.value.push(n.currentLevel.value.name),n.levelsCount.set(n.levelsCount.value+1),n.stageScore.set(0,!0,!0),o.controls.canBuffer=!1,t?n.changeLevel(t.name):n.changeLevelByLevelCount(),o.body.pendingAdd=0,r("GameStart"))},i.onUpdate=()=>{},i.onLeave=()=>{}},Ea=Object.freeze(Object.defineProperty({__proto__:null,default:_a},Symbol.toStringTag,{value:"Module"})),Nt=i=>i,Hi={};let ka=0;function $a(i={},e={}){let t=0,s=0,n=0;const o=D(null),r=D("");let a=!1,l={};o.watch(b=>b.id&&r.set(b.id));const{log:c,warn:h,error:d}=Ue("State","#000","#F0EFF4"),u={},p={get time(){return t},get stateTime(){return n},get current(){return o.value},_current:o,hasReached:b=>t>=b&&s<b,start:v,isState:g,setState:M,getState:_,is:g,set:M,get:_,states:u,update:k,log:c,warn:h,error:d};for(let b in i){let m=i[b];const w={machine:p,id:b,uid:0,isActive:!1,time:0,data:{},prevTime:-1,onEnter:Nt,onUpdate:Nt,onLeave:Nt,...Ue(`State·${b}`,"#000","#F0EFF4"),hasReached:T=>w.time>=T&&w.prevTime<T,is:T=>typeof T=="string"?T===w.id:T===w,schedule:(T,C)=>{const L={startsAt:w.time+T,finished:!1,callback:z=>{if(!w.isActive||L.finished)return;const N=w.time-L.startsAt;C(N,z,w)&&(L.finished=!0)}};w._scheduledActions.push(L)},_scheduledActions:[],_update:T=>{if(!w.isActive)return;w.prevTime=w.time,w.time+=T;const C=w._scheduledActions;for(let L=0;L<C.length;L++){const z=C[L];if(!(z.finished||z.startsAt>w.time)&&(z.callback(T),!w.isActive))return}w.onUpdate&&w.onUpdate(T)}};typeof m=="function"&&(m=m(w)),typeof res=="object"&&Object.assign(w,res),u[b]=w}e.initial&&M(e.initial);function g(b){return o.value&&o.value.id===b}function _(){return o.value}function M(b,{force:m=!1,...w}={}){var L;if(!a){l.id=b,l.params={force:m,...w};return}if(!u[b]||!m&&((L=o.value)==null?void 0:L.id)===b)return;const T=o.value,C=u[b];T&&(T.onLeave&&T.isActive&&T.onLeave(C.id,w),T.isActive=!1,T.params=Hi,T.data=Hi,T.uid=-1),o.set(u[b]),C.uid=++ka%1e6,C.isActive=!0,C.prevTime=-1,C._scheduledActions.length=0,C.time=0,C.params=w,C.data={},C.onEnter&&C.onEnter(T,w)}function k(){const b=f.$time.dt;s=t,t+=b,o.value&&o.value._update(b)}function v(){a||(a=!0,l.id&&(M(l.id,l.params),l.id=null,l.params=null))}return p}const Cs={},Wi=Object.assign({"./states/Countdown.js":va,"./states/GameOver.js":wa,"./states/GameRunning.js":Sa,"./states/GameStart.js":Ca,"./states/NextLevel.js":Ea});for(let i in Wi){const e=i.split("/").pop().slice(0,-3);Cs[e]=Wi[i].default}function Ma(){const i=$a(Cs);return function(t){t.$state=i,t.$setState=i.setState,t.$getState=i.getState,t.$isState=i.isState}}const La="ontouchstart"in window||navigator.maxTouchPoints>1;function Ia(){const l={ARTBOARD_SIZE:1e3,TILE_SIZE:50,GRID_TOP:100,GRID_ROW:18,GRID_COL:12,GRID_WIDTH:900,GRID_HEIGHT:600,settings:{addCoinAfterUniqueCoin:!1,normalCoinsRequiredForBonus:5,maxNormalCoinsOnScreen:4,maxBonusCoinsOnScreen:2},difficultySettings:{1:{baseSpeed:1.7,speedIncrement:.04,maxCollectablesBeforeUp:10,bonusPoints:2,maxSpeed:2.5},2:{baseSpeed:1.8,speedIncrement:.044,maxCollectablesBeforeUp:15,bonusPoints:3,maxSpeed:3.5},3:{speedIncrement:.053,bonusPoints:5,maxSpeed:5,baseSpeed:()=>{const c=f.$game.levelsCount.value,h=f.$game.levels.size;return 1.9+Math.max(0,c-h)*.2},maxCollectablesBeforeUp:()=>{const c=f.$game.levelsCount.value,h=f.$game.levels.size;return 18+Math.max(0,c-h)*2}}},hasTouch:La,debugMode:document.location.search.includes("debug"),gameOverText:D(""),leaderboard:D([]),copyNotifVisible:D(!1),z:["uiBack","gameGrid","collider","collectable","gameGridBorder","fxBack","snakeBody","snakeHead","fxFront","uiFront"].reduce((c,h,d)=>(c[h]=d,c),{})};return l.debugMode&&console.log("v3"),function(h){h.$store=l}}const Fa=Number.MAX_SAFE_INTEGER,Yi=fs(20),Ki=fs(6),Qi=[30,60,120,144,240].map(i=>(i=1e3/i,[i+.75,i,i-.75]));function Aa(){let i=!1,e=performance.now();const t=13;let s=0,n=0,o=0;const r=$e(),a={dt:0,slowDt:0,limitedDt:0,clampedDt:0,stableDt:16.6667,smoothDt:60,et:0,slowEt:0,loopEt:0,pausedElapsed:0,frameNum:0,isPaused:!0,isStarted:!0,init:l,start:d,stop:u,resume:c,pause:h,clampTo60Fps:!0,customLoop:null,signal:r};function l(){a.customLoop?a.customLoop(p):ms.add(p),a.isStarted=!0,a.isPaused=!1,document.addEventListener("visibilitychange",()=>{document.hidden||(i=!0)})}function c(){a.isPaused=!1}function h(){a.isPaused=!0}function d(){a.isStarted=!0}function u(){a.isStarted=!1}function p(g){const _=e;if(e=performance.now(),g=e-_,g===0&&(g=16.6667),i&&(g=16.6667,i=!1,s=0,n=0,Yi.reset(),Ki.reset()),a.limitedDt=g,a.clampTo60Fps){if(s+=g,n++,n>1?o=(o+g)/2:o=g,!(s+o*.5>t)&&s<t)return;n>1&&(a.limitedDt=16.666667),g=s,s=0,n=0}a.clampedDt=oe(g===void 0?16.6667:g,1,140),a.averageDt=Yi.push(a.clampedDt);let M=a.averageDt;for(let k=0,v=Qi.length;k<v;k++){const b=Qi[k];if(M>=b[2]){M<=b[0]&&(M=b[1]);break}}a.stableDt=Math.min(Ki.push(M),50),a.dt=g,a.slowDt=g*.001,a.frameNum=(a.frameNum+1)%Fa,a.et+=g,a.slowEt=a.et*.001,a.loopEt=a.et%(2*Math.PI*1e3),a.isStarted&&(a.isPaused||(a.pausedElapsed+=g),r.emit(a.dt,a.et))}return function(_){_.$time=a,_.hooks.beforeStart.watchOnce(l),_.hooks.afterFrame.watchOnce(()=>i=!0)}}function Da(){const i=window.innerWidth/window.innerHeight;return new Ys(55,i,.1,100)}class _s extends R{constructor(e={}){super(e),this.isCamera=!0}beforeInit(){this.base||(this.base=Da(),this.base.position.set(0,0,4))}afterInit(){this.webgl.$vp.signal.watchImmediate(this.resize,this)}used(){}unused(){}resize({width:e,height:t,aspect:s}={}){e=e||this.webgl.$vp.width,t=t||this.webgl.$vp.height;let n=s||e/t;this.base.aspect=n,this.base.updateProjectionMatrix()}destroy(){this.webgl.$vp.signal.unwatch(this.resize,this)}}function We(i,e){!i||i.isUsed==e||(i.isUsed=!!e,i.isUsed?i.used():i.unused())}class Ba extends R{constructor(e={}){super(e),this.isScene=!0,this.autoUpdate=!1,this._cam={current:!1,forced:!1},this.props||(this.props=e)}triggerInit(){this.isInit||(this.base=new Ks,super.triggerInit(),this.camera||(this.camera=this.add(_s)))}init(){}get camera(){return this._cam.current}set camera(e){(!e||!e.isCamera)&&(e=!1);const t=this._cam;t.current!==e&&(We(t.current,!1),t.current=e,t.forced||We(t.current,!1))}get overrideCamera(){return this._cam.forced}set overrideCamera(e){(!e||!e.isCamera)&&(e=!1);const t=this._cam;t.forced!==e&&(We(t.forced,!1),We(t.current,!1),t.forced=e,We(t.forced,!0))}getCurrentCamera(){return this._cam.forced||this._cam.current}render(){const e=this.webgl.threeRenderer,t=this.getCurrentCamera();t&&e.render(this.base,t.base)}}const xe={small:"Small",medium:"Medium",large:"Large"};class ne extends R{init(){const{size:e="small",ref:t=null,label:s="Start",position:n=new x,color:o}=this.props;this.size=xe[e]??xe.small,this.isLarge=this.size===xe.large,this.isMedium=this.size===xe.medium,this.isSmall=this.size===xe.small,this.position=n,this.pressFactor=1,this.pressed=!1,this.hover=!1,this.byPassSound=this.props.byPassSound??!1,this.ref=this.webgl.$app.$refs[t],this.bounds=this.ref.getBoundingClientRect(),this.colorBorder=new A(3014397),this.colorPressed=new A(16777215),this.colorDisabled=new A(2527638),this.colorExtrude=new A(1138274),this.colorHover=new A(8322813),this.colorExtrudeHover=new A(888983),o&&(this.colorBorder=new A(o),this.colorPressed=new A(o).offsetHSL(0,0,.3),this.colorDisabled=new A(o).offsetHSL(0,0,-.5),this.colorExtrude=new A(o).offsetHSL(0,0,-.3),this.colorHover=new A(o).offsetHSL(0,0,.2),this.colorExtrudeHover=this.colorExtrude.clone().offsetHSL(0,0,.2)),this.weight=this.props.weight??20,this.mx=0,this.my=0,this.extrude=this.addSprite({batcher:"normal",layer:"uiFront",id:"uiBtn"+this.size+"Bg",useEuler:!0,color:this.colorExtrude}),this.bg=this.addSprite({batcher:"normal",layer:"uiFront",id:"uiBtn"+this.size+"Bg",scale:.99,useEuler:!0,color:1442072}),this.border=this.addSprite({batcher:"normal",layer:"uiFront",useEuler:!0,id:"uiBtn"+(xe[e]??xe.small)+"Border",color:this.colorBorder}),this.label=this.addSprite({batcher:"normal",layer:"uiFront",useEuler:!0,id:"uiBtnLabel"+s,color:this.colorBorder}),this.label.rotation=this.bg.rotation=this.border.rotation,this.label.position=this.bg.position=this.border.position,this.label.color=this.border.color,this.ref&&(this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onClick=this.onClick.bind(this),this.press=this.press.bind(this),this.ref.addEventListener("mouseenter",this.onMouseEnter),this.ref.addEventListener("touchstart",this.onMouseDown),this.ref.addEventListener("mousedown",this.onMouseDown),this.ref.addEventListener("click",this.onClick),this.useTouch=!1,this.useTouchLock=Date.now(),this.blinkTime=0,this.blinkDuration=220,this.lastBlink=0,this.disabled=!1,this.lerpEase=.1,this.lerpTargets={},this.lerps={ang:0,x:0,y:0},this.update())}onMouseEnter(e){this.setUseTouch(e),this.hover!==!0&&(this.useTouch||this.disabled||(this.blinkTime=this.blinkDuration,window.addEventListener("mousemove",this.onMouseMove),this.ref.addEventListener("mouseleave",this.onMouseLeave),this.bounds=this.ref.getBoundingClientRect(),this.hover=!0))}onMouseLeave(){this.hover!==!1&&(window.removeEventListener("mousemove",this.onMouseMove),this.ref.removeEventListener("mouseleave",this.onMouseLeave),this.hover=!1,this.mx=0,this.my=0)}setUseTouch(e){const t=Date.now(),s=e.changedTouches;s?(this.useTouch=!0,this.useTouchLock=t):!s&&t-this.useTouchLock>1e3&&(this.useTouch=!1)}onMouseDown(e){this.useTouch||(this.setUseTouch(e),!this.disabled&&this.pressed!==!0&&(e.button!==0&&!this.useTouch||(window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onMouseUp),window.addEventListener("touchcancel",this.onMouseUp),!this.byPassSound&&this.webgl.$playSound("UI_Click"),this.pressed=!0)))}onMouseUp(){this.pressed!==!1&&(window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onMouseUp),window.removeEventListener("touchcancel",this.onMouseUp),this.pressed=!1)}onMouseMove(e){if(this.useTouch||this.disabled)return;const{clientX:t,clientY:s}=e;this.mx=(t-this.bounds.left)/this.bounds.width*2-1,this.my=(s-this.bounds.top)/this.bounds.height*2-1}press(){this.disabled||(clearTimeout(this.pressTimeout),this.fakePressed=!0,this.pressTimeout=setTimeout(()=>this.fakePressed=!1,110))}async onClick(e){var t,s;this.pressed=!1,!this.disabled&&this.clicked!==!0&&(this.clicked=!0,e.target.blur(),await H(150),!this.isDestroyed&&((s=(t=this.props).onClick)==null||s.call(t),await H(300),this.clicked=!1))}update(){const e=this.webgl.$time.stableDt;this.extrude.position.copy(this.position),this.bg.position.copy(this.position),this.border.position.copy(this.position);const t=this.pressed||this.fakePressed,s=this.hover;let n=1,o=.2;s&&(n=1.4,o=.35),t&&(n=.4,o=.5),this.pressFactor=Ee(this.pressFactor,n,o,e);const r=this.pressFactor*this.weight;let a=this.colorBorder;t?a=this.colorPressed:this.disabled?a=this.colorDisabled:s&&(a=this.colorHover),this.border.color.lerp(a,t?.6:.1);let l=this.colorExtrude;t?l=this.colorPressed:s&&(l=this.colorExtrudeHover),this.extrude.color.lerp(l,t?.4:.1),this.border.position.y+=r;let c=.1;t&&(c=.35),s&&(c=.4),this.lerpEase=Ee(this.lerpEase,c,t?.3:.12,e);let h=1,d=1;this.isMedium&&(h=.7,d=2),this.isSmall&&(h=.45,d=3),this.pressed&&(h=0,d*=.3),this.useTouch&&(h=0,d=0),this.lerpTargets.ang=this.mx*-.04*d,this.lerpTargets.x=this.mx*19*h,this.lerpTargets.y=this.my*-10*h;for(let u in this.lerps)this.lerps[u]=Ee(this.lerps[u],this.lerpTargets[u],this.lerpEase,e);if(this.extrude.rotation.z=this.lerps.ang*.15,this.extrude.position.x+=this.lerps.x*.8,this.extrude.position.y+=this.lerps.y*.35,this.border.rotation.z=this.lerps.ang,this.border.position.x+=this.lerps.x,this.border.position.y+=this.lerps.y,this.blinkTime>0){this.blinkTime-=e;const u=Date.now(),p=Q(40,14,this.blinkTime/this.blinkDuration);u-this.lastBlink>p&&(this.lastBlink=u,this.label.alpha=1-this.label.alpha),this.blinkTime<=0&&(this.label.alpha=1)}}destroy(){this.ref&&(this.ref.removeEventListener("click",this.onClick),this.ref.removeEventListener("touchstart",this.onMouseDown),this.ref.removeEventListener("mousedown",this.onMouseDown),this.ref.removeEventListener("mouseenter",this.onMouseEnter),this.ref.removeEventListener("mouseleave",this.onMouseLeave),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onMouseUp),window.removeEventListener("touchcancel",this.onMouseUp))}}const Pa=`precision highp float;
uniform float time;
uniform float freq;
varying float stepTime;
varying vec2 vUv;
void main() {
vUv = uv;
stepTime = floor(time * freq) / freq;
vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
gl_Position = projectionMatrix * mvPosition;
}`,Ra=Ne(Pa,"vertexShader"),Oa=`precision highp float;
uniform sampler2D map;
uniform sampler2D noise;
uniform float time;
uniform float amplitude;
uniform vec2 slicesMult;
uniform float alphaStep;
varying vec2 vUv;
varying float stepTime;
void main() {
vec2 uv = vUv;
float t2 = stepTime;
float vslices = slicesMult.x;
float pxy = smoothstep(0., 1., floor(uv.y * vslices) / vslices);
float so = texture2D(noise, vec2(t2 * 0.1, pxy * 2.0 + t2 * 0.1)).g;
float hslice = floor(1. + so * slicesMult.y + smoothstep(0.2, 0.9, so) * so * slicesMult.y * 9.);
float pxx = floor(uv.x * hslice) / hslice;
vec3 n = smoothstep(0., 1., texture2D(noise, t2 * 1. + vec2(pxx, pxy)).rgb) * 2. - 1.;
#ifdef IS_ADDITIVE
float addSlices = 2.;
vec2 adduv = floor(uv * vec2(0.4, 1.) * addSlices) / addSlices;
vec3 n2 = texture2D(noise, adduv + vec2(t2)).rgb * 2. - 1.;
float bm1 = 1. + smoothstep(0.3, 0.5, n2.r) * 1.5;
float bm2 = smoothstep(0.8, 1., n.r) * 0.9 * sign(n.g);
float bma = step(alphaStep, n.g);
vec2 ruv = uv + (cos(t2 * 2.) * n2.g * 2. + vec2(n2.r * 4., n2.b * 2.)) * 0.02 * amplitude * n2.g * 4. * bm1 + bm2 * amplitude;
vec2 gbuv = uv + (sin(t2 * -2.) * n2.b * 2. + vec2(n2.g * 4., n2.r * 1.)) * 0.01 * amplitude * n2.r * 6. * -bm1;
vec2 vr = texture2D(map, ruv).ra;
float r = vr.x * vr.y;
vec3 vgb = texture2D(map, gbuv).gba;
vec2 gb = vec2(vgb.x, vgb.y) * vgb.z;
vec3 c = vec3(0., gb.x, gb.y) + vec3(1., 0.169, 0.82) * r;
vec4 color = vec4(c, 1. - bma);
#else
vec4 color = texture2D(map, uv);
#endif
gl_FragColor = vec4(color);
}`,Ua=Ne(Oa,"fragmentShader");let jt=null,Vt=null;const Je={center:new Ke(1,1,1,1),topCenter:new Ke(1,1,1,1),topLeft:new Ke(1,1,1,1)};Je.center.translate(0,0,0);Je.topCenter.translate(0,-.5,0);Je.topLeft.translate(.5,-.5,0);class Xi extends xt{constructor({additive:e}={}){super(),this.transparent=!0,this.blending=e?is:Yt,this.depthTest=!1,this.depthWrite=!1,this.uniforms={...f.uniforms,noise:{type:"t",value:f.collection.textures.perlin2},map:{type:"t",value:null},time:{type:"f",value:0},amplitude:{type:"f",value:0},slicesMult:{type:"v2",value:new E},freq:{type:"f",value:1},alphaStep:{type:"f",value:.8}},this.defines={...f.defines},e&&(this.defines.IS_ADDITIVE=1),Ua.use(this),Ra.use(this)}}class et extends R{constructor(e){super(e),this.amplitude=0,this.vSlicesMult=1,this.hSlicesMult=1,this.alphaStep=1,this.freq=14}init(){this.props.additive&&!Vt?Vt=new Xi({additive:!0}):jt||(jt=new Xi),this.texture=this.props.texture;const e=Je[this.props.align]??Je.center;this.mat=this.props.additive?Vt:jt,this.base=new wt(e,this.mat),this.base.onBeforeRender=this.onBeforeRender.bind(this),this.time=0,this.props.position&&this.base.position.copy(this.props.position);const t=this.texture.image;this.base.scale.set(t.naturalWidth??t.width,t.naturalHeight??t.height,1);const s=this.props.scale;typeof s=="number"?(this.base.scale.x*=s,this.base.scale.y*=s):s&&(this.base.scale.x*=s.x,this.base.scale.y*=s.y),this.base.renderOrder=this.props.z??this.props.renderOrder??1}beforeUpdate(){const e=this.webgl.$time.dt;this.time=(this.time+e*.001)%9999999}onBeforeRender(){const e=this.mat.uniforms;e.time.value=this.time,e.map.value=this.texture,e.amplitude.value=this.amplitude,e.slicesMult.value.x=this.vSlicesMult,e.slicesMult.value.y=this.hSlicesMult,e.freq.value=this.freq,e.alphaStep.value=this.alphaStep,this.mat.uniformsNeedUpdate=!0}}class Es extends R{init(){this.t=0,this.base=new ke,this.baseHead=new ke,this.base.add(this.baseHead),this.props.position&&this.base.position.copy(this.props.position),typeof this.props.scale=="number"&&this.base.scale.setScalar(this.props.scale),this.baseHead.position.set(6,468,0),this.baseHead.iPos=this.baseHead.position.clone(),this.tail=this.addSprite({batcher:"normal",parent:this.base,position:new x(195,64,0),useEuler:!0,layer:this.props.layer,id:"viperPinkTail"}),this.bottom=this.addSprite({batcher:"normal",parent:this.base,layer:this.props.layer,id:"viperPinkBottom"}),this.top=this.addSprite({batcher:"normal",parent:this.base,useEuler:!0,position:new x(0,90,0),layer:this.props.layer,id:"viperPinkTop"}),this.head=this.addSprite({batcher:"normal",parent:this.baseHead,position:new x(0,0,0),layer:this.props.layer,id:"viperPinkHead"}),this.base.updateMatrixWorld(),this.blinking=!1,this.blinkTimer=0,this.swapTimer=2e3,this.isBlue=!1}update(){const e=this.webgl.$time.stableDt;this.t+=e*.01;const t=this.t,s=1;this.tail.position.y=this.tail.iPos.y+Math.sin(t*.8)*-3.5*s,this.tail.scale.y=1+Math.cos(t*-.8)*-.014*s,this.tail.rotation.z=Math.sin(t*.8)*-.03*s,this.bottom.scale.y=1+Math.sin(t*.8)*.03*s,this.bottom.scale.x=1+Math.sin(t*-.8)*.012*s,this.top.rotation.z=Math.cos(t*.8)*-.02*s,this.top.position.y=this.top.iPos.y+Math.sin(t*.8)*10.5*s,this.top.scale.y=1+Math.sin(t*.8)*.03*s,this.top.scale.x=1+Math.sin(t*-.8)*.01*s,this.baseHead.position.y=this.baseHead.iPos.y+Math.sin(t*.8)*16*s,this.baseHead.position.x=Math.cos(t*.8)*13.02*s,this.baseHead.rotation.z=Math.cos(t*-.8)*-.014*s,this.baseHead.scale.y=1+Math.sin(t*-.8)*.009*s,this.baseHead.scale.x=1+Math.sin(t*.8)*.009*s,this.blinkTimer-=e,this.blinkTimer<0&&(this.blinking=!this.blinking,this.head.sprite.setFrame(+this.blinking),this.blinking?this.blinkTimer=I.randomFloat(60,80):I.tossCoin(.14)?this.blinkTimer=I.randomFloat(90,220):this.blinkTimer=I.randomFloat(1500,3e3)),this.props.swap!==!1&&(this.swapTimer-=e,this.swapTimer<0&&this.swap())}swap(){this.swapTimer=I.randomFloat(3e3,5e3),this.isBlue=!this.isBlue;const e=this.isBlue?"viperBlue":"viperPink";this.tail.sprite.swap(e+"Tail"),this.top.sprite.swap(e+"Top"),this.bottom.sprite.swap(e+"Bottom"),this.head.sprite.swap(e+"Head"),this.props.swap!==!1&&this.webgl.$pp.glitch({amplitude:.93,color:.5})}}class Ga extends R{constructor(e){super(e)}init(){this.base=new ke,this.webgl.$pp.glitch(),this.square=this.add(et,{texture:this.webgl.collection.textures.square,position:new x(0,60,0),scale:1.1,additive:!0}),this.square.amplitude=.3,this.square.vSlicesMult=90,this.square.alphaStep=.8,this.addSprite({batcher:"normal",id:"uiTxtLogin",layer:"uiFront",position:new x(0,-310,0)})}}const X=(i=0,e=0,t=1,s=1,n=!1)=>{const{TILE_SIZE:o}=f.$store;return{batcher:"normal",layer:n?"gameGridBorder":"gameGrid",scale:new E(t,s),position:new x().fromTile(i,e).add(new x(o*t*.5-o*.5,-(o*s*.5-o*.5),0))}};class za extends R{init(){const{TILE_SIZE:e,GRID_ROW:t,GRID_COL:s,GRID_TOP:n,ARTBOARD_SIZE:o}=this.webgl.$store;this.addSprite({id:"areaInnerCorner",...X(t-1,0)}),this.addSprite({id:"areaInnerCorner",flipX:!0,...X(0,0)}),this.addSprite({id:"areaInnerLine",flipX:!0,...X(1,0,t-2,1)}),this.addSprite({id:"areaInnerBg",flipX:!0,...X(0,1,t,s-1)}),this.addSprite({id:"borderLine",...X(1,-1,t-2,1,!0)}),this.addSprite({id:"borderLine",flipY:!0,...X(1,s,t-2,1,!0)}),this.addSprite({id:"borderLineH",flipX:!0,...X(-1,1,1,s-2,!0)}),this.addSprite({id:"borderLineH",...X(t,1,1,s-2,!0)}),this.addSprite({id:"borderCorner",flipX:!0,...X(-1,-1,1,1,!0)}),this.addSprite({id:"borderCorner",...X(t,-1,1,1,!0)}),this.addSprite({id:"borderCorner",flipY:!0,flipX:!0,...X(-1,s,1,1,!0)}),this.addSprite({id:"borderCorner",flipY:!0,...X(t,s,1,1,!0)})}}const Zi=P("inQuint");class Na extends R{init(){this.sprite=this.addSprite({batcher:"normal",layer:"fxFront",id:this.props.value+"countdown",position:new x(0,100,0)}),this.blinkTime=220,this.blinkDuration=220,this.lastBlink=0}update(){const e=this.webgl.$time.stableDt,t=this.blinkTime/this.blinkDuration;if(this.sprite.scale.x=Q(1.4,2,Zi(t)),this.sprite.scale.y=Q(1.4,5,Zi(t)),this.blinkTime>0){this.blinkTime-=e;const s=Date.now(),n=Q(40,14,t);s-this.lastBlink>n&&(this.lastBlink=s,this.sprite.alpha=1-this.sprite.alpha),this.blinkTime<=0&&(this.sprite.alpha=1)}}hide(){this.removeFromParent()}}class ja extends R{init(){this.addSprite({id:"uiCounterBg",batcher:"normal",layer:"uiFront",position:new x().fromFigma(161,48)}),this.addSprite({id:"uiCounterBg",batcher:"normal",layer:"uiFront",position:new x().fromFigma(840,48)}),this.addSprite({id:"uiCounterLvl",batcher:"normal",layer:"uiFront",position:new x().fromFigma(112,48)}),this.addSprite({id:"uiCounterPts",batcher:"normal",layer:"uiFront",color:8567984,position:new x().fromFigma(911,48)}),this.createCounter({x:748,y:48,digits:5,rightAlign:!0,signal:this.webgl.$game.score});const e=an(this.webgl.$game.levelsCount,t=>t+1);this.createCounter({x:191,y:48,digits:3,signal:e})}createCounter({x:e=0,y:t=0,digits:s=5,signal:n,rightAlign:o=!1}={}){let r=0;const a=[];for(let l=0;l<s;l++)a.push(this.addSprite({id:"number",batcher:"normal",layer:"uiFront",position:new x().fromFigma(e+r,t)})),r+=26;return n&&this.watchImmediate(n,l=>{const c=l+"";for(let h=0;h<a.length;h++){const d=a[h],u=h-(s-c.length)*o,p=u>=0?c.charAt(u):"",g=p||0;d.sprite.setFrame(g),d.visible=p!==""}}),{nums:a}}}I.randomFloat;class Va extends R{init(){this.base=new J,this.normalCoinCombo=0}load({pattern:e}){if(!e)return!1;this.cleanStage();const{colliders:t,collectables:s}=e;for(let n=0;n<t.length;n++)this.add(...t[n]);for(let n=0;n<s.length;n++)this.add(...s[n]);this.children.forEach((n,o)=>n instanceof si&&n.scaleIn(o*10))}cleanStage(){this.children.length&&(this.children.forEach(e=>e.triggerDestroy()),this.children.length=0)}addCollider({x:e,y:t}){return this.add(si,{position:new x().fromTile(e,t)})}addNextLevelCoin(){this.add(Re,{useLevelUpType:!0})}addSpecialCoin(){this.add(Re,{useBonusType:!0})}addNormalCoin(){this.add(Re)}addCoin(){if(this.webgl.$game.stopPopingCoins)return;const e=this.webgl.$store.settings,t=this.webgl.$game.maxCollectablesBeforeUp.value,s=this.webgl.$game.collectablesEaten.value,n=this.webgl.$game.uniqueCoinHasPoped,o=this.webgl.$artboard.FREE_TILES.length;if(!(o<1)){if(!n&&o<=5)return this.addNextLevelCoin();if(!n&&s>=t)return this.addNextLevelCoin();if(!(n&&o<=5||n&&!e.addCoinAfterUniqueCoin)){if(this.normalCoinCombo>=e.normalCoinsRequiredForBonus&&this.getSpecialCoinsCount()<=e.maxBonusCoinsOnScreen)return this.normalCoinCombo=0,this.addSpecialCoin();if(this.getNormalCoinsCount()<=e.maxNormalCoinsOnScreen)return this.addNormalCoin()}}}getNormalCoinsCount(){return this.children.filter(e=>e instanceof Re&&!!e.type.isNormal).length}getSpecialCoinsCount(){return this.children.filter(e=>e instanceof Re&&!!e.type.isBonus).length}}const K=Math.PI,Ji={[S.up]:{[S.right]:{flip:!0,angle:0},[S.left]:{flip:!1,angle:0}},[S.down]:{[S.right]:{flip:!1,angle:K},[S.left]:{flip:!0,angle:K}},[S.left]:{[S.up]:{flip:!0,angle:K*.5},[S.down]:{flip:!1,angle:K*.5}},[S.right]:{[S.up]:{flip:!1,angle:-Math.PI*.5},[S.down]:{flip:!0,angle:-K*.5}}},qa={[S.up]:{[S.left]:K*.5,[S.right]:-K*.5},[S.down]:{[S.left]:-K*.5,[S.right]:K*.5},[S.left]:{[S.up]:-K*.5,[S.down]:K*.5},[S.right]:{[S.up]:K*.5,[S.down]:-K*.5}};class Be extends mi{constructor(e){super(e),this.isSnakeBodyPart=!0,this.index=e.index||null,this.isHead=e.id=="tailRevert",this.isCorner=e.id.includes("corner"),this.isTail=e.id=="tail",this.isCollider=!this.isHead&&!this.isTail,this.byPassAlloc=this.isHead,this.id=e.id||null,this.position=e.position||new x,this.rotation=e.rotation||0,this.flip=e.flip||!1,this.prevDir=e.prevDir||null,this.nextDir=e.nextDir||null}init(){const{parent:e,...t}=this.props;let s=this.rotation;this.isCorner&&this.prevDir&&this.nextDir&&(s=Ji[this.prevDir][this.nextDir].angle,this.flip=Ji[this.prevDir][this.nextDir].flip),this.isCorner&&this.isBeforeFirst()&&(this.flip=!this.flip,s-=qa[this.prevDir][this.nextDir]),!this.props.isRollbackPart&&(this.base=new Ie({...t,layer:"snakeBody",timeElapsed:t.standBy?0:t.timeElapsed,batcher:"normal",id:this.id,position:this.position,rotation:new Y(0,0,s),flipX:this.flip}))}play(){this.base&&(this.base.sprite.reset(),this.base.sprite.play())}is(e){return this.base?(e=e.base||e,this.base.is(e)):!1}isLast(){return this.index===this.parent.base.length-1}isBeforeLast(){return this.index===this.parent.base.length-2}isBeforeFirst(){return this.index===1}isFirst(){return this.index===0}getPartAfter(){return this.parent.base[this.index+1]}getPartBefore(){return this.parent.base[this.index-1]}removeFromParent(){this.parent.remove(this)}needUpdate(){return this.index===0||this.index===1||this.index===this.parent.base.length-2||this.index===this.parent.base.length-1||this.props.standBy}update(e){this.needUpdate()&&this.base&&this.base.update(e)}setFrame(e){!this.needUpdate()||!this.base||this.base.sprite.setFrame(this.props.standBy?0:e)}destroy(){this.base&&this.base.destroy()}}const Ha=new E;class Wa extends R{constructor(e){super(e),this.isSnakeBody=!0,this.isReady=!1,this.pendingAdd=0,this.base=[],this.prevBody=[],this.tickDuration=550,this.slowTickEase=P("outSwift"),this.fastTickEase=P("linear"),this.tickEase=this.slowTickEase,this.tickTime=0,this.progress=0,this.cancelCooldown=0}createBaseSnake(e=new E,t=4,s=S.up){t=Math.max(t,4);const n=[],o=this.webgl.$snake.controls.getOppositeDirection(s),r=e.cloneToTile();this.prevBody=[],this.tickTime=0,this.cancelCooldown=0,this.progress=0,this.pendingAdd=0;for(let a=1;a<t;a++)r.add(Jt[o]);for(let a=0;a<t;a++){const l=a===0?"tail":a===t-1?"tailRevert":a===t-2?"lineRevert":"line",c=new Be({id:l,position:new x().fromTile(r.x,r.y),rotation:Zt[s],parent:this});n.push(c),r.add(Jt[s])}return n}register(e){this.isReady=!1;for(let t=0;t<this.base.length;t++)this.remove(this.base[t]);this.base.length=0,this.base=e;for(let t=0;t<this.base.length;t++)this.base[t].index=t,this.base[t].triggerInit();return this}play(e=!1){for(let t=0;t<this.base.length;t++)e&&(this.base[t].index=t,this.base[t].triggerInit());this.isReady=!0}addPart(){this.pendingAdd++}refreshSprite(e){this.getHead().base.sprite.remainingTime;const{$snake:s}=this.webgl,n=[],o=0;if(e){for(let r=0;r<this.base.length;r++){const a=this.base[r];this.remove(a)}this.base=this.prevBody.map(r=>new Be({id:r.id,position:r.position,rotation:r.rotation,prevDir:r.prevDir||null,nextDir:r.nextDir||null,isHead:r.isHead,isRollbackPart:!0,parent:this})),this.play(!0),this.cancelCooldown=1}else this.cancelCooldown>0&&this.cancelCooldown--;this.base.forEach(r=>{const a=r.getPartAfter();if(a){const l=a.id;let c=a.rotation,h=r.isFirst()||r.isBeforeLast()||a.isBeforeLast()?r.id:l;a.isBeforeLast()&&l==="lineRevert"&&(h="line"),r.id==="cornerRevert"&&(h="lineRevert"),l.includes("corner")&&(h="corner"),r.isFirst()&&h==="corner"&&(c=Zt[a.nextDir],h="tail");const d=new Be({id:h,position:a.position,rotation:c,prevDir:a.prevDir||null,nextDir:a.nextDir||null,timeElapsed:o,parent:this});if(n.push(d),this.pendingAdd&&r.isFirst()){const u=new Be({id:r.id,position:a.position,rotation:c,standBy:r.isFirst()&&!!this.pendingAdd,timeElapsed:o,parent:this});n.push(u)}}else{const{hasTurned:l,prevDir:c,nextDir:h,nextPos:d,nextRot:u}=s.poll();let p=Ha.copy(r.position).toTile();if(p.add(d),s.headPosition.copy(p),l){this.cancelCooldown=1;const _=r.getPartBefore(),M=new Be({id:"cornerRevert",position:r.position,rotation:_.rotation,prevDir:c,nextDir:h,timeElapsed:o,parent:this});n.splice(-1,1,M)}const g=new Be({id:r.id,position:new x().fromTile(...p),rotation:u,timeElapsed:o,isHead:!0,parent:this});n.push(g)}}),this.pendingAdd=Math.max(0,this.pendingAdd-1),this.prevBody.length=this.base.length;for(let r=0;r<this.base.length;r++){const a=this.base[r];this.prevBody[r]||(this.prevBody[r]={});const l=this.prevBody[r];l.id=a.id,l.index=a.index,l.prevDir=a.prevDir,l.nextDir=a.nextDir,l.position=a.position.clone(),l.rotation=a.rotation,l.isHead=a.isHead,a.remove(a)}this.register(n),this.play(),this.tickTime=e?this.tickTime*.6:0,this.progress=oe(this.tickEase(this.tickTime/this.tickDuration),0,1)}getTail(){return this.base[0]}getBeforeTail(){return this.base[1]}getBeforeHead(){return this.base[this.base.length-2]}getHead(){return this.base[this.base.length-1]}update(){const{$game:e}=this.webgl;if(!e.isRunning||!this.base.length||!this.isReady)return;const t=e.speed.value,s=this.webgl.$time.stableDt*t,n=this.getHead();if(!n||!n.base)return;const o=n.base.sprite,r=o.currentFrameIndex,a=o.frames.length;this.tickTime+=s;const l=oe(this.slowTickEase(this.tickTime/this.tickDuration),0,1),c=oe(this.fastTickEase(this.tickTime/this.tickDuration),0,1),h=Se(t,2.6,5),d=Q(l,c,h);this.progress=d;const u=Math.floor(d*a);if(u===r)return;for(let _=0;_<this.base.length;_++)this.base[_].setFrame(u);const p=o.currentFrameIndex;if(this.webgl.$game.isNextLevelPending){o.ended&&this.webgl.$setState("NextLevel");return}const g=this.prevBody.length>0;if(this.webgl.$snake.controls.isPressed){if(this.webgl.$snake.controls.isPressed=!1,g&&p<18&&this.cancelCooldown<=0){this.refreshSprite(!0);return}if(p>44&&this.webgl.$snake.controls.bufferSize===1){this.refreshSprite();return}}if(this.webgl.$snake.controls.bufferSize>0&&p>50){this.refreshSprite();return}p&&r&&p>=15&&this.parent.checkCollision(n.position),o.ended&&this.refreshSprite()}destroy(){this.base.forEach(e=>e.remove(e)),this.base.length=0,this.prevBody.length=0}}function Ya(){E.prototype.isThreeCoords=!0,E.prototype.isTileCoords=!1,x.prototype.isThreeCoords=!0,x.prototype.isTileCoords=!1;const i=E.prototype.copy;E.prototype.copy=function(t){return i.call(this,t),this.isThreeCoords=t.isThreeCoords,this.isTileCoords=t.isTileCoords,this};const e=x.prototype.copy;x.prototype.copy=function(t){return e.call(this,t),this.isThreeCoords=t.isThreeCoords,this.isTileCoords=t.isTileCoords,this},E.prototype.figmaToThree=function(){const{ARTBOARD_SIZE:t}=f.$store;return this.x=this.x-t*.5,this.y=t*.5-this.y,this.isThreeCoords=!0,this.isTileCoords=!1,this},E.prototype.fromFigma=function(t=0,s=0){return t instanceof E&&(s=t.y,t=t.x),this.setX(t).setY(s).figmaToThree()},E.prototype.tileToThree=function(){const{ARTBOARD_SIZE:t,GRID_WIDTH:s,TILE_SIZE:n,GRID_TOP:o}=f.$store,r=s*-.5,a=t*.5-o;return this.x=r+n*(this.x+.5),this.y=a-n*(this.y+.5),this.isThreeCoords=!0,this.isTileCoords=!1,this},E.prototype.fromTile=function(t=0,s=0){return t instanceof E&&(s=t.y,t=t.x),this.setX(t).setY(s).tileToThree()},E.prototype.threeToTile=function(){const{ARTBOARD_SIZE:t,GRID_WIDTH:s,TILE_SIZE:n,GRID_TOP:o}=f.$store,r=s*-.5,a=t*.5-o;return this.x=Math.round((this.x-r)/n-.5),this.y=Math.round((a-this.y)/n-.5),this.isThreeCoords=!1,this.isTileCoords=!0,this},E.prototype.cloneToTile=function(){return new E().copy(this).threeToTile()},E.prototype.toTile=function(){return this.threeToTile()},x.prototype.figmaToThree=E.prototype.figmaToThree,x.prototype.fromFigma=E.prototype.fromFigma,x.prototype.tileToThree=E.prototype.tileToThree,x.prototype.fromTile=E.prototype.fromTile,x.prototype.threeToTile=E.prototype.threeToTile,x.prototype.toTile=E.prototype.toTile,x.prototype.cloneToTile=E.prototype.cloneToTile}function Ka(i,e){return e||(e=new E),e.copy(i).threeToTile(),e}const Qa=new E,Xa=new E,Za=new x,Ja=new x,el={1:new E(0,1),4:new E(0,-1),3:new E(1,0),0:new E(-1,0)};class tl extends R{init(){this.base=new Ie({batcher:"normal",layer:"snakeHead",id:"head",useEuler:!0}),this.rot=0,this.targetRot=0,this.blinking=!1,this.blinkTimer=0,this.prevDirection=-1}update(){const e=this.webgl.$game.isRunning.value,t=this.webgl.$time.stableDt,s=this.parent.body.getHead();if(s)this.base.visible=!0;else return this.base.visible=!1;const n=this.parent.body.progress,o=~~s.rotation,r=Ka(s.position,Qa),a=Xa.copy(r).add(el[o]),l=Za.fromTile(r),c=Ja.fromTile(a);if(o!==this.prevDirection){const h=this.prevDirection;this.prevDirection=o,o===3?this.targetRot=0:o===0?this.targetRot=Math.PI*.25:o===1?h===3?this.targetRot=Math.PI*-.25:this.targetRot=Math.PI*.5:o===4&&(h===3?this.targetRot=Math.PI*.35:this.targetRot=Math.PI*-.15)}if(e&&(this.rot=bn(this.rot,this.targetRot,.09,t)),this.base.position.lerpVectors(c,l,n),this.base.rotation.z=Q(0,.12,n)+this.rot,!e)return this.base.sprite.setFrame(0);this.blinkTimer-=t,this.blinkTimer<0&&(this.blinking=!this.blinking,this.base.sprite.setFrame(+this.blinking),this.blinking?this.blinkTimer=I.randomFloat(90,160):I.tossCoin(.15)?this.blinkTimer=I.randomFloat(100,400):this.blinkTimer=I.randomFloat(1e3,2500))}destroy(){this.base.destroy()}}class il extends R{init(){this.body=this.add(Wa),this.head=this.add(tl),this.webgl.$snake.body=this.body}checkCollision(e){const{$setState:t,$artboard:s,$game:n}=this.webgl,o=s.getTileFromPos(e);return o?o.isCollider?(o.onCollision(),t("GameOver"),!0):(o.isCollectable&&o.onCollision(),!1):(t("GameOver"),!0)}destroy(){this.body.triggerDestroy(),this.head.triggerDestroy(),this.webgl.$snake.body=null}}function sl(){try{return window.self!==window.top}catch{return!0}}class nl extends R{init(){this.webgl.$game.countdown.value=4,this.webgl.$pp.glitch(),this.webgl.baseGame=this,this.base=new ke,this.parent.snake=this.snake=this.add(il),this.parent.area=this.area=this.add(za),this.parent.gameGrid=this.gameGrid=this.add(Va),this.add(ja);const e=this.webgl.$store.hasTouch,t=!sl();this.btnUp=this.add(ne,{size:"medium",ref:"gameBtnUp",label:e||t?"Up":"W",position:new x(0,-298),byPassSound:!0}),this.btnDown=this.add(ne,{size:"medium",ref:"gameBtnDown",label:e||t?"Down":"S",position:new x(0,-429),byPassSound:!0}),this.btnLeft=this.add(ne,{size:"medium",ref:"gameBtnLeft",label:e||t?"Left":"A",position:new x(-200,-364),byPassSound:!0}),this.btnRight=this.add(ne,{size:"medium",ref:"gameBtnRight",label:e||t?"Right":"D",position:new x(200,-364),byPassSound:!0}),this.overlay=this.addSprite({batcher:"normal",layer:"uiFront",id:"blankTile",scale:new E(81,81),color:new A(1442072),alpha:0}),this.watchImmediate(this.webgl.$snake.controls.lastPressedDirection,s=>{const n=s===S.up||s===S.down,o=s===S.left||s===S.right;this.btnUp.disabled=!!n,this.btnDown.disabled=!!n,this.btnLeft.disabled=!!o,this.btnRight.disabled=!!o}),this.watchImmediate(this.webgl.$snake.controls.kbPress,s=>{s===S.up?this.btnUp.press():s===S.down?this.btnDown.press():s===S.left?this.btnLeft.press():s===S.right&&this.btnRight.press()}),this.watchImmediate(this.webgl.$game.countdown,s=>{this.countdown&&this.countdown.hide(),this.countdown=null,!(s<1||s>3)&&(this.countdown=this.add(Na,{value:s}))})}removeViperOverlay(){this.overlayMsg&&(this.overlayMsg.destroy(),this.overlayMsg=null),this.viper&&(this.viper.removeFromParent(),this.viper=null)}playerViperOverlay(){this.overlayMsg&&this.overlayMsg.destroy(),this.viper||(this.viper=this.add(Es,{layer:"uiFront",scale:1.4,swap:!1,position:new x(0,-1500,0)})),this.overlayMsg=new Ie({batcher:"normal",layer:"uiFront",id:"uiBigGameOver",position:new x(0,160,0),scale:1.4}),this.overlayMsg.startTime=null,this.overlayTween=Oi({target:this.overlay,property:"alpha",from:0,to:.8,duration:200,easing:"linear"}),this.viperTween=Oi({target:this.viper.base.position,property:"y",from:-1500,to:-700,duration:900,easing:"outExpo"})}update(){const e=this.webgl.$time.et;this.overlay.visible=this.overlay.alpha>0;const t=this.webgl.$time.stableDt;if(this.viperTween&&this.viperTween.update(t),this.overlayTween&&this.overlayTween.update(t),this.overlayMsg){const s=this.viperTween&&this.viperTween.progress>.3;s&&!this.overlayMsg.startTime&&(this.overlayMsg.startTime=e);const n=e-this.overlayMsg.startTime;this.overlayMsg.visible=s&&!(~~(n/230)&1)}}destroy(){this.removeViperOverlay(),this.webgl.baseGame===this&&(this.webgl.baseGame=null)}}class ks extends et{constructor(e){e.texture=f.collection.textures.logo,e.z=e.z??1,e.additive=!0,super(e),this.visibility=0,this.bigGlitchTimer=0,this.vSlicesMult=5,this.hSlicesMult=4}update(){const e=this.webgl.$time.stableDt;this.freq=13,this.visibility>.85&&(this.bigGlitchTimer-=e)<0&&(this.amplitude=I.randomFloat(.7,1.2),this.visibility<.99&&(this.amplitude=3),this.bigGlitchTimer=I.randomFloat(600,1e3),this.vSlicesMult=I.randomFloat(20,50),this.hSlicesMult=I.randomFloat(1,12)),this.amplitude=Ee(this.amplitude,.3,.2,e),this.visibility=Ee(this.visibility,1,.05,e),this.alphaStep=ie(-1,.8,this.visibility)}}const es=P("outQuart"),ol=P("inOutQuint");class rl extends R{init(){this.overlay=this.addSprite({batcher:"top",layer:"uiFront",id:"blankTile",scale:new E(81,81),color:new A(1442072),alpha:0}),this.popin=this.addSprite({batcher:"top",layer:"uiFront",id:"blankTile",scale:new E(.1,.1),color:new A(14107121)}),this.txt=this.addSprite({batcher:"top",layer:"uiFront",id:"uiShareConfirm",alpha:0}),this.time=0,this.popinBlinkTime=200,this.popinLastBlink=0,this.txtBlinkTime=380,this.txtLastBlink=0,this.outBlinkTime=300,this.outLastBlink=0}update(){const e=this.webgl.$pp,t=this.webgl.$time.stableDt,s=this.time,n=this.time+=t;this.overlay.alpha=ie(0,.8,Se(n/200));const o=n/500;if(this.popin.scale.x=ie(.1,16,es(Se(o))),this.popin.scale.y=ie(.1,6,ol(Se((n-20)/600))),o>0&&this.popinBlinkTime>0){this.popinBlinkTime-=t;const u=Date.now(),p=ie(40,15,o);u-this.popinLastBlink>p&&(this.popinLastBlink=u,this.popin.alpha=1-this.popin.alpha),this.popinBlinkTime<=0&&(this.popin.alpha=1)}const r=Se((n-340)/150);if(this.txt.scale.y=ie(3,1,es(r)),r>0&&this.txtBlinkTime>0){this.txtBlinkTime-=t;const u=Date.now(),p=ie(60,20,r);u-this.txtLastBlink>p&&(this.txtLastBlink=u,this.txt.alpha=1-this.txt.alpha),this.txtBlinkTime<=0&&(this.txt.alpha=1)}const a=200;n>a&&s<=a&&(this.webgl.$playSound("UI_Click"),e.miniGlitch({colorGlitch:.25,amplitude:.044}));const l=2150,c=Se((n-l)/500);if(c>0&&this.outBlinkTime>0){this.outBlinkTime-=t;const u=Date.now(),p=ie(18,35,c);u-this.outLastBlink>p&&(this.outLastBlink=u,this.popin.alpha=1-this.popin.alpha,this.txt.alpha=this.popin.alpha),this.outBlinkTime<=0&&(this.txt.alpha=this.popin.alpha=0)}const h=Se((n-l-300)/100);this.overlay.alpha=this.overlay.alpha*(1-h);const d=l+100;n>d&&s<=d&&e.miniGlitch({colorGlitch:.28,amplitude:.093}),h>=1&&c>=1&&this.hide()}hide(){this.webgl.$store.copyNotifVisible.set(!1)}}const tt=document.createElement("canvas"),al=tt.getContext("2d");tt.width=730;tt.height=110;let ct;const it=document.createElement("canvas"),ll=it.getContext("2d");it.width=750;it.height=220;let ht;class cl extends R{constructor(e){super(e)}updateScoreTex(){ct||(ct=yt({img:tt,linear:!0})),ct.needsUpdate=!0;const e=tt,t=al;t.clearRect(0,0,e.width,e.height),t.fillStyle="#fff",t.textBaseline="baseline";const s=102,n=1.3,o=n*100+"px VCYg",r=n*72+"px VCYg";t.font=o;const a=this.webgl.$game.score.value,l=t.measureText(a);t.font=r;const c=" PTS",h=t.measureText(c);let d=l.width+h.width,u=e.width/2-d/2;t.font=o,t.fillText(a,u,s),u+=l.width,t.font=r,t.fillText(c,u,s)}updateTextTex(){const e=this.webgl.$app.$api.isConnected.value;ht||(ht=yt({img:it,linear:!0})),ht.needsUpdate=!0;const t=it,s=ll,n=40;s.clearRect(0,0,t.width,t.height),s.fillStyle="#fff",s.textBaseline="top",s.textAlign="center",s.font=n+"px VCFtr";const o=this.webgl.$store.gameOverText.value,{lines:r}=new Qs(o.toUpperCase(),{measure:d=>s.measureText(d).width}).wrap(t.width-20);let a=t.width/2,l=10;for(let d=0;d<r.length;d++){const u=r[d];s.fillText(u.value,a,l),l+=n*1.2}if(e&&o.length<1)return;o.length>1&&(l+=n*.4);let c="SHARE MY SCORE";s.fillText(c,a,l),l+=n*1.1;const{width:h}=s.measureText(c);s.fillRect(a-h/2,l,h,4)}init(){const e=this.webgl.$app.$api.isConnected.value;this.webgl.$pp.glitch(),this.base=new ke,this.updateScoreTex(),this.spinning=!1,this.spinner=this.addSprite({batcher:"normal",id:"spinner",useEuler:!0,position:new x(0,65,0)}),this.watchImmediate(this.webgl.$store.gameOverText,o=>{this.spinning=o.length<3,this.spinner.visible=e&&this.spinning,this.updateTextTex()}),this.logo=this.add(ks,{z:2,position:new x().fromFigma(860,69),scale:.27});let t=70;t+=-40,this.add(et,{texture:ct,position:new x(0,220+t,0),z:2}),this.text=this.add(et,{texture:ht,position:new x(0,15+t,0),z:2,additive:!0}),this.watchImmediate(this.webgl.$store.gameOverText,o=>{this.text.amplitude=100,this.text.alphaStep=.01,this.text.vSlicesMult=6,this.text.hSlicesMult=15,this.text.freq=16}),this.addSprite({batcher:"normal",id:"uiTxtGameOver",layer:"uiFront",color:3014397,position:new x().fromFigma(55,65)});let s=-136,n=-85-s;e&&(n+=s),this.add(ne,{size:"large",label:"Replay",ref:"endBtnReplay",position:new x(0,n+=s,0),onClick:()=>{this.webgl.$app.$view.push("Game")}}),this.add(ne,{size:"large",label:"LeaderboardTxt",ref:"endBtnLeaderboard",position:new x(0,n+=s,0),onClick:()=>{this.webgl.$app.$view.push("Leaderboard")}}),e||this.add(ne,{size:"large",label:"RegisterTxt",ref:"endBtnRegister",position:new x(0,n+=s,0),color:16736255,onClick:()=>{this.webgl.$app.$view.push("Auth")}}),this.watch(this.webgl.$store.copyNotifVisible,o=>{o&&!this.copyNotif?this.copyNotif=this.add(rl):!o&&this.copyNotif&&(this.copyNotif.removeFromParent(),this.copyNotif=null)})}update(){const e=this.webgl.$time.stableDt;this.spinner.rotation.z+=e*.01,this.text.vSlicesMult=15,this.text.hSlicesMult=15,this.text.amplitude=Math.max(0,this.text.amplitude-.15*e),this.text.alphaStep=Math.min(1,this.text.alphaStep+.0022*e)}}class hl extends R{constructor(e){super(e),this.base=new ke,this.isViper=!0}init(){this.webgl.$pp.glitch(),this.logo=this.add(ks,{z:1,position:new x(-15,270,0),scale:.95}),this.viper=this.add(Es,{scale:.84,position:new x(0,-240,0)}),this.startBtn=this.add(ne,{size:"large",ref:"homeBtnStart",position:new x().fromFigma(420,843),onClick:()=>{this.webgl.$app.$view.push("Game")}}),this.leaderboardBtn=this.add(ne,{size:"small",label:"Leaderboard",ref:"homeBtnLeaderboard",position:new x().fromFigma(790,843),onClick:()=>{this.webgl.$app.$view.push("Leaderboard")}})}}const be=document.createElement("canvas"),U=be.getContext("2d");be.width=850;be.height=790;let qt;function ul({ctx:i,x:e,y:t,width:s,height:n,radius:o=5,fill:r=!1,stroke:a=!0}){i.beginPath(),i.moveTo(e+o,t),i.lineTo(e+s-o,t),i.quadraticCurveTo(e+s,t,e+s,t+o),i.lineTo(e+s,t+n-o),i.quadraticCurveTo(e+s,t+n,e+s-o,t+n),i.lineTo(e+o,t+n),i.quadraticCurveTo(e,t+n,e,t+n-o),i.lineTo(e,t+o),i.quadraticCurveTo(e,t,e+o,t),i.closePath(),r&&i.fill(),a&&i.stroke()}class dl extends R{updateLeaderboard(e){if(e.length===0)return;qt.needsUpdate=!0,U.clearRect(0,0,be.width,be.height);const t=37,s=2.1;U.font=t+"px VCYg",U.textBaseline="top";let n=20;for(let o=0;o<e.length;o++){const r=e[o],a=(o+1).toString().padStart(2,"0").toUpperCase();let l=r.name.slice(0,20).toUpperCase();r.name.length>20&&(l+="…");const c=r.score.toString().toUpperCase(),h=20;U.fillStyle="#7DB4A9",U.textAlign="left";let d=h;if(U.fillText(a,d,n),d+=1.7*t,U.fillStyle="#ffffff",U.fillText(l,d,n),U.fillStyle="#7DB4A9",U.textAlign="right",d=be.width-h,U.fillText("PTS",d,n),d-=2.3*t,U.fillStyle="#ffffff",U.fillText(c,d,n),o<3){o===0?U.strokeStyle="#FD12F9":o===1?U.strokeStyle="#B00FAD":o===2&&(U.strokeStyle="#6D096C"),U.lineWidth=3;const u=be.width-10;ul({ctx:U,x:5,y:n-.45*t,width:u,height:t*1.8,radius:20,stroke:!0})}n+=t*s}}init(){this.webgl.$pp.glitch(),this.amplitude=0,this.visibleLerp=0,this.visibleLerpTarget=0,this.glitchTimer=0,this.base=new ke,qt=yt({img:be,linear:!0}),this.addSprite({batcher:"normal",id:"uiTxtRanking",layer:"uiFront",color:3014397,position:new x().fromFigma(55,65)}),this.spinner=this.addSprite({batcher:"normal",id:"spinner",useEuler:!0}),this.img=this.add(et,{texture:qt,align:"topCenter",additive:!0,position:new x(0,348,0),z:2}),this.watchImmediate(this.webgl.$store.leaderboard,e=>{this.img.base.visible=!!e.length,this.updateLeaderboard(e),this.visibleLerpTarget=e.length?1:0,e.length&&this.spinner&&(this.spinner.destroy(),this.spinner=null)}),this.add(ne,{size:"small",label:"Close",ref:"leaderboardBtnClose",position:new x().fromFigma(888,72),weight:8,onClick:()=>this.webgl.$app.$view.back()})}update(){const e=this.webgl.$time.stableDt;this.spinner&&(this.spinner.rotation.z-=e*.015),this.visibleLerp=Ee(this.visibleLerp,this.visibleLerpTarget,.08,e),this.img.vSlicesMult=70,this.img.hSlicesMult=10,this.img.freq=11;let t=.004;I.tossCoin(.4)&&(this.glitchTimer-=e)<=0&&(t=I.randomFloat(.3,.8),this.glitchTimer=I.tossCoin(.2)?I.randomFloat(200,400):I.randomFloat(700,2e3)),this.amplitude=Ee(this.amplitude,t,.2,e),this.img.amplitude=ie(2.3,this.amplitude,this.visibleLerp),this.img.alphaStep=ie(-1,.99,this.visibleLerp)}}const fl=hs();function pl(i){const e=i.base||i,t=e.position.clone(),s=e.rotation.clone(),n={shaking:!1,maxDuration:0,maxAmplitude:0,currentDuration:0,currentAmplitude:0,freqMult:1,value:[0,0],pos:[0,0],speed:[.006,1e-4]},o={state:n,trigger:r,update:a};return Object.assign(i,{shake:o}),o;async function r(l=500,c=.1,h=!1,d=!1,u=1,p=0){await H(p),c*=1.07,n.vertical=h,(d||!n.shaking||l>n.maxDuration)&&(n.maxDuration=l,n.currentDuration=l),(d||!n.shaking||c>n.maxAmplitude)&&(n.maxAmplitude=c,n.currentAmplitude=c,n.freqMult=u),(l||c)&&(n.shaking=!0),n.pos[0]=Math.PI*200,n.pos[1]=I.randomFloat(0,500)}function a(){if(e.position.copy(t),e.rotation.copy(s),!n.shaking)return;const l=f.$time.dt,c=1-n.currentDuration/n.maxDuration;let h=Q(n.speed[0],n.speed[1],c);h*=n.freqMult,n.currentAmplitude=Q(n.maxAmplitude,0,c),n.pos[0]+=l*h,n.pos[1]+=l*h,n.value[0]=Math.cos(n.pos[0]*9)*n.currentAmplitude*.6,n.value[1]=fl(10,n.pos[1])*n.currentAmplitude;const d=n.value[0]*.9,u=n.value[1]*.3,p=n.vertical?u:d,g=n.vertical?d:u;i.offset(p,g),n.currentDuration=Math.max(0,n.currentDuration-l),n.currentDuration===0&&(n.maxAmplitude=0,n.maxDuration=0,n.shaking=!1)}}class ml extends _s{constructor(e={}){super(e),this.padding=0,this.width=1,this.height=1,this.base=new Xs(-1,1,1,-1,.1,100),this.base.position.set(0,0,1),pl(this),this.webgl.$camShake=()=>this.shake.trigger(500,.45,!0,!0,1.1,0)}resize(){const{width:e,height:t}=this.webgl.$vp,s=this.base,n=this.webgl.$store.ARTBOARD_SIZE;let o=n+this.padding,r=n+this.padding;e>t?o*=e/t:r*=t/e,s.left=-o*.5,s.right=o*.5,s.top=r*.5,s.bottom=-r*.5,s.updateProjectionMatrix()}offset(e,t){const s=this.base,n=this.webgl.$store.ARTBOARD_SIZE+this.padding;s.setViewOffset(n,n,e*100,t*100,n,n),s.updateProjectionMatrix()}setPadding(e){this.padding=e,this.resize()}update(){this.shake&&this.shake.update()}}const gl=`precision highp float;
uniform sampler2D perlin;
uniform float time;
uniform vec2 resolution;
uniform vec4 uvContain;
uniform vec2 containMult;
void main() {
vec2 uv = gl_FragCoord.xy / resolution.xy;
vec2 uvc = gl_FragCoord.xy * uvContain.xy + uvContain.zw;
float nA = texture2D(perlin, uvc * 0.1 + time * 0.01).r;
float nB = texture2D(perlin, uvc * 0.2 + time * -0.03).g;
vec3 color = BG_COLOR;
uvc.x += time * -0.01;
uvc.y += time * -0.01;
float gx = fract(uvc.x * 30.);
gx = smoothstep(0.25, 0.29, gx) * smoothstep(0.36, 0.32, gx);
float gy = fract(uvc.y * 30.);
gy = smoothstep(0.25, 0.29, gy) * smoothstep(0.36, 0.32, gy);
float grid = max(gx, gy);
float e = 0.08;
grid *= min(min(min(
smoothstep(0.0, e, uv.x),
smoothstep(0.0, e, uv.y)),
smoothstep(1.0, 1.0 - e, uv.x)),
smoothstep(1.0, 1.0 - e, uv.y)
);
e = 0.2;
color *= 1. - (1. - min(min(min(
smoothstep(0.0, e, uv.x),
smoothstep(0.0, e, uv.y)),
smoothstep(1.0, 1.0 - e, uv.x)),
smoothstep(1.0, 1.0 - e, uv.y)
)) * 0.25;
grid *= 0.1 + smoothstep(0., 1., nA * nB) * 2.5;
color = mix(color, vec3(0.31,0.098,0.31), grid);
gl_FragColor = vec4(color, 1.);
}`,bl=Ne(gl,"fragmentShader"),vl=`precision highp float;
void main() {
vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
gl_Position = projectionMatrix * mvPosition;
}`,yl=Ne(vl,"vertexShader");let Ht=null;class wl extends xt{constructor(){super(),this.transparent=!0,this.depthTest=!1,this.depthWrite=!1,this.uniforms={perlin:{type:"t",value:f.collection.textures.perlin},...f.uniforms},this.defines={...f.defines},bl.use(this),yl.use(this)}}class xl extends R{init(){const{ARTBOARD_SIZE:e}=this.webgl.$store;Ht||(Ht=new Ke(e*10,e*10)),this.base=new wt(Ht,new wl),this.base.renderOrder=0}destroy(){}}const ae=I.randomFloat,Wt=new A(4061171),ut=new A(16585209);class Sl extends R{init(){this.lines=[],this.lines.push(this.addLine({position:new x().fromFigma(20,50),scale:new E(1,8.9),color:Wt,alpha:.7})),this.lines.push(this.leftBar=this.addLine({position:new x().fromFigma(34,120),scale:new E(1,6.9),color:Wt,alpha:.7})),this.lines.push(this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(20,50),scale:new E(1,9.61),color:Wt,alpha:.7})),this.lines.push(this.addLine({position:new x().fromFigma(980,50),scale:new E(1,8.9),color:ut,alpha:.7})),this.lines.push(this.rightBar=this.addLine({position:new x().fromFigma(986,130),scale:new E(1,8),color:ut,alpha:.7})),this.lines.push(this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(80,950),scale:new E(1,8.8),color:ut,alpha:.7})),this.lines.push(this.bottomBar=this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(80,950),scale:new E(1,6.8),color:ut,alpha:.7})),this.maskGameOver=this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(40,50),scale:new E(1.2,4.55)}),this.maskLeaderboard=this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(40,50),scale:new E(1.2,3.41)}),this.maskLogo=this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(760,50),scale:new E(1.2,2.01)}),this.maskClose=this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(800,50),scale:new E(1.2,1.67)}),this.maskButton=this.addLine({rotation:new Y(0,0,Math.PI/2),position:new x().fromFigma(350,950),scale:new E(1.2,3)}),this.masks=[];const e=8;for(let t=0;t<e;t++){const s=this.addLine({rotation:t>=e*.5?void 0:new Y(0,0,Math.PI/2),position:t>=e*.5?new x().fromFigma(t>=e*.75?20:980,48):new x().fromFigma(15,t>=e*.25?50:950),scale:new E(1.4,ae(.3,2.7))});this.masks.push(s)}this.lastTime=0}addLine(e){return this.addSprite({batcher:"normal",layer:"uiBack",id:"uiLine",color:new A(2230833),...e})}update(){const e=this.webgl.$app.$view.current.value,t=this.webgl.$time.et,s=17;this.time=Math.floor(t*.001*s)/s%1e3,this.maskLogo.visible=this.maskGameOver.visible=e==="GameOver",this.maskClose.visible=this.maskLeaderboard.visible=e==="Leaderboard",this.maskButton.visible=e==="Game",this.time-this.lastTime>1e-4&&e!=="Game"&&this.tick()}updateBar(e){this.webgl.$app.$view.current.value,e.useEuler?e.position.setScalar(0).setY(ae(-10,3)).setX(ae(-40,40)).add(e.iPos):e.position.setScalar(0).setX(ae(-10,3)).setY(ae(-40,40)).add(e.iPos),e.visible=I.tossCoin(.3),e.scale.y=e.iScale.y*ae(.2,1)}tick(){this.lastTime=this.time,this.updateBar(this.rightBar),this.updateBar(this.leftBar),this.updateBar(this.bottomBar);for(let e=0;e<this.lines.length;e++){const t=this.lines[e];t.alpha=ae(.5,.8)}for(let e=0;e<this.masks.length;e++){const t=this.masks[e];t.visible=I.tossCoin(.2),t.useEuler?t.position.x=ae(-470,470):t.position.y=ae(-470,470)}}}class Tl extends Ba{init(){this.camera=this.add(ml),this.bg=this.add(xl),this.group=null,this.webgl.$particles.addTo(this.base),this.isGameBaseReady=null,this.watchImmediate(this.webgl.$app.$view.current,()=>this.viewNeedsUpdate=!0),this.watch(this.webgl.renderer.drawingBufferSize,()=>this.updateBorders())}updateBorders(){const e=this.webgl.$app.$view.current.value,t=this.webgl.renderer.drawingBufferSize.value,s=t.x/t.y,n=e!=="Game"&&s<1.3&&s>.8;!n&&this.borders?(this.borders.removeFromParent(),this.borders=null):n&&!this.borders&&(this.borders=this.add(Sl))}updateView(){const e=this.webgl.$app.$view.current.value;switch(this.isGameBaseReady==null&&(this.isGameBaseReady=ss()),this.group&&(this.group.hide?this.group.hide():this.group.removeFromParent(),this.group=null),this.updateBorders(),this.webgl.$pp.continuousGlitch=!1,e){case"Home":this.group=this.add(hl);break;case"Auth":this.group=this.add(Ga);break;case"Game":this.group=this.add(nl),this.webgl.$setState("GameStart"),this.isGameBaseReady.resolve(),this.isGameBaseReady=null;break;case"GameOver":this.group=this.add(cl);break;case"Leaderboard":this.group=this.add(dl);break}this.viewNeedsUpdate=!1}update(){this.viewNeedsUpdate&&this.updateView()}}const Cl={antialias:!1,alpha:!1,depth:!0,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"},ts={"720p":1280*720,"1080p":1920*1080,"1440p":2560*1440,"2k":2560*1440,"3k":2880*1620,"4k":3840*2160,"5k":5120*2880,"8k":7680*4320},Pe=new E;let G;class _l{constructor(e={}){e={...Cl,...e};const t=this.webgl=pi(),s=this.canvas=t.canvas,n=e.forceWebGL1?Zs:Js;G=t.threeRenderer=this.base=new n({canvas:s,...e}),this.isWebGL2=!!G.capabilities.isWebGL2,G.info.autoReset=!1,t.hooks.beforeFrame.watch(()=>G.info.reset()),G.setClearColor(0,1),G.autoClear=!1,G.shadowMap.enabled=!1,G.shadowMap.type=en,G.setSize(s.width,s.height),G.setPixelRatio(window.devicePixelRatio),this.minPixelRatio=1,this.maxPixelRatio=2,this.maxPixelCount=ts["3k"],G.drawingBufferSize=this.drawingBufferSize=D(new E),this.pixelRatio=window.devicePixelRatio,G.getDrawingBufferSize(this.drawingBufferSize.value),this.webgl.$vp.signal.watchImmediate(this.resize.bind(this))}resize(){const{width:e,height:t,dpr:s}=this.webgl.$vp;let n=oe(s,this.minPixelRatio,this.maxPixelRatio),o=n*e*t;this.maxPixelCount>0&&o>this.maxPixelCount&&(n/=o/this.maxPixelCount),G.getSize(Pe),G.getPixelRatio()!==n&&G.setPixelRatio(n),(Pe.x!==e||Pe.x!==t)&&G.setSize(e,t),this.updateBufferSize()}updateBufferSize(){const e=this.drawingBufferSize.value;G.getDrawingBufferSize(Pe),ln(),Pe.equals(e)||this.drawingBufferSize.set(e.copy(Pe),!0),this.pixelRatio=G.getPixelRatio(),cn()}setMinPixelRatio(e){this.minPixelRatio!==e&&(this.minPixelRatio=e)}setMaxPixelRatio(e){this.maxPixelRatio!==e&&(this.maxPixelRatio=e)}setMaxPixelCount(e){if(typeof e=="string"){if(e=ts[e.toLowerCase()],!e)return}else e==null&&(e=0);this.maxPixelCount=e}}let Ye=new A;const El=i=>(Number.isInteger(i)?i+".":i)+"",$s=(...i)=>i.map(El).join(","),kl=(i,e,t)=>"vec3("+$s(i,e,t)+")",$l=(i,e,t,s)=>"vec4("+$s(i,e,t,s)+")",Ml=(i,e)=>{i.r?Ye.copy(i):Ye.set(i);const t=Ye.r.toFixed(3),s=Ye.g.toFixed(3),n=Ye.b.toFixed(3);return e!=null?$l(t,s,n,e):kl(t,s,n)};function Ll(i){const e={time:{type:"f",value:0},resolution:{type:"v4",value:new _t},uvContain:{type:"m3",value:new _t},containMult:{type:"v2",value:new E},areaMask:{type:"v4",value:new _t}},t={PI:Math.PI,PI2:Math.PI*2,PI_HALF:Math.PI*.5,BG_COLOR:Ml(new A(2886976))};function s(){i.renderer.drawingBufferSize.watchImmediate(()=>{const{resolution:o,uvContain:r,containMult:a,areaMask:l}=e,c=i.renderer.drawingBufferSize.value,{width:h,height:d,dpr:u,aspect:p}=i.$vp,{GRID_WIDTH:g,GRID_HEIGHT:_,GRID_TOP:M}=i.$store;if(c.x>c.y){const m=1/c.y;r.value.set(m,m,(c.y-c.x)*.5*m,0),a.value.set(c.x/c.y,1)}else{const m=1/c.x;r.value.set(m,m,0,(c.x-c.y)*.5*m),a.value.set(1,c.y/c.x)}o.value.set(c.x,c.y,u,p);const k=Math.min(c.x,c.y)/1e3,v=l.value,b=(c.y>c.x)*(c.x-c.y)*.5;v.x=(c.x-g*k)*.5,v.y=v.x+g*k,v.z=c.y-(_+M)*k+b,v.w=v.z+_*k})}function n(){const{slowEt:o}=i.$time;e.time.value=o}return Object.assign(i,{uniforms:e,defines:t,shaders:{init:s,update:n}}),i}Ya();lo(()=>{let i;f.usePlugins([Ia,kr,Aa,Ao,ga,ca,ar,Ma].filter(Boolean)),f.init=async function(){Ll(f),f.renderer=new _l,f.scene=i=new Tl,f.shaders.init(),await f.$loader.init(),f.$fbo.init()},f.preload=async function(){await f.$loader.preload();const t=f.collection.atlas.sprites;t.line.pop(),t.lineRevert.shift(),t.tail.pop(),t.tailRevert.shift(),t.corner.pop(),t.cornerRevert.shift(),await f.$artboard.loadLevels()},f.start=function(){f.$pp.init(),f.$particles.init(),i.triggerInit(),f.$game.init(),f.$state.start()},f.update=function(){f.shaders.update(),i.triggerUpdate(),f.$particles.update(),f.$pp.update(),f.$game.update()},f.render=function(){const t=f.threeRenderer,s=f.$pp.buffers;t.setRenderTarget(s.main),t.clear(),i.triggerRender(),t.setRenderTarget(null),f.$pp.render()}});const Il=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Fl(i){return function(t){var r;const s=t.$refs.webglWrapper,n=document.createElement("canvas");n.classList.add("webgl-canvas"),s.appendChild(n);const o=co(t,n);if(o._n&&(o._n=Il),t.$webgl=o,t.$gui){const a=t.$gui,l=a.webglPage||a;o.$gui=l,a.methods.forEach(c=>o.$gui[c]=l[c].bind(l))}o.$vp=t.$vp,o.$audio=t.$audio,o.$playSound=t.$playSound,(r=o.init)==null||r.call(o)}}sn(async()=>{V.root=document.getElementById("app"),V.usePlugins([Co,!1,Eo,eo,un,To,_o,Yn,Fl].filter(Boolean));const i=new Promise(e=>V.$webgl.hooks.afterStart.watchOnce(e));await Promise.all([i,new bi("VCFtr").load(),new bi("VCYg").load(),H(820)]),V.$controls.listen(),V.$view.start(),V.$webgl.frame(),await H(150),await V.$components.preloader.hide()});
